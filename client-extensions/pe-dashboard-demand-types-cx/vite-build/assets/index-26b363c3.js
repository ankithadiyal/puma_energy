var iW=Object.defineProperty;var rW=(e,t,n)=>t in e?iW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var xh=(e,t,n)=>(rW(e,typeof t!="symbol"?t+"":t,n),n);import*as Zh from"react";import B,{useState as It,useEffect as Ar,useRef as wo,useCallback as U3,forwardRef as $3,useImperativeHandle as V3,useMemo as nW,useLayoutEffect as sW,createElement as oW,Component as aW,createRef as lW,StrictMode as cW}from"react";import*as hW from"react-dom";import M2,{findDOMNode as uW,render as dW,unmountComponentAtNode as pW}from"react-dom";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function n(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(a){if(a.ep)return;a.ep=!0;const d=n(a);fetch(a.href,d)}})();const fW=({serviceDetail:e})=>{var t;return(t=e==null?void 0:e.serviceCharacteristic)!=null&&t.length&&e.serviceCharacteristic.forEach(n=>{switch(n==null?void 0:n.name){case"sourceEndSite":n==null||n.value;break;case"destinationEndSite":n==null||n.value;break}}),B.createElement(B.Fragment,null,B.createElement("div",{class:"col-md-12"},B.createElement("div",{class:"rout-detail"},B.createElement("ul",null,B.createElement("li",{class:"rout-from"},B.createElement("div",{class:"rout-info"},B.createElement("div",{class:"destination-title"},e==null?void 0:e.sourceEndName,B.createElement("span",{class:"icon"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"distance"))),B.createElement("div",{class:"destination-address"},e==null?void 0:e.sourceEndAddress))),B.createElement("li",{class:"rout-to"},B.createElement("div",{class:"rout-info"},B.createElement("div",{class:"destination-title"},e==null?void 0:e.destinationEndName,B.createElement("span",{class:"icon"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"distance"))),B.createElement("div",{class:"destination-address"},e==null?void 0:e.destinationEndAddress)))))))};var mW=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,gW=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,yW=/[^-+\dA-Z]/g;function S1(e,t,n,s){if(arguments.length===1&&typeof e=="string"&&!/\d/.test(e)&&(t=e,e=void 0),e=e||e===0?e:new Date,e instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");t=String(iO[t]||t||iO.default);var a=t.slice(0,4);(a==="UTC:"||a==="GMT:")&&(t=t.slice(4),n=!0,a==="GMT:"&&(s=!0));var d=function(){return n?"getUTC":"get"},f=function(){return e[d()+"Date"]()},i=function(){return e[d()+"Day"]()},S=function(){return e[d()+"Month"]()},E=function(){return e[d()+"FullYear"]()},L=function(){return e[d()+"Hours"]()},F=function(){return e[d()+"Minutes"]()},G=function(){return e[d()+"Seconds"]()},q=function(){return e[d()+"Milliseconds"]()},Q=function(){return n?0:e.getTimezoneOffset()},te=function(){return _W(e)},he=function(){return vW(e)},fe={d:function(){return f()},dd:function(){return jg(f())},ddd:function(){return ig.dayNames[i()]},DDD:function(){return rO({y:E(),m:S(),d:f(),_:d(),dayName:ig.dayNames[i()],short:!0})},dddd:function(){return ig.dayNames[i()+7]},DDDD:function(){return rO({y:E(),m:S(),d:f(),_:d(),dayName:ig.dayNames[i()+7]})},m:function(){return S()+1},mm:function(){return jg(S()+1)},mmm:function(){return ig.monthNames[S()]},mmmm:function(){return ig.monthNames[S()+12]},yy:function(){return String(E()).slice(2)},yyyy:function(){return jg(E(),4)},h:function(){return L()%12||12},hh:function(){return jg(L()%12||12)},H:function(){return L()},HH:function(){return jg(L())},M:function(){return F()},MM:function(){return jg(F())},s:function(){return G()},ss:function(){return jg(G())},l:function(){return jg(q(),3)},L:function(){return jg(Math.floor(q()/10))},t:function(){return L()<12?ig.timeNames[0]:ig.timeNames[1]},tt:function(){return L()<12?ig.timeNames[2]:ig.timeNames[3]},T:function(){return L()<12?ig.timeNames[4]:ig.timeNames[5]},TT:function(){return L()<12?ig.timeNames[6]:ig.timeNames[7]},Z:function(){return s?"GMT":n?"UTC":xW(e)},o:function(){return(Q()>0?"-":"+")+jg(Math.floor(Math.abs(Q())/60)*100+Math.abs(Q())%60,4)},p:function(){return(Q()>0?"-":"+")+jg(Math.floor(Math.abs(Q())/60),2)+":"+jg(Math.floor(Math.abs(Q())%60),2)},S:function(){return["th","st","nd","rd"][f()%10>3?0:(f()%100-f()%10!=10)*f()%10]},W:function(){return te()},WW:function(){return jg(te())},N:function(){return he()}};return t.replace(mW,function(le){return le in fe?fe[le]():le.slice(1,le.length-1)})}var iO={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},ig={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},jg=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(t).padStart(n,"0")},rO=function(t){var n=t.y,s=t.m,a=t.d,d=t._,f=t.dayName,i=t.short,S=i===void 0?!1:i,E=new Date,L=new Date;L.setDate(L[d+"Date"]()-1);var F=new Date;F.setDate(F[d+"Date"]()+1);var G=function(){return E[d+"Date"]()},q=function(){return E[d+"Month"]()},Q=function(){return E[d+"FullYear"]()},te=function(){return L[d+"Date"]()},he=function(){return L[d+"Month"]()},fe=function(){return L[d+"FullYear"]()},le=function(){return F[d+"Date"]()},Se=function(){return F[d+"Month"]()},ke=function(){return F[d+"FullYear"]()};return Q()===n&&q()===s&&G()===a?S?"Tdy":"Today":fe()===n&&he()===s&&te()===a?S?"Ysd":"Yesterday":ke()===n&&Se()===s&&le()===a?S?"Tmw":"Tomorrow":f},_W=function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());n.setDate(n.getDate()-(n.getDay()+6)%7+3);var s=new Date(n.getFullYear(),0,4);s.setDate(s.getDate()-(s.getDay()+6)%7+3);var a=n.getTimezoneOffset()-s.getTimezoneOffset();n.setHours(n.getHours()-a);var d=(n-s)/(864e5*7);return 1+Math.floor(d)},vW=function(t){var n=t.getDay();return n===0&&(n=7),n},xW=function(t){return(String(t).match(gW)||[""]).pop().replace(yW,"").replace(/GMT\+0000/g,"UTC")};const fa=()=>{const e=G=>{if(!G)return"";try{let q=new Date(G);return S1(q,"dd-mmm-yyyy")}catch(q){return console.error("Error formatting date:",G,q),""}};return{formatHoursToDisplayMTTR:G=>{if(!G||G<=0)return"0Day(s) 0H 0m 0s";const q=Math.floor(G*3600),Q=Math.floor(q/(24*3600));let te=q%(24*3600);const he=Math.floor(te/3600);te%=3600;const fe=Math.floor(te/60),le=te%60;return`${Q}Day(s) ${he}H ${fe}m ${le}s`},formatContractPeriod:G=>{if(!G||typeof G!="string")return"1 Year 1 Month";const q=G.trim().split(/\s+/);let Q=0,te=0;if(q.length===1)te=Math.floor(parseFloat(q[0]));else if(q.length===2){const fe=Math.floor(parseFloat(q[0])),le=q[1].toLowerCase();le.startsWith("year")?Q=fe:le.startsWith("month")&&(te=fe)}else q.length>=4&&(Q=Math.floor(parseFloat(q[0])),te=Math.floor(parseFloat(q[2])));let he="";return Q>0&&(he+=`${Q} Year${Q>1?"s":""}`),te>0&&(he.length>0&&(he+=" "),he+=`${te} Month${te>1?"s":""}`),he},convertToLfrDate:(G,q)=>{if(!G)return"";let Q;if(typeof G=="string"){const le=G.replace(/[-,/]/g," ").replace(/\s+/g," ").trim();Q=new Date(le)}else if(G instanceof Date)Q=G;else return"";if(isNaN(Q))return"";const te=Q.getFullYear(),he=String(Q.getMonth()+1).padStart(2,"0"),fe=String(Q.getDate()).padStart(2,"0");if(q==="fromDate")return`${te}-${he}-${fe}T00:00:00Z`;if(q==="toDate")return`${te}-${he}-${fe}T23:59:59Z`;throw new Error("Invalid type. Use 'fromDate' or 'toDate'.")},formatDate:e,formatDateTime:G=>{if(!G)return"";try{let q;if(/^\d{2}-\d{2}-\d{4} \d{2}:\d{2}:\d{2}$/.test(G)){const[Q,te,he,fe,le,Se]=G.match(/\d+/g).map(Number);q=new Date(he,te-1,Q,fe,le,Se)}else q=new Date(G);return S1(q,"dd-mmm-yyyy hh:MM TT")}catch(q){return console.error("Error formatting date:",G,q),""}},getDateRangeFromFilter:(G,q)=>{const Q=new Date;let te,he;const fe=["January","February","March","April","May","June","July","August","September","October","November","December"];if((G==null?void 0:G.toLowerCase())==="last 7 days"||(G==null?void 0:G.toLowerCase())==="weekly"){const le=new Date(Q);le.setDate(Q.getDate()-7),te=e(le);const Se=new Date(Q);Se.setDate(Q.getDate()-1),he=e(Se)}else if((G==null?void 0:G.toLowerCase())==="last24hrs"||(G==null?void 0:G.toLowerCase())==="last 24 hrs"||(G==null?void 0:G.toLowerCase())==="current"){const le=new Date(Q);le.setDate(Q.getDate()-1),te=e(le),he=e(Q)}else if(/^q[1-4]$/i.test(G)){const Se=(parseInt(G[1])-1)*3,ke=Se+2,Ee=q!=null&&q!=null?q:Q.getFullYear(),Ie=new Date(Ee,Se,1),He=new Date(Ee,ke+1,0);te=e(Ie),he=e(He)}else if(/^\d{4}$/.test(G)){const le=parseInt(G);te=e(new Date(le,0,1)),he=e(new Date(le,11,31))}else{const le=G==null?void 0:G.toLowerCase(),Se=fe.findIndex(ke=>ke.toLowerCase()===le||ke.slice(0,3).toLowerCase()===le);if(Se!==-1){const ke=q!=null&&q!=null?q:Q.getFullYear(),Ee=new Date(ke,Se,1),Ie=new Date(ke,Se+1,0);te=e(Ee),ke===Q.getFullYear()&&Se===Q.getMonth()?he=e(Q):he=e(Ie)}else console.error("Invalid month name for filterValue:",G)}return{fromDate:te,toDate:he}},formatToHoursMinutes:G=>{if(!G)return"";const[q,Q,te,he]=G==null?void 0:G.split(":").map(Number),fe=q*24+Q,le=te===0&&he>0?1:te;return`${String(fe).padStart(2,"0")}:${String(le).padStart(2,"0")}`},formatSecondsToHoursMinutes:G=>{if(!G||isNaN(G))return"00:00";const q=Math.floor(G/86400),Q=G%86400,te=Math.floor(Q/3600),he=Q%3600,fe=Math.floor(he/60),le=he%60,Se=q*24+te,ke=fe===0&&le>0?1:fe;return`${String(Se).padStart(2,"0")}:${String(ke).padStart(2,"0")}`},formatSLADate:G=>{if(!G)return"";let q=new Date(G);return S1(q,"dd/mm/yyyy")},getCurrentISTDateTimeAsUTC:()=>{const G=new Date,q=G.getFullYear(),Q=String(G.getMonth()+1).padStart(2,"0"),te=String(G.getDate()).padStart(2,"0");return`${q}-${Q}-${te}T23:59:59Z`},extractDate:G=>{const q=new Date(G),Q=q.getUTCFullYear(),te=String(q.getUTCMonth()+1).padStart(2,"0"),he=String(q.getUTCDate()).padStart(2,"0");return`${Q}-${te}-${he}`},formatUTCDateTime:G=>{if(!G)return"";let q=new Date(G);return S1(q,"dd-mmm-yyyy hh:MM TT",!0)}}},bW=({serviceDetail:e,productName:t})=>{var E,L,F,G,q,Q,te;let n=null,s=null,a=null,d=null,f=null,i=null,S=null;return(E=e==null?void 0:e.serviceCharacteristic)!=null&&E.length&&e.serviceCharacteristic.forEach(he=>{switch(he==null?void 0:he.name){case"Interface":n=he==null?void 0:he.value;break;case"bandwidth":s=`${he==null?void 0:he.value} ${he==null?void 0:he.unit}`;break;case"sourceEndSite":he==null||he.value;break;case"destinationEndSite":he==null||he.value;break;case"noOfFiberPairs":a=he==null?void 0:he.value;break;case"committedUptime":`${he==null?void 0:he.value}`;break;case"noOfFiberCutWithInSla":he==null||he.value;break;case"fiberLossHandover":i=he==null?void 0:he.value;break;case"endLifeFiberLoss":S=he==null?void 0:he.value;break;case"originalDistance":f=`${he==null?void 0:he.value} ${he==null?void 0:he.unit}`;break}}),i!=null&&S!=null&&(d=`${i} - ${S}`),B.createElement(B.Fragment,null,B.createElement("div",{className:"col-md-12"},B.createElement("div",{className:"row"},B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Variant Name"),B.createElement("div",{className:"value"},e!=null&&e.variantName?e==null?void 0:e.variantName:"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Service Category"),B.createElement("div",{className:"value"},e!=null&&e.serviceCategoryName?e==null?void 0:e.serviceCategoryName:"-"))),t&&t=="privateLine"&&B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Interface"),B.createElement("div",{className:"value"},n||"-"))),t&&t=="privateLine"&&B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Bandwidth"),B.createElement("div",{className:"value"},s||"-"))),t&&t=="darkFiber"&&B.createElement(B.Fragment,null,B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Parent Service ID"),B.createElement("div",{className:"value"},e!=null&&e.parentServiceId?e==null?void 0:e.parentServiceId:"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Distance"),B.createElement("div",{className:"value"},f||"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Fiber Loss"),B.createElement("div",{className:"value"},d||"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Number of fiber pairs/bundle"),B.createElement("div",{className:"value"},a||"-")))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Payment Terms"),B.createElement("div",{className:"value"},e!=null&&e.paymentTerm?e==null?void 0:e.paymentTerm:"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Bill Frequency"),B.createElement("div",{className:"value"},e!=null&&e.billFrequency?e==null?void 0:e.billFrequency:"-"))),B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Status"),B.createElement("div",{className:"value"},(e==null?void 0:e.status)===500||(e==null?void 0:e.code)===500||e!=null&&e.error?B.createElement("span",null,"-"):B.createElement("span",{className:`status-${e&&(e==null?void 0:e.status)!=500&&((L=e==null?void 0:e.status)==null?void 0:L.toLowerCase())==="pending"?"pendingapproved":e&&(e==null?void 0:e.status)!=500&&((q=(G=(F=e==null?void 0:e.status)==null?void 0:F.split(" "))==null?void 0:G.join(""))==null?void 0:q.toLowerCase())}`},(e==null?void 0:e.status)!=500?((Q=e==null?void 0:e.status)==null?void 0:Q.toLowerCase())==="pending"?"In-Progress":e==null?void 0:e.status:"-")))),((te=e==null?void 0:e.status)==null?void 0:te.toLowerCase())==="terminated"&&B.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 mb-30"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Termination Date"),B.createElement("div",{className:"value"},e!=null&&e.terminationDate?fa().formatDate(e==null?void 0:e.terminationDate):"-"))))))},wW=({serviceDetail:e})=>{var s,a;let t=null;(s=e==null?void 0:e.serviceCharacteristic)!=null&&s.length&&e.serviceCharacteristic.forEach(d=>{switch(d==null?void 0:d.name){case"contractPeriod":t=d!=null&&d.value?fa().formatContractPeriod(`${d==null?void 0:d.value} ${d==null?void 0:d.unit}`):"-";break}});const n=()=>{var d;return((d=e==null?void 0:e.status)==null?void 0:d.toLowerCase())==="pending"&&(e!=null&&e.customerRFSDate)?fa().formatDate(e==null?void 0:e.customerRFSDate):e!=null&&e.activationDate?fa().formatDate(e==null?void 0:e.activationDate):"-"};return B.createElement(B.Fragment,null,B.createElement("div",{class:"col-md-12"},B.createElement("div",{class:"status-rout-time"},B.createElement("div",{class:"row-cols"},B.createElement("div",{class:"status-time-row"},B.createElement("div",{class:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"search_activity")," Contract Period"),B.createElement("div",{class:"value"},t||"-"))),B.createElement("div",{class:"row-cols"},B.createElement("div",{class:"status-time-row"},B.createElement("div",{class:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"manage_history")," Contract Renewal"),B.createElement("div",{class:"value"},e!=null&&e.endDate&&((a=e==null?void 0:e.status)==null?void 0:a.toLowerCase())!="terminated"?fa().formatDate(e==null?void 0:e.endDate):"-"))),B.createElement("div",{class:"row-cols"},B.createElement("div",{class:"status-time-row"},B.createElement("div",{class:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"calendar_clock"),typeof(e==null?void 0:e.status)=="string"?e.status.toLowerCase()==="pending"?"Committed RFS Date":"Service Start Date":"-"),B.createElement("div",{class:"value"},n()))),B.createElement("div",{class:"row-cols"},B.createElement("div",{class:"status-time-row"},B.createElement("div",{class:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"edit_calendar"),"Billing Start Date"),B.createElement("div",{class:"value"}," ",e!=null&&e.billingStartDate?fa().formatDate(e==null?void 0:e.billingStartDate):"-"," "))))))};function W3(e,t){return function(){return e.apply(t,arguments)}}const{toString:SW}=Object.prototype,{getPrototypeOf:XI}=Object,{iterator:I2,toStringTag:j3}=Symbol,L2=(e=>t=>{const n=SW.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),C0=e=>(e=e.toLowerCase(),t=>L2(t)===e),D2=e=>t=>typeof t===e,{isArray:rw}=Array,WS=D2("undefined");function TW(e){return e!==null&&!WS(e)&&e.constructor!==null&&!WS(e.constructor)&&hg(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const H3=C0("ArrayBuffer");function CW(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&H3(e.buffer),t}const EW=D2("string"),hg=D2("function"),G3=D2("number"),P2=e=>e!==null&&typeof e=="object",kW=e=>e===!0||e===!1,GC=e=>{if(L2(e)!=="object")return!1;const t=XI(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(j3 in e)&&!(I2 in e)},AW=C0("Date"),MW=C0("File"),IW=C0("Blob"),LW=C0("FileList"),DW=e=>P2(e)&&hg(e.pipe),PW=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||hg(e.append)&&((t=L2(e))==="formdata"||t==="object"&&hg(e.toString)&&e.toString()==="[object FormData]"))},OW=C0("URLSearchParams"),[RW,NW,BW,FW]=["ReadableStream","Request","Response","Headers"].map(C0),zW=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _T(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let s,a;if(typeof e!="object"&&(e=[e]),rw(e))for(s=0,a=e.length;s<a;s++)t.call(null,e[s],s,e);else{const d=n?Object.getOwnPropertyNames(e):Object.keys(e),f=d.length;let i;for(s=0;s<f;s++)i=d[s],t.call(null,e[i],i,e)}}function q3(e,t){t=t.toLowerCase();const n=Object.keys(e);let s=n.length,a;for(;s-- >0;)if(a=n[s],t===a.toLowerCase())return a;return null}const Kx=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Y3=e=>!WS(e)&&e!==Kx;function lM(){const{caseless:e}=Y3(this)&&this||{},t={},n=(s,a)=>{const d=e&&q3(t,a)||a;GC(t[d])&&GC(s)?t[d]=lM(t[d],s):GC(s)?t[d]=lM({},s):rw(s)?t[d]=s.slice():t[d]=s};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&_T(arguments[s],n);return t}const UW=(e,t,n,{allOwnKeys:s}={})=>(_T(t,(a,d)=>{n&&hg(a)?e[d]=W3(a,n):e[d]=a},{allOwnKeys:s}),e),$W=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),VW=(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},WW=(e,t,n,s)=>{let a,d,f;const i={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),d=a.length;d-- >0;)f=a[d],(!s||s(f,e,t))&&!i[f]&&(t[f]=e[f],i[f]=!0);e=n!==!1&&XI(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},jW=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return s!==-1&&s===n},HW=e=>{if(!e)return null;if(rw(e))return e;let t=e.length;if(!G3(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},GW=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&XI(Uint8Array)),qW=(e,t)=>{const s=(e&&e[I2]).call(e);let a;for(;(a=s.next())&&!a.done;){const d=a.value;t.call(e,d[0],d[1])}},YW=(e,t)=>{let n;const s=[];for(;(n=e.exec(t))!==null;)s.push(n);return s},XW=C0("HTMLFormElement"),ZW=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),nO=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),KW=C0("RegExp"),X3=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};_T(n,(a,d)=>{let f;(f=t(a,d,e))!==!1&&(s[d]=f||a)}),Object.defineProperties(e,s)},QW=e=>{X3(e,(t,n)=>{if(hg(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=e[n];if(hg(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},JW=(e,t)=>{const n={},s=a=>{a.forEach(d=>{n[d]=!0})};return rw(e)?s(e):s(String(e).split(t)),n},ej=()=>{},tj=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function ij(e){return!!(e&&hg(e.append)&&e[j3]==="FormData"&&e[I2])}const rj=e=>{const t=new Array(10),n=(s,a)=>{if(P2(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[a]=s;const d=rw(s)?[]:{};return _T(s,(f,i)=>{const S=n(f,a+1);!WS(S)&&(d[i]=S)}),t[a]=void 0,d}}return s};return n(e,0)},nj=C0("AsyncFunction"),sj=e=>e&&(P2(e)||hg(e))&&hg(e.then)&&hg(e.catch),Z3=((e,t)=>e?setImmediate:t?((n,s)=>(Kx.addEventListener("message",({source:a,data:d})=>{a===Kx&&d===n&&s.length&&s.shift()()},!1),a=>{s.push(a),Kx.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",hg(Kx.postMessage)),oj=typeof queueMicrotask<"u"?queueMicrotask.bind(Kx):typeof process<"u"&&process.nextTick||Z3,aj=e=>e!=null&&hg(e[I2]),en={isArray:rw,isArrayBuffer:H3,isBuffer:TW,isFormData:PW,isArrayBufferView:CW,isString:EW,isNumber:G3,isBoolean:kW,isObject:P2,isPlainObject:GC,isReadableStream:RW,isRequest:NW,isResponse:BW,isHeaders:FW,isUndefined:WS,isDate:AW,isFile:MW,isBlob:IW,isRegExp:KW,isFunction:hg,isStream:DW,isURLSearchParams:OW,isTypedArray:GW,isFileList:LW,forEach:_T,merge:lM,extend:UW,trim:zW,stripBOM:$W,inherits:VW,toFlatObject:WW,kindOf:L2,kindOfTest:C0,endsWith:jW,toArray:HW,forEachEntry:qW,matchAll:YW,isHTMLForm:XW,hasOwnProperty:nO,hasOwnProp:nO,reduceDescriptors:X3,freezeMethods:QW,toObjectSet:JW,toCamelCase:ZW,noop:ej,toFiniteNumber:tj,findKey:q3,global:Kx,isContextDefined:Y3,isSpecCompliantForm:ij,toJSONObject:rj,isAsyncFn:nj,isThenable:sj,setImmediate:Z3,asap:oj,isIterable:aj};function il(e,t,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}en.inherits(il,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:en.toJSONObject(this.config),code:this.code,status:this.status}}});const K3=il.prototype,Q3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Q3[e]={value:e}});Object.defineProperties(il,Q3);Object.defineProperty(K3,"isAxiosError",{value:!0});il.from=(e,t,n,s,a,d)=>{const f=Object.create(K3);return en.toFlatObject(e,f,function(S){return S!==Error.prototype},i=>i!=="isAxiosError"),il.call(f,e.message,t,n,s,a),f.cause=e,f.name=e.name,d&&Object.assign(f,d),f};const lj=null;function cM(e){return en.isPlainObject(e)||en.isArray(e)}function J3(e){return en.endsWith(e,"[]")?e.slice(0,-2):e}function sO(e,t,n){return e?e.concat(t).map(function(a,d){return a=J3(a),!n&&d?"["+a+"]":a}).join(n?".":""):t}function cj(e){return en.isArray(e)&&!e.some(cM)}const hj=en.toFlatObject(en,{},null,function(t){return/^is[A-Z]/.test(t)});function O2(e,t,n){if(!en.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=en.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(te,he){return!en.isUndefined(he[te])});const s=n.metaTokens,a=n.visitor||L,d=n.dots,f=n.indexes,S=(n.Blob||typeof Blob<"u"&&Blob)&&en.isSpecCompliantForm(t);if(!en.isFunction(a))throw new TypeError("visitor must be a function");function E(Q){if(Q===null)return"";if(en.isDate(Q))return Q.toISOString();if(en.isBoolean(Q))return Q.toString();if(!S&&en.isBlob(Q))throw new il("Blob is not supported. Use a Buffer instead.");return en.isArrayBuffer(Q)||en.isTypedArray(Q)?S&&typeof Blob=="function"?new Blob([Q]):Buffer.from(Q):Q}function L(Q,te,he){let fe=Q;if(Q&&!he&&typeof Q=="object"){if(en.endsWith(te,"{}"))te=s?te:te.slice(0,-2),Q=JSON.stringify(Q);else if(en.isArray(Q)&&cj(Q)||(en.isFileList(Q)||en.endsWith(te,"[]"))&&(fe=en.toArray(Q)))return te=J3(te),fe.forEach(function(Se,ke){!(en.isUndefined(Se)||Se===null)&&t.append(f===!0?sO([te],ke,d):f===null?te:te+"[]",E(Se))}),!1}return cM(Q)?!0:(t.append(sO(he,te,d),E(Q)),!1)}const F=[],G=Object.assign(hj,{defaultVisitor:L,convertValue:E,isVisitable:cM});function q(Q,te){if(!en.isUndefined(Q)){if(F.indexOf(Q)!==-1)throw Error("Circular reference detected in "+te.join("."));F.push(Q),en.forEach(Q,function(fe,le){(!(en.isUndefined(fe)||fe===null)&&a.call(t,fe,en.isString(le)?le.trim():le,te,G))===!0&&q(fe,te?te.concat(le):[le])}),F.pop()}}if(!en.isObject(e))throw new TypeError("data must be an object");return q(e),t}function oO(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function ZI(e,t){this._pairs=[],e&&O2(e,this,t)}const eB=ZI.prototype;eB.append=function(t,n){this._pairs.push([t,n])};eB.toString=function(t){const n=t?function(s){return t.call(this,s,oO)}:oO;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function uj(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tB(e,t,n){if(!t)return e;const s=n&&n.encode||uj;en.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let d;if(a?d=a(t,n):d=en.isURLSearchParams(t)?t.toString():new ZI(t,n).toString(s),d){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}class dj{constructor(){this.handlers=[]}use(t,n,s){return this.handlers.push({fulfilled:t,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){en.forEach(this.handlers,function(s){s!==null&&t(s)})}}const aO=dj,iB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},pj=typeof URLSearchParams<"u"?URLSearchParams:ZI,fj=typeof FormData<"u"?FormData:null,mj=typeof Blob<"u"?Blob:null,gj={isBrowser:!0,classes:{URLSearchParams:pj,FormData:fj,Blob:mj},protocols:["http","https","file","blob","url","data"]},KI=typeof window<"u"&&typeof document<"u",hM=typeof navigator=="object"&&navigator||void 0,yj=KI&&(!hM||["ReactNative","NativeScript","NS"].indexOf(hM.product)<0),_j=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),vj=KI&&window.location.href||"http://localhost",xj=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:KI,hasStandardBrowserEnv:yj,hasStandardBrowserWebWorkerEnv:_j,navigator:hM,origin:vj},Symbol.toStringTag,{value:"Module"})),Rf={...xj,...gj};function bj(e,t){return O2(e,new Rf.classes.URLSearchParams,Object.assign({visitor:function(n,s,a,d){return Rf.isNode&&en.isBuffer(n)?(this.append(s,n.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)}},t))}function wj(e){return en.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Sj(e){const t={},n=Object.keys(e);let s;const a=n.length;let d;for(s=0;s<a;s++)d=n[s],t[d]=e[d];return t}function rB(e){function t(n,s,a,d){let f=n[d++];if(f==="__proto__")return!0;const i=Number.isFinite(+f),S=d>=n.length;return f=!f&&en.isArray(a)?a.length:f,S?(en.hasOwnProp(a,f)?a[f]=[a[f],s]:a[f]=s,!i):((!a[f]||!en.isObject(a[f]))&&(a[f]=[]),t(n,s,a[f],d)&&en.isArray(a[f])&&(a[f]=Sj(a[f])),!i)}if(en.isFormData(e)&&en.isFunction(e.entries)){const n={};return en.forEachEntry(e,(s,a)=>{t(wj(s),a,n,0)}),n}return null}function Tj(e,t,n){if(en.isString(e))try{return(t||JSON.parse)(e),en.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(e)}const QI={transitional:iB,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,d=en.isObject(t);if(d&&en.isHTMLForm(t)&&(t=new FormData(t)),en.isFormData(t))return a?JSON.stringify(rB(t)):t;if(en.isArrayBuffer(t)||en.isBuffer(t)||en.isStream(t)||en.isFile(t)||en.isBlob(t)||en.isReadableStream(t))return t;if(en.isArrayBufferView(t))return t.buffer;if(en.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let i;if(d){if(s.indexOf("application/x-www-form-urlencoded")>-1)return bj(t,this.formSerializer).toString();if((i=en.isFileList(t))||s.indexOf("multipart/form-data")>-1){const S=this.env&&this.env.FormData;return O2(i?{"files[]":t}:t,S&&new S,this.formSerializer)}}return d||a?(n.setContentType("application/json",!1),Tj(t)):t}],transformResponse:[function(t){const n=this.transitional||QI.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(en.isResponse(t)||en.isReadableStream(t))return t;if(t&&en.isString(t)&&(s&&!this.responseType||a)){const f=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(i){if(f)throw i.name==="SyntaxError"?il.from(i,il.ERR_BAD_RESPONSE,this,null,this.response):i}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Rf.classes.FormData,Blob:Rf.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};en.forEach(["delete","get","head","post","put","patch"],e=>{QI.headers[e]={}});const JI=QI,Cj=en.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ej=e=>{const t={};let n,s,a;return e&&e.split(`
`).forEach(function(f){a=f.indexOf(":"),n=f.substring(0,a).trim().toLowerCase(),s=f.substring(a+1).trim(),!(!n||t[n]&&Cj[n])&&(n==="set-cookie"?t[n]?t[n].push(s):t[n]=[s]:t[n]=t[n]?t[n]+", "+s:s)}),t},lO=Symbol("internals");function Kw(e){return e&&String(e).trim().toLowerCase()}function qC(e){return e===!1||e==null?e:en.isArray(e)?e.map(qC):String(e)}function kj(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(e);)t[s[1]]=s[2];return t}const Aj=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function fA(e,t,n,s,a){if(en.isFunction(s))return s.call(this,t,n);if(a&&(t=n),!!en.isString(t)){if(en.isString(s))return t.indexOf(s)!==-1;if(en.isRegExp(s))return s.test(t)}}function Mj(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,s)=>n.toUpperCase()+s)}function Ij(e,t){const n=en.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+n,{value:function(a,d,f){return this[s].call(this,t,a,d,f)},configurable:!0})})}class R2{constructor(t){t&&this.set(t)}set(t,n,s){const a=this;function d(i,S,E){const L=Kw(S);if(!L)throw new Error("header name must be a non-empty string");const F=en.findKey(a,L);(!F||a[F]===void 0||E===!0||E===void 0&&a[F]!==!1)&&(a[F||S]=qC(i))}const f=(i,S)=>en.forEach(i,(E,L)=>d(E,L,S));if(en.isPlainObject(t)||t instanceof this.constructor)f(t,n);else if(en.isString(t)&&(t=t.trim())&&!Aj(t))f(Ej(t),n);else if(en.isObject(t)&&en.isIterable(t)){let i={},S,E;for(const L of t){if(!en.isArray(L))throw TypeError("Object iterator must return a key-value pair");i[E=L[0]]=(S=i[E])?en.isArray(S)?[...S,L[1]]:[S,L[1]]:L[1]}f(i,n)}else t!=null&&d(n,t,s);return this}get(t,n){if(t=Kw(t),t){const s=en.findKey(this,t);if(s){const a=this[s];if(!n)return a;if(n===!0)return kj(a);if(en.isFunction(n))return n.call(this,a,s);if(en.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Kw(t),t){const s=en.findKey(this,t);return!!(s&&this[s]!==void 0&&(!n||fA(this,this[s],s,n)))}return!1}delete(t,n){const s=this;let a=!1;function d(f){if(f=Kw(f),f){const i=en.findKey(s,f);i&&(!n||fA(s,s[i],i,n))&&(delete s[i],a=!0)}}return en.isArray(t)?t.forEach(d):d(t),a}clear(t){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const d=n[s];(!t||fA(this,this[d],d,t,!0))&&(delete this[d],a=!0)}return a}normalize(t){const n=this,s={};return en.forEach(this,(a,d)=>{const f=en.findKey(s,d);if(f){n[f]=qC(a),delete n[d];return}const i=t?Mj(d):String(d).trim();i!==d&&delete n[d],n[i]=qC(a),s[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return en.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=t&&en.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const s=new this(t);return n.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[lO]=this[lO]={accessors:{}}).accessors,a=this.prototype;function d(f){const i=Kw(f);s[i]||(Ij(a,f),s[i]=!0)}return en.isArray(t)?t.forEach(d):d(t),this}}R2.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);en.reduceDescriptors(R2.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[n]=s}}});en.freezeMethods(R2);const _0=R2;function mA(e,t){const n=this||JI,s=t||n,a=_0.from(s.headers);let d=s.data;return en.forEach(e,function(i){d=i.call(n,d,a.normalize(),t?t.status:void 0)}),a.normalize(),d}function nB(e){return!!(e&&e.__CANCEL__)}function nw(e,t,n){il.call(this,e??"canceled",il.ERR_CANCELED,t,n),this.name="CanceledError"}en.inherits(nw,il,{__CANCEL__:!0});function sB(e,t,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?e(n):t(new il("Request failed with status code "+n.status,[il.ERR_BAD_REQUEST,il.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Lj(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Dj(e,t){e=e||10;const n=new Array(e),s=new Array(e);let a=0,d=0,f;return t=t!==void 0?t:1e3,function(S){const E=Date.now(),L=s[d];f||(f=E),n[a]=S,s[a]=E;let F=d,G=0;for(;F!==a;)G+=n[F++],F=F%e;if(a=(a+1)%e,a===d&&(d=(d+1)%e),E-f<t)return;const q=L&&E-L;return q?Math.round(G*1e3/q):void 0}}function Pj(e,t){let n=0,s=1e3/t,a,d;const f=(E,L=Date.now())=>{n=L,a=null,d&&(clearTimeout(d),d=null),e.apply(null,E)};return[(...E)=>{const L=Date.now(),F=L-n;F>=s?f(E,L):(a=E,d||(d=setTimeout(()=>{d=null,f(a)},s-F)))},()=>a&&f(a)]}const vE=(e,t,n=3)=>{let s=0;const a=Dj(50,250);return Pj(d=>{const f=d.loaded,i=d.lengthComputable?d.total:void 0,S=f-s,E=a(S),L=f<=i;s=f;const F={loaded:f,total:i,progress:i?f/i:void 0,bytes:S,rate:E||void 0,estimated:E&&i&&L?(i-f)/E:void 0,event:d,lengthComputable:i!=null,[t?"download":"upload"]:!0};e(F)},n)},cO=(e,t)=>{const n=e!=null;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},hO=e=>(...t)=>en.asap(()=>e(...t)),Oj=Rf.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Rf.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Rf.origin),Rf.navigator&&/(msie|trident)/i.test(Rf.navigator.userAgent)):()=>!0,Rj=Rf.hasStandardBrowserEnv?{write(e,t,n,s,a,d){const f=[e+"="+encodeURIComponent(t)];en.isNumber(n)&&f.push("expires="+new Date(n).toGMTString()),en.isString(s)&&f.push("path="+s),en.isString(a)&&f.push("domain="+a),d===!0&&f.push("secure"),document.cookie=f.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Nj(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Bj(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function oB(e,t,n){let s=!Nj(t);return e&&(s||n==!1)?Bj(e,t):t}const uO=e=>e instanceof _0?{...e}:e;function lb(e,t){t=t||{};const n={};function s(E,L,F,G){return en.isPlainObject(E)&&en.isPlainObject(L)?en.merge.call({caseless:G},E,L):en.isPlainObject(L)?en.merge({},L):en.isArray(L)?L.slice():L}function a(E,L,F,G){if(en.isUndefined(L)){if(!en.isUndefined(E))return s(void 0,E,F,G)}else return s(E,L,F,G)}function d(E,L){if(!en.isUndefined(L))return s(void 0,L)}function f(E,L){if(en.isUndefined(L)){if(!en.isUndefined(E))return s(void 0,E)}else return s(void 0,L)}function i(E,L,F){if(F in t)return s(E,L);if(F in e)return s(void 0,E)}const S={url:d,method:d,data:d,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:i,headers:(E,L,F)=>a(uO(E),uO(L),F,!0)};return en.forEach(Object.keys(Object.assign({},e,t)),function(L){const F=S[L]||a,G=F(e[L],t[L],L);en.isUndefined(G)&&F!==i||(n[L]=G)}),n}const aB=e=>{const t=lb({},e);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:d,headers:f,auth:i}=t;t.headers=f=_0.from(f),t.url=tB(oB(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&f.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let S;if(en.isFormData(n)){if(Rf.hasStandardBrowserEnv||Rf.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((S=f.getContentType())!==!1){const[E,...L]=S?S.split(";").map(F=>F.trim()).filter(Boolean):[];f.setContentType([E||"multipart/form-data",...L].join("; "))}}if(Rf.hasStandardBrowserEnv&&(s&&en.isFunction(s)&&(s=s(t)),s||s!==!1&&Oj(t.url))){const E=a&&d&&Rj.read(d);E&&f.set(a,E)}return t},Fj=typeof XMLHttpRequest<"u",zj=Fj&&function(e){return new Promise(function(n,s){const a=aB(e);let d=a.data;const f=_0.from(a.headers).normalize();let{responseType:i,onUploadProgress:S,onDownloadProgress:E}=a,L,F,G,q,Q;function te(){q&&q(),Q&&Q(),a.cancelToken&&a.cancelToken.unsubscribe(L),a.signal&&a.signal.removeEventListener("abort",L)}let he=new XMLHttpRequest;he.open(a.method.toUpperCase(),a.url,!0),he.timeout=a.timeout;function fe(){if(!he)return;const Se=_0.from("getAllResponseHeaders"in he&&he.getAllResponseHeaders()),Ee={data:!i||i==="text"||i==="json"?he.responseText:he.response,status:he.status,statusText:he.statusText,headers:Se,config:e,request:he};sB(function(He){n(He),te()},function(He){s(He),te()},Ee),he=null}"onloadend"in he?he.onloadend=fe:he.onreadystatechange=function(){!he||he.readyState!==4||he.status===0&&!(he.responseURL&&he.responseURL.indexOf("file:")===0)||setTimeout(fe)},he.onabort=function(){he&&(s(new il("Request aborted",il.ECONNABORTED,e,he)),he=null)},he.onerror=function(){s(new il("Network Error",il.ERR_NETWORK,e,he)),he=null},he.ontimeout=function(){let ke=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const Ee=a.transitional||iB;a.timeoutErrorMessage&&(ke=a.timeoutErrorMessage),s(new il(ke,Ee.clarifyTimeoutError?il.ETIMEDOUT:il.ECONNABORTED,e,he)),he=null},d===void 0&&f.setContentType(null),"setRequestHeader"in he&&en.forEach(f.toJSON(),function(ke,Ee){he.setRequestHeader(Ee,ke)}),en.isUndefined(a.withCredentials)||(he.withCredentials=!!a.withCredentials),i&&i!=="json"&&(he.responseType=a.responseType),E&&([G,Q]=vE(E,!0),he.addEventListener("progress",G)),S&&he.upload&&([F,q]=vE(S),he.upload.addEventListener("progress",F),he.upload.addEventListener("loadend",q)),(a.cancelToken||a.signal)&&(L=Se=>{he&&(s(!Se||Se.type?new nw(null,e,he):Se),he.abort(),he=null)},a.cancelToken&&a.cancelToken.subscribe(L),a.signal&&(a.signal.aborted?L():a.signal.addEventListener("abort",L)));const le=Lj(a.url);if(le&&Rf.protocols.indexOf(le)===-1){s(new il("Unsupported protocol "+le+":",il.ERR_BAD_REQUEST,e));return}he.send(d||null)})},Uj=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let s=new AbortController,a;const d=function(E){if(!a){a=!0,i();const L=E instanceof Error?E:this.reason;s.abort(L instanceof il?L:new nw(L instanceof Error?L.message:L))}};let f=t&&setTimeout(()=>{f=null,d(new il(`timeout ${t} of ms exceeded`,il.ETIMEDOUT))},t);const i=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(d):E.removeEventListener("abort",d)}),e=null)};e.forEach(E=>E.addEventListener("abort",d));const{signal:S}=s;return S.unsubscribe=()=>en.asap(i),S}},$j=Uj,Vj=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let s=0,a;for(;s<n;)a=s+t,yield e.slice(s,a),s=a},Wj=async function*(e,t){for await(const n of jj(e))yield*Vj(n,t)},jj=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:s}=await t.read();if(n)break;yield s}}finally{await t.cancel()}},dO=(e,t,n,s)=>{const a=Wj(e,t);let d=0,f,i=S=>{f||(f=!0,s&&s(S))};return new ReadableStream({async pull(S){try{const{done:E,value:L}=await a.next();if(E){i(),S.close();return}let F=L.byteLength;if(n){let G=d+=F;n(G)}S.enqueue(new Uint8Array(L))}catch(E){throw i(E),E}},cancel(S){return i(S),a.return()}},{highWaterMark:2})},N2=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",lB=N2&&typeof ReadableStream=="function",Hj=N2&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),cB=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Gj=lB&&cB(()=>{let e=!1;const t=new Request(Rf.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),pO=64*1024,uM=lB&&cB(()=>en.isReadableStream(new Response("").body)),xE={stream:uM&&(e=>e.body)};N2&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!xE[t]&&(xE[t]=en.isFunction(e[t])?n=>n[t]():(n,s)=>{throw new il(`Response type '${t}' is not supported`,il.ERR_NOT_SUPPORT,s)})})})(new Response);const qj=async e=>{if(e==null)return 0;if(en.isBlob(e))return e.size;if(en.isSpecCompliantForm(e))return(await new Request(Rf.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(en.isArrayBufferView(e)||en.isArrayBuffer(e))return e.byteLength;if(en.isURLSearchParams(e)&&(e=e+""),en.isString(e))return(await Hj(e)).byteLength},Yj=async(e,t)=>{const n=en.toFiniteNumber(e.getContentLength());return n??qj(t)},Xj=N2&&(async e=>{let{url:t,method:n,data:s,signal:a,cancelToken:d,timeout:f,onDownloadProgress:i,onUploadProgress:S,responseType:E,headers:L,withCredentials:F="same-origin",fetchOptions:G}=aB(e);E=E?(E+"").toLowerCase():"text";let q=$j([a,d&&d.toAbortSignal()],f),Q;const te=q&&q.unsubscribe&&(()=>{q.unsubscribe()});let he;try{if(S&&Gj&&n!=="get"&&n!=="head"&&(he=await Yj(L,s))!==0){let Ee=new Request(t,{method:"POST",body:s,duplex:"half"}),Ie;if(en.isFormData(s)&&(Ie=Ee.headers.get("content-type"))&&L.setContentType(Ie),Ee.body){const[He,Ye]=cO(he,vE(hO(S)));s=dO(Ee.body,pO,He,Ye)}}en.isString(F)||(F=F?"include":"omit");const fe="credentials"in Request.prototype;Q=new Request(t,{...G,signal:q,method:n.toUpperCase(),headers:L.normalize().toJSON(),body:s,duplex:"half",credentials:fe?F:void 0});let le=await fetch(Q,G);const Se=uM&&(E==="stream"||E==="response");if(uM&&(i||Se&&te)){const Ee={};["status","statusText","headers"].forEach(lt=>{Ee[lt]=le[lt]});const Ie=en.toFiniteNumber(le.headers.get("content-length")),[He,Ye]=i&&cO(Ie,vE(hO(i),!0))||[];le=new Response(dO(le.body,pO,He,()=>{Ye&&Ye(),te&&te()}),Ee)}E=E||"text";let ke=await xE[en.findKey(xE,E)||"text"](le,e);return!Se&&te&&te(),await new Promise((Ee,Ie)=>{sB(Ee,Ie,{data:ke,headers:_0.from(le.headers),status:le.status,statusText:le.statusText,config:e,request:Q})})}catch(fe){throw te&&te(),fe&&fe.name==="TypeError"&&/Load failed|fetch/i.test(fe.message)?Object.assign(new il("Network Error",il.ERR_NETWORK,e,Q),{cause:fe.cause||fe}):il.from(fe,fe&&fe.code,e,Q)}}),dM={http:lj,xhr:zj,fetch:Xj};en.forEach(dM,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const fO=e=>`- ${e}`,Zj=e=>en.isFunction(e)||e===null||e===!1,hB={getAdapter:e=>{e=en.isArray(e)?e:[e];const{length:t}=e;let n,s;const a={};for(let d=0;d<t;d++){n=e[d];let f;if(s=n,!Zj(n)&&(s=dM[(f=String(n)).toLowerCase()],s===void 0))throw new il(`Unknown adapter '${f}'`);if(s)break;a[f||"#"+d]=s}if(!s){const d=Object.entries(a).map(([i,S])=>`adapter ${i} `+(S===!1?"is not supported by the environment":"is not available in the build"));let f=t?d.length>1?`since :
`+d.map(fO).join(`
`):" "+fO(d[0]):"as no adapter specified";throw new il("There is no suitable adapter to dispatch the request "+f,"ERR_NOT_SUPPORT")}return s},adapters:dM};function gA(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new nw(null,e)}function mO(e){return gA(e),e.headers=_0.from(e.headers),e.data=mA.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),hB.getAdapter(e.adapter||JI.adapter)(e).then(function(s){return gA(e),s.data=mA.call(e,e.transformResponse,s),s.headers=_0.from(s.headers),s},function(s){return nB(s)||(gA(e),s&&s.response&&(s.response.data=mA.call(e,e.transformResponse,s.response),s.response.headers=_0.from(s.response.headers))),Promise.reject(s)})}const uB="1.10.0",B2={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{B2[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const gO={};B2.transitional=function(t,n,s){function a(d,f){return"[Axios v"+uB+"] Transitional option '"+d+"'"+f+(s?". "+s:"")}return(d,f,i)=>{if(t===!1)throw new il(a(f," has been removed"+(n?" in "+n:"")),il.ERR_DEPRECATED);return n&&!gO[f]&&(gO[f]=!0,console.warn(a(f," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(d,f,i):!0}};B2.spelling=function(t){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function Kj(e,t,n){if(typeof e!="object")throw new il("options must be an object",il.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let a=s.length;for(;a-- >0;){const d=s[a],f=t[d];if(f){const i=e[d],S=i===void 0||f(i,d,e);if(S!==!0)throw new il("option "+d+" must be "+S,il.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new il("Unknown option "+d,il.ERR_BAD_OPTION)}}const YC={assertOptions:Kj,validators:B2},i_=YC.validators;class bE{constructor(t){this.defaults=t||{},this.interceptors={request:new aO,response:new aO}}async request(t,n){try{return await this._request(t,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const d=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?d&&!String(s.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+d):s.stack=d}catch{}}throw s}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=lb(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:d}=n;s!==void 0&&YC.assertOptions(s,{silentJSONParsing:i_.transitional(i_.boolean),forcedJSONParsing:i_.transitional(i_.boolean),clarifyTimeoutError:i_.transitional(i_.boolean)},!1),a!=null&&(en.isFunction(a)?n.paramsSerializer={serialize:a}:YC.assertOptions(a,{encode:i_.function,serialize:i_.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),YC.assertOptions(n,{baseUrl:i_.spelling("baseURL"),withXsrfToken:i_.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let f=d&&en.merge(d.common,d[n.method]);d&&en.forEach(["delete","get","head","post","put","patch","common"],Q=>{delete d[Q]}),n.headers=_0.concat(f,d);const i=[];let S=!0;this.interceptors.request.forEach(function(te){typeof te.runWhen=="function"&&te.runWhen(n)===!1||(S=S&&te.synchronous,i.unshift(te.fulfilled,te.rejected))});const E=[];this.interceptors.response.forEach(function(te){E.push(te.fulfilled,te.rejected)});let L,F=0,G;if(!S){const Q=[mO.bind(this),void 0];for(Q.unshift.apply(Q,i),Q.push.apply(Q,E),G=Q.length,L=Promise.resolve(n);F<G;)L=L.then(Q[F++],Q[F++]);return L}G=i.length;let q=n;for(F=0;F<G;){const Q=i[F++],te=i[F++];try{q=Q(q)}catch(he){te.call(this,he);break}}try{L=mO.call(this,q)}catch(Q){return Promise.reject(Q)}for(F=0,G=E.length;F<G;)L=L.then(E[F++],E[F++]);return L}getUri(t){t=lb(this.defaults,t);const n=oB(t.baseURL,t.url,t.allowAbsoluteUrls);return tB(n,t.params,t.paramsSerializer)}}en.forEach(["delete","get","head","options"],function(t){bE.prototype[t]=function(n,s){return this.request(lb(s||{},{method:t,url:n,data:(s||{}).data}))}});en.forEach(["post","put","patch"],function(t){function n(s){return function(d,f,i){return this.request(lb(i||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:d,data:f}))}}bE.prototype[t]=n(),bE.prototype[t+"Form"]=n(!0)});const XC=bE;class eL{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(d){n=d});const s=this;this.promise.then(a=>{if(!s._listeners)return;let d=s._listeners.length;for(;d-- >0;)s._listeners[d](a);s._listeners=null}),this.promise.then=a=>{let d;const f=new Promise(i=>{s.subscribe(i),d=i}).then(a);return f.cancel=function(){s.unsubscribe(d)},f},t(function(d,f,i){s.reason||(s.reason=new nw(d,f,i),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=s=>{t.abort(s)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new eL(function(a){t=a}),cancel:t}}}const Qj=eL;function Jj(e){return function(n){return e.apply(null,n)}}function eH(e){return en.isObject(e)&&e.isAxiosError===!0}const pM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pM).forEach(([e,t])=>{pM[t]=e});const tH=pM;function dB(e){const t=new XC(e),n=W3(XC.prototype.request,t);return en.extend(n,XC.prototype,t,{allOwnKeys:!0}),en.extend(n,t,null,{allOwnKeys:!0}),n.create=function(a){return dB(lb(e,a))},n}const Fd=dB(JI);Fd.Axios=XC;Fd.CanceledError=nw;Fd.CancelToken=Qj;Fd.isCancel=nB;Fd.VERSION=uB;Fd.toFormData=O2;Fd.AxiosError=il;Fd.Cancel=Fd.CanceledError;Fd.all=function(t){return Promise.all(t)};Fd.spread=Jj;Fd.isAxiosError=eH;Fd.mergeConfig=lb;Fd.AxiosHeaders=_0;Fd.formToJSON=e=>rB(en.isHTMLForm(e)?new FormData(e):e);Fd.getAdapter=hB.getAdapter;Fd.HttpStatusCode=tH;Fd.default=Fd;const iH=Fd,Go=iH.create({baseURL:window.location.origin,timeout:3e5,headers:{"Content-Type":"application/json","x-csrf-token":Liferay.authToken}});var og=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function bC(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pB={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(n){e.exports=n()})(function(){return function n(s,a,d){function f(E,L){if(!a[E]){if(!s[E]){var F=typeof bC=="function"&&bC;if(!L&&F)return F(E,!0);if(i)return i(E,!0);var G=new Error("Cannot find module '"+E+"'");throw G.code="MODULE_NOT_FOUND",G}var q=a[E]={exports:{}};s[E][0].call(q.exports,function(Q){var te=s[E][1][Q];return f(te||Q)},q,q.exports,n,s,a,d)}return a[E].exports}for(var i=typeof bC=="function"&&bC,S=0;S<d.length;S++)f(d[S]);return f}({1:[function(n,s,a){var d=n("./utils"),f=n("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(S){for(var E,L,F,G,q,Q,te,he=[],fe=0,le=S.length,Se=le,ke=d.getTypeOf(S)!=="string";fe<S.length;)Se=le-fe,F=ke?(E=S[fe++],L=fe<le?S[fe++]:0,fe<le?S[fe++]:0):(E=S.charCodeAt(fe++),L=fe<le?S.charCodeAt(fe++):0,fe<le?S.charCodeAt(fe++):0),G=E>>2,q=(3&E)<<4|L>>4,Q=1<Se?(15&L)<<2|F>>6:64,te=2<Se?63&F:64,he.push(i.charAt(G)+i.charAt(q)+i.charAt(Q)+i.charAt(te));return he.join("")},a.decode=function(S){var E,L,F,G,q,Q,te=0,he=0,fe="data:";if(S.substr(0,fe.length)===fe)throw new Error("Invalid base64 input, it looks like a data url.");var le,Se=3*(S=S.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(S.charAt(S.length-1)===i.charAt(64)&&Se--,S.charAt(S.length-2)===i.charAt(64)&&Se--,Se%1!=0)throw new Error("Invalid base64 input, bad content length.");for(le=f.uint8array?new Uint8Array(0|Se):new Array(0|Se);te<S.length;)E=i.indexOf(S.charAt(te++))<<2|(G=i.indexOf(S.charAt(te++)))>>4,L=(15&G)<<4|(q=i.indexOf(S.charAt(te++)))>>2,F=(3&q)<<6|(Q=i.indexOf(S.charAt(te++))),le[he++]=E,q!==64&&(le[he++]=L),Q!==64&&(le[he++]=F);return le}},{"./support":30,"./utils":32}],2:[function(n,s,a){var d=n("./external"),f=n("./stream/DataWorker"),i=n("./stream/Crc32Probe"),S=n("./stream/DataLengthProbe");function E(L,F,G,q,Q){this.compressedSize=L,this.uncompressedSize=F,this.crc32=G,this.compression=q,this.compressedContent=Q}E.prototype={getContentWorker:function(){var L=new f(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new S("data_length")),F=this;return L.on("end",function(){if(this.streamInfo.data_length!==F.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),L},getCompressedWorker:function(){return new f(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},E.createWorkerFrom=function(L,F,G){return L.pipe(new i).pipe(new S("uncompressedSize")).pipe(F.compressWorker(G)).pipe(new S("compressedSize")).withStreamInfo("compression",F)},s.exports=E},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,s,a){var d=n("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},a.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,s,a){var d=n("./utils"),f=function(){for(var i,S=[],E=0;E<256;E++){i=E;for(var L=0;L<8;L++)i=1&i?3988292384^i>>>1:i>>>1;S[E]=i}return S}();s.exports=function(i,S){return i!==void 0&&i.length?d.getTypeOf(i)!=="string"?function(E,L,F,G){var q=f,Q=G+F;E^=-1;for(var te=G;te<Q;te++)E=E>>>8^q[255&(E^L[te])];return-1^E}(0|S,i,i.length,0):function(E,L,F,G){var q=f,Q=G+F;E^=-1;for(var te=G;te<Q;te++)E=E>>>8^q[255&(E^L.charCodeAt(te))];return-1^E}(0|S,i,i.length,0):0}},{"./utils":32}],5:[function(n,s,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(n,s,a){var d=null;d=typeof Promise<"u"?Promise:n("lie"),s.exports={Promise:d}},{lie:37}],7:[function(n,s,a){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",f=n("pako"),i=n("./utils"),S=n("./stream/GenericWorker"),E=d?"uint8array":"array";function L(F,G){S.call(this,"FlateWorker/"+F),this._pako=null,this._pakoAction=F,this._pakoOptions=G,this.meta={}}a.magic="\b\0",i.inherits(L,S),L.prototype.processChunk=function(F){this.meta=F.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(E,F.data),!1)},L.prototype.flush=function(){S.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},L.prototype.cleanUp=function(){S.prototype.cleanUp.call(this),this._pako=null},L.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var F=this;this._pako.onData=function(G){F.push({data:G,meta:F.meta})}},a.compressWorker=function(F){return new L("Deflate",F)},a.uncompressWorker=function(){return new L("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,s,a){function d(q,Q){var te,he="";for(te=0;te<Q;te++)he+=String.fromCharCode(255&q),q>>>=8;return he}function f(q,Q,te,he,fe,le){var Se,ke,Ee=q.file,Ie=q.compression,He=le!==E.utf8encode,Ye=i.transformTo("string",le(Ee.name)),lt=i.transformTo("string",E.utf8encode(Ee.name)),Pt=Ee.comment,At=i.transformTo("string",le(Pt)),ht=i.transformTo("string",E.utf8encode(Pt)),Ot=lt.length!==Ee.name.length,Ae=ht.length!==Pt.length,mt="",bt="",Dt="",Je=Ee.dir,dt=Ee.date,ui={crc32:0,compressedSize:0,uncompressedSize:0};Q&&!te||(ui.crc32=q.crc32,ui.compressedSize=q.compressedSize,ui.uncompressedSize=q.uncompressedSize);var Vt=0;Q&&(Vt|=8),He||!Ot&&!Ae||(Vt|=2048);var ei=0,ur=0;Je&&(ei|=16),fe==="UNIX"?(ur=798,ei|=function(Kt,Ui){var rr=Kt;return Kt||(rr=Ui?16893:33204),(65535&rr)<<16}(Ee.unixPermissions,Je)):(ur=20,ei|=function(Kt){return 63&(Kt||0)}(Ee.dosPermissions)),Se=dt.getUTCHours(),Se<<=6,Se|=dt.getUTCMinutes(),Se<<=5,Se|=dt.getUTCSeconds()/2,ke=dt.getUTCFullYear()-1980,ke<<=4,ke|=dt.getUTCMonth()+1,ke<<=5,ke|=dt.getUTCDate(),Ot&&(bt=d(1,1)+d(L(Ye),4)+lt,mt+="up"+d(bt.length,2)+bt),Ae&&(Dt=d(1,1)+d(L(At),4)+ht,mt+="uc"+d(Dt.length,2)+Dt);var Zt="";return Zt+=`
\0`,Zt+=d(Vt,2),Zt+=Ie.magic,Zt+=d(Se,2),Zt+=d(ke,2),Zt+=d(ui.crc32,4),Zt+=d(ui.compressedSize,4),Zt+=d(ui.uncompressedSize,4),Zt+=d(Ye.length,2),Zt+=d(mt.length,2),{fileRecord:F.LOCAL_FILE_HEADER+Zt+Ye+mt,dirRecord:F.CENTRAL_FILE_HEADER+d(ur,2)+Zt+d(At.length,2)+"\0\0\0\0"+d(ei,4)+d(he,4)+Ye+mt+At}}var i=n("../utils"),S=n("../stream/GenericWorker"),E=n("../utf8"),L=n("../crc32"),F=n("../signature");function G(q,Q,te,he){S.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=Q,this.zipPlatform=te,this.encodeFileName=he,this.streamFiles=q,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(G,S),G.prototype.push=function(q){var Q=q.meta.percent||0,te=this.entriesCount,he=this._sources.length;this.accumulate?this.contentBuffer.push(q):(this.bytesWritten+=q.data.length,S.prototype.push.call(this,{data:q.data,meta:{currentFile:this.currentFile,percent:te?(Q+100*(te-he-1))/te:100}}))},G.prototype.openedSource=function(q){this.currentSourceOffset=this.bytesWritten,this.currentFile=q.file.name;var Q=this.streamFiles&&!q.file.dir;if(Q){var te=f(q,Q,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:te.fileRecord,meta:{percent:0}})}else this.accumulate=!0},G.prototype.closedSource=function(q){this.accumulate=!1;var Q=this.streamFiles&&!q.file.dir,te=f(q,Q,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(te.dirRecord),Q)this.push({data:function(he){return F.DATA_DESCRIPTOR+d(he.crc32,4)+d(he.compressedSize,4)+d(he.uncompressedSize,4)}(q),meta:{percent:100}});else for(this.push({data:te.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},G.prototype.flush=function(){for(var q=this.bytesWritten,Q=0;Q<this.dirRecords.length;Q++)this.push({data:this.dirRecords[Q],meta:{percent:100}});var te=this.bytesWritten-q,he=function(fe,le,Se,ke,Ee){var Ie=i.transformTo("string",Ee(ke));return F.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(fe,2)+d(fe,2)+d(le,4)+d(Se,4)+d(Ie.length,2)+Ie}(this.dirRecords.length,te,q,this.zipComment,this.encodeFileName);this.push({data:he,meta:{percent:100}})},G.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},G.prototype.registerPrevious=function(q){this._sources.push(q);var Q=this;return q.on("data",function(te){Q.processChunk(te)}),q.on("end",function(){Q.closedSource(Q.previous.streamInfo),Q._sources.length?Q.prepareNextSource():Q.end()}),q.on("error",function(te){Q.error(te)}),this},G.prototype.resume=function(){return!!S.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},G.prototype.error=function(q){var Q=this._sources;if(!S.prototype.error.call(this,q))return!1;for(var te=0;te<Q.length;te++)try{Q[te].error(q)}catch{}return!0},G.prototype.lock=function(){S.prototype.lock.call(this);for(var q=this._sources,Q=0;Q<q.length;Q++)q[Q].lock()},s.exports=G},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,s,a){var d=n("../compressions"),f=n("./ZipFileWorker");a.generateWorker=function(i,S,E){var L=new f(S.streamFiles,E,S.platform,S.encodeFileName),F=0;try{i.forEach(function(G,q){F++;var Q=function(le,Se){var ke=le||Se,Ee=d[ke];if(!Ee)throw new Error(ke+" is not a valid compression method !");return Ee}(q.options.compression,S.compression),te=q.options.compressionOptions||S.compressionOptions||{},he=q.dir,fe=q.date;q._compressWorker(Q,te).withStreamInfo("file",{name:G,dir:he,date:fe,comment:q.comment||"",unixPermissions:q.unixPermissions,dosPermissions:q.dosPermissions}).pipe(L)}),L.entriesCount=F}catch(G){L.error(G)}return L}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,s,a){function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var f=new d;for(var i in this)typeof this[i]!="function"&&(f[i]=this[i]);return f}}(d.prototype=n("./object")).loadAsync=n("./load"),d.support=n("./support"),d.defaults=n("./defaults"),d.version="3.10.1",d.loadAsync=function(f,i){return new d().loadAsync(f,i)},d.external=n("./external"),s.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,s,a){var d=n("./utils"),f=n("./external"),i=n("./utf8"),S=n("./zipEntries"),E=n("./stream/Crc32Probe"),L=n("./nodejsUtils");function F(G){return new f.Promise(function(q,Q){var te=G.decompressed.getContentWorker().pipe(new E);te.on("error",function(he){Q(he)}).on("end",function(){te.streamInfo.crc32!==G.decompressed.crc32?Q(new Error("Corrupted zip : CRC32 mismatch")):q()}).resume()})}s.exports=function(G,q){var Q=this;return q=d.extend(q||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),L.isNode&&L.isStream(G)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",G,!0,q.optimizedBinaryString,q.base64).then(function(te){var he=new S(q);return he.load(te),he}).then(function(te){var he=[f.Promise.resolve(te)],fe=te.files;if(q.checkCRC32)for(var le=0;le<fe.length;le++)he.push(F(fe[le]));return f.Promise.all(he)}).then(function(te){for(var he=te.shift(),fe=he.files,le=0;le<fe.length;le++){var Se=fe[le],ke=Se.fileNameStr,Ee=d.resolve(Se.fileNameStr);Q.file(Ee,Se.decompressed,{binary:!0,optimizedBinaryString:!0,date:Se.date,dir:Se.dir,comment:Se.fileCommentStr.length?Se.fileCommentStr:null,unixPermissions:Se.unixPermissions,dosPermissions:Se.dosPermissions,createFolders:q.createFolders}),Se.dir||(Q.file(Ee).unsafeOriginalName=ke)}return he.zipComment.length&&(Q.comment=he.zipComment),Q})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,s,a){var d=n("../utils"),f=n("../stream/GenericWorker");function i(S,E){f.call(this,"Nodejs stream input adapter for "+S),this._upstreamEnded=!1,this._bindStream(E)}d.inherits(i,f),i.prototype._bindStream=function(S){var E=this;(this._stream=S).pause(),S.on("data",function(L){E.push({data:L,meta:{percent:0}})}).on("error",function(L){E.isPaused?this.generatedError=L:E.error(L)}).on("end",function(){E.isPaused?E._upstreamEnded=!0:E.end()})},i.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,s,a){var d=n("readable-stream").Readable;function f(i,S,E){d.call(this,S),this._helper=i;var L=this;i.on("data",function(F,G){L.push(F)||L._helper.pause(),E&&E(G)}).on("error",function(F){L.emit("error",F)}).on("end",function(){L.push(null)})}n("../utils").inherits(f,d),f.prototype._read=function(){this._helper.resume()},s.exports=f},{"../utils":32,"readable-stream":16}],14:[function(n,s,a){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(d,f){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(d,f);if(typeof d=="number")throw new Error('The "data" argument must not be a number');return new Buffer(d,f)},allocBuffer:function(d){if(Buffer.alloc)return Buffer.alloc(d);var f=new Buffer(d);return f.fill(0),f},isBuffer:function(d){return Buffer.isBuffer(d)},isStream:function(d){return d&&typeof d.on=="function"&&typeof d.pause=="function"&&typeof d.resume=="function"}}},{}],15:[function(n,s,a){function d(Ee,Ie,He){var Ye,lt=i.getTypeOf(Ie),Pt=i.extend(He||{},L);Pt.date=Pt.date||new Date,Pt.compression!==null&&(Pt.compression=Pt.compression.toUpperCase()),typeof Pt.unixPermissions=="string"&&(Pt.unixPermissions=parseInt(Pt.unixPermissions,8)),Pt.unixPermissions&&16384&Pt.unixPermissions&&(Pt.dir=!0),Pt.dosPermissions&&16&Pt.dosPermissions&&(Pt.dir=!0),Pt.dir&&(Ee=fe(Ee)),Pt.createFolders&&(Ye=he(Ee))&&le.call(this,Ye,!0);var At=lt==="string"&&Pt.binary===!1&&Pt.base64===!1;He&&He.binary!==void 0||(Pt.binary=!At),(Ie instanceof F&&Ie.uncompressedSize===0||Pt.dir||!Ie||Ie.length===0)&&(Pt.base64=!1,Pt.binary=!0,Ie="",Pt.compression="STORE",lt="string");var ht=null;ht=Ie instanceof F||Ie instanceof S?Ie:Q.isNode&&Q.isStream(Ie)?new te(Ee,Ie):i.prepareContent(Ee,Ie,Pt.binary,Pt.optimizedBinaryString,Pt.base64);var Ot=new G(Ee,ht,Pt);this.files[Ee]=Ot}var f=n("./utf8"),i=n("./utils"),S=n("./stream/GenericWorker"),E=n("./stream/StreamHelper"),L=n("./defaults"),F=n("./compressedObject"),G=n("./zipObject"),q=n("./generate"),Q=n("./nodejsUtils"),te=n("./nodejs/NodejsStreamInputAdapter"),he=function(Ee){Ee.slice(-1)==="/"&&(Ee=Ee.substring(0,Ee.length-1));var Ie=Ee.lastIndexOf("/");return 0<Ie?Ee.substring(0,Ie):""},fe=function(Ee){return Ee.slice(-1)!=="/"&&(Ee+="/"),Ee},le=function(Ee,Ie){return Ie=Ie!==void 0?Ie:L.createFolders,Ee=fe(Ee),this.files[Ee]||d.call(this,Ee,null,{dir:!0,createFolders:Ie}),this.files[Ee]};function Se(Ee){return Object.prototype.toString.call(Ee)==="[object RegExp]"}var ke={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(Ee){var Ie,He,Ye;for(Ie in this.files)Ye=this.files[Ie],(He=Ie.slice(this.root.length,Ie.length))&&Ie.slice(0,this.root.length)===this.root&&Ee(He,Ye)},filter:function(Ee){var Ie=[];return this.forEach(function(He,Ye){Ee(He,Ye)&&Ie.push(Ye)}),Ie},file:function(Ee,Ie,He){if(arguments.length!==1)return Ee=this.root+Ee,d.call(this,Ee,Ie,He),this;if(Se(Ee)){var Ye=Ee;return this.filter(function(Pt,At){return!At.dir&&Ye.test(Pt)})}var lt=this.files[this.root+Ee];return lt&&!lt.dir?lt:null},folder:function(Ee){if(!Ee)return this;if(Se(Ee))return this.filter(function(lt,Pt){return Pt.dir&&Ee.test(lt)});var Ie=this.root+Ee,He=le.call(this,Ie),Ye=this.clone();return Ye.root=He.name,Ye},remove:function(Ee){Ee=this.root+Ee;var Ie=this.files[Ee];if(Ie||(Ee.slice(-1)!=="/"&&(Ee+="/"),Ie=this.files[Ee]),Ie&&!Ie.dir)delete this.files[Ee];else for(var He=this.filter(function(lt,Pt){return Pt.name.slice(0,Ee.length)===Ee}),Ye=0;Ye<He.length;Ye++)delete this.files[He[Ye].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(Ee){var Ie,He={};try{if((He=i.extend(Ee||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:f.utf8encode})).type=He.type.toLowerCase(),He.compression=He.compression.toUpperCase(),He.type==="binarystring"&&(He.type="string"),!He.type)throw new Error("No output type specified.");i.checkSupport(He.type),He.platform!=="darwin"&&He.platform!=="freebsd"&&He.platform!=="linux"&&He.platform!=="sunos"||(He.platform="UNIX"),He.platform==="win32"&&(He.platform="DOS");var Ye=He.comment||this.comment||"";Ie=q.generateWorker(this,He,Ye)}catch(lt){(Ie=new S("error")).error(lt)}return new E(Ie,He.type||"string",He.mimeType)},generateAsync:function(Ee,Ie){return this.generateInternalStream(Ee).accumulate(Ie)},generateNodeStream:function(Ee,Ie){return(Ee=Ee||{}).type||(Ee.type="nodebuffer"),this.generateInternalStream(Ee).toNodejsStream(Ie)}};s.exports=ke},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,s,a){s.exports=n("stream")},{stream:void 0}],17:[function(n,s,a){var d=n("./DataReader");function f(i){d.call(this,i);for(var S=0;S<this.data.length;S++)i[S]=255&i[S]}n("../utils").inherits(f,d),f.prototype.byteAt=function(i){return this.data[this.zero+i]},f.prototype.lastIndexOfSignature=function(i){for(var S=i.charCodeAt(0),E=i.charCodeAt(1),L=i.charCodeAt(2),F=i.charCodeAt(3),G=this.length-4;0<=G;--G)if(this.data[G]===S&&this.data[G+1]===E&&this.data[G+2]===L&&this.data[G+3]===F)return G-this.zero;return-1},f.prototype.readAndCheckSignature=function(i){var S=i.charCodeAt(0),E=i.charCodeAt(1),L=i.charCodeAt(2),F=i.charCodeAt(3),G=this.readData(4);return S===G[0]&&E===G[1]&&L===G[2]&&F===G[3]},f.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var S=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,S},s.exports=f},{"../utils":32,"./DataReader":18}],18:[function(n,s,a){var d=n("../utils");function f(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}f.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var S,E=0;for(this.checkOffset(i),S=this.index+i-1;S>=this.index;S--)E=(E<<8)+this.byteAt(S);return this.index+=i,E},readString:function(i){return d.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},s.exports=f},{"../utils":32}],19:[function(n,s,a){var d=n("./Uint8ArrayReader");function f(i){d.call(this,i)}n("../utils").inherits(f,d),f.prototype.readData=function(i){this.checkOffset(i);var S=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,S},s.exports=f},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,s,a){var d=n("./DataReader");function f(i){d.call(this,i)}n("../utils").inherits(f,d),f.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},f.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},f.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},f.prototype.readData=function(i){this.checkOffset(i);var S=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,S},s.exports=f},{"../utils":32,"./DataReader":18}],21:[function(n,s,a){var d=n("./ArrayReader");function f(i){d.call(this,i)}n("../utils").inherits(f,d),f.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var S=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,S},s.exports=f},{"../utils":32,"./ArrayReader":17}],22:[function(n,s,a){var d=n("../utils"),f=n("../support"),i=n("./ArrayReader"),S=n("./StringReader"),E=n("./NodeBufferReader"),L=n("./Uint8ArrayReader");s.exports=function(F){var G=d.getTypeOf(F);return d.checkSupport(G),G!=="string"||f.uint8array?G==="nodebuffer"?new E(F):f.uint8array?new L(d.transformTo("uint8array",F)):new i(d.transformTo("array",F)):new S(F)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,s,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,s,a){var d=n("./GenericWorker"),f=n("../utils");function i(S){d.call(this,"ConvertWorker to "+S),this.destType=S}f.inherits(i,d),i.prototype.processChunk=function(S){this.push({data:f.transformTo(this.destType,S.data),meta:S.meta})},s.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(n,s,a){var d=n("./GenericWorker"),f=n("../crc32");function i(){d.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(i,d),i.prototype.processChunk=function(S){this.streamInfo.crc32=f(S.data,this.streamInfo.crc32||0),this.push(S)},s.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,s,a){var d=n("../utils"),f=n("./GenericWorker");function i(S){f.call(this,"DataLengthProbe for "+S),this.propName=S,this.withStreamInfo(S,0)}d.inherits(i,f),i.prototype.processChunk=function(S){if(S){var E=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=E+S.data.length}f.prototype.processChunk.call(this,S)},s.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(n,s,a){var d=n("../utils"),f=n("./GenericWorker");function i(S){f.call(this,"DataWorker");var E=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,S.then(function(L){E.dataIsReady=!0,E.data=L,E.max=L&&L.length||0,E.type=d.getTypeOf(L),E.isPaused||E._tickAndRepeat()},function(L){E.error(L)})}d.inherits(i,f),i.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var S=null,E=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":S=this.data.substring(this.index,E);break;case"uint8array":S=this.data.subarray(this.index,E);break;case"array":case"nodebuffer":S=this.data.slice(this.index,E)}return this.index=E,this.push({data:S,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(n,s,a){function d(f){this.name=f||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(f){this.emit("data",f)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(f){return!this.isFinished&&(this.isPaused?this.generatedError=f:(this.isFinished=!0,this.emit("error",f),this.previous&&this.previous.error(f),this.cleanUp()),!0)},on:function(f,i){return this._listeners[f].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(f,i){if(this._listeners[f])for(var S=0;S<this._listeners[f].length;S++)this._listeners[f][S].call(this,i)},pipe:function(f){return f.registerPrevious(this)},registerPrevious:function(f){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=f.streamInfo,this.mergeStreamInfo(),this.previous=f;var i=this;return f.on("data",function(S){i.processChunk(S)}),f.on("end",function(){i.end()}),f.on("error",function(S){i.error(S)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var f=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),f=!0),this.previous&&this.previous.resume(),!f},flush:function(){},processChunk:function(f){this.push(f)},withStreamInfo:function(f,i){return this.extraStreamInfo[f]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var f in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,f)&&(this.streamInfo[f]=this.extraStreamInfo[f])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var f="Worker "+this.name;return this.previous?this.previous+" -> "+f:f}},s.exports=d},{}],29:[function(n,s,a){var d=n("../utils"),f=n("./ConvertWorker"),i=n("./GenericWorker"),S=n("../base64"),E=n("../support"),L=n("../external"),F=null;if(E.nodestream)try{F=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function G(Q,te){return new L.Promise(function(he,fe){var le=[],Se=Q._internalType,ke=Q._outputType,Ee=Q._mimeType;Q.on("data",function(Ie,He){le.push(Ie),te&&te(He)}).on("error",function(Ie){le=[],fe(Ie)}).on("end",function(){try{var Ie=function(He,Ye,lt){switch(He){case"blob":return d.newBlob(d.transformTo("arraybuffer",Ye),lt);case"base64":return S.encode(Ye);default:return d.transformTo(He,Ye)}}(ke,function(He,Ye){var lt,Pt=0,At=null,ht=0;for(lt=0;lt<Ye.length;lt++)ht+=Ye[lt].length;switch(He){case"string":return Ye.join("");case"array":return Array.prototype.concat.apply([],Ye);case"uint8array":for(At=new Uint8Array(ht),lt=0;lt<Ye.length;lt++)At.set(Ye[lt],Pt),Pt+=Ye[lt].length;return At;case"nodebuffer":return Buffer.concat(Ye);default:throw new Error("concat : unsupported type '"+He+"'")}}(Se,le),Ee);he(Ie)}catch(He){fe(He)}le=[]}).resume()})}function q(Q,te,he){var fe=te;switch(te){case"blob":case"arraybuffer":fe="uint8array";break;case"base64":fe="string"}try{this._internalType=fe,this._outputType=te,this._mimeType=he,d.checkSupport(fe),this._worker=Q.pipe(new f(fe)),Q.lock()}catch(le){this._worker=new i("error"),this._worker.error(le)}}q.prototype={accumulate:function(Q){return G(this,Q)},on:function(Q,te){var he=this;return Q==="data"?this._worker.on(Q,function(fe){te.call(he,fe.data,fe.meta)}):this._worker.on(Q,function(){d.delay(te,arguments,he)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(Q){if(d.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new F(this,{objectMode:this._outputType!=="nodebuffer"},Q)}},s.exports=q},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,s,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var d=new ArrayBuffer(0);try{a.blob=new Blob([d],{type:"application/zip"}).size===0}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);f.append(d),a.blob=f.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!n("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(n,s,a){for(var d=n("./utils"),f=n("./support"),i=n("./nodejsUtils"),S=n("./stream/GenericWorker"),E=new Array(256),L=0;L<256;L++)E[L]=252<=L?6:248<=L?5:240<=L?4:224<=L?3:192<=L?2:1;E[254]=E[254]=1;function F(){S.call(this,"utf-8 decode"),this.leftOver=null}function G(){S.call(this,"utf-8 encode")}a.utf8encode=function(q){return f.nodebuffer?i.newBufferFrom(q,"utf-8"):function(Q){var te,he,fe,le,Se,ke=Q.length,Ee=0;for(le=0;le<ke;le++)(64512&(he=Q.charCodeAt(le)))==55296&&le+1<ke&&(64512&(fe=Q.charCodeAt(le+1)))==56320&&(he=65536+(he-55296<<10)+(fe-56320),le++),Ee+=he<128?1:he<2048?2:he<65536?3:4;for(te=f.uint8array?new Uint8Array(Ee):new Array(Ee),le=Se=0;Se<Ee;le++)(64512&(he=Q.charCodeAt(le)))==55296&&le+1<ke&&(64512&(fe=Q.charCodeAt(le+1)))==56320&&(he=65536+(he-55296<<10)+(fe-56320),le++),he<128?te[Se++]=he:(he<2048?te[Se++]=192|he>>>6:(he<65536?te[Se++]=224|he>>>12:(te[Se++]=240|he>>>18,te[Se++]=128|he>>>12&63),te[Se++]=128|he>>>6&63),te[Se++]=128|63&he);return te}(q)},a.utf8decode=function(q){return f.nodebuffer?d.transformTo("nodebuffer",q).toString("utf-8"):function(Q){var te,he,fe,le,Se=Q.length,ke=new Array(2*Se);for(te=he=0;te<Se;)if((fe=Q[te++])<128)ke[he++]=fe;else if(4<(le=E[fe]))ke[he++]=65533,te+=le-1;else{for(fe&=le===2?31:le===3?15:7;1<le&&te<Se;)fe=fe<<6|63&Q[te++],le--;1<le?ke[he++]=65533:fe<65536?ke[he++]=fe:(fe-=65536,ke[he++]=55296|fe>>10&1023,ke[he++]=56320|1023&fe)}return ke.length!==he&&(ke.subarray?ke=ke.subarray(0,he):ke.length=he),d.applyFromCharCode(ke)}(q=d.transformTo(f.uint8array?"uint8array":"array",q))},d.inherits(F,S),F.prototype.processChunk=function(q){var Q=d.transformTo(f.uint8array?"uint8array":"array",q.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var te=Q;(Q=new Uint8Array(te.length+this.leftOver.length)).set(this.leftOver,0),Q.set(te,this.leftOver.length)}else Q=this.leftOver.concat(Q);this.leftOver=null}var he=function(le,Se){var ke;for((Se=Se||le.length)>le.length&&(Se=le.length),ke=Se-1;0<=ke&&(192&le[ke])==128;)ke--;return ke<0||ke===0?Se:ke+E[le[ke]]>Se?ke:Se}(Q),fe=Q;he!==Q.length&&(f.uint8array?(fe=Q.subarray(0,he),this.leftOver=Q.subarray(he,Q.length)):(fe=Q.slice(0,he),this.leftOver=Q.slice(he,Q.length))),this.push({data:a.utf8decode(fe),meta:q.meta})},F.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=F,d.inherits(G,S),G.prototype.processChunk=function(q){this.push({data:a.utf8encode(q.data),meta:q.meta})},a.Utf8EncodeWorker=G},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,s,a){var d=n("./support"),f=n("./base64"),i=n("./nodejsUtils"),S=n("./external");function E(te){return te}function L(te,he){for(var fe=0;fe<te.length;++fe)he[fe]=255&te.charCodeAt(fe);return he}n("setimmediate"),a.newBlob=function(te,he){a.checkSupport("blob");try{return new Blob([te],{type:he})}catch{try{var fe=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return fe.append(te),fe.getBlob(he)}catch{throw new Error("Bug : can't construct the Blob.")}}};var F={stringifyByChunk:function(te,he,fe){var le=[],Se=0,ke=te.length;if(ke<=fe)return String.fromCharCode.apply(null,te);for(;Se<ke;)he==="array"||he==="nodebuffer"?le.push(String.fromCharCode.apply(null,te.slice(Se,Math.min(Se+fe,ke)))):le.push(String.fromCharCode.apply(null,te.subarray(Se,Math.min(Se+fe,ke)))),Se+=fe;return le.join("")},stringifyByChar:function(te){for(var he="",fe=0;fe<te.length;fe++)he+=String.fromCharCode(te[fe]);return he},applyCanBeUsed:{uint8array:function(){try{return d.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return d.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function G(te){var he=65536,fe=a.getTypeOf(te),le=!0;if(fe==="uint8array"?le=F.applyCanBeUsed.uint8array:fe==="nodebuffer"&&(le=F.applyCanBeUsed.nodebuffer),le)for(;1<he;)try{return F.stringifyByChunk(te,fe,he)}catch{he=Math.floor(he/2)}return F.stringifyByChar(te)}function q(te,he){for(var fe=0;fe<te.length;fe++)he[fe]=te[fe];return he}a.applyFromCharCode=G;var Q={};Q.string={string:E,array:function(te){return L(te,new Array(te.length))},arraybuffer:function(te){return Q.string.uint8array(te).buffer},uint8array:function(te){return L(te,new Uint8Array(te.length))},nodebuffer:function(te){return L(te,i.allocBuffer(te.length))}},Q.array={string:G,array:E,arraybuffer:function(te){return new Uint8Array(te).buffer},uint8array:function(te){return new Uint8Array(te)},nodebuffer:function(te){return i.newBufferFrom(te)}},Q.arraybuffer={string:function(te){return G(new Uint8Array(te))},array:function(te){return q(new Uint8Array(te),new Array(te.byteLength))},arraybuffer:E,uint8array:function(te){return new Uint8Array(te)},nodebuffer:function(te){return i.newBufferFrom(new Uint8Array(te))}},Q.uint8array={string:G,array:function(te){return q(te,new Array(te.length))},arraybuffer:function(te){return te.buffer},uint8array:E,nodebuffer:function(te){return i.newBufferFrom(te)}},Q.nodebuffer={string:G,array:function(te){return q(te,new Array(te.length))},arraybuffer:function(te){return Q.nodebuffer.uint8array(te).buffer},uint8array:function(te){return q(te,new Uint8Array(te.length))},nodebuffer:E},a.transformTo=function(te,he){if(he=he||"",!te)return he;a.checkSupport(te);var fe=a.getTypeOf(he);return Q[fe][te](he)},a.resolve=function(te){for(var he=te.split("/"),fe=[],le=0;le<he.length;le++){var Se=he[le];Se==="."||Se===""&&le!==0&&le!==he.length-1||(Se===".."?fe.pop():fe.push(Se))}return fe.join("/")},a.getTypeOf=function(te){return typeof te=="string"?"string":Object.prototype.toString.call(te)==="[object Array]"?"array":d.nodebuffer&&i.isBuffer(te)?"nodebuffer":d.uint8array&&te instanceof Uint8Array?"uint8array":d.arraybuffer&&te instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(te){if(!d[te.toLowerCase()])throw new Error(te+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(te){var he,fe,le="";for(fe=0;fe<(te||"").length;fe++)le+="\\x"+((he=te.charCodeAt(fe))<16?"0":"")+he.toString(16).toUpperCase();return le},a.delay=function(te,he,fe){setImmediate(function(){te.apply(fe||null,he||[])})},a.inherits=function(te,he){function fe(){}fe.prototype=he.prototype,te.prototype=new fe},a.extend=function(){var te,he,fe={};for(te=0;te<arguments.length;te++)for(he in arguments[te])Object.prototype.hasOwnProperty.call(arguments[te],he)&&fe[he]===void 0&&(fe[he]=arguments[te][he]);return fe},a.prepareContent=function(te,he,fe,le,Se){return S.Promise.resolve(he).then(function(ke){return d.blob&&(ke instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ke))!==-1)&&typeof FileReader<"u"?new S.Promise(function(Ee,Ie){var He=new FileReader;He.onload=function(Ye){Ee(Ye.target.result)},He.onerror=function(Ye){Ie(Ye.target.error)},He.readAsArrayBuffer(ke)}):ke}).then(function(ke){var Ee=a.getTypeOf(ke);return Ee?(Ee==="arraybuffer"?ke=a.transformTo("uint8array",ke):Ee==="string"&&(Se?ke=f.decode(ke):fe&&le!==!0&&(ke=function(Ie){return L(Ie,d.uint8array?new Uint8Array(Ie.length):new Array(Ie.length))}(ke))),ke):S.Promise.reject(new Error("Can't read the data of '"+te+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,s,a){var d=n("./reader/readerFor"),f=n("./utils"),i=n("./signature"),S=n("./zipEntry"),E=n("./support");function L(F){this.files=[],this.loadOptions=F}L.prototype={checkSignature:function(F){if(!this.reader.readAndCheckSignature(F)){this.reader.index-=4;var G=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(G)+", expected "+f.pretty(F)+")")}},isSignature:function(F,G){var q=this.reader.index;this.reader.setIndex(F);var Q=this.reader.readString(4)===G;return this.reader.setIndex(q),Q},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var F=this.reader.readData(this.zipCommentLength),G=E.uint8array?"uint8array":"array",q=f.transformTo(G,F);this.zipComment=this.loadOptions.decodeFileName(q)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var F,G,q,Q=this.zip64EndOfCentralSize-44;0<Q;)F=this.reader.readInt(2),G=this.reader.readInt(4),q=this.reader.readData(G),this.zip64ExtensibleData[F]={id:F,length:G,value:q}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var F,G;for(F=0;F<this.files.length;F++)G=this.files[F],this.reader.setIndex(G.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),G.readLocalPart(this.reader),G.handleUTF8(),G.processAttributes()},readCentralDir:function(){var F;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(F=new S({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(F);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var F=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(F<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(F);var G=F;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,(F=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(F),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var q=this.centralDirOffset+this.centralDirSize;this.zip64&&(q+=20,q+=12+this.zip64EndOfCentralSize);var Q=G-q;if(0<Q)this.isSignature(G,i.CENTRAL_FILE_HEADER)||(this.reader.zero=Q);else if(Q<0)throw new Error("Corrupted zip: missing "+Math.abs(Q)+" bytes.")},prepareReader:function(F){this.reader=d(F)},load:function(F){this.prepareReader(F),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=L},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,s,a){var d=n("./reader/readerFor"),f=n("./utils"),i=n("./compressedObject"),S=n("./crc32"),E=n("./utf8"),L=n("./compressions"),F=n("./support");function G(q,Q){this.options=q,this.loadOptions=Q}G.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(q){var Q,te;if(q.skip(22),this.fileNameLength=q.readInt(2),te=q.readInt(2),this.fileName=q.readData(this.fileNameLength),q.skip(te),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((Q=function(he){for(var fe in L)if(Object.prototype.hasOwnProperty.call(L,fe)&&L[fe].magic===he)return L[fe];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,Q,q.readData(this.compressedSize))},readCentralPart:function(q){this.versionMadeBy=q.readInt(2),q.skip(2),this.bitFlag=q.readInt(2),this.compressionMethod=q.readString(2),this.date=q.readDate(),this.crc32=q.readInt(4),this.compressedSize=q.readInt(4),this.uncompressedSize=q.readInt(4);var Q=q.readInt(2);if(this.extraFieldsLength=q.readInt(2),this.fileCommentLength=q.readInt(2),this.diskNumberStart=q.readInt(2),this.internalFileAttributes=q.readInt(2),this.externalFileAttributes=q.readInt(4),this.localHeaderOffset=q.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");q.skip(Q),this.readExtraFields(q),this.parseZIP64ExtraField(q),this.fileComment=q.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var q=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),q==0&&(this.dosPermissions=63&this.externalFileAttributes),q==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var q=d(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=q.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=q.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=q.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=q.readInt(4))}},readExtraFields:function(q){var Q,te,he,fe=q.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});q.index+4<fe;)Q=q.readInt(2),te=q.readInt(2),he=q.readData(te),this.extraFields[Q]={id:Q,length:te,value:he};q.setIndex(fe)},handleUTF8:function(){var q=F.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=E.utf8decode(this.fileName),this.fileCommentStr=E.utf8decode(this.fileComment);else{var Q=this.findExtraFieldUnicodePath();if(Q!==null)this.fileNameStr=Q;else{var te=f.transformTo(q,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(te)}var he=this.findExtraFieldUnicodeComment();if(he!==null)this.fileCommentStr=he;else{var fe=f.transformTo(q,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(fe)}}},findExtraFieldUnicodePath:function(){var q=this.extraFields[28789];if(q){var Q=d(q.value);return Q.readInt(1)!==1||S(this.fileName)!==Q.readInt(4)?null:E.utf8decode(Q.readData(q.length-5))}return null},findExtraFieldUnicodeComment:function(){var q=this.extraFields[25461];if(q){var Q=d(q.value);return Q.readInt(1)!==1||S(this.fileComment)!==Q.readInt(4)?null:E.utf8decode(Q.readData(q.length-5))}return null}},s.exports=G},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,s,a){function d(Q,te,he){this.name=Q,this.dir=he.dir,this.date=he.date,this.comment=he.comment,this.unixPermissions=he.unixPermissions,this.dosPermissions=he.dosPermissions,this._data=te,this._dataBinary=he.binary,this.options={compression:he.compression,compressionOptions:he.compressionOptions}}var f=n("./stream/StreamHelper"),i=n("./stream/DataWorker"),S=n("./utf8"),E=n("./compressedObject"),L=n("./stream/GenericWorker");d.prototype={internalStream:function(Q){var te=null,he="string";try{if(!Q)throw new Error("No output type specified.");var fe=(he=Q.toLowerCase())==="string"||he==="text";he!=="binarystring"&&he!=="text"||(he="string"),te=this._decompressWorker();var le=!this._dataBinary;le&&!fe&&(te=te.pipe(new S.Utf8EncodeWorker)),!le&&fe&&(te=te.pipe(new S.Utf8DecodeWorker))}catch(Se){(te=new L("error")).error(Se)}return new f(te,he,"")},async:function(Q,te){return this.internalStream(Q).accumulate(te)},nodeStream:function(Q,te){return this.internalStream(Q||"nodebuffer").toNodejsStream(te)},_compressWorker:function(Q,te){if(this._data instanceof E&&this._data.compression.magic===Q.magic)return this._data.getCompressedWorker();var he=this._decompressWorker();return this._dataBinary||(he=he.pipe(new S.Utf8EncodeWorker)),E.createWorkerFrom(he,Q,te)},_decompressWorker:function(){return this._data instanceof E?this._data.getContentWorker():this._data instanceof L?this._data:new i(this._data)}};for(var F=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],G=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},q=0;q<F.length;q++)d.prototype[F[q]]=G;s.exports=d},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,s,a){(function(d){var f,i,S=d.MutationObserver||d.WebKitMutationObserver;if(S){var E=0,L=new S(Q),F=d.document.createTextNode("");L.observe(F,{characterData:!0}),f=function(){F.data=E=++E%2}}else if(d.setImmediate||d.MessageChannel===void 0)f="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var te=d.document.createElement("script");te.onreadystatechange=function(){Q(),te.onreadystatechange=null,te.parentNode.removeChild(te),te=null},d.document.documentElement.appendChild(te)}:function(){setTimeout(Q,0)};else{var G=new d.MessageChannel;G.port1.onmessage=Q,f=function(){G.port2.postMessage(0)}}var q=[];function Q(){var te,he;i=!0;for(var fe=q.length;fe;){for(he=q,q=[],te=-1;++te<fe;)he[te]();fe=q.length}i=!1}s.exports=function(te){q.push(te)!==1||i||f()}}).call(this,typeof og<"u"?og:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,s,a){var d=n("immediate");function f(){}var i={},S=["REJECTED"],E=["FULFILLED"],L=["PENDING"];function F(fe){if(typeof fe!="function")throw new TypeError("resolver must be a function");this.state=L,this.queue=[],this.outcome=void 0,fe!==f&&te(this,fe)}function G(fe,le,Se){this.promise=fe,typeof le=="function"&&(this.onFulfilled=le,this.callFulfilled=this.otherCallFulfilled),typeof Se=="function"&&(this.onRejected=Se,this.callRejected=this.otherCallRejected)}function q(fe,le,Se){d(function(){var ke;try{ke=le(Se)}catch(Ee){return i.reject(fe,Ee)}ke===fe?i.reject(fe,new TypeError("Cannot resolve promise with itself")):i.resolve(fe,ke)})}function Q(fe){var le=fe&&fe.then;if(fe&&(typeof fe=="object"||typeof fe=="function")&&typeof le=="function")return function(){le.apply(fe,arguments)}}function te(fe,le){var Se=!1;function ke(He){Se||(Se=!0,i.reject(fe,He))}function Ee(He){Se||(Se=!0,i.resolve(fe,He))}var Ie=he(function(){le(Ee,ke)});Ie.status==="error"&&ke(Ie.value)}function he(fe,le){var Se={};try{Se.value=fe(le),Se.status="success"}catch(ke){Se.status="error",Se.value=ke}return Se}(s.exports=F).prototype.finally=function(fe){if(typeof fe!="function")return this;var le=this.constructor;return this.then(function(Se){return le.resolve(fe()).then(function(){return Se})},function(Se){return le.resolve(fe()).then(function(){throw Se})})},F.prototype.catch=function(fe){return this.then(null,fe)},F.prototype.then=function(fe,le){if(typeof fe!="function"&&this.state===E||typeof le!="function"&&this.state===S)return this;var Se=new this.constructor(f);return this.state!==L?q(Se,this.state===E?fe:le,this.outcome):this.queue.push(new G(Se,fe,le)),Se},G.prototype.callFulfilled=function(fe){i.resolve(this.promise,fe)},G.prototype.otherCallFulfilled=function(fe){q(this.promise,this.onFulfilled,fe)},G.prototype.callRejected=function(fe){i.reject(this.promise,fe)},G.prototype.otherCallRejected=function(fe){q(this.promise,this.onRejected,fe)},i.resolve=function(fe,le){var Se=he(Q,le);if(Se.status==="error")return i.reject(fe,Se.value);var ke=Se.value;if(ke)te(fe,ke);else{fe.state=E,fe.outcome=le;for(var Ee=-1,Ie=fe.queue.length;++Ee<Ie;)fe.queue[Ee].callFulfilled(le)}return fe},i.reject=function(fe,le){fe.state=S,fe.outcome=le;for(var Se=-1,ke=fe.queue.length;++Se<ke;)fe.queue[Se].callRejected(le);return fe},F.resolve=function(fe){return fe instanceof this?fe:i.resolve(new this(f),fe)},F.reject=function(fe){var le=new this(f);return i.reject(le,fe)},F.all=function(fe){var le=this;if(Object.prototype.toString.call(fe)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Se=fe.length,ke=!1;if(!Se)return this.resolve([]);for(var Ee=new Array(Se),Ie=0,He=-1,Ye=new this(f);++He<Se;)lt(fe[He],He);return Ye;function lt(Pt,At){le.resolve(Pt).then(function(ht){Ee[At]=ht,++Ie!==Se||ke||(ke=!0,i.resolve(Ye,Ee))},function(ht){ke||(ke=!0,i.reject(Ye,ht))})}},F.race=function(fe){var le=this;if(Object.prototype.toString.call(fe)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Se=fe.length,ke=!1;if(!Se)return this.resolve([]);for(var Ee=-1,Ie=new this(f);++Ee<Se;)He=fe[Ee],le.resolve(He).then(function(Ye){ke||(ke=!0,i.resolve(Ie,Ye))},function(Ye){ke||(ke=!0,i.reject(Ie,Ye))});var He;return Ie}},{immediate:36}],38:[function(n,s,a){var d={};(0,n("./lib/utils/common").assign)(d,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),s.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,s,a){var d=n("./zlib/deflate"),f=n("./utils/common"),i=n("./utils/strings"),S=n("./zlib/messages"),E=n("./zlib/zstream"),L=Object.prototype.toString,F=0,G=-1,q=0,Q=8;function te(fe){if(!(this instanceof te))return new te(fe);this.options=f.assign({level:G,method:Q,chunkSize:16384,windowBits:15,memLevel:8,strategy:q,to:""},fe||{});var le=this.options;le.raw&&0<le.windowBits?le.windowBits=-le.windowBits:le.gzip&&0<le.windowBits&&le.windowBits<16&&(le.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new E,this.strm.avail_out=0;var Se=d.deflateInit2(this.strm,le.level,le.method,le.windowBits,le.memLevel,le.strategy);if(Se!==F)throw new Error(S[Se]);if(le.header&&d.deflateSetHeader(this.strm,le.header),le.dictionary){var ke;if(ke=typeof le.dictionary=="string"?i.string2buf(le.dictionary):L.call(le.dictionary)==="[object ArrayBuffer]"?new Uint8Array(le.dictionary):le.dictionary,(Se=d.deflateSetDictionary(this.strm,ke))!==F)throw new Error(S[Se]);this._dict_set=!0}}function he(fe,le){var Se=new te(le);if(Se.push(fe,!0),Se.err)throw Se.msg||S[Se.err];return Se.result}te.prototype.push=function(fe,le){var Se,ke,Ee=this.strm,Ie=this.options.chunkSize;if(this.ended)return!1;ke=le===~~le?le:le===!0?4:0,typeof fe=="string"?Ee.input=i.string2buf(fe):L.call(fe)==="[object ArrayBuffer]"?Ee.input=new Uint8Array(fe):Ee.input=fe,Ee.next_in=0,Ee.avail_in=Ee.input.length;do{if(Ee.avail_out===0&&(Ee.output=new f.Buf8(Ie),Ee.next_out=0,Ee.avail_out=Ie),(Se=d.deflate(Ee,ke))!==1&&Se!==F)return this.onEnd(Se),!(this.ended=!0);Ee.avail_out!==0&&(Ee.avail_in!==0||ke!==4&&ke!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(f.shrinkBuf(Ee.output,Ee.next_out))):this.onData(f.shrinkBuf(Ee.output,Ee.next_out)))}while((0<Ee.avail_in||Ee.avail_out===0)&&Se!==1);return ke===4?(Se=d.deflateEnd(this.strm),this.onEnd(Se),this.ended=!0,Se===F):ke!==2||(this.onEnd(F),!(Ee.avail_out=0))},te.prototype.onData=function(fe){this.chunks.push(fe)},te.prototype.onEnd=function(fe){fe===F&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=fe,this.msg=this.strm.msg},a.Deflate=te,a.deflate=he,a.deflateRaw=function(fe,le){return(le=le||{}).raw=!0,he(fe,le)},a.gzip=function(fe,le){return(le=le||{}).gzip=!0,he(fe,le)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,s,a){var d=n("./zlib/inflate"),f=n("./utils/common"),i=n("./utils/strings"),S=n("./zlib/constants"),E=n("./zlib/messages"),L=n("./zlib/zstream"),F=n("./zlib/gzheader"),G=Object.prototype.toString;function q(te){if(!(this instanceof q))return new q(te);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},te||{});var he=this.options;he.raw&&0<=he.windowBits&&he.windowBits<16&&(he.windowBits=-he.windowBits,he.windowBits===0&&(he.windowBits=-15)),!(0<=he.windowBits&&he.windowBits<16)||te&&te.windowBits||(he.windowBits+=32),15<he.windowBits&&he.windowBits<48&&!(15&he.windowBits)&&(he.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new L,this.strm.avail_out=0;var fe=d.inflateInit2(this.strm,he.windowBits);if(fe!==S.Z_OK)throw new Error(E[fe]);this.header=new F,d.inflateGetHeader(this.strm,this.header)}function Q(te,he){var fe=new q(he);if(fe.push(te,!0),fe.err)throw fe.msg||E[fe.err];return fe.result}q.prototype.push=function(te,he){var fe,le,Se,ke,Ee,Ie,He=this.strm,Ye=this.options.chunkSize,lt=this.options.dictionary,Pt=!1;if(this.ended)return!1;le=he===~~he?he:he===!0?S.Z_FINISH:S.Z_NO_FLUSH,typeof te=="string"?He.input=i.binstring2buf(te):G.call(te)==="[object ArrayBuffer]"?He.input=new Uint8Array(te):He.input=te,He.next_in=0,He.avail_in=He.input.length;do{if(He.avail_out===0&&(He.output=new f.Buf8(Ye),He.next_out=0,He.avail_out=Ye),(fe=d.inflate(He,S.Z_NO_FLUSH))===S.Z_NEED_DICT&&lt&&(Ie=typeof lt=="string"?i.string2buf(lt):G.call(lt)==="[object ArrayBuffer]"?new Uint8Array(lt):lt,fe=d.inflateSetDictionary(this.strm,Ie)),fe===S.Z_BUF_ERROR&&Pt===!0&&(fe=S.Z_OK,Pt=!1),fe!==S.Z_STREAM_END&&fe!==S.Z_OK)return this.onEnd(fe),!(this.ended=!0);He.next_out&&(He.avail_out!==0&&fe!==S.Z_STREAM_END&&(He.avail_in!==0||le!==S.Z_FINISH&&le!==S.Z_SYNC_FLUSH)||(this.options.to==="string"?(Se=i.utf8border(He.output,He.next_out),ke=He.next_out-Se,Ee=i.buf2string(He.output,Se),He.next_out=ke,He.avail_out=Ye-ke,ke&&f.arraySet(He.output,He.output,Se,ke,0),this.onData(Ee)):this.onData(f.shrinkBuf(He.output,He.next_out)))),He.avail_in===0&&He.avail_out===0&&(Pt=!0)}while((0<He.avail_in||He.avail_out===0)&&fe!==S.Z_STREAM_END);return fe===S.Z_STREAM_END&&(le=S.Z_FINISH),le===S.Z_FINISH?(fe=d.inflateEnd(this.strm),this.onEnd(fe),this.ended=!0,fe===S.Z_OK):le!==S.Z_SYNC_FLUSH||(this.onEnd(S.Z_OK),!(He.avail_out=0))},q.prototype.onData=function(te){this.chunks.push(te)},q.prototype.onEnd=function(te){te===S.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=te,this.msg=this.strm.msg},a.Inflate=q,a.inflate=Q,a.inflateRaw=function(te,he){return(he=he||{}).raw=!0,Q(te,he)},a.ungzip=Q},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,a){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(S){for(var E=Array.prototype.slice.call(arguments,1);E.length;){var L=E.shift();if(L){if(typeof L!="object")throw new TypeError(L+"must be non-object");for(var F in L)L.hasOwnProperty(F)&&(S[F]=L[F])}}return S},a.shrinkBuf=function(S,E){return S.length===E?S:S.subarray?S.subarray(0,E):(S.length=E,S)};var f={arraySet:function(S,E,L,F,G){if(E.subarray&&S.subarray)S.set(E.subarray(L,L+F),G);else for(var q=0;q<F;q++)S[G+q]=E[L+q]},flattenChunks:function(S){var E,L,F,G,q,Q;for(E=F=0,L=S.length;E<L;E++)F+=S[E].length;for(Q=new Uint8Array(F),E=G=0,L=S.length;E<L;E++)q=S[E],Q.set(q,G),G+=q.length;return Q}},i={arraySet:function(S,E,L,F,G){for(var q=0;q<F;q++)S[G+q]=E[L+q]},flattenChunks:function(S){return[].concat.apply([],S)}};a.setTyped=function(S){S?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,f)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,i))},a.setTyped(d)},{}],42:[function(n,s,a){var d=n("./common"),f=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var S=new d.Buf8(256),E=0;E<256;E++)S[E]=252<=E?6:248<=E?5:240<=E?4:224<=E?3:192<=E?2:1;function L(F,G){if(G<65537&&(F.subarray&&i||!F.subarray&&f))return String.fromCharCode.apply(null,d.shrinkBuf(F,G));for(var q="",Q=0;Q<G;Q++)q+=String.fromCharCode(F[Q]);return q}S[254]=S[254]=1,a.string2buf=function(F){var G,q,Q,te,he,fe=F.length,le=0;for(te=0;te<fe;te++)(64512&(q=F.charCodeAt(te)))==55296&&te+1<fe&&(64512&(Q=F.charCodeAt(te+1)))==56320&&(q=65536+(q-55296<<10)+(Q-56320),te++),le+=q<128?1:q<2048?2:q<65536?3:4;for(G=new d.Buf8(le),te=he=0;he<le;te++)(64512&(q=F.charCodeAt(te)))==55296&&te+1<fe&&(64512&(Q=F.charCodeAt(te+1)))==56320&&(q=65536+(q-55296<<10)+(Q-56320),te++),q<128?G[he++]=q:(q<2048?G[he++]=192|q>>>6:(q<65536?G[he++]=224|q>>>12:(G[he++]=240|q>>>18,G[he++]=128|q>>>12&63),G[he++]=128|q>>>6&63),G[he++]=128|63&q);return G},a.buf2binstring=function(F){return L(F,F.length)},a.binstring2buf=function(F){for(var G=new d.Buf8(F.length),q=0,Q=G.length;q<Q;q++)G[q]=F.charCodeAt(q);return G},a.buf2string=function(F,G){var q,Q,te,he,fe=G||F.length,le=new Array(2*fe);for(q=Q=0;q<fe;)if((te=F[q++])<128)le[Q++]=te;else if(4<(he=S[te]))le[Q++]=65533,q+=he-1;else{for(te&=he===2?31:he===3?15:7;1<he&&q<fe;)te=te<<6|63&F[q++],he--;1<he?le[Q++]=65533:te<65536?le[Q++]=te:(te-=65536,le[Q++]=55296|te>>10&1023,le[Q++]=56320|1023&te)}return L(le,Q)},a.utf8border=function(F,G){var q;for((G=G||F.length)>F.length&&(G=F.length),q=G-1;0<=q&&(192&F[q])==128;)q--;return q<0||q===0?G:q+S[F[q]]>G?q:G}},{"./common":41}],43:[function(n,s,a){s.exports=function(d,f,i,S){for(var E=65535&d|0,L=d>>>16&65535|0,F=0;i!==0;){for(i-=F=2e3<i?2e3:i;L=L+(E=E+f[S++]|0)|0,--F;);E%=65521,L%=65521}return E|L<<16|0}},{}],44:[function(n,s,a){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,s,a){var d=function(){for(var f,i=[],S=0;S<256;S++){f=S;for(var E=0;E<8;E++)f=1&f?3988292384^f>>>1:f>>>1;i[S]=f}return i}();s.exports=function(f,i,S,E){var L=d,F=E+S;f^=-1;for(var G=E;G<F;G++)f=f>>>8^L[255&(f^i[G])];return-1^f}},{}],46:[function(n,s,a){var d,f=n("../utils/common"),i=n("./trees"),S=n("./adler32"),E=n("./crc32"),L=n("./messages"),F=0,G=4,q=0,Q=-2,te=-1,he=4,fe=2,le=8,Se=9,ke=286,Ee=30,Ie=19,He=2*ke+1,Ye=15,lt=3,Pt=258,At=Pt+lt+1,ht=42,Ot=113,Ae=1,mt=2,bt=3,Dt=4;function Je(Ue,ni){return Ue.msg=L[ni],ni}function dt(Ue){return(Ue<<1)-(4<Ue?9:0)}function ui(Ue){for(var ni=Ue.length;0<=--ni;)Ue[ni]=0}function Vt(Ue){var ni=Ue.state,fi=ni.pending;fi>Ue.avail_out&&(fi=Ue.avail_out),fi!==0&&(f.arraySet(Ue.output,ni.pending_buf,ni.pending_out,fi,Ue.next_out),Ue.next_out+=fi,ni.pending_out+=fi,Ue.total_out+=fi,Ue.avail_out-=fi,ni.pending-=fi,ni.pending===0&&(ni.pending_out=0))}function ei(Ue,ni){i._tr_flush_block(Ue,0<=Ue.block_start?Ue.block_start:-1,Ue.strstart-Ue.block_start,ni),Ue.block_start=Ue.strstart,Vt(Ue.strm)}function ur(Ue,ni){Ue.pending_buf[Ue.pending++]=ni}function Zt(Ue,ni){Ue.pending_buf[Ue.pending++]=ni>>>8&255,Ue.pending_buf[Ue.pending++]=255&ni}function Kt(Ue,ni){var fi,Lt,pt=Ue.max_chain_length,Nt=Ue.strstart,Si=Ue.prev_length,pi=Ue.nice_match,St=Ue.strstart>Ue.w_size-At?Ue.strstart-(Ue.w_size-At):0,Ht=Ue.window,nr=Ue.w_mask,tr=Ue.prev,kr=Ue.strstart+Pt,Mr=Ht[Nt+Si-1],Cr=Ht[Nt+Si];Ue.prev_length>=Ue.good_match&&(pt>>=2),pi>Ue.lookahead&&(pi=Ue.lookahead);do if(Ht[(fi=ni)+Si]===Cr&&Ht[fi+Si-1]===Mr&&Ht[fi]===Ht[Nt]&&Ht[++fi]===Ht[Nt+1]){Nt+=2,fi++;do;while(Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Ht[++Nt]===Ht[++fi]&&Nt<kr);if(Lt=Pt-(kr-Nt),Nt=kr-Pt,Si<Lt){if(Ue.match_start=ni,pi<=(Si=Lt))break;Mr=Ht[Nt+Si-1],Cr=Ht[Nt+Si]}}while((ni=tr[ni&nr])>St&&--pt!=0);return Si<=Ue.lookahead?Si:Ue.lookahead}function Ui(Ue){var ni,fi,Lt,pt,Nt,Si,pi,St,Ht,nr,tr=Ue.w_size;do{if(pt=Ue.window_size-Ue.lookahead-Ue.strstart,Ue.strstart>=tr+(tr-At)){for(f.arraySet(Ue.window,Ue.window,tr,tr,0),Ue.match_start-=tr,Ue.strstart-=tr,Ue.block_start-=tr,ni=fi=Ue.hash_size;Lt=Ue.head[--ni],Ue.head[ni]=tr<=Lt?Lt-tr:0,--fi;);for(ni=fi=tr;Lt=Ue.prev[--ni],Ue.prev[ni]=tr<=Lt?Lt-tr:0,--fi;);pt+=tr}if(Ue.strm.avail_in===0)break;if(Si=Ue.strm,pi=Ue.window,St=Ue.strstart+Ue.lookahead,Ht=pt,nr=void 0,nr=Si.avail_in,Ht<nr&&(nr=Ht),fi=nr===0?0:(Si.avail_in-=nr,f.arraySet(pi,Si.input,Si.next_in,nr,St),Si.state.wrap===1?Si.adler=S(Si.adler,pi,nr,St):Si.state.wrap===2&&(Si.adler=E(Si.adler,pi,nr,St)),Si.next_in+=nr,Si.total_in+=nr,nr),Ue.lookahead+=fi,Ue.lookahead+Ue.insert>=lt)for(Nt=Ue.strstart-Ue.insert,Ue.ins_h=Ue.window[Nt],Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Nt+1])&Ue.hash_mask;Ue.insert&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Nt+lt-1])&Ue.hash_mask,Ue.prev[Nt&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Nt,Nt++,Ue.insert--,!(Ue.lookahead+Ue.insert<lt)););}while(Ue.lookahead<At&&Ue.strm.avail_in!==0)}function rr(Ue,ni){for(var fi,Lt;;){if(Ue.lookahead<At){if(Ui(Ue),Ue.lookahead<At&&ni===F)return Ae;if(Ue.lookahead===0)break}if(fi=0,Ue.lookahead>=lt&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+lt-1])&Ue.hash_mask,fi=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart),fi!==0&&Ue.strstart-fi<=Ue.w_size-At&&(Ue.match_length=Kt(Ue,fi)),Ue.match_length>=lt)if(Lt=i._tr_tally(Ue,Ue.strstart-Ue.match_start,Ue.match_length-lt),Ue.lookahead-=Ue.match_length,Ue.match_length<=Ue.max_lazy_match&&Ue.lookahead>=lt){for(Ue.match_length--;Ue.strstart++,Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+lt-1])&Ue.hash_mask,fi=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart,--Ue.match_length!=0;);Ue.strstart++}else Ue.strstart+=Ue.match_length,Ue.match_length=0,Ue.ins_h=Ue.window[Ue.strstart],Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+1])&Ue.hash_mask;else Lt=i._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++;if(Lt&&(ei(Ue,!1),Ue.strm.avail_out===0))return Ae}return Ue.insert=Ue.strstart<lt-1?Ue.strstart:lt-1,ni===G?(ei(Ue,!0),Ue.strm.avail_out===0?bt:Dt):Ue.last_lit&&(ei(Ue,!1),Ue.strm.avail_out===0)?Ae:mt}function gi(Ue,ni){for(var fi,Lt,pt;;){if(Ue.lookahead<At){if(Ui(Ue),Ue.lookahead<At&&ni===F)return Ae;if(Ue.lookahead===0)break}if(fi=0,Ue.lookahead>=lt&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+lt-1])&Ue.hash_mask,fi=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart),Ue.prev_length=Ue.match_length,Ue.prev_match=Ue.match_start,Ue.match_length=lt-1,fi!==0&&Ue.prev_length<Ue.max_lazy_match&&Ue.strstart-fi<=Ue.w_size-At&&(Ue.match_length=Kt(Ue,fi),Ue.match_length<=5&&(Ue.strategy===1||Ue.match_length===lt&&4096<Ue.strstart-Ue.match_start)&&(Ue.match_length=lt-1)),Ue.prev_length>=lt&&Ue.match_length<=Ue.prev_length){for(pt=Ue.strstart+Ue.lookahead-lt,Lt=i._tr_tally(Ue,Ue.strstart-1-Ue.prev_match,Ue.prev_length-lt),Ue.lookahead-=Ue.prev_length-1,Ue.prev_length-=2;++Ue.strstart<=pt&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+lt-1])&Ue.hash_mask,fi=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart),--Ue.prev_length!=0;);if(Ue.match_available=0,Ue.match_length=lt-1,Ue.strstart++,Lt&&(ei(Ue,!1),Ue.strm.avail_out===0))return Ae}else if(Ue.match_available){if((Lt=i._tr_tally(Ue,0,Ue.window[Ue.strstart-1]))&&ei(Ue,!1),Ue.strstart++,Ue.lookahead--,Ue.strm.avail_out===0)return Ae}else Ue.match_available=1,Ue.strstart++,Ue.lookahead--}return Ue.match_available&&(Lt=i._tr_tally(Ue,0,Ue.window[Ue.strstart-1]),Ue.match_available=0),Ue.insert=Ue.strstart<lt-1?Ue.strstart:lt-1,ni===G?(ei(Ue,!0),Ue.strm.avail_out===0?bt:Dt):Ue.last_lit&&(ei(Ue,!1),Ue.strm.avail_out===0)?Ae:mt}function Oi(Ue,ni,fi,Lt,pt){this.good_length=Ue,this.max_lazy=ni,this.nice_length=fi,this.max_chain=Lt,this.func=pt}function cr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=le,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*He),this.dyn_dtree=new f.Buf16(2*(2*Ee+1)),this.bl_tree=new f.Buf16(2*(2*Ie+1)),ui(this.dyn_ltree),ui(this.dyn_dtree),ui(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(Ye+1),this.heap=new f.Buf16(2*ke+1),ui(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*ke+1),ui(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ji(Ue){var ni;return Ue&&Ue.state?(Ue.total_in=Ue.total_out=0,Ue.data_type=fe,(ni=Ue.state).pending=0,ni.pending_out=0,ni.wrap<0&&(ni.wrap=-ni.wrap),ni.status=ni.wrap?ht:Ot,Ue.adler=ni.wrap===2?0:1,ni.last_flush=F,i._tr_init(ni),q):Je(Ue,Q)}function nn(Ue){var ni=ji(Ue);return ni===q&&function(fi){fi.window_size=2*fi.w_size,ui(fi.head),fi.max_lazy_match=d[fi.level].max_lazy,fi.good_match=d[fi.level].good_length,fi.nice_match=d[fi.level].nice_length,fi.max_chain_length=d[fi.level].max_chain,fi.strstart=0,fi.block_start=0,fi.lookahead=0,fi.insert=0,fi.match_length=fi.prev_length=lt-1,fi.match_available=0,fi.ins_h=0}(Ue.state),ni}function pr(Ue,ni,fi,Lt,pt,Nt){if(!Ue)return Q;var Si=1;if(ni===te&&(ni=6),Lt<0?(Si=0,Lt=-Lt):15<Lt&&(Si=2,Lt-=16),pt<1||Se<pt||fi!==le||Lt<8||15<Lt||ni<0||9<ni||Nt<0||he<Nt)return Je(Ue,Q);Lt===8&&(Lt=9);var pi=new cr;return(Ue.state=pi).strm=Ue,pi.wrap=Si,pi.gzhead=null,pi.w_bits=Lt,pi.w_size=1<<pi.w_bits,pi.w_mask=pi.w_size-1,pi.hash_bits=pt+7,pi.hash_size=1<<pi.hash_bits,pi.hash_mask=pi.hash_size-1,pi.hash_shift=~~((pi.hash_bits+lt-1)/lt),pi.window=new f.Buf8(2*pi.w_size),pi.head=new f.Buf16(pi.hash_size),pi.prev=new f.Buf16(pi.w_size),pi.lit_bufsize=1<<pt+6,pi.pending_buf_size=4*pi.lit_bufsize,pi.pending_buf=new f.Buf8(pi.pending_buf_size),pi.d_buf=1*pi.lit_bufsize,pi.l_buf=3*pi.lit_bufsize,pi.level=ni,pi.strategy=Nt,pi.method=fi,nn(Ue)}d=[new Oi(0,0,0,0,function(Ue,ni){var fi=65535;for(fi>Ue.pending_buf_size-5&&(fi=Ue.pending_buf_size-5);;){if(Ue.lookahead<=1){if(Ui(Ue),Ue.lookahead===0&&ni===F)return Ae;if(Ue.lookahead===0)break}Ue.strstart+=Ue.lookahead,Ue.lookahead=0;var Lt=Ue.block_start+fi;if((Ue.strstart===0||Ue.strstart>=Lt)&&(Ue.lookahead=Ue.strstart-Lt,Ue.strstart=Lt,ei(Ue,!1),Ue.strm.avail_out===0)||Ue.strstart-Ue.block_start>=Ue.w_size-At&&(ei(Ue,!1),Ue.strm.avail_out===0))return Ae}return Ue.insert=0,ni===G?(ei(Ue,!0),Ue.strm.avail_out===0?bt:Dt):(Ue.strstart>Ue.block_start&&(ei(Ue,!1),Ue.strm.avail_out),Ae)}),new Oi(4,4,8,4,rr),new Oi(4,5,16,8,rr),new Oi(4,6,32,32,rr),new Oi(4,4,16,16,gi),new Oi(8,16,32,32,gi),new Oi(8,16,128,128,gi),new Oi(8,32,128,256,gi),new Oi(32,128,258,1024,gi),new Oi(32,258,258,4096,gi)],a.deflateInit=function(Ue,ni){return pr(Ue,ni,le,15,8,0)},a.deflateInit2=pr,a.deflateReset=nn,a.deflateResetKeep=ji,a.deflateSetHeader=function(Ue,ni){return Ue&&Ue.state?Ue.state.wrap!==2?Q:(Ue.state.gzhead=ni,q):Q},a.deflate=function(Ue,ni){var fi,Lt,pt,Nt;if(!Ue||!Ue.state||5<ni||ni<0)return Ue?Je(Ue,Q):Q;if(Lt=Ue.state,!Ue.output||!Ue.input&&Ue.avail_in!==0||Lt.status===666&&ni!==G)return Je(Ue,Ue.avail_out===0?-5:Q);if(Lt.strm=Ue,fi=Lt.last_flush,Lt.last_flush=ni,Lt.status===ht)if(Lt.wrap===2)Ue.adler=0,ur(Lt,31),ur(Lt,139),ur(Lt,8),Lt.gzhead?(ur(Lt,(Lt.gzhead.text?1:0)+(Lt.gzhead.hcrc?2:0)+(Lt.gzhead.extra?4:0)+(Lt.gzhead.name?8:0)+(Lt.gzhead.comment?16:0)),ur(Lt,255&Lt.gzhead.time),ur(Lt,Lt.gzhead.time>>8&255),ur(Lt,Lt.gzhead.time>>16&255),ur(Lt,Lt.gzhead.time>>24&255),ur(Lt,Lt.level===9?2:2<=Lt.strategy||Lt.level<2?4:0),ur(Lt,255&Lt.gzhead.os),Lt.gzhead.extra&&Lt.gzhead.extra.length&&(ur(Lt,255&Lt.gzhead.extra.length),ur(Lt,Lt.gzhead.extra.length>>8&255)),Lt.gzhead.hcrc&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending,0)),Lt.gzindex=0,Lt.status=69):(ur(Lt,0),ur(Lt,0),ur(Lt,0),ur(Lt,0),ur(Lt,0),ur(Lt,Lt.level===9?2:2<=Lt.strategy||Lt.level<2?4:0),ur(Lt,3),Lt.status=Ot);else{var Si=le+(Lt.w_bits-8<<4)<<8;Si|=(2<=Lt.strategy||Lt.level<2?0:Lt.level<6?1:Lt.level===6?2:3)<<6,Lt.strstart!==0&&(Si|=32),Si+=31-Si%31,Lt.status=Ot,Zt(Lt,Si),Lt.strstart!==0&&(Zt(Lt,Ue.adler>>>16),Zt(Lt,65535&Ue.adler)),Ue.adler=1}if(Lt.status===69)if(Lt.gzhead.extra){for(pt=Lt.pending;Lt.gzindex<(65535&Lt.gzhead.extra.length)&&(Lt.pending!==Lt.pending_buf_size||(Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Vt(Ue),pt=Lt.pending,Lt.pending!==Lt.pending_buf_size));)ur(Lt,255&Lt.gzhead.extra[Lt.gzindex]),Lt.gzindex++;Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Lt.gzindex===Lt.gzhead.extra.length&&(Lt.gzindex=0,Lt.status=73)}else Lt.status=73;if(Lt.status===73)if(Lt.gzhead.name){pt=Lt.pending;do{if(Lt.pending===Lt.pending_buf_size&&(Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Vt(Ue),pt=Lt.pending,Lt.pending===Lt.pending_buf_size)){Nt=1;break}Nt=Lt.gzindex<Lt.gzhead.name.length?255&Lt.gzhead.name.charCodeAt(Lt.gzindex++):0,ur(Lt,Nt)}while(Nt!==0);Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Nt===0&&(Lt.gzindex=0,Lt.status=91)}else Lt.status=91;if(Lt.status===91)if(Lt.gzhead.comment){pt=Lt.pending;do{if(Lt.pending===Lt.pending_buf_size&&(Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Vt(Ue),pt=Lt.pending,Lt.pending===Lt.pending_buf_size)){Nt=1;break}Nt=Lt.gzindex<Lt.gzhead.comment.length?255&Lt.gzhead.comment.charCodeAt(Lt.gzindex++):0,ur(Lt,Nt)}while(Nt!==0);Lt.gzhead.hcrc&&Lt.pending>pt&&(Ue.adler=E(Ue.adler,Lt.pending_buf,Lt.pending-pt,pt)),Nt===0&&(Lt.status=103)}else Lt.status=103;if(Lt.status===103&&(Lt.gzhead.hcrc?(Lt.pending+2>Lt.pending_buf_size&&Vt(Ue),Lt.pending+2<=Lt.pending_buf_size&&(ur(Lt,255&Ue.adler),ur(Lt,Ue.adler>>8&255),Ue.adler=0,Lt.status=Ot)):Lt.status=Ot),Lt.pending!==0){if(Vt(Ue),Ue.avail_out===0)return Lt.last_flush=-1,q}else if(Ue.avail_in===0&&dt(ni)<=dt(fi)&&ni!==G)return Je(Ue,-5);if(Lt.status===666&&Ue.avail_in!==0)return Je(Ue,-5);if(Ue.avail_in!==0||Lt.lookahead!==0||ni!==F&&Lt.status!==666){var pi=Lt.strategy===2?function(St,Ht){for(var nr;;){if(St.lookahead===0&&(Ui(St),St.lookahead===0)){if(Ht===F)return Ae;break}if(St.match_length=0,nr=i._tr_tally(St,0,St.window[St.strstart]),St.lookahead--,St.strstart++,nr&&(ei(St,!1),St.strm.avail_out===0))return Ae}return St.insert=0,Ht===G?(ei(St,!0),St.strm.avail_out===0?bt:Dt):St.last_lit&&(ei(St,!1),St.strm.avail_out===0)?Ae:mt}(Lt,ni):Lt.strategy===3?function(St,Ht){for(var nr,tr,kr,Mr,Cr=St.window;;){if(St.lookahead<=Pt){if(Ui(St),St.lookahead<=Pt&&Ht===F)return Ae;if(St.lookahead===0)break}if(St.match_length=0,St.lookahead>=lt&&0<St.strstart&&(tr=Cr[kr=St.strstart-1])===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]){Mr=St.strstart+Pt;do;while(tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&tr===Cr[++kr]&&kr<Mr);St.match_length=Pt-(Mr-kr),St.match_length>St.lookahead&&(St.match_length=St.lookahead)}if(St.match_length>=lt?(nr=i._tr_tally(St,1,St.match_length-lt),St.lookahead-=St.match_length,St.strstart+=St.match_length,St.match_length=0):(nr=i._tr_tally(St,0,St.window[St.strstart]),St.lookahead--,St.strstart++),nr&&(ei(St,!1),St.strm.avail_out===0))return Ae}return St.insert=0,Ht===G?(ei(St,!0),St.strm.avail_out===0?bt:Dt):St.last_lit&&(ei(St,!1),St.strm.avail_out===0)?Ae:mt}(Lt,ni):d[Lt.level].func(Lt,ni);if(pi!==bt&&pi!==Dt||(Lt.status=666),pi===Ae||pi===bt)return Ue.avail_out===0&&(Lt.last_flush=-1),q;if(pi===mt&&(ni===1?i._tr_align(Lt):ni!==5&&(i._tr_stored_block(Lt,0,0,!1),ni===3&&(ui(Lt.head),Lt.lookahead===0&&(Lt.strstart=0,Lt.block_start=0,Lt.insert=0))),Vt(Ue),Ue.avail_out===0))return Lt.last_flush=-1,q}return ni!==G?q:Lt.wrap<=0?1:(Lt.wrap===2?(ur(Lt,255&Ue.adler),ur(Lt,Ue.adler>>8&255),ur(Lt,Ue.adler>>16&255),ur(Lt,Ue.adler>>24&255),ur(Lt,255&Ue.total_in),ur(Lt,Ue.total_in>>8&255),ur(Lt,Ue.total_in>>16&255),ur(Lt,Ue.total_in>>24&255)):(Zt(Lt,Ue.adler>>>16),Zt(Lt,65535&Ue.adler)),Vt(Ue),0<Lt.wrap&&(Lt.wrap=-Lt.wrap),Lt.pending!==0?q:1)},a.deflateEnd=function(Ue){var ni;return Ue&&Ue.state?(ni=Ue.state.status)!==ht&&ni!==69&&ni!==73&&ni!==91&&ni!==103&&ni!==Ot&&ni!==666?Je(Ue,Q):(Ue.state=null,ni===Ot?Je(Ue,-3):q):Q},a.deflateSetDictionary=function(Ue,ni){var fi,Lt,pt,Nt,Si,pi,St,Ht,nr=ni.length;if(!Ue||!Ue.state||(Nt=(fi=Ue.state).wrap)===2||Nt===1&&fi.status!==ht||fi.lookahead)return Q;for(Nt===1&&(Ue.adler=S(Ue.adler,ni,nr,0)),fi.wrap=0,nr>=fi.w_size&&(Nt===0&&(ui(fi.head),fi.strstart=0,fi.block_start=0,fi.insert=0),Ht=new f.Buf8(fi.w_size),f.arraySet(Ht,ni,nr-fi.w_size,fi.w_size,0),ni=Ht,nr=fi.w_size),Si=Ue.avail_in,pi=Ue.next_in,St=Ue.input,Ue.avail_in=nr,Ue.next_in=0,Ue.input=ni,Ui(fi);fi.lookahead>=lt;){for(Lt=fi.strstart,pt=fi.lookahead-(lt-1);fi.ins_h=(fi.ins_h<<fi.hash_shift^fi.window[Lt+lt-1])&fi.hash_mask,fi.prev[Lt&fi.w_mask]=fi.head[fi.ins_h],fi.head[fi.ins_h]=Lt,Lt++,--pt;);fi.strstart=Lt,fi.lookahead=lt-1,Ui(fi)}return fi.strstart+=fi.lookahead,fi.block_start=fi.strstart,fi.insert=fi.lookahead,fi.lookahead=0,fi.match_length=fi.prev_length=lt-1,fi.match_available=0,Ue.next_in=pi,Ue.input=St,Ue.avail_in=Si,fi.wrap=Nt,q},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,s,a){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,s,a){s.exports=function(d,f){var i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee,Ie,He,Ye,lt,Pt,At,ht,Ot,Ae,mt;i=d.state,S=d.next_in,Ae=d.input,E=S+(d.avail_in-5),L=d.next_out,mt=d.output,F=L-(f-d.avail_out),G=L+(d.avail_out-257),q=i.dmax,Q=i.wsize,te=i.whave,he=i.wnext,fe=i.window,le=i.hold,Se=i.bits,ke=i.lencode,Ee=i.distcode,Ie=(1<<i.lenbits)-1,He=(1<<i.distbits)-1;e:do{Se<15&&(le+=Ae[S++]<<Se,Se+=8,le+=Ae[S++]<<Se,Se+=8),Ye=ke[le&Ie];t:for(;;){if(le>>>=lt=Ye>>>24,Se-=lt,(lt=Ye>>>16&255)===0)mt[L++]=65535&Ye;else{if(!(16&lt)){if(!(64&lt)){Ye=ke[(65535&Ye)+(le&(1<<lt)-1)];continue t}if(32&lt){i.mode=12;break e}d.msg="invalid literal/length code",i.mode=30;break e}Pt=65535&Ye,(lt&=15)&&(Se<lt&&(le+=Ae[S++]<<Se,Se+=8),Pt+=le&(1<<lt)-1,le>>>=lt,Se-=lt),Se<15&&(le+=Ae[S++]<<Se,Se+=8,le+=Ae[S++]<<Se,Se+=8),Ye=Ee[le&He];i:for(;;){if(le>>>=lt=Ye>>>24,Se-=lt,!(16&(lt=Ye>>>16&255))){if(!(64&lt)){Ye=Ee[(65535&Ye)+(le&(1<<lt)-1)];continue i}d.msg="invalid distance code",i.mode=30;break e}if(At=65535&Ye,Se<(lt&=15)&&(le+=Ae[S++]<<Se,(Se+=8)<lt&&(le+=Ae[S++]<<Se,Se+=8)),q<(At+=le&(1<<lt)-1)){d.msg="invalid distance too far back",i.mode=30;break e}if(le>>>=lt,Se-=lt,(lt=L-F)<At){if(te<(lt=At-lt)&&i.sane){d.msg="invalid distance too far back",i.mode=30;break e}if(Ot=fe,(ht=0)===he){if(ht+=Q-lt,lt<Pt){for(Pt-=lt;mt[L++]=fe[ht++],--lt;);ht=L-At,Ot=mt}}else if(he<lt){if(ht+=Q+he-lt,(lt-=he)<Pt){for(Pt-=lt;mt[L++]=fe[ht++],--lt;);if(ht=0,he<Pt){for(Pt-=lt=he;mt[L++]=fe[ht++],--lt;);ht=L-At,Ot=mt}}}else if(ht+=he-lt,lt<Pt){for(Pt-=lt;mt[L++]=fe[ht++],--lt;);ht=L-At,Ot=mt}for(;2<Pt;)mt[L++]=Ot[ht++],mt[L++]=Ot[ht++],mt[L++]=Ot[ht++],Pt-=3;Pt&&(mt[L++]=Ot[ht++],1<Pt&&(mt[L++]=Ot[ht++]))}else{for(ht=L-At;mt[L++]=mt[ht++],mt[L++]=mt[ht++],mt[L++]=mt[ht++],2<(Pt-=3););Pt&&(mt[L++]=mt[ht++],1<Pt&&(mt[L++]=mt[ht++]))}break}}break}}while(S<E&&L<G);S-=Pt=Se>>3,le&=(1<<(Se-=Pt<<3))-1,d.next_in=S,d.next_out=L,d.avail_in=S<E?E-S+5:5-(S-E),d.avail_out=L<G?G-L+257:257-(L-G),i.hold=le,i.bits=Se}},{}],49:[function(n,s,a){var d=n("../utils/common"),f=n("./adler32"),i=n("./crc32"),S=n("./inffast"),E=n("./inftrees"),L=1,F=2,G=0,q=-2,Q=1,te=852,he=592;function fe(ht){return(ht>>>24&255)+(ht>>>8&65280)+((65280&ht)<<8)+((255&ht)<<24)}function le(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Se(ht){var Ot;return ht&&ht.state?(Ot=ht.state,ht.total_in=ht.total_out=Ot.total=0,ht.msg="",Ot.wrap&&(ht.adler=1&Ot.wrap),Ot.mode=Q,Ot.last=0,Ot.havedict=0,Ot.dmax=32768,Ot.head=null,Ot.hold=0,Ot.bits=0,Ot.lencode=Ot.lendyn=new d.Buf32(te),Ot.distcode=Ot.distdyn=new d.Buf32(he),Ot.sane=1,Ot.back=-1,G):q}function ke(ht){var Ot;return ht&&ht.state?((Ot=ht.state).wsize=0,Ot.whave=0,Ot.wnext=0,Se(ht)):q}function Ee(ht,Ot){var Ae,mt;return ht&&ht.state?(mt=ht.state,Ot<0?(Ae=0,Ot=-Ot):(Ae=1+(Ot>>4),Ot<48&&(Ot&=15)),Ot&&(Ot<8||15<Ot)?q:(mt.window!==null&&mt.wbits!==Ot&&(mt.window=null),mt.wrap=Ae,mt.wbits=Ot,ke(ht))):q}function Ie(ht,Ot){var Ae,mt;return ht?(mt=new le,(ht.state=mt).window=null,(Ae=Ee(ht,Ot))!==G&&(ht.state=null),Ae):q}var He,Ye,lt=!0;function Pt(ht){if(lt){var Ot;for(He=new d.Buf32(512),Ye=new d.Buf32(32),Ot=0;Ot<144;)ht.lens[Ot++]=8;for(;Ot<256;)ht.lens[Ot++]=9;for(;Ot<280;)ht.lens[Ot++]=7;for(;Ot<288;)ht.lens[Ot++]=8;for(E(L,ht.lens,0,288,He,0,ht.work,{bits:9}),Ot=0;Ot<32;)ht.lens[Ot++]=5;E(F,ht.lens,0,32,Ye,0,ht.work,{bits:5}),lt=!1}ht.lencode=He,ht.lenbits=9,ht.distcode=Ye,ht.distbits=5}function At(ht,Ot,Ae,mt){var bt,Dt=ht.state;return Dt.window===null&&(Dt.wsize=1<<Dt.wbits,Dt.wnext=0,Dt.whave=0,Dt.window=new d.Buf8(Dt.wsize)),mt>=Dt.wsize?(d.arraySet(Dt.window,Ot,Ae-Dt.wsize,Dt.wsize,0),Dt.wnext=0,Dt.whave=Dt.wsize):(mt<(bt=Dt.wsize-Dt.wnext)&&(bt=mt),d.arraySet(Dt.window,Ot,Ae-mt,bt,Dt.wnext),(mt-=bt)?(d.arraySet(Dt.window,Ot,Ae-mt,mt,0),Dt.wnext=mt,Dt.whave=Dt.wsize):(Dt.wnext+=bt,Dt.wnext===Dt.wsize&&(Dt.wnext=0),Dt.whave<Dt.wsize&&(Dt.whave+=bt))),0}a.inflateReset=ke,a.inflateReset2=Ee,a.inflateResetKeep=Se,a.inflateInit=function(ht){return Ie(ht,15)},a.inflateInit2=Ie,a.inflate=function(ht,Ot){var Ae,mt,bt,Dt,Je,dt,ui,Vt,ei,ur,Zt,Kt,Ui,rr,gi,Oi,cr,ji,nn,pr,Ue,ni,fi,Lt,pt=0,Nt=new d.Buf8(4),Si=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ht||!ht.state||!ht.output||!ht.input&&ht.avail_in!==0)return q;(Ae=ht.state).mode===12&&(Ae.mode=13),Je=ht.next_out,bt=ht.output,ui=ht.avail_out,Dt=ht.next_in,mt=ht.input,dt=ht.avail_in,Vt=Ae.hold,ei=Ae.bits,ur=dt,Zt=ui,ni=G;e:for(;;)switch(Ae.mode){case Q:if(Ae.wrap===0){Ae.mode=13;break}for(;ei<16;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(2&Ae.wrap&&Vt===35615){Nt[Ae.check=0]=255&Vt,Nt[1]=Vt>>>8&255,Ae.check=i(Ae.check,Nt,2,0),ei=Vt=0,Ae.mode=2;break}if(Ae.flags=0,Ae.head&&(Ae.head.done=!1),!(1&Ae.wrap)||(((255&Vt)<<8)+(Vt>>8))%31){ht.msg="incorrect header check",Ae.mode=30;break}if((15&Vt)!=8){ht.msg="unknown compression method",Ae.mode=30;break}if(ei-=4,Ue=8+(15&(Vt>>>=4)),Ae.wbits===0)Ae.wbits=Ue;else if(Ue>Ae.wbits){ht.msg="invalid window size",Ae.mode=30;break}Ae.dmax=1<<Ue,ht.adler=Ae.check=1,Ae.mode=512&Vt?10:12,ei=Vt=0;break;case 2:for(;ei<16;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Ae.flags=Vt,(255&Ae.flags)!=8){ht.msg="unknown compression method",Ae.mode=30;break}if(57344&Ae.flags){ht.msg="unknown header flags set",Ae.mode=30;break}Ae.head&&(Ae.head.text=Vt>>8&1),512&Ae.flags&&(Nt[0]=255&Vt,Nt[1]=Vt>>>8&255,Ae.check=i(Ae.check,Nt,2,0)),ei=Vt=0,Ae.mode=3;case 3:for(;ei<32;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.head&&(Ae.head.time=Vt),512&Ae.flags&&(Nt[0]=255&Vt,Nt[1]=Vt>>>8&255,Nt[2]=Vt>>>16&255,Nt[3]=Vt>>>24&255,Ae.check=i(Ae.check,Nt,4,0)),ei=Vt=0,Ae.mode=4;case 4:for(;ei<16;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.head&&(Ae.head.xflags=255&Vt,Ae.head.os=Vt>>8),512&Ae.flags&&(Nt[0]=255&Vt,Nt[1]=Vt>>>8&255,Ae.check=i(Ae.check,Nt,2,0)),ei=Vt=0,Ae.mode=5;case 5:if(1024&Ae.flags){for(;ei<16;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.length=Vt,Ae.head&&(Ae.head.extra_len=Vt),512&Ae.flags&&(Nt[0]=255&Vt,Nt[1]=Vt>>>8&255,Ae.check=i(Ae.check,Nt,2,0)),ei=Vt=0}else Ae.head&&(Ae.head.extra=null);Ae.mode=6;case 6:if(1024&Ae.flags&&(dt<(Kt=Ae.length)&&(Kt=dt),Kt&&(Ae.head&&(Ue=Ae.head.extra_len-Ae.length,Ae.head.extra||(Ae.head.extra=new Array(Ae.head.extra_len)),d.arraySet(Ae.head.extra,mt,Dt,Kt,Ue)),512&Ae.flags&&(Ae.check=i(Ae.check,mt,Kt,Dt)),dt-=Kt,Dt+=Kt,Ae.length-=Kt),Ae.length))break e;Ae.length=0,Ae.mode=7;case 7:if(2048&Ae.flags){if(dt===0)break e;for(Kt=0;Ue=mt[Dt+Kt++],Ae.head&&Ue&&Ae.length<65536&&(Ae.head.name+=String.fromCharCode(Ue)),Ue&&Kt<dt;);if(512&Ae.flags&&(Ae.check=i(Ae.check,mt,Kt,Dt)),dt-=Kt,Dt+=Kt,Ue)break e}else Ae.head&&(Ae.head.name=null);Ae.length=0,Ae.mode=8;case 8:if(4096&Ae.flags){if(dt===0)break e;for(Kt=0;Ue=mt[Dt+Kt++],Ae.head&&Ue&&Ae.length<65536&&(Ae.head.comment+=String.fromCharCode(Ue)),Ue&&Kt<dt;);if(512&Ae.flags&&(Ae.check=i(Ae.check,mt,Kt,Dt)),dt-=Kt,Dt+=Kt,Ue)break e}else Ae.head&&(Ae.head.comment=null);Ae.mode=9;case 9:if(512&Ae.flags){for(;ei<16;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Vt!==(65535&Ae.check)){ht.msg="header crc mismatch",Ae.mode=30;break}ei=Vt=0}Ae.head&&(Ae.head.hcrc=Ae.flags>>9&1,Ae.head.done=!0),ht.adler=Ae.check=0,Ae.mode=12;break;case 10:for(;ei<32;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}ht.adler=Ae.check=fe(Vt),ei=Vt=0,Ae.mode=11;case 11:if(Ae.havedict===0)return ht.next_out=Je,ht.avail_out=ui,ht.next_in=Dt,ht.avail_in=dt,Ae.hold=Vt,Ae.bits=ei,2;ht.adler=Ae.check=1,Ae.mode=12;case 12:if(Ot===5||Ot===6)break e;case 13:if(Ae.last){Vt>>>=7&ei,ei-=7&ei,Ae.mode=27;break}for(;ei<3;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}switch(Ae.last=1&Vt,ei-=1,3&(Vt>>>=1)){case 0:Ae.mode=14;break;case 1:if(Pt(Ae),Ae.mode=20,Ot!==6)break;Vt>>>=2,ei-=2;break e;case 2:Ae.mode=17;break;case 3:ht.msg="invalid block type",Ae.mode=30}Vt>>>=2,ei-=2;break;case 14:for(Vt>>>=7&ei,ei-=7&ei;ei<32;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if((65535&Vt)!=(Vt>>>16^65535)){ht.msg="invalid stored block lengths",Ae.mode=30;break}if(Ae.length=65535&Vt,ei=Vt=0,Ae.mode=15,Ot===6)break e;case 15:Ae.mode=16;case 16:if(Kt=Ae.length){if(dt<Kt&&(Kt=dt),ui<Kt&&(Kt=ui),Kt===0)break e;d.arraySet(bt,mt,Dt,Kt,Je),dt-=Kt,Dt+=Kt,ui-=Kt,Je+=Kt,Ae.length-=Kt;break}Ae.mode=12;break;case 17:for(;ei<14;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Ae.nlen=257+(31&Vt),Vt>>>=5,ei-=5,Ae.ndist=1+(31&Vt),Vt>>>=5,ei-=5,Ae.ncode=4+(15&Vt),Vt>>>=4,ei-=4,286<Ae.nlen||30<Ae.ndist){ht.msg="too many length or distance symbols",Ae.mode=30;break}Ae.have=0,Ae.mode=18;case 18:for(;Ae.have<Ae.ncode;){for(;ei<3;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.lens[Si[Ae.have++]]=7&Vt,Vt>>>=3,ei-=3}for(;Ae.have<19;)Ae.lens[Si[Ae.have++]]=0;if(Ae.lencode=Ae.lendyn,Ae.lenbits=7,fi={bits:Ae.lenbits},ni=E(0,Ae.lens,0,19,Ae.lencode,0,Ae.work,fi),Ae.lenbits=fi.bits,ni){ht.msg="invalid code lengths set",Ae.mode=30;break}Ae.have=0,Ae.mode=19;case 19:for(;Ae.have<Ae.nlen+Ae.ndist;){for(;Oi=(pt=Ae.lencode[Vt&(1<<Ae.lenbits)-1])>>>16&255,cr=65535&pt,!((gi=pt>>>24)<=ei);){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(cr<16)Vt>>>=gi,ei-=gi,Ae.lens[Ae.have++]=cr;else{if(cr===16){for(Lt=gi+2;ei<Lt;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Vt>>>=gi,ei-=gi,Ae.have===0){ht.msg="invalid bit length repeat",Ae.mode=30;break}Ue=Ae.lens[Ae.have-1],Kt=3+(3&Vt),Vt>>>=2,ei-=2}else if(cr===17){for(Lt=gi+3;ei<Lt;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}ei-=gi,Ue=0,Kt=3+(7&(Vt>>>=gi)),Vt>>>=3,ei-=3}else{for(Lt=gi+7;ei<Lt;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}ei-=gi,Ue=0,Kt=11+(127&(Vt>>>=gi)),Vt>>>=7,ei-=7}if(Ae.have+Kt>Ae.nlen+Ae.ndist){ht.msg="invalid bit length repeat",Ae.mode=30;break}for(;Kt--;)Ae.lens[Ae.have++]=Ue}}if(Ae.mode===30)break;if(Ae.lens[256]===0){ht.msg="invalid code -- missing end-of-block",Ae.mode=30;break}if(Ae.lenbits=9,fi={bits:Ae.lenbits},ni=E(L,Ae.lens,0,Ae.nlen,Ae.lencode,0,Ae.work,fi),Ae.lenbits=fi.bits,ni){ht.msg="invalid literal/lengths set",Ae.mode=30;break}if(Ae.distbits=6,Ae.distcode=Ae.distdyn,fi={bits:Ae.distbits},ni=E(F,Ae.lens,Ae.nlen,Ae.ndist,Ae.distcode,0,Ae.work,fi),Ae.distbits=fi.bits,ni){ht.msg="invalid distances set",Ae.mode=30;break}if(Ae.mode=20,Ot===6)break e;case 20:Ae.mode=21;case 21:if(6<=dt&&258<=ui){ht.next_out=Je,ht.avail_out=ui,ht.next_in=Dt,ht.avail_in=dt,Ae.hold=Vt,Ae.bits=ei,S(ht,Zt),Je=ht.next_out,bt=ht.output,ui=ht.avail_out,Dt=ht.next_in,mt=ht.input,dt=ht.avail_in,Vt=Ae.hold,ei=Ae.bits,Ae.mode===12&&(Ae.back=-1);break}for(Ae.back=0;Oi=(pt=Ae.lencode[Vt&(1<<Ae.lenbits)-1])>>>16&255,cr=65535&pt,!((gi=pt>>>24)<=ei);){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Oi&&!(240&Oi)){for(ji=gi,nn=Oi,pr=cr;Oi=(pt=Ae.lencode[pr+((Vt&(1<<ji+nn)-1)>>ji)])>>>16&255,cr=65535&pt,!(ji+(gi=pt>>>24)<=ei);){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Vt>>>=ji,ei-=ji,Ae.back+=ji}if(Vt>>>=gi,ei-=gi,Ae.back+=gi,Ae.length=cr,Oi===0){Ae.mode=26;break}if(32&Oi){Ae.back=-1,Ae.mode=12;break}if(64&Oi){ht.msg="invalid literal/length code",Ae.mode=30;break}Ae.extra=15&Oi,Ae.mode=22;case 22:if(Ae.extra){for(Lt=Ae.extra;ei<Lt;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.length+=Vt&(1<<Ae.extra)-1,Vt>>>=Ae.extra,ei-=Ae.extra,Ae.back+=Ae.extra}Ae.was=Ae.length,Ae.mode=23;case 23:for(;Oi=(pt=Ae.distcode[Vt&(1<<Ae.distbits)-1])>>>16&255,cr=65535&pt,!((gi=pt>>>24)<=ei);){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(!(240&Oi)){for(ji=gi,nn=Oi,pr=cr;Oi=(pt=Ae.distcode[pr+((Vt&(1<<ji+nn)-1)>>ji)])>>>16&255,cr=65535&pt,!(ji+(gi=pt>>>24)<=ei);){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Vt>>>=ji,ei-=ji,Ae.back+=ji}if(Vt>>>=gi,ei-=gi,Ae.back+=gi,64&Oi){ht.msg="invalid distance code",Ae.mode=30;break}Ae.offset=cr,Ae.extra=15&Oi,Ae.mode=24;case 24:if(Ae.extra){for(Lt=Ae.extra;ei<Lt;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}Ae.offset+=Vt&(1<<Ae.extra)-1,Vt>>>=Ae.extra,ei-=Ae.extra,Ae.back+=Ae.extra}if(Ae.offset>Ae.dmax){ht.msg="invalid distance too far back",Ae.mode=30;break}Ae.mode=25;case 25:if(ui===0)break e;if(Kt=Zt-ui,Ae.offset>Kt){if((Kt=Ae.offset-Kt)>Ae.whave&&Ae.sane){ht.msg="invalid distance too far back",Ae.mode=30;break}Ui=Kt>Ae.wnext?(Kt-=Ae.wnext,Ae.wsize-Kt):Ae.wnext-Kt,Kt>Ae.length&&(Kt=Ae.length),rr=Ae.window}else rr=bt,Ui=Je-Ae.offset,Kt=Ae.length;for(ui<Kt&&(Kt=ui),ui-=Kt,Ae.length-=Kt;bt[Je++]=rr[Ui++],--Kt;);Ae.length===0&&(Ae.mode=21);break;case 26:if(ui===0)break e;bt[Je++]=Ae.length,ui--,Ae.mode=21;break;case 27:if(Ae.wrap){for(;ei<32;){if(dt===0)break e;dt--,Vt|=mt[Dt++]<<ei,ei+=8}if(Zt-=ui,ht.total_out+=Zt,Ae.total+=Zt,Zt&&(ht.adler=Ae.check=Ae.flags?i(Ae.check,bt,Zt,Je-Zt):f(Ae.check,bt,Zt,Je-Zt)),Zt=ui,(Ae.flags?Vt:fe(Vt))!==Ae.check){ht.msg="incorrect data check",Ae.mode=30;break}ei=Vt=0}Ae.mode=28;case 28:if(Ae.wrap&&Ae.flags){for(;ei<32;){if(dt===0)break e;dt--,Vt+=mt[Dt++]<<ei,ei+=8}if(Vt!==(4294967295&Ae.total)){ht.msg="incorrect length check",Ae.mode=30;break}ei=Vt=0}Ae.mode=29;case 29:ni=1;break e;case 30:ni=-3;break e;case 31:return-4;case 32:default:return q}return ht.next_out=Je,ht.avail_out=ui,ht.next_in=Dt,ht.avail_in=dt,Ae.hold=Vt,Ae.bits=ei,(Ae.wsize||Zt!==ht.avail_out&&Ae.mode<30&&(Ae.mode<27||Ot!==4))&&At(ht,ht.output,ht.next_out,Zt-ht.avail_out)?(Ae.mode=31,-4):(ur-=ht.avail_in,Zt-=ht.avail_out,ht.total_in+=ur,ht.total_out+=Zt,Ae.total+=Zt,Ae.wrap&&Zt&&(ht.adler=Ae.check=Ae.flags?i(Ae.check,bt,Zt,ht.next_out-Zt):f(Ae.check,bt,Zt,ht.next_out-Zt)),ht.data_type=Ae.bits+(Ae.last?64:0)+(Ae.mode===12?128:0)+(Ae.mode===20||Ae.mode===15?256:0),(ur==0&&Zt===0||Ot===4)&&ni===G&&(ni=-5),ni)},a.inflateEnd=function(ht){if(!ht||!ht.state)return q;var Ot=ht.state;return Ot.window&&(Ot.window=null),ht.state=null,G},a.inflateGetHeader=function(ht,Ot){var Ae;return ht&&ht.state&&2&(Ae=ht.state).wrap?((Ae.head=Ot).done=!1,G):q},a.inflateSetDictionary=function(ht,Ot){var Ae,mt=Ot.length;return ht&&ht.state?(Ae=ht.state).wrap!==0&&Ae.mode!==11?q:Ae.mode===11&&f(1,Ot,mt,0)!==Ae.check?-3:At(ht,Ot,mt,mt)?(Ae.mode=31,-4):(Ae.havedict=1,G):q},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,s,a){var d=n("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],S=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],E=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(L,F,G,q,Q,te,he,fe){var le,Se,ke,Ee,Ie,He,Ye,lt,Pt,At=fe.bits,ht=0,Ot=0,Ae=0,mt=0,bt=0,Dt=0,Je=0,dt=0,ui=0,Vt=0,ei=null,ur=0,Zt=new d.Buf16(16),Kt=new d.Buf16(16),Ui=null,rr=0;for(ht=0;ht<=15;ht++)Zt[ht]=0;for(Ot=0;Ot<q;Ot++)Zt[F[G+Ot]]++;for(bt=At,mt=15;1<=mt&&Zt[mt]===0;mt--);if(mt<bt&&(bt=mt),mt===0)return Q[te++]=20971520,Q[te++]=20971520,fe.bits=1,0;for(Ae=1;Ae<mt&&Zt[Ae]===0;Ae++);for(bt<Ae&&(bt=Ae),ht=dt=1;ht<=15;ht++)if(dt<<=1,(dt-=Zt[ht])<0)return-1;if(0<dt&&(L===0||mt!==1))return-1;for(Kt[1]=0,ht=1;ht<15;ht++)Kt[ht+1]=Kt[ht]+Zt[ht];for(Ot=0;Ot<q;Ot++)F[G+Ot]!==0&&(he[Kt[F[G+Ot]]++]=Ot);if(He=L===0?(ei=Ui=he,19):L===1?(ei=f,ur-=257,Ui=i,rr-=257,256):(ei=S,Ui=E,-1),ht=Ae,Ie=te,Je=Ot=Vt=0,ke=-1,Ee=(ui=1<<(Dt=bt))-1,L===1&&852<ui||L===2&&592<ui)return 1;for(;;){for(Ye=ht-Je,Pt=he[Ot]<He?(lt=0,he[Ot]):he[Ot]>He?(lt=Ui[rr+he[Ot]],ei[ur+he[Ot]]):(lt=96,0),le=1<<ht-Je,Ae=Se=1<<Dt;Q[Ie+(Vt>>Je)+(Se-=le)]=Ye<<24|lt<<16|Pt|0,Se!==0;);for(le=1<<ht-1;Vt&le;)le>>=1;if(le!==0?(Vt&=le-1,Vt+=le):Vt=0,Ot++,--Zt[ht]==0){if(ht===mt)break;ht=F[G+he[Ot]]}if(bt<ht&&(Vt&Ee)!==ke){for(Je===0&&(Je=bt),Ie+=Ae,dt=1<<(Dt=ht-Je);Dt+Je<mt&&!((dt-=Zt[Dt+Je])<=0);)Dt++,dt<<=1;if(ui+=1<<Dt,L===1&&852<ui||L===2&&592<ui)return 1;Q[ke=Vt&Ee]=bt<<24|Dt<<16|Ie-te|0}}return Vt!==0&&(Q[Ie+Vt]=ht-Je<<24|64<<16|0),fe.bits=bt,0}},{"../utils/common":41}],51:[function(n,s,a){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,s,a){var d=n("../utils/common"),f=0,i=1;function S(pt){for(var Nt=pt.length;0<=--Nt;)pt[Nt]=0}var E=0,L=29,F=256,G=F+1+L,q=30,Q=19,te=2*G+1,he=15,fe=16,le=7,Se=256,ke=16,Ee=17,Ie=18,He=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ye=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],lt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],At=new Array(2*(G+2));S(At);var ht=new Array(2*q);S(ht);var Ot=new Array(512);S(Ot);var Ae=new Array(256);S(Ae);var mt=new Array(L);S(mt);var bt,Dt,Je,dt=new Array(q);function ui(pt,Nt,Si,pi,St){this.static_tree=pt,this.extra_bits=Nt,this.extra_base=Si,this.elems=pi,this.max_length=St,this.has_stree=pt&&pt.length}function Vt(pt,Nt){this.dyn_tree=pt,this.max_code=0,this.stat_desc=Nt}function ei(pt){return pt<256?Ot[pt]:Ot[256+(pt>>>7)]}function ur(pt,Nt){pt.pending_buf[pt.pending++]=255&Nt,pt.pending_buf[pt.pending++]=Nt>>>8&255}function Zt(pt,Nt,Si){pt.bi_valid>fe-Si?(pt.bi_buf|=Nt<<pt.bi_valid&65535,ur(pt,pt.bi_buf),pt.bi_buf=Nt>>fe-pt.bi_valid,pt.bi_valid+=Si-fe):(pt.bi_buf|=Nt<<pt.bi_valid&65535,pt.bi_valid+=Si)}function Kt(pt,Nt,Si){Zt(pt,Si[2*Nt],Si[2*Nt+1])}function Ui(pt,Nt){for(var Si=0;Si|=1&pt,pt>>>=1,Si<<=1,0<--Nt;);return Si>>>1}function rr(pt,Nt,Si){var pi,St,Ht=new Array(he+1),nr=0;for(pi=1;pi<=he;pi++)Ht[pi]=nr=nr+Si[pi-1]<<1;for(St=0;St<=Nt;St++){var tr=pt[2*St+1];tr!==0&&(pt[2*St]=Ui(Ht[tr]++,tr))}}function gi(pt){var Nt;for(Nt=0;Nt<G;Nt++)pt.dyn_ltree[2*Nt]=0;for(Nt=0;Nt<q;Nt++)pt.dyn_dtree[2*Nt]=0;for(Nt=0;Nt<Q;Nt++)pt.bl_tree[2*Nt]=0;pt.dyn_ltree[2*Se]=1,pt.opt_len=pt.static_len=0,pt.last_lit=pt.matches=0}function Oi(pt){8<pt.bi_valid?ur(pt,pt.bi_buf):0<pt.bi_valid&&(pt.pending_buf[pt.pending++]=pt.bi_buf),pt.bi_buf=0,pt.bi_valid=0}function cr(pt,Nt,Si,pi){var St=2*Nt,Ht=2*Si;return pt[St]<pt[Ht]||pt[St]===pt[Ht]&&pi[Nt]<=pi[Si]}function ji(pt,Nt,Si){for(var pi=pt.heap[Si],St=Si<<1;St<=pt.heap_len&&(St<pt.heap_len&&cr(Nt,pt.heap[St+1],pt.heap[St],pt.depth)&&St++,!cr(Nt,pi,pt.heap[St],pt.depth));)pt.heap[Si]=pt.heap[St],Si=St,St<<=1;pt.heap[Si]=pi}function nn(pt,Nt,Si){var pi,St,Ht,nr,tr=0;if(pt.last_lit!==0)for(;pi=pt.pending_buf[pt.d_buf+2*tr]<<8|pt.pending_buf[pt.d_buf+2*tr+1],St=pt.pending_buf[pt.l_buf+tr],tr++,pi===0?Kt(pt,St,Nt):(Kt(pt,(Ht=Ae[St])+F+1,Nt),(nr=He[Ht])!==0&&Zt(pt,St-=mt[Ht],nr),Kt(pt,Ht=ei(--pi),Si),(nr=Ye[Ht])!==0&&Zt(pt,pi-=dt[Ht],nr)),tr<pt.last_lit;);Kt(pt,Se,Nt)}function pr(pt,Nt){var Si,pi,St,Ht=Nt.dyn_tree,nr=Nt.stat_desc.static_tree,tr=Nt.stat_desc.has_stree,kr=Nt.stat_desc.elems,Mr=-1;for(pt.heap_len=0,pt.heap_max=te,Si=0;Si<kr;Si++)Ht[2*Si]!==0?(pt.heap[++pt.heap_len]=Mr=Si,pt.depth[Si]=0):Ht[2*Si+1]=0;for(;pt.heap_len<2;)Ht[2*(St=pt.heap[++pt.heap_len]=Mr<2?++Mr:0)]=1,pt.depth[St]=0,pt.opt_len--,tr&&(pt.static_len-=nr[2*St+1]);for(Nt.max_code=Mr,Si=pt.heap_len>>1;1<=Si;Si--)ji(pt,Ht,Si);for(St=kr;Si=pt.heap[1],pt.heap[1]=pt.heap[pt.heap_len--],ji(pt,Ht,1),pi=pt.heap[1],pt.heap[--pt.heap_max]=Si,pt.heap[--pt.heap_max]=pi,Ht[2*St]=Ht[2*Si]+Ht[2*pi],pt.depth[St]=(pt.depth[Si]>=pt.depth[pi]?pt.depth[Si]:pt.depth[pi])+1,Ht[2*Si+1]=Ht[2*pi+1]=St,pt.heap[1]=St++,ji(pt,Ht,1),2<=pt.heap_len;);pt.heap[--pt.heap_max]=pt.heap[1],function(Cr,Tn){var gs,wn,bs,qn,Ls,ma,Ln=Tn.dyn_tree,qo=Tn.max_code,zn=Tn.stat_desc.static_tree,za=Tn.stat_desc.has_stree,$o=Tn.stat_desc.extra_bits,Aa=Tn.stat_desc.extra_base,ja=Tn.stat_desc.max_length,Yn=0;for(qn=0;qn<=he;qn++)Cr.bl_count[qn]=0;for(Ln[2*Cr.heap[Cr.heap_max]+1]=0,gs=Cr.heap_max+1;gs<te;gs++)ja<(qn=Ln[2*Ln[2*(wn=Cr.heap[gs])+1]+1]+1)&&(qn=ja,Yn++),Ln[2*wn+1]=qn,qo<wn||(Cr.bl_count[qn]++,Ls=0,Aa<=wn&&(Ls=$o[wn-Aa]),ma=Ln[2*wn],Cr.opt_len+=ma*(qn+Ls),za&&(Cr.static_len+=ma*(zn[2*wn+1]+Ls)));if(Yn!==0){do{for(qn=ja-1;Cr.bl_count[qn]===0;)qn--;Cr.bl_count[qn]--,Cr.bl_count[qn+1]+=2,Cr.bl_count[ja]--,Yn-=2}while(0<Yn);for(qn=ja;qn!==0;qn--)for(wn=Cr.bl_count[qn];wn!==0;)qo<(bs=Cr.heap[--gs])||(Ln[2*bs+1]!==qn&&(Cr.opt_len+=(qn-Ln[2*bs+1])*Ln[2*bs],Ln[2*bs+1]=qn),wn--)}}(pt,Nt),rr(Ht,Mr,pt.bl_count)}function Ue(pt,Nt,Si){var pi,St,Ht=-1,nr=Nt[1],tr=0,kr=7,Mr=4;for(nr===0&&(kr=138,Mr=3),Nt[2*(Si+1)+1]=65535,pi=0;pi<=Si;pi++)St=nr,nr=Nt[2*(pi+1)+1],++tr<kr&&St===nr||(tr<Mr?pt.bl_tree[2*St]+=tr:St!==0?(St!==Ht&&pt.bl_tree[2*St]++,pt.bl_tree[2*ke]++):tr<=10?pt.bl_tree[2*Ee]++:pt.bl_tree[2*Ie]++,Ht=St,Mr=(tr=0)===nr?(kr=138,3):St===nr?(kr=6,3):(kr=7,4))}function ni(pt,Nt,Si){var pi,St,Ht=-1,nr=Nt[1],tr=0,kr=7,Mr=4;for(nr===0&&(kr=138,Mr=3),pi=0;pi<=Si;pi++)if(St=nr,nr=Nt[2*(pi+1)+1],!(++tr<kr&&St===nr)){if(tr<Mr)for(;Kt(pt,St,pt.bl_tree),--tr!=0;);else St!==0?(St!==Ht&&(Kt(pt,St,pt.bl_tree),tr--),Kt(pt,ke,pt.bl_tree),Zt(pt,tr-3,2)):tr<=10?(Kt(pt,Ee,pt.bl_tree),Zt(pt,tr-3,3)):(Kt(pt,Ie,pt.bl_tree),Zt(pt,tr-11,7));Ht=St,Mr=(tr=0)===nr?(kr=138,3):St===nr?(kr=6,3):(kr=7,4)}}S(dt);var fi=!1;function Lt(pt,Nt,Si,pi){Zt(pt,(E<<1)+(pi?1:0),3),function(St,Ht,nr,tr){Oi(St),tr&&(ur(St,nr),ur(St,~nr)),d.arraySet(St.pending_buf,St.window,Ht,nr,St.pending),St.pending+=nr}(pt,Nt,Si,!0)}a._tr_init=function(pt){fi||(function(){var Nt,Si,pi,St,Ht,nr=new Array(he+1);for(St=pi=0;St<L-1;St++)for(mt[St]=pi,Nt=0;Nt<1<<He[St];Nt++)Ae[pi++]=St;for(Ae[pi-1]=St,St=Ht=0;St<16;St++)for(dt[St]=Ht,Nt=0;Nt<1<<Ye[St];Nt++)Ot[Ht++]=St;for(Ht>>=7;St<q;St++)for(dt[St]=Ht<<7,Nt=0;Nt<1<<Ye[St]-7;Nt++)Ot[256+Ht++]=St;for(Si=0;Si<=he;Si++)nr[Si]=0;for(Nt=0;Nt<=143;)At[2*Nt+1]=8,Nt++,nr[8]++;for(;Nt<=255;)At[2*Nt+1]=9,Nt++,nr[9]++;for(;Nt<=279;)At[2*Nt+1]=7,Nt++,nr[7]++;for(;Nt<=287;)At[2*Nt+1]=8,Nt++,nr[8]++;for(rr(At,G+1,nr),Nt=0;Nt<q;Nt++)ht[2*Nt+1]=5,ht[2*Nt]=Ui(Nt,5);bt=new ui(At,He,F+1,G,he),Dt=new ui(ht,Ye,0,q,he),Je=new ui(new Array(0),lt,0,Q,le)}(),fi=!0),pt.l_desc=new Vt(pt.dyn_ltree,bt),pt.d_desc=new Vt(pt.dyn_dtree,Dt),pt.bl_desc=new Vt(pt.bl_tree,Je),pt.bi_buf=0,pt.bi_valid=0,gi(pt)},a._tr_stored_block=Lt,a._tr_flush_block=function(pt,Nt,Si,pi){var St,Ht,nr=0;0<pt.level?(pt.strm.data_type===2&&(pt.strm.data_type=function(tr){var kr,Mr=4093624447;for(kr=0;kr<=31;kr++,Mr>>>=1)if(1&Mr&&tr.dyn_ltree[2*kr]!==0)return f;if(tr.dyn_ltree[18]!==0||tr.dyn_ltree[20]!==0||tr.dyn_ltree[26]!==0)return i;for(kr=32;kr<F;kr++)if(tr.dyn_ltree[2*kr]!==0)return i;return f}(pt)),pr(pt,pt.l_desc),pr(pt,pt.d_desc),nr=function(tr){var kr;for(Ue(tr,tr.dyn_ltree,tr.l_desc.max_code),Ue(tr,tr.dyn_dtree,tr.d_desc.max_code),pr(tr,tr.bl_desc),kr=Q-1;3<=kr&&tr.bl_tree[2*Pt[kr]+1]===0;kr--);return tr.opt_len+=3*(kr+1)+5+5+4,kr}(pt),St=pt.opt_len+3+7>>>3,(Ht=pt.static_len+3+7>>>3)<=St&&(St=Ht)):St=Ht=Si+5,Si+4<=St&&Nt!==-1?Lt(pt,Nt,Si,pi):pt.strategy===4||Ht===St?(Zt(pt,2+(pi?1:0),3),nn(pt,At,ht)):(Zt(pt,4+(pi?1:0),3),function(tr,kr,Mr,Cr){var Tn;for(Zt(tr,kr-257,5),Zt(tr,Mr-1,5),Zt(tr,Cr-4,4),Tn=0;Tn<Cr;Tn++)Zt(tr,tr.bl_tree[2*Pt[Tn]+1],3);ni(tr,tr.dyn_ltree,kr-1),ni(tr,tr.dyn_dtree,Mr-1)}(pt,pt.l_desc.max_code+1,pt.d_desc.max_code+1,nr+1),nn(pt,pt.dyn_ltree,pt.dyn_dtree)),gi(pt),pi&&Oi(pt)},a._tr_tally=function(pt,Nt,Si){return pt.pending_buf[pt.d_buf+2*pt.last_lit]=Nt>>>8&255,pt.pending_buf[pt.d_buf+2*pt.last_lit+1]=255&Nt,pt.pending_buf[pt.l_buf+pt.last_lit]=255&Si,pt.last_lit++,Nt===0?pt.dyn_ltree[2*Si]++:(pt.matches++,Nt--,pt.dyn_ltree[2*(Ae[Si]+F+1)]++,pt.dyn_dtree[2*ei(Nt)]++),pt.last_lit===pt.lit_bufsize-1},a._tr_align=function(pt){Zt(pt,2,3),Kt(pt,Se,At),function(Nt){Nt.bi_valid===16?(ur(Nt,Nt.bi_buf),Nt.bi_buf=0,Nt.bi_valid=0):8<=Nt.bi_valid&&(Nt.pending_buf[Nt.pending++]=255&Nt.bi_buf,Nt.bi_buf>>=8,Nt.bi_valid-=8)}(pt)}},{"../utils/common":41}],53:[function(n,s,a){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,s,a){(function(d){(function(f,i){if(!f.setImmediate){var S,E,L,F,G=1,q={},Q=!1,te=f.document,he=Object.getPrototypeOf&&Object.getPrototypeOf(f);he=he&&he.setTimeout?he:f,S={}.toString.call(f.process)==="[object process]"?function(ke){process.nextTick(function(){le(ke)})}:function(){if(f.postMessage&&!f.importScripts){var ke=!0,Ee=f.onmessage;return f.onmessage=function(){ke=!1},f.postMessage("","*"),f.onmessage=Ee,ke}}()?(F="setImmediate$"+Math.random()+"$",f.addEventListener?f.addEventListener("message",Se,!1):f.attachEvent("onmessage",Se),function(ke){f.postMessage(F+ke,"*")}):f.MessageChannel?((L=new MessageChannel).port1.onmessage=function(ke){le(ke.data)},function(ke){L.port2.postMessage(ke)}):te&&"onreadystatechange"in te.createElement("script")?(E=te.documentElement,function(ke){var Ee=te.createElement("script");Ee.onreadystatechange=function(){le(ke),Ee.onreadystatechange=null,E.removeChild(Ee),Ee=null},E.appendChild(Ee)}):function(ke){setTimeout(le,0,ke)},he.setImmediate=function(ke){typeof ke!="function"&&(ke=new Function(""+ke));for(var Ee=new Array(arguments.length-1),Ie=0;Ie<Ee.length;Ie++)Ee[Ie]=arguments[Ie+1];var He={callback:ke,args:Ee};return q[G]=He,S(G),G++},he.clearImmediate=fe}function fe(ke){delete q[ke]}function le(ke){if(Q)setTimeout(le,0,ke);else{var Ee=q[ke];if(Ee){Q=!0;try{(function(Ie){var He=Ie.callback,Ye=Ie.args;switch(Ye.length){case 0:He();break;case 1:He(Ye[0]);break;case 2:He(Ye[0],Ye[1]);break;case 3:He(Ye[0],Ye[1],Ye[2]);break;default:He.apply(i,Ye)}})(Ee)}finally{fe(ke),Q=!1}}}}function Se(ke){ke.source===f&&typeof ke.data=="string"&&ke.data.indexOf(F)===0&&le(+ke.data.slice(F.length))}})(typeof self>"u"?d===void 0?this:d:self)}).call(this,typeof og<"u"?og:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(pB);var rH=pB.exports;const yO=w_(rH);var fB={};fB.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""};var tL={},fM=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,_O=new RegExp("[\\-\\.0-9"+fM.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),vO=new RegExp("^"+fM.source+_O.source+"*(?::"+fM.source+_O.source+"*)?$"),Qw=0,Gv=1,o1=2,Jw=3,a1=4,l1=5,eS=6,wC=7;function I1(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,I1)}I1.prototype=new Error;I1.prototype.name=I1.name;function mB(){}mB.prototype={parse:function(e,t,n){var s=this.domBuilder;s.startDocument(),gB(t,t={}),nH(e,t,n,s,this.errorHandler),s.endDocument()}};function nH(e,t,n,s,a){function d(bt){if(bt>65535){bt-=65536;var Dt=55296+(bt>>10),Je=56320+(bt&1023);return String.fromCharCode(Dt,Je)}else return String.fromCharCode(bt)}function f(bt){var Dt=bt.slice(1,-1);return Dt in n?n[Dt]:Dt.charAt(0)==="#"?d(parseInt(Dt.substr(1).replace("x","0x"))):(a.error("entity not found:"+bt),bt)}function i(bt){if(bt>te){var Dt=e.substring(te,bt).replace(/&#?\w+;/g,f);G&&S(te),s.characters(Dt,0,bt-te),te=bt}}function S(bt,Dt){for(;bt>=L&&(Dt=F.exec(e));)E=Dt.index,L=E+Dt[0].length,G.lineNumber++;G.columnNumber=bt-E+1}for(var E=0,L=0,F=/.*(?:\r\n?|\n)|.*$/g,G=s.locator,q=[{currentNSMap:t}],Q={},te=0;;){try{var he=e.indexOf("<",te);if(he<0){if(!e.substr(te).match(/^\s*$/)){var fe=s.doc,le=fe.createTextNode(e.substr(te));fe.appendChild(le),s.currentElement=le}return}switch(he>te&&i(he),e.charAt(he+1)){case"/":var At=e.indexOf(">",he+3),Se=e.substring(he+2,At),ke=q.pop();At<0?(Se=e.substring(he+2).replace(/[\s<].*/,""),a.error("end tag name: "+Se+" is not complete:"+ke.tagName),At=he+1+Se.length):Se.match(/\s</)&&(Se=Se.replace(/[\s<].*/,""),a.error("end tag name: "+Se+" maybe not complete"),At=he+1+Se.length);var Ee=ke.localNSMap,Ie=ke.tagName==Se,He=Ie||ke.tagName&&ke.tagName.toLowerCase()==Se.toLowerCase();if(He){if(s.endElement(ke.uri,ke.localName,Se),Ee)for(var Ye in Ee)s.endPrefixMapping(Ye);Ie||a.fatalError("end tag name: "+Se+" is not match the current start tagName:"+ke.tagName)}else q.push(ke);At++;break;case"?":G&&S(he),At=cH(e,he,s);break;case"!":G&&S(he),At=lH(e,he,s,a);break;default:G&&S(he);var lt=new yB,Pt=q[q.length-1].currentNSMap,At=sH(e,he,lt,Pt,f,a),ht=lt.length;if(!lt.closed&&aH(e,At,lt.tagName,Q)&&(lt.closed=!0,n.nbsp||a.warning("unclosed xml attribute")),G&&ht){for(var Ot=xO(G,{}),Ae=0;Ae<ht;Ae++){var mt=lt[Ae];S(mt.offset),mt.locator=xO(G,{})}s.locator=Ot,bO(lt,s,Pt)&&q.push(lt),s.locator=G}else bO(lt,s,Pt)&&q.push(lt);lt.uri==="http://www.w3.org/1999/xhtml"&&!lt.closed?At=oH(e,At,lt.tagName,f,s):At++}}catch(bt){if(bt instanceof I1)throw bt;a.error("element parse error: "+bt),At=-1}At>te?te=At:i(Math.max(he,te)+1)}}function xO(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function sH(e,t,n,s,a,d){function f(G,q,Q){G in n.attributeNames&&d.fatalError("Attribute "+G+" redefined"),n.addValue(G,q,Q)}for(var i,S,E=++t,L=Qw;;){var F=e.charAt(E);switch(F){case"=":if(L===Gv)i=e.slice(t,E),L=Jw;else if(L===o1)L=Jw;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(L===Jw||L===Gv)if(L===Gv&&(d.warning('attribute value must after "="'),i=e.slice(t,E)),t=E+1,E=e.indexOf(F,t),E>0)S=e.slice(t,E).replace(/&#?\w+;/g,a),f(i,S,t-1),L=l1;else throw new Error("attribute value no end '"+F+"' match");else if(L==a1)S=e.slice(t,E).replace(/&#?\w+;/g,a),f(i,S,t),d.warning('attribute "'+i+'" missed start quot('+F+")!!"),t=E+1,L=l1;else throw new Error('attribute value must after "="');break;case"/":switch(L){case Qw:n.setTagName(e.slice(t,E));case l1:case eS:case wC:L=wC,n.closed=!0;case a1:case Gv:case o1:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return d.error("unexpected end of input"),L==Qw&&n.setTagName(e.slice(t,E)),E;case">":switch(L){case Qw:n.setTagName(e.slice(t,E));case l1:case eS:case wC:break;case a1:case Gv:S=e.slice(t,E),S.slice(-1)==="/"&&(n.closed=!0,S=S.slice(0,-1));case o1:L===o1&&(S=i),L==a1?(d.warning('attribute "'+S+'" missed quot(")!'),f(i,S.replace(/&#?\w+;/g,a),t)):((s[""]!=="http://www.w3.org/1999/xhtml"||!S.match(/^(?:disabled|checked|selected)$/i))&&d.warning('attribute "'+S+'" missed value!! "'+S+'" instead!!'),f(S,S,t));break;case Jw:throw new Error("attribute value missed!!")}return E;case"":F=" ";default:if(F<=" ")switch(L){case Qw:n.setTagName(e.slice(t,E)),L=eS;break;case Gv:i=e.slice(t,E),L=o1;break;case a1:var S=e.slice(t,E).replace(/&#?\w+;/g,a);d.warning('attribute "'+S+'" missed quot(")!!'),f(i,S,t);case l1:L=eS;break}else switch(L){case o1:n.tagName,(s[""]!=="http://www.w3.org/1999/xhtml"||!i.match(/^(?:disabled|checked|selected)$/i))&&d.warning('attribute "'+i+'" missed value!! "'+i+'" instead2!!'),f(i,i,t),t=E,L=Gv;break;case l1:d.warning('attribute space is required"'+i+'"!!');case eS:L=Gv,t=E;break;case Jw:L=a1,t=E;break;case wC:throw new Error("elements closed character '/' and '>' must be connected to")}}E++}}function bO(e,t,n){for(var s=e.tagName,a=null,F=e.length;F--;){var d=e[F],f=d.qName,i=d.value,G=f.indexOf(":");if(G>0)var S=d.prefix=f.slice(0,G),E=f.slice(G+1),L=S==="xmlns"&&E;else E=f,S=null,L=f==="xmlns"&&"";d.localName=E,L!==!1&&(a==null&&(a={},gB(n,n={})),n[L]=a[L]=i,d.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(L,i))}for(var F=e.length;F--;){d=e[F];var S=d.prefix;S&&(S==="xml"&&(d.uri="http://www.w3.org/XML/1998/namespace"),S!=="xmlns"&&(d.uri=n[S||""]))}var G=s.indexOf(":");G>0?(S=e.prefix=s.slice(0,G),E=e.localName=s.slice(G+1)):(S=null,E=e.localName=s);var q=e.uri=n[S||""];if(t.startElement(q,E,s,e),e.closed){if(t.endElement(q,E,s),a)for(S in a)t.endPrefixMapping(S)}else return e.currentNSMap=n,e.localNSMap=a,!0}function oH(e,t,n,s,a){if(/^(?:script|textarea)$/i.test(n)){var d=e.indexOf("</"+n+">",t),f=e.substring(t+1,d);if(/[&<]/.test(f))return/^script$/i.test(n)?(a.characters(f,0,f.length),d):(f=f.replace(/&#?\w+;/g,s),a.characters(f,0,f.length),d)}return t+1}function aH(e,t,n,s){var a=s[n];return a==null&&(a=e.lastIndexOf("</"+n+">"),a<t&&(a=e.lastIndexOf("</"+n)),s[n]=a),a<t}function gB(e,t){for(var n in e)t[n]=e[n]}function lH(e,t,n,s){var a=e.charAt(t+2);switch(a){case"-":if(e.charAt(t+3)==="-"){var d=e.indexOf("-->",t+4);return d>t?(n.comment(e,t+4,d-t-4),d+3):(s.error("Unclosed comment"),-1)}else return-1;default:if(e.substr(t+3,6)=="CDATA["){var d=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,d-t-9),n.endCDATA(),d+3}var f=hH(e,t),i=f.length;if(i>1&&/!doctype/i.test(f[0][0])){var S=f[1][0],E=!1,L=!1;i>3&&(/^public$/i.test(f[2][0])?(E=f[3][0],L=i>4&&f[4][0]):/^system$/i.test(f[2][0])&&(L=f[3][0]));var F=f[i-1];return n.startDTD(S,E,L),n.endDTD(),F.index+F[0].length}}return-1}function cH(e,t,n){var s=e.indexOf("?>",t);if(s){var a=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,n.processingInstruction(a[1],a[2]),s+2):-1}return-1}function yB(){this.attributeNames={}}yB.prototype={setTagName:function(e){if(!vO.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!vO.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}};function hH(e,t){var n,s=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=t,a.exec(e);n=a.exec(e);)if(s.push(n),n[1])return s}tL.XMLReader=mB;tL.ParseError=I1;var vT={};function xT(e,t){for(var n in e)t[n]=e[n]}function fg(e,t){var n=e.prototype;if(!(n instanceof t)){let s=function(){};s.prototype=t.prototype,s=new s,xT(n,s),e.prototype=n=s}n.constructor!=e&&(typeof e!="function"&&console.error("unknow Class:"+e),n.constructor=e)}var uH="http://www.w3.org/1999/xhtml",mg={},v0=mg.ELEMENT_NODE=1,L1=mg.ATTRIBUTE_NODE=2,wE=mg.TEXT_NODE=3,_B=mg.CDATA_SECTION_NODE=4,vB=mg.ENTITY_REFERENCE_NODE=5,dH=mg.ENTITY_NODE=6,xB=mg.PROCESSING_INSTRUCTION_NODE=7,bB=mg.COMMENT_NODE=8,wB=mg.DOCUMENT_NODE=9,SB=mg.DOCUMENT_TYPE_NODE=10,rv=mg.DOCUMENT_FRAGMENT_NODE=11,pH=mg.NOTATION_NODE=12,zf={},kp={};zf.INDEX_SIZE_ERR=(kp[1]="Index size error",1);zf.DOMSTRING_SIZE_ERR=(kp[2]="DOMString size error",2);var fH=zf.HIERARCHY_REQUEST_ERR=(kp[3]="Hierarchy request error",3);zf.WRONG_DOCUMENT_ERR=(kp[4]="Wrong document",4);zf.INVALID_CHARACTER_ERR=(kp[5]="Invalid character",5);zf.NO_DATA_ALLOWED_ERR=(kp[6]="No data allowed",6);zf.NO_MODIFICATION_ALLOWED_ERR=(kp[7]="No modification allowed",7);var mH=zf.NOT_FOUND_ERR=(kp[8]="Not found",8);zf.NOT_SUPPORTED_ERR=(kp[9]="Not supported",9);var wO=zf.INUSE_ATTRIBUTE_ERR=(kp[10]="Attribute in use",10);zf.INVALID_STATE_ERR=(kp[11]="Invalid state",11);zf.SYNTAX_ERR=(kp[12]="Syntax error",12);zf.INVALID_MODIFICATION_ERR=(kp[13]="Invalid modification",13);zf.NAMESPACE_ERR=(kp[14]="Invalid namespace",14);zf.INVALID_ACCESS_ERR=(kp[15]="Invalid access",15);function cb(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,kp[e]),this.message=kp[e],Error.captureStackTrace&&Error.captureStackTrace(this,cb);return n.code=e,t&&(this.message=this.message+": "+t),n}cb.prototype=Error.prototype;xT(zf,cb);function tx(){}tx.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],s=0;s<this.length;s++)T1(this[s],n,e,t);return n.join("")}};function D1(e,t){this._node=e,this._refresh=t,iL(this)}function iL(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);OB(e,"length",n.length),xT(n,e),e._inc=t}}D1.prototype.item=function(e){return iL(this),this[e]};fg(D1,tx);function SE(){}function TB(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function SO(e,t,n,s){if(s?t[TB(t,s)]=n:t[t.length++]=n,e){n.ownerElement=e;var a=e.ownerDocument;a&&(s&&EB(a,e,s),gH(a,e,n))}}function TO(e,t,n){var s=TB(t,n);if(s>=0){for(var a=t.length-1;s<a;)t[s]=t[++s];if(t.length=a,e){var d=e.ownerDocument;d&&(EB(d,e,n),n.ownerElement=null)}}else throw cb(mH,new Error(e.tagName+"@"+n))}SE.prototype={length:0,item:tx.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new cb(wO);var n=this.getNamedItem(e.nodeName);return SO(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t=e.ownerElement,n;if(t&&t!=this._ownerElement)throw new cb(wO);return n=this.getNamedItemNS(e.namespaceURI,e.localName),SO(this._ownerElement,this,e,n),n},removeNamedItem:function(e){var t=this.getNamedItem(e);return TO(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return TO(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var s=this[n];if(s.localName==t&&s.namespaceURI==e)return s}return null}};function CB(e){if(this._features={},e)for(var t in e)this._features=e[t]}CB.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!!(n&&(!t||t in n))},createDocument:function(e,t,n){var s=new bT;if(s.implementation=this,s.childNodes=new tx,s.doctype=n,n&&s.appendChild(n),t){var a=s.createElementNS(e,t);s.appendChild(a)}return s},createDocumentType:function(e,t,n){var s=new aL;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=n,s}};function Uf(){}Uf.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return AB(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return kB(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(e){return mM(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==wE&&e.nodeType==wE?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n){for(var s in n)if(n[s]==e)return s}t=t.nodeType==L1?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==L1?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return t==null}};function CO(e){return e=="<"&&"&lt;"||e==">"&&"&gt;"||e=="&"&&"&amp;"||e=='"'&&"&quot;"||"&#"+e.charCodeAt()+";"}xT(mg,Uf);xT(mg,Uf.prototype);function jS(e,t){if(t(e))return!0;if(e=e.firstChild)do if(jS(e,t))return!0;while(e=e.nextSibling)}function bT(){}function gH(e,t,n){e&&e._inc++;var s=n.namespaceURI;s=="http://www.w3.org/2000/xmlns/"&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function EB(e,t,n,s){e&&e._inc++;var a=n.namespaceURI;a=="http://www.w3.org/2000/xmlns/"&&delete t._nsMap[n.prefix?n.localName:""]}function rL(e,t,n){if(e&&e._inc){e._inc++;var s=t.childNodes;if(n)s[s.length++]=n;else{for(var a=t.firstChild,d=0;a;)s[d++]=a,a=a.nextSibling;s.length=d}}}function kB(e,t){var n=t.previousSibling,s=t.nextSibling;return n?n.nextSibling=s:e.firstChild=s,s?s.previousSibling=n:e.lastChild=n,rL(e.ownerDocument,e),t}function AB(e,t,n){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===rv){var a=t.firstChild;if(a==null)return t;var d=t.lastChild}else a=d=t;var f=n?n.previousSibling:e.lastChild;a.previousSibling=f,d.nextSibling=n,f?f.nextSibling=a:e.firstChild=a,n==null?e.lastChild=d:n.previousSibling=d;do a.parentNode=e;while(a!==d&&(a=a.nextSibling));return rL(e.ownerDocument||e,e),t.nodeType==rv&&(t.firstChild=t.lastChild=null),t}function yH(e,t){var n=t.parentNode;if(n){var s=e.lastChild;n.removeChild(t);var s=e.lastChild}var s=e.lastChild;return t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,rL(e.ownerDocument,e,t),t}bT.prototype={nodeName:"#document",nodeType:wB,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==rv){for(var n=e.firstChild;n;){var s=n.nextSibling;this.insertBefore(n,t),n=s}return e}return this.documentElement==null&&e.nodeType==v0&&(this.documentElement=e),AB(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),kB(this,e)},importNode:function(e,t){return PB(this,e,t)},getElementById:function(e){var t=null;return jS(this.documentElement,function(n){if(n.nodeType==v0&&n.getAttribute("id")==e)return t=n,!0}),t},getElementsByClassName:function(e){var t=new RegExp("(^|\\s)"+e+"(\\s|$)");return new D1(this,function(n){var s=[];return jS(n.documentElement,function(a){a!==n&&a.nodeType==v0&&t.test(a.getAttribute("class"))&&s.push(a)}),s})},createElement:function(e){var t=new P1;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new tx;var n=t.attributes=new SE;return n._ownerElement=t,t},createDocumentFragment:function(){var e=new F2;return e.ownerDocument=this,e.childNodes=new tx,e},createTextNode:function(e){var t=new nL;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new sL;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new oL;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new cL;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new TE;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new lL;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new P1,s=t.split(":"),a=n.attributes=new SE;return n.childNodes=new tx,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,s.length==2?(n.prefix=s[0],n.localName=s[1]):n.localName=t,a._ownerElement=n,n},createAttributeNS:function(e,t){var n=new TE,s=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,s.length==2?(n.prefix=s[0],n.localName=s[1]):n.localName=t,n}};fg(bT,Uf);function P1(){this._nsMap={}}P1.prototype={nodeType:v0,hasAttribute:function(e){return this.getAttributeNode(e)!=null},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===rv?this.insertBefore(e,null):yH(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return this.getAttributeNodeNS(e,t)!=null},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+n,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new D1(this,function(t){var n=[];return jS(t,function(s){s!==t&&s.nodeType==v0&&(e==="*"||s.tagName==e)&&n.push(s)}),n})},getElementsByTagNameNS:function(e,t){return new D1(this,function(n){var s=[];return jS(n,function(a){a!==n&&a.nodeType===v0&&(e==="*"||a.namespaceURI===e)&&(t==="*"||a.localName==t)&&s.push(a)}),s})}};bT.prototype.getElementsByTagName=P1.prototype.getElementsByTagName;bT.prototype.getElementsByTagNameNS=P1.prototype.getElementsByTagNameNS;fg(P1,Uf);function TE(){}TE.prototype.nodeType=L1;fg(TE,Uf);function wT(){}wT.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(kp[fH])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){var s=this.data.substring(0,e),a=this.data.substring(e+t);n=s+n+a,this.nodeValue=this.data=n,this.length=n.length}};fg(wT,Uf);function nL(){}nL.prototype={nodeName:"#text",nodeType:wE,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}};fg(nL,wT);function sL(){}sL.prototype={nodeName:"#comment",nodeType:bB};fg(sL,wT);function oL(){}oL.prototype={nodeName:"#cdata-section",nodeType:_B};fg(oL,wT);function aL(){}aL.prototype.nodeType=SB;fg(aL,Uf);function MB(){}MB.prototype.nodeType=pH;fg(MB,Uf);function IB(){}IB.prototype.nodeType=dH;fg(IB,Uf);function lL(){}lL.prototype.nodeType=vB;fg(lL,Uf);function F2(){}F2.prototype.nodeName="#document-fragment";F2.prototype.nodeType=rv;fg(F2,Uf);function cL(){}cL.prototype.nodeType=xB;fg(cL,Uf);function LB(){}LB.prototype.serializeToString=function(e,t,n){return DB.call(e,t,n)};Uf.prototype.toString=DB;function DB(e,t){var n=[],s=this.nodeType==9&&this.documentElement||this,a=s.prefix,d=s.namespaceURI;if(d&&a==null){var a=s.lookupPrefix(d);if(a==null)var f=[{namespace:d,prefix:null}]}return T1(this,n,e,t,f),n.join("")}function EO(e,t,n){var s=e.prefix||"",a=e.namespaceURI;if(!s&&!a||s==="xml"&&a==="http://www.w3.org/XML/1998/namespace"||a=="http://www.w3.org/2000/xmlns/")return!1;for(var d=n.length;d--;){var f=n[d];if(f.prefix==s)return f.namespace!=a}return!0}function T1(e,t,n,s,a){if(s)if(e=s(e),e){if(typeof e=="string"){t.push(e);return}}else return;switch(e.nodeType){case v0:a||(a=[]),a.length;var d=e.attributes,f=d.length,q=e.firstChild,i=e.tagName;n=uH===e.namespaceURI||n,t.push("<",i);for(var S=0;S<f;S++){var E=d.item(S);E.prefix=="xmlns"?a.push({prefix:E.localName,namespace:E.value}):E.nodeName=="xmlns"&&a.push({prefix:"",namespace:E.value})}for(var S=0;S<f;S++){var E=d.item(S);if(EO(E,n,a)){var L=E.prefix||"",F=E.namespaceURI,G=L?" xmlns:"+L:" xmlns";t.push(G,'="',F,'"'),a.push({prefix:L,namespace:F})}T1(E,t,n,s,a)}if(EO(e,n,a)){var L=e.prefix||"",F=e.namespaceURI;if(F){var G=L?" xmlns:"+L:" xmlns";t.push(G,'="',F,'"'),a.push({prefix:L,namespace:F})}}if(q||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(i)){if(t.push(">"),n&&/^script$/i.test(i))for(;q;)q.data?t.push(q.data):T1(q,t,n,s,a),q=q.nextSibling;else for(;q;)T1(q,t,n,s,a),q=q.nextSibling;t.push("</",i,">")}else t.push("/>");return;case wB:case rv:for(var q=e.firstChild;q;)T1(q,t,n,s,a),q=q.nextSibling;return;case L1:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,CO),'"');case wE:return t.push(e.data.replace(/[<&]/g,CO).replace(/]]>/g,"]]&gt;"));case _B:return t.push("<![CDATA[",e.data,"]]>");case bB:return t.push("<!--",e.data,"-->");case SB:var Q=e.publicId,te=e.systemId;if(t.push("<!DOCTYPE ",e.name),Q)t.push(" PUBLIC ",Q),te&&te!="."&&t.push(" ",te),t.push(">");else if(te&&te!=".")t.push(" SYSTEM ",te,">");else{var he=e.internalSubset;he&&t.push(" [",he,"]"),t.push(">")}return;case xB:return t.push("<?",e.target," ",e.data,"?>");case vB:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function PB(e,t,n){var s;switch(t.nodeType){case v0:s=t.cloneNode(!1),s.ownerDocument=e;case rv:break;case L1:n=!0;break}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,n)for(var a=t.firstChild;a;)s.appendChild(PB(e,a,n)),a=a.nextSibling;return s}function mM(e,t,n){var s=new t.constructor;for(var a in t){var d=t[a];typeof d!="object"&&d!=s[a]&&(s[a]=d)}switch(t.childNodes&&(s.childNodes=new tx),s.ownerDocument=e,s.nodeType){case v0:var f=t.attributes,i=s.attributes=new SE,S=f.length;i._ownerElement=s;for(var E=0;E<S;E++)s.setAttributeNode(mM(e,f.item(E),!0));break;case L1:n=!0}if(n)for(var L=t.firstChild;L;)s.appendChild(mM(e,L,n)),L=L.nextSibling;return s}function OB(e,t,n){e[t]=n}try{if(Object.defineProperty){let e=function(t){switch(t.nodeType){case v0:case rv:var n=[];for(t=t.firstChild;t;)t.nodeType!==7&&t.nodeType!==8&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}};Object.defineProperty(D1.prototype,"length",{get:function(){return iL(this),this.$$length}}),Object.defineProperty(Uf.prototype,"textContent",{get:function(){return e(this)},set:function(t){switch(this.nodeType){case v0:case rv:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),OB=function(t,n,s){t["$$"+n]=s}}}catch{}vT.Node=Uf;vT.DOMException=cb;vT.DOMImplementation=CB;vT.XMLSerializer=LB;function _H(e){this.options=e||{locator:{}}}_H.prototype.parseFromString=function(e,t){var n=this.options,s=new bH,a=n.domBuilder||new z2,d=n.errorHandler,f=n.locator,i=n.xmlns||{},S=/\/x?html?$/.test(t),E=S?xH.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return f&&a.setDocumentLocator(f),s.errorHandler=vH(d,a,f),s.domBuilder=n.domBuilder||a,S&&(i[""]="http://www.w3.org/1999/xhtml"),i.xml=i.xml||"http://www.w3.org/XML/1998/namespace",e&&typeof e=="string"?s.parse(e,i,E):s.errorHandler.error("invalid doc source"),a.doc};function vH(e,t,n){if(!e){if(t instanceof z2)return t;e=t}var s={},a=e instanceof Function;n=n||{};function d(f){var i=e[f];!i&&a&&(i=e.length==2?function(S){e(f,S)}:e),s[f]=i&&function(S){i("[xmldom "+f+"]	"+S+gM(n))}||function(){}}return d("warning"),d("error"),d("fatalError"),s}function z2(){this.cdata=!1}function c1(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}z2.prototype={startDocument:function(){this.doc=new SH().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,s){var a=this.doc,d=a.createElementNS(e,n||t),f=s.length;SC(this,d),this.currentElement=d,this.locator&&c1(this.locator,d);for(var i=0;i<f;i++){var e=s.getURI(i),S=s.getValue(i),n=s.getQName(i),E=a.createAttributeNS(e,n);this.locator&&c1(s.getLocator(i),E),E.value=E.nodeValue=S,d.setAttributeNode(E)}},endElement:function(e,t,n){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&c1(this.locator,n),SC(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=kO.apply(this,arguments),e){if(this.cdata)var s=this.doc.createCDATASection(e);else var s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&c1(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=kO.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&c1(this.locator,s),SC(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var s=this.doc.implementation;if(s&&s.createDocumentType){var a=s.createDocumentType(e,t,n);this.locator&&c1(this.locator,a),SC(this,a)}},warning:function(e){console.warn("[xmldom warning]	"+e,gM(this.locator))},error:function(e){console.error("[xmldom error]	"+e,gM(this.locator))},fatalError:function(e){throw new wH(e,this.locator)}};function gM(e){if(e)return`
@`+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function kO(e,t,n){return typeof e=="string"?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){z2.prototype[e]=function(){return null}});function SC(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}var xH=fB,RB=tL,bH=RB.XMLReader,wH=RB.ParseError,SH=vT.DOMImplementation;function x0(e,t){return Array.from(e.getElementsByTagName(t))}function CE(e){return e[0]==="#"?e:`#${e}`}function TH(e,t,n){return Array.from(e.getElementsByTagNameNS(n,t))}function Yg(e){return e==null||e.normalize(),(e==null?void 0:e.textContent)||""}function Bf(e,t,n){const s=e.getElementsByTagName(t),a=s.length?s[0]:null;return a&&n&&n(a),a}function S0(e,t,n){const s={};if(!e)return s;const a=e.getElementsByTagName(t),d=a.length?a[0]:null;return d&&n?n(d,s):s}function O1(e,t,n){const s=Yg(Bf(e,t));return s&&n?n(s)||{}:{}}function ag(e,t,n){const s=Number.parseFloat(Yg(Bf(e,t)));if(!Number.isNaN(s))return n&&n(s),s}function U2(e,t){const n={};for(const s of t)O1(e,s,a=>{n[s]=a});return n}function NB(e){return(e==null?void 0:e.nodeType)===1}function BB(e,t){const n={},s=t==="stroke"||t==="fill"?t:`${t}-color`;return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?n[s]=`#${e}`:e.length===8&&(n[`${t}-opacity`]=Number.parseInt(e.substring(0,2),16)/255,n[s]=`#${e.substring(6,8)}${e.substring(4,6)}${e.substring(2,4)}`),n}function EE(e,t,n){const s={};return ag(e,t,a=>{s[n]=a}),s}function hL(e,t){return S0(e,"color",n=>BB(Yg(n),t))}function uL(e){return S0(e,"Icon",(t,n)=>(O1(t,"href",s=>{n.icon=s}),n))}function CH(e){return S0(e,"IconStyle",t=>Object.assign(hL(t,"icon"),EE(t,"scale","icon-scale"),EE(t,"heading","icon-heading"),S0(t,"hotSpot",n=>{const s=Number.parseFloat(n.getAttribute("x")||""),a=Number.parseFloat(n.getAttribute("y")||""),d=n.getAttribute("xunits")||"",f=n.getAttribute("yunits")||"";return!Number.isNaN(s)&&!Number.isNaN(a)?{"icon-offset":[s,a],"icon-offset-units":[d,f]}:{}}),uL(t)))}function EH(e){return S0(e,"LabelStyle",t=>Object.assign(hL(t,"label"),EE(t,"scale","label-scale")))}function kH(e){return S0(e,"LineStyle",t=>Object.assign(hL(t,"stroke"),EE(t,"width","stroke-width")))}function AH(e){return S0(e,"PolyStyle",(t,n)=>Object.assign(n,S0(t,"color",s=>BB(Yg(s),"fill")),O1(t,"fill",s=>{if(s==="0")return{"fill-opacity":0}}),O1(t,"outline",s=>{if(s==="0")return{"stroke-opacity":0}})))}function $2(e){return Object.assign({},AH(e),kH(e),EH(e),CH(e))}const MH=/\s*/g,IH=/^\s*|\s*$/g,LH=/\s+/;function FB(e){return e.replace(MH,"").split(",").map(Number.parseFloat).filter(t=>!Number.isNaN(t)).slice(0,3)}function yM(e){return e.replace(IH,"").split(LH).map(FB).filter(t=>t.length>=2)}function DH(e){let t=x0(e,"coord");t.length===0&&(t=TH(e,"coord","*"));const n=t.map(s=>Yg(s).split(" ").map(Number.parseFloat));return n.length===0?null:{geometry:n.length>2?{type:"LineString",coordinates:n}:{type:"Point",coordinates:n[0]},times:x0(e,"when").map(s=>Yg(s))}}function zB(e){if(e.length===0)return e;const t=e[0],n=e[e.length-1];let s=!0;for(let a=0;a<Math.max(t.length,n.length);a++)if(t[a]!==n[a]){s=!1;break}return s?e:e.concat([e[0]])}function ZC(e){return Yg(Bf(e,"coordinates"))}function UB(e){let t=[],n=[];for(let s=0;s<e.childNodes.length;s++){const a=e.childNodes.item(s);if(NB(a))switch(a.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const d=UB(a);t=t.concat(d.geometries),n=n.concat(d.coordTimes);break}case"Point":{const d=FB(ZC(a));d.length>=2&&t.push({type:"Point",coordinates:d});break}case"LinearRing":case"LineString":{const d=yM(ZC(a));d.length>=2&&t.push({type:"LineString",coordinates:d});break}case"Polygon":{const d=[];for(const f of x0(a,"LinearRing")){const i=zB(yM(ZC(f)));i.length>=4&&d.push(i)}d.length&&t.push({type:"Polygon",coordinates:d});break}case"Track":case"gx:Track":{const d=DH(a);if(!d)break;const{times:f,geometry:i}=d;t.push(i),f.length&&n.push(f);break}}}return{geometries:t,coordTimes:n}}const h1=e=>Number(e),_M={string:e=>e,int:h1,uint:h1,short:h1,ushort:h1,float:h1,double:h1,bool:e=>!!e};function dL(e,t){return S0(e,"ExtendedData",(n,s)=>{for(const a of x0(n,"Data"))s[a.getAttribute("name")||""]=Yg(Bf(a,"value"));for(const a of x0(n,"SimpleData")){const d=a.getAttribute("name")||"",f=t[d]||_M.string;s[d]=f(Yg(a))}return s})}function pL(e){const t=Bf(e,"description");for(const n of Array.from((t==null?void 0:t.childNodes)||[]))if(n.nodeType===4)return{description:{"@type":"html",value:Yg(n)}};return{}}function fL(e){return S0(e,"TimeSpan",t=>({timespan:{begin:Yg(Bf(t,"begin")),end:Yg(Bf(t,"end"))}}))}function mL(e){return S0(e,"TimeStamp",t=>({timestamp:Yg(Bf(t,"when"))}))}function gL(e,t){return O1(e,"styleUrl",n=>(n=CE(n),t[n]?Object.assign({styleUrl:n},t[n]):{styleUrl:n}))}var Iy;(function(e){e.ABSOLUTE="absolute",e.RELATIVE_TO_GROUND="relativeToGround",e.CLAMP_TO_GROUND="clampToGround",e.CLAMP_TO_SEAFLOOR="clampToSeaFloor",e.RELATIVE_TO_SEAFLOOR="relativeToSeaFloor"})(Iy||(Iy={}));function PH(e){switch(e==null?void 0:e.textContent){case Iy.ABSOLUTE:return Iy.ABSOLUTE;case Iy.CLAMP_TO_GROUND:return Iy.CLAMP_TO_GROUND;case Iy.CLAMP_TO_SEAFLOOR:return Iy.CLAMP_TO_SEAFLOOR;case Iy.RELATIVE_TO_GROUND:return Iy.RELATIVE_TO_GROUND;case Iy.RELATIVE_TO_SEAFLOOR:return Iy.RELATIVE_TO_SEAFLOOR}return null}function OH(e){return Bf(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[zB(yM(ZC(e)))]}}:BH(e)}const RH=Math.PI/180;function NH(e,t,n){const s=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[t[0].map(a=>{const d=a[1]-s[1],f=a[0]-s[0],i=Math.sqrt(d**2+f**2),S=Math.atan2(d,f)+n*RH;return[s[0]+Math.cos(S)*i,s[1]+Math.sin(S)*i]})]}function BH(e){const t=Bf(e,"LatLonBox");if(t){const n=ag(t,"north"),s=ag(t,"west"),a=ag(t,"east"),d=ag(t,"south"),f=ag(t,"rotation");if(typeof n=="number"&&typeof d=="number"&&typeof s=="number"&&typeof a=="number"){const i=[s,d,a,n];let S=[[[s,n],[a,n],[a,d],[s,d],[s,n]]];return typeof f=="number"&&(S=NH(i,S,f)),{bbox:i,geometry:{type:"Polygon",coordinates:S}}}}return null}function FH(e,t,n,s){var S;const a=OH(e),d=(a==null?void 0:a.geometry)||null;if(!d&&s.skipNullGeometry)return null;const f={type:"Feature",geometry:d,properties:Object.assign({"@geometry-type":"groundoverlay"},U2(e,["name","address","visibility","open","phoneNumber","description"]),pL(e),gL(e,t),$2(e),uL(e),dL(e,n),fL(e),mL(e))};a!=null&&a.bbox&&(f.bbox=a.bbox),((S=f.properties)==null?void 0:S.visibility)!==void 0&&(f.properties.visibility=f.properties.visibility!=="0");const i=e.getAttribute("id");return i!==null&&i!==""&&(f.id=i),f}function zH(e){const t=Bf(e,"Region");return t?{coordinateBox:$H(t),lod:UH(e)}:null}function UH(e){const t=Bf(e,"Lod");return t?[ag(t,"minLodPixels")??-1,ag(t,"maxLodPixels")??-1,ag(t,"minFadeExtent")??null,ag(t,"maxFadeExtent")??null]:null}function $H(e){const t=Bf(e,"LatLonAltBox");if(t){const n=ag(t,"north"),s=ag(t,"west"),a=ag(t,"east"),d=ag(t,"south");if(PH(Bf(t,"altitudeMode")||Bf(t,"gx:altitudeMode"))&&console.debug("Encountered an unsupported feature of KML for togeojson: please contact developers for support of altitude mode."),typeof n=="number"&&typeof d=="number"&&typeof s=="number"&&typeof a=="number")return{bbox:[s,d,a,n],geometry:{type:"Polygon",coordinates:[[[s,n],[a,n],[a,d],[s,d],[s,n]]]}}}return null}function VH(e){const t=Bf(e,"Link");return t?U2(t,["href","refreshMode","refreshInterval","viewRefreshMode","viewRefreshTime","viewBoundScale","viewFormat","httpQuery"]):{}}function WH(e,t,n,s){var S,E,L;const a=zH(e),d=((S=a==null?void 0:a.coordinateBox)==null?void 0:S.geometry)||null;if(!d&&s.skipNullGeometry)return null;const f={type:"Feature",geometry:d,properties:Object.assign({"@geometry-type":"networklink"},U2(e,["name","address","visibility","open","phoneNumber","styleUrl","refreshVisibility","flyToView","description"]),pL(e),gL(e,t),$2(e),uL(e),dL(e,n),fL(e),mL(e),VH(e),a!=null&&a.lod?{lod:a.lod}:{})};(E=a==null?void 0:a.coordinateBox)!=null&&E.bbox&&(f.bbox=a.coordinateBox.bbox),((L=f.properties)==null?void 0:L.visibility)!==void 0&&(f.properties.visibility=f.properties.visibility!=="0");const i=e.getAttribute("id");return i!==null&&i!==""&&(f.id=i),f}function jH(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function HH(e,t,n,s){var E;const{coordTimes:a,geometries:d}=UB(e),f=jH(d);if(!f&&s.skipNullGeometry)return null;const i={type:"Feature",geometry:f,properties:Object.assign(U2(e,["name","address","visibility","open","phoneNumber","description"]),pL(e),gL(e,t),$2(e),dL(e,n),fL(e),mL(e),a.length?{coordinateProperties:{times:a.length===1?a[0]:a}}:{})};((E=i.properties)==null?void 0:E.visibility)!==void 0&&(i.properties.visibility=i.properties.visibility!=="0");const S=e.getAttribute("id");return S!==null&&S!==""&&(i.id=S),i}function GH(e){let t=e.getAttribute("id");const n=e.parentNode;return!t&&NB(n)&&n.localName==="CascadingStyle"&&(t=n.getAttribute("kml:id")||n.getAttribute("id")),CE(t||"")}function qH(e){const t={};for(const n of x0(e,"Style"))t[GH(n)]=$2(n);for(const n of x0(e,"StyleMap")){const s=CE(n.getAttribute("id")||"");O1(n,"styleUrl",a=>{a=CE(a),t[a]&&(t[s]=t[a])})}return t}function YH(e){const t={};for(const n of x0(e,"SimpleField"))t[n.getAttribute("name")||""]=_M[n.getAttribute("type")||""]||_M.string;return t}function*XH(e,t={skipNullGeometry:!1}){const n=e,s=qH(n),a=YH(n);for(const d of x0(n,"Placemark")){const f=HH(d,s,a,t);f&&(yield f)}for(const d of x0(n,"GroundOverlay")){const f=FH(d,s,a,t);f&&(yield f)}for(const d of x0(n,"NetworkLink")){const f=WH(d,s,a,t);f&&(yield f)}}function AO(e,t={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(XH(e,t))}}const ZH=async e=>{try{return await Go.get(e)}catch(t){return console.error("Error fetching data : ",t),{error:"Error fetching data. Please try again later."}}},KH=async(e,t)=>{var n;if(!t||t.trim()==="")return!1;try{const s=`/o/krypton-common-api/v1.0/customer-users-by-account-no?customerAccountNo=${t}`,a=await Go.get(s);console.debug("isUserCustomerAdmin response:",a);const d=(n=a==null?void 0:a.data)==null?void 0:n.data;return Array.isArray(d)?d.some(f=>Number(f.userId)===Number(e)&&f.isPrimary===!0):(console.error("Unexpected response format in isUserCustomerAdmin:",a),!1)}catch(s){return console.error("Error fetching data : ",s),{error:"Error fetching data. Please try again later."}}},QH=async e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=new Uint8Array([...t].map(d=>d.charCodeAt(0))),s=new Blob([n],{type:"application/vnd.google-earth.kmz"});return URL.createObjectURL(s)},JH=async e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=new Uint8Array([...t].map(d=>d.charCodeAt(0))),s=new Blob([n],{type:"application/vnd.google-earth.kml+xml"});return URL.createObjectURL(s)},yA=async e=>{try{const t=`/o/krypton-common-api/v1.0/kmz-document-details-by-service?serviceId=${e}`;return await Go.get(t)}catch(t){return console.error("Error fetching KMZ Document detail:",t),{error:"Failed to fetch KMZ Document detail. Please try again later."}}},eG=(e,t)=>{if(!e){console.error("No file data available");return}let n;try{n=atob(e)}catch(L){console.error("Error decoding base64 string",L);return}const s=Uint8Array.from(n,L=>L.charCodeAt(0)),a=new Blob([s],{type:"application/pdf"}),d=URL.createObjectURL(a),f=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>${t}</title>
          <style>html, body { margin: 0; height: 100%; }</style>
        </head>
        <body>
          <embed src="${d}" width="100%" height="100%" type="application/pdf" />
        </body>
      </html>
    `,i=new Blob([f],{type:"text/html"}),S=URL.createObjectURL(i);window.open(S,"_blank","noopener,noreferrer")||console.error("Popup blocked. Please allow pop-ups for this site.")},tG=e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=Uint8Array.from(t,d=>d.charCodeAt(0)),s=new Blob([n],{type:"application/pdf"});return URL.createObjectURL(s)},iG=e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=Uint8Array.from(t,d=>d.charCodeAt(0)),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return URL.createObjectURL(s)},rG=(e,t)=>{if(!e)return console.error("No file data available"),null;e.startsWith("data:image")&&(e=e.split(",")[1]);let n;try{n=atob(e)}catch(i){return console.error("Error decoding base64 string",i),null}const s=Uint8Array.from(n,i=>i.charCodeAt(0));let a,d;return["png","jpg","jpeg"].includes(t)&&(d=`image/${t}`,a=new Blob([s],{type:d})),URL.createObjectURL(a)},nG=(e,t,n)=>{if(!e){console.error("No file data available");return}e.startsWith("data:image")&&(e=e.split(",")[1]);let s;try{s=atob(e)}catch(E){console.error("Error decoding base64 string",E);return}const a=Uint8Array.from(s,E=>E.charCodeAt(0));let d,f;if(["png","jpg","jpeg"].includes(t))f=`image/${t}`,d=new Blob([a],{type:f});else{console.error("Unsupported file type for image preview");return}const i=URL.createObjectURL(d);window.open(i,"_blank","noopener,noreferrer")||alert("Pop-up blocked! Please allow pop-ups for this website.")},sG=async(e,t)=>{var n;try{const s=await Go.post(e,t);return(n=s==null?void 0:s.data)!=null&&n.error?{error:s.data.error}:{data:s||[]}}catch(s){return console.error("Error adding data:",s),{error:"Failed to add data. Please try again later."}}},$B=async(e,t,n,s)=>{var a;try{const d=`/o/krypton-common-api/v1.0/add/activity-log?action=${e}&portalCompanyId=${Number(s)}&portalSiteId=${Number(n)}&portalUserID=${Number(t)}&realUserId=${Number(Liferay.ThemeDisplay.getRealUserId())}`,f=await Go.post(d);return{data:(a=f==null?void 0:f.data)==null?void 0:a.message}}catch(d){console.error("Error while adding activity log:",d)}},qg=async(e,t,n,s)=>{var a;try{const d=`/o/krypton-common-api/v1.0/checkPermissions?userId=${e}&portletName=${t}&modelName=${n}&actionId=${s}`,f=await Go.get(d);return(a=f==null?void 0:f.data)!=null&&a.error?{error:f.data.error}:(f==null?void 0:f.data)===!1?{data:!1}:{data:(f==null?void 0:f.data)??!1}}catch(d){return console.error("Error checking permission:",d),{error:"Failed to check permission. Please try again later."}}},VB=async(e,t,n)=>{var s;try{const a="/o/krypton-common-api/v1.0/check-module-permissions",d={actionIds:n,portletName:e,modelName:t,userId:Liferay.ThemeDisplay.getUserId()},f=await Go.post(a,d);return(s=f==null?void 0:f.data)!=null&&s.error?{error:f.data.error}:(f==null?void 0:f.data)===!1?{data:!1}:{data:(f==null?void 0:f.data)??data}}catch(a){return console.error("Error checking permission:",a),{error:"Failed to check permission. Please try again later."}}},WB=async(e,t,n)=>{try{const s=`/o/krypton-service-api/v1.0/basic-service-details?serviceId=${e}&productName=${t}&customerAccountNo=${n}`;return await Go.get(s)}catch(s){return console.error("Error fetching service detail:",s),{error:"Failed to fetch service detail. Please try again later."}}},jB=async(e,t)=>{try{const n=`/o/krypton-common-api/v1.0/user-customer-account-no?userId=${e}&siteId=${t}`;return await Go.get(n)}catch(n){return console.error("Error fetching user customer account no:",n),{error:"Failed to fetch user customer account no. Please try again later."}}},MO=async(e,t,n)=>{try{const s=`/o/krypton-service-api/v1.0/service-documents?serviceId=${e}&productName=${t}&customerAccountNo=${n}`;return await Go.get(s)}catch(s){return console.error("Error fetching service documents:",s),{error:"Failed to fetch service documents. Please try again later."}}},oG=async e=>{try{const t=`/o/krypton-common-api/v1.0/document-details?documents=${e}`;return await Go.get(t)}catch(t){return console.error("Error fetching documents:",t),{error:"Failed to fetch documents. Please try again later."}}},R1=async(e,t,n,s,a,d)=>{try{const f=`/o/krypton-common-api/v1.0/service-sla-details?serviceId=${e}&customerAccountNo=${n}&fromTime=${s}&toTime=${a}&period=${t}&type=${d}`;return await Go.get(f)}catch(f){return console.error("Error fetching service SLA details:",f),{error:"Failed to fetch service SLA details. Please try again later."}}},aG=({onTabChange:e,activeTab:t,productName:n,relatedTicketDetails:s})=>{const[a,d]=It(0);return Ar(()=>{var f,i,S,E;s&&(s!=null&&s.data)&&Array.isArray((f=s==null?void 0:s.data)==null?void 0:f.items)?d(Number(((i=s==null?void 0:s.data)==null?void 0:i.totalCount)??((E=(S=s==null?void 0:s.data)==null?void 0:S.items)==null?void 0:E.length))):d(0)},[s]),B.createElement(B.Fragment,null,B.createElement("div",{className:"tabular-tab"},B.createElement("ul",{className:"tabular-tab-nav"},B.createElement("li",{className:"tabular-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("relatedTicket"),className:`${t==="relatedTicket"?"active":""}`,title:"Related Tickets"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"shoppingmode")," ",Liferay.Language.get("krypton-service-detail-related-tickets-tab")," (",a,") ")),B.createElement("li",{className:"tabular-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("testReports"),className:`${t==="testReports"?"active":""}`,title:"Test Reports"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"lab_profile")," ",Liferay.Language.get("krypton-service-detail-test-reports-tab")," ")),B.createElement("li",{className:"tabular-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("escalationMatrix"),className:`${t==="escalationMatrix"?"active":""}`,title:"Escalation Matrix"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"contact_mail")," ",Liferay.Language.get("krypton-service-detail-escalation-matrix-tab")," ")))))},lG="modulepreload",cG=function(e){return"/o/krypton-service-details-cx/"+e},IO={},ah=function(t,n,s){if(!n||n.length===0)return t();const a=document.getElementsByTagName("link");return Promise.all(n.map(d=>{if(d=cG(d),d in IO)return;IO[d]=!0;const f=d.endsWith(".css"),i=f?'[rel="stylesheet"]':"";if(!!s)for(let L=a.length-1;L>=0;L--){const F=a[L];if(F.href===d&&(!f||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${i}`))return;const E=document.createElement("link");if(E.rel=f?"stylesheet":lG,f||(E.as="script",E.crossOrigin=""),E.href=d,document.head.appendChild(E),f)return new Promise((L,F)=>{E.addEventListener("load",L),E.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>t()).catch(d=>{const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d})};var HB={exports:{}};(function(e,t){(function(n,s){e.exports=s()})(og,function(){var n=1e3,s=6e4,a=36e5,d="millisecond",f="second",i="minute",S="hour",E="day",L="week",F="month",G="quarter",q="year",Q="date",te="Invalid Date",he=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,fe=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Ae){var mt=["th","st","nd","rd"],bt=Ae%100;return"["+Ae+(mt[(bt-20)%10]||mt[bt]||mt[0])+"]"}},Se=function(Ae,mt,bt){var Dt=String(Ae);return!Dt||Dt.length>=mt?Ae:""+Array(mt+1-Dt.length).join(bt)+Ae},ke={s:Se,z:function(Ae){var mt=-Ae.utcOffset(),bt=Math.abs(mt),Dt=Math.floor(bt/60),Je=bt%60;return(mt<=0?"+":"-")+Se(Dt,2,"0")+":"+Se(Je,2,"0")},m:function Ae(mt,bt){if(mt.date()<bt.date())return-Ae(bt,mt);var Dt=12*(bt.year()-mt.year())+(bt.month()-mt.month()),Je=mt.clone().add(Dt,F),dt=bt-Je<0,ui=mt.clone().add(Dt+(dt?-1:1),F);return+(-(Dt+(bt-Je)/(dt?Je-ui:ui-Je))||0)},a:function(Ae){return Ae<0?Math.ceil(Ae)||0:Math.floor(Ae)},p:function(Ae){return{M:F,y:q,w:L,d:E,D:Q,h:S,m:i,s:f,ms:d,Q:G}[Ae]||String(Ae||"").toLowerCase().replace(/s$/,"")},u:function(Ae){return Ae===void 0}},Ee="en",Ie={};Ie[Ee]=le;var He="$isDayjsObject",Ye=function(Ae){return Ae instanceof ht||!(!Ae||!Ae[He])},lt=function Ae(mt,bt,Dt){var Je;if(!mt)return Ee;if(typeof mt=="string"){var dt=mt.toLowerCase();Ie[dt]&&(Je=dt),bt&&(Ie[dt]=bt,Je=dt);var ui=mt.split("-");if(!Je&&ui.length>1)return Ae(ui[0])}else{var Vt=mt.name;Ie[Vt]=mt,Je=Vt}return!Dt&&Je&&(Ee=Je),Je||!Dt&&Ee},Pt=function(Ae,mt){if(Ye(Ae))return Ae.clone();var bt=typeof mt=="object"?mt:{};return bt.date=Ae,bt.args=arguments,new ht(bt)},At=ke;At.l=lt,At.i=Ye,At.w=function(Ae,mt){return Pt(Ae,{locale:mt.$L,utc:mt.$u,x:mt.$x,$offset:mt.$offset})};var ht=function(){function Ae(bt){this.$L=lt(bt.locale,null,!0),this.parse(bt),this.$x=this.$x||bt.x||{},this[He]=!0}var mt=Ae.prototype;return mt.parse=function(bt){this.$d=function(Dt){var Je=Dt.date,dt=Dt.utc;if(Je===null)return new Date(NaN);if(At.u(Je))return new Date;if(Je instanceof Date)return new Date(Je);if(typeof Je=="string"&&!/Z$/i.test(Je)){var ui=Je.match(he);if(ui){var Vt=ui[2]-1||0,ei=(ui[7]||"0").substring(0,3);return dt?new Date(Date.UTC(ui[1],Vt,ui[3]||1,ui[4]||0,ui[5]||0,ui[6]||0,ei)):new Date(ui[1],Vt,ui[3]||1,ui[4]||0,ui[5]||0,ui[6]||0,ei)}}return new Date(Je)}(bt),this.init()},mt.init=function(){var bt=this.$d;this.$y=bt.getFullYear(),this.$M=bt.getMonth(),this.$D=bt.getDate(),this.$W=bt.getDay(),this.$H=bt.getHours(),this.$m=bt.getMinutes(),this.$s=bt.getSeconds(),this.$ms=bt.getMilliseconds()},mt.$utils=function(){return At},mt.isValid=function(){return this.$d.toString()!==te},mt.isSame=function(bt,Dt){var Je=Pt(bt);return this.startOf(Dt)<=Je&&Je<=this.endOf(Dt)},mt.isAfter=function(bt,Dt){return Pt(bt)<this.startOf(Dt)},mt.isBefore=function(bt,Dt){return this.endOf(Dt)<Pt(bt)},mt.$g=function(bt,Dt,Je){return At.u(bt)?this[Dt]:this.set(Je,bt)},mt.unix=function(){return Math.floor(this.valueOf()/1e3)},mt.valueOf=function(){return this.$d.getTime()},mt.startOf=function(bt,Dt){var Je=this,dt=!!At.u(Dt)||Dt,ui=At.p(bt),Vt=function(Oi,cr){var ji=At.w(Je.$u?Date.UTC(Je.$y,cr,Oi):new Date(Je.$y,cr,Oi),Je);return dt?ji:ji.endOf(E)},ei=function(Oi,cr){return At.w(Je.toDate()[Oi].apply(Je.toDate("s"),(dt?[0,0,0,0]:[23,59,59,999]).slice(cr)),Je)},ur=this.$W,Zt=this.$M,Kt=this.$D,Ui="set"+(this.$u?"UTC":"");switch(ui){case q:return dt?Vt(1,0):Vt(31,11);case F:return dt?Vt(1,Zt):Vt(0,Zt+1);case L:var rr=this.$locale().weekStart||0,gi=(ur<rr?ur+7:ur)-rr;return Vt(dt?Kt-gi:Kt+(6-gi),Zt);case E:case Q:return ei(Ui+"Hours",0);case S:return ei(Ui+"Minutes",1);case i:return ei(Ui+"Seconds",2);case f:return ei(Ui+"Milliseconds",3);default:return this.clone()}},mt.endOf=function(bt){return this.startOf(bt,!1)},mt.$set=function(bt,Dt){var Je,dt=At.p(bt),ui="set"+(this.$u?"UTC":""),Vt=(Je={},Je[E]=ui+"Date",Je[Q]=ui+"Date",Je[F]=ui+"Month",Je[q]=ui+"FullYear",Je[S]=ui+"Hours",Je[i]=ui+"Minutes",Je[f]=ui+"Seconds",Je[d]=ui+"Milliseconds",Je)[dt],ei=dt===E?this.$D+(Dt-this.$W):Dt;if(dt===F||dt===q){var ur=this.clone().set(Q,1);ur.$d[Vt](ei),ur.init(),this.$d=ur.set(Q,Math.min(this.$D,ur.daysInMonth())).$d}else Vt&&this.$d[Vt](ei);return this.init(),this},mt.set=function(bt,Dt){return this.clone().$set(bt,Dt)},mt.get=function(bt){return this[At.p(bt)]()},mt.add=function(bt,Dt){var Je,dt=this;bt=Number(bt);var ui=At.p(Dt),Vt=function(Zt){var Kt=Pt(dt);return At.w(Kt.date(Kt.date()+Math.round(Zt*bt)),dt)};if(ui===F)return this.set(F,this.$M+bt);if(ui===q)return this.set(q,this.$y+bt);if(ui===E)return Vt(1);if(ui===L)return Vt(7);var ei=(Je={},Je[i]=s,Je[S]=a,Je[f]=n,Je)[ui]||1,ur=this.$d.getTime()+bt*ei;return At.w(ur,this)},mt.subtract=function(bt,Dt){return this.add(-1*bt,Dt)},mt.format=function(bt){var Dt=this,Je=this.$locale();if(!this.isValid())return Je.invalidDate||te;var dt=bt||"YYYY-MM-DDTHH:mm:ssZ",ui=At.z(this),Vt=this.$H,ei=this.$m,ur=this.$M,Zt=Je.weekdays,Kt=Je.months,Ui=Je.meridiem,rr=function(cr,ji,nn,pr){return cr&&(cr[ji]||cr(Dt,dt))||nn[ji].slice(0,pr)},gi=function(cr){return At.s(Vt%12||12,cr,"0")},Oi=Ui||function(cr,ji,nn){var pr=cr<12?"AM":"PM";return nn?pr.toLowerCase():pr};return dt.replace(fe,function(cr,ji){return ji||function(nn){switch(nn){case"YY":return String(Dt.$y).slice(-2);case"YYYY":return At.s(Dt.$y,4,"0");case"M":return ur+1;case"MM":return At.s(ur+1,2,"0");case"MMM":return rr(Je.monthsShort,ur,Kt,3);case"MMMM":return rr(Kt,ur);case"D":return Dt.$D;case"DD":return At.s(Dt.$D,2,"0");case"d":return String(Dt.$W);case"dd":return rr(Je.weekdaysMin,Dt.$W,Zt,2);case"ddd":return rr(Je.weekdaysShort,Dt.$W,Zt,3);case"dddd":return Zt[Dt.$W];case"H":return String(Vt);case"HH":return At.s(Vt,2,"0");case"h":return gi(1);case"hh":return gi(2);case"a":return Oi(Vt,ei,!0);case"A":return Oi(Vt,ei,!1);case"m":return String(ei);case"mm":return At.s(ei,2,"0");case"s":return String(Dt.$s);case"ss":return At.s(Dt.$s,2,"0");case"SSS":return At.s(Dt.$ms,3,"0");case"Z":return ui}return null}(cr)||ui.replace(":","")})},mt.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},mt.diff=function(bt,Dt,Je){var dt,ui=this,Vt=At.p(Dt),ei=Pt(bt),ur=(ei.utcOffset()-this.utcOffset())*s,Zt=this-ei,Kt=function(){return At.m(ui,ei)};switch(Vt){case q:dt=Kt()/12;break;case F:dt=Kt();break;case G:dt=Kt()/3;break;case L:dt=(Zt-ur)/6048e5;break;case E:dt=(Zt-ur)/864e5;break;case S:dt=Zt/a;break;case i:dt=Zt/s;break;case f:dt=Zt/n;break;default:dt=Zt}return Je?dt:At.a(dt)},mt.daysInMonth=function(){return this.endOf(F).$D},mt.$locale=function(){return Ie[this.$L]},mt.locale=function(bt,Dt){if(!bt)return this.$L;var Je=this.clone(),dt=lt(bt,Dt,!0);return dt&&(Je.$L=dt),Je},mt.clone=function(){return At.w(this.$d,this)},mt.toDate=function(){return new Date(this.valueOf())},mt.toJSON=function(){return this.isValid()?this.toISOString():null},mt.toISOString=function(){return this.$d.toISOString()},mt.toString=function(){return this.$d.toUTCString()},Ae}(),Ot=ht.prototype;return Pt.prototype=Ot,[["$ms",d],["$s",f],["$m",i],["$H",S],["$W",E],["$M",F],["$y",q],["$D",Q]].forEach(function(Ae){Ot[Ae[1]]=function(mt){return this.$g(mt,Ae[0],Ae[1])}}),Pt.extend=function(Ae,mt){return Ae.$i||(Ae(mt,ht,Pt),Ae.$i=!0),Pt},Pt.locale=lt,Pt.isDayjs=Ye,Pt.unix=function(Ae){return Pt(1e3*Ae)},Pt.en=Ie[Ee],Pt.Ls=Ie,Pt.p={},Pt})})(HB);var hG=HB.exports;const uG=w_(hG),KC={min:{r:0,g:0,b:0,s:0,l:0,a:0},max:{r:255,g:255,b:255,h:360,s:100,l:100,a:1},clamp:{r:e=>e>=255?255:e<0?0:e,g:e=>e>=255?255:e<0?0:e,b:e=>e>=255?255:e<0?0:e,h:e=>e%360,s:e=>e>=100?100:e<0?0:e,l:e=>e>=100?100:e<0?0:e,a:e=>e>=1?1:e<0?0:e},toLinear:e=>{const t=e/255;return e>.03928?Math.pow((t+.055)/1.055,2.4):t/12.92},hue2rgb:(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e),hsl2rgb:({h:e,s:t,l:n},s)=>{if(!t)return n*2.55;e/=360,t/=100,n/=100;const a=n<.5?n*(1+t):n+t-n*t,d=2*n-a;switch(s){case"r":return KC.hue2rgb(d,a,e+1/3)*255;case"g":return KC.hue2rgb(d,a,e)*255;case"b":return KC.hue2rgb(d,a,e-1/3)*255}},rgb2hsl:({r:e,g:t,b:n},s)=>{e/=255,t/=255,n/=255;const a=Math.max(e,t,n),d=Math.min(e,t,n),f=(a+d)/2;if(s==="l")return f*100;if(a===d)return 0;const i=a-d,S=f>.5?i/(2-a-d):i/(a+d);if(s==="s")return S*100;switch(a){case e:return((t-n)/i+(t<n?6:0))*60;case t:return((n-e)/i+2)*60;case n:return((e-t)/i+4)*60;default:return-1}}},dG=KC,pG={clamp:(e,t,n)=>t>n?Math.min(t,Math.max(n,e)):Math.min(n,Math.max(t,e)),round:e=>Math.round(e*1e10)/1e10},fG=pG,mG={dec2hex:e=>{const t=Math.round(e).toString(16);return t.length>1?t:`0${t}`}},gG=mG,yG={channel:dG,lang:fG,unit:gG},Ra=yG,Xv={};for(let e=0;e<=255;e++)Xv[e]=Ra.unit.dec2hex(e);const Pf={ALL:0,RGB:1,HSL:2};class _G{constructor(){this.type=Pf.ALL}get(){return this.type}set(t){if(this.type&&this.type!==t)throw new Error("Cannot change both RGB and HSL channels at the same time");this.type=t}reset(){this.type=Pf.ALL}is(t){return this.type===t}}const vG=_G;class xG{constructor(t,n){this.color=n,this.changed=!1,this.data=t,this.type=new vG}set(t,n){return this.color=n,this.changed=!1,this.data=t,this.type.type=Pf.ALL,this}_ensureHSL(){const t=this.data,{h:n,s,l:a}=t;n===void 0&&(t.h=Ra.channel.rgb2hsl(t,"h")),s===void 0&&(t.s=Ra.channel.rgb2hsl(t,"s")),a===void 0&&(t.l=Ra.channel.rgb2hsl(t,"l"))}_ensureRGB(){const t=this.data,{r:n,g:s,b:a}=t;n===void 0&&(t.r=Ra.channel.hsl2rgb(t,"r")),s===void 0&&(t.g=Ra.channel.hsl2rgb(t,"g")),a===void 0&&(t.b=Ra.channel.hsl2rgb(t,"b"))}get r(){const t=this.data,n=t.r;return!this.type.is(Pf.HSL)&&n!==void 0?n:(this._ensureHSL(),Ra.channel.hsl2rgb(t,"r"))}get g(){const t=this.data,n=t.g;return!this.type.is(Pf.HSL)&&n!==void 0?n:(this._ensureHSL(),Ra.channel.hsl2rgb(t,"g"))}get b(){const t=this.data,n=t.b;return!this.type.is(Pf.HSL)&&n!==void 0?n:(this._ensureHSL(),Ra.channel.hsl2rgb(t,"b"))}get h(){const t=this.data,n=t.h;return!this.type.is(Pf.RGB)&&n!==void 0?n:(this._ensureRGB(),Ra.channel.rgb2hsl(t,"h"))}get s(){const t=this.data,n=t.s;return!this.type.is(Pf.RGB)&&n!==void 0?n:(this._ensureRGB(),Ra.channel.rgb2hsl(t,"s"))}get l(){const t=this.data,n=t.l;return!this.type.is(Pf.RGB)&&n!==void 0?n:(this._ensureRGB(),Ra.channel.rgb2hsl(t,"l"))}get a(){return this.data.a}set r(t){this.type.set(Pf.RGB),this.changed=!0,this.data.r=t}set g(t){this.type.set(Pf.RGB),this.changed=!0,this.data.g=t}set b(t){this.type.set(Pf.RGB),this.changed=!0,this.data.b=t}set h(t){this.type.set(Pf.HSL),this.changed=!0,this.data.h=t}set s(t){this.type.set(Pf.HSL),this.changed=!0,this.data.s=t}set l(t){this.type.set(Pf.HSL),this.changed=!0,this.data.l=t}set a(t){this.changed=!0,this.data.a=t}}const bG=xG,wG=new bG({r:0,g:0,b:0,a:0},"transparent"),V2=wG,GB={re:/^#((?:[a-f0-9]{2}){2,4}|[a-f0-9]{3})$/i,parse:e=>{if(e.charCodeAt(0)!==35)return;const t=e.match(GB.re);if(!t)return;const n=t[1],s=parseInt(n,16),a=n.length,d=a%4===0,f=a>4,i=f?1:17,S=f?8:4,E=d?0:-1,L=f?255:15;return V2.set({r:(s>>S*(E+3)&L)*i,g:(s>>S*(E+2)&L)*i,b:(s>>S*(E+1)&L)*i,a:d?(s&L)*i/255:1},e)},stringify:e=>{const{r:t,g:n,b:s,a}=e;return a<1?`#${Xv[Math.round(t)]}${Xv[Math.round(n)]}${Xv[Math.round(s)]}${Xv[Math.round(a*255)]}`:`#${Xv[Math.round(t)]}${Xv[Math.round(n)]}${Xv[Math.round(s)]}`}},kS=GB,QC={re:/^hsla?\(\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e-?\d+)?(?:deg|grad|rad|turn)?)\s*?(?:,|\s)\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e-?\d+)?%)\s*?(?:,|\s)\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e-?\d+)?%)(?:\s*?(?:,|\/)\s*?\+?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e-?\d+)?(%)?))?\s*?\)$/i,hueRe:/^(.+?)(deg|grad|rad|turn)$/i,_hue2deg:e=>{const t=e.match(QC.hueRe);if(t){const[,n,s]=t;switch(s){case"grad":return Ra.channel.clamp.h(parseFloat(n)*.9);case"rad":return Ra.channel.clamp.h(parseFloat(n)*180/Math.PI);case"turn":return Ra.channel.clamp.h(parseFloat(n)*360)}}return Ra.channel.clamp.h(parseFloat(e))},parse:e=>{const t=e.charCodeAt(0);if(t!==104&&t!==72)return;const n=e.match(QC.re);if(!n)return;const[,s,a,d,f,i]=n;return V2.set({h:QC._hue2deg(s),s:Ra.channel.clamp.s(parseFloat(a)),l:Ra.channel.clamp.l(parseFloat(d)),a:f?Ra.channel.clamp.a(i?parseFloat(f)/100:parseFloat(f)):1},e)},stringify:e=>{const{h:t,s:n,l:s,a}=e;return a<1?`hsla(${Ra.lang.round(t)}, ${Ra.lang.round(n)}%, ${Ra.lang.round(s)}%, ${a})`:`hsl(${Ra.lang.round(t)}, ${Ra.lang.round(n)}%, ${Ra.lang.round(s)}%)`}},TC=QC,JC={colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyanaqua:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",transparent:"#00000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},parse:e=>{e=e.toLowerCase();const t=JC.colors[e];if(t)return kS.parse(t)},stringify:e=>{const t=kS.stringify(e);for(const n in JC.colors)if(JC.colors[n]===t)return n}},LO=JC,qB={re:/^rgba?\(\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e\d+)?(%?))\s*?(?:,|\s)\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e\d+)?(%?))\s*?(?:,|\s)\s*?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e\d+)?(%?))(?:\s*?(?:,|\/)\s*?\+?(-?(?:\d+(?:\.\d+)?|(?:\.\d+))(?:e\d+)?(%?)))?\s*?\)$/i,parse:e=>{const t=e.charCodeAt(0);if(t!==114&&t!==82)return;const n=e.match(qB.re);if(!n)return;const[,s,a,d,f,i,S,E,L]=n;return V2.set({r:Ra.channel.clamp.r(a?parseFloat(s)*2.55:parseFloat(s)),g:Ra.channel.clamp.g(f?parseFloat(d)*2.55:parseFloat(d)),b:Ra.channel.clamp.b(S?parseFloat(i)*2.55:parseFloat(i)),a:E?Ra.channel.clamp.a(L?parseFloat(E)/100:parseFloat(E)):1},e)},stringify:e=>{const{r:t,g:n,b:s,a}=e;return a<1?`rgba(${Ra.lang.round(t)}, ${Ra.lang.round(n)}, ${Ra.lang.round(s)}, ${Ra.lang.round(a)})`:`rgb(${Ra.lang.round(t)}, ${Ra.lang.round(n)}, ${Ra.lang.round(s)})`}},CC=qB,SG={format:{keyword:LO,hex:kS,rgb:CC,rgba:CC,hsl:TC,hsla:TC},parse:e=>{if(typeof e!="string")return e;const t=kS.parse(e)||CC.parse(e)||TC.parse(e)||LO.parse(e);if(t)return t;throw new Error(`Unsupported color format: "${e}"`)},stringify:e=>!e.changed&&e.color?e.color:e.type.is(Pf.HSL)||e.data.r===void 0?TC.stringify(e):e.a<1||!Number.isInteger(e.r)||!Number.isInteger(e.g)||!Number.isInteger(e.b)?CC.stringify(e):kS.stringify(e)},__=SG,TG=(e,t)=>{const n=__.parse(e);for(const s in t)n[s]=Ra.channel.clamp[s](t[s]);return __.stringify(n)},YB=TG,CG=(e,t,n=0,s=1)=>{if(typeof e!="number")return YB(e,{a:t});const a=V2.set({r:Ra.channel.clamp.r(e),g:Ra.channel.clamp.g(t),b:Ra.channel.clamp.b(n),a:Ra.channel.clamp.a(s)});return __.stringify(a)},AS=CG,EG=e=>{const{r:t,g:n,b:s}=__.parse(e),a=.2126*Ra.channel.toLinear(t)+.7152*Ra.channel.toLinear(n)+.0722*Ra.channel.toLinear(s);return Ra.lang.round(a)},kG=EG,AG=e=>kG(e)>=.5,MG=AG,IG=e=>!MG(e),ST=IG,LG=(e,t,n)=>{const s=__.parse(e),a=s[t],d=Ra.channel.clamp[t](a+n);return a!==d&&(s[t]=d),__.stringify(s)},XB=LG,DG=(e,t)=>XB(e,"l",t),oo=DG,PG=(e,t)=>XB(e,"l",-t),Ho=PG,OG=(e,t)=>{const n=__.parse(e),s={};for(const a in t)t[a]&&(s[a]=n[a]+t[a]);return YB(e,s)},Lr=OG,RG=(e,t,n=50)=>{const{r:s,g:a,b:d,a:f}=__.parse(e),{r:i,g:S,b:E,a:L}=__.parse(t),F=n/100,G=F*2-1,q=f-L,te=((G*q===-1?G:(G+q)/(1+G*q))+1)/2,he=1-te,fe=s*te+i*he,le=a*te+S*he,Se=d*te+E*he,ke=f*F+L*(1-F);return AS(fe,le,Se,ke)},NG=RG,BG=(e,t=100)=>{const n=__.parse(e);return n.r=255-n.r,n.g=255-n.g,n.b=255-n.b,NG(n,e,t)},xs=BG;/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:ZB,setPrototypeOf:DO,isFrozen:FG,getPrototypeOf:zG,getOwnPropertyDescriptor:UG}=Object;let{freeze:Sm,seal:Oy,create:KB}=Object,{apply:vM,construct:xM}=typeof Reflect<"u"&&Reflect;Sm||(Sm=function(t){return t});Oy||(Oy=function(t){return t});vM||(vM=function(t,n,s){return t.apply(n,s)});xM||(xM=function(t,n){return new t(...n)});const EC=Tm(Array.prototype.forEach),$G=Tm(Array.prototype.lastIndexOf),PO=Tm(Array.prototype.pop),tS=Tm(Array.prototype.push),VG=Tm(Array.prototype.splice),eE=Tm(String.prototype.toLowerCase),_A=Tm(String.prototype.toString),OO=Tm(String.prototype.match),iS=Tm(String.prototype.replace),WG=Tm(String.prototype.indexOf),jG=Tm(String.prototype.trim),m0=Tm(Object.prototype.hasOwnProperty),ym=Tm(RegExp.prototype.test),rS=HG(TypeError);function Tm(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return vM(e,t,s)}}function HG(e){return function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return xM(e,n)}}function Yl(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:eE;DO&&DO(e,null);let s=t.length;for(;s--;){let a=t[s];if(typeof a=="string"){const d=n(a);d!==a&&(FG(t)||(t[s]=d),a=d)}e[a]=!0}return e}function GG(e){for(let t=0;t<e.length;t++)m0(e,t)||(e[t]=null);return e}function Y_(e){const t=KB(null);for(const[n,s]of ZB(e))m0(e,n)&&(Array.isArray(s)?t[n]=GG(s):s&&typeof s=="object"&&s.constructor===Object?t[n]=Y_(s):t[n]=s);return t}function nS(e,t){for(;e!==null;){const s=UG(e,t);if(s){if(s.get)return Tm(s.get);if(typeof s.value=="function")return Tm(s.value)}e=zG(e)}function n(){return null}return n}const RO=Sm(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),vA=Sm(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xA=Sm(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),qG=Sm(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),bA=Sm(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),YG=Sm(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),NO=Sm(["#text"]),BO=Sm(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),wA=Sm(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),FO=Sm(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),kC=Sm(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),XG=Oy(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ZG=Oy(/<%[\w\W]*|[\w\W]*%>/gm),KG=Oy(/\$\{[\w\W]*/gm),QG=Oy(/^data-[\-\w.\u00B7-\uFFFF]+$/),JG=Oy(/^aria-[\-\w]+$/),QB=Oy(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),e9=Oy(/^(?:\w+script|data):/i),t9=Oy(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),JB=Oy(/^html$/i),i9=Oy(/^[a-z][.\w]*(-[.\w]+)+$/i);var zO=Object.freeze({__proto__:null,ARIA_ATTR:JG,ATTR_WHITESPACE:t9,CUSTOM_ELEMENT:i9,DATA_ATTR:QG,DOCTYPE_NAME:JB,ERB_EXPR:ZG,IS_ALLOWED_URI:QB,IS_SCRIPT_OR_DATA:e9,MUSTACHE_EXPR:XG,TMPLIT_EXPR:KG});const sS={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},r9=function(){return typeof window>"u"?null:window},n9=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(s=n.getAttribute(a));const d="dompurify"+(s?"#"+s:"");try{return t.createPolicy(d,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return console.warn("TrustedTypes policy "+d+" could not be created."),null}},UO=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function eF(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r9();const t=Or=>eF(Or);if(t.version="3.2.6",t.removed=[],!e||!e.document||e.document.nodeType!==sS.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const s=n,a=s.currentScript,{DocumentFragment:d,HTMLTemplateElement:f,Node:i,Element:S,NodeFilter:E,NamedNodeMap:L=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:F,DOMParser:G,trustedTypes:q}=e,Q=S.prototype,te=nS(Q,"cloneNode"),he=nS(Q,"remove"),fe=nS(Q,"nextSibling"),le=nS(Q,"childNodes"),Se=nS(Q,"parentNode");if(typeof f=="function"){const Or=n.createElement("template");Or.content&&Or.content.ownerDocument&&(n=Or.content.ownerDocument)}let ke,Ee="";const{implementation:Ie,createNodeIterator:He,createDocumentFragment:Ye,getElementsByTagName:lt}=n,{importNode:Pt}=s;let At=UO();t.isSupported=typeof ZB=="function"&&typeof Se=="function"&&Ie&&Ie.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ht,ERB_EXPR:Ot,TMPLIT_EXPR:Ae,DATA_ATTR:mt,ARIA_ATTR:bt,IS_SCRIPT_OR_DATA:Dt,ATTR_WHITESPACE:Je,CUSTOM_ELEMENT:dt}=zO;let{IS_ALLOWED_URI:ui}=zO,Vt=null;const ei=Yl({},[...RO,...vA,...xA,...bA,...NO]);let ur=null;const Zt=Yl({},[...BO,...wA,...FO,...kC]);let Kt=Object.seal(KB(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ui=null,rr=null,gi=!0,Oi=!0,cr=!1,ji=!0,nn=!1,pr=!0,Ue=!1,ni=!1,fi=!1,Lt=!1,pt=!1,Nt=!1,Si=!0,pi=!1;const St="user-content-";let Ht=!0,nr=!1,tr={},kr=null;const Mr=Yl({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Cr=null;const Tn=Yl({},["audio","video","img","source","image","track"]);let gs=null;const wn=Yl({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),bs="http://www.w3.org/1998/Math/MathML",qn="http://www.w3.org/2000/svg",Ls="http://www.w3.org/1999/xhtml";let ma=Ls,Ln=!1,qo=null;const zn=Yl({},[bs,qn,Ls],_A);let za=Yl({},["mi","mo","mn","ms","mtext"]),$o=Yl({},["annotation-xml"]);const Aa=Yl({},["title","style","font","a","script"]);let ja=null;const Yn=["application/xhtml+xml","text/html"],hl="text/html";let fr=null,tc=null;const Sh=n.createElement("form"),bl=function(ii){return ii instanceof RegExp||ii instanceof Function},Un=function(){let ii=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(tc&&tc===ii)){if((!ii||typeof ii!="object")&&(ii={}),ii=Y_(ii),ja=Yn.indexOf(ii.PARSER_MEDIA_TYPE)===-1?hl:ii.PARSER_MEDIA_TYPE,fr=ja==="application/xhtml+xml"?_A:eE,Vt=m0(ii,"ALLOWED_TAGS")?Yl({},ii.ALLOWED_TAGS,fr):ei,ur=m0(ii,"ALLOWED_ATTR")?Yl({},ii.ALLOWED_ATTR,fr):Zt,qo=m0(ii,"ALLOWED_NAMESPACES")?Yl({},ii.ALLOWED_NAMESPACES,_A):zn,gs=m0(ii,"ADD_URI_SAFE_ATTR")?Yl(Y_(wn),ii.ADD_URI_SAFE_ATTR,fr):wn,Cr=m0(ii,"ADD_DATA_URI_TAGS")?Yl(Y_(Tn),ii.ADD_DATA_URI_TAGS,fr):Tn,kr=m0(ii,"FORBID_CONTENTS")?Yl({},ii.FORBID_CONTENTS,fr):Mr,Ui=m0(ii,"FORBID_TAGS")?Yl({},ii.FORBID_TAGS,fr):Y_({}),rr=m0(ii,"FORBID_ATTR")?Yl({},ii.FORBID_ATTR,fr):Y_({}),tr=m0(ii,"USE_PROFILES")?ii.USE_PROFILES:!1,gi=ii.ALLOW_ARIA_ATTR!==!1,Oi=ii.ALLOW_DATA_ATTR!==!1,cr=ii.ALLOW_UNKNOWN_PROTOCOLS||!1,ji=ii.ALLOW_SELF_CLOSE_IN_ATTR!==!1,nn=ii.SAFE_FOR_TEMPLATES||!1,pr=ii.SAFE_FOR_XML!==!1,Ue=ii.WHOLE_DOCUMENT||!1,Lt=ii.RETURN_DOM||!1,pt=ii.RETURN_DOM_FRAGMENT||!1,Nt=ii.RETURN_TRUSTED_TYPE||!1,fi=ii.FORCE_BODY||!1,Si=ii.SANITIZE_DOM!==!1,pi=ii.SANITIZE_NAMED_PROPS||!1,Ht=ii.KEEP_CONTENT!==!1,nr=ii.IN_PLACE||!1,ui=ii.ALLOWED_URI_REGEXP||QB,ma=ii.NAMESPACE||Ls,za=ii.MATHML_TEXT_INTEGRATION_POINTS||za,$o=ii.HTML_INTEGRATION_POINTS||$o,Kt=ii.CUSTOM_ELEMENT_HANDLING||{},ii.CUSTOM_ELEMENT_HANDLING&&bl(ii.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Kt.tagNameCheck=ii.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ii.CUSTOM_ELEMENT_HANDLING&&bl(ii.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Kt.attributeNameCheck=ii.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ii.CUSTOM_ELEMENT_HANDLING&&typeof ii.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Kt.allowCustomizedBuiltInElements=ii.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),nn&&(Oi=!1),pt&&(Lt=!0),tr&&(Vt=Yl({},NO),ur=[],tr.html===!0&&(Yl(Vt,RO),Yl(ur,BO)),tr.svg===!0&&(Yl(Vt,vA),Yl(ur,wA),Yl(ur,kC)),tr.svgFilters===!0&&(Yl(Vt,xA),Yl(ur,wA),Yl(ur,kC)),tr.mathMl===!0&&(Yl(Vt,bA),Yl(ur,FO),Yl(ur,kC))),ii.ADD_TAGS&&(Vt===ei&&(Vt=Y_(Vt)),Yl(Vt,ii.ADD_TAGS,fr)),ii.ADD_ATTR&&(ur===Zt&&(ur=Y_(ur)),Yl(ur,ii.ADD_ATTR,fr)),ii.ADD_URI_SAFE_ATTR&&Yl(gs,ii.ADD_URI_SAFE_ATTR,fr),ii.FORBID_CONTENTS&&(kr===Mr&&(kr=Y_(kr)),Yl(kr,ii.FORBID_CONTENTS,fr)),Ht&&(Vt["#text"]=!0),Ue&&Yl(Vt,["html","head","body"]),Vt.table&&(Yl(Vt,["tbody"]),delete Ui.tbody),ii.TRUSTED_TYPES_POLICY){if(typeof ii.TRUSTED_TYPES_POLICY.createHTML!="function")throw rS('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ii.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw rS('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ke=ii.TRUSTED_TYPES_POLICY,Ee=ke.createHTML("")}else ke===void 0&&(ke=n9(q,a)),ke!==null&&typeof Ee=="string"&&(Ee=ke.createHTML(""));Sm&&Sm(ii),tc=ii}},vi=Yl({},[...vA,...xA,...qG]),Ge=Yl({},[...bA,...YG]),Fe=function(ii){let xr=Se(ii);(!xr||!xr.tagName)&&(xr={namespaceURI:ma,tagName:"template"});const Xr=eE(ii.tagName),tn=eE(xr.tagName);return qo[ii.namespaceURI]?ii.namespaceURI===qn?xr.namespaceURI===Ls?Xr==="svg":xr.namespaceURI===bs?Xr==="svg"&&(tn==="annotation-xml"||za[tn]):!!vi[Xr]:ii.namespaceURI===bs?xr.namespaceURI===Ls?Xr==="math":xr.namespaceURI===qn?Xr==="math"&&$o[tn]:!!Ge[Xr]:ii.namespaceURI===Ls?xr.namespaceURI===qn&&!$o[tn]||xr.namespaceURI===bs&&!za[tn]?!1:!Ge[Xr]&&(Aa[Xr]||!vi[Xr]):!!(ja==="application/xhtml+xml"&&qo[ii.namespaceURI]):!1},rt=function(ii){tS(t.removed,{element:ii});try{Se(ii).removeChild(ii)}catch{he(ii)}},xt=function(ii,xr){try{tS(t.removed,{attribute:xr.getAttributeNode(ii),from:xr})}catch{tS(t.removed,{attribute:null,from:xr})}if(xr.removeAttribute(ii),ii==="is")if(Lt||pt)try{rt(xr)}catch{}else try{xr.setAttribute(ii,"")}catch{}},ft=function(ii){let xr=null,Xr=null;if(fi)ii="<remove></remove>"+ii;else{const ds=OO(ii,/^[\r\n\t ]+/);Xr=ds&&ds[0]}ja==="application/xhtml+xml"&&ma===Ls&&(ii='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ii+"</body></html>");const tn=ke?ke.createHTML(ii):ii;if(ma===Ls)try{xr=new G().parseFromString(tn,ja)}catch{}if(!xr||!xr.documentElement){xr=Ie.createDocument(ma,"template",null);try{xr.documentElement.innerHTML=Ln?Ee:tn}catch{}}const Jn=xr.body||xr.documentElement;return ii&&Xr&&Jn.insertBefore(n.createTextNode(Xr),Jn.childNodes[0]||null),ma===Ls?lt.call(xr,Ue?"html":"body")[0]:Ue?xr.documentElement:Jn},Jt=function(ii){return He.call(ii.ownerDocument||ii,ii,E.SHOW_ELEMENT|E.SHOW_COMMENT|E.SHOW_TEXT|E.SHOW_PROCESSING_INSTRUCTION|E.SHOW_CDATA_SECTION,null)},xi=function(ii){return ii instanceof F&&(typeof ii.nodeName!="string"||typeof ii.textContent!="string"||typeof ii.removeChild!="function"||!(ii.attributes instanceof L)||typeof ii.removeAttribute!="function"||typeof ii.setAttribute!="function"||typeof ii.namespaceURI!="string"||typeof ii.insertBefore!="function"||typeof ii.hasChildNodes!="function")},ti=function(ii){return typeof i=="function"&&ii instanceof i};function ai(Or,ii,xr){EC(Or,Xr=>{Xr.call(t,ii,xr,tc)})}const Yi=function(ii){let xr=null;if(ai(At.beforeSanitizeElements,ii,null),xi(ii))return rt(ii),!0;const Xr=fr(ii.nodeName);if(ai(At.uponSanitizeElement,ii,{tagName:Xr,allowedTags:Vt}),pr&&ii.hasChildNodes()&&!ti(ii.firstElementChild)&&ym(/<[/\w!]/g,ii.innerHTML)&&ym(/<[/\w!]/g,ii.textContent)||ii.nodeType===sS.progressingInstruction||pr&&ii.nodeType===sS.comment&&ym(/<[/\w]/g,ii.data))return rt(ii),!0;if(!Vt[Xr]||Ui[Xr]){if(!Ui[Xr]&&Pr(Xr)&&(Kt.tagNameCheck instanceof RegExp&&ym(Kt.tagNameCheck,Xr)||Kt.tagNameCheck instanceof Function&&Kt.tagNameCheck(Xr)))return!1;if(Ht&&!kr[Xr]){const tn=Se(ii)||ii.parentNode,Jn=le(ii)||ii.childNodes;if(Jn&&tn){const ds=Jn.length;for(let mi=ds-1;mi>=0;--mi){const _r=te(Jn[mi],!0);_r.__removalCount=(ii.__removalCount||0)+1,tn.insertBefore(_r,fe(ii))}}}return rt(ii),!0}return ii instanceof S&&!Fe(ii)||(Xr==="noscript"||Xr==="noembed"||Xr==="noframes")&&ym(/<\/no(script|embed|frames)/i,ii.innerHTML)?(rt(ii),!0):(nn&&ii.nodeType===sS.text&&(xr=ii.textContent,EC([ht,Ot,Ae],tn=>{xr=iS(xr,tn," ")}),ii.textContent!==xr&&(tS(t.removed,{element:ii.cloneNode()}),ii.textContent=xr)),ai(At.afterSanitizeElements,ii,null),!1)},Fi=function(ii,xr,Xr){if(Si&&(xr==="id"||xr==="name")&&(Xr in n||Xr in Sh))return!1;if(!(Oi&&!rr[xr]&&ym(mt,xr))){if(!(gi&&ym(bt,xr))){if(!ur[xr]||rr[xr]){if(!(Pr(ii)&&(Kt.tagNameCheck instanceof RegExp&&ym(Kt.tagNameCheck,ii)||Kt.tagNameCheck instanceof Function&&Kt.tagNameCheck(ii))&&(Kt.attributeNameCheck instanceof RegExp&&ym(Kt.attributeNameCheck,xr)||Kt.attributeNameCheck instanceof Function&&Kt.attributeNameCheck(xr))||xr==="is"&&Kt.allowCustomizedBuiltInElements&&(Kt.tagNameCheck instanceof RegExp&&ym(Kt.tagNameCheck,Xr)||Kt.tagNameCheck instanceof Function&&Kt.tagNameCheck(Xr))))return!1}else if(!gs[xr]){if(!ym(ui,iS(Xr,Je,""))){if(!((xr==="src"||xr==="xlink:href"||xr==="href")&&ii!=="script"&&WG(Xr,"data:")===0&&Cr[ii])){if(!(cr&&!ym(Dt,iS(Xr,Je,"")))){if(Xr)return!1}}}}}}return!0},Pr=function(ii){return ii!=="annotation-xml"&&OO(ii,dt)},ln=function(ii){ai(At.beforeSanitizeAttributes,ii,null);const{attributes:xr}=ii;if(!xr||xi(ii))return;const Xr={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ur,forceKeepAttr:void 0};let tn=xr.length;for(;tn--;){const Jn=xr[tn],{name:ds,namespaceURI:mi,value:_r}=Jn,zi=fr(ds),zr=_r;let Yr=ds==="value"?zr:jG(zr);if(Xr.attrName=zi,Xr.attrValue=Yr,Xr.keepAttr=!0,Xr.forceKeepAttr=void 0,ai(At.uponSanitizeAttribute,ii,Xr),Yr=Xr.attrValue,pi&&(zi==="id"||zi==="name")&&(xt(ds,ii),Yr=St+Yr),pr&&ym(/((--!?|])>)|<\/(style|title)/i,Yr)){xt(ds,ii);continue}if(Xr.forceKeepAttr)continue;if(!Xr.keepAttr){xt(ds,ii);continue}if(!ji&&ym(/\/>/i,Yr)){xt(ds,ii);continue}nn&&EC([ht,Ot,Ae],Hr=>{Yr=iS(Yr,Hr," ")});const yr=fr(ii.nodeName);if(!Fi(yr,zi,Yr)){xt(ds,ii);continue}if(ke&&typeof q=="object"&&typeof q.getAttributeType=="function"&&!mi)switch(q.getAttributeType(yr,zi)){case"TrustedHTML":{Yr=ke.createHTML(Yr);break}case"TrustedScriptURL":{Yr=ke.createScriptURL(Yr);break}}if(Yr!==zr)try{mi?ii.setAttributeNS(mi,ds,Yr):ii.setAttribute(ds,Yr),xi(ii)?rt(ii):PO(t.removed)}catch{xt(ds,ii)}}ai(At.afterSanitizeAttributes,ii,null)},Qr=function Or(ii){let xr=null;const Xr=Jt(ii);for(ai(At.beforeSanitizeShadowDOM,ii,null);xr=Xr.nextNode();)ai(At.uponSanitizeShadowNode,xr,null),Yi(xr),ln(xr),xr.content instanceof d&&Or(xr.content);ai(At.afterSanitizeShadowDOM,ii,null)};return t.sanitize=function(Or){let ii=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xr=null,Xr=null,tn=null,Jn=null;if(Ln=!Or,Ln&&(Or="<!-->"),typeof Or!="string"&&!ti(Or))if(typeof Or.toString=="function"){if(Or=Or.toString(),typeof Or!="string")throw rS("dirty is not a string, aborting")}else throw rS("toString is not a function");if(!t.isSupported)return Or;if(ni||Un(ii),t.removed=[],typeof Or=="string"&&(nr=!1),nr){if(Or.nodeName){const _r=fr(Or.nodeName);if(!Vt[_r]||Ui[_r])throw rS("root node is forbidden and cannot be sanitized in-place")}}else if(Or instanceof i)xr=ft("<!---->"),Xr=xr.ownerDocument.importNode(Or,!0),Xr.nodeType===sS.element&&Xr.nodeName==="BODY"||Xr.nodeName==="HTML"?xr=Xr:xr.appendChild(Xr);else{if(!Lt&&!nn&&!Ue&&Or.indexOf("<")===-1)return ke&&Nt?ke.createHTML(Or):Or;if(xr=ft(Or),!xr)return Lt?null:Nt?Ee:""}xr&&fi&&rt(xr.firstChild);const ds=Jt(nr?Or:xr);for(;tn=ds.nextNode();)Yi(tn),ln(tn),tn.content instanceof d&&Qr(tn.content);if(nr)return Or;if(Lt){if(pt)for(Jn=Ye.call(xr.ownerDocument);xr.firstChild;)Jn.appendChild(xr.firstChild);else Jn=xr;return(ur.shadowroot||ur.shadowrootmode)&&(Jn=Pt.call(s,Jn,!0)),Jn}let mi=Ue?xr.outerHTML:xr.innerHTML;return Ue&&Vt["!doctype"]&&xr.ownerDocument&&xr.ownerDocument.doctype&&xr.ownerDocument.doctype.name&&ym(JB,xr.ownerDocument.doctype.name)&&(mi="<!DOCTYPE "+xr.ownerDocument.doctype.name+`>
`+mi),nn&&EC([ht,Ot,Ae],_r=>{mi=iS(mi,_r," ")}),ke&&Nt?ke.createHTML(mi):mi},t.setConfig=function(){let Or=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Un(Or),ni=!0},t.clearConfig=function(){tc=null,ni=!1},t.isValidAttribute=function(Or,ii,xr){tc||Un({});const Xr=fr(Or),tn=fr(ii);return Fi(Xr,tn,xr)},t.addHook=function(Or,ii){typeof ii=="function"&&tS(At[Or],ii)},t.removeHook=function(Or,ii){if(ii!==void 0){const xr=$G(At[Or],ii);return xr===-1?void 0:VG(At[Or],xr,1)[0]}return PO(At[Or])},t.removeHooks=function(Or){At[Or]=[]},t.removeAllHooks=function(){At=UO()},t}var N1=eF(),tF=Object.defineProperty,Ze=(e,t)=>tF(e,"name",{value:t,configurable:!0}),s9=(e,t)=>{for(var n in t)tF(e,n,{get:t[n],enumerable:!0})},G_={trace:0,debug:1,info:2,warn:3,error:4,fatal:5},On={trace:Ze((...e)=>{},"trace"),debug:Ze((...e)=>{},"debug"),info:Ze((...e)=>{},"info"),warn:Ze((...e)=>{},"warn"),error:Ze((...e)=>{},"error"),fatal:Ze((...e)=>{},"fatal")},yL=Ze(function(e="fatal"){let t=G_.fatal;typeof e=="string"?e.toLowerCase()in G_&&(t=G_[e]):typeof e=="number"&&(t=e),On.trace=()=>{},On.debug=()=>{},On.info=()=>{},On.warn=()=>{},On.error=()=>{},On.fatal=()=>{},t<=G_.fatal&&(On.fatal=console.error?console.error.bind(console,Ay("FATAL"),"color: orange"):console.log.bind(console,"\x1B[35m",Ay("FATAL"))),t<=G_.error&&(On.error=console.error?console.error.bind(console,Ay("ERROR"),"color: orange"):console.log.bind(console,"\x1B[31m",Ay("ERROR"))),t<=G_.warn&&(On.warn=console.warn?console.warn.bind(console,Ay("WARN"),"color: orange"):console.log.bind(console,"\x1B[33m",Ay("WARN"))),t<=G_.info&&(On.info=console.info?console.info.bind(console,Ay("INFO"),"color: lightblue"):console.log.bind(console,"\x1B[34m",Ay("INFO"))),t<=G_.debug&&(On.debug=console.debug?console.debug.bind(console,Ay("DEBUG"),"color: lightgreen"):console.log.bind(console,"\x1B[32m",Ay("DEBUG"))),t<=G_.trace&&(On.trace=console.debug?console.debug.bind(console,Ay("TRACE"),"color: lightgreen"):console.log.bind(console,"\x1B[32m",Ay("TRACE")))},"setLogLevel"),Ay=Ze(e=>`%c${uG().format("ss.SSS")} : ${e} : `,"format"),iF=/^-{3}\s*[\n\r](.*?)[\n\r]-{3}\s*[\n\r]+/s,MS=/%{2}{\s*(?:(\w+)\s*:|(\w+))\s*(?:(\w+)|((?:(?!}%{2}).|\r?\n)*))?\s*(?:}%{2})?/gi,o9=/\s*%%.*\n/gm,hT,rF=(hT=class extends Error{constructor(t){super(t),this.name="UnknownDiagramError"}},Ze(hT,"UnknownDiagramError"),hT),B1={},_L=Ze(function(e,t){e=e.replace(iF,"").replace(MS,"").replace(o9,`
`);for(const[n,{detector:s}]of Object.entries(B1))if(s(e,t))return n;throw new rF(`No diagram type detected matching given configuration for text: ${e}`)},"detectType"),bM=Ze((...e)=>{for(const{id:t,detector:n,loader:s}of e)nF(t,n,s)},"registerLazyLoadedDiagrams"),nF=Ze((e,t,n)=>{B1[e]&&On.warn(`Detector with key ${e} already exists. Overwriting.`),B1[e]={detector:t,loader:n},On.debug(`Detector with key ${e} added${n?" with loader":""}`)},"addDetector"),a9=Ze(e=>B1[e].loader,"getDiagramLoader"),wM=Ze((e,t,{depth:n=2,clobber:s=!1}={})=>{const a={depth:n,clobber:s};return Array.isArray(t)&&!Array.isArray(e)?(t.forEach(d=>wM(e,d,a)),e):Array.isArray(t)&&Array.isArray(e)?(t.forEach(d=>{e.includes(d)||e.push(d)}),e):e===void 0||n<=0?e!=null&&typeof e=="object"&&typeof t=="object"?Object.assign(e,t):t:(t!==void 0&&typeof e=="object"&&typeof t=="object"&&Object.keys(t).forEach(d=>{typeof t[d]=="object"&&(e[d]===void 0||typeof e[d]=="object")?(e[d]===void 0&&(e[d]=Array.isArray(t[d])?[]:{}),e[d]=wM(e[d],t[d],{depth:n-1,clobber:s})):(s||typeof e[d]!="object"&&typeof t[d]!="object")&&(e[d]=t[d])}),e)},"assignWithDepth"),nf=wM,W2="#ffffff",j2="#f2f2f2",vm=Ze((e,t)=>t?Lr(e,{s:-40,l:10}):Lr(e,{s:-40,l:-10}),"mkBorder"),uT,l9=(uT=class{constructor(){this.background="#f4f4f4",this.primaryColor="#fff4dd",this.noteBkgColor="#fff5ad",this.noteTextColor="#333",this.THEME_COLOR_LIMIT=12,this.fontFamily='"trebuchet ms", verdana, arial, sans-serif',this.fontSize="16px"}updateColors(){var n,s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee,Ie;if(this.primaryTextColor=this.primaryTextColor||(this.darkMode?"#eee":"#333"),this.secondaryColor=this.secondaryColor||Lr(this.primaryColor,{h:-120}),this.tertiaryColor=this.tertiaryColor||Lr(this.primaryColor,{h:180,l:5}),this.primaryBorderColor=this.primaryBorderColor||vm(this.primaryColor,this.darkMode),this.secondaryBorderColor=this.secondaryBorderColor||vm(this.secondaryColor,this.darkMode),this.tertiaryBorderColor=this.tertiaryBorderColor||vm(this.tertiaryColor,this.darkMode),this.noteBorderColor=this.noteBorderColor||vm(this.noteBkgColor,this.darkMode),this.noteBkgColor=this.noteBkgColor||"#fff5ad",this.noteTextColor=this.noteTextColor||"#333",this.secondaryTextColor=this.secondaryTextColor||xs(this.secondaryColor),this.tertiaryTextColor=this.tertiaryTextColor||xs(this.tertiaryColor),this.lineColor=this.lineColor||xs(this.background),this.arrowheadColor=this.arrowheadColor||xs(this.background),this.textColor=this.textColor||this.primaryTextColor,this.border2=this.border2||this.tertiaryBorderColor,this.nodeBkg=this.nodeBkg||this.primaryColor,this.mainBkg=this.mainBkg||this.primaryColor,this.nodeBorder=this.nodeBorder||this.primaryBorderColor,this.clusterBkg=this.clusterBkg||this.tertiaryColor,this.clusterBorder=this.clusterBorder||this.tertiaryBorderColor,this.defaultLinkColor=this.defaultLinkColor||this.lineColor,this.titleColor=this.titleColor||this.tertiaryTextColor,this.edgeLabelBackground=this.edgeLabelBackground||(this.darkMode?Ho(this.secondaryColor,30):this.secondaryColor),this.nodeTextColor=this.nodeTextColor||this.primaryTextColor,this.actorBorder=this.actorBorder||this.primaryBorderColor,this.actorBkg=this.actorBkg||this.mainBkg,this.actorTextColor=this.actorTextColor||this.primaryTextColor,this.actorLineColor=this.actorLineColor||this.actorBorder,this.labelBoxBkgColor=this.labelBoxBkgColor||this.actorBkg,this.signalColor=this.signalColor||this.textColor,this.signalTextColor=this.signalTextColor||this.textColor,this.labelBoxBorderColor=this.labelBoxBorderColor||this.actorBorder,this.labelTextColor=this.labelTextColor||this.actorTextColor,this.loopTextColor=this.loopTextColor||this.actorTextColor,this.activationBorderColor=this.activationBorderColor||Ho(this.secondaryColor,10),this.activationBkgColor=this.activationBkgColor||this.secondaryColor,this.sequenceNumberColor=this.sequenceNumberColor||xs(this.lineColor),this.sectionBkgColor=this.sectionBkgColor||this.tertiaryColor,this.altSectionBkgColor=this.altSectionBkgColor||"white",this.sectionBkgColor=this.sectionBkgColor||this.secondaryColor,this.sectionBkgColor2=this.sectionBkgColor2||this.primaryColor,this.excludeBkgColor=this.excludeBkgColor||"#eeeeee",this.taskBorderColor=this.taskBorderColor||this.primaryBorderColor,this.taskBkgColor=this.taskBkgColor||this.primaryColor,this.activeTaskBorderColor=this.activeTaskBorderColor||this.primaryColor,this.activeTaskBkgColor=this.activeTaskBkgColor||oo(this.primaryColor,23),this.gridColor=this.gridColor||"lightgrey",this.doneTaskBkgColor=this.doneTaskBkgColor||"lightgrey",this.doneTaskBorderColor=this.doneTaskBorderColor||"grey",this.critBorderColor=this.critBorderColor||"#ff8888",this.critBkgColor=this.critBkgColor||"red",this.todayLineColor=this.todayLineColor||"red",this.vertLineColor=this.vertLineColor||"navy",this.taskTextColor=this.taskTextColor||this.textColor,this.taskTextOutsideColor=this.taskTextOutsideColor||this.textColor,this.taskTextLightColor=this.taskTextLightColor||this.textColor,this.taskTextColor=this.taskTextColor||this.primaryTextColor,this.taskTextDarkColor=this.taskTextDarkColor||this.textColor,this.taskTextClickableColor=this.taskTextClickableColor||"#003163",this.personBorder=this.personBorder||this.primaryBorderColor,this.personBkg=this.personBkg||this.mainBkg,this.darkMode?(this.rowOdd=this.rowOdd||Ho(this.mainBkg,5)||"#ffffff",this.rowEven=this.rowEven||Ho(this.mainBkg,10)):(this.rowOdd=this.rowOdd||oo(this.mainBkg,75)||"#ffffff",this.rowEven=this.rowEven||oo(this.mainBkg,5)),this.transitionColor=this.transitionColor||this.lineColor,this.transitionLabelColor=this.transitionLabelColor||this.textColor,this.stateLabelColor=this.stateLabelColor||this.stateBkg||this.primaryTextColor,this.stateBkg=this.stateBkg||this.mainBkg,this.labelBackgroundColor=this.labelBackgroundColor||this.stateBkg,this.compositeBackground=this.compositeBackground||this.background||this.tertiaryColor,this.altBackground=this.altBackground||this.tertiaryColor,this.compositeTitleBackground=this.compositeTitleBackground||this.mainBkg,this.compositeBorder=this.compositeBorder||this.nodeBorder,this.innerEndBackground=this.nodeBorder,this.errorBkgColor=this.errorBkgColor||this.tertiaryColor,this.errorTextColor=this.errorTextColor||this.tertiaryTextColor,this.transitionColor=this.transitionColor||this.lineColor,this.specialStateColor=this.lineColor,this.cScale0=this.cScale0||this.primaryColor,this.cScale1=this.cScale1||this.secondaryColor,this.cScale2=this.cScale2||this.tertiaryColor,this.cScale3=this.cScale3||Lr(this.primaryColor,{h:30}),this.cScale4=this.cScale4||Lr(this.primaryColor,{h:60}),this.cScale5=this.cScale5||Lr(this.primaryColor,{h:90}),this.cScale6=this.cScale6||Lr(this.primaryColor,{h:120}),this.cScale7=this.cScale7||Lr(this.primaryColor,{h:150}),this.cScale8=this.cScale8||Lr(this.primaryColor,{h:210,l:150}),this.cScale9=this.cScale9||Lr(this.primaryColor,{h:270}),this.cScale10=this.cScale10||Lr(this.primaryColor,{h:300}),this.cScale11=this.cScale11||Lr(this.primaryColor,{h:330}),this.darkMode)for(let He=0;He<this.THEME_COLOR_LIMIT;He++)this["cScale"+He]=Ho(this["cScale"+He],75);else for(let He=0;He<this.THEME_COLOR_LIMIT;He++)this["cScale"+He]=Ho(this["cScale"+He],25);for(let He=0;He<this.THEME_COLOR_LIMIT;He++)this["cScaleInv"+He]=this["cScaleInv"+He]||xs(this["cScale"+He]);for(let He=0;He<this.THEME_COLOR_LIMIT;He++)this.darkMode?this["cScalePeer"+He]=this["cScalePeer"+He]||oo(this["cScale"+He],10):this["cScalePeer"+He]=this["cScalePeer"+He]||Ho(this["cScale"+He],10);this.scaleLabelColor=this.scaleLabelColor||this.labelTextColor;for(let He=0;He<this.THEME_COLOR_LIMIT;He++)this["cScaleLabel"+He]=this["cScaleLabel"+He]||this.scaleLabelColor;const t=this.darkMode?-4:-1;for(let He=0;He<5;He++)this["surface"+He]=this["surface"+He]||Lr(this.mainBkg,{h:180,s:-15,l:t*(5+He*3)}),this["surfacePeer"+He]=this["surfacePeer"+He]||Lr(this.mainBkg,{h:180,s:-15,l:t*(8+He*3)});this.classText=this.classText||this.textColor,this.fillType0=this.fillType0||this.primaryColor,this.fillType1=this.fillType1||this.secondaryColor,this.fillType2=this.fillType2||Lr(this.primaryColor,{h:64}),this.fillType3=this.fillType3||Lr(this.secondaryColor,{h:64}),this.fillType4=this.fillType4||Lr(this.primaryColor,{h:-64}),this.fillType5=this.fillType5||Lr(this.secondaryColor,{h:-64}),this.fillType6=this.fillType6||Lr(this.primaryColor,{h:128}),this.fillType7=this.fillType7||Lr(this.secondaryColor,{h:128}),this.pie1=this.pie1||this.primaryColor,this.pie2=this.pie2||this.secondaryColor,this.pie3=this.pie3||this.tertiaryColor,this.pie4=this.pie4||Lr(this.primaryColor,{l:-10}),this.pie5=this.pie5||Lr(this.secondaryColor,{l:-10}),this.pie6=this.pie6||Lr(this.tertiaryColor,{l:-10}),this.pie7=this.pie7||Lr(this.primaryColor,{h:60,l:-10}),this.pie8=this.pie8||Lr(this.primaryColor,{h:-60,l:-10}),this.pie9=this.pie9||Lr(this.primaryColor,{h:120,l:0}),this.pie10=this.pie10||Lr(this.primaryColor,{h:60,l:-20}),this.pie11=this.pie11||Lr(this.primaryColor,{h:-60,l:-20}),this.pie12=this.pie12||Lr(this.primaryColor,{h:120,l:-10}),this.pieTitleTextSize=this.pieTitleTextSize||"25px",this.pieTitleTextColor=this.pieTitleTextColor||this.taskTextDarkColor,this.pieSectionTextSize=this.pieSectionTextSize||"17px",this.pieSectionTextColor=this.pieSectionTextColor||this.textColor,this.pieLegendTextSize=this.pieLegendTextSize||"17px",this.pieLegendTextColor=this.pieLegendTextColor||this.taskTextDarkColor,this.pieStrokeColor=this.pieStrokeColor||"black",this.pieStrokeWidth=this.pieStrokeWidth||"2px",this.pieOuterStrokeWidth=this.pieOuterStrokeWidth||"2px",this.pieOuterStrokeColor=this.pieOuterStrokeColor||"black",this.pieOpacity=this.pieOpacity||"0.7",this.radar={axisColor:((n=this.radar)==null?void 0:n.axisColor)||this.lineColor,axisStrokeWidth:((s=this.radar)==null?void 0:s.axisStrokeWidth)||2,axisLabelFontSize:((a=this.radar)==null?void 0:a.axisLabelFontSize)||12,curveOpacity:((d=this.radar)==null?void 0:d.curveOpacity)||.5,curveStrokeWidth:((f=this.radar)==null?void 0:f.curveStrokeWidth)||2,graticuleColor:((i=this.radar)==null?void 0:i.graticuleColor)||"#DEDEDE",graticuleStrokeWidth:((S=this.radar)==null?void 0:S.graticuleStrokeWidth)||1,graticuleOpacity:((E=this.radar)==null?void 0:E.graticuleOpacity)||.3,legendBoxSize:((L=this.radar)==null?void 0:L.legendBoxSize)||12,legendFontSize:((F=this.radar)==null?void 0:F.legendFontSize)||12},this.archEdgeColor=this.archEdgeColor||"#777",this.archEdgeArrowColor=this.archEdgeArrowColor||"#777",this.archEdgeWidth=this.archEdgeWidth||"3",this.archGroupBorderColor=this.archGroupBorderColor||"#000",this.archGroupBorderWidth=this.archGroupBorderWidth||"2px",this.quadrant1Fill=this.quadrant1Fill||this.primaryColor,this.quadrant2Fill=this.quadrant2Fill||Lr(this.primaryColor,{r:5,g:5,b:5}),this.quadrant3Fill=this.quadrant3Fill||Lr(this.primaryColor,{r:10,g:10,b:10}),this.quadrant4Fill=this.quadrant4Fill||Lr(this.primaryColor,{r:15,g:15,b:15}),this.quadrant1TextFill=this.quadrant1TextFill||this.primaryTextColor,this.quadrant2TextFill=this.quadrant2TextFill||Lr(this.primaryTextColor,{r:-5,g:-5,b:-5}),this.quadrant3TextFill=this.quadrant3TextFill||Lr(this.primaryTextColor,{r:-10,g:-10,b:-10}),this.quadrant4TextFill=this.quadrant4TextFill||Lr(this.primaryTextColor,{r:-15,g:-15,b:-15}),this.quadrantPointFill=this.quadrantPointFill||ST(this.quadrant1Fill)?oo(this.quadrant1Fill):Ho(this.quadrant1Fill),this.quadrantPointTextFill=this.quadrantPointTextFill||this.primaryTextColor,this.quadrantXAxisTextFill=this.quadrantXAxisTextFill||this.primaryTextColor,this.quadrantYAxisTextFill=this.quadrantYAxisTextFill||this.primaryTextColor,this.quadrantInternalBorderStrokeFill=this.quadrantInternalBorderStrokeFill||this.primaryBorderColor,this.quadrantExternalBorderStrokeFill=this.quadrantExternalBorderStrokeFill||this.primaryBorderColor,this.quadrantTitleFill=this.quadrantTitleFill||this.primaryTextColor,this.xyChart={backgroundColor:((G=this.xyChart)==null?void 0:G.backgroundColor)||this.background,titleColor:((q=this.xyChart)==null?void 0:q.titleColor)||this.primaryTextColor,xAxisTitleColor:((Q=this.xyChart)==null?void 0:Q.xAxisTitleColor)||this.primaryTextColor,xAxisLabelColor:((te=this.xyChart)==null?void 0:te.xAxisLabelColor)||this.primaryTextColor,xAxisTickColor:((he=this.xyChart)==null?void 0:he.xAxisTickColor)||this.primaryTextColor,xAxisLineColor:((fe=this.xyChart)==null?void 0:fe.xAxisLineColor)||this.primaryTextColor,yAxisTitleColor:((le=this.xyChart)==null?void 0:le.yAxisTitleColor)||this.primaryTextColor,yAxisLabelColor:((Se=this.xyChart)==null?void 0:Se.yAxisLabelColor)||this.primaryTextColor,yAxisTickColor:((ke=this.xyChart)==null?void 0:ke.yAxisTickColor)||this.primaryTextColor,yAxisLineColor:((Ee=this.xyChart)==null?void 0:Ee.yAxisLineColor)||this.primaryTextColor,plotColorPalette:((Ie=this.xyChart)==null?void 0:Ie.plotColorPalette)||"#FFF4DD,#FFD8B1,#FFA07A,#ECEFF1,#D6DBDF,#C3E0A8,#FFB6A4,#FFD74D,#738FA7,#FFFFF0"},this.requirementBackground=this.requirementBackground||this.primaryColor,this.requirementBorderColor=this.requirementBorderColor||this.primaryBorderColor,this.requirementBorderSize=this.requirementBorderSize||"1",this.requirementTextColor=this.requirementTextColor||this.primaryTextColor,this.relationColor=this.relationColor||this.lineColor,this.relationLabelBackground=this.relationLabelBackground||(this.darkMode?Ho(this.secondaryColor,30):this.secondaryColor),this.relationLabelColor=this.relationLabelColor||this.actorTextColor,this.git0=this.git0||this.primaryColor,this.git1=this.git1||this.secondaryColor,this.git2=this.git2||this.tertiaryColor,this.git3=this.git3||Lr(this.primaryColor,{h:-30}),this.git4=this.git4||Lr(this.primaryColor,{h:-60}),this.git5=this.git5||Lr(this.primaryColor,{h:-90}),this.git6=this.git6||Lr(this.primaryColor,{h:60}),this.git7=this.git7||Lr(this.primaryColor,{h:120}),this.darkMode?(this.git0=oo(this.git0,25),this.git1=oo(this.git1,25),this.git2=oo(this.git2,25),this.git3=oo(this.git3,25),this.git4=oo(this.git4,25),this.git5=oo(this.git5,25),this.git6=oo(this.git6,25),this.git7=oo(this.git7,25)):(this.git0=Ho(this.git0,25),this.git1=Ho(this.git1,25),this.git2=Ho(this.git2,25),this.git3=Ho(this.git3,25),this.git4=Ho(this.git4,25),this.git5=Ho(this.git5,25),this.git6=Ho(this.git6,25),this.git7=Ho(this.git7,25)),this.gitInv0=this.gitInv0||xs(this.git0),this.gitInv1=this.gitInv1||xs(this.git1),this.gitInv2=this.gitInv2||xs(this.git2),this.gitInv3=this.gitInv3||xs(this.git3),this.gitInv4=this.gitInv4||xs(this.git4),this.gitInv5=this.gitInv5||xs(this.git5),this.gitInv6=this.gitInv6||xs(this.git6),this.gitInv7=this.gitInv7||xs(this.git7),this.branchLabelColor=this.branchLabelColor||(this.darkMode?"black":this.labelTextColor),this.gitBranchLabel0=this.gitBranchLabel0||this.branchLabelColor,this.gitBranchLabel1=this.gitBranchLabel1||this.branchLabelColor,this.gitBranchLabel2=this.gitBranchLabel2||this.branchLabelColor,this.gitBranchLabel3=this.gitBranchLabel3||this.branchLabelColor,this.gitBranchLabel4=this.gitBranchLabel4||this.branchLabelColor,this.gitBranchLabel5=this.gitBranchLabel5||this.branchLabelColor,this.gitBranchLabel6=this.gitBranchLabel6||this.branchLabelColor,this.gitBranchLabel7=this.gitBranchLabel7||this.branchLabelColor,this.tagLabelColor=this.tagLabelColor||this.primaryTextColor,this.tagLabelBackground=this.tagLabelBackground||this.primaryColor,this.tagLabelBorder=this.tagBorder||this.primaryBorderColor,this.tagLabelFontSize=this.tagLabelFontSize||"10px",this.commitLabelColor=this.commitLabelColor||this.secondaryTextColor,this.commitLabelBackground=this.commitLabelBackground||this.secondaryColor,this.commitLabelFontSize=this.commitLabelFontSize||"10px",this.attributeBackgroundColorOdd=this.attributeBackgroundColorOdd||W2,this.attributeBackgroundColorEven=this.attributeBackgroundColorEven||j2}calculate(t){if(typeof t!="object"){this.updateColors();return}const n=Object.keys(t);n.forEach(s=>{this[s]=t[s]}),this.updateColors(),n.forEach(s=>{this[s]=t[s]})}},Ze(uT,"Theme"),uT),c9=Ze(e=>{const t=new l9;return t.calculate(e),t},"getThemeVariables"),dT,h9=(dT=class{constructor(){this.background="#333",this.primaryColor="#1f2020",this.secondaryColor=oo(this.primaryColor,16),this.tertiaryColor=Lr(this.primaryColor,{h:-160}),this.primaryBorderColor=xs(this.background),this.secondaryBorderColor=vm(this.secondaryColor,this.darkMode),this.tertiaryBorderColor=vm(this.tertiaryColor,this.darkMode),this.primaryTextColor=xs(this.primaryColor),this.secondaryTextColor=xs(this.secondaryColor),this.tertiaryTextColor=xs(this.tertiaryColor),this.lineColor=xs(this.background),this.textColor=xs(this.background),this.mainBkg="#1f2020",this.secondBkg="calculated",this.mainContrastColor="lightgrey",this.darkTextColor=oo(xs("#323D47"),10),this.lineColor="calculated",this.border1="#ccc",this.border2=AS(255,255,255,.25),this.arrowheadColor="calculated",this.fontFamily='"trebuchet ms", verdana, arial, sans-serif',this.fontSize="16px",this.labelBackground="#181818",this.textColor="#ccc",this.THEME_COLOR_LIMIT=12,this.nodeBkg="calculated",this.nodeBorder="calculated",this.clusterBkg="calculated",this.clusterBorder="calculated",this.defaultLinkColor="calculated",this.titleColor="#F9FFFE",this.edgeLabelBackground="calculated",this.actorBorder="calculated",this.actorBkg="calculated",this.actorTextColor="calculated",this.actorLineColor="calculated",this.signalColor="calculated",this.signalTextColor="calculated",this.labelBoxBkgColor="calculated",this.labelBoxBorderColor="calculated",this.labelTextColor="calculated",this.loopTextColor="calculated",this.noteBorderColor="calculated",this.noteBkgColor="#fff5ad",this.noteTextColor="calculated",this.activationBorderColor="calculated",this.activationBkgColor="calculated",this.sequenceNumberColor="black",this.sectionBkgColor=Ho("#EAE8D9",30),this.altSectionBkgColor="calculated",this.sectionBkgColor2="#EAE8D9",this.excludeBkgColor=Ho(this.sectionBkgColor,10),this.taskBorderColor=AS(255,255,255,70),this.taskBkgColor="calculated",this.taskTextColor="calculated",this.taskTextLightColor="calculated",this.taskTextOutsideColor="calculated",this.taskTextClickableColor="#003163",this.activeTaskBorderColor=AS(255,255,255,50),this.activeTaskBkgColor="#81B1DB",this.gridColor="calculated",this.doneTaskBkgColor="calculated",this.doneTaskBorderColor="grey",this.critBorderColor="#E83737",this.critBkgColor="#E83737",this.taskTextDarkColor="calculated",this.todayLineColor="#DB5757",this.vertLineColor="#00BFFF",this.personBorder=this.primaryBorderColor,this.personBkg=this.mainBkg,this.archEdgeColor="calculated",this.archEdgeArrowColor="calculated",this.archEdgeWidth="3",this.archGroupBorderColor=this.primaryBorderColor,this.archGroupBorderWidth="2px",this.rowOdd=this.rowOdd||oo(this.mainBkg,5)||"#ffffff",this.rowEven=this.rowEven||Ho(this.mainBkg,10),this.labelColor="calculated",this.errorBkgColor="#a44141",this.errorTextColor="#ddd"}updateColors(){var t,n,s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee;this.secondBkg=oo(this.mainBkg,16),this.lineColor=this.mainContrastColor,this.arrowheadColor=this.mainContrastColor,this.nodeBkg=this.mainBkg,this.nodeBorder=this.border1,this.clusterBkg=this.secondBkg,this.clusterBorder=this.border2,this.defaultLinkColor=this.lineColor,this.edgeLabelBackground=oo(this.labelBackground,25),this.actorBorder=this.border1,this.actorBkg=this.mainBkg,this.actorTextColor=this.mainContrastColor,this.actorLineColor=this.actorBorder,this.signalColor=this.mainContrastColor,this.signalTextColor=this.mainContrastColor,this.labelBoxBkgColor=this.actorBkg,this.labelBoxBorderColor=this.actorBorder,this.labelTextColor=this.mainContrastColor,this.loopTextColor=this.mainContrastColor,this.noteBorderColor=this.secondaryBorderColor,this.noteBkgColor=this.secondBkg,this.noteTextColor=this.secondaryTextColor,this.activationBorderColor=this.border1,this.activationBkgColor=this.secondBkg,this.altSectionBkgColor=this.background,this.taskBkgColor=oo(this.mainBkg,23),this.taskTextColor=this.darkTextColor,this.taskTextLightColor=this.mainContrastColor,this.taskTextOutsideColor=this.taskTextLightColor,this.gridColor=this.mainContrastColor,this.doneTaskBkgColor=this.mainContrastColor,this.taskTextDarkColor=this.darkTextColor,this.archEdgeColor=this.lineColor,this.archEdgeArrowColor=this.lineColor,this.transitionColor=this.transitionColor||this.lineColor,this.transitionLabelColor=this.transitionLabelColor||this.textColor,this.stateLabelColor=this.stateLabelColor||this.stateBkg||this.primaryTextColor,this.stateBkg=this.stateBkg||this.mainBkg,this.labelBackgroundColor=this.labelBackgroundColor||this.stateBkg,this.compositeBackground=this.compositeBackground||this.background||this.tertiaryColor,this.altBackground=this.altBackground||"#555",this.compositeTitleBackground=this.compositeTitleBackground||this.mainBkg,this.compositeBorder=this.compositeBorder||this.nodeBorder,this.innerEndBackground=this.primaryBorderColor,this.specialStateColor="#f4f4f4",this.errorBkgColor=this.errorBkgColor||this.tertiaryColor,this.errorTextColor=this.errorTextColor||this.tertiaryTextColor,this.fillType0=this.primaryColor,this.fillType1=this.secondaryColor,this.fillType2=Lr(this.primaryColor,{h:64}),this.fillType3=Lr(this.secondaryColor,{h:64}),this.fillType4=Lr(this.primaryColor,{h:-64}),this.fillType5=Lr(this.secondaryColor,{h:-64}),this.fillType6=Lr(this.primaryColor,{h:128}),this.fillType7=Lr(this.secondaryColor,{h:128}),this.cScale1=this.cScale1||"#0b0000",this.cScale2=this.cScale2||"#4d1037",this.cScale3=this.cScale3||"#3f5258",this.cScale4=this.cScale4||"#4f2f1b",this.cScale5=this.cScale5||"#6e0a0a",this.cScale6=this.cScale6||"#3b0048",this.cScale7=this.cScale7||"#995a01",this.cScale8=this.cScale8||"#154706",this.cScale9=this.cScale9||"#161722",this.cScale10=this.cScale10||"#00296f",this.cScale11=this.cScale11||"#01629c",this.cScale12=this.cScale12||"#010029",this.cScale0=this.cScale0||this.primaryColor,this.cScale1=this.cScale1||this.secondaryColor,this.cScale2=this.cScale2||this.tertiaryColor,this.cScale3=this.cScale3||Lr(this.primaryColor,{h:30}),this.cScale4=this.cScale4||Lr(this.primaryColor,{h:60}),this.cScale5=this.cScale5||Lr(this.primaryColor,{h:90}),this.cScale6=this.cScale6||Lr(this.primaryColor,{h:120}),this.cScale7=this.cScale7||Lr(this.primaryColor,{h:150}),this.cScale8=this.cScale8||Lr(this.primaryColor,{h:210}),this.cScale9=this.cScale9||Lr(this.primaryColor,{h:270}),this.cScale10=this.cScale10||Lr(this.primaryColor,{h:300}),this.cScale11=this.cScale11||Lr(this.primaryColor,{h:330});for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleInv"+Ie]=this["cScaleInv"+Ie]||xs(this["cScale"+Ie]);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScalePeer"+Ie]=this["cScalePeer"+Ie]||oo(this["cScale"+Ie],10);for(let Ie=0;Ie<5;Ie++)this["surface"+Ie]=this["surface"+Ie]||Lr(this.mainBkg,{h:30,s:-30,l:-(-10+Ie*4)}),this["surfacePeer"+Ie]=this["surfacePeer"+Ie]||Lr(this.mainBkg,{h:30,s:-30,l:-(-7+Ie*4)});this.scaleLabelColor=this.scaleLabelColor||(this.darkMode?"black":this.labelTextColor);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleLabel"+Ie]=this["cScaleLabel"+Ie]||this.scaleLabelColor;for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["pie"+Ie]=this["cScale"+Ie];this.pieTitleTextSize=this.pieTitleTextSize||"25px",this.pieTitleTextColor=this.pieTitleTextColor||this.taskTextDarkColor,this.pieSectionTextSize=this.pieSectionTextSize||"17px",this.pieSectionTextColor=this.pieSectionTextColor||this.textColor,this.pieLegendTextSize=this.pieLegendTextSize||"17px",this.pieLegendTextColor=this.pieLegendTextColor||this.taskTextDarkColor,this.pieStrokeColor=this.pieStrokeColor||"black",this.pieStrokeWidth=this.pieStrokeWidth||"2px",this.pieOuterStrokeWidth=this.pieOuterStrokeWidth||"2px",this.pieOuterStrokeColor=this.pieOuterStrokeColor||"black",this.pieOpacity=this.pieOpacity||"0.7",this.quadrant1Fill=this.quadrant1Fill||this.primaryColor,this.quadrant2Fill=this.quadrant2Fill||Lr(this.primaryColor,{r:5,g:5,b:5}),this.quadrant3Fill=this.quadrant3Fill||Lr(this.primaryColor,{r:10,g:10,b:10}),this.quadrant4Fill=this.quadrant4Fill||Lr(this.primaryColor,{r:15,g:15,b:15}),this.quadrant1TextFill=this.quadrant1TextFill||this.primaryTextColor,this.quadrant2TextFill=this.quadrant2TextFill||Lr(this.primaryTextColor,{r:-5,g:-5,b:-5}),this.quadrant3TextFill=this.quadrant3TextFill||Lr(this.primaryTextColor,{r:-10,g:-10,b:-10}),this.quadrant4TextFill=this.quadrant4TextFill||Lr(this.primaryTextColor,{r:-15,g:-15,b:-15}),this.quadrantPointFill=this.quadrantPointFill||ST(this.quadrant1Fill)?oo(this.quadrant1Fill):Ho(this.quadrant1Fill),this.quadrantPointTextFill=this.quadrantPointTextFill||this.primaryTextColor,this.quadrantXAxisTextFill=this.quadrantXAxisTextFill||this.primaryTextColor,this.quadrantYAxisTextFill=this.quadrantYAxisTextFill||this.primaryTextColor,this.quadrantInternalBorderStrokeFill=this.quadrantInternalBorderStrokeFill||this.primaryBorderColor,this.quadrantExternalBorderStrokeFill=this.quadrantExternalBorderStrokeFill||this.primaryBorderColor,this.quadrantTitleFill=this.quadrantTitleFill||this.primaryTextColor,this.xyChart={backgroundColor:((t=this.xyChart)==null?void 0:t.backgroundColor)||this.background,titleColor:((n=this.xyChart)==null?void 0:n.titleColor)||this.primaryTextColor,xAxisTitleColor:((s=this.xyChart)==null?void 0:s.xAxisTitleColor)||this.primaryTextColor,xAxisLabelColor:((a=this.xyChart)==null?void 0:a.xAxisLabelColor)||this.primaryTextColor,xAxisTickColor:((d=this.xyChart)==null?void 0:d.xAxisTickColor)||this.primaryTextColor,xAxisLineColor:((f=this.xyChart)==null?void 0:f.xAxisLineColor)||this.primaryTextColor,yAxisTitleColor:((i=this.xyChart)==null?void 0:i.yAxisTitleColor)||this.primaryTextColor,yAxisLabelColor:((S=this.xyChart)==null?void 0:S.yAxisLabelColor)||this.primaryTextColor,yAxisTickColor:((E=this.xyChart)==null?void 0:E.yAxisTickColor)||this.primaryTextColor,yAxisLineColor:((L=this.xyChart)==null?void 0:L.yAxisLineColor)||this.primaryTextColor,plotColorPalette:((F=this.xyChart)==null?void 0:F.plotColorPalette)||"#3498db,#2ecc71,#e74c3c,#f1c40f,#bdc3c7,#ffffff,#34495e,#9b59b6,#1abc9c,#e67e22"},this.packet={startByteColor:this.primaryTextColor,endByteColor:this.primaryTextColor,labelColor:this.primaryTextColor,titleColor:this.primaryTextColor,blockStrokeColor:this.primaryTextColor,blockFillColor:this.background},this.radar={axisColor:((G=this.radar)==null?void 0:G.axisColor)||this.lineColor,axisStrokeWidth:((q=this.radar)==null?void 0:q.axisStrokeWidth)||2,axisLabelFontSize:((Q=this.radar)==null?void 0:Q.axisLabelFontSize)||12,curveOpacity:((te=this.radar)==null?void 0:te.curveOpacity)||.5,curveStrokeWidth:((he=this.radar)==null?void 0:he.curveStrokeWidth)||2,graticuleColor:((fe=this.radar)==null?void 0:fe.graticuleColor)||"#DEDEDE",graticuleStrokeWidth:((le=this.radar)==null?void 0:le.graticuleStrokeWidth)||1,graticuleOpacity:((Se=this.radar)==null?void 0:Se.graticuleOpacity)||.3,legendBoxSize:((ke=this.radar)==null?void 0:ke.legendBoxSize)||12,legendFontSize:((Ee=this.radar)==null?void 0:Ee.legendFontSize)||12},this.classText=this.primaryTextColor,this.requirementBackground=this.requirementBackground||this.primaryColor,this.requirementBorderColor=this.requirementBorderColor||this.primaryBorderColor,this.requirementBorderSize=this.requirementBorderSize||"1",this.requirementTextColor=this.requirementTextColor||this.primaryTextColor,this.relationColor=this.relationColor||this.lineColor,this.relationLabelBackground=this.relationLabelBackground||(this.darkMode?Ho(this.secondaryColor,30):this.secondaryColor),this.relationLabelColor=this.relationLabelColor||this.actorTextColor,this.git0=oo(this.secondaryColor,20),this.git1=oo(this.pie2||this.secondaryColor,20),this.git2=oo(this.pie3||this.tertiaryColor,20),this.git3=oo(this.pie4||Lr(this.primaryColor,{h:-30}),20),this.git4=oo(this.pie5||Lr(this.primaryColor,{h:-60}),20),this.git5=oo(this.pie6||Lr(this.primaryColor,{h:-90}),10),this.git6=oo(this.pie7||Lr(this.primaryColor,{h:60}),10),this.git7=oo(this.pie8||Lr(this.primaryColor,{h:120}),20),this.gitInv0=this.gitInv0||xs(this.git0),this.gitInv1=this.gitInv1||xs(this.git1),this.gitInv2=this.gitInv2||xs(this.git2),this.gitInv3=this.gitInv3||xs(this.git3),this.gitInv4=this.gitInv4||xs(this.git4),this.gitInv5=this.gitInv5||xs(this.git5),this.gitInv6=this.gitInv6||xs(this.git6),this.gitInv7=this.gitInv7||xs(this.git7),this.gitBranchLabel0=this.gitBranchLabel0||xs(this.labelTextColor),this.gitBranchLabel1=this.gitBranchLabel1||this.labelTextColor,this.gitBranchLabel2=this.gitBranchLabel2||this.labelTextColor,this.gitBranchLabel3=this.gitBranchLabel3||xs(this.labelTextColor),this.gitBranchLabel4=this.gitBranchLabel4||this.labelTextColor,this.gitBranchLabel5=this.gitBranchLabel5||this.labelTextColor,this.gitBranchLabel6=this.gitBranchLabel6||this.labelTextColor,this.gitBranchLabel7=this.gitBranchLabel7||this.labelTextColor,this.tagLabelColor=this.tagLabelColor||this.primaryTextColor,this.tagLabelBackground=this.tagLabelBackground||this.primaryColor,this.tagLabelBorder=this.tagBorder||this.primaryBorderColor,this.tagLabelFontSize=this.tagLabelFontSize||"10px",this.commitLabelColor=this.commitLabelColor||this.secondaryTextColor,this.commitLabelBackground=this.commitLabelBackground||this.secondaryColor,this.commitLabelFontSize=this.commitLabelFontSize||"10px",this.attributeBackgroundColorOdd=this.attributeBackgroundColorOdd||oo(this.background,12),this.attributeBackgroundColorEven=this.attributeBackgroundColorEven||oo(this.background,2),this.nodeBorder=this.nodeBorder||"#999"}calculate(t){if(typeof t!="object"){this.updateColors();return}const n=Object.keys(t);n.forEach(s=>{this[s]=t[s]}),this.updateColors(),n.forEach(s=>{this[s]=t[s]})}},Ze(dT,"Theme"),dT),u9=Ze(e=>{const t=new h9;return t.calculate(e),t},"getThemeVariables"),pT,d9=(pT=class{constructor(){this.background="#f4f4f4",this.primaryColor="#ECECFF",this.secondaryColor=Lr(this.primaryColor,{h:120}),this.secondaryColor="#ffffde",this.tertiaryColor=Lr(this.primaryColor,{h:-160}),this.primaryBorderColor=vm(this.primaryColor,this.darkMode),this.secondaryBorderColor=vm(this.secondaryColor,this.darkMode),this.tertiaryBorderColor=vm(this.tertiaryColor,this.darkMode),this.primaryTextColor=xs(this.primaryColor),this.secondaryTextColor=xs(this.secondaryColor),this.tertiaryTextColor=xs(this.tertiaryColor),this.lineColor=xs(this.background),this.textColor=xs(this.background),this.background="white",this.mainBkg="#ECECFF",this.secondBkg="#ffffde",this.lineColor="#333333",this.border1="#9370DB",this.border2="#aaaa33",this.arrowheadColor="#333333",this.fontFamily='"trebuchet ms", verdana, arial, sans-serif',this.fontSize="16px",this.labelBackground="rgba(232,232,232, 0.8)",this.textColor="#333",this.THEME_COLOR_LIMIT=12,this.nodeBkg="calculated",this.nodeBorder="calculated",this.clusterBkg="calculated",this.clusterBorder="calculated",this.defaultLinkColor="calculated",this.titleColor="calculated",this.edgeLabelBackground="calculated",this.actorBorder="calculated",this.actorBkg="calculated",this.actorTextColor="black",this.actorLineColor="calculated",this.signalColor="calculated",this.signalTextColor="calculated",this.labelBoxBkgColor="calculated",this.labelBoxBorderColor="calculated",this.labelTextColor="calculated",this.loopTextColor="calculated",this.noteBorderColor="calculated",this.noteBkgColor="#fff5ad",this.noteTextColor="calculated",this.activationBorderColor="#666",this.activationBkgColor="#f4f4f4",this.sequenceNumberColor="white",this.sectionBkgColor="calculated",this.altSectionBkgColor="calculated",this.sectionBkgColor2="calculated",this.excludeBkgColor="#eeeeee",this.taskBorderColor="calculated",this.taskBkgColor="calculated",this.taskTextLightColor="calculated",this.taskTextColor=this.taskTextLightColor,this.taskTextDarkColor="calculated",this.taskTextOutsideColor=this.taskTextDarkColor,this.taskTextClickableColor="calculated",this.activeTaskBorderColor="calculated",this.activeTaskBkgColor="calculated",this.gridColor="calculated",this.doneTaskBkgColor="calculated",this.doneTaskBorderColor="calculated",this.critBorderColor="calculated",this.critBkgColor="calculated",this.todayLineColor="calculated",this.vertLineColor="calculated",this.sectionBkgColor=AS(102,102,255,.49),this.altSectionBkgColor="white",this.sectionBkgColor2="#fff400",this.taskBorderColor="#534fbc",this.taskBkgColor="#8a90dd",this.taskTextLightColor="white",this.taskTextColor="calculated",this.taskTextDarkColor="black",this.taskTextOutsideColor="calculated",this.taskTextClickableColor="#003163",this.activeTaskBorderColor="#534fbc",this.activeTaskBkgColor="#bfc7ff",this.gridColor="lightgrey",this.doneTaskBkgColor="lightgrey",this.doneTaskBorderColor="grey",this.critBorderColor="#ff8888",this.critBkgColor="red",this.todayLineColor="red",this.vertLineColor="navy",this.personBorder=this.primaryBorderColor,this.personBkg=this.mainBkg,this.archEdgeColor="calculated",this.archEdgeArrowColor="calculated",this.archEdgeWidth="3",this.archGroupBorderColor=this.primaryBorderColor,this.archGroupBorderWidth="2px",this.rowOdd="calculated",this.rowEven="calculated",this.labelColor="black",this.errorBkgColor="#552222",this.errorTextColor="#552222",this.updateColors()}updateColors(){var t,n,s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee;this.cScale0=this.cScale0||this.primaryColor,this.cScale1=this.cScale1||this.secondaryColor,this.cScale2=this.cScale2||this.tertiaryColor,this.cScale3=this.cScale3||Lr(this.primaryColor,{h:30}),this.cScale4=this.cScale4||Lr(this.primaryColor,{h:60}),this.cScale5=this.cScale5||Lr(this.primaryColor,{h:90}),this.cScale6=this.cScale6||Lr(this.primaryColor,{h:120}),this.cScale7=this.cScale7||Lr(this.primaryColor,{h:150}),this.cScale8=this.cScale8||Lr(this.primaryColor,{h:210}),this.cScale9=this.cScale9||Lr(this.primaryColor,{h:270}),this.cScale10=this.cScale10||Lr(this.primaryColor,{h:300}),this.cScale11=this.cScale11||Lr(this.primaryColor,{h:330}),this.cScalePeer1=this.cScalePeer1||Ho(this.secondaryColor,45),this.cScalePeer2=this.cScalePeer2||Ho(this.tertiaryColor,40);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScale"+Ie]=Ho(this["cScale"+Ie],10),this["cScalePeer"+Ie]=this["cScalePeer"+Ie]||Ho(this["cScale"+Ie],25);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleInv"+Ie]=this["cScaleInv"+Ie]||Lr(this["cScale"+Ie],{h:180});for(let Ie=0;Ie<5;Ie++)this["surface"+Ie]=this["surface"+Ie]||Lr(this.mainBkg,{h:30,l:-(5+Ie*5)}),this["surfacePeer"+Ie]=this["surfacePeer"+Ie]||Lr(this.mainBkg,{h:30,l:-(7+Ie*5)});if(this.scaleLabelColor=this.scaleLabelColor!=="calculated"&&this.scaleLabelColor?this.scaleLabelColor:this.labelTextColor,this.labelTextColor!=="calculated"){this.cScaleLabel0=this.cScaleLabel0||xs(this.labelTextColor),this.cScaleLabel3=this.cScaleLabel3||xs(this.labelTextColor);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleLabel"+Ie]=this["cScaleLabel"+Ie]||this.labelTextColor}this.nodeBkg=this.mainBkg,this.nodeBorder=this.border1,this.clusterBkg=this.secondBkg,this.clusterBorder=this.border2,this.defaultLinkColor=this.lineColor,this.titleColor=this.textColor,this.edgeLabelBackground=this.labelBackground,this.actorBorder=oo(this.border1,23),this.actorBkg=this.mainBkg,this.labelBoxBkgColor=this.actorBkg,this.signalColor=this.textColor,this.signalTextColor=this.textColor,this.labelBoxBorderColor=this.actorBorder,this.labelTextColor=this.actorTextColor,this.loopTextColor=this.actorTextColor,this.noteBorderColor=this.border2,this.noteTextColor=this.actorTextColor,this.actorLineColor=this.actorBorder,this.taskTextColor=this.taskTextLightColor,this.taskTextOutsideColor=this.taskTextDarkColor,this.archEdgeColor=this.lineColor,this.archEdgeArrowColor=this.lineColor,this.rowOdd=this.rowOdd||oo(this.primaryColor,75)||"#ffffff",this.rowEven=this.rowEven||oo(this.primaryColor,1),this.transitionColor=this.transitionColor||this.lineColor,this.transitionLabelColor=this.transitionLabelColor||this.textColor,this.stateLabelColor=this.stateLabelColor||this.stateBkg||this.primaryTextColor,this.stateBkg=this.stateBkg||this.mainBkg,this.labelBackgroundColor=this.labelBackgroundColor||this.stateBkg,this.compositeBackground=this.compositeBackground||this.background||this.tertiaryColor,this.altBackground=this.altBackground||"#f0f0f0",this.compositeTitleBackground=this.compositeTitleBackground||this.mainBkg,this.compositeBorder=this.compositeBorder||this.nodeBorder,this.innerEndBackground=this.nodeBorder,this.specialStateColor=this.lineColor,this.errorBkgColor=this.errorBkgColor||this.tertiaryColor,this.errorTextColor=this.errorTextColor||this.tertiaryTextColor,this.transitionColor=this.transitionColor||this.lineColor,this.classText=this.primaryTextColor,this.fillType0=this.primaryColor,this.fillType1=this.secondaryColor,this.fillType2=Lr(this.primaryColor,{h:64}),this.fillType3=Lr(this.secondaryColor,{h:64}),this.fillType4=Lr(this.primaryColor,{h:-64}),this.fillType5=Lr(this.secondaryColor,{h:-64}),this.fillType6=Lr(this.primaryColor,{h:128}),this.fillType7=Lr(this.secondaryColor,{h:128}),this.pie1=this.pie1||this.primaryColor,this.pie2=this.pie2||this.secondaryColor,this.pie3=this.pie3||Lr(this.tertiaryColor,{l:-40}),this.pie4=this.pie4||Lr(this.primaryColor,{l:-10}),this.pie5=this.pie5||Lr(this.secondaryColor,{l:-30}),this.pie6=this.pie6||Lr(this.tertiaryColor,{l:-20}),this.pie7=this.pie7||Lr(this.primaryColor,{h:60,l:-20}),this.pie8=this.pie8||Lr(this.primaryColor,{h:-60,l:-40}),this.pie9=this.pie9||Lr(this.primaryColor,{h:120,l:-40}),this.pie10=this.pie10||Lr(this.primaryColor,{h:60,l:-40}),this.pie11=this.pie11||Lr(this.primaryColor,{h:-90,l:-40}),this.pie12=this.pie12||Lr(this.primaryColor,{h:120,l:-30}),this.pieTitleTextSize=this.pieTitleTextSize||"25px",this.pieTitleTextColor=this.pieTitleTextColor||this.taskTextDarkColor,this.pieSectionTextSize=this.pieSectionTextSize||"17px",this.pieSectionTextColor=this.pieSectionTextColor||this.textColor,this.pieLegendTextSize=this.pieLegendTextSize||"17px",this.pieLegendTextColor=this.pieLegendTextColor||this.taskTextDarkColor,this.pieStrokeColor=this.pieStrokeColor||"black",this.pieStrokeWidth=this.pieStrokeWidth||"2px",this.pieOuterStrokeWidth=this.pieOuterStrokeWidth||"2px",this.pieOuterStrokeColor=this.pieOuterStrokeColor||"black",this.pieOpacity=this.pieOpacity||"0.7",this.quadrant1Fill=this.quadrant1Fill||this.primaryColor,this.quadrant2Fill=this.quadrant2Fill||Lr(this.primaryColor,{r:5,g:5,b:5}),this.quadrant3Fill=this.quadrant3Fill||Lr(this.primaryColor,{r:10,g:10,b:10}),this.quadrant4Fill=this.quadrant4Fill||Lr(this.primaryColor,{r:15,g:15,b:15}),this.quadrant1TextFill=this.quadrant1TextFill||this.primaryTextColor,this.quadrant2TextFill=this.quadrant2TextFill||Lr(this.primaryTextColor,{r:-5,g:-5,b:-5}),this.quadrant3TextFill=this.quadrant3TextFill||Lr(this.primaryTextColor,{r:-10,g:-10,b:-10}),this.quadrant4TextFill=this.quadrant4TextFill||Lr(this.primaryTextColor,{r:-15,g:-15,b:-15}),this.quadrantPointFill=this.quadrantPointFill||ST(this.quadrant1Fill)?oo(this.quadrant1Fill):Ho(this.quadrant1Fill),this.quadrantPointTextFill=this.quadrantPointTextFill||this.primaryTextColor,this.quadrantXAxisTextFill=this.quadrantXAxisTextFill||this.primaryTextColor,this.quadrantYAxisTextFill=this.quadrantYAxisTextFill||this.primaryTextColor,this.quadrantInternalBorderStrokeFill=this.quadrantInternalBorderStrokeFill||this.primaryBorderColor,this.quadrantExternalBorderStrokeFill=this.quadrantExternalBorderStrokeFill||this.primaryBorderColor,this.quadrantTitleFill=this.quadrantTitleFill||this.primaryTextColor,this.radar={axisColor:((t=this.radar)==null?void 0:t.axisColor)||this.lineColor,axisStrokeWidth:((n=this.radar)==null?void 0:n.axisStrokeWidth)||2,axisLabelFontSize:((s=this.radar)==null?void 0:s.axisLabelFontSize)||12,curveOpacity:((a=this.radar)==null?void 0:a.curveOpacity)||.5,curveStrokeWidth:((d=this.radar)==null?void 0:d.curveStrokeWidth)||2,graticuleColor:((f=this.radar)==null?void 0:f.graticuleColor)||"#DEDEDE",graticuleStrokeWidth:((i=this.radar)==null?void 0:i.graticuleStrokeWidth)||1,graticuleOpacity:((S=this.radar)==null?void 0:S.graticuleOpacity)||.3,legendBoxSize:((E=this.radar)==null?void 0:E.legendBoxSize)||12,legendFontSize:((L=this.radar)==null?void 0:L.legendFontSize)||12},this.xyChart={backgroundColor:((F=this.xyChart)==null?void 0:F.backgroundColor)||this.background,titleColor:((G=this.xyChart)==null?void 0:G.titleColor)||this.primaryTextColor,xAxisTitleColor:((q=this.xyChart)==null?void 0:q.xAxisTitleColor)||this.primaryTextColor,xAxisLabelColor:((Q=this.xyChart)==null?void 0:Q.xAxisLabelColor)||this.primaryTextColor,xAxisTickColor:((te=this.xyChart)==null?void 0:te.xAxisTickColor)||this.primaryTextColor,xAxisLineColor:((he=this.xyChart)==null?void 0:he.xAxisLineColor)||this.primaryTextColor,yAxisTitleColor:((fe=this.xyChart)==null?void 0:fe.yAxisTitleColor)||this.primaryTextColor,yAxisLabelColor:((le=this.xyChart)==null?void 0:le.yAxisLabelColor)||this.primaryTextColor,yAxisTickColor:((Se=this.xyChart)==null?void 0:Se.yAxisTickColor)||this.primaryTextColor,yAxisLineColor:((ke=this.xyChart)==null?void 0:ke.yAxisLineColor)||this.primaryTextColor,plotColorPalette:((Ee=this.xyChart)==null?void 0:Ee.plotColorPalette)||"#ECECFF,#8493A6,#FFC3A0,#DCDDE1,#B8E994,#D1A36F,#C3CDE6,#FFB6C1,#496078,#F8F3E3"},this.requirementBackground=this.requirementBackground||this.primaryColor,this.requirementBorderColor=this.requirementBorderColor||this.primaryBorderColor,this.requirementBorderSize=this.requirementBorderSize||"1",this.requirementTextColor=this.requirementTextColor||this.primaryTextColor,this.relationColor=this.relationColor||this.lineColor,this.relationLabelBackground=this.relationLabelBackground||this.labelBackground,this.relationLabelColor=this.relationLabelColor||this.actorTextColor,this.git0=this.git0||this.primaryColor,this.git1=this.git1||this.secondaryColor,this.git2=this.git2||this.tertiaryColor,this.git3=this.git3||Lr(this.primaryColor,{h:-30}),this.git4=this.git4||Lr(this.primaryColor,{h:-60}),this.git5=this.git5||Lr(this.primaryColor,{h:-90}),this.git6=this.git6||Lr(this.primaryColor,{h:60}),this.git7=this.git7||Lr(this.primaryColor,{h:120}),this.darkMode?(this.git0=oo(this.git0,25),this.git1=oo(this.git1,25),this.git2=oo(this.git2,25),this.git3=oo(this.git3,25),this.git4=oo(this.git4,25),this.git5=oo(this.git5,25),this.git6=oo(this.git6,25),this.git7=oo(this.git7,25)):(this.git0=Ho(this.git0,25),this.git1=Ho(this.git1,25),this.git2=Ho(this.git2,25),this.git3=Ho(this.git3,25),this.git4=Ho(this.git4,25),this.git5=Ho(this.git5,25),this.git6=Ho(this.git6,25),this.git7=Ho(this.git7,25)),this.gitInv0=this.gitInv0||Ho(xs(this.git0),25),this.gitInv1=this.gitInv1||xs(this.git1),this.gitInv2=this.gitInv2||xs(this.git2),this.gitInv3=this.gitInv3||xs(this.git3),this.gitInv4=this.gitInv4||xs(this.git4),this.gitInv5=this.gitInv5||xs(this.git5),this.gitInv6=this.gitInv6||xs(this.git6),this.gitInv7=this.gitInv7||xs(this.git7),this.gitBranchLabel0=this.gitBranchLabel0||xs(this.labelTextColor),this.gitBranchLabel1=this.gitBranchLabel1||this.labelTextColor,this.gitBranchLabel2=this.gitBranchLabel2||this.labelTextColor,this.gitBranchLabel3=this.gitBranchLabel3||xs(this.labelTextColor),this.gitBranchLabel4=this.gitBranchLabel4||this.labelTextColor,this.gitBranchLabel5=this.gitBranchLabel5||this.labelTextColor,this.gitBranchLabel6=this.gitBranchLabel6||this.labelTextColor,this.gitBranchLabel7=this.gitBranchLabel7||this.labelTextColor,this.tagLabelColor=this.tagLabelColor||this.primaryTextColor,this.tagLabelBackground=this.tagLabelBackground||this.primaryColor,this.tagLabelBorder=this.tagBorder||this.primaryBorderColor,this.tagLabelFontSize=this.tagLabelFontSize||"10px",this.commitLabelColor=this.commitLabelColor||this.secondaryTextColor,this.commitLabelBackground=this.commitLabelBackground||this.secondaryColor,this.commitLabelFontSize=this.commitLabelFontSize||"10px",this.attributeBackgroundColorOdd=this.attributeBackgroundColorOdd||W2,this.attributeBackgroundColorEven=this.attributeBackgroundColorEven||j2}calculate(t){if(Object.keys(this).forEach(s=>{this[s]==="calculated"&&(this[s]=void 0)}),typeof t!="object"){this.updateColors();return}const n=Object.keys(t);n.forEach(s=>{this[s]=t[s]}),this.updateColors(),n.forEach(s=>{this[s]=t[s]})}},Ze(pT,"Theme"),pT),p9=Ze(e=>{const t=new d9;return t.calculate(e),t},"getThemeVariables"),fT,f9=(fT=class{constructor(){this.background="#f4f4f4",this.primaryColor="#cde498",this.secondaryColor="#cdffb2",this.background="white",this.mainBkg="#cde498",this.secondBkg="#cdffb2",this.lineColor="green",this.border1="#13540c",this.border2="#6eaa49",this.arrowheadColor="green",this.fontFamily='"trebuchet ms", verdana, arial, sans-serif',this.fontSize="16px",this.tertiaryColor=oo("#cde498",10),this.primaryBorderColor=vm(this.primaryColor,this.darkMode),this.secondaryBorderColor=vm(this.secondaryColor,this.darkMode),this.tertiaryBorderColor=vm(this.tertiaryColor,this.darkMode),this.primaryTextColor=xs(this.primaryColor),this.secondaryTextColor=xs(this.secondaryColor),this.tertiaryTextColor=xs(this.primaryColor),this.lineColor=xs(this.background),this.textColor=xs(this.background),this.THEME_COLOR_LIMIT=12,this.nodeBkg="calculated",this.nodeBorder="calculated",this.clusterBkg="calculated",this.clusterBorder="calculated",this.defaultLinkColor="calculated",this.titleColor="#333",this.edgeLabelBackground="#e8e8e8",this.actorBorder="calculated",this.actorBkg="calculated",this.actorTextColor="black",this.actorLineColor="calculated",this.signalColor="#333",this.signalTextColor="#333",this.labelBoxBkgColor="calculated",this.labelBoxBorderColor="#326932",this.labelTextColor="calculated",this.loopTextColor="calculated",this.noteBorderColor="calculated",this.noteBkgColor="#fff5ad",this.noteTextColor="calculated",this.activationBorderColor="#666",this.activationBkgColor="#f4f4f4",this.sequenceNumberColor="white",this.sectionBkgColor="#6eaa49",this.altSectionBkgColor="white",this.sectionBkgColor2="#6eaa49",this.excludeBkgColor="#eeeeee",this.taskBorderColor="calculated",this.taskBkgColor="#487e3a",this.taskTextLightColor="white",this.taskTextColor="calculated",this.taskTextDarkColor="black",this.taskTextOutsideColor="calculated",this.taskTextClickableColor="#003163",this.activeTaskBorderColor="calculated",this.activeTaskBkgColor="calculated",this.gridColor="lightgrey",this.doneTaskBkgColor="lightgrey",this.doneTaskBorderColor="grey",this.critBorderColor="#ff8888",this.critBkgColor="red",this.todayLineColor="red",this.vertLineColor="#00BFFF",this.personBorder=this.primaryBorderColor,this.personBkg=this.mainBkg,this.archEdgeColor="calculated",this.archEdgeArrowColor="calculated",this.archEdgeWidth="3",this.archGroupBorderColor=this.primaryBorderColor,this.archGroupBorderWidth="2px",this.labelColor="black",this.errorBkgColor="#552222",this.errorTextColor="#552222"}updateColors(){var t,n,s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee;this.actorBorder=Ho(this.mainBkg,20),this.actorBkg=this.mainBkg,this.labelBoxBkgColor=this.actorBkg,this.labelTextColor=this.actorTextColor,this.loopTextColor=this.actorTextColor,this.noteBorderColor=this.border2,this.noteTextColor=this.actorTextColor,this.actorLineColor=this.actorBorder,this.cScale0=this.cScale0||this.primaryColor,this.cScale1=this.cScale1||this.secondaryColor,this.cScale2=this.cScale2||this.tertiaryColor,this.cScale3=this.cScale3||Lr(this.primaryColor,{h:30}),this.cScale4=this.cScale4||Lr(this.primaryColor,{h:60}),this.cScale5=this.cScale5||Lr(this.primaryColor,{h:90}),this.cScale6=this.cScale6||Lr(this.primaryColor,{h:120}),this.cScale7=this.cScale7||Lr(this.primaryColor,{h:150}),this.cScale8=this.cScale8||Lr(this.primaryColor,{h:210}),this.cScale9=this.cScale9||Lr(this.primaryColor,{h:270}),this.cScale10=this.cScale10||Lr(this.primaryColor,{h:300}),this.cScale11=this.cScale11||Lr(this.primaryColor,{h:330}),this.cScalePeer1=this.cScalePeer1||Ho(this.secondaryColor,45),this.cScalePeer2=this.cScalePeer2||Ho(this.tertiaryColor,40);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScale"+Ie]=Ho(this["cScale"+Ie],10),this["cScalePeer"+Ie]=this["cScalePeer"+Ie]||Ho(this["cScale"+Ie],25);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleInv"+Ie]=this["cScaleInv"+Ie]||Lr(this["cScale"+Ie],{h:180});this.scaleLabelColor=this.scaleLabelColor!=="calculated"&&this.scaleLabelColor?this.scaleLabelColor:this.labelTextColor;for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleLabel"+Ie]=this["cScaleLabel"+Ie]||this.scaleLabelColor;for(let Ie=0;Ie<5;Ie++)this["surface"+Ie]=this["surface"+Ie]||Lr(this.mainBkg,{h:30,s:-30,l:-(5+Ie*5)}),this["surfacePeer"+Ie]=this["surfacePeer"+Ie]||Lr(this.mainBkg,{h:30,s:-30,l:-(8+Ie*5)});this.nodeBkg=this.mainBkg,this.nodeBorder=this.border1,this.clusterBkg=this.secondBkg,this.clusterBorder=this.border2,this.defaultLinkColor=this.lineColor,this.taskBorderColor=this.border1,this.taskTextColor=this.taskTextLightColor,this.taskTextOutsideColor=this.taskTextDarkColor,this.activeTaskBorderColor=this.taskBorderColor,this.activeTaskBkgColor=this.mainBkg,this.archEdgeColor=this.lineColor,this.archEdgeArrowColor=this.lineColor,this.rowOdd=this.rowOdd||oo(this.mainBkg,75)||"#ffffff",this.rowEven=this.rowEven||oo(this.mainBkg,20),this.transitionColor=this.transitionColor||this.lineColor,this.transitionLabelColor=this.transitionLabelColor||this.textColor,this.stateLabelColor=this.stateLabelColor||this.stateBkg||this.primaryTextColor,this.stateBkg=this.stateBkg||this.mainBkg,this.labelBackgroundColor=this.labelBackgroundColor||this.stateBkg,this.compositeBackground=this.compositeBackground||this.background||this.tertiaryColor,this.altBackground=this.altBackground||"#f0f0f0",this.compositeTitleBackground=this.compositeTitleBackground||this.mainBkg,this.compositeBorder=this.compositeBorder||this.nodeBorder,this.innerEndBackground=this.primaryBorderColor,this.specialStateColor=this.lineColor,this.errorBkgColor=this.errorBkgColor||this.tertiaryColor,this.errorTextColor=this.errorTextColor||this.tertiaryTextColor,this.transitionColor=this.transitionColor||this.lineColor,this.classText=this.primaryTextColor,this.fillType0=this.primaryColor,this.fillType1=this.secondaryColor,this.fillType2=Lr(this.primaryColor,{h:64}),this.fillType3=Lr(this.secondaryColor,{h:64}),this.fillType4=Lr(this.primaryColor,{h:-64}),this.fillType5=Lr(this.secondaryColor,{h:-64}),this.fillType6=Lr(this.primaryColor,{h:128}),this.fillType7=Lr(this.secondaryColor,{h:128}),this.pie1=this.pie1||this.primaryColor,this.pie2=this.pie2||this.secondaryColor,this.pie3=this.pie3||this.tertiaryColor,this.pie4=this.pie4||Lr(this.primaryColor,{l:-30}),this.pie5=this.pie5||Lr(this.secondaryColor,{l:-30}),this.pie6=this.pie6||Lr(this.tertiaryColor,{h:40,l:-40}),this.pie7=this.pie7||Lr(this.primaryColor,{h:60,l:-10}),this.pie8=this.pie8||Lr(this.primaryColor,{h:-60,l:-10}),this.pie9=this.pie9||Lr(this.primaryColor,{h:120,l:0}),this.pie10=this.pie10||Lr(this.primaryColor,{h:60,l:-50}),this.pie11=this.pie11||Lr(this.primaryColor,{h:-60,l:-50}),this.pie12=this.pie12||Lr(this.primaryColor,{h:120,l:-50}),this.pieTitleTextSize=this.pieTitleTextSize||"25px",this.pieTitleTextColor=this.pieTitleTextColor||this.taskTextDarkColor,this.pieSectionTextSize=this.pieSectionTextSize||"17px",this.pieSectionTextColor=this.pieSectionTextColor||this.textColor,this.pieLegendTextSize=this.pieLegendTextSize||"17px",this.pieLegendTextColor=this.pieLegendTextColor||this.taskTextDarkColor,this.pieStrokeColor=this.pieStrokeColor||"black",this.pieStrokeWidth=this.pieStrokeWidth||"2px",this.pieOuterStrokeWidth=this.pieOuterStrokeWidth||"2px",this.pieOuterStrokeColor=this.pieOuterStrokeColor||"black",this.pieOpacity=this.pieOpacity||"0.7",this.quadrant1Fill=this.quadrant1Fill||this.primaryColor,this.quadrant2Fill=this.quadrant2Fill||Lr(this.primaryColor,{r:5,g:5,b:5}),this.quadrant3Fill=this.quadrant3Fill||Lr(this.primaryColor,{r:10,g:10,b:10}),this.quadrant4Fill=this.quadrant4Fill||Lr(this.primaryColor,{r:15,g:15,b:15}),this.quadrant1TextFill=this.quadrant1TextFill||this.primaryTextColor,this.quadrant2TextFill=this.quadrant2TextFill||Lr(this.primaryTextColor,{r:-5,g:-5,b:-5}),this.quadrant3TextFill=this.quadrant3TextFill||Lr(this.primaryTextColor,{r:-10,g:-10,b:-10}),this.quadrant4TextFill=this.quadrant4TextFill||Lr(this.primaryTextColor,{r:-15,g:-15,b:-15}),this.quadrantPointFill=this.quadrantPointFill||ST(this.quadrant1Fill)?oo(this.quadrant1Fill):Ho(this.quadrant1Fill),this.quadrantPointTextFill=this.quadrantPointTextFill||this.primaryTextColor,this.quadrantXAxisTextFill=this.quadrantXAxisTextFill||this.primaryTextColor,this.quadrantYAxisTextFill=this.quadrantYAxisTextFill||this.primaryTextColor,this.quadrantInternalBorderStrokeFill=this.quadrantInternalBorderStrokeFill||this.primaryBorderColor,this.quadrantExternalBorderStrokeFill=this.quadrantExternalBorderStrokeFill||this.primaryBorderColor,this.quadrantTitleFill=this.quadrantTitleFill||this.primaryTextColor,this.packet={startByteColor:this.primaryTextColor,endByteColor:this.primaryTextColor,labelColor:this.primaryTextColor,titleColor:this.primaryTextColor,blockStrokeColor:this.primaryTextColor,blockFillColor:this.mainBkg},this.radar={axisColor:((t=this.radar)==null?void 0:t.axisColor)||this.lineColor,axisStrokeWidth:((n=this.radar)==null?void 0:n.axisStrokeWidth)||2,axisLabelFontSize:((s=this.radar)==null?void 0:s.axisLabelFontSize)||12,curveOpacity:((a=this.radar)==null?void 0:a.curveOpacity)||.5,curveStrokeWidth:((d=this.radar)==null?void 0:d.curveStrokeWidth)||2,graticuleColor:((f=this.radar)==null?void 0:f.graticuleColor)||"#DEDEDE",graticuleStrokeWidth:((i=this.radar)==null?void 0:i.graticuleStrokeWidth)||1,graticuleOpacity:((S=this.radar)==null?void 0:S.graticuleOpacity)||.3,legendBoxSize:((E=this.radar)==null?void 0:E.legendBoxSize)||12,legendFontSize:((L=this.radar)==null?void 0:L.legendFontSize)||12},this.xyChart={backgroundColor:((F=this.xyChart)==null?void 0:F.backgroundColor)||this.background,titleColor:((G=this.xyChart)==null?void 0:G.titleColor)||this.primaryTextColor,xAxisTitleColor:((q=this.xyChart)==null?void 0:q.xAxisTitleColor)||this.primaryTextColor,xAxisLabelColor:((Q=this.xyChart)==null?void 0:Q.xAxisLabelColor)||this.primaryTextColor,xAxisTickColor:((te=this.xyChart)==null?void 0:te.xAxisTickColor)||this.primaryTextColor,xAxisLineColor:((he=this.xyChart)==null?void 0:he.xAxisLineColor)||this.primaryTextColor,yAxisTitleColor:((fe=this.xyChart)==null?void 0:fe.yAxisTitleColor)||this.primaryTextColor,yAxisLabelColor:((le=this.xyChart)==null?void 0:le.yAxisLabelColor)||this.primaryTextColor,yAxisTickColor:((Se=this.xyChart)==null?void 0:Se.yAxisTickColor)||this.primaryTextColor,yAxisLineColor:((ke=this.xyChart)==null?void 0:ke.yAxisLineColor)||this.primaryTextColor,plotColorPalette:((Ee=this.xyChart)==null?void 0:Ee.plotColorPalette)||"#CDE498,#FF6B6B,#A0D2DB,#D7BDE2,#F0F0F0,#FFC3A0,#7FD8BE,#FF9A8B,#FAF3E0,#FFF176"},this.requirementBackground=this.requirementBackground||this.primaryColor,this.requirementBorderColor=this.requirementBorderColor||this.primaryBorderColor,this.requirementBorderSize=this.requirementBorderSize||"1",this.requirementTextColor=this.requirementTextColor||this.primaryTextColor,this.relationColor=this.relationColor||this.lineColor,this.relationLabelBackground=this.relationLabelBackground||this.edgeLabelBackground,this.relationLabelColor=this.relationLabelColor||this.actorTextColor,this.git0=this.git0||this.primaryColor,this.git1=this.git1||this.secondaryColor,this.git2=this.git2||this.tertiaryColor,this.git3=this.git3||Lr(this.primaryColor,{h:-30}),this.git4=this.git4||Lr(this.primaryColor,{h:-60}),this.git5=this.git5||Lr(this.primaryColor,{h:-90}),this.git6=this.git6||Lr(this.primaryColor,{h:60}),this.git7=this.git7||Lr(this.primaryColor,{h:120}),this.darkMode?(this.git0=oo(this.git0,25),this.git1=oo(this.git1,25),this.git2=oo(this.git2,25),this.git3=oo(this.git3,25),this.git4=oo(this.git4,25),this.git5=oo(this.git5,25),this.git6=oo(this.git6,25),this.git7=oo(this.git7,25)):(this.git0=Ho(this.git0,25),this.git1=Ho(this.git1,25),this.git2=Ho(this.git2,25),this.git3=Ho(this.git3,25),this.git4=Ho(this.git4,25),this.git5=Ho(this.git5,25),this.git6=Ho(this.git6,25),this.git7=Ho(this.git7,25)),this.gitInv0=this.gitInv0||xs(this.git0),this.gitInv1=this.gitInv1||xs(this.git1),this.gitInv2=this.gitInv2||xs(this.git2),this.gitInv3=this.gitInv3||xs(this.git3),this.gitInv4=this.gitInv4||xs(this.git4),this.gitInv5=this.gitInv5||xs(this.git5),this.gitInv6=this.gitInv6||xs(this.git6),this.gitInv7=this.gitInv7||xs(this.git7),this.gitBranchLabel0=this.gitBranchLabel0||xs(this.labelTextColor),this.gitBranchLabel1=this.gitBranchLabel1||this.labelTextColor,this.gitBranchLabel2=this.gitBranchLabel2||this.labelTextColor,this.gitBranchLabel3=this.gitBranchLabel3||xs(this.labelTextColor),this.gitBranchLabel4=this.gitBranchLabel4||this.labelTextColor,this.gitBranchLabel5=this.gitBranchLabel5||this.labelTextColor,this.gitBranchLabel6=this.gitBranchLabel6||this.labelTextColor,this.gitBranchLabel7=this.gitBranchLabel7||this.labelTextColor,this.tagLabelColor=this.tagLabelColor||this.primaryTextColor,this.tagLabelBackground=this.tagLabelBackground||this.primaryColor,this.tagLabelBorder=this.tagBorder||this.primaryBorderColor,this.tagLabelFontSize=this.tagLabelFontSize||"10px",this.commitLabelColor=this.commitLabelColor||this.secondaryTextColor,this.commitLabelBackground=this.commitLabelBackground||this.secondaryColor,this.commitLabelFontSize=this.commitLabelFontSize||"10px",this.attributeBackgroundColorOdd=this.attributeBackgroundColorOdd||W2,this.attributeBackgroundColorEven=this.attributeBackgroundColorEven||j2}calculate(t){if(typeof t!="object"){this.updateColors();return}const n=Object.keys(t);n.forEach(s=>{this[s]=t[s]}),this.updateColors(),n.forEach(s=>{this[s]=t[s]})}},Ze(fT,"Theme"),fT),m9=Ze(e=>{const t=new f9;return t.calculate(e),t},"getThemeVariables"),mT,g9=(mT=class{constructor(){this.primaryColor="#eee",this.contrast="#707070",this.secondaryColor=oo(this.contrast,55),this.background="#ffffff",this.tertiaryColor=Lr(this.primaryColor,{h:-160}),this.primaryBorderColor=vm(this.primaryColor,this.darkMode),this.secondaryBorderColor=vm(this.secondaryColor,this.darkMode),this.tertiaryBorderColor=vm(this.tertiaryColor,this.darkMode),this.primaryTextColor=xs(this.primaryColor),this.secondaryTextColor=xs(this.secondaryColor),this.tertiaryTextColor=xs(this.tertiaryColor),this.lineColor=xs(this.background),this.textColor=xs(this.background),this.mainBkg="#eee",this.secondBkg="calculated",this.lineColor="#666",this.border1="#999",this.border2="calculated",this.note="#ffa",this.text="#333",this.critical="#d42",this.done="#bbb",this.arrowheadColor="#333333",this.fontFamily='"trebuchet ms", verdana, arial, sans-serif',this.fontSize="16px",this.THEME_COLOR_LIMIT=12,this.nodeBkg="calculated",this.nodeBorder="calculated",this.clusterBkg="calculated",this.clusterBorder="calculated",this.defaultLinkColor="calculated",this.titleColor="calculated",this.edgeLabelBackground="white",this.actorBorder="calculated",this.actorBkg="calculated",this.actorTextColor="calculated",this.actorLineColor=this.actorBorder,this.signalColor="calculated",this.signalTextColor="calculated",this.labelBoxBkgColor="calculated",this.labelBoxBorderColor="calculated",this.labelTextColor="calculated",this.loopTextColor="calculated",this.noteBorderColor="calculated",this.noteBkgColor="calculated",this.noteTextColor="calculated",this.activationBorderColor="#666",this.activationBkgColor="#f4f4f4",this.sequenceNumberColor="white",this.sectionBkgColor="calculated",this.altSectionBkgColor="white",this.sectionBkgColor2="calculated",this.excludeBkgColor="#eeeeee",this.taskBorderColor="calculated",this.taskBkgColor="calculated",this.taskTextLightColor="white",this.taskTextColor="calculated",this.taskTextDarkColor="calculated",this.taskTextOutsideColor="calculated",this.taskTextClickableColor="#003163",this.activeTaskBorderColor="calculated",this.activeTaskBkgColor="calculated",this.gridColor="calculated",this.doneTaskBkgColor="calculated",this.doneTaskBorderColor="calculated",this.critBkgColor="calculated",this.critBorderColor="calculated",this.todayLineColor="calculated",this.vertLineColor="calculated",this.personBorder=this.primaryBorderColor,this.personBkg=this.mainBkg,this.archEdgeColor="calculated",this.archEdgeArrowColor="calculated",this.archEdgeWidth="3",this.archGroupBorderColor=this.primaryBorderColor,this.archGroupBorderWidth="2px",this.rowOdd=this.rowOdd||oo(this.mainBkg,75)||"#ffffff",this.rowEven=this.rowEven||"#f4f4f4",this.labelColor="black",this.errorBkgColor="#552222",this.errorTextColor="#552222"}updateColors(){var t,n,s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee;this.secondBkg=oo(this.contrast,55),this.border2=this.contrast,this.actorBorder=oo(this.border1,23),this.actorBkg=this.mainBkg,this.actorTextColor=this.text,this.actorLineColor=this.actorBorder,this.signalColor=this.text,this.signalTextColor=this.text,this.labelBoxBkgColor=this.actorBkg,this.labelBoxBorderColor=this.actorBorder,this.labelTextColor=this.text,this.loopTextColor=this.text,this.noteBorderColor="#999",this.noteBkgColor="#666",this.noteTextColor="#fff",this.cScale0=this.cScale0||"#555",this.cScale1=this.cScale1||"#F4F4F4",this.cScale2=this.cScale2||"#555",this.cScale3=this.cScale3||"#BBB",this.cScale4=this.cScale4||"#777",this.cScale5=this.cScale5||"#999",this.cScale6=this.cScale6||"#DDD",this.cScale7=this.cScale7||"#FFF",this.cScale8=this.cScale8||"#DDD",this.cScale9=this.cScale9||"#BBB",this.cScale10=this.cScale10||"#999",this.cScale11=this.cScale11||"#777";for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleInv"+Ie]=this["cScaleInv"+Ie]||xs(this["cScale"+Ie]);for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this.darkMode?this["cScalePeer"+Ie]=this["cScalePeer"+Ie]||oo(this["cScale"+Ie],10):this["cScalePeer"+Ie]=this["cScalePeer"+Ie]||Ho(this["cScale"+Ie],10);this.scaleLabelColor=this.scaleLabelColor||(this.darkMode?"black":this.labelTextColor),this.cScaleLabel0=this.cScaleLabel0||this.cScale1,this.cScaleLabel2=this.cScaleLabel2||this.cScale1;for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["cScaleLabel"+Ie]=this["cScaleLabel"+Ie]||this.scaleLabelColor;for(let Ie=0;Ie<5;Ie++)this["surface"+Ie]=this["surface"+Ie]||Lr(this.mainBkg,{l:-(5+Ie*5)}),this["surfacePeer"+Ie]=this["surfacePeer"+Ie]||Lr(this.mainBkg,{l:-(8+Ie*5)});this.nodeBkg=this.mainBkg,this.nodeBorder=this.border1,this.clusterBkg=this.secondBkg,this.clusterBorder=this.border2,this.defaultLinkColor=this.lineColor,this.titleColor=this.text,this.sectionBkgColor=oo(this.contrast,30),this.sectionBkgColor2=oo(this.contrast,30),this.taskBorderColor=Ho(this.contrast,10),this.taskBkgColor=this.contrast,this.taskTextColor=this.taskTextLightColor,this.taskTextDarkColor=this.text,this.taskTextOutsideColor=this.taskTextDarkColor,this.activeTaskBorderColor=this.taskBorderColor,this.activeTaskBkgColor=this.mainBkg,this.gridColor=oo(this.border1,30),this.doneTaskBkgColor=this.done,this.doneTaskBorderColor=this.lineColor,this.critBkgColor=this.critical,this.critBorderColor=Ho(this.critBkgColor,10),this.todayLineColor=this.critBkgColor,this.vertLineColor=this.critBkgColor,this.archEdgeColor=this.lineColor,this.archEdgeArrowColor=this.lineColor,this.transitionColor=this.transitionColor||"#000",this.transitionLabelColor=this.transitionLabelColor||this.textColor,this.stateLabelColor=this.stateLabelColor||this.stateBkg||this.primaryTextColor,this.stateBkg=this.stateBkg||this.mainBkg,this.labelBackgroundColor=this.labelBackgroundColor||this.stateBkg,this.compositeBackground=this.compositeBackground||this.background||this.tertiaryColor,this.altBackground=this.altBackground||"#f4f4f4",this.compositeTitleBackground=this.compositeTitleBackground||this.mainBkg,this.stateBorder=this.stateBorder||"#000",this.innerEndBackground=this.primaryBorderColor,this.specialStateColor="#222",this.errorBkgColor=this.errorBkgColor||this.tertiaryColor,this.errorTextColor=this.errorTextColor||this.tertiaryTextColor,this.classText=this.primaryTextColor,this.fillType0=this.primaryColor,this.fillType1=this.secondaryColor,this.fillType2=Lr(this.primaryColor,{h:64}),this.fillType3=Lr(this.secondaryColor,{h:64}),this.fillType4=Lr(this.primaryColor,{h:-64}),this.fillType5=Lr(this.secondaryColor,{h:-64}),this.fillType6=Lr(this.primaryColor,{h:128}),this.fillType7=Lr(this.secondaryColor,{h:128});for(let Ie=0;Ie<this.THEME_COLOR_LIMIT;Ie++)this["pie"+Ie]=this["cScale"+Ie];this.pie12=this.pie0,this.pieTitleTextSize=this.pieTitleTextSize||"25px",this.pieTitleTextColor=this.pieTitleTextColor||this.taskTextDarkColor,this.pieSectionTextSize=this.pieSectionTextSize||"17px",this.pieSectionTextColor=this.pieSectionTextColor||this.textColor,this.pieLegendTextSize=this.pieLegendTextSize||"17px",this.pieLegendTextColor=this.pieLegendTextColor||this.taskTextDarkColor,this.pieStrokeColor=this.pieStrokeColor||"black",this.pieStrokeWidth=this.pieStrokeWidth||"2px",this.pieOuterStrokeWidth=this.pieOuterStrokeWidth||"2px",this.pieOuterStrokeColor=this.pieOuterStrokeColor||"black",this.pieOpacity=this.pieOpacity||"0.7",this.quadrant1Fill=this.quadrant1Fill||this.primaryColor,this.quadrant2Fill=this.quadrant2Fill||Lr(this.primaryColor,{r:5,g:5,b:5}),this.quadrant3Fill=this.quadrant3Fill||Lr(this.primaryColor,{r:10,g:10,b:10}),this.quadrant4Fill=this.quadrant4Fill||Lr(this.primaryColor,{r:15,g:15,b:15}),this.quadrant1TextFill=this.quadrant1TextFill||this.primaryTextColor,this.quadrant2TextFill=this.quadrant2TextFill||Lr(this.primaryTextColor,{r:-5,g:-5,b:-5}),this.quadrant3TextFill=this.quadrant3TextFill||Lr(this.primaryTextColor,{r:-10,g:-10,b:-10}),this.quadrant4TextFill=this.quadrant4TextFill||Lr(this.primaryTextColor,{r:-15,g:-15,b:-15}),this.quadrantPointFill=this.quadrantPointFill||ST(this.quadrant1Fill)?oo(this.quadrant1Fill):Ho(this.quadrant1Fill),this.quadrantPointTextFill=this.quadrantPointTextFill||this.primaryTextColor,this.quadrantXAxisTextFill=this.quadrantXAxisTextFill||this.primaryTextColor,this.quadrantYAxisTextFill=this.quadrantYAxisTextFill||this.primaryTextColor,this.quadrantInternalBorderStrokeFill=this.quadrantInternalBorderStrokeFill||this.primaryBorderColor,this.quadrantExternalBorderStrokeFill=this.quadrantExternalBorderStrokeFill||this.primaryBorderColor,this.quadrantTitleFill=this.quadrantTitleFill||this.primaryTextColor,this.xyChart={backgroundColor:((t=this.xyChart)==null?void 0:t.backgroundColor)||this.background,titleColor:((n=this.xyChart)==null?void 0:n.titleColor)||this.primaryTextColor,xAxisTitleColor:((s=this.xyChart)==null?void 0:s.xAxisTitleColor)||this.primaryTextColor,xAxisLabelColor:((a=this.xyChart)==null?void 0:a.xAxisLabelColor)||this.primaryTextColor,xAxisTickColor:((d=this.xyChart)==null?void 0:d.xAxisTickColor)||this.primaryTextColor,xAxisLineColor:((f=this.xyChart)==null?void 0:f.xAxisLineColor)||this.primaryTextColor,yAxisTitleColor:((i=this.xyChart)==null?void 0:i.yAxisTitleColor)||this.primaryTextColor,yAxisLabelColor:((S=this.xyChart)==null?void 0:S.yAxisLabelColor)||this.primaryTextColor,yAxisTickColor:((E=this.xyChart)==null?void 0:E.yAxisTickColor)||this.primaryTextColor,yAxisLineColor:((L=this.xyChart)==null?void 0:L.yAxisLineColor)||this.primaryTextColor,plotColorPalette:((F=this.xyChart)==null?void 0:F.plotColorPalette)||"#EEE,#6BB8E4,#8ACB88,#C7ACD6,#E8DCC2,#FFB2A8,#FFF380,#7E8D91,#FFD8B1,#FAF3E0"},this.radar={axisColor:((G=this.radar)==null?void 0:G.axisColor)||this.lineColor,axisStrokeWidth:((q=this.radar)==null?void 0:q.axisStrokeWidth)||2,axisLabelFontSize:((Q=this.radar)==null?void 0:Q.axisLabelFontSize)||12,curveOpacity:((te=this.radar)==null?void 0:te.curveOpacity)||.5,curveStrokeWidth:((he=this.radar)==null?void 0:he.curveStrokeWidth)||2,graticuleColor:((fe=this.radar)==null?void 0:fe.graticuleColor)||"#DEDEDE",graticuleStrokeWidth:((le=this.radar)==null?void 0:le.graticuleStrokeWidth)||1,graticuleOpacity:((Se=this.radar)==null?void 0:Se.graticuleOpacity)||.3,legendBoxSize:((ke=this.radar)==null?void 0:ke.legendBoxSize)||12,legendFontSize:((Ee=this.radar)==null?void 0:Ee.legendFontSize)||12},this.requirementBackground=this.requirementBackground||this.primaryColor,this.requirementBorderColor=this.requirementBorderColor||this.primaryBorderColor,this.requirementBorderSize=this.requirementBorderSize||"1",this.requirementTextColor=this.requirementTextColor||this.primaryTextColor,this.relationColor=this.relationColor||this.lineColor,this.relationLabelBackground=this.relationLabelBackground||this.edgeLabelBackground,this.relationLabelColor=this.relationLabelColor||this.actorTextColor,this.git0=Ho(this.pie1,25)||this.primaryColor,this.git1=this.pie2||this.secondaryColor,this.git2=this.pie3||this.tertiaryColor,this.git3=this.pie4||Lr(this.primaryColor,{h:-30}),this.git4=this.pie5||Lr(this.primaryColor,{h:-60}),this.git5=this.pie6||Lr(this.primaryColor,{h:-90}),this.git6=this.pie7||Lr(this.primaryColor,{h:60}),this.git7=this.pie8||Lr(this.primaryColor,{h:120}),this.gitInv0=this.gitInv0||xs(this.git0),this.gitInv1=this.gitInv1||xs(this.git1),this.gitInv2=this.gitInv2||xs(this.git2),this.gitInv3=this.gitInv3||xs(this.git3),this.gitInv4=this.gitInv4||xs(this.git4),this.gitInv5=this.gitInv5||xs(this.git5),this.gitInv6=this.gitInv6||xs(this.git6),this.gitInv7=this.gitInv7||xs(this.git7),this.branchLabelColor=this.branchLabelColor||this.labelTextColor,this.gitBranchLabel0=this.branchLabelColor,this.gitBranchLabel1="white",this.gitBranchLabel2=this.branchLabelColor,this.gitBranchLabel3="white",this.gitBranchLabel4=this.branchLabelColor,this.gitBranchLabel5=this.branchLabelColor,this.gitBranchLabel6=this.branchLabelColor,this.gitBranchLabel7=this.branchLabelColor,this.tagLabelColor=this.tagLabelColor||this.primaryTextColor,this.tagLabelBackground=this.tagLabelBackground||this.primaryColor,this.tagLabelBorder=this.tagBorder||this.primaryBorderColor,this.tagLabelFontSize=this.tagLabelFontSize||"10px",this.commitLabelColor=this.commitLabelColor||this.secondaryTextColor,this.commitLabelBackground=this.commitLabelBackground||this.secondaryColor,this.commitLabelFontSize=this.commitLabelFontSize||"10px",this.attributeBackgroundColorOdd=this.attributeBackgroundColorOdd||W2,this.attributeBackgroundColorEven=this.attributeBackgroundColorEven||j2}calculate(t){if(typeof t!="object"){this.updateColors();return}const n=Object.keys(t);n.forEach(s=>{this[s]=t[s]}),this.updateColors(),n.forEach(s=>{this[s]=t[s]})}},Ze(mT,"Theme"),mT),y9=Ze(e=>{const t=new g9;return t.calculate(e),t},"getThemeVariables"),ev={base:{getThemeVariables:c9},dark:{getThemeVariables:u9},default:{getThemeVariables:p9},forest:{getThemeVariables:m9},neutral:{getThemeVariables:y9}},r_={flowchart:{useMaxWidth:!0,titleTopMargin:25,subGraphTitleMargin:{top:0,bottom:0},diagramPadding:8,htmlLabels:!0,nodeSpacing:50,rankSpacing:50,curve:"basis",padding:15,defaultRenderer:"dagre-wrapper",wrappingWidth:200,inheritDir:!1},sequence:{useMaxWidth:!0,hideUnusedParticipants:!1,activationWidth:10,diagramMarginX:50,diagramMarginY:10,actorMargin:50,width:150,height:65,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,messageAlign:"center",mirrorActors:!0,forceMenus:!1,bottomMarginAdj:1,rightAngles:!1,showSequenceNumbers:!1,actorFontSize:14,actorFontFamily:'"Open Sans", sans-serif',actorFontWeight:400,noteFontSize:14,noteFontFamily:'"trebuchet ms", verdana, arial, sans-serif',noteFontWeight:400,noteAlign:"center",messageFontSize:16,messageFontFamily:'"trebuchet ms", verdana, arial, sans-serif',messageFontWeight:400,wrap:!1,wrapPadding:10,labelBoxWidth:50,labelBoxHeight:20},gantt:{useMaxWidth:!0,titleTopMargin:25,barHeight:20,barGap:4,topPadding:50,rightPadding:75,leftPadding:75,gridLineStartPadding:35,fontSize:11,sectionFontSize:11,numberSectionStyles:4,axisFormat:"%Y-%m-%d",topAxis:!1,displayMode:"",weekday:"sunday"},journey:{useMaxWidth:!0,diagramMarginX:50,diagramMarginY:10,leftMargin:150,maxLabelWidth:360,width:150,height:50,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,messageAlign:"center",bottomMarginAdj:1,rightAngles:!1,taskFontSize:14,taskFontFamily:'"Open Sans", sans-serif',taskMargin:50,activationWidth:10,textPlacement:"fo",actorColours:["#8FBC8F","#7CFC00","#00FFFF","#20B2AA","#B0E0E6","#FFFFE0"],sectionFills:["#191970","#8B008B","#4B0082","#2F4F4F","#800000","#8B4513","#00008B"],sectionColours:["#fff"],titleColor:"",titleFontFamily:'"trebuchet ms", verdana, arial, sans-serif',titleFontSize:"4ex"},class:{useMaxWidth:!0,titleTopMargin:25,arrowMarkerAbsolute:!1,dividerMargin:10,padding:5,textHeight:10,defaultRenderer:"dagre-wrapper",htmlLabels:!1,hideEmptyMembersBox:!1},state:{useMaxWidth:!0,titleTopMargin:25,dividerMargin:10,sizeUnit:5,padding:8,textHeight:10,titleShift:-15,noteMargin:10,forkWidth:70,forkHeight:7,miniPadding:2,fontSizeFactor:5.02,fontSize:24,labelHeight:16,edgeLengthFactor:"20",compositTitleSize:35,radius:5,defaultRenderer:"dagre-wrapper"},er:{useMaxWidth:!0,titleTopMargin:25,diagramPadding:20,layoutDirection:"TB",minEntityWidth:100,minEntityHeight:75,entityPadding:15,nodeSpacing:140,rankSpacing:80,stroke:"gray",fill:"honeydew",fontSize:12},pie:{useMaxWidth:!0,textPosition:.75},quadrantChart:{useMaxWidth:!0,chartWidth:500,chartHeight:500,titleFontSize:20,titlePadding:10,quadrantPadding:5,xAxisLabelPadding:5,yAxisLabelPadding:5,xAxisLabelFontSize:16,yAxisLabelFontSize:16,quadrantLabelFontSize:16,quadrantTextTopPadding:5,pointTextPadding:5,pointLabelFontSize:12,pointRadius:5,xAxisPosition:"top",yAxisPosition:"left",quadrantInternalBorderStrokeWidth:1,quadrantExternalBorderStrokeWidth:2},xyChart:{useMaxWidth:!0,width:700,height:500,titleFontSize:20,titlePadding:10,showDataLabel:!1,showTitle:!0,xAxis:{$ref:"#/$defs/XYChartAxisConfig",showLabel:!0,labelFontSize:14,labelPadding:5,showTitle:!0,titleFontSize:16,titlePadding:5,showTick:!0,tickLength:5,tickWidth:2,showAxisLine:!0,axisLineWidth:2},yAxis:{$ref:"#/$defs/XYChartAxisConfig",showLabel:!0,labelFontSize:14,labelPadding:5,showTitle:!0,titleFontSize:16,titlePadding:5,showTick:!0,tickLength:5,tickWidth:2,showAxisLine:!0,axisLineWidth:2},chartOrientation:"vertical",plotReservedSpacePercent:50},requirement:{useMaxWidth:!0,rect_fill:"#f9f9f9",text_color:"#333",rect_border_size:"0.5px",rect_border_color:"#bbb",rect_min_width:200,rect_min_height:200,fontSize:14,rect_padding:10,line_height:20},mindmap:{useMaxWidth:!0,padding:10,maxNodeWidth:200},kanban:{useMaxWidth:!0,padding:8,sectionWidth:200,ticketBaseUrl:""},timeline:{useMaxWidth:!0,diagramMarginX:50,diagramMarginY:10,leftMargin:150,width:150,height:50,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,messageAlign:"center",bottomMarginAdj:1,rightAngles:!1,taskFontSize:14,taskFontFamily:'"Open Sans", sans-serif',taskMargin:50,activationWidth:10,textPlacement:"fo",actorColours:["#8FBC8F","#7CFC00","#00FFFF","#20B2AA","#B0E0E6","#FFFFE0"],sectionFills:["#191970","#8B008B","#4B0082","#2F4F4F","#800000","#8B4513","#00008B"],sectionColours:["#fff"],disableMulticolor:!1},gitGraph:{useMaxWidth:!0,titleTopMargin:25,diagramPadding:8,nodeLabel:{width:75,height:100,x:-25,y:0},mainBranchName:"main",mainBranchOrder:0,showCommitLabel:!0,showBranches:!0,rotateCommitLabel:!0,parallelCommits:!1,arrowMarkerAbsolute:!1},c4:{useMaxWidth:!0,diagramMarginX:50,diagramMarginY:10,c4ShapeMargin:50,c4ShapePadding:20,width:216,height:60,boxMargin:10,c4ShapeInRow:4,nextLinePaddingX:0,c4BoundaryInRow:2,personFontSize:14,personFontFamily:'"Open Sans", sans-serif',personFontWeight:"normal",external_personFontSize:14,external_personFontFamily:'"Open Sans", sans-serif',external_personFontWeight:"normal",systemFontSize:14,systemFontFamily:'"Open Sans", sans-serif',systemFontWeight:"normal",external_systemFontSize:14,external_systemFontFamily:'"Open Sans", sans-serif',external_systemFontWeight:"normal",system_dbFontSize:14,system_dbFontFamily:'"Open Sans", sans-serif',system_dbFontWeight:"normal",external_system_dbFontSize:14,external_system_dbFontFamily:'"Open Sans", sans-serif',external_system_dbFontWeight:"normal",system_queueFontSize:14,system_queueFontFamily:'"Open Sans", sans-serif',system_queueFontWeight:"normal",external_system_queueFontSize:14,external_system_queueFontFamily:'"Open Sans", sans-serif',external_system_queueFontWeight:"normal",boundaryFontSize:14,boundaryFontFamily:'"Open Sans", sans-serif',boundaryFontWeight:"normal",messageFontSize:12,messageFontFamily:'"Open Sans", sans-serif',messageFontWeight:"normal",containerFontSize:14,containerFontFamily:'"Open Sans", sans-serif',containerFontWeight:"normal",external_containerFontSize:14,external_containerFontFamily:'"Open Sans", sans-serif',external_containerFontWeight:"normal",container_dbFontSize:14,container_dbFontFamily:'"Open Sans", sans-serif',container_dbFontWeight:"normal",external_container_dbFontSize:14,external_container_dbFontFamily:'"Open Sans", sans-serif',external_container_dbFontWeight:"normal",container_queueFontSize:14,container_queueFontFamily:'"Open Sans", sans-serif',container_queueFontWeight:"normal",external_container_queueFontSize:14,external_container_queueFontFamily:'"Open Sans", sans-serif',external_container_queueFontWeight:"normal",componentFontSize:14,componentFontFamily:'"Open Sans", sans-serif',componentFontWeight:"normal",external_componentFontSize:14,external_componentFontFamily:'"Open Sans", sans-serif',external_componentFontWeight:"normal",component_dbFontSize:14,component_dbFontFamily:'"Open Sans", sans-serif',component_dbFontWeight:"normal",external_component_dbFontSize:14,external_component_dbFontFamily:'"Open Sans", sans-serif',external_component_dbFontWeight:"normal",component_queueFontSize:14,component_queueFontFamily:'"Open Sans", sans-serif',component_queueFontWeight:"normal",external_component_queueFontSize:14,external_component_queueFontFamily:'"Open Sans", sans-serif',external_component_queueFontWeight:"normal",wrap:!0,wrapPadding:10,person_bg_color:"#08427B",person_border_color:"#073B6F",external_person_bg_color:"#686868",external_person_border_color:"#8A8A8A",system_bg_color:"#1168BD",system_border_color:"#3C7FC0",system_db_bg_color:"#1168BD",system_db_border_color:"#3C7FC0",system_queue_bg_color:"#1168BD",system_queue_border_color:"#3C7FC0",external_system_bg_color:"#999999",external_system_border_color:"#8A8A8A",external_system_db_bg_color:"#999999",external_system_db_border_color:"#8A8A8A",external_system_queue_bg_color:"#999999",external_system_queue_border_color:"#8A8A8A",container_bg_color:"#438DD5",container_border_color:"#3C7FC0",container_db_bg_color:"#438DD5",container_db_border_color:"#3C7FC0",container_queue_bg_color:"#438DD5",container_queue_border_color:"#3C7FC0",external_container_bg_color:"#B3B3B3",external_container_border_color:"#A6A6A6",external_container_db_bg_color:"#B3B3B3",external_container_db_border_color:"#A6A6A6",external_container_queue_bg_color:"#B3B3B3",external_container_queue_border_color:"#A6A6A6",component_bg_color:"#85BBF0",component_border_color:"#78A8D8",component_db_bg_color:"#85BBF0",component_db_border_color:"#78A8D8",component_queue_bg_color:"#85BBF0",component_queue_border_color:"#78A8D8",external_component_bg_color:"#CCCCCC",external_component_border_color:"#BFBFBF",external_component_db_bg_color:"#CCCCCC",external_component_db_border_color:"#BFBFBF",external_component_queue_bg_color:"#CCCCCC",external_component_queue_border_color:"#BFBFBF"},sankey:{useMaxWidth:!0,width:600,height:400,linkColor:"gradient",nodeAlignment:"justify",showValues:!0,prefix:"",suffix:""},block:{useMaxWidth:!0,padding:8},packet:{useMaxWidth:!0,rowHeight:32,bitWidth:32,bitsPerRow:32,showBits:!0,paddingX:5,paddingY:5},architecture:{useMaxWidth:!0,padding:40,iconSize:80,fontSize:16},radar:{useMaxWidth:!0,width:600,height:600,marginTop:50,marginRight:50,marginBottom:50,marginLeft:50,axisScaleFactor:1,axisLabelFactor:1.05,curveTension:.17},theme:"default",look:"classic",handDrawnSeed:0,layout:"dagre",maxTextSize:5e4,maxEdges:500,darkMode:!1,fontFamily:'"trebuchet ms", verdana, arial, sans-serif;',logLevel:5,securityLevel:"strict",startOnLoad:!0,arrowMarkerAbsolute:!1,secure:["secure","securityLevel","startOnLoad","maxTextSize","suppressErrorRendering","maxEdges"],legacyMathML:!1,forceLegacyMathML:!1,deterministicIds:!1,fontSize:16,markdownAutoWrap:!0,suppressErrorRendering:!1},sF={...r_,deterministicIDSeed:void 0,elk:{mergeEdges:!1,nodePlacementStrategy:"BRANDES_KOEPF"},themeCSS:void 0,themeVariables:ev.default.getThemeVariables(),sequence:{...r_.sequence,messageFont:Ze(function(){return{fontFamily:this.messageFontFamily,fontSize:this.messageFontSize,fontWeight:this.messageFontWeight}},"messageFont"),noteFont:Ze(function(){return{fontFamily:this.noteFontFamily,fontSize:this.noteFontSize,fontWeight:this.noteFontWeight}},"noteFont"),actorFont:Ze(function(){return{fontFamily:this.actorFontFamily,fontSize:this.actorFontSize,fontWeight:this.actorFontWeight}},"actorFont")},class:{hideEmptyMembersBox:!1},gantt:{...r_.gantt,tickInterval:void 0,useWidth:void 0},c4:{...r_.c4,useWidth:void 0,personFont:Ze(function(){return{fontFamily:this.personFontFamily,fontSize:this.personFontSize,fontWeight:this.personFontWeight}},"personFont"),flowchart:{...r_.flowchart,inheritDir:!1},external_personFont:Ze(function(){return{fontFamily:this.external_personFontFamily,fontSize:this.external_personFontSize,fontWeight:this.external_personFontWeight}},"external_personFont"),systemFont:Ze(function(){return{fontFamily:this.systemFontFamily,fontSize:this.systemFontSize,fontWeight:this.systemFontWeight}},"systemFont"),external_systemFont:Ze(function(){return{fontFamily:this.external_systemFontFamily,fontSize:this.external_systemFontSize,fontWeight:this.external_systemFontWeight}},"external_systemFont"),system_dbFont:Ze(function(){return{fontFamily:this.system_dbFontFamily,fontSize:this.system_dbFontSize,fontWeight:this.system_dbFontWeight}},"system_dbFont"),external_system_dbFont:Ze(function(){return{fontFamily:this.external_system_dbFontFamily,fontSize:this.external_system_dbFontSize,fontWeight:this.external_system_dbFontWeight}},"external_system_dbFont"),system_queueFont:Ze(function(){return{fontFamily:this.system_queueFontFamily,fontSize:this.system_queueFontSize,fontWeight:this.system_queueFontWeight}},"system_queueFont"),external_system_queueFont:Ze(function(){return{fontFamily:this.external_system_queueFontFamily,fontSize:this.external_system_queueFontSize,fontWeight:this.external_system_queueFontWeight}},"external_system_queueFont"),containerFont:Ze(function(){return{fontFamily:this.containerFontFamily,fontSize:this.containerFontSize,fontWeight:this.containerFontWeight}},"containerFont"),external_containerFont:Ze(function(){return{fontFamily:this.external_containerFontFamily,fontSize:this.external_containerFontSize,fontWeight:this.external_containerFontWeight}},"external_containerFont"),container_dbFont:Ze(function(){return{fontFamily:this.container_dbFontFamily,fontSize:this.container_dbFontSize,fontWeight:this.container_dbFontWeight}},"container_dbFont"),external_container_dbFont:Ze(function(){return{fontFamily:this.external_container_dbFontFamily,fontSize:this.external_container_dbFontSize,fontWeight:this.external_container_dbFontWeight}},"external_container_dbFont"),container_queueFont:Ze(function(){return{fontFamily:this.container_queueFontFamily,fontSize:this.container_queueFontSize,fontWeight:this.container_queueFontWeight}},"container_queueFont"),external_container_queueFont:Ze(function(){return{fontFamily:this.external_container_queueFontFamily,fontSize:this.external_container_queueFontSize,fontWeight:this.external_container_queueFontWeight}},"external_container_queueFont"),componentFont:Ze(function(){return{fontFamily:this.componentFontFamily,fontSize:this.componentFontSize,fontWeight:this.componentFontWeight}},"componentFont"),external_componentFont:Ze(function(){return{fontFamily:this.external_componentFontFamily,fontSize:this.external_componentFontSize,fontWeight:this.external_componentFontWeight}},"external_componentFont"),component_dbFont:Ze(function(){return{fontFamily:this.component_dbFontFamily,fontSize:this.component_dbFontSize,fontWeight:this.component_dbFontWeight}},"component_dbFont"),external_component_dbFont:Ze(function(){return{fontFamily:this.external_component_dbFontFamily,fontSize:this.external_component_dbFontSize,fontWeight:this.external_component_dbFontWeight}},"external_component_dbFont"),component_queueFont:Ze(function(){return{fontFamily:this.component_queueFontFamily,fontSize:this.component_queueFontSize,fontWeight:this.component_queueFontWeight}},"component_queueFont"),external_component_queueFont:Ze(function(){return{fontFamily:this.external_component_queueFontFamily,fontSize:this.external_component_queueFontSize,fontWeight:this.external_component_queueFontWeight}},"external_component_queueFont"),boundaryFont:Ze(function(){return{fontFamily:this.boundaryFontFamily,fontSize:this.boundaryFontSize,fontWeight:this.boundaryFontWeight}},"boundaryFont"),messageFont:Ze(function(){return{fontFamily:this.messageFontFamily,fontSize:this.messageFontSize,fontWeight:this.messageFontWeight}},"messageFont")},pie:{...r_.pie,useWidth:984},xyChart:{...r_.xyChart,useWidth:void 0},requirement:{...r_.requirement,useWidth:void 0},packet:{...r_.packet},radar:{...r_.radar},treemap:{useMaxWidth:!0,padding:10,diagramPadding:8,showValues:!0,nodeWidth:100,nodeHeight:40,borderWidth:1,valueFontSize:12,labelFontSize:14,valueFormat:","}},oF=Ze((e,t="")=>Object.keys(e).reduce((n,s)=>Array.isArray(e[s])?n:typeof e[s]=="object"&&e[s]!==null?[...n,t+s,...oF(e[s],"")]:[...n,t+s],[]),"keyify"),_9=new Set(oF(sF,"")),aF=sF,kE=Ze(e=>{if(On.debug("sanitizeDirective called with",e),!(typeof e!="object"||e==null)){if(Array.isArray(e)){e.forEach(t=>kE(t));return}for(const t of Object.keys(e)){if(On.debug("Checking key",t),t.startsWith("__")||t.includes("proto")||t.includes("constr")||!_9.has(t)||e[t]==null){On.debug("sanitize deleting key: ",t),delete e[t];continue}if(typeof e[t]=="object"){On.debug("sanitizing object",t),kE(e[t]);continue}const n=["themeCSS","fontFamily","altFontFamily"];for(const s of n)t.includes(s)&&(On.debug("sanitizing css option",t),e[t]=v9(e[t]))}if(e.themeVariables)for(const t of Object.keys(e.themeVariables)){const n=e.themeVariables[t];n!=null&&n.match&&!n.match(/^[\d "#%(),.;A-Za-z]+$/)&&(e.themeVariables[t]="")}On.debug("After sanitization",e)}},"sanitizeDirective"),v9=Ze(e=>{let t=0,n=0;for(const s of e){if(t<n)return"{ /* ERROR: Unbalanced CSS */ }";s==="{"?t++:s==="}"&&n++}return t!==n?"{ /* ERROR: Unbalanced CSS */ }":e},"sanitizeCss"),F1=Object.freeze(aF),sg=nf({},F1),lF,z1=[],IS=nf({},F1),H2=Ze((e,t)=>{let n=nf({},e),s={};for(const a of t)uF(a),s=nf(s,a);if(n=nf(n,s),s.theme&&s.theme in ev){const a=nf({},lF),d=nf(a.themeVariables||{},s.themeVariables);n.theme&&n.theme in ev&&(n.themeVariables=ev[n.theme].getThemeVariables(d))}return IS=n,dF(IS),IS},"updateCurrentConfig"),x9=Ze(e=>(sg=nf({},F1),sg=nf(sg,e),e.theme&&ev[e.theme]&&(sg.themeVariables=ev[e.theme].getThemeVariables(e.themeVariables)),H2(sg,z1),sg),"setSiteConfig"),b9=Ze(e=>{lF=nf({},e)},"saveConfigFromInitialize"),w9=Ze(e=>(sg=nf(sg,e),H2(sg,z1),sg),"updateSiteConfig"),cF=Ze(()=>nf({},sg),"getSiteConfig"),hF=Ze(e=>(dF(e),nf(IS,e),ug()),"setConfig"),ug=Ze(()=>nf({},IS),"getConfig"),uF=Ze(e=>{e&&(["secure",...sg.secure??[]].forEach(t=>{Object.hasOwn(e,t)&&(On.debug(`Denied attempt to modify a secure key ${t}`,e[t]),delete e[t])}),Object.keys(e).forEach(t=>{t.startsWith("__")&&delete e[t]}),Object.keys(e).forEach(t=>{typeof e[t]=="string"&&(e[t].includes("<")||e[t].includes(">")||e[t].includes("url(data:"))&&delete e[t],typeof e[t]=="object"&&uF(e[t])}))},"sanitize"),S9=Ze(e=>{var t;kE(e),e.fontFamily&&!((t=e.themeVariables)!=null&&t.fontFamily)&&(e.themeVariables={...e.themeVariables,fontFamily:e.fontFamily}),z1.push(e),H2(sg,z1)},"addDirective"),AE=Ze((e=sg)=>{z1=[],H2(e,z1)},"reset"),T9={LAZY_LOAD_DEPRECATED:"The configuration options lazyLoadedDiagrams and loadExternalDiagramsAtStartup are deprecated. Please use registerExternalDiagrams instead."},$O={},C9=Ze(e=>{$O[e]||(On.warn(T9[e]),$O[e]=!0)},"issueWarning"),dF=Ze(e=>{e&&(e.lazyLoadedDiagrams||e.loadExternalDiagramsAtStartup)&&C9("LAZY_LOAD_DEPRECATED")},"checkConfig"),TT=/<br\s*\/?>/gi,E9=Ze(e=>e?mF(e).replace(/\\n/g,"#br#").split("#br#"):[""],"getRows"),k9=(()=>{let e=!1;return()=>{e||(pF(),e=!0)}})();function pF(){const e="data-temp-href-target";N1.addHook("beforeSanitizeAttributes",t=>{t instanceof Element&&t.tagName==="A"&&t.hasAttribute("target")&&t.setAttribute(e,t.getAttribute("target")??"")}),N1.addHook("afterSanitizeAttributes",t=>{t instanceof Element&&t.tagName==="A"&&t.hasAttribute(e)&&(t.setAttribute("target",t.getAttribute(e)??""),t.removeAttribute(e),t.getAttribute("target")==="_blank"&&t.setAttribute("rel","noopener"))})}Ze(pF,"setupDompurifyHooks");var fF=Ze(e=>(k9(),N1.sanitize(e)),"removeScript"),VO=Ze((e,t)=>{var n;if(((n=t.flowchart)==null?void 0:n.htmlLabels)!==!1){const s=t.securityLevel;s==="antiscript"||s==="strict"?e=fF(e):s!=="loose"&&(e=mF(e),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/=/g,"&equals;"),e=L9(e))}return e},"sanitizeMore"),hb=Ze((e,t)=>e&&(t.dompurifyConfig?e=N1.sanitize(VO(e,t),t.dompurifyConfig).toString():e=N1.sanitize(VO(e,t),{FORBID_TAGS:["style"]}).toString(),e),"sanitizeText"),A9=Ze((e,t)=>typeof e=="string"?hb(e,t):e.flat().map(n=>hb(n,t)),"sanitizeTextOrArray"),M9=Ze(e=>TT.test(e),"hasBreaks"),I9=Ze(e=>e.split(TT),"splitBreaks"),L9=Ze(e=>e.replace(/#br#/g,"<br/>"),"placeholderToBreak"),mF=Ze(e=>e.replace(TT,"#br#"),"breakToPlaceholder"),gF=Ze(e=>{let t="";return e&&(t=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,t=CSS.escape(t)),t},"getUrl"),cp=Ze(e=>!(e===!1||["false","null","0"].includes(String(e).trim().toLowerCase())),"evaluate"),D9=Ze(function(...e){const t=e.filter(n=>!isNaN(n));return Math.max(...t)},"getMax"),P9=Ze(function(...e){const t=e.filter(n=>!isNaN(n));return Math.min(...t)},"getMin"),WO=Ze(function(e){const t=e.split(/(,)/),n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a===","&&s>0&&s+1<t.length){const d=t[s-1],f=t[s+1];O9(d,f)&&(a=d+","+f,s++,n.pop())}n.push(R9(a))}return n.join("")},"parseGenericTypes"),SM=Ze((e,t)=>Math.max(0,e.split(t).length-1),"countOccurrence"),O9=Ze((e,t)=>{const n=SM(e,"~"),s=SM(t,"~");return n===1&&s===1},"shouldCombineSets"),R9=Ze(e=>{const t=SM(e,"~");let n=!1;if(t<=1)return e;t%2!==0&&e.startsWith("~")&&(e=e.substring(1),n=!0);const s=[...e];let a=s.indexOf("~"),d=s.lastIndexOf("~");for(;a!==-1&&d!==-1&&a!==d;)s[a]="<",s[d]=">",a=s.indexOf("~"),d=s.lastIndexOf("~");return n&&s.unshift("~"),s.join("")},"processSet"),jO=Ze(()=>window.MathMLElement!==void 0,"isMathMLSupported"),TM=/\$\$(.*)\$\$/g,U1=Ze(e=>{var t;return(((t=e.match(TM))==null?void 0:t.length)??0)>0},"hasKatex"),Afe=Ze(async(e,t)=>{e=await vL(e,t);const n=document.createElement("div");n.innerHTML=e,n.id="katex-temp",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0";const s=document.querySelector("body");s==null||s.insertAdjacentElement("beforeend",n);const a={width:n.clientWidth,height:n.clientHeight};return n.remove(),a},"calculateMathMLDimensions"),vL=Ze(async(e,t)=>{if(!U1(e))return e;if(!(jO()||t.legacyMathML||t.forceLegacyMathML))return e.replace(TM,"MathML is unsupported in this environment.");{const{default:n}=await ah(()=>import("./katex-c7e083e0.js"),[]),s=t.forceLegacyMathML||!jO()&&t.legacyMathML?"htmlAndMathml":"mathml";return e.split(TT).map(a=>U1(a)?`<div style="display: flex; align-items: center; justify-content: center; white-space: nowrap;">${a}</div>`:`<div>${a}</div>`).join("").replace(TM,(a,d)=>n.renderToString(d,{throwOnError:!0,displayMode:!0,output:s}).replace(/\n/g," ").replace(/<annotation.*<\/annotation>/g,""))}},"renderKatex"),sw={getRows:E9,sanitizeText:hb,sanitizeTextOrArray:A9,hasBreaks:M9,splitBreaks:I9,lineBreakRegex:TT,removeScript:fF,getUrl:gF,evaluate:cp,getMax:D9,getMin:P9},N9=Ze(function(e,t){for(let n of t)e.attr(n[0],n[1])},"d3Attrs"),B9=Ze(function(e,t,n){let s=new Map;return n?(s.set("width","100%"),s.set("style",`max-width: ${t}px;`)):(s.set("height",e),s.set("width",t)),s},"calculateSvgSizeAttrs"),yF=Ze(function(e,t,n,s){const a=B9(t,n,s);N9(e,a)},"configureSvgSize"),F9=Ze(function(e,t,n,s){const a=t.node().getBBox(),d=a.width,f=a.height;On.info(`SVG bounds: ${d}x${f}`,a);let i=0,S=0;On.info(`Graph bounds: ${i}x${S}`,e),i=d+n*2,S=f+n*2,On.info(`Calculated bounds: ${i}x${S}`),yF(t,S,i,s);const E=`${a.x-n} ${a.y-n} ${a.width+2*n} ${a.height+2*n}`;t.attr("viewBox",E)},"setupGraphViewbox"),tE={},z9=Ze((e,t,n)=>{let s="";return e in tE&&tE[e]?s=tE[e](n):On.warn(`No theme found for ${e}`),` & {
    font-family: ${n.fontFamily};
    font-size: ${n.fontSize};
    fill: ${n.textColor}
  }
  @keyframes edge-animation-frame {
    from {
      stroke-dashoffset: 0;
    }
  }
  @keyframes dash {
    to {
      stroke-dashoffset: 0;
    }
  }
  & .edge-animation-slow {
    stroke-dasharray: 9,5 !important;
    stroke-dashoffset: 900;
    animation: dash 50s linear infinite;
    stroke-linecap: round;
  }
  & .edge-animation-fast {
    stroke-dasharray: 9,5 !important;
    stroke-dashoffset: 900;
    animation: dash 20s linear infinite;
    stroke-linecap: round;
  }
  /* Classes common for multiple diagrams */

  & .error-icon {
    fill: ${n.errorBkgColor};
  }
  & .error-text {
    fill: ${n.errorTextColor};
    stroke: ${n.errorTextColor};
  }

  & .edge-thickness-normal {
    stroke-width: 1px;
  }
  & .edge-thickness-thick {
    stroke-width: 3.5px
  }
  & .edge-pattern-solid {
    stroke-dasharray: 0;
  }
  & .edge-thickness-invisible {
    stroke-width: 0;
    fill: none;
  }
  & .edge-pattern-dashed{
    stroke-dasharray: 3;
  }
  .edge-pattern-dotted {
    stroke-dasharray: 2;
  }

  & .marker {
    fill: ${n.lineColor};
    stroke: ${n.lineColor};
  }
  & .marker.cross {
    stroke: ${n.lineColor};
  }

  & svg {
    font-family: ${n.fontFamily};
    font-size: ${n.fontSize};
  }
   & p {
    margin: 0
   }

  ${s}

  ${t}
`},"getStyles"),U9=Ze((e,t)=>{t!==void 0&&(tE[e]=t)},"addStylesForDiagram"),$9=z9,_F={};s9(_F,{clear:()=>V9,getAccDescription:()=>G9,getAccTitle:()=>j9,getDiagramTitle:()=>Y9,setAccDescription:()=>H9,setAccTitle:()=>W9,setDiagramTitle:()=>q9});var xL="",bL="",wL="",SL=Ze(e=>hb(e,ug()),"sanitizeText"),V9=Ze(()=>{xL="",wL="",bL=""},"clear"),W9=Ze(e=>{xL=SL(e).replace(/^\s+/g,"")},"setAccTitle"),j9=Ze(()=>xL,"getAccTitle"),H9=Ze(e=>{wL=SL(e).replace(/\n\s+/g,`
`)},"setAccDescription"),G9=Ze(()=>wL,"getAccDescription"),q9=Ze(e=>{bL=SL(e)},"setDiagramTitle"),Y9=Ze(()=>bL,"getDiagramTitle"),HO=On,X9=yL,Bc=ug,Mfe=hF,Ife=F1,G2=Ze(e=>hb(e,Bc()),"sanitizeText"),Z9=F9,K9=Ze(()=>_F,"getCommonDb"),ME={},IE=Ze((e,t,n)=>{var s;ME[e]&&HO.warn(`Diagram with id ${e} already registered. Overwriting.`),ME[e]=t,n&&nF(e,n),U9(e,t.styles),(s=t.injectUtils)==null||s.call(t,HO,X9,Bc,G2,Z9,K9(),()=>{})},"registerDiagram"),CM=Ze(e=>{if(e in ME)return ME[e];throw new Q9(e)},"getDiagram"),gT,Q9=(gT=class extends Error{constructor(t){super(`Diagram ${t} not found.`)}},Ze(gT,"DiagramNotFoundError"),gT);function TL(e){return typeof e>"u"||e===null}Ze(TL,"isNothing");function vF(e){return typeof e=="object"&&e!==null}Ze(vF,"isObject");function xF(e){return Array.isArray(e)?e:TL(e)?[]:[e]}Ze(xF,"toArray");function bF(e,t){var n,s,a,d;if(t)for(d=Object.keys(t),n=0,s=d.length;n<s;n+=1)a=d[n],e[a]=t[a];return e}Ze(bF,"extend");function wF(e,t){var n="",s;for(s=0;s<t;s+=1)n+=e;return n}Ze(wF,"repeat");function SF(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}Ze(SF,"isNegativeZero");var J9=TL,eq=vF,tq=xF,iq=wF,rq=SF,nq=bF,lp={isNothing:J9,isObject:eq,toArray:tq,repeat:iq,isNegativeZero:rq,extend:nq};function CL(e,t){var n="",s=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),s+" "+n):s}Ze(CL,"formatError");function $1(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=CL(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Ze($1,"YAMLException$1");$1.prototype=Object.create(Error.prototype);$1.prototype.constructor=$1;$1.prototype.toString=Ze(function(t){return this.name+": "+CL(this,t)},"toString");var lg=$1;function iE(e,t,n,s,a){var d="",f="",i=Math.floor(a/2)-1;return s-t>i&&(d=" ... ",t=s-i+d.length),n-s>i&&(f=" ...",n=s+i-f.length),{str:d+e.slice(t,n).replace(/\t/g,"")+f,pos:s-t+d.length}}Ze(iE,"getLine");function rE(e,t){return lp.repeat(" ",t-e.length)+e}Ze(rE,"padStart");function TF(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,s=[0],a=[],d,f=-1;d=n.exec(e.buffer);)a.push(d.index),s.push(d.index+d[0].length),e.position<=d.index&&f<0&&(f=s.length-2);f<0&&(f=s.length-1);var i="",S,E,L=Math.min(e.line+t.linesAfter,a.length).toString().length,F=t.maxLength-(t.indent+L+3);for(S=1;S<=t.linesBefore&&!(f-S<0);S++)E=iE(e.buffer,s[f-S],a[f-S],e.position-(s[f]-s[f-S]),F),i=lp.repeat(" ",t.indent)+rE((e.line-S+1).toString(),L)+" | "+E.str+`
`+i;for(E=iE(e.buffer,s[f],a[f],e.position,F),i+=lp.repeat(" ",t.indent)+rE((e.line+1).toString(),L)+" | "+E.str+`
`,i+=lp.repeat("-",t.indent+L+3+E.pos)+`^
`,S=1;S<=t.linesAfter&&!(f+S>=a.length);S++)E=iE(e.buffer,s[f+S],a[f+S],e.position-(s[f]-s[f+S]),F),i+=lp.repeat(" ",t.indent)+rE((e.line+S+1).toString(),L)+" | "+E.str+`
`;return i.replace(/\n$/,"")}Ze(TF,"makeSnippet");var sq=TF,oq=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],aq=["scalar","sequence","mapping"];function CF(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(s){t[String(s)]=n})}),t}Ze(CF,"compileStyleAliases");function EF(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(oq.indexOf(n)===-1)throw new lg('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=CF(t.styleAliases||null),aq.indexOf(this.kind)===-1)throw new lg('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}Ze(EF,"Type$1");var Ff=EF;function EM(e,t){var n=[];return e[t].forEach(function(s){var a=n.length;n.forEach(function(d,f){d.tag===s.tag&&d.kind===s.kind&&d.multi===s.multi&&(a=f)}),n[a]=s}),n}Ze(EM,"compileList");function kF(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function s(a){a.multi?(e.multi[a.kind].push(a),e.multi.fallback.push(a)):e[a.kind][a.tag]=e.fallback[a.tag]=a}for(Ze(s,"collectType"),t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(s);return e}Ze(kF,"compileMap");function LE(e){return this.extend(e)}Ze(LE,"Schema$1");LE.prototype.extend=Ze(function(t){var n=[],s=[];if(t instanceof Ff)s.push(t);else if(Array.isArray(t))s=s.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(s=s.concat(t.explicit));else throw new lg("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(d){if(!(d instanceof Ff))throw new lg("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(d.loadKind&&d.loadKind!=="scalar")throw new lg("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(d.multi)throw new lg("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),s.forEach(function(d){if(!(d instanceof Ff))throw new lg("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var a=Object.create(LE.prototype);return a.implicit=(this.implicit||[]).concat(n),a.explicit=(this.explicit||[]).concat(s),a.compiledImplicit=EM(a,"implicit"),a.compiledExplicit=EM(a,"explicit"),a.compiledTypeMap=kF(a.compiledImplicit,a.compiledExplicit),a},"extend");var lq=LE,cq=new Ff("tag:yaml.org,2002:str",{kind:"scalar",construct:Ze(function(e){return e!==null?e:""},"construct")}),hq=new Ff("tag:yaml.org,2002:seq",{kind:"sequence",construct:Ze(function(e){return e!==null?e:[]},"construct")}),uq=new Ff("tag:yaml.org,2002:map",{kind:"mapping",construct:Ze(function(e){return e!==null?e:{}},"construct")}),dq=new lq({explicit:[cq,hq,uq]});function AF(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}Ze(AF,"resolveYamlNull");function MF(){return null}Ze(MF,"constructYamlNull");function IF(e){return e===null}Ze(IF,"isNull");var pq=new Ff("tag:yaml.org,2002:null",{kind:"scalar",resolve:AF,construct:MF,predicate:IF,represent:{canonical:Ze(function(){return"~"},"canonical"),lowercase:Ze(function(){return"null"},"lowercase"),uppercase:Ze(function(){return"NULL"},"uppercase"),camelcase:Ze(function(){return"Null"},"camelcase"),empty:Ze(function(){return""},"empty")},defaultStyle:"lowercase"});function LF(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}Ze(LF,"resolveYamlBoolean");function DF(e){return e==="true"||e==="True"||e==="TRUE"}Ze(DF,"constructYamlBoolean");function PF(e){return Object.prototype.toString.call(e)==="[object Boolean]"}Ze(PF,"isBoolean");var fq=new Ff("tag:yaml.org,2002:bool",{kind:"scalar",resolve:LF,construct:DF,predicate:PF,represent:{lowercase:Ze(function(e){return e?"true":"false"},"lowercase"),uppercase:Ze(function(e){return e?"TRUE":"FALSE"},"uppercase"),camelcase:Ze(function(e){return e?"True":"False"},"camelcase")},defaultStyle:"lowercase"});function OF(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}Ze(OF,"isHexCode");function RF(e){return 48<=e&&e<=55}Ze(RF,"isOctCode");function NF(e){return 48<=e&&e<=57}Ze(NF,"isDecCode");function BF(e){if(e===null)return!1;var t=e.length,n=0,s=!1,a;if(!t)return!1;if(a=e[n],(a==="-"||a==="+")&&(a=e[++n]),a==="0"){if(n+1===t)return!0;if(a=e[++n],a==="b"){for(n++;n<t;n++)if(a=e[n],a!=="_"){if(a!=="0"&&a!=="1")return!1;s=!0}return s&&a!=="_"}if(a==="x"){for(n++;n<t;n++)if(a=e[n],a!=="_"){if(!OF(e.charCodeAt(n)))return!1;s=!0}return s&&a!=="_"}if(a==="o"){for(n++;n<t;n++)if(a=e[n],a!=="_"){if(!RF(e.charCodeAt(n)))return!1;s=!0}return s&&a!=="_"}}if(a==="_")return!1;for(;n<t;n++)if(a=e[n],a!=="_"){if(!NF(e.charCodeAt(n)))return!1;s=!0}return!(!s||a==="_")}Ze(BF,"resolveYamlInteger");function FF(e){var t=e,n=1,s;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),s=t[0],(s==="-"||s==="+")&&(s==="-"&&(n=-1),t=t.slice(1),s=t[0]),t==="0")return 0;if(s==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}Ze(FF,"constructYamlInteger");function zF(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!lp.isNegativeZero(e)}Ze(zF,"isInteger");var mq=new Ff("tag:yaml.org,2002:int",{kind:"scalar",resolve:BF,construct:FF,predicate:zF,represent:{binary:Ze(function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},"binary"),octal:Ze(function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},"octal"),decimal:Ze(function(e){return e.toString(10)},"decimal"),hexadecimal:Ze(function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)},"hexadecimal")},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),gq=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function UF(e){return!(e===null||!gq.test(e)||e[e.length-1]==="_")}Ze(UF,"resolveYamlFloat");function $F(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}Ze($F,"constructYamlFloat");var yq=/^[-+]?[0-9]+e/;function VF(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(lp.isNegativeZero(e))return"-0.0";return n=e.toString(10),yq.test(n)?n.replace("e",".e"):n}Ze(VF,"representYamlFloat");function WF(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||lp.isNegativeZero(e))}Ze(WF,"isFloat");var _q=new Ff("tag:yaml.org,2002:float",{kind:"scalar",resolve:UF,construct:$F,predicate:WF,represent:VF,defaultStyle:"lowercase"}),jF=dq.extend({implicit:[pq,fq,mq,_q]}),vq=jF,HF=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),GF=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function qF(e){return e===null?!1:HF.exec(e)!==null||GF.exec(e)!==null}Ze(qF,"resolveYamlTimestamp");function YF(e){var t,n,s,a,d,f,i,S=0,E=null,L,F,G;if(t=HF.exec(e),t===null&&(t=GF.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],s=+t[2]-1,a=+t[3],!t[4])return new Date(Date.UTC(n,s,a));if(d=+t[4],f=+t[5],i=+t[6],t[7]){for(S=t[7].slice(0,3);S.length<3;)S+="0";S=+S}return t[9]&&(L=+t[10],F=+(t[11]||0),E=(L*60+F)*6e4,t[9]==="-"&&(E=-E)),G=new Date(Date.UTC(n,s,a,d,f,i,S)),E&&G.setTime(G.getTime()-E),G}Ze(YF,"constructYamlTimestamp");function XF(e){return e.toISOString()}Ze(XF,"representYamlTimestamp");var xq=new Ff("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:qF,construct:YF,instanceOf:Date,represent:XF});function ZF(e){return e==="<<"||e===null}Ze(ZF,"resolveYamlMerge");var bq=new Ff("tag:yaml.org,2002:merge",{kind:"scalar",resolve:ZF}),EL=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function KF(e){if(e===null)return!1;var t,n,s=0,a=e.length,d=EL;for(n=0;n<a;n++)if(t=d.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;s+=6}return s%8===0}Ze(KF,"resolveYamlBinary");function QF(e){var t,n,s=e.replace(/[\r\n=]/g,""),a=s.length,d=EL,f=0,i=[];for(t=0;t<a;t++)t%4===0&&t&&(i.push(f>>16&255),i.push(f>>8&255),i.push(f&255)),f=f<<6|d.indexOf(s.charAt(t));return n=a%4*6,n===0?(i.push(f>>16&255),i.push(f>>8&255),i.push(f&255)):n===18?(i.push(f>>10&255),i.push(f>>2&255)):n===12&&i.push(f>>4&255),new Uint8Array(i)}Ze(QF,"constructYamlBinary");function JF(e){var t="",n=0,s,a,d=e.length,f=EL;for(s=0;s<d;s++)s%3===0&&s&&(t+=f[n>>18&63],t+=f[n>>12&63],t+=f[n>>6&63],t+=f[n&63]),n=(n<<8)+e[s];return a=d%3,a===0?(t+=f[n>>18&63],t+=f[n>>12&63],t+=f[n>>6&63],t+=f[n&63]):a===2?(t+=f[n>>10&63],t+=f[n>>4&63],t+=f[n<<2&63],t+=f[64]):a===1&&(t+=f[n>>2&63],t+=f[n<<4&63],t+=f[64],t+=f[64]),t}Ze(JF,"representYamlBinary");function ez(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}Ze(ez,"isBinary");var wq=new Ff("tag:yaml.org,2002:binary",{kind:"scalar",resolve:KF,construct:QF,predicate:ez,represent:JF}),Sq=Object.prototype.hasOwnProperty,Tq=Object.prototype.toString;function tz(e){if(e===null)return!0;var t=[],n,s,a,d,f,i=e;for(n=0,s=i.length;n<s;n+=1){if(a=i[n],f=!1,Tq.call(a)!=="[object Object]")return!1;for(d in a)if(Sq.call(a,d))if(!f)f=!0;else return!1;if(!f)return!1;if(t.indexOf(d)===-1)t.push(d);else return!1}return!0}Ze(tz,"resolveYamlOmap");function iz(e){return e!==null?e:[]}Ze(iz,"constructYamlOmap");var Cq=new Ff("tag:yaml.org,2002:omap",{kind:"sequence",resolve:tz,construct:iz}),Eq=Object.prototype.toString;function rz(e){if(e===null)return!0;var t,n,s,a,d,f=e;for(d=new Array(f.length),t=0,n=f.length;t<n;t+=1){if(s=f[t],Eq.call(s)!=="[object Object]"||(a=Object.keys(s),a.length!==1))return!1;d[t]=[a[0],s[a[0]]]}return!0}Ze(rz,"resolveYamlPairs");function nz(e){if(e===null)return[];var t,n,s,a,d,f=e;for(d=new Array(f.length),t=0,n=f.length;t<n;t+=1)s=f[t],a=Object.keys(s),d[t]=[a[0],s[a[0]]];return d}Ze(nz,"constructYamlPairs");var kq=new Ff("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:rz,construct:nz}),Aq=Object.prototype.hasOwnProperty;function sz(e){if(e===null)return!0;var t,n=e;for(t in n)if(Aq.call(n,t)&&n[t]!==null)return!1;return!0}Ze(sz,"resolveYamlSet");function oz(e){return e!==null?e:{}}Ze(oz,"constructYamlSet");var Mq=new Ff("tag:yaml.org,2002:set",{kind:"mapping",resolve:sz,construct:oz}),az=vq.extend({implicit:[xq,bq],explicit:[wq,Cq,kq,Mq]}),sx=Object.prototype.hasOwnProperty,DE=1,lz=2,cz=3,PE=4,SA=1,Iq=2,GO=3,Lq=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Dq=/[\x85\u2028\u2029]/,Pq=/[,\[\]\{\}]/,hz=/^(?:!|!!|![a-z\-]+!)$/i,uz=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function kM(e){return Object.prototype.toString.call(e)}Ze(kM,"_class");function b0(e){return e===10||e===13}Ze(b0,"is_EOL");function ix(e){return e===9||e===32}Ze(ix,"is_WHITE_SPACE");function xm(e){return e===9||e===32||e===10||e===13}Ze(xm,"is_WS_OR_EOL");function Qx(e){return e===44||e===91||e===93||e===123||e===125}Ze(Qx,"is_FLOW_INDICATOR");function dz(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}Ze(dz,"fromHexCode");function pz(e){return e===120?2:e===117?4:e===85?8:0}Ze(pz,"escapedHexLen");function fz(e){return 48<=e&&e<=57?e-48:-1}Ze(fz,"fromDecimalCode");function AM(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?"":e===76?"\u2028":e===80?"\u2029":""}Ze(AM,"simpleEscapeSequence");function mz(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}Ze(mz,"charFromCodepoint");var gz=new Array(256),yz=new Array(256);for(Wx=0;Wx<256;Wx++)gz[Wx]=AM(Wx)?1:0,yz[Wx]=AM(Wx);var Wx;function _z(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||az,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}Ze(_z,"State$1");function kL(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=sq(n),new lg(t,n)}Ze(kL,"generateError");function Do(e,t){throw kL(e,t)}Ze(Do,"throwError");function HS(e,t){e.onWarning&&e.onWarning.call(null,kL(e,t))}Ze(HS,"throwWarning");var qO={YAML:Ze(function(t,n,s){var a,d,f;t.version!==null&&Do(t,"duplication of %YAML directive"),s.length!==1&&Do(t,"YAML directive accepts exactly one argument"),a=/^([0-9]+)\.([0-9]+)$/.exec(s[0]),a===null&&Do(t,"ill-formed argument of the YAML directive"),d=parseInt(a[1],10),f=parseInt(a[2],10),d!==1&&Do(t,"unacceptable YAML version of the document"),t.version=s[0],t.checkLineBreaks=f<2,f!==1&&f!==2&&HS(t,"unsupported YAML version of the document")},"handleYamlDirective"),TAG:Ze(function(t,n,s){var a,d;s.length!==2&&Do(t,"TAG directive accepts exactly two arguments"),a=s[0],d=s[1],hz.test(a)||Do(t,"ill-formed tag handle (first argument) of the TAG directive"),sx.call(t.tagMap,a)&&Do(t,'there is a previously declared suffix for "'+a+'" tag handle'),uz.test(d)||Do(t,"ill-formed tag prefix (second argument) of the TAG directive");try{d=decodeURIComponent(d)}catch{Do(t,"tag prefix is malformed: "+d)}t.tagMap[a]=d},"handleTagDirective")};function tv(e,t,n,s){var a,d,f,i;if(t<n){if(i=e.input.slice(t,n),s)for(a=0,d=i.length;a<d;a+=1)f=i.charCodeAt(a),f===9||32<=f&&f<=1114111||Do(e,"expected valid JSON character");else Lq.test(i)&&Do(e,"the stream contains non-printable characters");e.result+=i}}Ze(tv,"captureSegment");function MM(e,t,n,s){var a,d,f,i;for(lp.isObject(n)||Do(e,"cannot merge mappings; the provided source object is unacceptable"),a=Object.keys(n),f=0,i=a.length;f<i;f+=1)d=a[f],sx.call(t,d)||(t[d]=n[d],s[d]=!0)}Ze(MM,"mergeMappings");function Jx(e,t,n,s,a,d,f,i,S){var E,L;if(Array.isArray(a))for(a=Array.prototype.slice.call(a),E=0,L=a.length;E<L;E+=1)Array.isArray(a[E])&&Do(e,"nested arrays are not supported inside keys"),typeof a=="object"&&kM(a[E])==="[object Object]"&&(a[E]="[object Object]");if(typeof a=="object"&&kM(a)==="[object Object]"&&(a="[object Object]"),a=String(a),t===null&&(t={}),s==="tag:yaml.org,2002:merge")if(Array.isArray(d))for(E=0,L=d.length;E<L;E+=1)MM(e,t,d[E],n);else MM(e,t,d,n);else!e.json&&!sx.call(n,a)&&sx.call(t,a)&&(e.line=f||e.line,e.lineStart=i||e.lineStart,e.position=S||e.position,Do(e,"duplicated mapping key")),a==="__proto__"?Object.defineProperty(t,a,{configurable:!0,enumerable:!0,writable:!0,value:d}):t[a]=d,delete n[a];return t}Ze(Jx,"storeMappingPair");function q2(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):Do(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}Ze(q2,"readLineBreak");function gd(e,t,n){for(var s=0,a=e.input.charCodeAt(e.position);a!==0;){for(;ix(a);)a===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),a=e.input.charCodeAt(++e.position);if(t&&a===35)do a=e.input.charCodeAt(++e.position);while(a!==10&&a!==13&&a!==0);if(b0(a))for(q2(e),a=e.input.charCodeAt(e.position),s++,e.lineIndent=0;a===32;)e.lineIndent++,a=e.input.charCodeAt(++e.position);else break}return n!==-1&&s!==0&&e.lineIndent<n&&HS(e,"deficient indentation"),s}Ze(gd,"skipSeparationSpace");function CT(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||xm(n)))}Ze(CT,"testDocumentSeparator");function Y2(e,t){t===1?e.result+=" ":t>1&&(e.result+=lp.repeat(`
`,t-1))}Ze(Y2,"writeFoldedLines");function vz(e,t,n){var s,a,d,f,i,S,E,L,F=e.kind,G=e.result,q;if(q=e.input.charCodeAt(e.position),xm(q)||Qx(q)||q===35||q===38||q===42||q===33||q===124||q===62||q===39||q===34||q===37||q===64||q===96||(q===63||q===45)&&(a=e.input.charCodeAt(e.position+1),xm(a)||n&&Qx(a)))return!1;for(e.kind="scalar",e.result="",d=f=e.position,i=!1;q!==0;){if(q===58){if(a=e.input.charCodeAt(e.position+1),xm(a)||n&&Qx(a))break}else if(q===35){if(s=e.input.charCodeAt(e.position-1),xm(s))break}else{if(e.position===e.lineStart&&CT(e)||n&&Qx(q))break;if(b0(q))if(S=e.line,E=e.lineStart,L=e.lineIndent,gd(e,!1,-1),e.lineIndent>=t){i=!0,q=e.input.charCodeAt(e.position);continue}else{e.position=f,e.line=S,e.lineStart=E,e.lineIndent=L;break}}i&&(tv(e,d,f,!1),Y2(e,e.line-S),d=f=e.position,i=!1),ix(q)||(f=e.position+1),q=e.input.charCodeAt(++e.position)}return tv(e,d,f,!1),e.result?!0:(e.kind=F,e.result=G,!1)}Ze(vz,"readPlainScalar");function xz(e,t){var n,s,a;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,s=a=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(tv(e,s,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)s=e.position,e.position++,a=e.position;else return!0;else b0(n)?(tv(e,s,a,!0),Y2(e,gd(e,!1,t)),s=a=e.position):e.position===e.lineStart&&CT(e)?Do(e,"unexpected end of the document within a single quoted scalar"):(e.position++,a=e.position);Do(e,"unexpected end of the stream within a single quoted scalar")}Ze(xz,"readSingleQuotedScalar");function bz(e,t){var n,s,a,d,f,i;if(i=e.input.charCodeAt(e.position),i!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=s=e.position;(i=e.input.charCodeAt(e.position))!==0;){if(i===34)return tv(e,n,e.position,!0),e.position++,!0;if(i===92){if(tv(e,n,e.position,!0),i=e.input.charCodeAt(++e.position),b0(i))gd(e,!1,t);else if(i<256&&gz[i])e.result+=yz[i],e.position++;else if((f=pz(i))>0){for(a=f,d=0;a>0;a--)i=e.input.charCodeAt(++e.position),(f=dz(i))>=0?d=(d<<4)+f:Do(e,"expected hexadecimal character");e.result+=mz(d),e.position++}else Do(e,"unknown escape sequence");n=s=e.position}else b0(i)?(tv(e,n,s,!0),Y2(e,gd(e,!1,t)),n=s=e.position):e.position===e.lineStart&&CT(e)?Do(e,"unexpected end of the document within a double quoted scalar"):(e.position++,s=e.position)}Do(e,"unexpected end of the stream within a double quoted scalar")}Ze(bz,"readDoubleQuotedScalar");function wz(e,t){var n=!0,s,a,d,f=e.tag,i,S=e.anchor,E,L,F,G,q,Q=Object.create(null),te,he,fe,le;if(le=e.input.charCodeAt(e.position),le===91)L=93,q=!1,i=[];else if(le===123)L=125,q=!0,i={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=i),le=e.input.charCodeAt(++e.position);le!==0;){if(gd(e,!0,t),le=e.input.charCodeAt(e.position),le===L)return e.position++,e.tag=f,e.anchor=S,e.kind=q?"mapping":"sequence",e.result=i,!0;n?le===44&&Do(e,"expected the node content, but found ','"):Do(e,"missed comma between flow collection entries"),he=te=fe=null,F=G=!1,le===63&&(E=e.input.charCodeAt(e.position+1),xm(E)&&(F=G=!0,e.position++,gd(e,!0,t))),s=e.line,a=e.lineStart,d=e.position,ub(e,t,DE,!1,!0),he=e.tag,te=e.result,gd(e,!0,t),le=e.input.charCodeAt(e.position),(G||e.line===s)&&le===58&&(F=!0,le=e.input.charCodeAt(++e.position),gd(e,!0,t),ub(e,t,DE,!1,!0),fe=e.result),q?Jx(e,i,Q,he,te,fe,s,a,d):F?i.push(Jx(e,null,Q,he,te,fe,s,a,d)):i.push(te),gd(e,!0,t),le=e.input.charCodeAt(e.position),le===44?(n=!0,le=e.input.charCodeAt(++e.position)):n=!1}Do(e,"unexpected end of the stream within a flow collection")}Ze(wz,"readFlowCollection");function Sz(e,t){var n,s,a=SA,d=!1,f=!1,i=t,S=0,E=!1,L,F;if(F=e.input.charCodeAt(e.position),F===124)s=!1;else if(F===62)s=!0;else return!1;for(e.kind="scalar",e.result="";F!==0;)if(F=e.input.charCodeAt(++e.position),F===43||F===45)SA===a?a=F===43?GO:Iq:Do(e,"repeat of a chomping mode identifier");else if((L=fz(F))>=0)L===0?Do(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):f?Do(e,"repeat of an indentation width identifier"):(i=t+L-1,f=!0);else break;if(ix(F)){do F=e.input.charCodeAt(++e.position);while(ix(F));if(F===35)do F=e.input.charCodeAt(++e.position);while(!b0(F)&&F!==0)}for(;F!==0;){for(q2(e),e.lineIndent=0,F=e.input.charCodeAt(e.position);(!f||e.lineIndent<i)&&F===32;)e.lineIndent++,F=e.input.charCodeAt(++e.position);if(!f&&e.lineIndent>i&&(i=e.lineIndent),b0(F)){S++;continue}if(e.lineIndent<i){a===GO?e.result+=lp.repeat(`
`,d?1+S:S):a===SA&&d&&(e.result+=`
`);break}for(s?ix(F)?(E=!0,e.result+=lp.repeat(`
`,d?1+S:S)):E?(E=!1,e.result+=lp.repeat(`
`,S+1)):S===0?d&&(e.result+=" "):e.result+=lp.repeat(`
`,S):e.result+=lp.repeat(`
`,d?1+S:S),d=!0,f=!0,S=0,n=e.position;!b0(F)&&F!==0;)F=e.input.charCodeAt(++e.position);tv(e,n,e.position,!1)}return!0}Ze(Sz,"readBlockScalar");function IM(e,t){var n,s=e.tag,a=e.anchor,d=[],f,i=!1,S;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),S=e.input.charCodeAt(e.position);S!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Do(e,"tab characters must not be used in indentation")),!(S!==45||(f=e.input.charCodeAt(e.position+1),!xm(f))));){if(i=!0,e.position++,gd(e,!0,-1)&&e.lineIndent<=t){d.push(null),S=e.input.charCodeAt(e.position);continue}if(n=e.line,ub(e,t,cz,!1,!0),d.push(e.result),gd(e,!0,-1),S=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&S!==0)Do(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return i?(e.tag=s,e.anchor=a,e.kind="sequence",e.result=d,!0):!1}Ze(IM,"readBlockSequence");function Tz(e,t,n){var s,a,d,f,i,S,E=e.tag,L=e.anchor,F={},G=Object.create(null),q=null,Q=null,te=null,he=!1,fe=!1,le;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=F),le=e.input.charCodeAt(e.position);le!==0;){if(!he&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Do(e,"tab characters must not be used in indentation")),s=e.input.charCodeAt(e.position+1),d=e.line,(le===63||le===58)&&xm(s))le===63?(he&&(Jx(e,F,G,q,Q,null,f,i,S),q=Q=te=null),fe=!0,he=!0,a=!0):he?(he=!1,a=!0):Do(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,le=s;else{if(f=e.line,i=e.lineStart,S=e.position,!ub(e,n,lz,!1,!0))break;if(e.line===d){for(le=e.input.charCodeAt(e.position);ix(le);)le=e.input.charCodeAt(++e.position);if(le===58)le=e.input.charCodeAt(++e.position),xm(le)||Do(e,"a whitespace character is expected after the key-value separator within a block mapping"),he&&(Jx(e,F,G,q,Q,null,f,i,S),q=Q=te=null),fe=!0,he=!1,a=!1,q=e.tag,Q=e.result;else if(fe)Do(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=E,e.anchor=L,!0}else if(fe)Do(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=E,e.anchor=L,!0}if((e.line===d||e.lineIndent>t)&&(he&&(f=e.line,i=e.lineStart,S=e.position),ub(e,t,PE,!0,a)&&(he?Q=e.result:te=e.result),he||(Jx(e,F,G,q,Q,te,f,i,S),q=Q=te=null),gd(e,!0,-1),le=e.input.charCodeAt(e.position)),(e.line===d||e.lineIndent>t)&&le!==0)Do(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return he&&Jx(e,F,G,q,Q,null,f,i,S),fe&&(e.tag=E,e.anchor=L,e.kind="mapping",e.result=F),fe}Ze(Tz,"readBlockMapping");function Cz(e){var t,n=!1,s=!1,a,d,f;if(f=e.input.charCodeAt(e.position),f!==33)return!1;if(e.tag!==null&&Do(e,"duplication of a tag property"),f=e.input.charCodeAt(++e.position),f===60?(n=!0,f=e.input.charCodeAt(++e.position)):f===33?(s=!0,a="!!",f=e.input.charCodeAt(++e.position)):a="!",t=e.position,n){do f=e.input.charCodeAt(++e.position);while(f!==0&&f!==62);e.position<e.length?(d=e.input.slice(t,e.position),f=e.input.charCodeAt(++e.position)):Do(e,"unexpected end of the stream within a verbatim tag")}else{for(;f!==0&&!xm(f);)f===33&&(s?Do(e,"tag suffix cannot contain exclamation marks"):(a=e.input.slice(t-1,e.position+1),hz.test(a)||Do(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),f=e.input.charCodeAt(++e.position);d=e.input.slice(t,e.position),Pq.test(d)&&Do(e,"tag suffix cannot contain flow indicator characters")}d&&!uz.test(d)&&Do(e,"tag name cannot contain such characters: "+d);try{d=decodeURIComponent(d)}catch{Do(e,"tag name is malformed: "+d)}return n?e.tag=d:sx.call(e.tagMap,a)?e.tag=e.tagMap[a]+d:a==="!"?e.tag="!"+d:a==="!!"?e.tag="tag:yaml.org,2002:"+d:Do(e,'undeclared tag handle "'+a+'"'),!0}Ze(Cz,"readTagProperty");function Ez(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&Do(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!xm(n)&&!Qx(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&Do(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}Ze(Ez,"readAnchorProperty");function kz(e){var t,n,s;if(s=e.input.charCodeAt(e.position),s!==42)return!1;for(s=e.input.charCodeAt(++e.position),t=e.position;s!==0&&!xm(s)&&!Qx(s);)s=e.input.charCodeAt(++e.position);return e.position===t&&Do(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),sx.call(e.anchorMap,n)||Do(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],gd(e,!0,-1),!0}Ze(kz,"readAlias");function ub(e,t,n,s,a){var d,f,i,S=1,E=!1,L=!1,F,G,q,Q,te,he;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,d=f=i=PE===n||cz===n,s&&gd(e,!0,-1)&&(E=!0,e.lineIndent>t?S=1:e.lineIndent===t?S=0:e.lineIndent<t&&(S=-1)),S===1)for(;Cz(e)||Ez(e);)gd(e,!0,-1)?(E=!0,i=d,e.lineIndent>t?S=1:e.lineIndent===t?S=0:e.lineIndent<t&&(S=-1)):i=!1;if(i&&(i=E||a),(S===1||PE===n)&&(DE===n||lz===n?te=t:te=t+1,he=e.position-e.lineStart,S===1?i&&(IM(e,he)||Tz(e,he,te))||wz(e,te)?L=!0:(f&&Sz(e,te)||xz(e,te)||bz(e,te)?L=!0:kz(e)?(L=!0,(e.tag!==null||e.anchor!==null)&&Do(e,"alias node should not have any properties")):vz(e,te,DE===n)&&(L=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):S===0&&(L=i&&IM(e,he))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&Do(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),F=0,G=e.implicitTypes.length;F<G;F+=1)if(Q=e.implicitTypes[F],Q.resolve(e.result)){e.result=Q.construct(e.result),e.tag=Q.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(sx.call(e.typeMap[e.kind||"fallback"],e.tag))Q=e.typeMap[e.kind||"fallback"][e.tag];else for(Q=null,q=e.typeMap.multi[e.kind||"fallback"],F=0,G=q.length;F<G;F+=1)if(e.tag.slice(0,q[F].tag.length)===q[F].tag){Q=q[F];break}Q||Do(e,"unknown tag !<"+e.tag+">"),e.result!==null&&Q.kind!==e.kind&&Do(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+Q.kind+'", not "'+e.kind+'"'),Q.resolve(e.result,e.tag)?(e.result=Q.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):Do(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||L}Ze(ub,"composeNode");function Az(e){var t=e.position,n,s,a,d=!1,f;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(f=e.input.charCodeAt(e.position))!==0&&(gd(e,!0,-1),f=e.input.charCodeAt(e.position),!(e.lineIndent>0||f!==37));){for(d=!0,f=e.input.charCodeAt(++e.position),n=e.position;f!==0&&!xm(f);)f=e.input.charCodeAt(++e.position);for(s=e.input.slice(n,e.position),a=[],s.length<1&&Do(e,"directive name must not be less than one character in length");f!==0;){for(;ix(f);)f=e.input.charCodeAt(++e.position);if(f===35){do f=e.input.charCodeAt(++e.position);while(f!==0&&!b0(f));break}if(b0(f))break;for(n=e.position;f!==0&&!xm(f);)f=e.input.charCodeAt(++e.position);a.push(e.input.slice(n,e.position))}f!==0&&q2(e),sx.call(qO,s)?qO[s](e,s,a):HS(e,'unknown document directive "'+s+'"')}if(gd(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,gd(e,!0,-1)):d&&Do(e,"directives end mark is expected"),ub(e,e.lineIndent-1,PE,!1,!0),gd(e,!0,-1),e.checkLineBreaks&&Dq.test(e.input.slice(t,e.position))&&HS(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&CT(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,gd(e,!0,-1));return}if(e.position<e.length-1)Do(e,"end of the stream or a document separator is expected");else return}Ze(Az,"readDocument");function AL(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new _z(e,t),s=e.indexOf("\0");for(s!==-1&&(n.position=s,Do(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Az(n);return n.documents}Ze(AL,"loadDocuments");function Mz(e,t,n){t!==null&&typeof t=="object"&&typeof n>"u"&&(n=t,t=null);var s=AL(e,n);if(typeof t!="function")return s;for(var a=0,d=s.length;a<d;a+=1)t(s[a])}Ze(Mz,"loadAll$1");function Iz(e,t){var n=AL(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new lg("expected a single document in the stream, but found more")}}Ze(Iz,"load$1");var Oq=Mz,Rq=Iz,Nq={loadAll:Oq,load:Rq},Lz=Object.prototype.toString,Dz=Object.prototype.hasOwnProperty,ML=65279,Bq=9,GS=10,Fq=13,zq=32,Uq=33,$q=34,LM=35,Vq=37,Wq=38,jq=39,Hq=42,Pz=44,Gq=45,OE=58,qq=61,Yq=62,Xq=63,Zq=64,Oz=91,Rz=93,Kq=96,Nz=123,Qq=124,Bz=125,$f={};$f[0]="\\0";$f[7]="\\a";$f[8]="\\b";$f[9]="\\t";$f[10]="\\n";$f[11]="\\v";$f[12]="\\f";$f[13]="\\r";$f[27]="\\e";$f[34]='\\"';$f[92]="\\\\";$f[133]="\\N";$f[160]="\\_";$f[8232]="\\L";$f[8233]="\\P";var Jq=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],eY=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Fz(e,t){var n,s,a,d,f,i,S;if(t===null)return{};for(n={},s=Object.keys(t),a=0,d=s.length;a<d;a+=1)f=s[a],i=String(t[f]),f.slice(0,2)==="!!"&&(f="tag:yaml.org,2002:"+f.slice(2)),S=e.compiledTypeMap.fallback[f],S&&Dz.call(S.styleAliases,i)&&(i=S.styleAliases[i]),n[f]=i;return n}Ze(Fz,"compileStyleMap");function zz(e){var t,n,s;if(t=e.toString(16).toUpperCase(),e<=255)n="x",s=2;else if(e<=65535)n="u",s=4;else if(e<=4294967295)n="U",s=8;else throw new lg("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+lp.repeat("0",s-t.length)+t}Ze(zz,"encodeHex");var tY=1,qS=2;function Uz(e){this.schema=e.schema||az,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=lp.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Fz(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?qS:tY,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}Ze(Uz,"State");function DM(e,t){for(var n=lp.repeat(" ",t),s=0,a=-1,d="",f,i=e.length;s<i;)a=e.indexOf(`
`,s),a===-1?(f=e.slice(s),s=i):(f=e.slice(s,a+1),s=a+1),f.length&&f!==`
`&&(d+=n),d+=f;return d}Ze(DM,"indentString");function RE(e,t){return`
`+lp.repeat(" ",e.indent*t)}Ze(RE,"generateNextLine");function $z(e,t){var n,s,a;for(n=0,s=e.implicitTypes.length;n<s;n+=1)if(a=e.implicitTypes[n],a.resolve(t))return!0;return!1}Ze($z,"testImplicitResolving");function YS(e){return e===zq||e===Bq}Ze(YS,"isWhitespace");function V1(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==ML||65536<=e&&e<=1114111}Ze(V1,"isPrintable");function PM(e){return V1(e)&&e!==ML&&e!==Fq&&e!==GS}Ze(PM,"isNsCharOrWhitespace");function OM(e,t,n){var s=PM(e),a=s&&!YS(e);return(n?s:s&&e!==Pz&&e!==Oz&&e!==Rz&&e!==Nz&&e!==Bz)&&e!==LM&&!(t===OE&&!a)||PM(t)&&!YS(t)&&e===LM||t===OE&&a}Ze(OM,"isPlainSafe");function Vz(e){return V1(e)&&e!==ML&&!YS(e)&&e!==Gq&&e!==Xq&&e!==OE&&e!==Pz&&e!==Oz&&e!==Rz&&e!==Nz&&e!==Bz&&e!==LM&&e!==Wq&&e!==Hq&&e!==Uq&&e!==Qq&&e!==qq&&e!==Yq&&e!==jq&&e!==$q&&e!==Vq&&e!==Zq&&e!==Kq}Ze(Vz,"isPlainSafeFirst");function Wz(e){return!YS(e)&&e!==OE}Ze(Wz,"isPlainSafeLast");function C1(e,t){var n=e.charCodeAt(t),s;return n>=55296&&n<=56319&&t+1<e.length&&(s=e.charCodeAt(t+1),s>=56320&&s<=57343)?(n-55296)*1024+s-56320+65536:n}Ze(C1,"codePointAt");function IL(e){var t=/^\n* /;return t.test(e)}Ze(IL,"needIndentIndicator");var jz=1,RM=2,Hz=3,Gz=4,x1=5;function qz(e,t,n,s,a,d,f,i){var S,E=0,L=null,F=!1,G=!1,q=s!==-1,Q=-1,te=Vz(C1(e,0))&&Wz(C1(e,e.length-1));if(t||f)for(S=0;S<e.length;E>=65536?S+=2:S++){if(E=C1(e,S),!V1(E))return x1;te=te&&OM(E,L,i),L=E}else{for(S=0;S<e.length;E>=65536?S+=2:S++){if(E=C1(e,S),E===GS)F=!0,q&&(G=G||S-Q-1>s&&e[Q+1]!==" ",Q=S);else if(!V1(E))return x1;te=te&&OM(E,L,i),L=E}G=G||q&&S-Q-1>s&&e[Q+1]!==" "}return!F&&!G?te&&!f&&!a(e)?jz:d===qS?x1:RM:n>9&&IL(e)?x1:f?d===qS?x1:RM:G?Gz:Hz}Ze(qz,"chooseScalarStyle");function Yz(e,t,n,s,a){e.dump=function(){if(t.length===0)return e.quotingType===qS?'""':"''";if(!e.noCompatMode&&(Jq.indexOf(t)!==-1||eY.test(t)))return e.quotingType===qS?'"'+t+'"':"'"+t+"'";var d=e.indent*Math.max(1,n),f=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-d),i=s||e.flowLevel>-1&&n>=e.flowLevel;function S(E){return $z(e,E)}switch(Ze(S,"testAmbiguity"),qz(t,i,e.indent,f,S,e.quotingType,e.forceQuotes&&!s,a)){case jz:return t;case RM:return"'"+t.replace(/'/g,"''")+"'";case Hz:return"|"+NM(t,e.indent)+BM(DM(t,d));case Gz:return">"+NM(t,e.indent)+BM(DM(Xz(t,f),d));case x1:return'"'+Zz(t)+'"';default:throw new lg("impossible error: invalid scalar style")}}()}Ze(Yz,"writeScalar");function NM(e,t){var n=IL(e)?String(t):"",s=e[e.length-1]===`
`,a=s&&(e[e.length-2]===`
`||e===`
`),d=a?"+":s?"":"-";return n+d+`
`}Ze(NM,"blockHeader");function BM(e){return e[e.length-1]===`
`?e.slice(0,-1):e}Ze(BM,"dropEndingNewline");function Xz(e,t){for(var n=/(\n+)([^\n]*)/g,s=function(){var E=e.indexOf(`
`);return E=E!==-1?E:e.length,n.lastIndex=E,FM(e.slice(0,E),t)}(),a=e[0]===`
`||e[0]===" ",d,f;f=n.exec(e);){var i=f[1],S=f[2];d=S[0]===" ",s+=i+(!a&&!d&&S!==""?`
`:"")+FM(S,t),a=d}return s}Ze(Xz,"foldString");function FM(e,t){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,s,a=0,d,f=0,i=0,S="";s=n.exec(e);)i=s.index,i-a>t&&(d=f>a?f:i,S+=`
`+e.slice(a,d),a=d+1),f=i;return S+=`
`,e.length-a>t&&f>a?S+=e.slice(a,f)+`
`+e.slice(f+1):S+=e.slice(a),S.slice(1)}Ze(FM,"foldLine");function Zz(e){for(var t="",n=0,s,a=0;a<e.length;n>=65536?a+=2:a++)n=C1(e,a),s=$f[n],!s&&V1(n)?(t+=e[a],n>=65536&&(t+=e[a+1])):t+=s||zz(n);return t}Ze(Zz,"escapeString");function Kz(e,t,n){var s="",a=e.tag,d,f,i;for(d=0,f=n.length;d<f;d+=1)i=n[d],e.replacer&&(i=e.replacer.call(n,String(d),i)),(v_(e,t,i,!1,!1)||typeof i>"u"&&v_(e,t,null,!1,!1))&&(s!==""&&(s+=","+(e.condenseFlow?"":" ")),s+=e.dump);e.tag=a,e.dump="["+s+"]"}Ze(Kz,"writeFlowSequence");function zM(e,t,n,s){var a="",d=e.tag,f,i,S;for(f=0,i=n.length;f<i;f+=1)S=n[f],e.replacer&&(S=e.replacer.call(n,String(f),S)),(v_(e,t+1,S,!0,!0,!1,!0)||typeof S>"u"&&v_(e,t+1,null,!0,!0,!1,!0))&&((!s||a!=="")&&(a+=RE(e,t)),e.dump&&GS===e.dump.charCodeAt(0)?a+="-":a+="- ",a+=e.dump);e.tag=d,e.dump=a||"[]"}Ze(zM,"writeBlockSequence");function Qz(e,t,n){var s="",a=e.tag,d=Object.keys(n),f,i,S,E,L;for(f=0,i=d.length;f<i;f+=1)L="",s!==""&&(L+=", "),e.condenseFlow&&(L+='"'),S=d[f],E=n[S],e.replacer&&(E=e.replacer.call(n,S,E)),v_(e,t,S,!1,!1)&&(e.dump.length>1024&&(L+="? "),L+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),v_(e,t,E,!1,!1)&&(L+=e.dump,s+=L));e.tag=a,e.dump="{"+s+"}"}Ze(Qz,"writeFlowMapping");function Jz(e,t,n,s){var a="",d=e.tag,f=Object.keys(n),i,S,E,L,F,G;if(e.sortKeys===!0)f.sort();else if(typeof e.sortKeys=="function")f.sort(e.sortKeys);else if(e.sortKeys)throw new lg("sortKeys must be a boolean or a function");for(i=0,S=f.length;i<S;i+=1)G="",(!s||a!=="")&&(G+=RE(e,t)),E=f[i],L=n[E],e.replacer&&(L=e.replacer.call(n,E,L)),v_(e,t+1,E,!0,!0,!0)&&(F=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,F&&(e.dump&&GS===e.dump.charCodeAt(0)?G+="?":G+="? "),G+=e.dump,F&&(G+=RE(e,t)),v_(e,t+1,L,!0,F)&&(e.dump&&GS===e.dump.charCodeAt(0)?G+=":":G+=": ",G+=e.dump,a+=G));e.tag=d,e.dump=a||"{}"}Ze(Jz,"writeBlockMapping");function UM(e,t,n){var s,a,d,f,i,S;for(a=n?e.explicitTypes:e.implicitTypes,d=0,f=a.length;d<f;d+=1)if(i=a[d],(i.instanceOf||i.predicate)&&(!i.instanceOf||typeof t=="object"&&t instanceof i.instanceOf)&&(!i.predicate||i.predicate(t))){if(n?i.multi&&i.representName?e.tag=i.representName(t):e.tag=i.tag:e.tag="?",i.represent){if(S=e.styleMap[i.tag]||i.defaultStyle,Lz.call(i.represent)==="[object Function]")s=i.represent(t,S);else if(Dz.call(i.represent,S))s=i.represent[S](t,S);else throw new lg("!<"+i.tag+'> tag resolver accepts not "'+S+'" style');e.dump=s}return!0}return!1}Ze(UM,"detectType");function v_(e,t,n,s,a,d,f){e.tag=null,e.dump=n,UM(e,n,!1)||UM(e,n,!0);var i=Lz.call(e.dump),S=s,E;s&&(s=e.flowLevel<0||e.flowLevel>t);var L=i==="[object Object]"||i==="[object Array]",F,G;if(L&&(F=e.duplicates.indexOf(n),G=F!==-1),(e.tag!==null&&e.tag!=="?"||G||e.indent!==2&&t>0)&&(a=!1),G&&e.usedDuplicates[F])e.dump="*ref_"+F;else{if(L&&G&&!e.usedDuplicates[F]&&(e.usedDuplicates[F]=!0),i==="[object Object]")s&&Object.keys(e.dump).length!==0?(Jz(e,t,e.dump,a),G&&(e.dump="&ref_"+F+e.dump)):(Qz(e,t,e.dump),G&&(e.dump="&ref_"+F+" "+e.dump));else if(i==="[object Array]")s&&e.dump.length!==0?(e.noArrayIndent&&!f&&t>0?zM(e,t-1,e.dump,a):zM(e,t,e.dump,a),G&&(e.dump="&ref_"+F+e.dump)):(Kz(e,t,e.dump),G&&(e.dump="&ref_"+F+" "+e.dump));else if(i==="[object String]")e.tag!=="?"&&Yz(e,e.dump,t,d,S);else{if(i==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new lg("unacceptable kind of an object to dump "+i)}e.tag!==null&&e.tag!=="?"&&(E=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?E="!"+E:E.slice(0,18)==="tag:yaml.org,2002:"?E="!!"+E.slice(18):E="!<"+E+">",e.dump=E+" "+e.dump)}return!0}Ze(v_,"writeNode");function e5(e,t){var n=[],s=[],a,d;for(NE(e,n,s),a=0,d=s.length;a<d;a+=1)t.duplicates.push(n[s[a]]);t.usedDuplicates=new Array(d)}Ze(e5,"getDuplicateReferences");function NE(e,t,n){var s,a,d;if(e!==null&&typeof e=="object")if(a=t.indexOf(e),a!==-1)n.indexOf(a)===-1&&n.push(a);else if(t.push(e),Array.isArray(e))for(a=0,d=e.length;a<d;a+=1)NE(e[a],t,n);else for(s=Object.keys(e),a=0,d=s.length;a<d;a+=1)NE(e[s[a]],t,n)}Ze(NE,"inspectNode");function iY(e,t){t=t||{};var n=new Uz(t);n.noRefs||e5(e,n);var s=e;return n.replacer&&(s=n.replacer.call({"":s},"",s)),v_(n,0,s,!0,!0)?n.dump+`
`:""}Ze(iY,"dump$1");function rY(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}Ze(rY,"renamed");var nY=jF,sY=Nq.load;/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/var My={aggregation:18,extension:18,composition:18,dependency:6,lollipop:13.5,arrow_point:4};function vS(e,t){if(e===void 0||t===void 0)return{angle:0,deltaX:0,deltaY:0};e=cu(e),t=cu(t);const[n,s]=[e.x,e.y],[a,d]=[t.x,t.y],f=a-n,i=d-s;return{angle:Math.atan(i/f),deltaX:f,deltaY:i}}Ze(vS,"calculateDeltaAndAngle");var cu=Ze(e=>Array.isArray(e)?{x:e[0],y:e[1]}:e,"pointTransformer"),oY=Ze(e=>({x:Ze(function(t,n,s){let a=0;const d=cu(s[0]).x<cu(s[s.length-1]).x?"left":"right";if(n===0&&Object.hasOwn(My,e.arrowTypeStart)){const{angle:q,deltaX:Q}=vS(s[0],s[1]);a=My[e.arrowTypeStart]*Math.cos(q)*(Q>=0?1:-1)}else if(n===s.length-1&&Object.hasOwn(My,e.arrowTypeEnd)){const{angle:q,deltaX:Q}=vS(s[s.length-1],s[s.length-2]);a=My[e.arrowTypeEnd]*Math.cos(q)*(Q>=0?1:-1)}const f=Math.abs(cu(t).x-cu(s[s.length-1]).x),i=Math.abs(cu(t).y-cu(s[s.length-1]).y),S=Math.abs(cu(t).x-cu(s[0]).x),E=Math.abs(cu(t).y-cu(s[0]).y),L=My[e.arrowTypeStart],F=My[e.arrowTypeEnd],G=1;if(f<F&&f>0&&i<F){let q=F+G-f;q*=d==="right"?-1:1,a-=q}if(S<L&&S>0&&E<L){let q=L+G-S;q*=d==="right"?-1:1,a+=q}return cu(t).x+a},"x"),y:Ze(function(t,n,s){let a=0;const d=cu(s[0]).y<cu(s[s.length-1]).y?"down":"up";if(n===0&&Object.hasOwn(My,e.arrowTypeStart)){const{angle:q,deltaY:Q}=vS(s[0],s[1]);a=My[e.arrowTypeStart]*Math.abs(Math.sin(q))*(Q>=0?1:-1)}else if(n===s.length-1&&Object.hasOwn(My,e.arrowTypeEnd)){const{angle:q,deltaY:Q}=vS(s[s.length-1],s[s.length-2]);a=My[e.arrowTypeEnd]*Math.abs(Math.sin(q))*(Q>=0?1:-1)}const f=Math.abs(cu(t).y-cu(s[s.length-1]).y),i=Math.abs(cu(t).x-cu(s[s.length-1]).x),S=Math.abs(cu(t).y-cu(s[0]).y),E=Math.abs(cu(t).x-cu(s[0]).x),L=My[e.arrowTypeStart],F=My[e.arrowTypeEnd],G=1;if(f<F&&f>0&&i<F){let q=F+G-f;q*=d==="up"?-1:1,a-=q}if(S<L&&S>0&&E<L){let q=L+G-S;q*=d==="up"?-1:1,a+=q}return cu(t).y+a},"y")}),"getLineFunctionsWithOffset"),LL=Ze(({flowchart:e})=>{var a,d;const t=((a=e==null?void 0:e.subGraphTitleMargin)==null?void 0:a.top)??0,n=((d=e==null?void 0:e.subGraphTitleMargin)==null?void 0:d.bottom)??0,s=t+n;return{subGraphTitleTopMargin:t,subGraphTitleBottomMargin:n,subGraphTitleTotalMargin:s}},"getSubGraphTitleMargins"),aY=Ze(e=>{const{handDrawnSeed:t}=Bc();return{fill:e,hachureAngle:120,hachureGap:4,fillWeight:2,roughness:.7,stroke:e,seed:t}},"solidStateFill"),ow=Ze(e=>{const t=lY([...e.cssCompiledStyles||[],...e.cssStyles||[]]);return{stylesMap:t,stylesArray:[...t]}},"compileStyles"),lY=Ze(e=>{const t=new Map;return e.forEach(n=>{const[s,a]=n.split(":");t.set(s.trim(),a==null?void 0:a.trim())}),t},"styles2Map"),t5=Ze(e=>e==="color"||e==="font-size"||e==="font-family"||e==="font-weight"||e==="font-style"||e==="text-decoration"||e==="text-align"||e==="text-transform"||e==="line-height"||e==="letter-spacing"||e==="word-spacing"||e==="text-shadow"||e==="text-overflow"||e==="white-space"||e==="word-wrap"||e==="word-break"||e==="overflow-wrap"||e==="hyphens","isLabelStyle"),ko=Ze(e=>{const{stylesArray:t}=ow(e),n=[],s=[],a=[],d=[];return t.forEach(f=>{const i=f[0];t5(i)?n.push(f.join(":")+" !important"):(s.push(f.join(":")+" !important"),i.includes("stroke")&&a.push(f.join(":")+" !important"),i==="fill"&&d.push(f.join(":")+" !important"))}),{labelStyles:n.join(";"),nodeStyles:s.join(";"),stylesArray:t,borderStyles:a,backgroundStyles:d}},"styles2String"),vo=Ze((e,t)=>{var S;const{themeVariables:n,handDrawnSeed:s}=Bc(),{nodeBorder:a,mainBkg:d}=n,{stylesMap:f}=ow(e);return Object.assign({roughness:.7,fill:f.get("fill")||d,fillStyle:"hachure",fillWeight:4,hachureGap:5.2,stroke:f.get("stroke")||a,seed:s,strokeWidth:((S=f.get("stroke-width"))==null?void 0:S.replace("px",""))||1.3,fillLineDash:[0,0]},t)},"userNodeOverrides"),DL={},Ep={};Object.defineProperty(Ep,"__esModule",{value:!0});Ep.BLANK_URL=Ep.relativeFirstCharacters=Ep.whitespaceEscapeCharsRegex=Ep.urlSchemeRegex=Ep.ctrlCharactersRegex=Ep.htmlCtrlEntityRegex=Ep.htmlEntitiesRegex=Ep.invalidProtocolRegex=void 0;Ep.invalidProtocolRegex=/^([^\w]*)(javascript|data|vbscript)/im;Ep.htmlEntitiesRegex=/&#(\w+)(^\w|;)?/g;Ep.htmlCtrlEntityRegex=/&(newline|tab);/gi;Ep.ctrlCharactersRegex=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim;Ep.urlSchemeRegex=/^.+(:|&colon;)/gim;Ep.whitespaceEscapeCharsRegex=/(\\|%5[cC])((%(6[eE]|72|74))|[nrt])/g;Ep.relativeFirstCharacters=[".","/"];Ep.BLANK_URL="about:blank";Object.defineProperty(DL,"__esModule",{value:!0});var i5=DL.sanitizeUrl=void 0,Of=Ep;function cY(e){return Of.relativeFirstCharacters.indexOf(e[0])>-1}function hY(e){var t=e.replace(Of.ctrlCharactersRegex,"");return t.replace(Of.htmlEntitiesRegex,function(n,s){return String.fromCharCode(s)})}function uY(e){return URL.canParse(e)}function YO(e){try{return decodeURIComponent(e)}catch{return e}}function dY(e){if(!e)return Of.BLANK_URL;var t,n=YO(e.trim());do n=hY(n).replace(Of.htmlCtrlEntityRegex,"").replace(Of.ctrlCharactersRegex,"").replace(Of.whitespaceEscapeCharsRegex,"").trim(),n=YO(n),t=n.match(Of.ctrlCharactersRegex)||n.match(Of.htmlEntitiesRegex)||n.match(Of.htmlCtrlEntityRegex)||n.match(Of.whitespaceEscapeCharsRegex);while(t&&t.length>0);var s=n;if(!s)return Of.BLANK_URL;if(cY(s))return s;var a=s.trimStart(),d=a.match(Of.urlSchemeRegex);if(!d)return s;var f=d[0].toLowerCase().trim();if(Of.invalidProtocolRegex.test(f))return Of.BLANK_URL;var i=a.replace(/\\/g,"/");if(f==="mailto:"||f.includes("://"))return i;if(f==="http:"||f==="https:"){if(!uY(i))return Of.BLANK_URL;var S=new URL(i);return S.protocol=S.protocol.toLowerCase(),S.hostname=S.hostname.toLowerCase(),S.toString()}return i}i5=DL.sanitizeUrl=dY;var pY={value:()=>{}};function r5(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new nE(n)}function nE(e){this._=e}function fY(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",a=n.indexOf(".");if(a>=0&&(s=n.slice(a+1),n=n.slice(0,a)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}nE.prototype=r5.prototype={constructor:nE,on:function(e,t){var n=this._,s=fY(e+"",n),a,d=-1,f=s.length;if(arguments.length<2){for(;++d<f;)if((a=(e=s[d]).type)&&(a=mY(n[a],e.name)))return a;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++d<f;)if(a=(e=s[d]).type)n[a]=XO(n[a],e.name,t);else if(t==null)for(a in n)n[a]=XO(n[a],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new nE(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var n=new Array(a),s=0,a,d;s<a;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(d=this._[e],s=0,a=d.length;s<a;++s)d[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],a=0,d=s.length;a<d;++a)s[a].value.apply(t,n)}};function mY(e,t){for(var n=0,s=e.length,a;n<s;++n)if((a=e[n]).name===t)return a.value}function XO(e,t,n){for(var s=0,a=e.length;s<a;++s)if(e[s].name===t){e[s]=pY,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var $M="http://www.w3.org/1999/xhtml";const ZO={svg:"http://www.w3.org/2000/svg",xhtml:$M,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function X2(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),ZO.hasOwnProperty(t)?{space:ZO[t],local:e}:e}function gY(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===$M&&t.documentElement.namespaceURI===$M?t.createElement(e):t.createElementNS(n,e)}}function yY(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function n5(e){var t=X2(e);return(t.local?yY:gY)(t)}function _Y(){}function PL(e){return e==null?_Y:function(){return this.querySelector(e)}}function vY(e){typeof e!="function"&&(e=PL(e));for(var t=this._groups,n=t.length,s=new Array(n),a=0;a<n;++a)for(var d=t[a],f=d.length,i=s[a]=new Array(f),S,E,L=0;L<f;++L)(S=d[L])&&(E=e.call(S,S.__data__,L,d))&&("__data__"in S&&(E.__data__=S.__data__),i[L]=E);return new Xg(s,this._parents)}function xY(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function bY(){return[]}function s5(e){return e==null?bY:function(){return this.querySelectorAll(e)}}function wY(e){return function(){return xY(e.apply(this,arguments))}}function SY(e){typeof e=="function"?e=wY(e):e=s5(e);for(var t=this._groups,n=t.length,s=[],a=[],d=0;d<n;++d)for(var f=t[d],i=f.length,S,E=0;E<i;++E)(S=f[E])&&(s.push(e.call(S,S.__data__,E,f)),a.push(S));return new Xg(s,a)}function o5(e){return function(){return this.matches(e)}}function a5(e){return function(t){return t.matches(e)}}var TY=Array.prototype.find;function CY(e){return function(){return TY.call(this.children,e)}}function EY(){return this.firstElementChild}function kY(e){return this.select(e==null?EY:CY(typeof e=="function"?e:a5(e)))}var AY=Array.prototype.filter;function MY(){return Array.from(this.children)}function IY(e){return function(){return AY.call(this.children,e)}}function LY(e){return this.selectAll(e==null?MY:IY(typeof e=="function"?e:a5(e)))}function DY(e){typeof e!="function"&&(e=o5(e));for(var t=this._groups,n=t.length,s=new Array(n),a=0;a<n;++a)for(var d=t[a],f=d.length,i=s[a]=[],S,E=0;E<f;++E)(S=d[E])&&e.call(S,S.__data__,E,d)&&i.push(S);return new Xg(s,this._parents)}function l5(e){return new Array(e.length)}function PY(){return new Xg(this._enter||this._groups.map(l5),this._parents)}function BE(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}BE.prototype={constructor:BE,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function OY(e){return function(){return e}}function RY(e,t,n,s,a,d){for(var f=0,i,S=t.length,E=d.length;f<E;++f)(i=t[f])?(i.__data__=d[f],s[f]=i):n[f]=new BE(e,d[f]);for(;f<S;++f)(i=t[f])&&(a[f]=i)}function NY(e,t,n,s,a,d,f){var i,S,E=new Map,L=t.length,F=d.length,G=new Array(L),q;for(i=0;i<L;++i)(S=t[i])&&(G[i]=q=f.call(S,S.__data__,i,t)+"",E.has(q)?a[i]=S:E.set(q,S));for(i=0;i<F;++i)q=f.call(e,d[i],i,d)+"",(S=E.get(q))?(s[i]=S,S.__data__=d[i],E.delete(q)):n[i]=new BE(e,d[i]);for(i=0;i<L;++i)(S=t[i])&&E.get(G[i])===S&&(a[i]=S)}function BY(e){return e.__data__}function FY(e,t){if(!arguments.length)return Array.from(this,BY);var n=t?NY:RY,s=this._parents,a=this._groups;typeof e!="function"&&(e=OY(e));for(var d=a.length,f=new Array(d),i=new Array(d),S=new Array(d),E=0;E<d;++E){var L=s[E],F=a[E],G=F.length,q=zY(e.call(L,L&&L.__data__,E,s)),Q=q.length,te=i[E]=new Array(Q),he=f[E]=new Array(Q),fe=S[E]=new Array(G);n(L,F,te,he,fe,q,t);for(var le=0,Se=0,ke,Ee;le<Q;++le)if(ke=te[le]){for(le>=Se&&(Se=le+1);!(Ee=he[Se])&&++Se<Q;);ke._next=Ee||null}}return f=new Xg(f,s),f._enter=i,f._exit=S,f}function zY(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function UY(){return new Xg(this._exit||this._groups.map(l5),this._parents)}function $Y(e,t,n){var s=this.enter(),a=this,d=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(a=t(a),a&&(a=a.selection())),n==null?d.remove():n(d),s&&a?s.merge(a).order():a}function VY(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,a=n.length,d=s.length,f=Math.min(a,d),i=new Array(a),S=0;S<f;++S)for(var E=n[S],L=s[S],F=E.length,G=i[S]=new Array(F),q,Q=0;Q<F;++Q)(q=E[Q]||L[Q])&&(G[Q]=q);for(;S<a;++S)i[S]=n[S];return new Xg(i,this._parents)}function WY(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],a=s.length-1,d=s[a],f;--a>=0;)(f=s[a])&&(d&&f.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(f,d),d=f);return this}function jY(e){e||(e=HY);function t(F,G){return F&&G?e(F.__data__,G.__data__):!F-!G}for(var n=this._groups,s=n.length,a=new Array(s),d=0;d<s;++d){for(var f=n[d],i=f.length,S=a[d]=new Array(i),E,L=0;L<i;++L)(E=f[L])&&(S[L]=E);S.sort(t)}return new Xg(a,this._parents).order()}function HY(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function GY(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function qY(){return Array.from(this)}function YY(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],a=0,d=s.length;a<d;++a){var f=s[a];if(f)return f}return null}function XY(){let e=0;for(const t of this)++e;return e}function ZY(){return!this.node()}function KY(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var a=t[n],d=0,f=a.length,i;d<f;++d)(i=a[d])&&e.call(i,i.__data__,d,a);return this}function QY(e){return function(){this.removeAttribute(e)}}function JY(e){return function(){this.removeAttributeNS(e.space,e.local)}}function e7(e,t){return function(){this.setAttribute(e,t)}}function t7(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function i7(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function r7(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function n7(e,t){var n=X2(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?JY:QY:typeof t=="function"?n.local?r7:i7:n.local?t7:e7)(n,t))}function c5(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function s7(e){return function(){this.style.removeProperty(e)}}function o7(e,t,n){return function(){this.style.setProperty(e,t,n)}}function a7(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function l7(e,t,n){return arguments.length>1?this.each((t==null?s7:typeof t=="function"?a7:o7)(e,t,n??"")):W1(this.node(),e)}function W1(e,t){return e.style.getPropertyValue(t)||c5(e).getComputedStyle(e,null).getPropertyValue(t)}function c7(e){return function(){delete this[e]}}function h7(e,t){return function(){this[e]=t}}function u7(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function d7(e,t){return arguments.length>1?this.each((t==null?c7:typeof t=="function"?u7:h7)(e,t)):this.node()[e]}function h5(e){return e.trim().split(/^|\s+/)}function OL(e){return e.classList||new u5(e)}function u5(e){this._node=e,this._names=h5(e.getAttribute("class")||"")}u5.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function d5(e,t){for(var n=OL(e),s=-1,a=t.length;++s<a;)n.add(t[s])}function p5(e,t){for(var n=OL(e),s=-1,a=t.length;++s<a;)n.remove(t[s])}function p7(e){return function(){d5(this,e)}}function f7(e){return function(){p5(this,e)}}function m7(e,t){return function(){(t.apply(this,arguments)?d5:p5)(this,e)}}function g7(e,t){var n=h5(e+"");if(arguments.length<2){for(var s=OL(this.node()),a=-1,d=n.length;++a<d;)if(!s.contains(n[a]))return!1;return!0}return this.each((typeof t=="function"?m7:t?p7:f7)(n,t))}function y7(){this.textContent=""}function _7(e){return function(){this.textContent=e}}function v7(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function x7(e){return arguments.length?this.each(e==null?y7:(typeof e=="function"?v7:_7)(e)):this.node().textContent}function b7(){this.innerHTML=""}function w7(e){return function(){this.innerHTML=e}}function S7(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function T7(e){return arguments.length?this.each(e==null?b7:(typeof e=="function"?S7:w7)(e)):this.node().innerHTML}function C7(){this.nextSibling&&this.parentNode.appendChild(this)}function E7(){return this.each(C7)}function k7(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function A7(){return this.each(k7)}function M7(e){var t=typeof e=="function"?e:n5(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function I7(){return null}function L7(e,t){var n=typeof e=="function"?e:n5(e),s=t==null?I7:typeof t=="function"?t:PL(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function D7(){var e=this.parentNode;e&&e.removeChild(this)}function P7(){return this.each(D7)}function O7(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function R7(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function N7(e){return this.select(e?R7:O7)}function B7(e){return arguments.length?this.property("__data__",e):this.node().__data__}function F7(e){return function(t){e.call(this,t,this.__data__)}}function z7(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function U7(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,a=t.length,d;n<a;++n)d=t[n],(!e.type||d.type===e.type)&&d.name===e.name?this.removeEventListener(d.type,d.listener,d.options):t[++s]=d;++s?t.length=s:delete this.__on}}}function $7(e,t,n){return function(){var s=this.__on,a,d=F7(t);if(s){for(var f=0,i=s.length;f<i;++f)if((a=s[f]).type===e.type&&a.name===e.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=d,a.options=n),a.value=t;return}}this.addEventListener(e.type,d,n),a={type:e.type,name:e.name,value:t,listener:d,options:n},s?s.push(a):this.__on=[a]}}function V7(e,t,n){var s=z7(e+""),a,d=s.length,f;if(arguments.length<2){var i=this.node().__on;if(i){for(var S=0,E=i.length,L;S<E;++S)for(a=0,L=i[S];a<d;++a)if((f=s[a]).type===L.type&&f.name===L.name)return L.value}return}for(i=t?$7:U7,a=0;a<d;++a)this.each(i(s[a],t,n));return this}function f5(e,t,n){var s=c5(e),a=s.CustomEvent;typeof a=="function"?a=new a(t,n):(a=s.document.createEvent("Event"),n?(a.initEvent(t,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function W7(e,t){return function(){return f5(this,e,t)}}function j7(e,t){return function(){return f5(this,e,t.apply(this,arguments))}}function H7(e,t){return this.each((typeof t=="function"?j7:W7)(e,t))}function*G7(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],a=0,d=s.length,f;a<d;++a)(f=s[a])&&(yield f)}var m5=[null];function Xg(e,t){this._groups=e,this._parents=t}function ET(){return new Xg([[document.documentElement]],m5)}function q7(){return this}Xg.prototype=ET.prototype={constructor:Xg,select:vY,selectAll:SY,selectChild:kY,selectChildren:LY,filter:DY,data:FY,enter:PY,exit:UY,join:$Y,merge:VY,selection:q7,order:WY,sort:jY,call:GY,nodes:qY,node:YY,size:XY,empty:ZY,each:KY,attr:n7,style:l7,property:d7,classed:g7,text:x7,html:T7,raise:E7,lower:A7,append:M7,insert:L7,remove:P7,clone:N7,datum:B7,on:V7,dispatch:H7,[Symbol.iterator]:G7};function mc(e){return typeof e=="string"?new Xg([[document.querySelector(e)]],[document.documentElement]):new Xg([[e]],m5)}function RL(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function g5(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function kT(){}var XS=.7,FE=1/XS,A1="\\s*([+-]?\\d+)\\s*",ZS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",d_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Y7=/^#([0-9a-f]{3,8})$/,X7=new RegExp(`^rgb\\(${A1},${A1},${A1}\\)$`),Z7=new RegExp(`^rgb\\(${d_},${d_},${d_}\\)$`),K7=new RegExp(`^rgba\\(${A1},${A1},${A1},${ZS}\\)$`),Q7=new RegExp(`^rgba\\(${d_},${d_},${d_},${ZS}\\)$`),J7=new RegExp(`^hsl\\(${ZS},${d_},${d_}\\)$`),eX=new RegExp(`^hsla\\(${ZS},${d_},${d_},${ZS}\\)$`),KO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};RL(kT,KS,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:QO,formatHex:QO,formatHex8:tX,formatHsl:iX,formatRgb:JO,toString:JO});function QO(){return this.rgb().formatHex()}function tX(){return this.rgb().formatHex8()}function iX(){return y5(this).formatHsl()}function JO(){return this.rgb().formatRgb()}function KS(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Y7.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?eR(t):n===3?new cg(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?AC(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?AC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=X7.exec(e))?new cg(t[1],t[2],t[3],1):(t=Z7.exec(e))?new cg(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=K7.exec(e))?AC(t[1],t[2],t[3],t[4]):(t=Q7.exec(e))?AC(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=J7.exec(e))?rR(t[1],t[2]/100,t[3]/100,1):(t=eX.exec(e))?rR(t[1],t[2]/100,t[3]/100,t[4]):KO.hasOwnProperty(e)?eR(KO[e]):e==="transparent"?new cg(NaN,NaN,NaN,0):null}function eR(e){return new cg(e>>16&255,e>>8&255,e&255,1)}function AC(e,t,n,s){return s<=0&&(e=t=n=NaN),new cg(e,t,n,s)}function rX(e){return e instanceof kT||(e=KS(e)),e?(e=e.rgb(),new cg(e.r,e.g,e.b,e.opacity)):new cg}function VM(e,t,n,s){return arguments.length===1?rX(e):new cg(e,t,n,s??1)}function cg(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}RL(cg,VM,g5(kT,{brighter(e){return e=e==null?FE:Math.pow(FE,e),new cg(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?XS:Math.pow(XS,e),new cg(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new cg(nb(this.r),nb(this.g),nb(this.b),zE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tR,formatHex:tR,formatHex8:nX,formatRgb:iR,toString:iR}));function tR(){return`#${eb(this.r)}${eb(this.g)}${eb(this.b)}`}function nX(){return`#${eb(this.r)}${eb(this.g)}${eb(this.b)}${eb((isNaN(this.opacity)?1:this.opacity)*255)}`}function iR(){const e=zE(this.opacity);return`${e===1?"rgb(":"rgba("}${nb(this.r)}, ${nb(this.g)}, ${nb(this.b)}${e===1?")":`, ${e})`}`}function zE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function nb(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function eb(e){return e=nb(e),(e<16?"0":"")+e.toString(16)}function rR(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new y0(e,t,n,s)}function y5(e){if(e instanceof y0)return new y0(e.h,e.s,e.l,e.opacity);if(e instanceof kT||(e=KS(e)),!e)return new y0;if(e instanceof y0)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,a=Math.min(t,n,s),d=Math.max(t,n,s),f=NaN,i=d-a,S=(d+a)/2;return i?(t===d?f=(n-s)/i+(n<s)*6:n===d?f=(s-t)/i+2:f=(t-n)/i+4,i/=S<.5?d+a:2-d-a,f*=60):i=S>0&&S<1?0:f,new y0(f,i,S,e.opacity)}function sX(e,t,n,s){return arguments.length===1?y5(e):new y0(e,t,n,s??1)}function y0(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}RL(y0,sX,g5(kT,{brighter(e){return e=e==null?FE:Math.pow(FE,e),new y0(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?XS:Math.pow(XS,e),new y0(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,a=2*n-s;return new cg(TA(e>=240?e-240:e+120,a,s),TA(e,a,s),TA(e<120?e+240:e-120,a,s),this.opacity)},clamp(){return new y0(nR(this.h),MC(this.s),MC(this.l),zE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=zE(this.opacity);return`${e===1?"hsl(":"hsla("}${nR(this.h)}, ${MC(this.s)*100}%, ${MC(this.l)*100}%${e===1?")":`, ${e})`}`}}));function nR(e){return e=(e||0)%360,e<0?e+360:e}function MC(e){return Math.max(0,Math.min(1,e||0))}function TA(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const NL=e=>()=>e;function _5(e,t){return function(n){return e+n*t}}function oX(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Lfe(e,t){var n=t-e;return n?_5(e,n>180||n<-180?n-360*Math.round(n/360):n):NL(isNaN(e)?t:e)}function aX(e){return(e=+e)==1?v5:function(t,n){return n-t?oX(t,n,e):NL(isNaN(t)?n:t)}}function v5(e,t){var n=t-e;return n?_5(e,n):NL(isNaN(e)?t:e)}const sR=function e(t){var n=aX(t);function s(a,d){var f=n((a=VM(a)).r,(d=VM(d)).r),i=n(a.g,d.g),S=n(a.b,d.b),E=v5(a.opacity,d.opacity);return function(L){return a.r=f(L),a.g=i(L),a.b=S(L),a.opacity=E(L),a+""}}return s.gamma=e,s}(1);function Zv(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var WM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,CA=new RegExp(WM.source,"g");function lX(e){return function(){return e}}function cX(e){return function(t){return e(t)+""}}function hX(e,t){var n=WM.lastIndex=CA.lastIndex=0,s,a,d,f=-1,i=[],S=[];for(e=e+"",t=t+"";(s=WM.exec(e))&&(a=CA.exec(t));)(d=a.index)>n&&(d=t.slice(n,d),i[f]?i[f]+=d:i[++f]=d),(s=s[0])===(a=a[0])?i[f]?i[f]+=a:i[++f]=a:(i[++f]=null,S.push({i:f,x:Zv(s,a)})),n=CA.lastIndex;return n<t.length&&(d=t.slice(n),i[f]?i[f]+=d:i[++f]=d),i.length<2?S[0]?cX(S[0].x):lX(t):(t=S.length,function(E){for(var L=0,F;L<t;++L)i[(F=S[L]).i]=F.x(E);return i.join("")})}var oR=180/Math.PI,jM={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function x5(e,t,n,s,a,d){var f,i,S;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(S=e*n+t*s)&&(n-=e*S,s-=t*S),(i=Math.sqrt(n*n+s*s))&&(n/=i,s/=i,S/=i),e*s<t*n&&(e=-e,t=-t,S=-S,f=-f),{translateX:a,translateY:d,rotate:Math.atan2(t,e)*oR,skewX:Math.atan(S)*oR,scaleX:f,scaleY:i}}var IC;function uX(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?jM:x5(t.a,t.b,t.c,t.d,t.e,t.f)}function dX(e){return e==null||(IC||(IC=document.createElementNS("http://www.w3.org/2000/svg","g")),IC.setAttribute("transform",e),!(e=IC.transform.baseVal.consolidate()))?jM:(e=e.matrix,x5(e.a,e.b,e.c,e.d,e.e,e.f))}function b5(e,t,n,s){function a(E){return E.length?E.pop()+" ":""}function d(E,L,F,G,q,Q){if(E!==F||L!==G){var te=q.push("translate(",null,t,null,n);Q.push({i:te-4,x:Zv(E,F)},{i:te-2,x:Zv(L,G)})}else(F||G)&&q.push("translate("+F+t+G+n)}function f(E,L,F,G){E!==L?(E-L>180?L+=360:L-E>180&&(E+=360),G.push({i:F.push(a(F)+"rotate(",null,s)-2,x:Zv(E,L)})):L&&F.push(a(F)+"rotate("+L+s)}function i(E,L,F,G){E!==L?G.push({i:F.push(a(F)+"skewX(",null,s)-2,x:Zv(E,L)}):L&&F.push(a(F)+"skewX("+L+s)}function S(E,L,F,G,q,Q){if(E!==F||L!==G){var te=q.push(a(q)+"scale(",null,",",null,")");Q.push({i:te-4,x:Zv(E,F)},{i:te-2,x:Zv(L,G)})}else(F!==1||G!==1)&&q.push(a(q)+"scale("+F+","+G+")")}return function(E,L){var F=[],G=[];return E=e(E),L=e(L),d(E.translateX,E.translateY,L.translateX,L.translateY,F,G),f(E.rotate,L.rotate,F,G),i(E.skewX,L.skewX,F,G),S(E.scaleX,E.scaleY,L.scaleX,L.scaleY,F,G),E=L=null,function(q){for(var Q=-1,te=G.length,he;++Q<te;)F[(he=G[Q]).i]=he.x(q);return F.join("")}}}var pX=b5(uX,"px, ","px)","deg)"),fX=b5(dX,", ",")",")"),j1=0,xS=0,oS=0,w5=1e3,UE,bS,$E=0,db=0,Z2=0,QS=typeof performance=="object"&&performance.now?performance:Date,S5=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function BL(){return db||(S5(mX),db=QS.now()+Z2)}function mX(){db=0}function VE(){this._call=this._time=this._next=null}VE.prototype=T5.prototype={constructor:VE,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?BL():+n)+(t==null?0:+t),!this._next&&bS!==this&&(bS?bS._next=this:UE=this,bS=this),this._call=e,this._time=n,HM()},stop:function(){this._call&&(this._call=null,this._time=1/0,HM())}};function T5(e,t,n){var s=new VE;return s.restart(e,t,n),s}function gX(){BL(),++j1;for(var e=UE,t;e;)(t=db-e._time)>=0&&e._call.call(void 0,t),e=e._next;--j1}function aR(){db=($E=QS.now())+Z2,j1=xS=0;try{gX()}finally{j1=0,_X(),db=0}}function yX(){var e=QS.now(),t=e-$E;t>w5&&(Z2-=t,$E=e)}function _X(){for(var e,t=UE,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:UE=n);bS=e,HM(s)}function HM(e){if(!j1){xS&&(xS=clearTimeout(xS));var t=e-db;t>24?(e<1/0&&(xS=setTimeout(aR,e-QS.now()-Z2)),oS&&(oS=clearInterval(oS))):(oS||($E=QS.now(),oS=setInterval(yX,w5)),j1=1,S5(aR))}}function lR(e,t,n){var s=new VE;return t=t==null?0:+t,s.restart(a=>{s.stop(),e(a+t)},t,n),s}var vX=r5("start","end","cancel","interrupt"),xX=[],C5=0,cR=1,GM=2,sE=3,hR=4,qM=5,oE=6;function K2(e,t,n,s,a,d){var f=e.__transition;if(!f)e.__transition={};else if(n in f)return;bX(e,n,{name:t,index:s,group:a,on:vX,tween:xX,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:C5})}function FL(e,t){var n=E0(e,t);if(n.state>C5)throw new Error("too late; already scheduled");return n}function S_(e,t){var n=E0(e,t);if(n.state>sE)throw new Error("too late; already running");return n}function E0(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function bX(e,t,n){var s=e.__transition,a;s[t]=n,n.timer=T5(d,0,n.time);function d(E){n.state=cR,n.timer.restart(f,n.delay,n.time),n.delay<=E&&f(E-n.delay)}function f(E){var L,F,G,q;if(n.state!==cR)return S();for(L in s)if(q=s[L],q.name===n.name){if(q.state===sE)return lR(f);q.state===hR?(q.state=oE,q.timer.stop(),q.on.call("interrupt",e,e.__data__,q.index,q.group),delete s[L]):+L<t&&(q.state=oE,q.timer.stop(),q.on.call("cancel",e,e.__data__,q.index,q.group),delete s[L])}if(lR(function(){n.state===sE&&(n.state=hR,n.timer.restart(i,n.delay,n.time),i(E))}),n.state=GM,n.on.call("start",e,e.__data__,n.index,n.group),n.state===GM){for(n.state=sE,a=new Array(G=n.tween.length),L=0,F=-1;L<G;++L)(q=n.tween[L].value.call(e,e.__data__,n.index,n.group))&&(a[++F]=q);a.length=F+1}}function i(E){for(var L=E<n.duration?n.ease.call(null,E/n.duration):(n.timer.restart(S),n.state=qM,1),F=-1,G=a.length;++F<G;)a[F].call(e,L);n.state===qM&&(n.on.call("end",e,e.__data__,n.index,n.group),S())}function S(){n.state=oE,n.timer.stop(),delete s[t];for(var E in s)return;delete e.__transition}}function wX(e,t){var n=e.__transition,s,a,d=!0,f;if(n){t=t==null?null:t+"";for(f in n){if((s=n[f]).name!==t){d=!1;continue}a=s.state>GM&&s.state<qM,s.state=oE,s.timer.stop(),s.on.call(a?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[f]}d&&delete e.__transition}}function SX(e){return this.each(function(){wX(this,e)})}function TX(e,t){var n,s;return function(){var a=S_(this,e),d=a.tween;if(d!==n){s=n=d;for(var f=0,i=s.length;f<i;++f)if(s[f].name===t){s=s.slice(),s.splice(f,1);break}}a.tween=s}}function CX(e,t,n){var s,a;if(typeof n!="function")throw new Error;return function(){var d=S_(this,e),f=d.tween;if(f!==s){a=(s=f).slice();for(var i={name:t,value:n},S=0,E=a.length;S<E;++S)if(a[S].name===t){a[S]=i;break}S===E&&a.push(i)}d.tween=a}}function EX(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=E0(this.node(),n).tween,a=0,d=s.length,f;a<d;++a)if((f=s[a]).name===e)return f.value;return null}return this.each((t==null?TX:CX)(n,e,t))}function zL(e,t,n){var s=e._id;return e.each(function(){var a=S_(this,s);(a.value||(a.value={}))[t]=n.apply(this,arguments)}),function(a){return E0(a,s).value[t]}}function E5(e,t){var n;return(typeof t=="number"?Zv:t instanceof KS?sR:(n=KS(t))?(t=n,sR):hX)(e,t)}function kX(e){return function(){this.removeAttribute(e)}}function AX(e){return function(){this.removeAttributeNS(e.space,e.local)}}function MX(e,t,n){var s,a=n+"",d;return function(){var f=this.getAttribute(e);return f===a?null:f===s?d:d=t(s=f,n)}}function IX(e,t,n){var s,a=n+"",d;return function(){var f=this.getAttributeNS(e.space,e.local);return f===a?null:f===s?d:d=t(s=f,n)}}function LX(e,t,n){var s,a,d;return function(){var f,i=n(this),S;return i==null?void this.removeAttribute(e):(f=this.getAttribute(e),S=i+"",f===S?null:f===s&&S===a?d:(a=S,d=t(s=f,i)))}}function DX(e,t,n){var s,a,d;return function(){var f,i=n(this),S;return i==null?void this.removeAttributeNS(e.space,e.local):(f=this.getAttributeNS(e.space,e.local),S=i+"",f===S?null:f===s&&S===a?d:(a=S,d=t(s=f,i)))}}function PX(e,t){var n=X2(e),s=n==="transform"?fX:E5;return this.attrTween(e,typeof t=="function"?(n.local?DX:LX)(n,s,zL(this,"attr."+e,t)):t==null?(n.local?AX:kX)(n):(n.local?IX:MX)(n,s,t))}function OX(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function RX(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function NX(e,t){var n,s;function a(){var d=t.apply(this,arguments);return d!==s&&(n=(s=d)&&RX(e,d)),n}return a._value=t,a}function BX(e,t){var n,s;function a(){var d=t.apply(this,arguments);return d!==s&&(n=(s=d)&&OX(e,d)),n}return a._value=t,a}function FX(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=X2(e);return this.tween(n,(s.local?NX:BX)(s,t))}function zX(e,t){return function(){FL(this,e).delay=+t.apply(this,arguments)}}function UX(e,t){return t=+t,function(){FL(this,e).delay=t}}function $X(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?zX:UX)(t,e)):E0(this.node(),t).delay}function VX(e,t){return function(){S_(this,e).duration=+t.apply(this,arguments)}}function WX(e,t){return t=+t,function(){S_(this,e).duration=t}}function jX(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?VX:WX)(t,e)):E0(this.node(),t).duration}function HX(e,t){if(typeof t!="function")throw new Error;return function(){S_(this,e).ease=t}}function GX(e){var t=this._id;return arguments.length?this.each(HX(t,e)):E0(this.node(),t).ease}function qX(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;S_(this,e).ease=n}}function YX(e){if(typeof e!="function")throw new Error;return this.each(qX(this._id,e))}function XX(e){typeof e!="function"&&(e=o5(e));for(var t=this._groups,n=t.length,s=new Array(n),a=0;a<n;++a)for(var d=t[a],f=d.length,i=s[a]=[],S,E=0;E<f;++E)(S=d[E])&&e.call(S,S.__data__,E,d)&&i.push(S);return new nv(s,this._parents,this._name,this._id)}function ZX(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,a=n.length,d=Math.min(s,a),f=new Array(s),i=0;i<d;++i)for(var S=t[i],E=n[i],L=S.length,F=f[i]=new Array(L),G,q=0;q<L;++q)(G=S[q]||E[q])&&(F[q]=G);for(;i<s;++i)f[i]=t[i];return new nv(f,this._parents,this._name,this._id)}function KX(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function QX(e,t,n){var s,a,d=KX(t)?FL:S_;return function(){var f=d(this,e),i=f.on;i!==s&&(a=(s=i).copy()).on(t,n),f.on=a}}function JX(e,t){var n=this._id;return arguments.length<2?E0(this.node(),n).on.on(e):this.each(QX(n,e,t))}function eZ(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function tZ(){return this.on("end.remove",eZ(this._id))}function iZ(e){var t=this._name,n=this._id;typeof e!="function"&&(e=PL(e));for(var s=this._groups,a=s.length,d=new Array(a),f=0;f<a;++f)for(var i=s[f],S=i.length,E=d[f]=new Array(S),L,F,G=0;G<S;++G)(L=i[G])&&(F=e.call(L,L.__data__,G,i))&&("__data__"in L&&(F.__data__=L.__data__),E[G]=F,K2(E[G],t,n,G,E,E0(L,n)));return new nv(d,this._parents,t,n)}function rZ(e){var t=this._name,n=this._id;typeof e!="function"&&(e=s5(e));for(var s=this._groups,a=s.length,d=[],f=[],i=0;i<a;++i)for(var S=s[i],E=S.length,L,F=0;F<E;++F)if(L=S[F]){for(var G=e.call(L,L.__data__,F,S),q,Q=E0(L,n),te=0,he=G.length;te<he;++te)(q=G[te])&&K2(q,t,n,te,G,Q);d.push(G),f.push(L)}return new nv(d,f,t,n)}var nZ=ET.prototype.constructor;function sZ(){return new nZ(this._groups,this._parents)}function oZ(e,t){var n,s,a;return function(){var d=W1(this,e),f=(this.style.removeProperty(e),W1(this,e));return d===f?null:d===n&&f===s?a:a=t(n=d,s=f)}}function k5(e){return function(){this.style.removeProperty(e)}}function aZ(e,t,n){var s,a=n+"",d;return function(){var f=W1(this,e);return f===a?null:f===s?d:d=t(s=f,n)}}function lZ(e,t,n){var s,a,d;return function(){var f=W1(this,e),i=n(this),S=i+"";return i==null&&(S=i=(this.style.removeProperty(e),W1(this,e))),f===S?null:f===s&&S===a?d:(a=S,d=t(s=f,i))}}function cZ(e,t){var n,s,a,d="style."+t,f="end."+d,i;return function(){var S=S_(this,e),E=S.on,L=S.value[d]==null?i||(i=k5(t)):void 0;(E!==n||a!==L)&&(s=(n=E).copy()).on(f,a=L),S.on=s}}function hZ(e,t,n){var s=(e+="")=="transform"?pX:E5;return t==null?this.styleTween(e,oZ(e,s)).on("end.style."+e,k5(e)):typeof t=="function"?this.styleTween(e,lZ(e,s,zL(this,"style."+e,t))).each(cZ(this._id,e)):this.styleTween(e,aZ(e,s,t),n).on("end.style."+e,null)}function uZ(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function dZ(e,t,n){var s,a;function d(){var f=t.apply(this,arguments);return f!==a&&(s=(a=f)&&uZ(e,f,n)),s}return d._value=t,d}function pZ(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,dZ(e,t,n??""))}function fZ(e){return function(){this.textContent=e}}function mZ(e){return function(){var t=e(this);this.textContent=t??""}}function gZ(e){return this.tween("text",typeof e=="function"?mZ(zL(this,"text",e)):fZ(e==null?"":e+""))}function yZ(e){return function(t){this.textContent=e.call(this,t)}}function _Z(e){var t,n;function s(){var a=e.apply(this,arguments);return a!==n&&(t=(n=a)&&yZ(a)),t}return s._value=e,s}function vZ(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,_Z(e))}function xZ(){for(var e=this._name,t=this._id,n=A5(),s=this._groups,a=s.length,d=0;d<a;++d)for(var f=s[d],i=f.length,S,E=0;E<i;++E)if(S=f[E]){var L=E0(S,t);K2(S,e,n,E,f,{time:L.time+L.delay+L.duration,delay:0,duration:L.duration,ease:L.ease})}return new nv(s,this._parents,e,n)}function bZ(){var e,t,n=this,s=n._id,a=n.size();return new Promise(function(d,f){var i={value:f},S={value:function(){--a===0&&d()}};n.each(function(){var E=S_(this,s),L=E.on;L!==e&&(t=(e=L).copy(),t._.cancel.push(i),t._.interrupt.push(i),t._.end.push(S)),E.on=t}),a===0&&d()})}var wZ=0;function nv(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function A5(){return++wZ}var q_=ET.prototype;nv.prototype={constructor:nv,select:iZ,selectAll:rZ,selectChild:q_.selectChild,selectChildren:q_.selectChildren,filter:XX,merge:ZX,selection:sZ,transition:xZ,call:q_.call,nodes:q_.nodes,node:q_.node,size:q_.size,empty:q_.empty,each:q_.each,on:JX,attr:PX,attrTween:FX,style:hZ,styleTween:pZ,text:gZ,textTween:vZ,remove:tZ,tween:EX,delay:$X,duration:jX,ease:GX,easeVarying:YX,end:bZ,[Symbol.iterator]:q_[Symbol.iterator]};function SZ(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var TZ={time:null,delay:0,duration:250,ease:SZ};function CZ(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function EZ(e){var t,n;e instanceof nv?(t=e._id,e=e._name):(t=A5(),(n=TZ).time=BL(),e=e==null?null:e+"");for(var s=this._groups,a=s.length,d=0;d<a;++d)for(var f=s[d],i=f.length,S,E=0;E<i;++E)(S=f[E])&&K2(S,e,t,E,f,n||CZ(S,t));return new nv(s,this._parents,e,t)}ET.prototype.interrupt=SX;ET.prototype.transition=EZ;const YM=Math.PI,XM=2*YM,qx=1e-6,kZ=XM-qx;function M5(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function AZ(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return M5;const n=10**t;return function(s){this._+=s[0];for(let a=1,d=s.length;a<d;++a)this._+=Math.round(arguments[a]*n)/n+s[a]}}class MZ{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?M5:AZ(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,s,a){this._append`Q${+t},${+n},${this._x1=+s},${this._y1=+a}`}bezierCurveTo(t,n,s,a,d,f){this._append`C${+t},${+n},${+s},${+a},${this._x1=+d},${this._y1=+f}`}arcTo(t,n,s,a,d){if(t=+t,n=+n,s=+s,a=+a,d=+d,d<0)throw new Error(`negative radius: ${d}`);let f=this._x1,i=this._y1,S=s-t,E=a-n,L=f-t,F=i-n,G=L*L+F*F;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(G>qx)if(!(Math.abs(F*S-E*L)>qx)||!d)this._append`L${this._x1=t},${this._y1=n}`;else{let q=s-f,Q=a-i,te=S*S+E*E,he=q*q+Q*Q,fe=Math.sqrt(te),le=Math.sqrt(G),Se=d*Math.tan((YM-Math.acos((te+G-he)/(2*fe*le)))/2),ke=Se/le,Ee=Se/fe;Math.abs(ke-1)>qx&&this._append`L${t+ke*L},${n+ke*F}`,this._append`A${d},${d},0,0,${+(F*q>L*Q)},${this._x1=t+Ee*S},${this._y1=n+Ee*E}`}}arc(t,n,s,a,d,f){if(t=+t,n=+n,s=+s,f=!!f,s<0)throw new Error(`negative radius: ${s}`);let i=s*Math.cos(a),S=s*Math.sin(a),E=t+i,L=n+S,F=1^f,G=f?a-d:d-a;this._x1===null?this._append`M${E},${L}`:(Math.abs(this._x1-E)>qx||Math.abs(this._y1-L)>qx)&&this._append`L${E},${L}`,s&&(G<0&&(G=G%XM+XM),G>kZ?this._append`A${s},${s},0,1,${F},${t-i},${n-S}A${s},${s},0,1,${F},${this._x1=E},${this._y1=L}`:G>qx&&this._append`A${s},${s},0,${+(G>=YM)},${F},${this._x1=t+s*Math.cos(d)},${this._y1=n+s*Math.sin(d)}`)}rect(t,n,s,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${s=+s}v${+a}h${-s}Z`}toString(){return this._}}function u1(e){return function(){return e}}const Dfe=Math.abs,Pfe=Math.atan2,Ofe=Math.cos,Rfe=Math.max,Nfe=Math.min,Bfe=Math.sin,Ffe=Math.sqrt,uR=1e-12,UL=Math.PI,dR=UL/2,zfe=2*UL;function Ufe(e){return e>1?0:e<-1?UL:Math.acos(e)}function $fe(e){return e>=1?dR:e<=-1?-dR:Math.asin(e)}function IZ(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const s=Math.floor(n);if(!(s>=0))throw new RangeError(`invalid digits: ${n}`);t=s}return e},()=>new MZ(t)}function LZ(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function I5(e){this._context=e}I5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function WE(e){return new I5(e)}function DZ(e){return e[0]}function PZ(e){return e[1]}function OZ(e,t){var n=u1(!0),s=null,a=WE,d=null,f=IZ(i);e=typeof e=="function"?e:e===void 0?DZ:u1(e),t=typeof t=="function"?t:t===void 0?PZ:u1(t);function i(S){var E,L=(S=LZ(S)).length,F,G=!1,q;for(s==null&&(d=a(q=f())),E=0;E<=L;++E)!(E<L&&n(F=S[E],E,S))===G&&((G=!G)?d.lineStart():d.lineEnd()),G&&d.point(+e(F,E,S),+t(F,E,S));if(q)return d=null,q+""||null}return i.x=function(S){return arguments.length?(e=typeof S=="function"?S:u1(+S),i):e},i.y=function(S){return arguments.length?(t=typeof S=="function"?S:u1(+S),i):t},i.defined=function(S){return arguments.length?(n=typeof S=="function"?S:u1(!!S),i):n},i.curve=function(S){return arguments.length?(a=S,s!=null&&(d=a(s)),i):a},i.context=function(S){return arguments.length?(S==null?s=d=null:d=a(s=S),i):s},i}class L5{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function D5(e){return new L5(e,!0)}function P5(e){return new L5(e,!1)}function ox(){}function jE(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Q2(e){this._context=e}Q2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:jE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:jE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function aE(e){return new Q2(e)}function O5(e){this._context=e}O5.prototype={areaStart:ox,areaEnd:ox,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:jE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function RZ(e){return new O5(e)}function R5(e){this._context=e}R5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,s):this._context.moveTo(n,s);break;case 3:this._point=4;default:jE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function NZ(e){return new R5(e)}function N5(e,t){this._basis=new Q2(e),this._beta=t}N5.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var s=e[0],a=t[0],d=e[n]-s,f=t[n]-a,i=-1,S;++i<=n;)S=i/n,this._basis.point(this._beta*e[i]+(1-this._beta)*(s+S*d),this._beta*t[i]+(1-this._beta)*(a+S*f));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const BZ=function e(t){function n(s){return t===1?new Q2(s):new N5(s,t)}return n.beta=function(s){return e(+s)},n}(.85);function HE(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function $L(e,t){this._context=e,this._k=(1-t)/6}$L.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:HE(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:HE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const B5=function e(t){function n(s){return new $L(s,t)}return n.tension=function(s){return e(+s)},n}(0);function VL(e,t){this._context=e,this._k=(1-t)/6}VL.prototype={areaStart:ox,areaEnd:ox,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:HE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const FZ=function e(t){function n(s){return new VL(s,t)}return n.tension=function(s){return e(+s)},n}(0);function WL(e,t){this._context=e,this._k=(1-t)/6}WL.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:HE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const zZ=function e(t){function n(s){return new WL(s,t)}return n.tension=function(s){return e(+s)},n}(0);function jL(e,t,n){var s=e._x1,a=e._y1,d=e._x2,f=e._y2;if(e._l01_a>uR){var i=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,S=3*e._l01_a*(e._l01_a+e._l12_a);s=(s*i-e._x0*e._l12_2a+e._x2*e._l01_2a)/S,a=(a*i-e._y0*e._l12_2a+e._y2*e._l01_2a)/S}if(e._l23_a>uR){var E=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,L=3*e._l23_a*(e._l23_a+e._l12_a);d=(d*E+e._x1*e._l23_2a-t*e._l12_2a)/L,f=(f*E+e._y1*e._l23_2a-n*e._l12_2a)/L}e._context.bezierCurveTo(s,a,d,f,e._x2,e._y2)}function F5(e,t){this._context=e,this._alpha=t}F5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:jL(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const z5=function e(t){function n(s){return t?new F5(s,t):new $L(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function U5(e,t){this._context=e,this._alpha=t}U5.prototype={areaStart:ox,areaEnd:ox,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:jL(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const UZ=function e(t){function n(s){return t?new U5(s,t):new VL(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function $5(e,t){this._context=e,this._alpha=t}$5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:jL(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const $Z=function e(t){function n(s){return t?new $5(s,t):new WL(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function V5(e){this._context=e}V5.prototype={areaStart:ox,areaEnd:ox,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function VZ(e){return new V5(e)}function pR(e){return e<0?-1:1}function fR(e,t,n){var s=e._x1-e._x0,a=t-e._x1,d=(e._y1-e._y0)/(s||a<0&&-0),f=(n-e._y1)/(a||s<0&&-0),i=(d*a+f*s)/(s+a);return(pR(d)+pR(f))*Math.min(Math.abs(d),Math.abs(f),.5*Math.abs(i))||0}function mR(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function EA(e,t,n){var s=e._x0,a=e._y0,d=e._x1,f=e._y1,i=(d-s)/3;e._context.bezierCurveTo(s+i,a+i*t,d-i,f-i*n,d,f)}function GE(e){this._context=e}GE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:EA(this,this._t0,mR(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,EA(this,mR(this,n=fR(this,e,t)),n);break;default:EA(this,this._t0,n=fR(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function W5(e){this._context=new j5(e)}(W5.prototype=Object.create(GE.prototype)).point=function(e,t){GE.prototype.point.call(this,t,e)};function j5(e){this._context=e}j5.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,s,a,d){this._context.bezierCurveTo(t,e,s,n,d,a)}};function H5(e){return new GE(e)}function G5(e){return new W5(e)}function q5(e){this._context=e}q5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var s=gR(e),a=gR(t),d=0,f=1;f<n;++d,++f)this._context.bezierCurveTo(s[0][d],a[0][d],s[1][d],a[1][d],e[f],t[f]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function gR(e){var t,n=e.length-1,s,a=new Array(n),d=new Array(n),f=new Array(n);for(a[0]=0,d[0]=2,f[0]=e[0]+2*e[1],t=1;t<n-1;++t)a[t]=1,d[t]=4,f[t]=4*e[t]+2*e[t+1];for(a[n-1]=2,d[n-1]=7,f[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)s=a[t]/d[t-1],d[t]-=s,f[t]-=s*f[t-1];for(a[n-1]=f[n-1]/d[n-1],t=n-2;t>=0;--t)a[t]=(f[t]-a[t+1])/d[t];for(d[n-1]=(e[n]+a[n-1])/2,t=0;t<n-1;++t)d[t]=2*e[t+1]-a[t+1];return[a,d]}function Y5(e){return new q5(e)}function J2(e,t){this._context=e,this._t=t}J2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function X5(e){return new J2(e,.5)}function Z5(e){return new J2(e,0)}function K5(e){return new J2(e,1)}function wS(e,t,n){this.k=e,this.x=t,this.y=n}wS.prototype={constructor:wS,scale:function(e){return e===1?this:new wS(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new wS(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};wS.prototype;var WZ=typeof global=="object"&&global&&global.Object===Object&&global;const Q5=WZ;var jZ=typeof self=="object"&&self&&self.Object===Object&&self,HZ=Q5||jZ||Function("return this")();const T_=HZ;var GZ=T_.Symbol;const qE=GZ;var J5=Object.prototype,qZ=J5.hasOwnProperty,YZ=J5.toString,aS=qE?qE.toStringTag:void 0;function XZ(e){var t=qZ.call(e,aS),n=e[aS];try{e[aS]=void 0;var s=!0}catch{}var a=YZ.call(e);return s&&(t?e[aS]=n:delete e[aS]),a}var ZZ=Object.prototype,KZ=ZZ.toString;function QZ(e){return KZ.call(e)}var JZ="[object Null]",eK="[object Undefined]",yR=qE?qE.toStringTag:void 0;function aw(e){return e==null?e===void 0?eK:JZ:yR&&yR in Object(e)?XZ(e):QZ(e)}function _b(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var tK="[object AsyncFunction]",iK="[object Function]",rK="[object GeneratorFunction]",nK="[object Proxy]";function HL(e){if(!_b(e))return!1;var t=aw(e);return t==iK||t==rK||t==tK||t==nK}var sK=T_["__core-js_shared__"];const kA=sK;var _R=function(){var e=/[^.]+$/.exec(kA&&kA.keys&&kA.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function oK(e){return!!_R&&_R in e}var aK=Function.prototype,lK=aK.toString;function vb(e){if(e!=null){try{return lK.call(e)}catch{}try{return e+""}catch{}}return""}var cK=/[\\^$.*+?()[\]{}|]/g,hK=/^\[object .+?Constructor\]$/,uK=Function.prototype,dK=Object.prototype,pK=uK.toString,fK=dK.hasOwnProperty,mK=RegExp("^"+pK.call(fK).replace(cK,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function gK(e){if(!_b(e)||oK(e))return!1;var t=HL(e)?mK:hK;return t.test(vb(e))}function yK(e,t){return e==null?void 0:e[t]}function xb(e,t){var n=yK(e,t);return gK(n)?n:void 0}var _K=xb(Object,"create");const JS=_K;function vK(){this.__data__=JS?JS(null):{},this.size=0}function xK(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var bK="__lodash_hash_undefined__",wK=Object.prototype,SK=wK.hasOwnProperty;function TK(e){var t=this.__data__;if(JS){var n=t[e];return n===bK?void 0:n}return SK.call(t,e)?t[e]:void 0}var CK=Object.prototype,EK=CK.hasOwnProperty;function kK(e){var t=this.__data__;return JS?t[e]!==void 0:EK.call(t,e)}var AK="__lodash_hash_undefined__";function MK(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=JS&&t===void 0?AK:t,this}function pb(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}pb.prototype.clear=vK;pb.prototype.delete=xK;pb.prototype.get=TK;pb.prototype.has=kK;pb.prototype.set=MK;function IK(){this.__data__=[],this.size=0}function ek(e,t){return e===t||e!==e&&t!==t}function tk(e,t){for(var n=e.length;n--;)if(ek(e[n][0],t))return n;return-1}var LK=Array.prototype,DK=LK.splice;function PK(e){var t=this.__data__,n=tk(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():DK.call(t,n,1),--this.size,!0}function OK(e){var t=this.__data__,n=tk(t,e);return n<0?void 0:t[n][1]}function RK(e){return tk(this.__data__,e)>-1}function NK(e,t){var n=this.__data__,s=tk(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}function av(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}av.prototype.clear=IK;av.prototype.delete=PK;av.prototype.get=OK;av.prototype.has=RK;av.prototype.set=NK;var BK=xb(T_,"Map");const eT=BK;function FK(){this.size=0,this.__data__={hash:new pb,map:new(eT||av),string:new pb}}function zK(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ik(e,t){var n=e.__data__;return zK(t)?n[typeof t=="string"?"string":"hash"]:n.map}function UK(e){var t=ik(this,e).delete(e);return this.size-=t?1:0,t}function $K(e){return ik(this,e).get(e)}function VK(e){return ik(this,e).has(e)}function WK(e,t){var n=ik(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}function hx(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}hx.prototype.clear=FK;hx.prototype.delete=UK;hx.prototype.get=$K;hx.prototype.has=VK;hx.prototype.set=WK;var jK="Expected a function";function AT(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(jK);var n=function(){var s=arguments,a=t?t.apply(this,s):s[0],d=n.cache;if(d.has(a))return d.get(a);var f=e.apply(this,s);return n.cache=d.set(a,f)||d,f};return n.cache=new(AT.Cache||hx),n}AT.Cache=hx;function HK(){this.__data__=new av,this.size=0}function GK(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function qK(e){return this.__data__.get(e)}function YK(e){return this.__data__.has(e)}var XK=200;function ZK(e,t){var n=this.__data__;if(n instanceof av){var s=n.__data__;if(!eT||s.length<XK-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new hx(s)}return n.set(e,t),this.size=n.size,this}function lw(e){var t=this.__data__=new av(e);this.size=t.size}lw.prototype.clear=HK;lw.prototype.delete=GK;lw.prototype.get=qK;lw.prototype.has=YK;lw.prototype.set=ZK;var KK=function(){try{var e=xb(Object,"defineProperty");return e({},"",{}),e}catch{}}();const YE=KK;function GL(e,t,n){t=="__proto__"&&YE?YE(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ZM(e,t,n){(n!==void 0&&!ek(e[t],n)||n===void 0&&!(t in e))&&GL(e,t,n)}function QK(e){return function(t,n,s){for(var a=-1,d=Object(t),f=s(t),i=f.length;i--;){var S=f[e?i:++a];if(n(d[S],S,d)===!1)break}return t}}var JK=QK();const eQ=JK;var e4=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vR=e4&&typeof module=="object"&&module&&!module.nodeType&&module,tQ=vR&&vR.exports===e4,xR=tQ?T_.Buffer:void 0,bR=xR?xR.allocUnsafe:void 0;function iQ(e,t){if(t)return e.slice();var n=e.length,s=bR?bR(n):new e.constructor(n);return e.copy(s),s}var rQ=T_.Uint8Array;const wR=rQ;function nQ(e){var t=new e.constructor(e.byteLength);return new wR(t).set(new wR(e)),t}function sQ(e,t){var n=t?nQ(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function oQ(e,t){var n=-1,s=e.length;for(t||(t=Array(s));++n<s;)t[n]=e[n];return t}var SR=Object.create,aQ=function(){function e(){}return function(t){if(!_b(t))return{};if(SR)return SR(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const lQ=aQ;function t4(e,t){return function(n){return e(t(n))}}var cQ=t4(Object.getPrototypeOf,Object);const i4=cQ;var hQ=Object.prototype;function rk(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||hQ;return e===n}function uQ(e){return typeof e.constructor=="function"&&!rk(e)?lQ(i4(e)):{}}function MT(e){return e!=null&&typeof e=="object"}var dQ="[object Arguments]";function TR(e){return MT(e)&&aw(e)==dQ}var r4=Object.prototype,pQ=r4.hasOwnProperty,fQ=r4.propertyIsEnumerable,mQ=TR(function(){return arguments}())?TR:function(e){return MT(e)&&pQ.call(e,"callee")&&!fQ.call(e,"callee")};const XE=mQ;var gQ=Array.isArray;const ZE=gQ;var yQ=9007199254740991;function n4(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=yQ}function nk(e){return e!=null&&n4(e.length)&&!HL(e)}function _Q(e){return MT(e)&&nk(e)}function vQ(){return!1}var s4=typeof exports=="object"&&exports&&!exports.nodeType&&exports,CR=s4&&typeof module=="object"&&module&&!module.nodeType&&module,xQ=CR&&CR.exports===s4,ER=xQ?T_.Buffer:void 0,bQ=ER?ER.isBuffer:void 0,wQ=bQ||vQ;const qL=wQ;var SQ="[object Object]",TQ=Function.prototype,CQ=Object.prototype,o4=TQ.toString,EQ=CQ.hasOwnProperty,kQ=o4.call(Object);function AQ(e){if(!MT(e)||aw(e)!=SQ)return!1;var t=i4(e);if(t===null)return!0;var n=EQ.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&o4.call(n)==kQ}var MQ="[object Arguments]",IQ="[object Array]",LQ="[object Boolean]",DQ="[object Date]",PQ="[object Error]",OQ="[object Function]",RQ="[object Map]",NQ="[object Number]",BQ="[object Object]",FQ="[object RegExp]",zQ="[object Set]",UQ="[object String]",$Q="[object WeakMap]",VQ="[object ArrayBuffer]",WQ="[object DataView]",jQ="[object Float32Array]",HQ="[object Float64Array]",GQ="[object Int8Array]",qQ="[object Int16Array]",YQ="[object Int32Array]",XQ="[object Uint8Array]",ZQ="[object Uint8ClampedArray]",KQ="[object Uint16Array]",QQ="[object Uint32Array]",Xh={};Xh[jQ]=Xh[HQ]=Xh[GQ]=Xh[qQ]=Xh[YQ]=Xh[XQ]=Xh[ZQ]=Xh[KQ]=Xh[QQ]=!0;Xh[MQ]=Xh[IQ]=Xh[VQ]=Xh[LQ]=Xh[WQ]=Xh[DQ]=Xh[PQ]=Xh[OQ]=Xh[RQ]=Xh[NQ]=Xh[BQ]=Xh[FQ]=Xh[zQ]=Xh[UQ]=Xh[$Q]=!1;function JQ(e){return MT(e)&&n4(e.length)&&!!Xh[aw(e)]}function eJ(e){return function(t){return e(t)}}var a4=typeof exports=="object"&&exports&&!exports.nodeType&&exports,LS=a4&&typeof module=="object"&&module&&!module.nodeType&&module,tJ=LS&&LS.exports===a4,AA=tJ&&Q5.process,iJ=function(){try{var e=LS&&LS.require&&LS.require("util").types;return e||AA&&AA.binding&&AA.binding("util")}catch{}}();const kR=iJ;var AR=kR&&kR.isTypedArray,rJ=AR?eJ(AR):JQ;const YL=rJ;function KM(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var nJ=Object.prototype,sJ=nJ.hasOwnProperty;function oJ(e,t,n){var s=e[t];(!(sJ.call(e,t)&&ek(s,n))||n===void 0&&!(t in e))&&GL(e,t,n)}function aJ(e,t,n,s){var a=!n;n||(n={});for(var d=-1,f=t.length;++d<f;){var i=t[d],S=s?s(n[i],e[i],i,n,e):void 0;S===void 0&&(S=e[i]),a?GL(n,i,S):oJ(n,i,S)}return n}function lJ(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}var cJ=9007199254740991,hJ=/^(?:0|[1-9]\d*)$/;function l4(e,t){var n=typeof e;return t=t??cJ,!!t&&(n=="number"||n!="symbol"&&hJ.test(e))&&e>-1&&e%1==0&&e<t}var uJ=Object.prototype,dJ=uJ.hasOwnProperty;function pJ(e,t){var n=ZE(e),s=!n&&XE(e),a=!n&&!s&&qL(e),d=!n&&!s&&!a&&YL(e),f=n||s||a||d,i=f?lJ(e.length,String):[],S=i.length;for(var E in e)(t||dJ.call(e,E))&&!(f&&(E=="length"||a&&(E=="offset"||E=="parent")||d&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||l4(E,S)))&&i.push(E);return i}function fJ(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var mJ=Object.prototype,gJ=mJ.hasOwnProperty;function yJ(e){if(!_b(e))return fJ(e);var t=rk(e),n=[];for(var s in e)s=="constructor"&&(t||!gJ.call(e,s))||n.push(s);return n}function c4(e){return nk(e)?pJ(e,!0):yJ(e)}function _J(e){return aJ(e,c4(e))}function vJ(e,t,n,s,a,d,f){var i=KM(e,n),S=KM(t,n),E=f.get(S);if(E){ZM(e,n,E);return}var L=d?d(i,S,n+"",e,t,f):void 0,F=L===void 0;if(F){var G=ZE(S),q=!G&&qL(S),Q=!G&&!q&&YL(S);L=S,G||q||Q?ZE(i)?L=i:_Q(i)?L=oQ(i):q?(F=!1,L=iQ(S,!0)):Q?(F=!1,L=sQ(S,!0)):L=[]:AQ(S)||XE(S)?(L=i,XE(i)?L=_J(i):(!_b(i)||HL(i))&&(L=uQ(S))):F=!1}F&&(f.set(S,L),a(L,S,s,d,f),f.delete(S)),ZM(e,n,L)}function h4(e,t,n,s,a){e!==t&&eQ(t,function(d,f){if(a||(a=new lw),_b(d))vJ(e,t,f,n,h4,s,a);else{var i=s?s(KM(e,f),d,f+"",e,t,a):void 0;i===void 0&&(i=d),ZM(e,f,i)}},c4)}function u4(e){return e}function xJ(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var MR=Math.max;function bJ(e,t,n){return t=MR(t===void 0?e.length-1:t,0),function(){for(var s=arguments,a=-1,d=MR(s.length-t,0),f=Array(d);++a<d;)f[a]=s[t+a];a=-1;for(var i=Array(t+1);++a<t;)i[a]=s[a];return i[t]=n(f),xJ(e,this,i)}}function wJ(e){return function(){return e}}var SJ=YE?function(e,t){return YE(e,"toString",{configurable:!0,enumerable:!1,value:wJ(t),writable:!0})}:u4;const TJ=SJ;var CJ=800,EJ=16,kJ=Date.now;function AJ(e){var t=0,n=0;return function(){var s=kJ(),a=EJ-(s-n);if(n=s,a>0){if(++t>=CJ)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var MJ=AJ(TJ);const IJ=MJ;function LJ(e,t){return IJ(bJ(e,t,u4),e+"")}function DJ(e,t,n){if(!_b(n))return!1;var s=typeof t;return(s=="number"?nk(n)&&l4(t,n.length):s=="string"&&t in n)?ek(n[t],e):!1}function PJ(e){return LJ(function(t,n){var s=-1,a=n.length,d=a>1?n[a-1]:void 0,f=a>2?n[2]:void 0;for(d=e.length>3&&typeof d=="function"?(a--,d):void 0,f&&DJ(n[0],n[1],f)&&(d=a<3?void 0:d,a=1),t=Object(t);++s<a;){var i=n[s];i&&e(t,i,s,d)}return t})}var OJ=PJ(function(e,t,n){h4(e,t,n)});const RJ=OJ;var NJ="",BJ={curveBasis:aE,curveBasisClosed:RZ,curveBasisOpen:NZ,curveBumpX:D5,curveBumpY:P5,curveBundle:BZ,curveCardinalClosed:FZ,curveCardinalOpen:zZ,curveCardinal:B5,curveCatmullRomClosed:UZ,curveCatmullRomOpen:$Z,curveCatmullRom:z5,curveLinear:WE,curveLinearClosed:VZ,curveMonotoneX:H5,curveMonotoneY:G5,curveNatural:Y5,curveStep:X5,curveStepAfter:K5,curveStepBefore:Z5},FJ=/\s*(?:(\w+)(?=:):|(\w+))\s*(?:(\w+)|((?:(?!}%{2}).|\r?\n)*))?\s*(?:}%{2})?/gi,zJ=Ze(function(e,t){const n=d4(e,/(?:init\b)|(?:initialize\b)/);let s={};if(Array.isArray(n)){const f=n.map(i=>i.args);kE(f),s=nf(s,[...f])}else s=n.args;if(!s)return;let a=_L(e,t);const d="config";return s[d]!==void 0&&(a==="flowchart-v2"&&(a="flowchart"),s[a]=s[d],delete s[d]),s},"detectInit"),d4=Ze(function(e,t=null){var n,s;try{const a=new RegExp(`[%]{2}(?![{]${FJ.source})(?=[}][%]{2}).*
`,"ig");e=e.trim().replace(a,"").replace(/'/gm,'"'),On.debug(`Detecting diagram directive${t!==null?" type:"+t:""} based on the text:${e}`);let d;const f=[];for(;(d=MS.exec(e))!==null;)if(d.index===MS.lastIndex&&MS.lastIndex++,d&&!t||t&&((n=d[1])!=null&&n.match(t))||t&&((s=d[2])!=null&&s.match(t))){const i=d[1]?d[1]:d[2],S=d[3]?d[3].trim():d[4]?JSON.parse(d[4].trim()):null;f.push({type:i,args:S})}return f.length===0?{type:e,args:null}:f.length===1?f[0]:f}catch(a){return On.error(`ERROR: ${a.message} - Unable to parse directive type: '${t}' based on the text: '${e}'`),{type:void 0,args:null}}},"detectDirective"),UJ=Ze(function(e){return e.replace(MS,"")},"removeDirectives"),$J=Ze(function(e,t){for(const[n,s]of t.entries())if(s.match(e))return n;return-1},"isSubstringInArray");function XL(e,t){if(!e)return t;const n=`curve${e.charAt(0).toUpperCase()+e.slice(1)}`;return BJ[n]??t}Ze(XL,"interpolateToCurve");function p4(e,t){const n=e.trim();if(n)return t.securityLevel!=="loose"?i5(n):n}Ze(p4,"formatUrl");var VJ=Ze((e,...t)=>{const n=e.split("."),s=n.length-1,a=n[s];let d=window;for(let f=0;f<s;f++)if(d=d[n[f]],!d){On.error(`Function name: ${e} not found in window`);return}d[a](...t)},"runFunc");function ZL(e,t){return!e||!t?0:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}Ze(ZL,"distance");function f4(e){let t,n=0;e.forEach(a=>{n+=ZL(a,t),t=a});const s=n/2;return KL(e,s)}Ze(f4,"traverseEdge");function m4(e){return e.length===1?e[0]:f4(e)}Ze(m4,"calcLabelPosition");var IR=Ze((e,t=2)=>{const n=Math.pow(10,t);return Math.round(e*n)/n},"roundNumber"),KL=Ze((e,t)=>{let n,s=t;for(const a of e){if(n){const d=ZL(a,n);if(d===0)return n;if(d<s)s-=d;else{const f=s/d;if(f<=0)return n;if(f>=1)return{x:a.x,y:a.y};if(f>0&&f<1)return{x:IR((1-f)*n.x+f*a.x,5),y:IR((1-f)*n.y+f*a.y,5)}}}n=a}throw new Error("Could not find a suitable point for the given distance")},"calculatePoint"),WJ=Ze((e,t,n)=>{On.info(`our points ${JSON.stringify(t)}`),t[0]!==n&&(t=t.reverse());const a=KL(t,25),d=e?10:5,f=Math.atan2(t[0].y-a.y,t[0].x-a.x),i={x:0,y:0};return i.x=Math.sin(f)*d+(t[0].x+a.x)/2,i.y=-Math.cos(f)*d+(t[0].y+a.y)/2,i},"calcCardinalityPosition");function g4(e,t,n){const s=structuredClone(n);On.info("our points",s),t!=="start_left"&&t!=="start_right"&&s.reverse();const a=25+e,d=KL(s,a),f=10+e*.5,i=Math.atan2(s[0].y-d.y,s[0].x-d.x),S={x:0,y:0};return t==="start_left"?(S.x=Math.sin(i+Math.PI)*f+(s[0].x+d.x)/2,S.y=-Math.cos(i+Math.PI)*f+(s[0].y+d.y)/2):t==="end_right"?(S.x=Math.sin(i-Math.PI)*f+(s[0].x+d.x)/2-5,S.y=-Math.cos(i-Math.PI)*f+(s[0].y+d.y)/2-5):t==="end_left"?(S.x=Math.sin(i)*f+(s[0].x+d.x)/2-5,S.y=-Math.cos(i)*f+(s[0].y+d.y)/2-5):(S.x=Math.sin(i)*f+(s[0].x+d.x)/2,S.y=-Math.cos(i)*f+(s[0].y+d.y)/2),S}Ze(g4,"calcTerminalLabelPosition");function y4(e){let t="",n="";for(const s of e)s!==void 0&&(s.startsWith("color:")||s.startsWith("text-align:")?n=n+s+";":t=t+s+";");return{style:t,labelStyle:n}}Ze(y4,"getStylesFromArray");var LR=0,jJ=Ze(()=>(LR++,"id-"+Math.random().toString(36).substr(2,12)+"-"+LR),"generateId");function _4(e){let t="";const n="0123456789abcdef",s=n.length;for(let a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*s));return t}Ze(_4,"makeRandomHex");var HJ=Ze(e=>_4(e.length),"random"),GJ=Ze(function(){return{x:0,y:0,fill:void 0,anchor:"start",style:"#666",width:100,height:100,textMargin:0,rx:0,ry:0,valign:void 0,text:""}},"getTextObj"),qJ=Ze(function(e,t){const n=t.text.replace(sw.lineBreakRegex," "),[,s]=sk(t.fontSize),a=e.append("text");a.attr("x",t.x),a.attr("y",t.y),a.style("text-anchor",t.anchor),a.style("font-family",t.fontFamily),a.style("font-size",s),a.style("font-weight",t.fontWeight),a.attr("fill",t.fill),t.class!==void 0&&a.attr("class",t.class);const d=a.append("tspan");return d.attr("x",t.x+t.textMargin*2),d.attr("fill",t.fill),d.text(n),a},"drawSimpleText"),YJ=AT((e,t,n)=>{if(!e||(n=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",joinWith:"<br/>"},n),sw.lineBreakRegex.test(e)))return e;const s=e.split(" ").filter(Boolean),a=[];let d="";return s.forEach((f,i)=>{const S=sv(`${f} `,n),E=sv(d,n);if(S>t){const{hyphenatedStrings:G,remainingWord:q}=XJ(f,t,"-",n);a.push(d,...G),d=q}else E+S>=t?(a.push(d),d=f):d=[d,f].filter(Boolean).join(" ");i+1===s.length&&a.push(d)}),a.filter(f=>f!=="").join(n.joinWith)},(e,t,n)=>`${e}${t}${n.fontSize}${n.fontWeight}${n.fontFamily}${n.joinWith}`),XJ=AT((e,t,n="-",s)=>{s=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",margin:0},s);const a=[...e],d=[];let f="";return a.forEach((i,S)=>{const E=`${f}${i}`;if(sv(E,s)>=t){const F=S+1,G=a.length===F,q=`${E}${n}`;d.push(G?E:q),f=""}else f=E}),{hyphenatedStrings:d,remainingWord:f}},(e,t,n="-",s)=>`${e}${t}${n}${s.fontSize}${s.fontWeight}${s.fontFamily}`);function v4(e,t){return QL(e,t).height}Ze(v4,"calculateTextHeight");function sv(e,t){return QL(e,t).width}Ze(sv,"calculateTextWidth");var QL=AT((e,t)=>{const{fontSize:n=12,fontFamily:s="Arial",fontWeight:a=400}=t;if(!e)return{width:0,height:0};const[,d]=sk(n),f=["sans-serif",s],i=e.split(sw.lineBreakRegex),S=[],E=mc("body");if(!E.remove)return{width:0,height:0,lineHeight:0};const L=E.append("svg");for(const G of f){let q=0;const Q={width:0,height:0,lineHeight:0};for(const te of i){const he=GJ();he.text=te||NJ;const fe=qJ(L,he).style("font-size",d).style("font-weight",a).style("font-family",G),le=(fe._groups||fe)[0][0].getBBox();if(le.width===0&&le.height===0)throw new Error("svg element not in render tree");Q.width=Math.round(Math.max(Q.width,le.width)),q=Math.round(le.height),Q.height+=q,Q.lineHeight=Math.round(Math.max(Q.lineHeight,q))}S.push(Q)}L.remove();const F=isNaN(S[1].height)||isNaN(S[1].width)||isNaN(S[1].lineHeight)||S[0].height>S[1].height&&S[0].width>S[1].width&&S[0].lineHeight>S[1].lineHeight?0:1;return S[F]},(e,t)=>`${e}${t.fontSize}${t.fontWeight}${t.fontFamily}`),yT,ZJ=(yT=class{constructor(t=!1,n){this.count=0,this.count=n?n.length:0,this.next=t?()=>this.count++:()=>Date.now()}},Ze(yT,"InitIDGenerator"),yT),LC,KJ=Ze(function(e){return LC=LC||document.createElement("div"),e=escape(e).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"),LC.innerHTML=e,unescape(LC.textContent)},"entityDecode");function JL(e){return"str"in e}Ze(JL,"isDetailedError");var QJ=Ze((e,t,n,s)=>{var d;if(!s)return;const a=(d=e.node())==null?void 0:d.getBBox();a&&e.append("text").text(s).attr("text-anchor","middle").attr("x",a.x+a.width/2).attr("y",-n).attr("class",t)},"insertTitle"),sk=Ze(e=>{if(typeof e=="number")return[e,e+"px"];const t=parseInt(e??"",10);return Number.isNaN(t)?[void 0,void 0]:e===String(t)?[t,e+"px"]:[t,e]},"parseFontSize");function eD(e,t){return RJ({},e,t)}Ze(eD,"cleanAndMerge");var c_={assignWithDepth:nf,wrapLabel:YJ,calculateTextHeight:v4,calculateTextWidth:sv,calculateTextDimensions:QL,cleanAndMerge:eD,detectInit:zJ,detectDirective:d4,isSubstringInArray:$J,interpolateToCurve:XL,calcLabelPosition:m4,calcCardinalityPosition:WJ,calcTerminalLabelPosition:g4,formatUrl:p4,getStylesFromArray:y4,generateId:jJ,random:HJ,runFunc:VJ,entityDecode:KJ,insertTitle:QJ,parseFontSize:sk,InitIDGenerator:ZJ},JJ=Ze(function(e){let t=e;return t=t.replace(/style.*:\S*#.*;/g,function(n){return n.substring(0,n.length-1)}),t=t.replace(/classDef.*:\S*#.*;/g,function(n){return n.substring(0,n.length-1)}),t=t.replace(/#\w+;/g,function(n){const s=n.substring(1,n.length-1);return/^\+?\d+$/.test(s)?""+s+"":""+s+""}),t},"encodeEntities"),bb=Ze(function(e){return e.replace(//g,"&#").replace(//g,"&").replace(//g,";")},"decodeEntities"),Vfe=Ze((e,t,{counter:n=0,prefix:s,suffix:a},d)=>d||`${s?`${s}_`:""}${e}_${t}_${n}${a?`_${a}`:""}`,"getEdgeId");function wm(e){return e??null}Ze(wm,"handleUndefinedAttr");const eee=Object.freeze({left:0,top:0,width:16,height:16}),KE=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),x4=Object.freeze({...eee,...KE}),tee=Object.freeze({...x4,body:"",hidden:!1}),iee=Object.freeze({width:null,height:null}),ree=Object.freeze({...iee,...KE}),nee=(e,t,n,s="")=>{const a=e.split(":");if(e.slice(0,1)==="@"){if(a.length<2||a.length>3)return null;s=a.shift().slice(1)}if(a.length>3||!a.length)return null;if(a.length>1){const i=a.pop(),S=a.pop(),E={provider:a.length>0?a[0]:s,prefix:S,name:i};return t&&!MA(E)?null:E}const d=a[0],f=d.split("-");if(f.length>1){const i={provider:s,prefix:f.shift(),name:f.join("-")};return t&&!MA(i)?null:i}if(n&&s===""){const i={provider:s,prefix:"",name:d};return t&&!MA(i,n)?null:i}return null},MA=(e,t)=>e?!!((t&&e.prefix===""||e.prefix)&&e.name):!1;function see(e,t){const n={};!e.hFlip!=!t.hFlip&&(n.hFlip=!0),!e.vFlip!=!t.vFlip&&(n.vFlip=!0);const s=((e.rotate||0)+(t.rotate||0))%4;return s&&(n.rotate=s),n}function DR(e,t){const n=see(e,t);for(const s in tee)s in KE?s in e&&!(s in n)&&(n[s]=KE[s]):s in t?n[s]=t[s]:s in e&&(n[s]=e[s]);return n}function oee(e,t){const n=e.icons,s=e.aliases||Object.create(null),a=Object.create(null);function d(f){if(n[f])return a[f]=[];if(!(f in a)){a[f]=null;const i=s[f]&&s[f].parent,S=i&&d(i);S&&(a[f]=[i].concat(S))}return a[f]}return(t||Object.keys(n).concat(Object.keys(s))).forEach(d),a}function PR(e,t,n){const s=e.icons,a=e.aliases||Object.create(null);let d={};function f(i){d=DR(s[i]||a[i],d)}return f(t),n.forEach(f),DR(e,d)}function aee(e,t){if(e.icons[t])return PR(e,t,[]);const n=oee(e,[t])[t];return n?PR(e,t,n):null}const lee=/(-?[0-9.]*[0-9]+[0-9.]*)/g,cee=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function OR(e,t,n){if(t===1)return e;if(n=n||100,typeof e=="number")return Math.ceil(e*t*n)/n;if(typeof e!="string")return e;const s=e.split(lee);if(s===null||!s.length)return e;const a=[];let d=s.shift(),f=cee.test(d);for(;;){if(f){const i=parseFloat(d);isNaN(i)?a.push(d):a.push(Math.ceil(i*t*n)/n)}else a.push(d);if(d=s.shift(),d===void 0)return a.join("");f=!f}}function hee(e,t="defs"){let n="";const s=e.indexOf("<"+t);for(;s>=0;){const a=e.indexOf(">",s),d=e.indexOf("</"+t);if(a===-1||d===-1)break;const f=e.indexOf(">",d);if(f===-1)break;n+=e.slice(a+1,d).trim(),e=e.slice(0,s).trim()+e.slice(f+1)}return{defs:n,content:e}}function uee(e,t){return e?"<defs>"+e+"</defs>"+t:t}function dee(e,t,n){const s=hee(e);return uee(s.defs,t+s.content+n)}const pee=e=>e==="unset"||e==="undefined"||e==="none";function fee(e,t){const n={...x4,...e},s={...ree,...t},a={left:n.left,top:n.top,width:n.width,height:n.height};let d=n.body;[n,s].forEach(te=>{const he=[],fe=te.hFlip,le=te.vFlip;let Se=te.rotate;fe?le?Se+=2:(he.push("translate("+(a.width+a.left).toString()+" "+(0-a.top).toString()+")"),he.push("scale(-1 1)"),a.top=a.left=0):le&&(he.push("translate("+(0-a.left).toString()+" "+(a.height+a.top).toString()+")"),he.push("scale(1 -1)"),a.top=a.left=0);let ke;switch(Se<0&&(Se-=Math.floor(Se/4)*4),Se=Se%4,Se){case 1:ke=a.height/2+a.top,he.unshift("rotate(90 "+ke.toString()+" "+ke.toString()+")");break;case 2:he.unshift("rotate(180 "+(a.width/2+a.left).toString()+" "+(a.height/2+a.top).toString()+")");break;case 3:ke=a.width/2+a.left,he.unshift("rotate(-90 "+ke.toString()+" "+ke.toString()+")");break}Se%2===1&&(a.left!==a.top&&(ke=a.left,a.left=a.top,a.top=ke),a.width!==a.height&&(ke=a.width,a.width=a.height,a.height=ke)),he.length&&(d=dee(d,'<g transform="'+he.join(" ")+'">',"</g>"))});const f=s.width,i=s.height,S=a.width,E=a.height;let L,F;f===null?(F=i===null?"1em":i==="auto"?E:i,L=OR(F,S/E)):(L=f==="auto"?S:f,F=i===null?OR(L,E/S):i==="auto"?E:i);const G={},q=(te,he)=>{pee(he)||(G[te]=he.toString())};q("width",L),q("height",F);const Q=[a.left,a.top,S,E];return G.viewBox=Q.join(" "),{attributes:G,viewBox:Q,body:d}}const mee=/\sid="(\S+)"/g,gee="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let yee=0;function _ee(e,t=gee){const n=[];let s;for(;s=mee.exec(e);)n.push(s[1]);if(!n.length)return e;const a="suffix"+(Math.random()*16777216|Date.now()).toString(16);return n.forEach(d=>{const f=typeof t=="function"?t(d):t+(yee++).toString(),i=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp('([#;"])('+i+')([")]|\\.[a-z])',"g"),"$1"+f+a+"$3")}),e=e.replace(new RegExp(a,"g"),""),e}function vee(e,t){let n=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const s in t)n+=" "+s+'="'+t[s]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+n+">"+e+"</svg>"}function tD(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var wb=tD();function b4(e){wb=e}var DS={exec:()=>null};function qc(e,t=""){let n=typeof e=="string"?e:e.source;const s={replace:(a,d)=>{let f=typeof d=="string"?d:d.source;return f=f.replace(bm.caret,"$1"),n=n.replace(a,f),s},getRegex:()=>new RegExp(n,t)};return s}var bm={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},xee=/^(?:[ \t]*(?:\n|$))+/,bee=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,wee=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,IT=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,See=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,iD=/(?:[*+-]|\d{1,9}[.)])/,w4=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,S4=qc(w4).replace(/bull/g,iD).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Tee=qc(w4).replace(/bull/g,iD).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),rD=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Cee=/^[^\n]+/,nD=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Eee=qc(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",nD).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),kee=qc(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,iD).getRegex(),ok="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",sD=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Aee=qc("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",sD).replace("tag",ok).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),T4=qc(rD).replace("hr",IT).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ok).getRegex(),Mee=qc(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",T4).getRegex(),oD={blockquote:Mee,code:bee,def:Eee,fences:wee,heading:See,hr:IT,html:Aee,lheading:S4,list:kee,newline:xee,paragraph:T4,table:DS,text:Cee},RR=qc("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",IT).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ok).getRegex(),Iee={...oD,lheading:Tee,table:RR,paragraph:qc(rD).replace("hr",IT).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",RR).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ok).getRegex()},Lee={...oD,html:qc(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",sD).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:DS,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:qc(rD).replace("hr",IT).replace("heading",` *#{1,6} *[^
]`).replace("lheading",S4).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Dee=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Pee=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,C4=/^( {2,}|\\)\n(?!\s*$)/,Oee=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ak=/[\p{P}\p{S}]/u,aD=/[\s\p{P}\p{S}]/u,E4=/[^\s\p{P}\p{S}]/u,Ree=qc(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,aD).getRegex(),k4=/(?!~)[\p{P}\p{S}]/u,Nee=/(?!~)[\s\p{P}\p{S}]/u,Bee=/(?:[^\s\p{P}\p{S}]|~)/u,Fee=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,A4=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,zee=qc(A4,"u").replace(/punct/g,ak).getRegex(),Uee=qc(A4,"u").replace(/punct/g,k4).getRegex(),M4="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",$ee=qc(M4,"gu").replace(/notPunctSpace/g,E4).replace(/punctSpace/g,aD).replace(/punct/g,ak).getRegex(),Vee=qc(M4,"gu").replace(/notPunctSpace/g,Bee).replace(/punctSpace/g,Nee).replace(/punct/g,k4).getRegex(),Wee=qc("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,E4).replace(/punctSpace/g,aD).replace(/punct/g,ak).getRegex(),jee=qc(/\\(punct)/,"gu").replace(/punct/g,ak).getRegex(),Hee=qc(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Gee=qc(sD).replace("(?:-->|$)","-->").getRegex(),qee=qc("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Gee).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),QE=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Yee=qc(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",QE).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),I4=qc(/^!?\[(label)\]\[(ref)\]/).replace("label",QE).replace("ref",nD).getRegex(),L4=qc(/^!?\[(ref)\](?:\[\])?/).replace("ref",nD).getRegex(),Xee=qc("reflink|nolink(?!\\()","g").replace("reflink",I4).replace("nolink",L4).getRegex(),lD={_backpedal:DS,anyPunctuation:jee,autolink:Hee,blockSkip:Fee,br:C4,code:Pee,del:DS,emStrongLDelim:zee,emStrongRDelimAst:$ee,emStrongRDelimUnd:Wee,escape:Dee,link:Yee,nolink:L4,punctuation:Ree,reflink:I4,reflinkSearch:Xee,tag:qee,text:Oee,url:DS},Zee={...lD,link:qc(/^!?\[(label)\]\((.*?)\)/).replace("label",QE).getRegex(),reflink:qc(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",QE).getRegex()},QM={...lD,emStrongRDelimAst:Vee,emStrongLDelim:Uee,url:qc(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Kee={...QM,br:qc(C4).replace("{2,}","*").getRegex(),text:qc(QM.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},DC={normal:oD,gfm:Iee,pedantic:Lee},lS={normal:lD,gfm:QM,breaks:Kee,pedantic:Zee},Qee={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},NR=e=>Qee[e];function s_(e,t){if(t){if(bm.escapeTest.test(e))return e.replace(bm.escapeReplace,NR)}else if(bm.escapeTestNoEncode.test(e))return e.replace(bm.escapeReplaceNoEncode,NR);return e}function BR(e){try{e=encodeURI(e).replace(bm.percentDecode,"%")}catch{return null}return e}function FR(e,t){var d;const n=e.replace(bm.findPipe,(f,i,S)=>{let E=!1,L=i;for(;--L>=0&&S[L]==="\\";)E=!E;return E?"|":" |"}),s=n.split(bm.splitPipe);let a=0;if(s[0].trim()||s.shift(),s.length>0&&!((d=s.at(-1))!=null&&d.trim())&&s.pop(),t)if(s.length>t)s.splice(t);else for(;s.length<t;)s.push("");for(;a<s.length;a++)s[a]=s[a].trim().replace(bm.slashPipe,"|");return s}function cS(e,t,n){const s=e.length;if(s===0)return"";let a=0;for(;a<s;){const d=e.charAt(s-a-1);if(d===t&&!n)a++;else if(d!==t&&n)a++;else break}return e.slice(0,s-a)}function Jee(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let s=0;s<e.length;s++)if(e[s]==="\\")s++;else if(e[s]===t[0])n++;else if(e[s]===t[1]&&(n--,n<0))return s;return n>0?-2:-1}function zR(e,t,n,s,a){const d=t.href,f=t.title||null,i=e[1].replace(a.other.outputLinkReplace,"$1");s.state.inLink=!0;const S={type:e[0].charAt(0)==="!"?"image":"link",raw:n,href:d,title:f,text:i,tokens:s.inlineTokens(i)};return s.state.inLink=!1,S}function ete(e,t,n){const s=e.match(n.other.indentCodeCompensation);if(s===null)return t;const a=s[1];return t.split(`
`).map(d=>{const f=d.match(n.other.beginningSpace);if(f===null)return d;const[i]=f;return i.length>=a.length?d.slice(a.length):d}).join(`
`)}var JE=class{constructor(e){xh(this,"options");xh(this,"rules");xh(this,"lexer");this.options=e||wb}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:cS(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=ete(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const s=cS(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:cS(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=cS(t[0],`
`).split(`
`),s="",a="";const d=[];for(;n.length>0;){let f=!1;const i=[];let S;for(S=0;S<n.length;S++)if(this.rules.other.blockquoteStart.test(n[S]))i.push(n[S]),f=!0;else if(!f)i.push(n[S]);else break;n=n.slice(S);const E=i.join(`
`),L=E.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${E}`:E,a=a?`${a}
${L}`:L;const F=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(L,d,!0),this.lexer.state.top=F,n.length===0)break;const G=d.at(-1);if((G==null?void 0:G.type)==="code")break;if((G==null?void 0:G.type)==="blockquote"){const q=G,Q=q.raw+`
`+n.join(`
`),te=this.blockquote(Q);d[d.length-1]=te,s=s.substring(0,s.length-q.raw.length)+te.raw,a=a.substring(0,a.length-q.text.length)+te.text;break}else if((G==null?void 0:G.type)==="list"){const q=G,Q=q.raw+`
`+n.join(`
`),te=this.list(Q);d[d.length-1]=te,s=s.substring(0,s.length-G.raw.length)+te.raw,a=a.substring(0,a.length-q.raw.length)+te.raw,n=Q.substring(d.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:d,text:a}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,a={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const d=this.rules.other.listItemRegex(n);let f=!1;for(;e;){let S=!1,E="",L="";if(!(t=d.exec(e))||this.rules.block.hr.test(e))break;E=t[0],e=e.substring(E.length);let F=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,fe=>" ".repeat(3*fe.length)),G=e.split(`
`,1)[0],q=!F.trim(),Q=0;if(this.options.pedantic?(Q=2,L=F.trimStart()):q?Q=t[1].length+1:(Q=t[2].search(this.rules.other.nonSpaceChar),Q=Q>4?1:Q,L=F.slice(Q),Q+=t[1].length),q&&this.rules.other.blankLine.test(G)&&(E+=G+`
`,e=e.substring(G.length+1),S=!0),!S){const fe=this.rules.other.nextBulletRegex(Q),le=this.rules.other.hrRegex(Q),Se=this.rules.other.fencesBeginRegex(Q),ke=this.rules.other.headingBeginRegex(Q),Ee=this.rules.other.htmlBeginRegex(Q);for(;e;){const Ie=e.split(`
`,1)[0];let He;if(G=Ie,this.options.pedantic?(G=G.replace(this.rules.other.listReplaceNesting,"  "),He=G):He=G.replace(this.rules.other.tabCharGlobal,"    "),Se.test(G)||ke.test(G)||Ee.test(G)||fe.test(G)||le.test(G))break;if(He.search(this.rules.other.nonSpaceChar)>=Q||!G.trim())L+=`
`+He.slice(Q);else{if(q||F.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Se.test(F)||ke.test(F)||le.test(F))break;L+=`
`+G}!q&&!G.trim()&&(q=!0),E+=Ie+`
`,e=e.substring(Ie.length+1),F=He.slice(Q)}}a.loose||(f?a.loose=!0:this.rules.other.doubleBlankLine.test(E)&&(f=!0));let te=null,he;this.options.gfm&&(te=this.rules.other.listIsTask.exec(L),te&&(he=te[0]!=="[ ] ",L=L.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:E,task:!!te,checked:he,loose:!1,text:L,tokens:[]}),a.raw+=E}const i=a.items.at(-1);if(i)i.raw=i.raw.trimEnd(),i.text=i.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let S=0;S<a.items.length;S++)if(this.lexer.state.top=!1,a.items[S].tokens=this.lexer.blockTokens(a.items[S].text,[]),!a.loose){const E=a.items[S].tokens.filter(F=>F.type==="space"),L=E.length>0&&E.some(F=>this.rules.other.anyLine.test(F.raw));a.loose=L}if(a.loose)for(let S=0;S<a.items.length;S++)a.items[S].loose=!0;return a}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:a}}}table(e){var f;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=FR(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(f=t[3])!=null&&f.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],d={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const i of s)this.rules.other.tableAlignRight.test(i)?d.align.push("right"):this.rules.other.tableAlignCenter.test(i)?d.align.push("center"):this.rules.other.tableAlignLeft.test(i)?d.align.push("left"):d.align.push(null);for(let i=0;i<n.length;i++)d.header.push({text:n[i],tokens:this.lexer.inline(n[i]),header:!0,align:d.align[i]});for(const i of a)d.rows.push(FR(i,d.header.length).map((S,E)=>({text:S,tokens:this.lexer.inline(S),header:!1,align:d.align[E]})));return d}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const d=cS(n.slice(0,-1),"\\");if((n.length-d.length)%2===0)return}else{const d=Jee(t[2],"()");if(d===-2)return;if(d>-1){const i=(t[0].indexOf("!")===0?5:4)+t[1].length+d;t[2]=t[2].substring(0,d),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let s=t[2],a="";if(this.options.pedantic){const d=this.rules.other.pedanticHrefTitle.exec(s);d&&(s=d[1],a=d[3])}else a=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),zR(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=t[s.toLowerCase()];if(!a){const d=n[0].charAt(0);return{type:"text",raw:d,text:d}}return zR(n,a,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const d=[...s[0]].length-1;let f,i,S=d,E=0;const L=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(L.lastIndex=0,t=t.slice(-1*e.length+d);(s=L.exec(t))!=null;){if(f=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!f)continue;if(i=[...f].length,s[3]||s[4]){S+=i;continue}else if((s[5]||s[6])&&d%3&&!((d+i)%3)){E+=i;continue}if(S-=i,S>0)continue;i=Math.min(i,i+S+E);const F=[...s[0]][0].length,G=e.slice(0,d+s.index+F+i);if(Math.min(d,i)%2){const Q=G.slice(1,-1);return{type:"em",raw:G,text:Q,tokens:this.lexer.inlineTokens(Q)}}const q=G.slice(2,-2);return{type:"strong",raw:G,text:q,tokens:this.lexer.inlineTokens(q)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=t[1],s="mailto:"+n):(n=t[1],s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,a;if(t[2]==="@")s=t[0],a="mailto:"+s;else{let d;do d=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(d!==t[0]);s=t[0],t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:s,href:a,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},Q_=class JM{constructor(t){xh(this,"tokens");xh(this,"options");xh(this,"state");xh(this,"tokenizer");xh(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||wb,this.options.tokenizer=this.options.tokenizer||new JE,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:bm,block:DC.normal,inline:lS.normal};this.options.pedantic?(n.block=DC.pedantic,n.inline=lS.pedantic):this.options.gfm&&(n.block=DC.gfm,this.options.breaks?n.inline=lS.breaks:n.inline=lS.gfm),this.tokenizer.rules=n}static get rules(){return{block:DC,inline:lS}}static lex(t,n){return new JM(n).lex(t)}static lexInline(t,n){return new JM(n).inlineTokens(t)}lex(t){t=t.replace(bm.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const s=this.inlineQueue[n];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],s=!1){var a,d,f;for(this.options.pedantic&&(t=t.replace(bm.tabCharGlobal,"    ").replace(bm.spaceLine,""));t;){let i;if((d=(a=this.options.extensions)==null?void 0:a.block)!=null&&d.some(E=>(i=E.call({lexer:this},t,n))?(t=t.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);const E=n.at(-1);i.raw.length===1&&E!==void 0?E.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);const E=n.at(-1);(E==null?void 0:E.type)==="paragraph"||(E==null?void 0:E.type)==="text"?(E.raw+=`
`+i.raw,E.text+=`
`+i.text,this.inlineQueue.at(-1).src=E.text):n.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);const E=n.at(-1);(E==null?void 0:E.type)==="paragraph"||(E==null?void 0:E.type)==="text"?(E.raw+=`
`+i.raw,E.text+=`
`+i.raw,this.inlineQueue.at(-1).src=E.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),n.push(i);continue}let S=t;if((f=this.options.extensions)!=null&&f.startBlock){let E=1/0;const L=t.slice(1);let F;this.options.extensions.startBlock.forEach(G=>{F=G.call({lexer:this},L),typeof F=="number"&&F>=0&&(E=Math.min(E,F))}),E<1/0&&E>=0&&(S=t.substring(0,E+1))}if(this.state.top&&(i=this.tokenizer.paragraph(S))){const E=n.at(-1);s&&(E==null?void 0:E.type)==="paragraph"?(E.raw+=`
`+i.raw,E.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=E.text):n.push(i),s=S.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);const E=n.at(-1);(E==null?void 0:E.type)==="text"?(E.raw+=`
`+i.raw,E.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=E.text):n.push(i);continue}if(t){const E="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(E);break}else throw new Error(E)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){var i,S,E;let s=t,a=null;if(this.tokens.links){const L=Object.keys(this.tokens.links);if(L.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)L.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,a.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let d=!1,f="";for(;t;){d||(f=""),d=!1;let L;if((S=(i=this.options.extensions)==null?void 0:i.inline)!=null&&S.some(G=>(L=G.call({lexer:this},t,n))?(t=t.substring(L.raw.length),n.push(L),!0):!1))continue;if(L=this.tokenizer.escape(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.tag(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.link(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(L.raw.length);const G=n.at(-1);L.type==="text"&&(G==null?void 0:G.type)==="text"?(G.raw+=L.raw,G.text+=L.text):n.push(L);continue}if(L=this.tokenizer.emStrong(t,s,f)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.codespan(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.br(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.del(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.autolink(t)){t=t.substring(L.raw.length),n.push(L);continue}if(!this.state.inLink&&(L=this.tokenizer.url(t))){t=t.substring(L.raw.length),n.push(L);continue}let F=t;if((E=this.options.extensions)!=null&&E.startInline){let G=1/0;const q=t.slice(1);let Q;this.options.extensions.startInline.forEach(te=>{Q=te.call({lexer:this},q),typeof Q=="number"&&Q>=0&&(G=Math.min(G,Q))}),G<1/0&&G>=0&&(F=t.substring(0,G+1))}if(L=this.tokenizer.inlineText(F)){t=t.substring(L.raw.length),L.raw.slice(-1)!=="_"&&(f=L.raw.slice(-1)),d=!0;const G=n.at(-1);(G==null?void 0:G.type)==="text"?(G.raw+=L.raw,G.text+=L.text):n.push(L);continue}if(t){const G="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(G);break}else throw new Error(G)}}return n}},e2=class{constructor(e){xh(this,"options");xh(this,"parser");this.options=e||wb}space(e){return""}code({text:e,lang:t,escaped:n}){var d;const s=(d=(t||"").match(bm.notSpaceStart))==null?void 0:d[0],a=e.replace(bm.endingNewline,"")+`
`;return s?'<pre><code class="language-'+s_(s)+'">'+(n?a:s_(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:s_(a,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let s="";for(let f=0;f<e.items.length;f++){const i=e.items[f];s+=this.listitem(i)}const a=t?"ol":"ul",d=t&&n!==1?' start="'+n+'"':"";return"<"+a+d+`>
`+s+"</"+a+`>
`}listitem(e){var n;let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+s_(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let a=0;a<e.header.length;a++)n+=this.tablecell(e.header[a]);t+=this.tablerow({text:n});let s="";for(let a=0;a<e.rows.length;a++){const d=e.rows[a];n="";for(let f=0;f<d.length;f++)n+=this.tablecell(d[f]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${s_(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),a=BR(e);if(a===null)return s;e=a;let d='<a href="'+e+'"';return t&&(d+=' title="'+s_(t)+'"'),d+=">"+s+"</a>",d}image({href:e,title:t,text:n,tokens:s}){s&&(n=this.parser.parseInline(s,this.parser.textRenderer));const a=BR(e);if(a===null)return s_(n);e=a;let d=`<img src="${e}" alt="${n}"`;return t&&(d+=` title="${s_(t)}"`),d+=">",d}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:s_(e.text)}},cD=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},J_=class eI{constructor(t){xh(this,"options");xh(this,"renderer");xh(this,"textRenderer");this.options=t||wb,this.options.renderer=this.options.renderer||new e2,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new cD}static parse(t,n){return new eI(n).parse(t)}static parseInline(t,n){return new eI(n).parseInline(t)}parse(t,n=!0){var a,d;let s="";for(let f=0;f<t.length;f++){const i=t[f];if((d=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&d[i.type]){const E=i,L=this.options.extensions.renderers[E.type].call({parser:this},E);if(L!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(E.type)){s+=L||"";continue}}const S=i;switch(S.type){case"space":{s+=this.renderer.space(S);continue}case"hr":{s+=this.renderer.hr(S);continue}case"heading":{s+=this.renderer.heading(S);continue}case"code":{s+=this.renderer.code(S);continue}case"table":{s+=this.renderer.table(S);continue}case"blockquote":{s+=this.renderer.blockquote(S);continue}case"list":{s+=this.renderer.list(S);continue}case"html":{s+=this.renderer.html(S);continue}case"paragraph":{s+=this.renderer.paragraph(S);continue}case"text":{let E=S,L=this.renderer.text(E);for(;f+1<t.length&&t[f+1].type==="text";)E=t[++f],L+=`
`+this.renderer.text(E);n?s+=this.renderer.paragraph({type:"paragraph",raw:L,text:L,tokens:[{type:"text",raw:L,text:L,escaped:!0}]}):s+=L;continue}default:{const E='Token with "'+S.type+'" type was not found.';if(this.options.silent)return console.error(E),"";throw new Error(E)}}}return s}parseInline(t,n=this.renderer){var a,d;let s="";for(let f=0;f<t.length;f++){const i=t[f];if((d=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&d[i.type]){const E=this.options.extensions.renderers[i.type].call({parser:this},i);if(E!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){s+=E||"";continue}}const S=i;switch(S.type){case"escape":{s+=n.text(S);break}case"html":{s+=n.html(S);break}case"link":{s+=n.link(S);break}case"image":{s+=n.image(S);break}case"strong":{s+=n.strong(S);break}case"em":{s+=n.em(S);break}case"codespan":{s+=n.codespan(S);break}case"br":{s+=n.br(S);break}case"del":{s+=n.del(S);break}case"text":{s+=n.text(S);break}default:{const E='Token with "'+S.type+'" type was not found.';if(this.options.silent)return console.error(E),"";throw new Error(E)}}}return s}},aM,lE=(aM=class{constructor(e){xh(this,"options");xh(this,"block");this.options=e||wb}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Q_.lex:Q_.lexInline}provideParser(){return this.block?J_.parse:J_.parseInline}},xh(aM,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),aM),tte=class{constructor(...e){xh(this,"defaults",tD());xh(this,"options",this.setOptions);xh(this,"parse",this.parseMarkdown(!0));xh(this,"parseInline",this.parseMarkdown(!1));xh(this,"Parser",J_);xh(this,"Renderer",e2);xh(this,"TextRenderer",cD);xh(this,"Lexer",Q_);xh(this,"Tokenizer",JE);xh(this,"Hooks",lE);this.use(...e)}walkTokens(e,t){var s,a;let n=[];for(const d of e)switch(n=n.concat(t.call(this,d)),d.type){case"table":{const f=d;for(const i of f.header)n=n.concat(this.walkTokens(i.tokens,t));for(const i of f.rows)for(const S of i)n=n.concat(this.walkTokens(S.tokens,t));break}case"list":{const f=d;n=n.concat(this.walkTokens(f.items,t));break}default:{const f=d;(a=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&a[f.type]?this.defaults.extensions.childTokens[f.type].forEach(i=>{const S=f[i].flat(1/0);n=n.concat(this.walkTokens(S,t))}):f.tokens&&(n=n.concat(this.walkTokens(f.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){const d=t.renderers[a.name];d?t.renderers[a.name]=function(...f){let i=a.renderer.apply(this,f);return i===!1&&(i=d.apply(this,f)),i}:t.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const d=t[a.level];d?d.unshift(a.tokenizer):t[a.level]=[a.tokenizer],a.start&&(a.level==="block"?t.startBlock?t.startBlock.push(a.start):t.startBlock=[a.start]:a.level==="inline"&&(t.startInline?t.startInline.push(a.start):t.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(t.childTokens[a.name]=a.childTokens)}),s.extensions=t),n.renderer){const a=this.defaults.renderer||new e2(this.defaults);for(const d in n.renderer){if(!(d in a))throw new Error(`renderer '${d}' does not exist`);if(["options","parser"].includes(d))continue;const f=d,i=n.renderer[f],S=a[f];a[f]=(...E)=>{let L=i.apply(a,E);return L===!1&&(L=S.apply(a,E)),L||""}}s.renderer=a}if(n.tokenizer){const a=this.defaults.tokenizer||new JE(this.defaults);for(const d in n.tokenizer){if(!(d in a))throw new Error(`tokenizer '${d}' does not exist`);if(["options","rules","lexer"].includes(d))continue;const f=d,i=n.tokenizer[f],S=a[f];a[f]=(...E)=>{let L=i.apply(a,E);return L===!1&&(L=S.apply(a,E)),L}}s.tokenizer=a}if(n.hooks){const a=this.defaults.hooks||new lE;for(const d in n.hooks){if(!(d in a))throw new Error(`hook '${d}' does not exist`);if(["options","block"].includes(d))continue;const f=d,i=n.hooks[f],S=a[f];lE.passThroughHooks.has(d)?a[f]=E=>{if(this.defaults.async)return Promise.resolve(i.call(a,E)).then(F=>S.call(a,F));const L=i.call(a,E);return S.call(a,L)}:a[f]=(...E)=>{let L=i.apply(a,E);return L===!1&&(L=S.apply(a,E)),L}}s.hooks=a}if(n.walkTokens){const a=this.defaults.walkTokens,d=n.walkTokens;s.walkTokens=function(f){let i=[];return i.push(d.call(this,f)),a&&(i=i.concat(a.call(this,f))),i}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Q_.lex(e,t??this.defaults)}parser(e,t){return J_.parse(e,t??this.defaults)}parseMarkdown(e){return(n,s)=>{const a={...s},d={...this.defaults,...a},f=this.onError(!!d.silent,!!d.async);if(this.defaults.async===!0&&a.async===!1)return f(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return f(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return f(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));d.hooks&&(d.hooks.options=d,d.hooks.block=e);const i=d.hooks?d.hooks.provideLexer():e?Q_.lex:Q_.lexInline,S=d.hooks?d.hooks.provideParser():e?J_.parse:J_.parseInline;if(d.async)return Promise.resolve(d.hooks?d.hooks.preprocess(n):n).then(E=>i(E,d)).then(E=>d.hooks?d.hooks.processAllTokens(E):E).then(E=>d.walkTokens?Promise.all(this.walkTokens(E,d.walkTokens)).then(()=>E):E).then(E=>S(E,d)).then(E=>d.hooks?d.hooks.postprocess(E):E).catch(f);try{d.hooks&&(n=d.hooks.preprocess(n));let E=i(n,d);d.hooks&&(E=d.hooks.processAllTokens(E)),d.walkTokens&&this.walkTokens(E,d.walkTokens);let L=S(E,d);return d.hooks&&(L=d.hooks.postprocess(L)),L}catch(E){return f(E)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+s_(n.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(n);throw n}}},fb=new tte;function Gc(e,t){return fb.parse(e,t)}Gc.options=Gc.setOptions=function(e){return fb.setOptions(e),Gc.defaults=fb.defaults,b4(Gc.defaults),Gc};Gc.getDefaults=tD;Gc.defaults=wb;Gc.use=function(...e){return fb.use(...e),Gc.defaults=fb.defaults,b4(Gc.defaults),Gc};Gc.walkTokens=function(e,t){return fb.walkTokens(e,t)};Gc.parseInline=fb.parseInline;Gc.Parser=J_;Gc.parser=J_.parse;Gc.Renderer=e2;Gc.TextRenderer=cD;Gc.Lexer=Q_;Gc.lexer=Q_.lex;Gc.Tokenizer=JE;Gc.Hooks=lE;Gc.parse=Gc;Gc.options;Gc.setOptions;Gc.use;Gc.walkTokens;Gc.parseInline;J_.parse;Q_.lex;function D4(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var s=Array.from(typeof e=="string"?[e]:e);s[s.length-1]=s[s.length-1].replace(/\r?\n([\t ]*)$/,"");var a=s.reduce(function(i,S){var E=S.match(/\n([\t ]+|(?!\s).)/g);return E?i.concat(E.map(function(L){var F,G;return(G=(F=L.match(/[\t ]/g))===null||F===void 0?void 0:F.length)!==null&&G!==void 0?G:0})):i},[]);if(a.length){var d=new RegExp(`
[	 ]{`+Math.min.apply(Math,a)+"}","g");s=s.map(function(i){return i.replace(d,`
`)})}s[0]=s[0].replace(/^\r?\n/,"");var f=s[0];return t.forEach(function(i,S){var E=f.match(/(?:^|\n)( *)$/),L=E?E[1]:"",F=i;typeof i=="string"&&i.includes(`
`)&&(F=String(i).split(`
`).map(function(G,q){return q===0?G:""+L+G}).join(`
`)),f+=F+s[S+1]}),f}var ite={body:'<g><rect width="80" height="80" style="fill: #087ebf; stroke-width: 0px;"/><text transform="translate(21.16 64.67)" style="fill: #fff; font-family: ArialMT, Arial; font-size: 67.75px;"><tspan x="0" y="0">?</tspan></text></g>',height:80,width:80},tI=new Map,P4=new Map,rte=Ze(e=>{for(const t of e){if(!t.name)throw new Error('Invalid icon loader. Must have a "name" property with non-empty string value.');if(On.debug("Registering icon pack:",t.name),"loader"in t)P4.set(t.name,t.loader);else if("icons"in t)tI.set(t.name,t.icons);else throw On.error("Invalid icon loader:",t),new Error('Invalid icon loader. Must have either "icons" or "loader" property.')}},"registerIconPacks"),O4=Ze(async(e,t)=>{const n=nee(e,!0,t!==void 0);if(!n)throw new Error(`Invalid icon name: ${e}`);const s=n.prefix||t;if(!s)throw new Error(`Icon name must contain a prefix: ${e}`);let a=tI.get(s);if(!a){const f=P4.get(s);if(!f)throw new Error(`Icon set not found: ${n.prefix}`);try{a={...await f(),prefix:s},tI.set(s,a)}catch(i){throw On.error(i),new Error(`Failed to load icon set: ${n.prefix}`)}}const d=aee(a,n.name);if(!d)throw new Error(`Icon not found: ${e}`);return d},"getRegisteredIconData"),nte=Ze(async e=>{try{return await O4(e),!0}catch{return!1}},"isIconAvailable"),LT=Ze(async(e,t,n)=>{let s;try{s=await O4(e,t==null?void 0:t.fallbackPrefix)}catch(f){On.error(f),s=ite}const a=fee(s,t);return vee(_ee(a.body),{...a.attributes,...n})},"getIconSVG");function R4(e,{markdownAutoWrap:t}){const s=e.replace(/<br\/>/g,`
`).replace(/\n{2,}/g,`
`),a=D4(s);return t===!1?a.replace(/ /g,"&nbsp;"):a}Ze(R4,"preprocessMarkdown");function N4(e,t={}){const n=R4(e,t),s=Gc.lexer(n),a=[[]];let d=0;function f(i,S="normal"){i.type==="text"?i.text.split(`
`).forEach((L,F)=>{F!==0&&(d++,a.push([])),L.split(" ").forEach(G=>{G=G.replace(/&#39;/g,"'"),G&&a[d].push({content:G,type:S})})}):i.type==="strong"||i.type==="em"?i.tokens.forEach(E=>{f(E,i.type)}):i.type==="html"&&a[d].push({content:i.text,type:"normal"})}return Ze(f,"processNode"),s.forEach(i=>{var S;i.type==="paragraph"?(S=i.tokens)==null||S.forEach(E=>{f(E)}):i.type==="html"&&a[d].push({content:i.text,type:"normal"})}),a}Ze(N4,"markdownToLines");function B4(e,{markdownAutoWrap:t}={}){const n=Gc.lexer(e);function s(a){var d,f,i;return a.type==="text"?t===!1?a.text.replace(/\n */g,"<br/>").replace(/ /g,"&nbsp;"):a.text.replace(/\n */g,"<br/>"):a.type==="strong"?`<strong>${(d=a.tokens)==null?void 0:d.map(s).join("")}</strong>`:a.type==="em"?`<em>${(f=a.tokens)==null?void 0:f.map(s).join("")}</em>`:a.type==="paragraph"?`<p>${(i=a.tokens)==null?void 0:i.map(s).join("")}</p>`:a.type==="space"?"":a.type==="html"?`${a.text}`:a.type==="escape"?a.text:`Unsupported markdown: ${a.type}`}return Ze(s,"output"),n.map(s).join("")}Ze(B4,"markdownToHTML");function F4(e){return Intl.Segmenter?[...new Intl.Segmenter().segment(e)].map(t=>t.segment):[...e]}Ze(F4,"splitTextToChars");function z4(e,t){const n=F4(t.content);return hD(e,[],n,t.type)}Ze(z4,"splitWordToFitWidth");function hD(e,t,n,s){if(n.length===0)return[{content:t.join(""),type:s},{content:"",type:s}];const[a,...d]=n,f=[...t,a];return e([{content:f.join(""),type:s}])?hD(e,f,d,s):(t.length===0&&a&&(t.push(a),n.shift()),[{content:t.join(""),type:s},{content:n.join(""),type:s}])}Ze(hD,"splitWordToFitWidthRecursion");function U4(e,t){if(e.some(({content:n})=>n.includes(`
`)))throw new Error("splitLineToFitWidth does not support newlines in the line");return t2(e,t)}Ze(U4,"splitLineToFitWidth");function t2(e,t,n=[],s=[]){if(e.length===0)return s.length>0&&n.push(s),n.length>0?n:[];let a="";e[0].content===" "&&(a=" ",e.shift());const d=e.shift()??{content:" ",type:"normal"},f=[...s];if(a!==""&&f.push({content:a,type:"normal"}),f.push(d),t(f))return t2(e,t,n,f);if(s.length>0)n.push(s),e.unshift(d);else if(d.content){const[i,S]=z4(t,d);n.push([i]),S.content&&e.unshift(S)}return t2(e,t,n)}Ze(t2,"splitLineToFitWidthRecursion");function iI(e,t){t&&e.attr("style",t)}Ze(iI,"applyStyle");async function $4(e,t,n,s,a=!1){const d=e.append("foreignObject");d.attr("width",`${10*n}px`),d.attr("height",`${10*n}px`);const f=d.append("xhtml:div");let i=t.label;t.label&&U1(t.label)&&(i=await vL(t.label.replace(sw.lineBreakRegex,`
`),Bc()));const S=t.isNode?"nodeLabel":"edgeLabel",E=f.append("span");E.html(i),iI(E,t.labelStyle),E.attr("class",`${S} ${s}`),iI(f,t.labelStyle),f.style("display","table-cell"),f.style("white-space","nowrap"),f.style("line-height","1.5"),f.style("max-width",n+"px"),f.style("text-align","center"),f.attr("xmlns","http://www.w3.org/1999/xhtml"),a&&f.attr("class","labelBkg");let L=f.node().getBoundingClientRect();return L.width===n&&(f.style("display","table"),f.style("white-space","break-spaces"),f.style("width",n+"px"),L=f.node().getBoundingClientRect()),d.node()}Ze($4,"addHtmlSpan");function lk(e,t,n){return e.append("tspan").attr("class","text-outer-tspan").attr("x",0).attr("y",t*n-.1+"em").attr("dy",n+"em")}Ze(lk,"createTspan");function V4(e,t,n){const s=e.append("text"),a=lk(s,1,t);ck(a,n);const d=a.node().getComputedTextLength();return s.remove(),d}Ze(V4,"computeWidthOfText");function ste(e,t,n){var f;const s=e.append("text"),a=lk(s,1,t);ck(a,[{content:n,type:"normal"}]);const d=(f=a.node())==null?void 0:f.getBoundingClientRect();return d&&s.remove(),d}Ze(ste,"computeDimensionOfText");function W4(e,t,n,s=!1){const d=t.append("g"),f=d.insert("rect").attr("class","background").attr("style","stroke: none"),i=d.append("text").attr("y","-10.1");let S=0;for(const E of n){const L=Ze(G=>V4(d,1.1,G)<=e,"checkWidth"),F=L(E)?[E]:U4(E,L);for(const G of F){const q=lk(i,S,1.1);ck(q,G),S++}}if(s){const E=i.node().getBBox(),L=2;return f.attr("x",E.x-L).attr("y",E.y-L).attr("width",E.width+2*L).attr("height",E.height+2*L),d.node()}else return i.node()}Ze(W4,"createFormattedText");function ck(e,t){e.text(""),t.forEach((n,s)=>{const a=e.append("tspan").attr("font-style",n.type==="em"?"italic":"normal").attr("class","text-inner-tspan").attr("font-weight",n.type==="strong"?"bold":"normal");s===0?a.text(n.content):a.text(" "+n.content)})}Ze(ck,"updateTextContentAndStyles");async function j4(e){const t=[];e.replace(/(fa[bklrs]?):fa-([\w-]+)/g,(s,a,d)=>(t.push((async()=>{const f=`${a}:${d}`;return await nte(f)?await LT(f,void 0,{class:"label-icon"}):`<i class='${G2(s).replace(":"," ")}'></i>`})()),s));const n=await Promise.all(t);return e.replace(/(fa[bklrs]?):fa-([\w-]+)/g,()=>n.shift()??"")}Ze(j4,"replaceIconSubstring");var ux=Ze(async(e,t="",{style:n="",isTitle:s=!1,classes:a="",useHtmlLabels:d=!0,isNode:f=!0,width:i=200,addSvgBackground:S=!1}={},E)=>{if(On.debug("XYZ createText",t,n,s,a,d,f,"addSvgBackground: ",S),d){const L=B4(t,E),F=await j4(bb(L)),G=t.replace(/\\\\/g,"\\"),q={isNode:f,label:U1(t)?G:F,labelStyle:n.replace("fill:","color:")};return await $4(e,q,i,a,S)}else{const L=t.replace(/<br\s*\/?>/g,"<br/>"),F=N4(L.replace("<br>","<br/>"),E),G=W4(i,e,F,t?S:!1);if(f){/stroke:/.exec(n)&&(n=n.replace("stroke:","lineColor:"));const q=n.replace(/stroke:[^;]+;?/g,"").replace(/stroke-width:[^;]+;?/g,"").replace(/fill:[^;]+;?/g,"").replace(/color:/g,"fill:");mc(G).attr("style",q)}else{const q=n.replace(/stroke:[^;]+;?/g,"").replace(/stroke-width:[^;]+;?/g,"").replace(/fill:[^;]+;?/g,"").replace(/background:/g,"fill:");mc(G).select("rect").attr("style",q.replace(/background:/g,"fill:"));const Q=n.replace(/stroke:[^;]+;?/g,"").replace(/stroke-width:[^;]+;?/g,"").replace(/fill:[^;]+;?/g,"").replace(/color:/g,"fill:");mc(G).select("text").attr("style",Q)}return G}},"createText");function IA(e,t,n){if(e&&e.length){const[s,a]=t,d=Math.PI/180*n,f=Math.cos(d),i=Math.sin(d);for(const S of e){const[E,L]=S;S[0]=(E-s)*f-(L-a)*i+s,S[1]=(E-s)*i+(L-a)*f+a}}}function ote(e,t){return e[0]===t[0]&&e[1]===t[1]}function ate(e,t,n,s=1){const a=n,d=Math.max(t,.1),f=e[0]&&e[0][0]&&typeof e[0][0]=="number"?[e]:e,i=[0,0];if(a)for(const E of f)IA(E,i,a);const S=function(E,L,F){const G=[];for(const le of E){const Se=[...le];ote(Se[0],Se[Se.length-1])||Se.push([Se[0][0],Se[0][1]]),Se.length>2&&G.push(Se)}const q=[];L=Math.max(L,.1);const Q=[];for(const le of G)for(let Se=0;Se<le.length-1;Se++){const ke=le[Se],Ee=le[Se+1];if(ke[1]!==Ee[1]){const Ie=Math.min(ke[1],Ee[1]);Q.push({ymin:Ie,ymax:Math.max(ke[1],Ee[1]),x:Ie===ke[1]?ke[0]:Ee[0],islope:(Ee[0]-ke[0])/(Ee[1]-ke[1])})}}if(Q.sort((le,Se)=>le.ymin<Se.ymin?-1:le.ymin>Se.ymin?1:le.x<Se.x?-1:le.x>Se.x?1:le.ymax===Se.ymax?0:(le.ymax-Se.ymax)/Math.abs(le.ymax-Se.ymax)),!Q.length)return q;let te=[],he=Q[0].ymin,fe=0;for(;te.length||Q.length;){if(Q.length){let le=-1;for(let Se=0;Se<Q.length&&!(Q[Se].ymin>he);Se++)le=Se;Q.splice(0,le+1).forEach(Se=>{te.push({s:he,edge:Se})})}if(te=te.filter(le=>!(le.edge.ymax<=he)),te.sort((le,Se)=>le.edge.x===Se.edge.x?0:(le.edge.x-Se.edge.x)/Math.abs(le.edge.x-Se.edge.x)),(F!==1||fe%L==0)&&te.length>1)for(let le=0;le<te.length;le+=2){const Se=le+1;if(Se>=te.length)break;const ke=te[le].edge,Ee=te[Se].edge;q.push([[Math.round(ke.x),he],[Math.round(Ee.x),he]])}he+=F,te.forEach(le=>{le.edge.x=le.edge.x+F*le.edge.islope}),fe++}return q}(f,d,s);if(a){for(const E of f)IA(E,i,-a);(function(E,L,F){const G=[];E.forEach(q=>G.push(...q)),IA(G,L,F)})(S,i,-a)}return S}function DT(e,t){var n;const s=t.hachureAngle+90;let a=t.hachureGap;a<0&&(a=4*t.strokeWidth),a=Math.round(Math.max(a,.1));let d=1;return t.roughness>=1&&(((n=t.randomizer)===null||n===void 0?void 0:n.next())||Math.random())>.7&&(d=a),ate(e,a,s,d||1)}class uD{constructor(t){this.helper=t}fillPolygons(t,n){return this._fillPolygons(t,n)}_fillPolygons(t,n){const s=DT(t,n);return{type:"fillSketch",ops:this.renderLines(s,n)}}renderLines(t,n){const s=[];for(const a of t)s.push(...this.helper.doubleLineOps(a[0][0],a[0][1],a[1][0],a[1][1],n));return s}}function hk(e){const t=e[0],n=e[1];return Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2))}let lte=class extends uD{fillPolygons(t,n){let s=n.hachureGap;s<0&&(s=4*n.strokeWidth),s=Math.max(s,.1);const a=DT(t,Object.assign({},n,{hachureGap:s})),d=Math.PI/180*n.hachureAngle,f=[],i=.5*s*Math.cos(d),S=.5*s*Math.sin(d);for(const[E,L]of a)hk([E,L])&&f.push([[E[0]-i,E[1]+S],[...L]],[[E[0]+i,E[1]-S],[...L]]);return{type:"fillSketch",ops:this.renderLines(f,n)}}},cte=class extends uD{fillPolygons(t,n){const s=this._fillPolygons(t,n),a=Object.assign({},n,{hachureAngle:n.hachureAngle+90}),d=this._fillPolygons(t,a);return s.ops=s.ops.concat(d.ops),s}},hte=class{constructor(t){this.helper=t}fillPolygons(t,n){const s=DT(t,n=Object.assign({},n,{hachureAngle:0}));return this.dotsOnLines(s,n)}dotsOnLines(t,n){const s=[];let a=n.hachureGap;a<0&&(a=4*n.strokeWidth),a=Math.max(a,.1);let d=n.fillWeight;d<0&&(d=n.strokeWidth/2);const f=a/4;for(const i of t){const S=hk(i),E=S/a,L=Math.ceil(E)-1,F=S-L*a,G=(i[0][0]+i[1][0])/2-a/4,q=Math.min(i[0][1],i[1][1]);for(let Q=0;Q<L;Q++){const te=q+F+Q*a,he=G-f+2*Math.random()*f,fe=te-f+2*Math.random()*f,le=this.helper.ellipse(he,fe,d,d,n);s.push(...le.ops)}}return{type:"fillSketch",ops:s}}},ute=class{constructor(t){this.helper=t}fillPolygons(t,n){const s=DT(t,n);return{type:"fillSketch",ops:this.dashedLine(s,n)}}dashedLine(t,n){const s=n.dashOffset<0?n.hachureGap<0?4*n.strokeWidth:n.hachureGap:n.dashOffset,a=n.dashGap<0?n.hachureGap<0?4*n.strokeWidth:n.hachureGap:n.dashGap,d=[];return t.forEach(f=>{const i=hk(f),S=Math.floor(i/(s+a)),E=(i+a-S*(s+a))/2;let L=f[0],F=f[1];L[0]>F[0]&&(L=f[1],F=f[0]);const G=Math.atan((F[1]-L[1])/(F[0]-L[0]));for(let q=0;q<S;q++){const Q=q*(s+a),te=Q+s,he=[L[0]+Q*Math.cos(G)+E*Math.cos(G),L[1]+Q*Math.sin(G)+E*Math.sin(G)],fe=[L[0]+te*Math.cos(G)+E*Math.cos(G),L[1]+te*Math.sin(G)+E*Math.sin(G)];d.push(...this.helper.doubleLineOps(he[0],he[1],fe[0],fe[1],n))}}),d}};class dte{constructor(t){this.helper=t}fillPolygons(t,n){const s=n.hachureGap<0?4*n.strokeWidth:n.hachureGap,a=n.zigzagOffset<0?s:n.zigzagOffset,d=DT(t,n=Object.assign({},n,{hachureGap:s+a}));return{type:"fillSketch",ops:this.zigzagLines(d,a,n)}}zigzagLines(t,n,s){const a=[];return t.forEach(d=>{const f=hk(d),i=Math.round(f/(2*n));let S=d[0],E=d[1];S[0]>E[0]&&(S=d[1],E=d[0]);const L=Math.atan((E[1]-S[1])/(E[0]-S[0]));for(let F=0;F<i;F++){const G=2*F*n,q=2*(F+1)*n,Q=Math.sqrt(2*Math.pow(n,2)),te=[S[0]+G*Math.cos(L),S[1]+G*Math.sin(L)],he=[S[0]+q*Math.cos(L),S[1]+q*Math.sin(L)],fe=[te[0]+Q*Math.cos(L+Math.PI/4),te[1]+Q*Math.sin(L+Math.PI/4)];a.push(...this.helper.doubleLineOps(te[0],te[1],fe[0],fe[1],s),...this.helper.doubleLineOps(fe[0],fe[1],he[0],he[1],s))}}),a}}const rg={};let pte=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}};const fte=0,LA=1,UR=2,PC={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function DA(e,t){return e.type===t}function dD(e){const t=[],n=function(f){const i=new Array;for(;f!=="";)if(f.match(/^([ \t\r\n,]+)/))f=f.substr(RegExp.$1.length);else if(f.match(/^([aAcChHlLmMqQsStTvVzZ])/))i[i.length]={type:fte,text:RegExp.$1},f=f.substr(RegExp.$1.length);else{if(!f.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];i[i.length]={type:LA,text:`${parseFloat(RegExp.$1)}`},f=f.substr(RegExp.$1.length)}return i[i.length]={type:UR,text:""},i}(e);let s="BOD",a=0,d=n[a];for(;!DA(d,UR);){let f=0;const i=[];if(s==="BOD"){if(d.text!=="M"&&d.text!=="m")return dD("M0,0"+e);a++,f=PC[d.text],s=d.text}else DA(d,LA)?f=PC[s]:(a++,f=PC[d.text],s=d.text);if(!(a+f<n.length))throw new Error("Path data ended short");for(let S=a;S<a+f;S++){const E=n[S];if(!DA(E,LA))throw new Error("Param not a number: "+s+","+E.text);i[i.length]=+E.text}if(typeof PC[s]!="number")throw new Error("Bad segment: "+s);{const S={key:s,data:i};t.push(S),a+=f,d=n[a],s==="M"&&(s="L"),s==="m"&&(s="l")}}return t}function H4(e){let t=0,n=0,s=0,a=0;const d=[];for(const{key:f,data:i}of e)switch(f){case"M":d.push({key:"M",data:[...i]}),[t,n]=i,[s,a]=i;break;case"m":t+=i[0],n+=i[1],d.push({key:"M",data:[t,n]}),s=t,a=n;break;case"L":d.push({key:"L",data:[...i]}),[t,n]=i;break;case"l":t+=i[0],n+=i[1],d.push({key:"L",data:[t,n]});break;case"C":d.push({key:"C",data:[...i]}),t=i[4],n=i[5];break;case"c":{const S=i.map((E,L)=>L%2?E+n:E+t);d.push({key:"C",data:S}),t=S[4],n=S[5];break}case"Q":d.push({key:"Q",data:[...i]}),t=i[2],n=i[3];break;case"q":{const S=i.map((E,L)=>L%2?E+n:E+t);d.push({key:"Q",data:S}),t=S[2],n=S[3];break}case"A":d.push({key:"A",data:[...i]}),t=i[5],n=i[6];break;case"a":t+=i[5],n+=i[6],d.push({key:"A",data:[i[0],i[1],i[2],i[3],i[4],t,n]});break;case"H":d.push({key:"H",data:[...i]}),t=i[0];break;case"h":t+=i[0],d.push({key:"H",data:[t]});break;case"V":d.push({key:"V",data:[...i]}),n=i[0];break;case"v":n+=i[0],d.push({key:"V",data:[n]});break;case"S":d.push({key:"S",data:[...i]}),t=i[2],n=i[3];break;case"s":{const S=i.map((E,L)=>L%2?E+n:E+t);d.push({key:"S",data:S}),t=S[2],n=S[3];break}case"T":d.push({key:"T",data:[...i]}),t=i[0],n=i[1];break;case"t":t+=i[0],n+=i[1],d.push({key:"T",data:[t,n]});break;case"Z":case"z":d.push({key:"Z",data:[]}),t=s,n=a}return d}function G4(e){const t=[];let n="",s=0,a=0,d=0,f=0,i=0,S=0;for(const{key:E,data:L}of e){switch(E){case"M":t.push({key:"M",data:[...L]}),[s,a]=L,[d,f]=L;break;case"C":t.push({key:"C",data:[...L]}),s=L[4],a=L[5],i=L[2],S=L[3];break;case"L":t.push({key:"L",data:[...L]}),[s,a]=L;break;case"H":s=L[0],t.push({key:"L",data:[s,a]});break;case"V":a=L[0],t.push({key:"L",data:[s,a]});break;case"S":{let F=0,G=0;n==="C"||n==="S"?(F=s+(s-i),G=a+(a-S)):(F=s,G=a),t.push({key:"C",data:[F,G,...L]}),i=L[0],S=L[1],s=L[2],a=L[3];break}case"T":{const[F,G]=L;let q=0,Q=0;n==="Q"||n==="T"?(q=s+(s-i),Q=a+(a-S)):(q=s,Q=a);const te=s+2*(q-s)/3,he=a+2*(Q-a)/3,fe=F+2*(q-F)/3,le=G+2*(Q-G)/3;t.push({key:"C",data:[te,he,fe,le,F,G]}),i=q,S=Q,s=F,a=G;break}case"Q":{const[F,G,q,Q]=L,te=s+2*(F-s)/3,he=a+2*(G-a)/3,fe=q+2*(F-q)/3,le=Q+2*(G-Q)/3;t.push({key:"C",data:[te,he,fe,le,q,Q]}),i=F,S=G,s=q,a=Q;break}case"A":{const F=Math.abs(L[0]),G=Math.abs(L[1]),q=L[2],Q=L[3],te=L[4],he=L[5],fe=L[6];F===0||G===0?(t.push({key:"C",data:[s,a,he,fe,he,fe]}),s=he,a=fe):(s!==he||a!==fe)&&(q4(s,a,he,fe,F,G,q,Q,te).forEach(function(le){t.push({key:"C",data:le})}),s=he,a=fe);break}case"Z":t.push({key:"Z",data:[]}),s=d,a=f}n=E}return t}function hS(e,t,n){return[e*Math.cos(n)-t*Math.sin(n),e*Math.sin(n)+t*Math.cos(n)]}function q4(e,t,n,s,a,d,f,i,S,E){const L=(F=f,Math.PI*F/180);var F;let G=[],q=0,Q=0,te=0,he=0;if(E)[q,Q,te,he]=E;else{[e,t]=hS(e,t,-L),[n,s]=hS(n,s,-L);const Ot=(e-n)/2,Ae=(t-s)/2;let mt=Ot*Ot/(a*a)+Ae*Ae/(d*d);mt>1&&(mt=Math.sqrt(mt),a*=mt,d*=mt);const bt=a*a,Dt=d*d,Je=bt*Dt-bt*Ae*Ae-Dt*Ot*Ot,dt=bt*Ae*Ae+Dt*Ot*Ot,ui=(i===S?-1:1)*Math.sqrt(Math.abs(Je/dt));te=ui*a*Ae/d+(e+n)/2,he=ui*-d*Ot/a+(t+s)/2,q=Math.asin(parseFloat(((t-he)/d).toFixed(9))),Q=Math.asin(parseFloat(((s-he)/d).toFixed(9))),e<te&&(q=Math.PI-q),n<te&&(Q=Math.PI-Q),q<0&&(q=2*Math.PI+q),Q<0&&(Q=2*Math.PI+Q),S&&q>Q&&(q-=2*Math.PI),!S&&Q>q&&(Q-=2*Math.PI)}let fe=Q-q;if(Math.abs(fe)>120*Math.PI/180){const Ot=Q,Ae=n,mt=s;Q=S&&Q>q?q+120*Math.PI/180*1:q+120*Math.PI/180*-1,G=q4(n=te+a*Math.cos(Q),s=he+d*Math.sin(Q),Ae,mt,a,d,f,0,S,[Q,Ot,te,he])}fe=Q-q;const le=Math.cos(q),Se=Math.sin(q),ke=Math.cos(Q),Ee=Math.sin(Q),Ie=Math.tan(fe/4),He=4/3*a*Ie,Ye=4/3*d*Ie,lt=[e,t],Pt=[e+He*Se,t-Ye*le],At=[n+He*Ee,s-Ye*ke],ht=[n,s];if(Pt[0]=2*lt[0]-Pt[0],Pt[1]=2*lt[1]-Pt[1],E)return[Pt,At,ht].concat(G);{G=[Pt,At,ht].concat(G);const Ot=[];for(let Ae=0;Ae<G.length;Ae+=3){const mt=hS(G[Ae][0],G[Ae][1],L),bt=hS(G[Ae+1][0],G[Ae+1][1],L),Dt=hS(G[Ae+2][0],G[Ae+2][1],L);Ot.push([mt[0],mt[1],bt[0],bt[1],Dt[0],Dt[1]])}return Ot}}const mte={randOffset:function(e,t){return aa(e,t)},randOffsetWithRange:function(e,t,n){return i2(e,t,n)},ellipse:function(e,t,n,s,a){const d=X4(n,s,a);return rI(e,t,a,d).opset},doubleLineOps:function(e,t,n,s,a){return ax(e,t,n,s,a,!0)}};function Y4(e,t,n,s,a){return{type:"path",ops:ax(e,t,n,s,a)}}function cE(e,t,n){const s=(e||[]).length;if(s>2){const a=[];for(let d=0;d<s-1;d++)a.push(...ax(e[d][0],e[d][1],e[d+1][0],e[d+1][1],n));return t&&a.push(...ax(e[s-1][0],e[s-1][1],e[0][0],e[0][1],n)),{type:"path",ops:a}}return s===2?Y4(e[0][0],e[0][1],e[1][0],e[1][1],n):{type:"path",ops:[]}}function gte(e,t,n,s,a){return function(d,f){return cE(d,!0,f)}([[e,t],[e+n,t],[e+n,t+s],[e,t+s]],a)}function $R(e,t){if(e.length){const n=typeof e[0][0]=="number"?[e]:e,s=OC(n[0],1*(1+.2*t.roughness),t),a=t.disableMultiStroke?[]:OC(n[0],1.5*(1+.22*t.roughness),jR(t));for(let d=1;d<n.length;d++){const f=n[d];if(f.length){const i=OC(f,1*(1+.2*t.roughness),t),S=t.disableMultiStroke?[]:OC(f,1.5*(1+.22*t.roughness),jR(t));for(const E of i)E.op!=="move"&&s.push(E);for(const E of S)E.op!=="move"&&a.push(E)}}return{type:"path",ops:s.concat(a)}}return{type:"path",ops:[]}}function X4(e,t,n){const s=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(e/2,2)+Math.pow(t/2,2))/2)),a=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*s)),d=2*Math.PI/a;let f=Math.abs(e/2),i=Math.abs(t/2);const S=1-n.curveFitting;return f+=aa(f*S,n),i+=aa(i*S,n),{increment:d,rx:f,ry:i}}function rI(e,t,n,s){const[a,d]=HR(s.increment,e,t,s.rx,s.ry,1,s.increment*i2(.1,i2(.4,1,n),n),n);let f=r2(a,null,n);if(!n.disableMultiStroke&&n.roughness!==0){const[i]=HR(s.increment,e,t,s.rx,s.ry,1.5,0,n),S=r2(i,null,n);f=f.concat(S)}return{estimatedPoints:d,opset:{type:"path",ops:f}}}function VR(e,t,n,s,a,d,f,i,S){const E=e,L=t;let F=Math.abs(n/2),G=Math.abs(s/2);F+=aa(.01*F,S),G+=aa(.01*G,S);let q=a,Q=d;for(;q<0;)q+=2*Math.PI,Q+=2*Math.PI;Q-q>2*Math.PI&&(q=0,Q=2*Math.PI);const te=2*Math.PI/S.curveStepCount,he=Math.min(te/2,(Q-q)/2),fe=GR(he,E,L,F,G,q,Q,1,S);if(!S.disableMultiStroke){const le=GR(he,E,L,F,G,q,Q,1.5,S);fe.push(...le)}return f&&(i?fe.push(...ax(E,L,E+F*Math.cos(q),L+G*Math.sin(q),S),...ax(E,L,E+F*Math.cos(Q),L+G*Math.sin(Q),S)):fe.push({op:"lineTo",data:[E,L]},{op:"lineTo",data:[E+F*Math.cos(q),L+G*Math.sin(q)]})),{type:"path",ops:fe}}function WR(e,t){const n=G4(H4(dD(e))),s=[];let a=[0,0],d=[0,0];for(const{key:f,data:i}of n)switch(f){case"M":d=[i[0],i[1]],a=[i[0],i[1]];break;case"L":s.push(...ax(d[0],d[1],i[0],i[1],t)),d=[i[0],i[1]];break;case"C":{const[S,E,L,F,G,q]=i;s.push(...yte(S,E,L,F,G,q,d,t)),d=[G,q];break}case"Z":s.push(...ax(d[0],d[1],a[0],a[1],t)),d=[a[0],a[1]]}return{type:"path",ops:s}}function PA(e,t){const n=[];for(const s of e)if(s.length){const a=t.maxRandomnessOffset||0,d=s.length;if(d>2){n.push({op:"move",data:[s[0][0]+aa(a,t),s[0][1]+aa(a,t)]});for(let f=1;f<d;f++)n.push({op:"lineTo",data:[s[f][0]+aa(a,t),s[f][1]+aa(a,t)]})}}return{type:"fillPath",ops:n}}function d1(e,t){return function(n,s){let a=n.fillStyle||"hachure";if(!rg[a])switch(a){case"zigzag":rg[a]||(rg[a]=new lte(s));break;case"cross-hatch":rg[a]||(rg[a]=new cte(s));break;case"dots":rg[a]||(rg[a]=new hte(s));break;case"dashed":rg[a]||(rg[a]=new ute(s));break;case"zigzag-line":rg[a]||(rg[a]=new dte(s));break;default:a="hachure",rg[a]||(rg[a]=new uD(s))}return rg[a]}(t,mte).fillPolygons(e,t)}function jR(e){const t=Object.assign({},e);return t.randomizer=void 0,e.seed&&(t.seed=e.seed+1),t}function Z4(e){return e.randomizer||(e.randomizer=new pte(e.seed||0)),e.randomizer.next()}function i2(e,t,n,s=1){return n.roughness*s*(Z4(n)*(t-e)+e)}function aa(e,t,n=1){return i2(-e,e,t,n)}function ax(e,t,n,s,a,d=!1){const f=d?a.disableMultiStrokeFill:a.disableMultiStroke,i=nI(e,t,n,s,a,!0,!1);if(f)return i;const S=nI(e,t,n,s,a,!0,!0);return i.concat(S)}function nI(e,t,n,s,a,d,f){const i=Math.pow(e-n,2)+Math.pow(t-s,2),S=Math.sqrt(i);let E=1;E=S<200?1:S>500?.4:-.0016668*S+1.233334;let L=a.maxRandomnessOffset||0;L*L*100>i&&(L=S/10);const F=L/2,G=.2+.2*Z4(a);let q=a.bowing*a.maxRandomnessOffset*(s-t)/200,Q=a.bowing*a.maxRandomnessOffset*(e-n)/200;q=aa(q,a,E),Q=aa(Q,a,E);const te=[],he=()=>aa(F,a,E),fe=()=>aa(L,a,E),le=a.preserveVertices;return d&&(f?te.push({op:"move",data:[e+(le?0:he()),t+(le?0:he())]}):te.push({op:"move",data:[e+(le?0:aa(L,a,E)),t+(le?0:aa(L,a,E))]})),f?te.push({op:"bcurveTo",data:[q+e+(n-e)*G+he(),Q+t+(s-t)*G+he(),q+e+2*(n-e)*G+he(),Q+t+2*(s-t)*G+he(),n+(le?0:he()),s+(le?0:he())]}):te.push({op:"bcurveTo",data:[q+e+(n-e)*G+fe(),Q+t+(s-t)*G+fe(),q+e+2*(n-e)*G+fe(),Q+t+2*(s-t)*G+fe(),n+(le?0:fe()),s+(le?0:fe())]}),te}function OC(e,t,n){if(!e.length)return[];const s=[];s.push([e[0][0]+aa(t,n),e[0][1]+aa(t,n)]),s.push([e[0][0]+aa(t,n),e[0][1]+aa(t,n)]);for(let a=1;a<e.length;a++)s.push([e[a][0]+aa(t,n),e[a][1]+aa(t,n)]),a===e.length-1&&s.push([e[a][0]+aa(t,n),e[a][1]+aa(t,n)]);return r2(s,null,n)}function r2(e,t,n){const s=e.length,a=[];if(s>3){const d=[],f=1-n.curveTightness;a.push({op:"move",data:[e[1][0],e[1][1]]});for(let i=1;i+2<s;i++){const S=e[i];d[0]=[S[0],S[1]],d[1]=[S[0]+(f*e[i+1][0]-f*e[i-1][0])/6,S[1]+(f*e[i+1][1]-f*e[i-1][1])/6],d[2]=[e[i+1][0]+(f*e[i][0]-f*e[i+2][0])/6,e[i+1][1]+(f*e[i][1]-f*e[i+2][1])/6],d[3]=[e[i+1][0],e[i+1][1]],a.push({op:"bcurveTo",data:[d[1][0],d[1][1],d[2][0],d[2][1],d[3][0],d[3][1]]})}if(t&&t.length===2){const i=n.maxRandomnessOffset;a.push({op:"lineTo",data:[t[0]+aa(i,n),t[1]+aa(i,n)]})}}else s===3?(a.push({op:"move",data:[e[1][0],e[1][1]]}),a.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):s===2&&a.push(...nI(e[0][0],e[0][1],e[1][0],e[1][1],n,!0,!0));return a}function HR(e,t,n,s,a,d,f,i){const S=[],E=[];if(i.roughness===0){e/=4,E.push([t+s*Math.cos(-e),n+a*Math.sin(-e)]);for(let L=0;L<=2*Math.PI;L+=e){const F=[t+s*Math.cos(L),n+a*Math.sin(L)];S.push(F),E.push(F)}E.push([t+s*Math.cos(0),n+a*Math.sin(0)]),E.push([t+s*Math.cos(e),n+a*Math.sin(e)])}else{const L=aa(.5,i)-Math.PI/2;E.push([aa(d,i)+t+.9*s*Math.cos(L-e),aa(d,i)+n+.9*a*Math.sin(L-e)]);const F=2*Math.PI+L-.01;for(let G=L;G<F;G+=e){const q=[aa(d,i)+t+s*Math.cos(G),aa(d,i)+n+a*Math.sin(G)];S.push(q),E.push(q)}E.push([aa(d,i)+t+s*Math.cos(L+2*Math.PI+.5*f),aa(d,i)+n+a*Math.sin(L+2*Math.PI+.5*f)]),E.push([aa(d,i)+t+.98*s*Math.cos(L+f),aa(d,i)+n+.98*a*Math.sin(L+f)]),E.push([aa(d,i)+t+.9*s*Math.cos(L+.5*f),aa(d,i)+n+.9*a*Math.sin(L+.5*f)])}return[E,S]}function GR(e,t,n,s,a,d,f,i,S){const E=d+aa(.1,S),L=[];L.push([aa(i,S)+t+.9*s*Math.cos(E-e),aa(i,S)+n+.9*a*Math.sin(E-e)]);for(let F=E;F<=f;F+=e)L.push([aa(i,S)+t+s*Math.cos(F),aa(i,S)+n+a*Math.sin(F)]);return L.push([t+s*Math.cos(f),n+a*Math.sin(f)]),L.push([t+s*Math.cos(f),n+a*Math.sin(f)]),r2(L,null,S)}function yte(e,t,n,s,a,d,f,i){const S=[],E=[i.maxRandomnessOffset||1,(i.maxRandomnessOffset||1)+.3];let L=[0,0];const F=i.disableMultiStroke?1:2,G=i.preserveVertices;for(let q=0;q<F;q++)q===0?S.push({op:"move",data:[f[0],f[1]]}):S.push({op:"move",data:[f[0]+(G?0:aa(E[0],i)),f[1]+(G?0:aa(E[0],i))]}),L=G?[a,d]:[a+aa(E[q],i),d+aa(E[q],i)],S.push({op:"bcurveTo",data:[e+aa(E[q],i),t+aa(E[q],i),n+aa(E[q],i),s+aa(E[q],i),L[0],L[1]]});return S}function uS(e){return[...e]}function qR(e,t=0){const n=e.length;if(n<3)throw new Error("A curve must have at least three points.");const s=[];if(n===3)s.push(uS(e[0]),uS(e[1]),uS(e[2]),uS(e[2]));else{const a=[];a.push(e[0],e[0]);for(let i=1;i<e.length;i++)a.push(e[i]),i===e.length-1&&a.push(e[i]);const d=[],f=1-t;s.push(uS(a[0]));for(let i=1;i+2<a.length;i++){const S=a[i];d[0]=[S[0],S[1]],d[1]=[S[0]+(f*a[i+1][0]-f*a[i-1][0])/6,S[1]+(f*a[i+1][1]-f*a[i-1][1])/6],d[2]=[a[i+1][0]+(f*a[i][0]-f*a[i+2][0])/6,a[i+1][1]+(f*a[i][1]-f*a[i+2][1])/6],d[3]=[a[i+1][0],a[i+1][1]],s.push(d[1],d[2],d[3])}}return s}function hE(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function _te(e,t,n){const s=hE(t,n);if(s===0)return hE(e,t);let a=((e[0]-t[0])*(n[0]-t[0])+(e[1]-t[1])*(n[1]-t[1]))/s;return a=Math.max(0,Math.min(1,a)),hE(e,Yx(t,n,a))}function Yx(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n]}function sI(e,t,n,s){const a=s||[];if(function(i,S){const E=i[S+0],L=i[S+1],F=i[S+2],G=i[S+3];let q=3*L[0]-2*E[0]-G[0];q*=q;let Q=3*L[1]-2*E[1]-G[1];Q*=Q;let te=3*F[0]-2*G[0]-E[0];te*=te;let he=3*F[1]-2*G[1]-E[1];return he*=he,q<te&&(q=te),Q<he&&(Q=he),q+Q}(e,t)<n){const i=e[t+0];a.length?(d=a[a.length-1],f=i,Math.sqrt(hE(d,f))>1&&a.push(i)):a.push(i),a.push(e[t+3])}else{const S=e[t+0],E=e[t+1],L=e[t+2],F=e[t+3],G=Yx(S,E,.5),q=Yx(E,L,.5),Q=Yx(L,F,.5),te=Yx(G,q,.5),he=Yx(q,Q,.5),fe=Yx(te,he,.5);sI([S,G,te,fe],0,n,a),sI([fe,he,Q,F],0,n,a)}var d,f;return a}function vte(e,t){return n2(e,0,e.length,t)}function n2(e,t,n,s,a){const d=a||[],f=e[t],i=e[n-1];let S=0,E=1;for(let L=t+1;L<n-1;++L){const F=_te(e[L],f,i);F>S&&(S=F,E=L)}return Math.sqrt(S)>s?(n2(e,t,E+1,s,d),n2(e,E,n,s,d)):(d.length||d.push(f),d.push(i)),d}function OA(e,t=.15,n){const s=[],a=(e.length-1)/3;for(let d=0;d<a;d++)sI(e,3*d,t,s);return n&&n>0?n2(s,0,s.length,n):s}const Hg="none";let s2=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,n,s){return{shape:t,sets:n||[],options:s||this.defaultOptions}}line(t,n,s,a,d){const f=this._o(d);return this._d("line",[Y4(t,n,s,a,f)],f)}rectangle(t,n,s,a,d){const f=this._o(d),i=[],S=gte(t,n,s,a,f);if(f.fill){const E=[[t,n],[t+s,n],[t+s,n+a],[t,n+a]];f.fillStyle==="solid"?i.push(PA([E],f)):i.push(d1([E],f))}return f.stroke!==Hg&&i.push(S),this._d("rectangle",i,f)}ellipse(t,n,s,a,d){const f=this._o(d),i=[],S=X4(s,a,f),E=rI(t,n,f,S);if(f.fill)if(f.fillStyle==="solid"){const L=rI(t,n,f,S).opset;L.type="fillPath",i.push(L)}else i.push(d1([E.estimatedPoints],f));return f.stroke!==Hg&&i.push(E.opset),this._d("ellipse",i,f)}circle(t,n,s,a){const d=this.ellipse(t,n,s,s,a);return d.shape="circle",d}linearPath(t,n){const s=this._o(n);return this._d("linearPath",[cE(t,!1,s)],s)}arc(t,n,s,a,d,f,i=!1,S){const E=this._o(S),L=[],F=VR(t,n,s,a,d,f,i,!0,E);if(i&&E.fill)if(E.fillStyle==="solid"){const G=Object.assign({},E);G.disableMultiStroke=!0;const q=VR(t,n,s,a,d,f,!0,!1,G);q.type="fillPath",L.push(q)}else L.push(function(G,q,Q,te,he,fe,le){const Se=G,ke=q;let Ee=Math.abs(Q/2),Ie=Math.abs(te/2);Ee+=aa(.01*Ee,le),Ie+=aa(.01*Ie,le);let He=he,Ye=fe;for(;He<0;)He+=2*Math.PI,Ye+=2*Math.PI;Ye-He>2*Math.PI&&(He=0,Ye=2*Math.PI);const lt=(Ye-He)/le.curveStepCount,Pt=[];for(let At=He;At<=Ye;At+=lt)Pt.push([Se+Ee*Math.cos(At),ke+Ie*Math.sin(At)]);return Pt.push([Se+Ee*Math.cos(Ye),ke+Ie*Math.sin(Ye)]),Pt.push([Se,ke]),d1([Pt],le)}(t,n,s,a,d,f,E));return E.stroke!==Hg&&L.push(F),this._d("arc",L,E)}curve(t,n){const s=this._o(n),a=[],d=$R(t,s);if(s.fill&&s.fill!==Hg)if(s.fillStyle==="solid"){const f=$R(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));a.push({type:"fillPath",ops:this._mergedShape(f.ops)})}else{const f=[],i=t;if(i.length){const S=typeof i[0][0]=="number"?[i]:i;for(const E of S)E.length<3?f.push(...E):E.length===3?f.push(...OA(qR([E[0],E[0],E[1],E[2]]),10,(1+s.roughness)/2)):f.push(...OA(qR(E),10,(1+s.roughness)/2))}f.length&&a.push(d1([f],s))}return s.stroke!==Hg&&a.push(d),this._d("curve",a,s)}polygon(t,n){const s=this._o(n),a=[],d=cE(t,!0,s);return s.fill&&(s.fillStyle==="solid"?a.push(PA([t],s)):a.push(d1([t],s))),s.stroke!==Hg&&a.push(d),this._d("polygon",a,s)}path(t,n){const s=this._o(n),a=[];if(!t)return this._d("path",a,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const d=s.fill&&s.fill!=="transparent"&&s.fill!==Hg,f=s.stroke!==Hg,i=!!(s.simplification&&s.simplification<1),S=function(L,F,G){const q=G4(H4(dD(L))),Q=[];let te=[],he=[0,0],fe=[];const le=()=>{fe.length>=4&&te.push(...OA(fe,F)),fe=[]},Se=()=>{le(),te.length&&(Q.push(te),te=[])};for(const{key:Ee,data:Ie}of q)switch(Ee){case"M":Se(),he=[Ie[0],Ie[1]],te.push(he);break;case"L":le(),te.push([Ie[0],Ie[1]]);break;case"C":if(!fe.length){const He=te.length?te[te.length-1]:he;fe.push([He[0],He[1]])}fe.push([Ie[0],Ie[1]]),fe.push([Ie[2],Ie[3]]),fe.push([Ie[4],Ie[5]]);break;case"Z":le(),te.push([he[0],he[1]])}if(Se(),!G)return Q;const ke=[];for(const Ee of Q){const Ie=vte(Ee,G);Ie.length&&ke.push(Ie)}return ke}(t,1,i?4-4*(s.simplification||1):(1+s.roughness)/2),E=WR(t,s);if(d)if(s.fillStyle==="solid")if(S.length===1){const L=WR(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));a.push({type:"fillPath",ops:this._mergedShape(L.ops)})}else a.push(PA(S,s));else a.push(d1(S,s));return f&&(i?S.forEach(L=>{a.push(cE(L,!1,s))}):a.push(E)),this._d("path",a,s)}opsToPath(t,n){let s="";for(const a of t.ops){const d=typeof n=="number"&&n>=0?a.data.map(f=>+f.toFixed(n)):a.data;switch(a.op){case"move":s+=`M${d[0]} ${d[1]} `;break;case"bcurveTo":s+=`C${d[0]} ${d[1]}, ${d[2]} ${d[3]}, ${d[4]} ${d[5]} `;break;case"lineTo":s+=`L${d[0]} ${d[1]} `}}return s.trim()}toPaths(t){const n=t.sets||[],s=t.options||this.defaultOptions,a=[];for(const d of n){let f=null;switch(d.type){case"path":f={d:this.opsToPath(d),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:Hg};break;case"fillPath":f={d:this.opsToPath(d),stroke:Hg,strokeWidth:0,fill:s.fill||Hg};break;case"fillSketch":f=this.fillSketch(d,s)}f&&a.push(f)}return a}fillSketch(t,n){let s=n.fillWeight;return s<0&&(s=n.strokeWidth/2),{d:this.opsToPath(t),stroke:n.fill||Hg,strokeWidth:s,fill:Hg}}_mergedShape(t){return t.filter((n,s)=>s===0||n.op!=="move")}},xte=class{constructor(t,n){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new s2(n)}draw(t){const n=t.sets||[],s=t.options||this.getDefaultOptions(),a=this.ctx,d=t.options.fixedDecimalPlaceDigits;for(const f of n)switch(f.type){case"path":a.save(),a.strokeStyle=s.stroke==="none"?"transparent":s.stroke,a.lineWidth=s.strokeWidth,s.strokeLineDash&&a.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(a.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(a,f,d),a.restore();break;case"fillPath":{a.save(),a.fillStyle=s.fill||"";const i=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(a,f,d,i),a.restore();break}case"fillSketch":this.fillSketch(a,f,s)}}fillSketch(t,n,s){let a=s.fillWeight;a<0&&(a=s.strokeWidth/2),t.save(),s.fillLineDash&&t.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(t.lineDashOffset=s.fillLineDashOffset),t.strokeStyle=s.fill||"",t.lineWidth=a,this._drawToContext(t,n,s.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,n,s,a="nonzero"){t.beginPath();for(const d of n.ops){const f=typeof s=="number"&&s>=0?d.data.map(i=>+i.toFixed(s)):d.data;switch(d.op){case"move":t.moveTo(f[0],f[1]);break;case"bcurveTo":t.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"lineTo":t.lineTo(f[0],f[1])}}n.type==="fillPath"?t.fill(a):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,n,s,a,d){const f=this.gen.line(t,n,s,a,d);return this.draw(f),f}rectangle(t,n,s,a,d){const f=this.gen.rectangle(t,n,s,a,d);return this.draw(f),f}ellipse(t,n,s,a,d){const f=this.gen.ellipse(t,n,s,a,d);return this.draw(f),f}circle(t,n,s,a){const d=this.gen.circle(t,n,s,a);return this.draw(d),d}linearPath(t,n){const s=this.gen.linearPath(t,n);return this.draw(s),s}polygon(t,n){const s=this.gen.polygon(t,n);return this.draw(s),s}arc(t,n,s,a,d,f,i=!1,S){const E=this.gen.arc(t,n,s,a,d,f,i,S);return this.draw(E),E}curve(t,n){const s=this.gen.curve(t,n);return this.draw(s),s}path(t,n){const s=this.gen.path(t,n);return this.draw(s),s}};const RC="http://www.w3.org/2000/svg";let bte=class{constructor(t,n){this.svg=t,this.gen=new s2(n)}draw(t){const n=t.sets||[],s=t.options||this.getDefaultOptions(),a=this.svg.ownerDocument||window.document,d=a.createElementNS(RC,"g"),f=t.options.fixedDecimalPlaceDigits;for(const i of n){let S=null;switch(i.type){case"path":S=a.createElementNS(RC,"path"),S.setAttribute("d",this.opsToPath(i,f)),S.setAttribute("stroke",s.stroke),S.setAttribute("stroke-width",s.strokeWidth+""),S.setAttribute("fill","none"),s.strokeLineDash&&S.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&S.setAttribute("stroke-dashoffset",`${s.strokeLineDashOffset}`);break;case"fillPath":S=a.createElementNS(RC,"path"),S.setAttribute("d",this.opsToPath(i,f)),S.setAttribute("stroke","none"),S.setAttribute("stroke-width","0"),S.setAttribute("fill",s.fill||""),t.shape!=="curve"&&t.shape!=="polygon"||S.setAttribute("fill-rule","evenodd");break;case"fillSketch":S=this.fillSketch(a,i,s)}S&&d.appendChild(S)}return d}fillSketch(t,n,s){let a=s.fillWeight;a<0&&(a=s.strokeWidth/2);const d=t.createElementNS(RC,"path");return d.setAttribute("d",this.opsToPath(n,s.fixedDecimalPlaceDigits)),d.setAttribute("stroke",s.fill||""),d.setAttribute("stroke-width",a+""),d.setAttribute("fill","none"),s.fillLineDash&&d.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&d.setAttribute("stroke-dashoffset",`${s.fillLineDashOffset}`),d}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,n){return this.gen.opsToPath(t,n)}line(t,n,s,a,d){const f=this.gen.line(t,n,s,a,d);return this.draw(f)}rectangle(t,n,s,a,d){const f=this.gen.rectangle(t,n,s,a,d);return this.draw(f)}ellipse(t,n,s,a,d){const f=this.gen.ellipse(t,n,s,a,d);return this.draw(f)}circle(t,n,s,a){const d=this.gen.circle(t,n,s,a);return this.draw(d)}linearPath(t,n){const s=this.gen.linearPath(t,n);return this.draw(s)}polygon(t,n){const s=this.gen.polygon(t,n);return this.draw(s)}arc(t,n,s,a,d,f,i=!1,S){const E=this.gen.arc(t,n,s,a,d,f,i,S);return this.draw(E)}curve(t,n){const s=this.gen.curve(t,n);return this.draw(s)}path(t,n){const s=this.gen.path(t,n);return this.draw(s)}};var po={canvas:(e,t)=>new xte(e,t),svg:(e,t)=>new bte(e,t),generator:e=>new s2(e),newSeed:()=>s2.newSeed()},Na=Ze(async(e,t,n)=>{var F,G;let s;const a=t.useHtmlLabels||cp((F=Bc())==null?void 0:F.htmlLabels);n?s=n:s="node default";const d=e.insert("g").attr("class",s).attr("id",t.domId||t.id),f=d.insert("g").attr("class","label").attr("style",wm(t.labelStyle));let i;t.label===void 0?i="":i=typeof t.label=="string"?t.label:t.label[0];const S=await ux(f,hb(bb(i),Bc()),{useHtmlLabels:a,width:t.width||((G=Bc().flowchart)==null?void 0:G.wrappingWidth),cssClasses:"markdown-node-label",style:t.labelStyle,addSvgBackground:!!t.icon||!!t.img});let E=S.getBBox();const L=((t==null?void 0:t.padding)??0)/2;if(a){const q=S.children[0],Q=mc(S),te=q.getElementsByTagName("img");if(te){const he=i.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...te].map(fe=>new Promise(le=>{function Se(){if(fe.style.display="flex",fe.style.flexDirection="column",he){const ke=Bc().fontSize?Bc().fontSize:window.getComputedStyle(document.body).fontSize,Ee=5,[Ie=aF.fontSize]=sk(ke),He=Ie*Ee+"px";fe.style.minWidth=He,fe.style.maxWidth=He}else fe.style.width="100%";le(fe)}Ze(Se,"setupImage"),setTimeout(()=>{fe.complete&&Se()}),fe.addEventListener("error",Se),fe.addEventListener("load",Se)})))}E=q.getBoundingClientRect(),Q.attr("width",E.width),Q.attr("height",E.height)}return a?f.attr("transform","translate("+-E.width/2+", "+-E.height/2+")"):f.attr("transform","translate(0, "+-E.height/2+")"),t.centerLabel&&f.attr("transform","translate("+-E.width/2+", "+-E.height/2+")"),f.insert("rect",":first-child"),{shapeSvg:d,bbox:E,halfPadding:L,label:f}},"labelHelper"),RA=Ze(async(e,t,n)=>{var S,E,L,F,G,q;const s=n.useHtmlLabels||cp((E=(S=Bc())==null?void 0:S.flowchart)==null?void 0:E.htmlLabels),a=e.insert("g").attr("class","label").attr("style",n.labelStyle||""),d=await ux(a,hb(bb(t),Bc()),{useHtmlLabels:s,width:n.width||((F=(L=Bc())==null?void 0:L.flowchart)==null?void 0:F.wrappingWidth),style:n.labelStyle,addSvgBackground:!!n.icon||!!n.img});let f=d.getBBox();const i=n.padding/2;if(cp((q=(G=Bc())==null?void 0:G.flowchart)==null?void 0:q.htmlLabels)){const Q=d.children[0],te=mc(d);f=Q.getBoundingClientRect(),te.attr("width",f.width),te.attr("height",f.height)}return s?a.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"):a.attr("transform","translate(0, "+-f.height/2+")"),n.centerLabel&&a.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),a.insert("rect",":first-child"),{shapeSvg:e,bbox:f,halfPadding:i,label:a}},"insertLabel"),Eo=Ze((e,t)=>{const n=t.node().getBBox();e.width=n.width,e.height=n.height},"updateNodeBounds"),xa=Ze((e,t)=>(e.look==="handDrawn"?"rough-node":"node")+" "+e.cssClasses+" "+(t||""),"getNodeClasses");function gc(e){const t=e.map((n,s)=>`${s===0?"M":"L"}${n.x},${n.y}`);return t.push("Z"),t.join(" ")}Ze(gc,"createPathFromPoints");function lx(e,t,n,s,a,d){const f=[],S=n-e,E=s-t,L=S/d,F=2*Math.PI/L,G=t+E/2;for(let q=0;q<=50;q++){const Q=q/50,te=e+Q*S,he=G+a*Math.sin(F*(te-e));f.push({x:te,y:he})}return f}Ze(lx,"generateFullSineWavePoints");function pD(e,t,n,s,a,d){const f=[],i=a*Math.PI/180,L=(d*Math.PI/180-i)/(s-1);for(let F=0;F<s;F++){const G=i+F*L,q=e+n*Math.cos(G),Q=t+n*Math.sin(G);f.push({x:-q,y:-Q})}return f}Ze(pD,"generateCirclePoints");var wte=Ze((e,t)=>{var n=e.x,s=e.y,a=t.x-n,d=t.y-s,f=e.width/2,i=e.height/2,S,E;return Math.abs(d)*f>Math.abs(a)*i?(d<0&&(i=-i),S=d===0?0:i*a/d,E=i):(a<0&&(f=-f),S=f,E=a===0?0:f*d/a),{x:n+S,y:s+E}},"intersectRect"),cw=wte;function K4(e,t){t&&e.attr("style",t)}Ze(K4,"applyStyle");async function Q4(e){const t=mc(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),n=t.append("xhtml:div");let s=e.label;e.label&&U1(e.label)&&(s=await vL(e.label.replace(sw.lineBreakRegex,`
`),Bc()));const a=e.isNode?"nodeLabel":"edgeLabel";return n.html('<span class="'+a+'" '+(e.labelStyle?'style="'+e.labelStyle+'"':"")+">"+s+"</span>"),K4(n,e.labelStyle),n.style("display","inline-block"),n.style("padding-right","1px"),n.style("white-space","nowrap"),n.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()}Ze(Q4,"addHtmlLabel");var Ste=Ze(async(e,t,n,s)=>{let a=e||"";if(typeof a=="object"&&(a=a[0]),cp(Bc().flowchart.htmlLabels)){a=a.replace(/\\n|\n/g,"<br />"),On.info("vertexText"+a);const d={isNode:s,label:bb(a).replace(/fa[blrs]?:fa-[\w-]+/g,i=>`<i class='${i.replace(":"," ")}'></i>`),labelStyle:t&&t.replace("fill:","color:")};return await Q4(d)}else{const d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("style",t.replace("color:","fill:"));let f=[];typeof a=="string"?f=a.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(a)?f=a:f=[];for(const i of f){const S=document.createElementNS("http://www.w3.org/2000/svg","tspan");S.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),S.setAttribute("dy","1em"),S.setAttribute("x","0"),n?S.setAttribute("class","title-row"):S.setAttribute("class","row"),S.textContent=i.trim(),d.appendChild(S)}return d}},"createLabel"),tb=Ste,lv=Ze((e,t,n,s,a)=>["M",e+a,t,"H",e+n-a,"A",a,a,0,0,1,e+n,t+a,"V",t+s-a,"A",a,a,0,0,1,e+n-a,t+s,"H",e+a,"A",a,a,0,0,1,e,t+s-a,"V",t+a,"A",a,a,0,0,1,e+a,t,"Z"].join(" "),"createRoundedRectPathD"),J4=Ze(async(e,t)=>{On.info("Creating subgraph rect for ",t.id,t);const n=Bc(),{themeVariables:s,handDrawnSeed:a}=n,{clusterBkg:d,clusterBorder:f}=s,{labelStyles:i,nodeStyles:S,borderStyles:E,backgroundStyles:L}=ko(t),F=e.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),G=cp(n.flowchart.htmlLabels),q=F.insert("g").attr("class","cluster-label "),Q=await ux(q,t.label,{style:t.labelStyle,useHtmlLabels:G,isNode:!0});let te=Q.getBBox();if(cp(n.flowchart.htmlLabels)){const He=Q.children[0],Ye=mc(Q);te=He.getBoundingClientRect(),Ye.attr("width",te.width),Ye.attr("height",te.height)}const he=t.width<=te.width+t.padding?te.width+t.padding:t.width;t.width<=te.width+t.padding?t.diff=(he-t.width)/2-t.padding:t.diff=-t.padding;const fe=t.height,le=t.x-he/2,Se=t.y-fe/2;On.trace("Data ",t,JSON.stringify(t));let ke;if(t.look==="handDrawn"){const He=po.svg(F),Ye=vo(t,{roughness:.7,fill:d,stroke:f,fillWeight:3,seed:a}),lt=He.path(lv(le,Se,he,fe,0),Ye);ke=F.insert(()=>(On.debug("Rough node insert CXC",lt),lt),":first-child"),ke.select("path:nth-child(2)").attr("style",E.join(";")),ke.select("path").attr("style",L.join(";").replace("fill","stroke"))}else ke=F.insert("rect",":first-child"),ke.attr("style",S).attr("rx",t.rx).attr("ry",t.ry).attr("x",le).attr("y",Se).attr("width",he).attr("height",fe);const{subGraphTitleTopMargin:Ee}=LL(n);if(q.attr("transform",`translate(${t.x-te.width/2}, ${t.y-t.height/2+Ee})`),i){const He=q.select("span");He&&He.attr("style",i)}const Ie=ke.node().getBBox();return t.offsetX=0,t.width=Ie.width,t.height=Ie.height,t.offsetY=te.height-t.padding/2,t.intersect=function(He){return cw(t,He)},{cluster:F,labelBBox:te}},"rect"),Tte=Ze((e,t)=>{const n=e.insert("g").attr("class","note-cluster").attr("id",t.id),s=n.insert("rect",":first-child"),a=0*t.padding,d=a/2;s.attr("rx",t.rx).attr("ry",t.ry).attr("x",t.x-t.width/2-d).attr("y",t.y-t.height/2-d).attr("width",t.width+a).attr("height",t.height+a).attr("fill","none");const f=s.node().getBBox();return t.width=f.width,t.height=f.height,t.intersect=function(i){return cw(t,i)},{cluster:n,labelBBox:{width:0,height:0}}},"noteGroup"),Cte=Ze(async(e,t)=>{const n=Bc(),{themeVariables:s,handDrawnSeed:a}=n,{altBackground:d,compositeBackground:f,compositeTitleBackground:i,nodeBorder:S}=s,E=e.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-id",t.id).attr("data-look",t.look),L=E.insert("g",":first-child"),F=E.insert("g").attr("class","cluster-label");let G=E.append("rect");const q=F.node().appendChild(await tb(t.label,t.labelStyle,void 0,!0));let Q=q.getBBox();if(cp(n.flowchart.htmlLabels)){const lt=q.children[0],Pt=mc(q);Q=lt.getBoundingClientRect(),Pt.attr("width",Q.width),Pt.attr("height",Q.height)}const te=0*t.padding,he=te/2,fe=(t.width<=Q.width+t.padding?Q.width+t.padding:t.width)+te;t.width<=Q.width+t.padding?t.diff=(fe-t.width)/2-t.padding:t.diff=-t.padding;const le=t.height+te,Se=t.height+te-Q.height-6,ke=t.x-fe/2,Ee=t.y-le/2;t.width=fe;const Ie=t.y-t.height/2-he+Q.height+2;let He;if(t.look==="handDrawn"){const lt=t.cssClasses.includes("statediagram-cluster-alt"),Pt=po.svg(E),At=t.rx||t.ry?Pt.path(lv(ke,Ee,fe,le,10),{roughness:.7,fill:i,fillStyle:"solid",stroke:S,seed:a}):Pt.rectangle(ke,Ee,fe,le,{seed:a});He=E.insert(()=>At,":first-child");const ht=Pt.rectangle(ke,Ie,fe,Se,{fill:lt?d:f,fillStyle:lt?"hachure":"solid",stroke:S,seed:a});He=E.insert(()=>At,":first-child"),G=E.insert(()=>ht)}else{He=L.insert("rect",":first-child");const lt="outer";He.attr("class",lt).attr("x",ke).attr("y",Ee).attr("width",fe).attr("height",le).attr("data-look",t.look),G.attr("class","inner").attr("x",ke).attr("y",Ie).attr("width",fe).attr("height",Se)}F.attr("transform",`translate(${t.x-Q.width/2}, ${Ee+1-(cp(n.flowchart.htmlLabels)?0:3)})`);const Ye=He.node().getBBox();return t.height=Ye.height,t.offsetX=0,t.offsetY=Q.height-t.padding/2,t.labelBBox=Q,t.intersect=function(lt){return cw(t,lt)},{cluster:E,labelBBox:Q}},"roundedWithTitle"),Ete=Ze(async(e,t)=>{On.info("Creating subgraph rect for ",t.id,t);const n=Bc(),{themeVariables:s,handDrawnSeed:a}=n,{clusterBkg:d,clusterBorder:f}=s,{labelStyles:i,nodeStyles:S,borderStyles:E,backgroundStyles:L}=ko(t),F=e.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),G=cp(n.flowchart.htmlLabels),q=F.insert("g").attr("class","cluster-label "),Q=await ux(q,t.label,{style:t.labelStyle,useHtmlLabels:G,isNode:!0,width:t.width});let te=Q.getBBox();if(cp(n.flowchart.htmlLabels)){const He=Q.children[0],Ye=mc(Q);te=He.getBoundingClientRect(),Ye.attr("width",te.width),Ye.attr("height",te.height)}const he=t.width<=te.width+t.padding?te.width+t.padding:t.width;t.width<=te.width+t.padding?t.diff=(he-t.width)/2-t.padding:t.diff=-t.padding;const fe=t.height,le=t.x-he/2,Se=t.y-fe/2;On.trace("Data ",t,JSON.stringify(t));let ke;if(t.look==="handDrawn"){const He=po.svg(F),Ye=vo(t,{roughness:.7,fill:d,stroke:f,fillWeight:4,seed:a}),lt=He.path(lv(le,Se,he,fe,t.rx),Ye);ke=F.insert(()=>(On.debug("Rough node insert CXC",lt),lt),":first-child"),ke.select("path:nth-child(2)").attr("style",E.join(";")),ke.select("path").attr("style",L.join(";").replace("fill","stroke"))}else ke=F.insert("rect",":first-child"),ke.attr("style",S).attr("rx",t.rx).attr("ry",t.ry).attr("x",le).attr("y",Se).attr("width",he).attr("height",fe);const{subGraphTitleTopMargin:Ee}=LL(n);if(q.attr("transform",`translate(${t.x-te.width/2}, ${t.y-t.height/2+Ee})`),i){const He=q.select("span");He&&He.attr("style",i)}const Ie=ke.node().getBBox();return t.offsetX=0,t.width=Ie.width,t.height=Ie.height,t.offsetY=te.height-t.padding/2,t.intersect=function(He){return cw(t,He)},{cluster:F,labelBBox:te}},"kanbanSection"),kte=Ze((e,t)=>{const n=Bc(),{themeVariables:s,handDrawnSeed:a}=n,{nodeBorder:d}=s,f=e.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-look",t.look),i=f.insert("g",":first-child"),S=0*t.padding,E=t.width+S;t.diff=-t.padding;const L=t.height+S,F=t.x-E/2,G=t.y-L/2;t.width=E;let q;if(t.look==="handDrawn"){const he=po.svg(f).rectangle(F,G,E,L,{fill:"lightgrey",roughness:.5,strokeLineDash:[5],stroke:d,seed:a});q=f.insert(()=>he,":first-child")}else{q=i.insert("rect",":first-child");const te="divider";q.attr("class",te).attr("x",F).attr("y",G).attr("width",E).attr("height",L).attr("data-look",t.look)}const Q=q.node().getBBox();return t.height=Q.height,t.offsetX=0,t.offsetY=0,t.intersect=function(te){return cw(t,te)},{cluster:f,labelBBox:{}}},"divider"),Ate=J4,Mte={rect:J4,squareRect:Ate,roundedWithTitle:Cte,noteGroup:Tte,divider:kte,kanbanSection:Ete},e6=new Map,Ite=Ze(async(e,t)=>{const n=t.shape||"rect",s=await Mte[n](e,t);return e6.set(t.id,s),s},"insertCluster"),Kfe=Ze(()=>{e6=new Map},"clear");function t6(e,t){return e.intersect(t)}Ze(t6,"intersectNode");var Lte=t6;function i6(e,t,n,s){var a=e.x,d=e.y,f=a-s.x,i=d-s.y,S=Math.sqrt(t*t*i*i+n*n*f*f),E=Math.abs(t*n*f/S);s.x<a&&(E=-E);var L=Math.abs(t*n*i/S);return s.y<d&&(L=-L),{x:a+E,y:d+L}}Ze(i6,"intersectEllipse");var r6=i6;function n6(e,t,n){return r6(e,t,t,n)}Ze(n6,"intersectCircle");var Dte=n6;function s6(e,t,n,s){var a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le;if(a=t.y-e.y,f=e.x-t.x,S=t.x*e.y-e.x*t.y,G=a*n.x+f*n.y+S,q=a*s.x+f*s.y+S,!(G!==0&&q!==0&&oI(G,q))&&(d=s.y-n.y,i=n.x-s.x,E=s.x*n.y-n.x*s.y,L=d*e.x+i*e.y+E,F=d*t.x+i*t.y+E,!(L!==0&&F!==0&&oI(L,F))&&(Q=a*i-d*f,Q!==0)))return te=Math.abs(Q/2),he=f*E-i*S,fe=he<0?(he-te)/Q:(he+te)/Q,he=d*S-a*E,le=he<0?(he-te)/Q:(he+te)/Q,{x:fe,y:le}}Ze(s6,"intersectLine");function oI(e,t){return e*t>0}Ze(oI,"sameSign");var Pte=s6;function o6(e,t,n){let s=e.x,a=e.y,d=[],f=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(L){f=Math.min(f,L.x),i=Math.min(i,L.y)}):(f=Math.min(f,t.x),i=Math.min(i,t.y));let S=s-e.width/2-f,E=a-e.height/2-i;for(let L=0;L<t.length;L++){let F=t[L],G=t[L<t.length-1?L+1:0],q=Pte(e,n,{x:S+F.x,y:E+F.y},{x:S+G.x,y:E+G.y});q&&d.push(q)}return d.length?(d.length>1&&d.sort(function(L,F){let G=L.x-n.x,q=L.y-n.y,Q=Math.sqrt(G*G+q*q),te=F.x-n.x,he=F.y-n.y,fe=Math.sqrt(te*te+he*he);return Q<fe?-1:Q===fe?0:1}),d[0]):e}Ze(o6,"intersectPolygon");var Ote=o6,co={node:Lte,circle:Dte,ellipse:r6,polygon:Ote,rect:cw};function a6(e,t){const{labelStyles:n}=ko(t);t.labelStyle=n;const s=xa(t);let a=s;s||(a="anchor");const d=e.insert("g").attr("class",a).attr("id",t.domId||t.id),f=1,{cssStyles:i}=t,S=po.svg(d),E=vo(t,{fill:"black",stroke:"none",fillStyle:"solid"});t.look!=="handDrawn"&&(E.roughness=0);const L=S.circle(0,0,f*2,E),F=d.insert(()=>L,":first-child");return F.attr("class","anchor").attr("style",wm(i)),Eo(t,F),t.intersect=function(G){return On.info("Circle intersect",t,f,G),co.circle(t,f,G)},d}Ze(a6,"anchor");function aI(e,t,n,s,a,d,f){const S=(e+n)/2,E=(t+s)/2,L=Math.atan2(s-t,n-e),F=(n-e)/2,G=(s-t)/2,q=F/a,Q=G/d,te=Math.sqrt(q**2+Q**2);if(te>1)throw new Error("The given radii are too small to create an arc between the points.");const he=Math.sqrt(1-te**2),fe=S+he*d*Math.sin(L)*(f?-1:1),le=E-he*a*Math.cos(L)*(f?-1:1),Se=Math.atan2((t-le)/d,(e-fe)/a);let Ee=Math.atan2((s-le)/d,(n-fe)/a)-Se;f&&Ee<0&&(Ee+=2*Math.PI),!f&&Ee>0&&(Ee-=2*Math.PI);const Ie=[];for(let He=0;He<20;He++){const Ye=He/19,lt=Se+Ye*Ee,Pt=fe+a*Math.cos(lt),At=le+d*Math.sin(lt);Ie.push({x:Pt,y:At})}return Ie}Ze(aI,"generateArcPoints");async function l6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=d.width+t.padding+20,i=d.height+t.padding,S=i/2,E=S/(2.5+i/50),{cssStyles:L}=t,F=[{x:f/2,y:-i/2},{x:-f/2,y:-i/2},...aI(-f/2,-i/2,-f/2,i/2,E,S,!1),{x:f/2,y:i/2},...aI(f/2,i/2,f/2,-i/2,E,S,!0)],G=po.svg(a),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=gc(F),te=G.path(Q,q),he=a.insert(()=>te,":first-child");return he.attr("class","basic label-container"),L&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",L),s&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",s),he.attr("transform",`translate(${E/2}, 0)`),Eo(t,he),t.intersect=function(fe){return co.polygon(t,F,fe)},a}Ze(l6,"bowTieRect");function cv(e,t,n,s){return e.insert("polygon",":first-child").attr("points",s.map(function(a){return a.x+","+a.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+n/2+")")}Ze(cv,"insertPolygonShape");async function c6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=d.height+t.padding,i=12,S=d.width+t.padding+i,E=0,L=S,F=-f,G=0,q=[{x:E+i,y:F},{x:L,y:F},{x:L,y:G},{x:E,y:G},{x:E,y:F+i},{x:E+i,y:F}];let Q;const{cssStyles:te}=t;if(t.look==="handDrawn"){const he=po.svg(a),fe=vo(t,{}),le=gc(q),Se=he.path(le,fe);Q=a.insert(()=>Se,":first-child").attr("transform",`translate(${-S/2}, ${f/2})`),te&&Q.attr("style",te)}else Q=cv(a,S,f,q);return s&&Q.attr("style",s),Eo(t,Q),t.intersect=function(he){return co.polygon(t,q,he)},a}Ze(c6,"card");function h6(e,t){const{nodeStyles:n}=ko(t);t.label="";const s=e.insert("g").attr("class",xa(t)).attr("id",t.domId??t.id),{cssStyles:a}=t,d=Math.max(28,t.width??0),f=[{x:0,y:d/2},{x:d/2,y:0},{x:0,y:-d/2},{x:-d/2,y:0}],i=po.svg(s),S=vo(t,{});t.look!=="handDrawn"&&(S.roughness=0,S.fillStyle="solid");const E=gc(f),L=i.path(E,S),F=s.insert(()=>L,":first-child");return a&&t.look!=="handDrawn"&&F.selectAll("path").attr("style",a),n&&t.look!=="handDrawn"&&F.selectAll("path").attr("style",n),t.width=28,t.height=28,t.intersect=function(G){return co.polygon(t,f,G)},s}Ze(h6,"choice");async function u6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,halfPadding:f}=await Na(e,t,xa(t)),i=d.width/2+f;let S;const{cssStyles:E}=t;if(t.look==="handDrawn"){const L=po.svg(a),F=vo(t,{}),G=L.circle(0,0,i*2,F);S=a.insert(()=>G,":first-child"),S.attr("class","basic label-container").attr("style",wm(E))}else S=a.insert("circle",":first-child").attr("class","basic label-container").attr("style",s).attr("r",i).attr("cx",0).attr("cy",0);return Eo(t,S),t.intersect=function(L){return On.info("Circle intersect",t,i,L),co.circle(t,i,L)},a}Ze(u6,"circle");function d6(e){const t=Math.cos(Math.PI/4),n=Math.sin(Math.PI/4),s=e*2,a={x:s/2*t,y:s/2*n},d={x:-(s/2)*t,y:s/2*n},f={x:-(s/2)*t,y:-(s/2)*n},i={x:s/2*t,y:-(s/2)*n};return`M ${d.x},${d.y} L ${i.x},${i.y}
                   M ${a.x},${a.y} L ${f.x},${f.y}`}Ze(d6,"createLine");function p6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n,t.label="";const a=e.insert("g").attr("class",xa(t)).attr("id",t.domId??t.id),d=Math.max(30,(t==null?void 0:t.width)??0),{cssStyles:f}=t,i=po.svg(a),S=vo(t,{});t.look!=="handDrawn"&&(S.roughness=0,S.fillStyle="solid");const E=i.circle(0,0,d*2,S),L=d6(d),F=i.path(L,S),G=a.insert(()=>E,":first-child");return G.insert(()=>F),f&&t.look!=="handDrawn"&&G.selectAll("path").attr("style",f),s&&t.look!=="handDrawn"&&G.selectAll("path").attr("style",s),Eo(t,G),t.intersect=function(q){return On.info("crossedCircle intersect",t,{radius:d,point:q}),co.circle(t,d,q)},a}Ze(p6,"crossedCircle");function X_(e,t,n,s=100,a=0,d=180){const f=[],i=a*Math.PI/180,L=(d*Math.PI/180-i)/(s-1);for(let F=0;F<s;F++){const G=i+F*L,q=e+n*Math.cos(G),Q=t+n*Math.sin(G);f.push({x:-q,y:-Q})}return f}Ze(X_,"generateCirclePoints");async function f6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=d.width+(t.padding??0),S=d.height+(t.padding??0),E=Math.max(5,S*.1),{cssStyles:L}=t,F=[...X_(i/2,-S/2,E,30,-90,0),{x:-i/2-E,y:E},...X_(i/2+E*2,-E,E,20,-180,-270),...X_(i/2+E*2,E,E,20,-90,-180),{x:-i/2-E,y:-S/2},...X_(i/2,S/2,E,20,0,90)],G=[{x:i/2,y:-S/2-E},{x:-i/2,y:-S/2-E},...X_(i/2,-S/2,E,20,-90,0),{x:-i/2-E,y:-E},...X_(i/2+i*.1,-E,E,20,-180,-270),...X_(i/2+i*.1,E,E,20,-90,-180),{x:-i/2-E,y:S/2},...X_(i/2,S/2,E,20,0,90),{x:-i/2,y:S/2+E},{x:i/2,y:S/2+E}],q=po.svg(a),Q=vo(t,{fill:"none"});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const he=gc(F).replace("Z",""),fe=q.path(he,Q),le=gc(G),Se=q.path(le,{...Q}),ke=a.insert("g",":first-child");return ke.insert(()=>Se,":first-child").attr("stroke-opacity",0),ke.insert(()=>fe,":first-child"),ke.attr("class","text"),L&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",L),s&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",s),ke.attr("transform",`translate(${E}, 0)`),f.attr("transform",`translate(${-i/2+E-(d.x-(d.left??0))},${-S/2+(t.padding??0)/2-(d.y-(d.top??0))})`),Eo(t,ke),t.intersect=function(Ee){return co.polygon(t,G,Ee)},a}Ze(f6,"curlyBraceLeft");function Z_(e,t,n,s=100,a=0,d=180){const f=[],i=a*Math.PI/180,L=(d*Math.PI/180-i)/(s-1);for(let F=0;F<s;F++){const G=i+F*L,q=e+n*Math.cos(G),Q=t+n*Math.sin(G);f.push({x:q,y:Q})}return f}Ze(Z_,"generateCirclePoints");async function m6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=d.width+(t.padding??0),S=d.height+(t.padding??0),E=Math.max(5,S*.1),{cssStyles:L}=t,F=[...Z_(i/2,-S/2,E,20,-90,0),{x:i/2+E,y:-E},...Z_(i/2+E*2,-E,E,20,-180,-270),...Z_(i/2+E*2,E,E,20,-90,-180),{x:i/2+E,y:S/2},...Z_(i/2,S/2,E,20,0,90)],G=[{x:-i/2,y:-S/2-E},{x:i/2,y:-S/2-E},...Z_(i/2,-S/2,E,20,-90,0),{x:i/2+E,y:-E},...Z_(i/2+E*2,-E,E,20,-180,-270),...Z_(i/2+E*2,E,E,20,-90,-180),{x:i/2+E,y:S/2},...Z_(i/2,S/2,E,20,0,90),{x:i/2,y:S/2+E},{x:-i/2,y:S/2+E}],q=po.svg(a),Q=vo(t,{fill:"none"});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const he=gc(F).replace("Z",""),fe=q.path(he,Q),le=gc(G),Se=q.path(le,{...Q}),ke=a.insert("g",":first-child");return ke.insert(()=>Se,":first-child").attr("stroke-opacity",0),ke.insert(()=>fe,":first-child"),ke.attr("class","text"),L&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",L),s&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",s),ke.attr("transform",`translate(${-E}, 0)`),f.attr("transform",`translate(${-i/2+(t.padding??0)/2-(d.x-(d.left??0))},${-S/2+(t.padding??0)/2-(d.y-(d.top??0))})`),Eo(t,ke),t.intersect=function(Ee){return co.polygon(t,G,Ee)},a}Ze(m6,"curlyBraceRight");function tf(e,t,n,s=100,a=0,d=180){const f=[],i=a*Math.PI/180,L=(d*Math.PI/180-i)/(s-1);for(let F=0;F<s;F++){const G=i+F*L,q=e+n*Math.cos(G),Q=t+n*Math.sin(G);f.push({x:-q,y:-Q})}return f}Ze(tf,"generateCirclePoints");async function g6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=d.width+(t.padding??0),S=d.height+(t.padding??0),E=Math.max(5,S*.1),{cssStyles:L}=t,F=[...tf(i/2,-S/2,E,30,-90,0),{x:-i/2-E,y:E},...tf(i/2+E*2,-E,E,20,-180,-270),...tf(i/2+E*2,E,E,20,-90,-180),{x:-i/2-E,y:-S/2},...tf(i/2,S/2,E,20,0,90)],G=[...tf(-i/2+E+E/2,-S/2,E,20,-90,-180),{x:i/2-E/2,y:E},...tf(-i/2-E/2,-E,E,20,0,90),...tf(-i/2-E/2,E,E,20,-90,0),{x:i/2-E/2,y:-E},...tf(-i/2+E+E/2,S/2,E,30,-180,-270)],q=[{x:i/2,y:-S/2-E},{x:-i/2,y:-S/2-E},...tf(i/2,-S/2,E,20,-90,0),{x:-i/2-E,y:-E},...tf(i/2+E*2,-E,E,20,-180,-270),...tf(i/2+E*2,E,E,20,-90,-180),{x:-i/2-E,y:S/2},...tf(i/2,S/2,E,20,0,90),{x:-i/2,y:S/2+E},{x:i/2-E-E/2,y:S/2+E},...tf(-i/2+E+E/2,-S/2,E,20,-90,-180),{x:i/2-E/2,y:E},...tf(-i/2-E/2,-E,E,20,0,90),...tf(-i/2-E/2,E,E,20,-90,0),{x:i/2-E/2,y:-E},...tf(-i/2+E+E/2,S/2,E,30,-180,-270)],Q=po.svg(a),te=vo(t,{fill:"none"});t.look!=="handDrawn"&&(te.roughness=0,te.fillStyle="solid");const fe=gc(F).replace("Z",""),le=Q.path(fe,te),ke=gc(G).replace("Z",""),Ee=Q.path(ke,te),Ie=gc(q),He=Q.path(Ie,{...te}),Ye=a.insert("g",":first-child");return Ye.insert(()=>He,":first-child").attr("stroke-opacity",0),Ye.insert(()=>le,":first-child"),Ye.insert(()=>Ee,":first-child"),Ye.attr("class","text"),L&&t.look!=="handDrawn"&&Ye.selectAll("path").attr("style",L),s&&t.look!=="handDrawn"&&Ye.selectAll("path").attr("style",s),Ye.attr("transform",`translate(${E-E/4}, 0)`),f.attr("transform",`translate(${-i/2+(t.padding??0)/2-(d.x-(d.left??0))},${-S/2+(t.padding??0)/2-(d.y-(d.top??0))})`),Eo(t,Ye),t.intersect=function(lt){return co.polygon(t,q,lt)},a}Ze(g6,"curlyBraces");async function y6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=80,i=20,S=Math.max(f,(d.width+(t.padding??0)*2)*1.25,(t==null?void 0:t.width)??0),E=Math.max(i,d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),L=E/2,{cssStyles:F}=t,G=po.svg(a),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=S,te=E,he=Q-L,fe=te/4,le=[{x:he,y:0},{x:fe,y:0},{x:0,y:te/2},{x:fe,y:te},{x:he,y:te},...pD(-he,-te/2,L,50,270,90)],Se=gc(le),ke=G.path(Se,q),Ee=a.insert(()=>ke,":first-child");return Ee.attr("class","basic label-container"),F&&t.look!=="handDrawn"&&Ee.selectChildren("path").attr("style",F),s&&t.look!=="handDrawn"&&Ee.selectChildren("path").attr("style",s),Ee.attr("transform",`translate(${-S/2}, ${-E/2})`),Eo(t,Ee),t.intersect=function(Ie){return co.polygon(t,le,Ie)},a}Ze(y6,"curvedTrapezoid");var Rte=Ze((e,t,n,s,a,d)=>[`M${e},${t+d}`,`a${a},${d} 0,0,0 ${n},0`,`a${a},${d} 0,0,0 ${-n},0`,`l0,${s}`,`a${a},${d} 0,0,0 ${n},0`,`l0,${-s}`].join(" "),"createCylinderPathD"),Nte=Ze((e,t,n,s,a,d)=>[`M${e},${t+d}`,`M${e+n},${t+d}`,`a${a},${d} 0,0,0 ${-n},0`,`l0,${s}`,`a${a},${d} 0,0,0 ${n},0`,`l0,${-s}`].join(" "),"createOuterCylinderPathD"),Bte=Ze((e,t,n,s,a,d)=>[`M${e-n/2},${-s/2}`,`a${a},${d} 0,0,0 ${n},0`].join(" "),"createInnerCylinderPathD");async function _6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+t.padding,t.width??0),S=i/2,E=S/(2.5+i/50),L=Math.max(d.height+E+t.padding,t.height??0);let F;const{cssStyles:G}=t;if(t.look==="handDrawn"){const q=po.svg(a),Q=Nte(0,0,i,L,S,E),te=Bte(0,E,i,L,S,E),he=q.path(Q,vo(t,{})),fe=q.path(te,vo(t,{fill:"none"}));F=a.insert(()=>fe,":first-child"),F=a.insert(()=>he,":first-child"),F.attr("class","basic label-container"),G&&F.attr("style",G)}else{const q=Rte(0,0,i,L,S,E);F=a.insert("path",":first-child").attr("d",q).attr("class","basic label-container").attr("style",wm(G)).attr("style",s)}return F.attr("label-offset-y",E),F.attr("transform",`translate(${-i/2}, ${-(L/2+E)})`),Eo(t,F),f.attr("transform",`translate(${-(d.width/2)-(d.x-(d.left??0))}, ${-(d.height/2)+(t.padding??0)/1.5-(d.y-(d.top??0))})`),t.intersect=function(q){const Q=co.rect(t,q),te=Q.x-(t.x??0);if(S!=0&&(Math.abs(te)<(t.width??0)/2||Math.abs(te)==(t.width??0)/2&&Math.abs(Q.y-(t.y??0))>(t.height??0)/2-E)){let he=E*E*(1-te*te/(S*S));he>0&&(he=Math.sqrt(he)),he=E-he,q.y-(t.y??0)>0&&(he=-he),Q.y+=he}return Q},a}Ze(_6,"cylinder");async function v6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=d.width+t.padding,S=d.height+t.padding,E=S*.2,L=-i/2,F=-S/2-E/2,{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const te=[{x:L,y:F+E},{x:-L,y:F+E},{x:-L,y:-F},{x:L,y:-F},{x:L,y:F},{x:-L,y:F},{x:-L,y:F+E}],he=q.polygon(te.map(le=>[le.x,le.y]),Q),fe=a.insert(()=>he,":first-child");return fe.attr("class","basic label-container"),G&&t.look!=="handDrawn"&&fe.selectAll("path").attr("style",G),s&&t.look!=="handDrawn"&&fe.selectAll("path").attr("style",s),f.attr("transform",`translate(${L+(t.padding??0)/2-(d.x-(d.left??0))}, ${F+E+(t.padding??0)/2-(d.y-(d.top??0))})`),Eo(t,fe),t.intersect=function(le){return co.rect(t,le)},a}Ze(v6,"dividedRectangle");async function x6(e,t){var G,q;const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,halfPadding:f}=await Na(e,t,xa(t)),i=5,S=d.width/2+f+i,E=d.width/2+f;let L;const{cssStyles:F}=t;if(t.look==="handDrawn"){const Q=po.svg(a),te=vo(t,{roughness:.2,strokeWidth:2.5}),he=vo(t,{roughness:.2,strokeWidth:1.5}),fe=Q.circle(0,0,S*2,te),le=Q.circle(0,0,E*2,he);L=a.insert("g",":first-child"),L.attr("class",wm(t.cssClasses)).attr("style",wm(F)),(G=L.node())==null||G.appendChild(fe),(q=L.node())==null||q.appendChild(le)}else{L=a.insert("g",":first-child");const Q=L.insert("circle",":first-child"),te=L.insert("circle");L.attr("class","basic label-container").attr("style",s),Q.attr("class","outer-circle").attr("style",s).attr("r",S).attr("cx",0).attr("cy",0),te.attr("class","inner-circle").attr("style",s).attr("r",E).attr("cx",0).attr("cy",0)}return Eo(t,L),t.intersect=function(Q){return On.info("DoubleCircle intersect",t,S,Q),co.circle(t,S,Q)},a}Ze(x6,"doublecircle");function b6(e,t,{config:{themeVariables:n}}){const{labelStyles:s,nodeStyles:a}=ko(t);t.label="",t.labelStyle=s;const d=e.insert("g").attr("class",xa(t)).attr("id",t.domId??t.id),f=7,{cssStyles:i}=t,S=po.svg(d),{nodeBorder:E}=n,L=vo(t,{fillStyle:"solid"});t.look!=="handDrawn"&&(L.roughness=0);const F=S.circle(0,0,f*2,L),G=d.insert(()=>F,":first-child");return G.selectAll("path").attr("style",`fill: ${E} !important;`),i&&i.length>0&&t.look!=="handDrawn"&&G.selectAll("path").attr("style",i),a&&t.look!=="handDrawn"&&G.selectAll("path").attr("style",a),Eo(t,G),t.intersect=function(q){return On.info("filledCircle intersect",t,{radius:f,point:q}),co.circle(t,f,q)},d}Ze(b6,"filledCircle");async function w6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=d.width+(t.padding??0),S=i+d.height,E=i+d.height,L=[{x:0,y:-S},{x:E,y:-S},{x:E/2,y:0}],{cssStyles:F}=t,G=po.svg(a),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=gc(L),te=G.path(Q,q),he=a.insert(()=>te,":first-child").attr("transform",`translate(${-S/2}, ${S/2})`);return F&&t.look!=="handDrawn"&&he.selectChildren("path").attr("style",F),s&&t.look!=="handDrawn"&&he.selectChildren("path").attr("style",s),t.width=i,t.height=S,Eo(t,he),f.attr("transform",`translate(${-d.width/2-(d.x-(d.left??0))}, ${-S/2+(t.padding??0)/2+(d.y-(d.top??0))})`),t.intersect=function(fe){return On.info("Triangle intersect",t,L,fe),co.polygon(t,L,fe)},a}Ze(w6,"flippedTriangle");function S6(e,t,{dir:n,config:{state:s,themeVariables:a}}){const{nodeStyles:d}=ko(t);t.label="";const f=e.insert("g").attr("class",xa(t)).attr("id",t.domId??t.id),{cssStyles:i}=t;let S=Math.max(70,(t==null?void 0:t.width)??0),E=Math.max(10,(t==null?void 0:t.height)??0);n==="LR"&&(S=Math.max(10,(t==null?void 0:t.width)??0),E=Math.max(70,(t==null?void 0:t.height)??0));const L=-1*S/2,F=-1*E/2,G=po.svg(f),q=vo(t,{stroke:a.lineColor,fill:a.lineColor});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=G.rectangle(L,F,S,E,q),te=f.insert(()=>Q,":first-child");i&&t.look!=="handDrawn"&&te.selectAll("path").attr("style",i),d&&t.look!=="handDrawn"&&te.selectAll("path").attr("style",d),Eo(t,te);const he=(s==null?void 0:s.padding)??0;return t.width&&t.height&&(t.width+=he/2||0,t.height+=he/2||0),t.intersect=function(fe){return co.rect(t,fe)},f}Ze(S6,"forkJoin");async function T6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const a=80,d=50,{shapeSvg:f,bbox:i}=await Na(e,t,xa(t)),S=Math.max(a,i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),E=Math.max(d,i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),L=E/2,{cssStyles:F}=t,G=po.svg(f),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=[{x:-S/2,y:-E/2},{x:S/2-L,y:-E/2},...pD(-S/2+L,0,L,50,90,270),{x:S/2-L,y:E/2},{x:-S/2,y:E/2}],te=gc(Q),he=G.path(te,q),fe=f.insert(()=>he,":first-child");return fe.attr("class","basic label-container"),F&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",F),s&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",s),Eo(t,fe),t.intersect=function(le){return On.info("Pill intersect",t,{radius:L,point:le}),co.polygon(t,Q,le)},f}Ze(T6,"halfRoundedRectangle");var Fte=Ze((e,t,n,s,a)=>[`M${e+a},${t}`,`L${e+n-a},${t}`,`L${e+n},${t-s/2}`,`L${e+n-a},${t-s}`,`L${e+a},${t-s}`,`L${e},${t-s/2}`,"Z"].join(" "),"createHexagonPathD");async function C6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=4,i=d.height+t.padding,S=i/f,E=d.width+2*S+t.padding,L=[{x:S,y:0},{x:E-S,y:0},{x:E,y:-i/2},{x:E-S,y:-i},{x:S,y:-i},{x:0,y:-i/2}];let F;const{cssStyles:G}=t;if(t.look==="handDrawn"){const q=po.svg(a),Q=vo(t,{}),te=Fte(0,0,E,i,S),he=q.path(te,Q);F=a.insert(()=>he,":first-child").attr("transform",`translate(${-E/2}, ${i/2})`),G&&F.attr("style",G)}else F=cv(a,E,i,L);return s&&F.attr("style",s),t.width=E,t.height=i,Eo(t,F),t.intersect=function(q){return co.polygon(t,L,q)},a}Ze(C6,"hexagon");async function E6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.label="",t.labelStyle=n;const{shapeSvg:a}=await Na(e,t,xa(t)),d=Math.max(30,(t==null?void 0:t.width)??0),f=Math.max(30,(t==null?void 0:t.height)??0),{cssStyles:i}=t,S=po.svg(a),E=vo(t,{});t.look!=="handDrawn"&&(E.roughness=0,E.fillStyle="solid");const L=[{x:0,y:0},{x:d,y:0},{x:0,y:f},{x:d,y:f}],F=gc(L),G=S.path(F,E),q=a.insert(()=>G,":first-child");return q.attr("class","basic label-container"),i&&t.look!=="handDrawn"&&q.selectChildren("path").attr("style",i),s&&t.look!=="handDrawn"&&q.selectChildren("path").attr("style",s),q.attr("transform",`translate(${-d/2}, ${-f/2})`),Eo(t,q),t.intersect=function(Q){return On.info("Pill intersect",t,{points:L}),co.polygon(t,L,Q)},a}Ze(E6,"hourglass");async function k6(e,t,{config:{themeVariables:n,flowchart:s}}){const{labelStyles:a}=ko(t);t.labelStyle=a;const d=t.assetHeight??48,f=t.assetWidth??48,i=Math.max(d,f),S=s==null?void 0:s.wrappingWidth;t.width=Math.max(i,S??0);const{shapeSvg:E,bbox:L,label:F}=await Na(e,t,"icon-shape default"),G=t.pos==="t",q=i,Q=i,{nodeBorder:te}=n,{stylesMap:he}=ow(t),fe=-Q/2,le=-q/2,Se=t.label?8:0,ke=po.svg(E),Ee=vo(t,{stroke:"none",fill:"none"});t.look!=="handDrawn"&&(Ee.roughness=0,Ee.fillStyle="solid");const Ie=ke.rectangle(fe,le,Q,q,Ee),He=Math.max(Q,L.width),Ye=q+L.height+Se,lt=ke.rectangle(-He/2,-Ye/2,He,Ye,{...Ee,fill:"transparent",stroke:"none"}),Pt=E.insert(()=>Ie,":first-child"),At=E.insert(()=>lt);if(t.icon){const ht=E.append("g");ht.html(`<g>${await LT(t.icon,{height:i,width:i,fallbackPrefix:""})}</g>`);const Ot=ht.node().getBBox(),Ae=Ot.width,mt=Ot.height,bt=Ot.x,Dt=Ot.y;ht.attr("transform",`translate(${-Ae/2-bt},${G?L.height/2+Se/2-mt/2-Dt:-L.height/2-Se/2-mt/2-Dt})`),ht.attr("style",`color: ${he.get("stroke")??te};`)}return F.attr("transform",`translate(${-L.width/2-(L.x-(L.left??0))},${G?-Ye/2:Ye/2-L.height})`),Pt.attr("transform",`translate(0,${G?L.height/2+Se/2:-L.height/2-Se/2})`),Eo(t,At),t.intersect=function(ht){if(On.info("iconSquare intersect",t,ht),!t.label)return co.rect(t,ht);const Ot=t.x??0,Ae=t.y??0,mt=t.height??0;let bt=[];return G?bt=[{x:Ot-L.width/2,y:Ae-mt/2},{x:Ot+L.width/2,y:Ae-mt/2},{x:Ot+L.width/2,y:Ae-mt/2+L.height+Se},{x:Ot+Q/2,y:Ae-mt/2+L.height+Se},{x:Ot+Q/2,y:Ae+mt/2},{x:Ot-Q/2,y:Ae+mt/2},{x:Ot-Q/2,y:Ae-mt/2+L.height+Se},{x:Ot-L.width/2,y:Ae-mt/2+L.height+Se}]:bt=[{x:Ot-Q/2,y:Ae-mt/2},{x:Ot+Q/2,y:Ae-mt/2},{x:Ot+Q/2,y:Ae-mt/2+q},{x:Ot+L.width/2,y:Ae-mt/2+q},{x:Ot+L.width/2/2,y:Ae+mt/2},{x:Ot-L.width/2,y:Ae+mt/2},{x:Ot-L.width/2,y:Ae-mt/2+q},{x:Ot-Q/2,y:Ae-mt/2+q}],co.polygon(t,bt,ht)},E}Ze(k6,"icon");async function A6(e,t,{config:{themeVariables:n,flowchart:s}}){const{labelStyles:a}=ko(t);t.labelStyle=a;const d=t.assetHeight??48,f=t.assetWidth??48,i=Math.max(d,f),S=s==null?void 0:s.wrappingWidth;t.width=Math.max(i,S??0);const{shapeSvg:E,bbox:L,label:F}=await Na(e,t,"icon-shape default"),G=20,q=t.label?8:0,Q=t.pos==="t",{nodeBorder:te,mainBkg:he}=n,{stylesMap:fe}=ow(t),le=po.svg(E),Se=vo(t,{});t.look!=="handDrawn"&&(Se.roughness=0,Se.fillStyle="solid");const ke=fe.get("fill");Se.stroke=ke??he;const Ee=E.append("g");t.icon&&Ee.html(`<g>${await LT(t.icon,{height:i,width:i,fallbackPrefix:""})}</g>`);const Ie=Ee.node().getBBox(),He=Ie.width,Ye=Ie.height,lt=Ie.x,Pt=Ie.y,At=Math.max(He,Ye)*Math.SQRT2+G*2,ht=le.circle(0,0,At,Se),Ot=Math.max(At,L.width),Ae=At+L.height+q,mt=le.rectangle(-Ot/2,-Ae/2,Ot,Ae,{...Se,fill:"transparent",stroke:"none"}),bt=E.insert(()=>ht,":first-child"),Dt=E.insert(()=>mt);return Ee.attr("transform",`translate(${-He/2-lt},${Q?L.height/2+q/2-Ye/2-Pt:-L.height/2-q/2-Ye/2-Pt})`),Ee.attr("style",`color: ${fe.get("stroke")??te};`),F.attr("transform",`translate(${-L.width/2-(L.x-(L.left??0))},${Q?-Ae/2:Ae/2-L.height})`),bt.attr("transform",`translate(0,${Q?L.height/2+q/2:-L.height/2-q/2})`),Eo(t,Dt),t.intersect=function(Je){return On.info("iconSquare intersect",t,Je),co.rect(t,Je)},E}Ze(A6,"iconCircle");async function M6(e,t,{config:{themeVariables:n,flowchart:s}}){const{labelStyles:a}=ko(t);t.labelStyle=a;const d=t.assetHeight??48,f=t.assetWidth??48,i=Math.max(d,f),S=s==null?void 0:s.wrappingWidth;t.width=Math.max(i,S??0);const{shapeSvg:E,bbox:L,halfPadding:F,label:G}=await Na(e,t,"icon-shape default"),q=t.pos==="t",Q=i+F*2,te=i+F*2,{nodeBorder:he,mainBkg:fe}=n,{stylesMap:le}=ow(t),Se=-te/2,ke=-Q/2,Ee=t.label?8:0,Ie=po.svg(E),He=vo(t,{});t.look!=="handDrawn"&&(He.roughness=0,He.fillStyle="solid");const Ye=le.get("fill");He.stroke=Ye??fe;const lt=Ie.path(lv(Se,ke,te,Q,5),He),Pt=Math.max(te,L.width),At=Q+L.height+Ee,ht=Ie.rectangle(-Pt/2,-At/2,Pt,At,{...He,fill:"transparent",stroke:"none"}),Ot=E.insert(()=>lt,":first-child").attr("class","icon-shape2"),Ae=E.insert(()=>ht);if(t.icon){const mt=E.append("g");mt.html(`<g>${await LT(t.icon,{height:i,width:i,fallbackPrefix:""})}</g>`);const bt=mt.node().getBBox(),Dt=bt.width,Je=bt.height,dt=bt.x,ui=bt.y;mt.attr("transform",`translate(${-Dt/2-dt},${q?L.height/2+Ee/2-Je/2-ui:-L.height/2-Ee/2-Je/2-ui})`),mt.attr("style",`color: ${le.get("stroke")??he};`)}return G.attr("transform",`translate(${-L.width/2-(L.x-(L.left??0))},${q?-At/2:At/2-L.height})`),Ot.attr("transform",`translate(0,${q?L.height/2+Ee/2:-L.height/2-Ee/2})`),Eo(t,Ae),t.intersect=function(mt){if(On.info("iconSquare intersect",t,mt),!t.label)return co.rect(t,mt);const bt=t.x??0,Dt=t.y??0,Je=t.height??0;let dt=[];return q?dt=[{x:bt-L.width/2,y:Dt-Je/2},{x:bt+L.width/2,y:Dt-Je/2},{x:bt+L.width/2,y:Dt-Je/2+L.height+Ee},{x:bt+te/2,y:Dt-Je/2+L.height+Ee},{x:bt+te/2,y:Dt+Je/2},{x:bt-te/2,y:Dt+Je/2},{x:bt-te/2,y:Dt-Je/2+L.height+Ee},{x:bt-L.width/2,y:Dt-Je/2+L.height+Ee}]:dt=[{x:bt-te/2,y:Dt-Je/2},{x:bt+te/2,y:Dt-Je/2},{x:bt+te/2,y:Dt-Je/2+Q},{x:bt+L.width/2,y:Dt-Je/2+Q},{x:bt+L.width/2/2,y:Dt+Je/2},{x:bt-L.width/2,y:Dt+Je/2},{x:bt-L.width/2,y:Dt-Je/2+Q},{x:bt-te/2,y:Dt-Je/2+Q}],co.polygon(t,dt,mt)},E}Ze(M6,"iconRounded");async function I6(e,t,{config:{themeVariables:n,flowchart:s}}){const{labelStyles:a}=ko(t);t.labelStyle=a;const d=t.assetHeight??48,f=t.assetWidth??48,i=Math.max(d,f),S=s==null?void 0:s.wrappingWidth;t.width=Math.max(i,S??0);const{shapeSvg:E,bbox:L,halfPadding:F,label:G}=await Na(e,t,"icon-shape default"),q=t.pos==="t",Q=i+F*2,te=i+F*2,{nodeBorder:he,mainBkg:fe}=n,{stylesMap:le}=ow(t),Se=-te/2,ke=-Q/2,Ee=t.label?8:0,Ie=po.svg(E),He=vo(t,{});t.look!=="handDrawn"&&(He.roughness=0,He.fillStyle="solid");const Ye=le.get("fill");He.stroke=Ye??fe;const lt=Ie.path(lv(Se,ke,te,Q,.1),He),Pt=Math.max(te,L.width),At=Q+L.height+Ee,ht=Ie.rectangle(-Pt/2,-At/2,Pt,At,{...He,fill:"transparent",stroke:"none"}),Ot=E.insert(()=>lt,":first-child"),Ae=E.insert(()=>ht);if(t.icon){const mt=E.append("g");mt.html(`<g>${await LT(t.icon,{height:i,width:i,fallbackPrefix:""})}</g>`);const bt=mt.node().getBBox(),Dt=bt.width,Je=bt.height,dt=bt.x,ui=bt.y;mt.attr("transform",`translate(${-Dt/2-dt},${q?L.height/2+Ee/2-Je/2-ui:-L.height/2-Ee/2-Je/2-ui})`),mt.attr("style",`color: ${le.get("stroke")??he};`)}return G.attr("transform",`translate(${-L.width/2-(L.x-(L.left??0))},${q?-At/2:At/2-L.height})`),Ot.attr("transform",`translate(0,${q?L.height/2+Ee/2:-L.height/2-Ee/2})`),Eo(t,Ae),t.intersect=function(mt){if(On.info("iconSquare intersect",t,mt),!t.label)return co.rect(t,mt);const bt=t.x??0,Dt=t.y??0,Je=t.height??0;let dt=[];return q?dt=[{x:bt-L.width/2,y:Dt-Je/2},{x:bt+L.width/2,y:Dt-Je/2},{x:bt+L.width/2,y:Dt-Je/2+L.height+Ee},{x:bt+te/2,y:Dt-Je/2+L.height+Ee},{x:bt+te/2,y:Dt+Je/2},{x:bt-te/2,y:Dt+Je/2},{x:bt-te/2,y:Dt-Je/2+L.height+Ee},{x:bt-L.width/2,y:Dt-Je/2+L.height+Ee}]:dt=[{x:bt-te/2,y:Dt-Je/2},{x:bt+te/2,y:Dt-Je/2},{x:bt+te/2,y:Dt-Je/2+Q},{x:bt+L.width/2,y:Dt-Je/2+Q},{x:bt+L.width/2/2,y:Dt+Je/2},{x:bt-L.width/2,y:Dt+Je/2},{x:bt-L.width/2,y:Dt-Je/2+Q},{x:bt-te/2,y:Dt-Je/2+Q}],co.polygon(t,dt,mt)},E}Ze(I6,"iconSquare");async function L6(e,t,{config:{flowchart:n}}){const s=new Image;s.src=(t==null?void 0:t.img)??"",await s.decode();const a=Number(s.naturalWidth.toString().replace("px","")),d=Number(s.naturalHeight.toString().replace("px",""));t.imageAspectRatio=a/d;const{labelStyles:f}=ko(t);t.labelStyle=f;const i=n==null?void 0:n.wrappingWidth;t.defaultWidth=n==null?void 0:n.wrappingWidth;const S=Math.max(t.label?i??0:0,(t==null?void 0:t.assetWidth)??a),E=t.constraint==="on"&&t!=null&&t.assetHeight?t.assetHeight*t.imageAspectRatio:S,L=t.constraint==="on"?E/t.imageAspectRatio:(t==null?void 0:t.assetHeight)??d;t.width=Math.max(E,i??0);const{shapeSvg:F,bbox:G,label:q}=await Na(e,t,"image-shape default"),Q=t.pos==="t",te=-E/2,he=-L/2,fe=t.label?8:0,le=po.svg(F),Se=vo(t,{});t.look!=="handDrawn"&&(Se.roughness=0,Se.fillStyle="solid");const ke=le.rectangle(te,he,E,L,Se),Ee=Math.max(E,G.width),Ie=L+G.height+fe,He=le.rectangle(-Ee/2,-Ie/2,Ee,Ie,{...Se,fill:"none",stroke:"none"}),Ye=F.insert(()=>ke,":first-child"),lt=F.insert(()=>He);if(t.img){const Pt=F.append("image");Pt.attr("href",t.img),Pt.attr("width",E),Pt.attr("height",L),Pt.attr("preserveAspectRatio","none"),Pt.attr("transform",`translate(${-E/2},${Q?Ie/2-L:-Ie/2})`)}return q.attr("transform",`translate(${-G.width/2-(G.x-(G.left??0))},${Q?-L/2-G.height/2-fe/2:L/2-G.height/2+fe/2})`),Ye.attr("transform",`translate(0,${Q?G.height/2+fe/2:-G.height/2-fe/2})`),Eo(t,lt),t.intersect=function(Pt){if(On.info("iconSquare intersect",t,Pt),!t.label)return co.rect(t,Pt);const At=t.x??0,ht=t.y??0,Ot=t.height??0;let Ae=[];return Q?Ae=[{x:At-G.width/2,y:ht-Ot/2},{x:At+G.width/2,y:ht-Ot/2},{x:At+G.width/2,y:ht-Ot/2+G.height+fe},{x:At+E/2,y:ht-Ot/2+G.height+fe},{x:At+E/2,y:ht+Ot/2},{x:At-E/2,y:ht+Ot/2},{x:At-E/2,y:ht-Ot/2+G.height+fe},{x:At-G.width/2,y:ht-Ot/2+G.height+fe}]:Ae=[{x:At-E/2,y:ht-Ot/2},{x:At+E/2,y:ht-Ot/2},{x:At+E/2,y:ht-Ot/2+L},{x:At+G.width/2,y:ht-Ot/2+L},{x:At+G.width/2/2,y:ht+Ot/2},{x:At-G.width/2,y:ht+Ot/2},{x:At-G.width/2,y:ht-Ot/2+L},{x:At-E/2,y:ht-Ot/2+L}],co.polygon(t,Ae,Pt)},F}Ze(L6,"imageSquare");async function D6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),i=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),S=[{x:0,y:0},{x:f,y:0},{x:f+3*i/6,y:-i},{x:-3*i/6,y:-i}];let E;const{cssStyles:L}=t;if(t.look==="handDrawn"){const F=po.svg(a),G=vo(t,{}),q=gc(S),Q=F.path(q,G);E=a.insert(()=>Q,":first-child").attr("transform",`translate(${-f/2}, ${i/2})`),L&&E.attr("style",L)}else E=cv(a,f,i,S);return s&&E.attr("style",s),t.width=f,t.height=i,Eo(t,E),t.intersect=function(F){return co.polygon(t,S,F)},a}Ze(D6,"inv_trapezoid");async function PT(e,t,n){const{labelStyles:s,nodeStyles:a}=ko(t);t.labelStyle=s;const{shapeSvg:d,bbox:f}=await Na(e,t,xa(t)),i=Math.max(f.width+n.labelPaddingX*2,(t==null?void 0:t.width)||0),S=Math.max(f.height+n.labelPaddingY*2,(t==null?void 0:t.height)||0),E=-i/2,L=-S/2;let F,{rx:G,ry:q}=t;const{cssStyles:Q}=t;if(n!=null&&n.rx&&n.ry&&(G=n.rx,q=n.ry),t.look==="handDrawn"){const te=po.svg(d),he=vo(t,{}),fe=G||q?te.path(lv(E,L,i,S,G||0),he):te.rectangle(E,L,i,S,he);F=d.insert(()=>fe,":first-child"),F.attr("class","basic label-container").attr("style",wm(Q))}else F=d.insert("rect",":first-child"),F.attr("class","basic label-container").attr("style",a).attr("rx",wm(G)).attr("ry",wm(q)).attr("x",E).attr("y",L).attr("width",i).attr("height",S);return Eo(t,F),t.intersect=function(te){return co.rect(t,te)},d}Ze(PT,"drawRect");async function P6(e,t){const{shapeSvg:n,bbox:s,label:a}=await Na(e,t,"label"),d=n.insert("rect",":first-child"),f=.1,i=.1;return d.attr("width",f).attr("height",i),n.attr("class","label edgeLabel"),a.attr("transform",`translate(${-(s.width/2)-(s.x-(s.left??0))}, ${-(s.height/2)-(s.y-(s.top??0))})`),Eo(t,d),t.intersect=function(S){return co.rect(t,S)},n}Ze(P6,"labelRect");async function O6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=Math.max(d.width+(t.padding??0),(t==null?void 0:t.width)??0),i=Math.max(d.height+(t.padding??0),(t==null?void 0:t.height)??0),S=[{x:0,y:0},{x:f+3*i/6,y:0},{x:f,y:-i},{x:-(3*i)/6,y:-i}];let E;const{cssStyles:L}=t;if(t.look==="handDrawn"){const F=po.svg(a),G=vo(t,{}),q=gc(S),Q=F.path(q,G);E=a.insert(()=>Q,":first-child").attr("transform",`translate(${-f/2}, ${i/2})`),L&&E.attr("style",L)}else E=cv(a,f,i,S);return s&&E.attr("style",s),t.width=f,t.height=i,Eo(t,E),t.intersect=function(F){return co.polygon(t,S,F)},a}Ze(O6,"lean_left");async function R6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=Math.max(d.width+(t.padding??0),(t==null?void 0:t.width)??0),i=Math.max(d.height+(t.padding??0),(t==null?void 0:t.height)??0),S=[{x:-3*i/6,y:0},{x:f,y:0},{x:f+3*i/6,y:-i},{x:0,y:-i}];let E;const{cssStyles:L}=t;if(t.look==="handDrawn"){const F=po.svg(a),G=vo(t,{}),q=gc(S),Q=F.path(q,G);E=a.insert(()=>Q,":first-child").attr("transform",`translate(${-f/2}, ${i/2})`),L&&E.attr("style",L)}else E=cv(a,f,i,S);return s&&E.attr("style",s),t.width=f,t.height=i,Eo(t,E),t.intersect=function(F){return co.polygon(t,S,F)},a}Ze(R6,"lean_right");function N6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.label="",t.labelStyle=n;const a=e.insert("g").attr("class",xa(t)).attr("id",t.domId??t.id),{cssStyles:d}=t,f=Math.max(35,(t==null?void 0:t.width)??0),i=Math.max(35,(t==null?void 0:t.height)??0),S=7,E=[{x:f,y:0},{x:0,y:i+S/2},{x:f-2*S,y:i+S/2},{x:0,y:2*i},{x:f,y:i-S/2},{x:2*S,y:i-S/2}],L=po.svg(a),F=vo(t,{});t.look!=="handDrawn"&&(F.roughness=0,F.fillStyle="solid");const G=gc(E),q=L.path(G,F),Q=a.insert(()=>q,":first-child");return d&&t.look!=="handDrawn"&&Q.selectAll("path").attr("style",d),s&&t.look!=="handDrawn"&&Q.selectAll("path").attr("style",s),Q.attr("transform",`translate(-${f/2},${-i})`),Eo(t,Q),t.intersect=function(te){return On.info("lightningBolt intersect",t,te),co.polygon(t,E,te)},a}Ze(N6,"lightningBolt");var zte=Ze((e,t,n,s,a,d,f)=>[`M${e},${t+d}`,`a${a},${d} 0,0,0 ${n},0`,`a${a},${d} 0,0,0 ${-n},0`,`l0,${s}`,`a${a},${d} 0,0,0 ${n},0`,`l0,${-s}`,`M${e},${t+d+f}`,`a${a},${d} 0,0,0 ${n},0`].join(" "),"createCylinderPathD"),Ute=Ze((e,t,n,s,a,d,f)=>[`M${e},${t+d}`,`M${e+n},${t+d}`,`a${a},${d} 0,0,0 ${-n},0`,`l0,${s}`,`a${a},${d} 0,0,0 ${n},0`,`l0,${-s}`,`M${e},${t+d+f}`,`a${a},${d} 0,0,0 ${n},0`].join(" "),"createOuterCylinderPathD"),$te=Ze((e,t,n,s,a,d)=>[`M${e-n/2},${-s/2}`,`a${a},${d} 0,0,0 ${n},0`].join(" "),"createInnerCylinderPathD");async function B6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0),t.width??0),S=i/2,E=S/(2.5+i/50),L=Math.max(d.height+E+(t.padding??0),t.height??0),F=L*.1;let G;const{cssStyles:q}=t;if(t.look==="handDrawn"){const Q=po.svg(a),te=Ute(0,0,i,L,S,E,F),he=$te(0,E,i,L,S,E),fe=vo(t,{}),le=Q.path(te,fe),Se=Q.path(he,fe);a.insert(()=>Se,":first-child").attr("class","line"),G=a.insert(()=>le,":first-child"),G.attr("class","basic label-container"),q&&G.attr("style",q)}else{const Q=zte(0,0,i,L,S,E,F);G=a.insert("path",":first-child").attr("d",Q).attr("class","basic label-container").attr("style",wm(q)).attr("style",s)}return G.attr("label-offset-y",E),G.attr("transform",`translate(${-i/2}, ${-(L/2+E)})`),Eo(t,G),f.attr("transform",`translate(${-(d.width/2)-(d.x-(d.left??0))}, ${-(d.height/2)+E-(d.y-(d.top??0))})`),t.intersect=function(Q){const te=co.rect(t,Q),he=te.x-(t.x??0);if(S!=0&&(Math.abs(he)<(t.width??0)/2||Math.abs(he)==(t.width??0)/2&&Math.abs(te.y-(t.y??0))>(t.height??0)/2-E)){let fe=E*E*(1-he*he/(S*S));fe>0&&(fe=Math.sqrt(fe)),fe=E-fe,Q.y-(t.y??0)>0&&(fe=-fe),te.y+=fe}return te},a}Ze(B6,"linedCylinder");async function F6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=S/4,L=S+E,{cssStyles:F}=t,G=po.svg(a),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=[{x:-i/2-i/2*.1,y:-L/2},{x:-i/2-i/2*.1,y:L/2},...lx(-i/2-i/2*.1,L/2,i/2+i/2*.1,L/2,E,.8),{x:i/2+i/2*.1,y:-L/2},{x:-i/2-i/2*.1,y:-L/2},{x:-i/2,y:-L/2},{x:-i/2,y:L/2*1.1},{x:-i/2,y:-L/2}],te=G.polygon(Q.map(fe=>[fe.x,fe.y]),q),he=a.insert(()=>te,":first-child");return he.attr("class","basic label-container"),F&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",F),s&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",s),he.attr("transform",`translate(0,${-E/2})`),f.attr("transform",`translate(${-i/2+(t.padding??0)+i/2*.1/2-(d.x-(d.left??0))},${-S/2+(t.padding??0)-E/2-(d.y-(d.top??0))})`),Eo(t,he),t.intersect=function(fe){return co.polygon(t,Q,fe)},a}Ze(F6,"linedWaveEdgedRect");async function z6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=5,L=-i/2,F=-S/2,{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{}),te=[{x:L-E,y:F+E},{x:L-E,y:F+S+E},{x:L+i-E,y:F+S+E},{x:L+i-E,y:F+S},{x:L+i,y:F+S},{x:L+i,y:F+S-E},{x:L+i+E,y:F+S-E},{x:L+i+E,y:F-E},{x:L+E,y:F-E},{x:L+E,y:F},{x:L,y:F},{x:L,y:F+E}],he=[{x:L,y:F+E},{x:L+i-E,y:F+E},{x:L+i-E,y:F+S},{x:L+i,y:F+S},{x:L+i,y:F},{x:L,y:F}];t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const fe=gc(te),le=q.path(fe,Q),Se=gc(he),ke=q.path(Se,{...Q,fill:"none"}),Ee=a.insert(()=>ke,":first-child");return Ee.insert(()=>le,":first-child"),Ee.attr("class","basic label-container"),G&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",G),s&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",s),f.attr("transform",`translate(${-(d.width/2)-E-(d.x-(d.left??0))}, ${-(d.height/2)+E-(d.y-(d.top??0))})`),Eo(t,Ee),t.intersect=function(Ie){return co.polygon(t,te,Ie)},a}Ze(z6,"multiRect");async function U6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=S/4,L=S+E,F=-i/2,G=-L/2,q=5,{cssStyles:Q}=t,te=lx(F-q,G+L+q,F+i-q,G+L+q,E,.8),he=te==null?void 0:te[te.length-1],fe=[{x:F-q,y:G+q},{x:F-q,y:G+L+q},...te,{x:F+i-q,y:he.y-q},{x:F+i,y:he.y-q},{x:F+i,y:he.y-2*q},{x:F+i+q,y:he.y-2*q},{x:F+i+q,y:G-q},{x:F+q,y:G-q},{x:F+q,y:G},{x:F,y:G},{x:F,y:G+q}],le=[{x:F,y:G+q},{x:F+i-q,y:G+q},{x:F+i-q,y:he.y-q},{x:F+i,y:he.y-q},{x:F+i,y:G},{x:F,y:G}],Se=po.svg(a),ke=vo(t,{});t.look!=="handDrawn"&&(ke.roughness=0,ke.fillStyle="solid");const Ee=gc(fe),Ie=Se.path(Ee,ke),He=gc(le),Ye=Se.path(He,ke),lt=a.insert(()=>Ie,":first-child");return lt.insert(()=>Ye),lt.attr("class","basic label-container"),Q&&t.look!=="handDrawn"&&lt.selectAll("path").attr("style",Q),s&&t.look!=="handDrawn"&&lt.selectAll("path").attr("style",s),lt.attr("transform",`translate(0,${-E/2})`),f.attr("transform",`translate(${-(d.width/2)-q-(d.x-(d.left??0))}, ${-(d.height/2)+q-E/2-(d.y-(d.top??0))})`),Eo(t,lt),t.intersect=function(Pt){return co.polygon(t,fe,Pt)},a}Ze(U6,"multiWaveEdgedRectangle");async function $6(e,t,{config:{themeVariables:n}}){var fe;const{labelStyles:s,nodeStyles:a}=ko(t);t.labelStyle=s,t.useHtmlLabels||((fe=ug().flowchart)==null?void 0:fe.htmlLabels)!==!1||(t.centerLabel=!0);const{shapeSvg:f,bbox:i}=await Na(e,t,xa(t)),S=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),E=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),L=-S/2,F=-E/2,{cssStyles:G}=t,q=po.svg(f),Q=vo(t,{fill:n.noteBkgColor,stroke:n.noteBorderColor});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const te=q.rectangle(L,F,S,E,Q),he=f.insert(()=>te,":first-child");return he.attr("class","basic label-container"),G&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",G),a&&t.look!=="handDrawn"&&he.selectAll("path").attr("style",a),Eo(t,he),t.intersect=function(le){return co.rect(t,le)},f}Ze($6,"note");var Vte=Ze((e,t,n)=>[`M${e+n/2},${t}`,`L${e+n},${t-n/2}`,`L${e+n/2},${t-n}`,`L${e},${t-n/2}`,"Z"].join(" "),"createDecisionBoxPathD");async function V6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=d.width+t.padding,i=d.height+t.padding,S=f+i,E=[{x:S/2,y:0},{x:S,y:-S/2},{x:S/2,y:-S},{x:0,y:-S/2}];let L;const{cssStyles:F}=t;if(t.look==="handDrawn"){const G=po.svg(a),q=vo(t,{}),Q=Vte(0,0,S),te=G.path(Q,q);L=a.insert(()=>te,":first-child").attr("transform",`translate(${-S/2}, ${S/2})`),F&&L.attr("style",F)}else L=cv(a,S,S,E);return s&&L.attr("style",s),Eo(t,L),t.intersect=function(G){return On.debug(`APA12 Intersect called SPLIT
point:`,G,`
node:
`,t,`
res:`,co.polygon(t,E,G)),co.polygon(t,E,G)},a}Ze(V6,"question");async function W6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0),(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0),(t==null?void 0:t.height)??0),E=-i/2,L=-S/2,F=L/2,G=[{x:E+F,y:L},{x:E,y:0},{x:E+F,y:-L},{x:-E,y:-L},{x:-E,y:L}],{cssStyles:q}=t,Q=po.svg(a),te=vo(t,{});t.look!=="handDrawn"&&(te.roughness=0,te.fillStyle="solid");const he=gc(G),fe=Q.path(he,te),le=a.insert(()=>fe,":first-child");return le.attr("class","basic label-container"),q&&t.look!=="handDrawn"&&le.selectAll("path").attr("style",q),s&&t.look!=="handDrawn"&&le.selectAll("path").attr("style",s),le.attr("transform",`translate(${-F/2},0)`),f.attr("transform",`translate(${-F/2-d.width/2-(d.x-(d.left??0))}, ${-(d.height/2)-(d.y-(d.top??0))})`),Eo(t,le),t.intersect=function(Se){return co.polygon(t,G,Se)},a}Ze(W6,"rect_left_inv_arrow");async function j6(e,t){var Ye,lt;const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;let a;t.cssClasses?a="node "+t.cssClasses:a="node default";const d=e.insert("g").attr("class",a).attr("id",t.domId||t.id),f=d.insert("g"),i=d.insert("g").attr("class","label").attr("style",s),S=t.description,E=t.label,L=i.node().appendChild(await tb(E,t.labelStyle,!0,!0));let F={width:0,height:0};if(cp((lt=(Ye=Bc())==null?void 0:Ye.flowchart)==null?void 0:lt.htmlLabels)){const Pt=L.children[0],At=mc(L);F=Pt.getBoundingClientRect(),At.attr("width",F.width),At.attr("height",F.height)}On.info("Text 2",S);const G=S||[],q=L.getBBox(),Q=i.node().appendChild(await tb(G.join?G.join("<br/>"):G,t.labelStyle,!0,!0)),te=Q.children[0],he=mc(Q);F=te.getBoundingClientRect(),he.attr("width",F.width),he.attr("height",F.height);const fe=(t.padding||0)/2;mc(Q).attr("transform","translate( "+(F.width>q.width?0:(q.width-F.width)/2)+", "+(q.height+fe+5)+")"),mc(L).attr("transform","translate( "+(F.width<q.width?0:-(q.width-F.width)/2)+", 0)"),F=i.node().getBBox(),i.attr("transform","translate("+-F.width/2+", "+(-F.height/2-fe+3)+")");const le=F.width+(t.padding||0),Se=F.height+(t.padding||0),ke=-F.width/2-fe,Ee=-F.height/2-fe;let Ie,He;if(t.look==="handDrawn"){const Pt=po.svg(d),At=vo(t,{}),ht=Pt.path(lv(ke,Ee,le,Se,t.rx||0),At),Ot=Pt.line(-F.width/2-fe,-F.height/2-fe+q.height+fe,F.width/2+fe,-F.height/2-fe+q.height+fe,At);He=d.insert(()=>(On.debug("Rough node insert CXC",ht),Ot),":first-child"),Ie=d.insert(()=>(On.debug("Rough node insert CXC",ht),ht),":first-child")}else Ie=f.insert("rect",":first-child"),He=f.insert("line"),Ie.attr("class","outer title-state").attr("style",s).attr("x",-F.width/2-fe).attr("y",-F.height/2-fe).attr("width",F.width+(t.padding||0)).attr("height",F.height+(t.padding||0)),He.attr("class","divider").attr("x1",-F.width/2-fe).attr("x2",F.width/2+fe).attr("y1",-F.height/2-fe+q.height+fe).attr("y2",-F.height/2-fe+q.height+fe);return Eo(t,Ie),t.intersect=function(Pt){return co.rect(t,Pt)},d}Ze(j6,"rectWithTitle");async function H6(e,t){const n={rx:5,ry:5,classes:"",labelPaddingX:((t==null?void 0:t.padding)||0)*1,labelPaddingY:((t==null?void 0:t.padding)||0)*1};return PT(e,t,n)}Ze(H6,"roundedRect");async function G6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=(t==null?void 0:t.padding)??0,S=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),E=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),L=-d.width/2-i,F=-d.height/2-i,{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const te=[{x:L,y:F},{x:L+S+8,y:F},{x:L+S+8,y:F+E},{x:L-8,y:F+E},{x:L-8,y:F},{x:L,y:F},{x:L,y:F+E}],he=q.polygon(te.map(le=>[le.x,le.y]),Q),fe=a.insert(()=>he,":first-child");return fe.attr("class","basic label-container").attr("style",wm(G)),s&&t.look!=="handDrawn"&&fe.selectAll("path").attr("style",s),G&&t.look!=="handDrawn"&&fe.selectAll("path").attr("style",s),f.attr("transform",`translate(${-S/2+4+(t.padding??0)-(d.x-(d.left??0))},${-E/2+(t.padding??0)-(d.y-(d.top??0))})`),Eo(t,fe),t.intersect=function(le){return co.rect(t,le)},a}Ze(G6,"shadedProcess");async function q6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=-i/2,L=-S/2,{cssStyles:F}=t,G=po.svg(a),q=vo(t,{});t.look!=="handDrawn"&&(q.roughness=0,q.fillStyle="solid");const Q=[{x:E,y:L},{x:E,y:L+S},{x:E+i,y:L+S},{x:E+i,y:L-S/2}],te=gc(Q),he=G.path(te,q),fe=a.insert(()=>he,":first-child");return fe.attr("class","basic label-container"),F&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",F),s&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",s),fe.attr("transform",`translate(0, ${S/4})`),f.attr("transform",`translate(${-i/2+(t.padding??0)-(d.x-(d.left??0))}, ${-S/4+(t.padding??0)-(d.y-(d.top??0))})`),Eo(t,fe),t.intersect=function(le){return co.polygon(t,Q,le)},a}Ze(q6,"slopedRect");async function Y6(e,t){const n={rx:0,ry:0,classes:"",labelPaddingX:((t==null?void 0:t.padding)||0)*2,labelPaddingY:((t==null?void 0:t.padding)||0)*1};return PT(e,t,n)}Ze(Y6,"squareRect");async function X6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=d.height+t.padding,i=d.width+f/4+t.padding;let S;const{cssStyles:E}=t;if(t.look==="handDrawn"){const L=po.svg(a),F=vo(t,{}),G=lv(-i/2,-f/2,i,f,f/2),q=L.path(G,F);S=a.insert(()=>q,":first-child"),S.attr("class","basic label-container").attr("style",wm(E))}else S=a.insert("rect",":first-child"),S.attr("class","basic label-container").attr("style",s).attr("rx",f/2).attr("ry",f/2).attr("x",-i/2).attr("y",-f/2).attr("width",i).attr("height",f);return Eo(t,S),t.intersect=function(L){return co.rect(t,L)},a}Ze(X6,"stadium");async function Z6(e,t){return PT(e,t,{rx:5,ry:5,classes:"flowchart-node"})}Ze(Z6,"state");function K6(e,t,{config:{themeVariables:n}}){const{labelStyles:s,nodeStyles:a}=ko(t);t.labelStyle=s;const{cssStyles:d}=t,{lineColor:f,stateBorder:i,nodeBorder:S}=n,E=e.insert("g").attr("class","node default").attr("id",t.domId||t.id),L=po.svg(E),F=vo(t,{});t.look!=="handDrawn"&&(F.roughness=0,F.fillStyle="solid");const G=L.circle(0,0,14,{...F,stroke:f,strokeWidth:2}),q=i??S,Q=L.circle(0,0,5,{...F,fill:q,stroke:q,strokeWidth:2,fillStyle:"solid"}),te=E.insert(()=>G,":first-child");return te.insert(()=>Q),d&&te.selectAll("path").attr("style",d),a&&te.selectAll("path").attr("style",a),Eo(t,te),t.intersect=function(he){return co.circle(t,7,he)},E}Ze(K6,"stateEnd");function Q6(e,t,{config:{themeVariables:n}}){const{lineColor:s}=n,a=e.insert("g").attr("class","node default").attr("id",t.domId||t.id);let d;if(t.look==="handDrawn"){const i=po.svg(a).circle(0,0,14,aY(s));d=a.insert(()=>i),d.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14)}else d=a.insert("circle",":first-child"),d.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14);return Eo(t,d),t.intersect=function(f){return co.circle(t,7,f)},a}Ze(Q6,"stateStart");async function J6(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=((t==null?void 0:t.padding)||0)/2,i=d.width+t.padding,S=d.height+t.padding,E=-d.width/2-f,L=-d.height/2-f,F=[{x:0,y:0},{x:i,y:0},{x:i,y:-S},{x:0,y:-S},{x:0,y:0},{x:-8,y:0},{x:i+8,y:0},{x:i+8,y:-S},{x:-8,y:-S},{x:-8,y:0}];if(t.look==="handDrawn"){const G=po.svg(a),q=vo(t,{}),Q=G.rectangle(E-8,L,i+16,S,q),te=G.line(E,L,E,L+S,q),he=G.line(E+i,L,E+i,L+S,q);a.insert(()=>te,":first-child"),a.insert(()=>he,":first-child");const fe=a.insert(()=>Q,":first-child"),{cssStyles:le}=t;fe.attr("class","basic label-container").attr("style",wm(le)),Eo(t,fe)}else{const G=cv(a,i,S,F);s&&G.attr("style",s),Eo(t,G)}return t.intersect=function(G){return co.polygon(t,F,G)},a}Ze(J6,"subroutine");async function eU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),i=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),S=-f/2,E=-i/2,L=.2*i,F=.2*i,{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{}),te=[{x:S-L/2,y:E},{x:S+f+L/2,y:E},{x:S+f+L/2,y:E+i},{x:S-L/2,y:E+i}],he=[{x:S+f-L/2,y:E+i},{x:S+f+L/2,y:E+i},{x:S+f+L/2,y:E+i-F}];t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const fe=gc(te),le=q.path(fe,Q),Se=gc(he),ke=q.path(Se,{...Q,fillStyle:"solid"}),Ee=a.insert(()=>ke,":first-child");return Ee.insert(()=>le,":first-child"),Ee.attr("class","basic label-container"),G&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",G),s&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",s),Eo(t,Ee),t.intersect=function(Ie){return co.polygon(t,te,Ie)},a}Ze(eU,"taggedRect");async function tU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=S/4,L=.2*i,F=.2*S,G=S+E,{cssStyles:q}=t,Q=po.svg(a),te=vo(t,{});t.look!=="handDrawn"&&(te.roughness=0,te.fillStyle="solid");const he=[{x:-i/2-i/2*.1,y:G/2},...lx(-i/2-i/2*.1,G/2,i/2+i/2*.1,G/2,E,.8),{x:i/2+i/2*.1,y:-G/2},{x:-i/2-i/2*.1,y:-G/2}],fe=-i/2+i/2*.1,le=-G/2-F*.4,Se=[{x:fe+i-L,y:(le+S)*1.4},{x:fe+i,y:le+S-F},{x:fe+i,y:(le+S)*.9},...lx(fe+i,(le+S)*1.3,fe+i-L,(le+S)*1.5,-S*.03,.5)],ke=gc(he),Ee=Q.path(ke,te),Ie=gc(Se),He=Q.path(Ie,{...te,fillStyle:"solid"}),Ye=a.insert(()=>He,":first-child");return Ye.insert(()=>Ee,":first-child"),Ye.attr("class","basic label-container"),q&&t.look!=="handDrawn"&&Ye.selectAll("path").attr("style",q),s&&t.look!=="handDrawn"&&Ye.selectAll("path").attr("style",s),Ye.attr("transform",`translate(0,${-E/2})`),f.attr("transform",`translate(${-i/2+(t.padding??0)-(d.x-(d.left??0))},${-S/2+(t.padding??0)-E/2-(d.y-(d.top??0))})`),Eo(t,Ye),t.intersect=function(lt){return co.polygon(t,he,lt)},a}Ze(tU,"taggedWaveEdgedRectangle");async function iU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=Math.max(d.width+t.padding,(t==null?void 0:t.width)||0),i=Math.max(d.height+t.padding,(t==null?void 0:t.height)||0),S=-f/2,E=-i/2,L=a.insert("rect",":first-child");return L.attr("class","text").attr("style",s).attr("rx",0).attr("ry",0).attr("x",S).attr("y",E).attr("width",f).attr("height",i),Eo(t,L),t.intersect=function(F){return co.rect(t,F)},a}Ze(iU,"text");var Wte=Ze((e,t,n,s,a,d)=>`M${e},${t}
    a${a},${d} 0,0,1 0,${-s}
    l${n},0
    a${a},${d} 0,0,1 0,${s}
    M${n},${-s}
    a${a},${d} 0,0,0 0,${s}
    l${-n},0`,"createCylinderPathD"),jte=Ze((e,t,n,s,a,d)=>[`M${e},${t}`,`M${e+n},${t}`,`a${a},${d} 0,0,0 0,${-s}`,`l${-n},0`,`a${a},${d} 0,0,0 0,${s}`,`l${n},0`].join(" "),"createOuterCylinderPathD"),Hte=Ze((e,t,n,s,a,d)=>[`M${e+n/2},${-s/2}`,`a${a},${d} 0,0,0 0,${s}`].join(" "),"createInnerCylinderPathD");async function rU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f,halfPadding:i}=await Na(e,t,xa(t)),S=t.look==="neo"?i*2:i,E=d.height+S,L=E/2,F=L/(2.5+E/50),G=d.width+F+S,{cssStyles:q}=t;let Q;if(t.look==="handDrawn"){const te=po.svg(a),he=jte(0,0,G,E,F,L),fe=Hte(0,0,G,E,F,L),le=te.path(he,vo(t,{})),Se=te.path(fe,vo(t,{fill:"none"}));Q=a.insert(()=>Se,":first-child"),Q=a.insert(()=>le,":first-child"),Q.attr("class","basic label-container"),q&&Q.attr("style",q)}else{const te=Wte(0,0,G,E,F,L);Q=a.insert("path",":first-child").attr("d",te).attr("class","basic label-container").attr("style",wm(q)).attr("style",s),Q.attr("class","basic label-container"),q&&Q.selectAll("path").attr("style",q),s&&Q.selectAll("path").attr("style",s)}return Q.attr("label-offset-x",F),Q.attr("transform",`translate(${-G/2}, ${E/2} )`),f.attr("transform",`translate(${-(d.width/2)-F-(d.x-(d.left??0))}, ${-(d.height/2)-(d.y-(d.top??0))})`),Eo(t,Q),t.intersect=function(te){const he=co.rect(t,te),fe=he.y-(t.y??0);if(L!=0&&(Math.abs(fe)<(t.height??0)/2||Math.abs(fe)==(t.height??0)/2&&Math.abs(he.x-(t.x??0))>(t.width??0)/2-F)){let le=F*F*(1-fe*fe/(L*L));le!=0&&(le=Math.sqrt(Math.abs(le))),le=F-le,te.x-(t.x??0)>0&&(le=-le),he.x+=le}return he},a}Ze(rU,"tiltedCylinder");async function nU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=d.width+t.padding,i=d.height+t.padding,S=[{x:-3*i/6,y:0},{x:f+3*i/6,y:0},{x:f,y:-i},{x:0,y:-i}];let E;const{cssStyles:L}=t;if(t.look==="handDrawn"){const F=po.svg(a),G=vo(t,{}),q=gc(S),Q=F.path(q,G);E=a.insert(()=>Q,":first-child").attr("transform",`translate(${-f/2}, ${i/2})`),L&&E.attr("style",L)}else E=cv(a,f,i,S);return s&&E.attr("style",s),t.width=f,t.height=i,Eo(t,E),t.intersect=function(F){return co.polygon(t,S,F)},a}Ze(nU,"trapezoid");async function sU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=60,i=20,S=Math.max(f,d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),E=Math.max(i,d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),{cssStyles:L}=t,F=po.svg(a),G=vo(t,{});t.look!=="handDrawn"&&(G.roughness=0,G.fillStyle="solid");const q=[{x:-S/2*.8,y:-E/2},{x:S/2*.8,y:-E/2},{x:S/2,y:-E/2*.6},{x:S/2,y:E/2},{x:-S/2,y:E/2},{x:-S/2,y:-E/2*.6}],Q=gc(q),te=F.path(Q,G),he=a.insert(()=>te,":first-child");return he.attr("class","basic label-container"),L&&t.look!=="handDrawn"&&he.selectChildren("path").attr("style",L),s&&t.look!=="handDrawn"&&he.selectChildren("path").attr("style",s),Eo(t,he),t.intersect=function(fe){return co.polygon(t,q,fe)},a}Ze(sU,"trapezoidalPentagon");async function oU(e,t){var le;const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=cp((le=Bc().flowchart)==null?void 0:le.htmlLabels),S=d.width+(t.padding??0),E=S+d.height,L=S+d.height,F=[{x:0,y:0},{x:L,y:0},{x:L/2,y:-E}],{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const te=gc(F),he=q.path(te,Q),fe=a.insert(()=>he,":first-child").attr("transform",`translate(${-E/2}, ${E/2})`);return G&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",G),s&&t.look!=="handDrawn"&&fe.selectChildren("path").attr("style",s),t.width=S,t.height=E,Eo(t,fe),f.attr("transform",`translate(${-d.width/2-(d.x-(d.left??0))}, ${E/2-(d.height+(t.padding??0)/(i?2:1)-(d.y-(d.top??0)))})`),t.intersect=function(Se){return On.info("Triangle intersect",t,F,Se),co.polygon(t,F,Se)},a}Ze(oU,"triangle");async function aU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=S/8,L=S+E,{cssStyles:F}=t,q=70-i,Q=q>0?q/2:0,te=po.svg(a),he=vo(t,{});t.look!=="handDrawn"&&(he.roughness=0,he.fillStyle="solid");const fe=[{x:-i/2-Q,y:L/2},...lx(-i/2-Q,L/2,i/2+Q,L/2,E,.8),{x:i/2+Q,y:-L/2},{x:-i/2-Q,y:-L/2}],le=gc(fe),Se=te.path(le,he),ke=a.insert(()=>Se,":first-child");return ke.attr("class","basic label-container"),F&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",F),s&&t.look!=="handDrawn"&&ke.selectAll("path").attr("style",s),ke.attr("transform",`translate(0,${-E/2})`),f.attr("transform",`translate(${-i/2+(t.padding??0)-(d.x-(d.left??0))},${-S/2+(t.padding??0)-E-(d.y-(d.top??0))})`),Eo(t,ke),t.intersect=function(Ee){return co.polygon(t,fe,Ee)},a}Ze(aU,"waveEdgedRectangle");async function lU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d}=await Na(e,t,xa(t)),f=100,i=50,S=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),E=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),L=S/E;let F=S,G=E;F>G*L?G=F/L:F=G*L,F=Math.max(F,f),G=Math.max(G,i);const q=Math.min(G*.2,G/4),Q=G+q*2,{cssStyles:te}=t,he=po.svg(a),fe=vo(t,{});t.look!=="handDrawn"&&(fe.roughness=0,fe.fillStyle="solid");const le=[{x:-F/2,y:Q/2},...lx(-F/2,Q/2,F/2,Q/2,q,1),{x:F/2,y:-Q/2},...lx(F/2,-Q/2,-F/2,-Q/2,q,-1)],Se=gc(le),ke=he.path(Se,fe),Ee=a.insert(()=>ke,":first-child");return Ee.attr("class","basic label-container"),te&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",te),s&&t.look!=="handDrawn"&&Ee.selectAll("path").attr("style",s),Eo(t,Ee),t.intersect=function(Ie){return co.polygon(t,le,Ie)},a}Ze(lU,"waveRectangle");async function cU(e,t){const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const{shapeSvg:a,bbox:d,label:f}=await Na(e,t,xa(t)),i=Math.max(d.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),S=Math.max(d.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),E=5,L=-i/2,F=-S/2,{cssStyles:G}=t,q=po.svg(a),Q=vo(t,{}),te=[{x:L-E,y:F-E},{x:L-E,y:F+S},{x:L+i,y:F+S},{x:L+i,y:F-E}],he=`M${L-E},${F-E} L${L+i},${F-E} L${L+i},${F+S} L${L-E},${F+S} L${L-E},${F-E}
                M${L-E},${F} L${L+i},${F}
                M${L},${F-E} L${L},${F+S}`;t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const fe=q.path(he,Q),le=a.insert(()=>fe,":first-child");return le.attr("transform",`translate(${E/2}, ${E/2})`),le.attr("class","basic label-container"),G&&t.look!=="handDrawn"&&le.selectAll("path").attr("style",G),s&&t.look!=="handDrawn"&&le.selectAll("path").attr("style",s),f.attr("transform",`translate(${-(d.width/2)+E/2-(d.x-(d.left??0))}, ${-(d.height/2)+E/2-(d.y-(d.top??0))})`),Eo(t,le),t.intersect=function(Se){return co.polygon(t,te,Se)},a}Ze(cU,"windowPane");async function fD(e,t){var ei,ur,Zt,Kt;const n=t;if(n.alias&&(t.label=n.alias),t.look==="handDrawn"){const{themeVariables:Ui}=ug(),{background:rr}=Ui,gi={...t,id:t.id+"-background",look:"default",cssStyles:["stroke: none",`fill: ${rr}`]};await fD(e,gi)}const s=ug();t.useHtmlLabels=s.htmlLabels;let a=((ei=s.er)==null?void 0:ei.diagramPadding)??10,d=((ur=s.er)==null?void 0:ur.entityPadding)??6;const{cssStyles:f}=t,{labelStyles:i,nodeStyles:S}=ko(t);if(n.attributes.length===0&&t.label){const Ui={rx:0,ry:0,labelPaddingX:a,labelPaddingY:a*1.5,classes:""};sv(t.label,s)+Ui.labelPaddingX*2<s.er.minEntityWidth&&(t.width=s.er.minEntityWidth);const rr=await PT(e,t,Ui);if(!cp(s.htmlLabels)){const gi=rr.select("text"),Oi=(Zt=gi.node())==null?void 0:Zt.getBBox();gi.attr("transform",`translate(${-Oi.width/2}, 0)`)}return rr}s.htmlLabels||(a*=1.25,d*=1.25);let E=xa(t);E||(E="node default");const L=e.insert("g").attr("class",E).attr("id",t.domId||t.id),F=await b1(L,t.label??"",s,0,0,["name"],i);F.height+=d;let G=0;const q=[],Q=[];let te=0,he=0,fe=0,le=0,Se=!0,ke=!0;for(const Ui of n.attributes){const rr=await b1(L,Ui.type,s,0,G,["attribute-type"],i);te=Math.max(te,rr.width+a);const gi=await b1(L,Ui.name,s,0,G,["attribute-name"],i);he=Math.max(he,gi.width+a);const Oi=await b1(L,Ui.keys.join(),s,0,G,["attribute-keys"],i);fe=Math.max(fe,Oi.width+a);const cr=await b1(L,Ui.comment,s,0,G,["attribute-comment"],i);le=Math.max(le,cr.width+a);const ji=Math.max(rr.height,gi.height,Oi.height,cr.height)+d;Q.push({yOffset:G,rowHeight:ji}),G+=ji}let Ee=4;fe<=a&&(Se=!1,fe=0,Ee--),le<=a&&(ke=!1,le=0,Ee--);const Ie=L.node().getBBox();if(F.width+a*2-(te+he+fe+le)>0){const Ui=F.width+a*2-(te+he+fe+le);te+=Ui/Ee,he+=Ui/Ee,fe>0&&(fe+=Ui/Ee),le>0&&(le+=Ui/Ee)}const He=te+he+fe+le,Ye=po.svg(L),lt=vo(t,{});t.look!=="handDrawn"&&(lt.roughness=0,lt.fillStyle="solid");let Pt=0;Q.length>0&&(Pt=Q.reduce((Ui,rr)=>Ui+((rr==null?void 0:rr.rowHeight)??0),0));const At=Math.max(Ie.width+a*2,(t==null?void 0:t.width)||0,He),ht=Math.max((Pt??0)+F.height,(t==null?void 0:t.height)||0),Ot=-At/2,Ae=-ht/2;L.selectAll("g:not(:first-child)").each((Ui,rr,gi)=>{const Oi=mc(gi[rr]),cr=Oi.attr("transform");let ji=0,nn=0;if(cr){const Ue=RegExp(/translate\(([^,]+),([^)]+)\)/).exec(cr);Ue&&(ji=parseFloat(Ue[1]),nn=parseFloat(Ue[2]),Oi.attr("class").includes("attribute-name")?ji+=te:Oi.attr("class").includes("attribute-keys")?ji+=te+he:Oi.attr("class").includes("attribute-comment")&&(ji+=te+he+fe))}Oi.attr("transform",`translate(${Ot+a/2+ji}, ${nn+Ae+F.height+d/2})`)}),L.select(".name").attr("transform","translate("+-F.width/2+", "+(Ae+d/2)+")");const mt=Ye.rectangle(Ot,Ae,At,ht,lt),bt=L.insert(()=>mt,":first-child").attr("style",f.join("")),{themeVariables:Dt}=ug(),{rowEven:Je,rowOdd:dt,nodeBorder:ui}=Dt;q.push(0);for(const[Ui,rr]of Q.entries()){const Oi=(Ui+1)%2===0&&rr.yOffset!==0,cr=Ye.rectangle(Ot,F.height+Ae+(rr==null?void 0:rr.yOffset),At,rr==null?void 0:rr.rowHeight,{...lt,fill:Oi?Je:dt,stroke:ui});L.insert(()=>cr,"g.label").attr("style",f.join("")).attr("class",`row-rect-${Oi?"even":"odd"}`)}let Vt=Ye.line(Ot,F.height+Ae,At+Ot,F.height+Ae,lt);L.insert(()=>Vt).attr("class","divider"),Vt=Ye.line(te+Ot,F.height+Ae,te+Ot,ht+Ae,lt),L.insert(()=>Vt).attr("class","divider"),Se&&(Vt=Ye.line(te+he+Ot,F.height+Ae,te+he+Ot,ht+Ae,lt),L.insert(()=>Vt).attr("class","divider")),ke&&(Vt=Ye.line(te+he+fe+Ot,F.height+Ae,te+he+fe+Ot,ht+Ae,lt),L.insert(()=>Vt).attr("class","divider"));for(const Ui of q)Vt=Ye.line(Ot,F.height+Ae+Ui,At+Ot,F.height+Ae+Ui,lt),L.insert(()=>Vt).attr("class","divider");if(Eo(t,bt),S&&t.look!=="handDrawn"){const Ui=S.split(";"),rr=(Kt=Ui==null?void 0:Ui.filter(gi=>gi.includes("stroke")))==null?void 0:Kt.map(gi=>`${gi}`).join("; ");L.selectAll("path").attr("style",rr??""),L.selectAll(".row-rect-even path").attr("style",S)}return t.intersect=function(Ui){return co.rect(t,Ui)},L}Ze(fD,"erBox");async function b1(e,t,n,s=0,a=0,d=[],f=""){const i=e.insert("g").attr("class",`label ${d.join(" ")}`).attr("transform",`translate(${s}, ${a})`).attr("style",f);t!==WO(t)&&(t=WO(t),t=t.replaceAll("<","&lt;").replaceAll(">","&gt;"));const S=i.node().appendChild(await ux(i,t,{width:sv(t,n)+100,style:f,useHtmlLabels:n.htmlLabels},n));if(t.includes("&lt;")||t.includes("&gt;")){let L=S.children[0];for(L.textContent=L.textContent.replaceAll("&lt;","<").replaceAll("&gt;",">");L.childNodes[0];)L=L.childNodes[0],L.textContent=L.textContent.replaceAll("&lt;","<").replaceAll("&gt;",">")}let E=S.getBBox();if(cp(n.htmlLabels)){const L=S.children[0];L.style.textAlign="start";const F=mc(S);E=L.getBoundingClientRect(),F.attr("width",E.width),F.attr("height",E.height)}return E}Ze(b1,"addText");async function hU(e,t,n,s,a=n.class.padding??12){const d=s?0:3,f=e.insert("g").attr("class",xa(t)).attr("id",t.domId||t.id);let i=null,S=null,E=null,L=null,F=0,G=0,q=0;if(i=f.insert("g").attr("class","annotation-group text"),t.annotations.length>0){const le=t.annotations[0];await SS(i,{text:`${le}`},0),F=i.node().getBBox().height}S=f.insert("g").attr("class","label-group text"),await SS(S,t,0,["font-weight: bolder"]);const Q=S.node().getBBox();G=Q.height,E=f.insert("g").attr("class","members-group text");let te=0;for(const le of t.members){const Se=await SS(E,le,te,[le.parseClassifier()]);te+=Se+d}q=E.node().getBBox().height,q<=0&&(q=a/2),L=f.insert("g").attr("class","methods-group text");let he=0;for(const le of t.methods){const Se=await SS(L,le,he,[le.parseClassifier()]);he+=Se+d}let fe=f.node().getBBox();if(i!==null){const le=i.node().getBBox();i.attr("transform",`translate(${-le.width/2})`)}return S.attr("transform",`translate(${-Q.width/2}, ${F})`),fe=f.node().getBBox(),E.attr("transform",`translate(0, ${F+G+a*2})`),fe=f.node().getBBox(),L.attr("transform",`translate(0, ${F+G+(q?q+a*4:a*2)})`),fe=f.node().getBBox(),{shapeSvg:f,bbox:fe}}Ze(hU,"textHelper");async function SS(e,t,n,s=[]){const a=e.insert("g").attr("class","label").attr("style",s.join("; ")),d=ug();let f="useHtmlLabels"in t?t.useHtmlLabels:cp(d.htmlLabels)??!0,i="";"text"in t?i=t.text:i=t.label,!f&&i.startsWith("\\")&&(i=i.substring(1)),U1(i)&&(f=!0);const S=await ux(a,G2(bb(i)),{width:sv(i,d)+50,classes:"markdown-node-label",useHtmlLabels:f},d);let E,L=1;if(f){const F=S.children[0],G=mc(S);L=F.innerHTML.split("<br>").length,F.innerHTML.includes("</math>")&&(L+=F.innerHTML.split("<mrow>").length-1);const q=F.getElementsByTagName("img");if(q){const Q=i.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...q].map(te=>new Promise(he=>{function fe(){var le;if(te.style.display="flex",te.style.flexDirection="column",Q){const Se=((le=d.fontSize)==null?void 0:le.toString())??window.getComputedStyle(document.body).fontSize,ke=5,Ee=parseInt(Se,10)*ke+"px";te.style.minWidth=Ee,te.style.maxWidth=Ee}else te.style.width="100%";he(te)}Ze(fe,"setupImage"),setTimeout(()=>{te.complete&&fe()}),te.addEventListener("error",fe),te.addEventListener("load",fe)})))}E=F.getBoundingClientRect(),G.attr("width",E.width),G.attr("height",E.height)}else{s.includes("font-weight: bolder")&&mc(S).selectAll("tspan").attr("font-weight",""),L=S.children.length;const F=S.children[0];(S.textContent===""||S.textContent.includes("&gt"))&&(F.textContent=i[0]+i.substring(1).replaceAll("&gt;",">").replaceAll("&lt;","<").trim(),i[1]===" "&&(F.textContent=F.textContent[0]+" "+F.textContent.substring(1))),F.textContent==="undefined"&&(F.textContent=""),E=S.getBBox()}return a.attr("transform","translate(0,"+(-E.height/(2*L)+n)+")"),E.height}Ze(SS,"addText");async function uU(e,t){var lt,Pt;const n=Bc(),s=n.class.padding??12,a=s,d=t.useHtmlLabels??cp(n.htmlLabels)??!0,f=t;f.annotations=f.annotations??[],f.members=f.members??[],f.methods=f.methods??[];const{shapeSvg:i,bbox:S}=await hU(e,t,n,d,a),{labelStyles:E,nodeStyles:L}=ko(t);t.labelStyle=E,t.cssStyles=f.styles||"";const F=((lt=f.styles)==null?void 0:lt.join(";"))||L||"";t.cssStyles||(t.cssStyles=F.replaceAll("!important","").split(";"));const G=f.members.length===0&&f.methods.length===0&&!((Pt=n.class)!=null&&Pt.hideEmptyMembersBox),q=po.svg(i),Q=vo(t,{});t.look!=="handDrawn"&&(Q.roughness=0,Q.fillStyle="solid");const te=S.width;let he=S.height;f.members.length===0&&f.methods.length===0?he+=a:f.members.length>0&&f.methods.length===0&&(he+=a*2);const fe=-te/2,le=-he/2,Se=q.rectangle(fe-s,le-s-(G?s:f.members.length===0&&f.methods.length===0?-s/2:0),te+2*s,he+2*s+(G?s*2:f.members.length===0&&f.methods.length===0?-s:0),Q),ke=i.insert(()=>Se,":first-child");ke.attr("class","basic label-container");const Ee=ke.node().getBBox();i.selectAll(".text").each((At,ht,Ot)=>{var dt;const Ae=mc(Ot[ht]),mt=Ae.attr("transform");let bt=0;if(mt){const Vt=RegExp(/translate\(([^,]+),([^)]+)\)/).exec(mt);Vt&&(bt=parseFloat(Vt[2]))}let Dt=bt+le+s-(G?s:f.members.length===0&&f.methods.length===0?-s/2:0);d||(Dt-=4);let Je=fe;(Ae.attr("class").includes("label-group")||Ae.attr("class").includes("annotation-group"))&&(Je=-((dt=Ae.node())==null?void 0:dt.getBBox().width)/2||0,i.selectAll("text").each(function(ui,Vt,ei){window.getComputedStyle(ei[Vt]).textAnchor==="middle"&&(Je=0)})),Ae.attr("transform",`translate(${Je}, ${Dt})`)});const Ie=i.select(".annotation-group").node().getBBox().height-(G?s/2:0)||0,He=i.select(".label-group").node().getBBox().height-(G?s/2:0)||0,Ye=i.select(".members-group").node().getBBox().height-(G?s/2:0)||0;if(f.members.length>0||f.methods.length>0||G){const At=q.line(Ee.x,Ie+He+le+s,Ee.x+Ee.width,Ie+He+le+s,Q);i.insert(()=>At).attr("class","divider").attr("style",F)}if(G||f.members.length>0||f.methods.length>0){const At=q.line(Ee.x,Ie+He+Ye+le+a*2+s,Ee.x+Ee.width,Ie+He+Ye+le+s+a*2,Q);i.insert(()=>At).attr("class","divider").attr("style",F)}if(f.look!=="handDrawn"&&i.selectAll("path").attr("style",F),ke.select(":nth-child(2)").attr("style",F),i.selectAll(".divider").select("path").attr("style",F),t.labelStyle?i.selectAll("span").attr("style",t.labelStyle):i.selectAll("span").attr("style",F),!d){const At=RegExp(/color\s*:\s*([^;]*)/),ht=At.exec(F);if(ht){const Ot=ht[0].replace("color","fill");i.selectAll("tspan").attr("style",Ot)}else if(E){const Ot=At.exec(E);if(Ot){const Ae=Ot[0].replace("color","fill");i.selectAll("tspan").attr("style",Ae)}}}return Eo(t,ke),t.intersect=function(At){return co.rect(t,At)},i}Ze(uU,"classBox");async function dU(e,t){var Ie,He;const{labelStyles:n,nodeStyles:s}=ko(t);t.labelStyle=n;const a=t,d=t,f=20,i=20,S="verifyMethod"in t,E=xa(t),L=e.insert("g").attr("class",E).attr("id",t.domId??t.id);let F;S?F=await o_(L,`&lt;&lt;${a.type}&gt;&gt;`,0,t.labelStyle):F=await o_(L,"&lt;&lt;Element&gt;&gt;",0,t.labelStyle);let G=F;const q=await o_(L,a.name,G,t.labelStyle+"; font-weight: bold;");if(G+=q+i,S){const Ye=await o_(L,`${a.requirementId?`id: ${a.requirementId}`:""}`,G,t.labelStyle);G+=Ye;const lt=await o_(L,`${a.text?`Text: ${a.text}`:""}`,G,t.labelStyle);G+=lt;const Pt=await o_(L,`${a.risk?`Risk: ${a.risk}`:""}`,G,t.labelStyle);G+=Pt,await o_(L,`${a.verifyMethod?`Verification: ${a.verifyMethod}`:""}`,G,t.labelStyle)}else{const Ye=await o_(L,`${d.type?`Type: ${d.type}`:""}`,G,t.labelStyle);G+=Ye,await o_(L,`${d.docRef?`Doc Ref: ${d.docRef}`:""}`,G,t.labelStyle)}const Q=(((Ie=L.node())==null?void 0:Ie.getBBox().width)??200)+f,te=(((He=L.node())==null?void 0:He.getBBox().height)??200)+f,he=-Q/2,fe=-te/2,le=po.svg(L),Se=vo(t,{});t.look!=="handDrawn"&&(Se.roughness=0,Se.fillStyle="solid");const ke=le.rectangle(he,fe,Q,te,Se),Ee=L.insert(()=>ke,":first-child");if(Ee.attr("class","basic label-container").attr("style",s),L.selectAll(".label").each((Ye,lt,Pt)=>{const At=mc(Pt[lt]),ht=At.attr("transform");let Ot=0,Ae=0;if(ht){const Je=RegExp(/translate\(([^,]+),([^)]+)\)/).exec(ht);Je&&(Ot=parseFloat(Je[1]),Ae=parseFloat(Je[2]))}const mt=Ae-te/2;let bt=he+f/2;(lt===0||lt===1)&&(bt=Ot),At.attr("transform",`translate(${bt}, ${mt+f})`)}),G>F+q+i){const Ye=le.line(he,fe+F+q+i,he+Q,fe+F+q+i,Se);L.insert(()=>Ye).attr("style",s)}return Eo(t,Ee),t.intersect=function(Ye){return co.rect(t,Ye)},L}Ze(dU,"requirementBox");async function o_(e,t,n,s=""){if(t==="")return 0;const a=e.insert("g").attr("class","label").attr("style",s),d=Bc(),f=d.htmlLabels??!0,i=await ux(a,G2(bb(t)),{width:sv(t,d)+50,classes:"markdown-node-label",useHtmlLabels:f,style:s},d);let S;if(f){const E=i.children[0],L=mc(i);S=E.getBoundingClientRect(),L.attr("width",S.width),L.attr("height",S.height)}else{const E=i.children[0];for(const L of E.children)L.textContent=L.textContent.replaceAll("&gt;",">").replaceAll("&lt;","<"),s&&L.setAttribute("style",s);S=i.getBBox(),S.height+=6}return a.attr("transform",`translate(${-S.width/2},${-S.height/2+n})`),S.height}Ze(o_,"addText");var Gte=Ze(e=>{switch(e){case"Very High":return"red";case"High":return"orange";case"Medium":return null;case"Low":return"blue";case"Very Low":return"lightblue"}},"colorFromPriority");async function pU(e,t,{config:n}){var ht,Ot;const{labelStyles:s,nodeStyles:a}=ko(t);t.labelStyle=s||"";const d=10,f=t.width;t.width=(t.width??200)-10;const{shapeSvg:i,bbox:S,label:E}=await Na(e,t,xa(t)),L=t.padding||10;let F="",G;"ticket"in t&&t.ticket&&((ht=n==null?void 0:n.kanban)!=null&&ht.ticketBaseUrl)&&(F=(Ot=n==null?void 0:n.kanban)==null?void 0:Ot.ticketBaseUrl.replace("#TICKET#",t.ticket),G=i.insert("svg:a",":first-child").attr("class","kanban-ticket-link").attr("xlink:href",F).attr("target","_blank"));const q={useHtmlLabels:t.useHtmlLabels,labelStyle:t.labelStyle||"",width:t.width,img:t.img,padding:t.padding||8,centerLabel:!1};let Q,te;G?{label:Q,bbox:te}=await RA(G,"ticket"in t&&t.ticket||"",q):{label:Q,bbox:te}=await RA(i,"ticket"in t&&t.ticket||"",q);const{label:he,bbox:fe}=await RA(i,"assigned"in t&&t.assigned||"",q);t.width=f;const le=10,Se=(t==null?void 0:t.width)||0,ke=Math.max(te.height,fe.height)/2,Ee=Math.max(S.height+le*2,(t==null?void 0:t.height)||0)+ke,Ie=-Se/2,He=-Ee/2;E.attr("transform","translate("+(L-Se/2)+", "+(-ke-S.height/2)+")"),Q.attr("transform","translate("+(L-Se/2)+", "+(-ke+S.height/2)+")"),he.attr("transform","translate("+(L+Se/2-fe.width-2*d)+", "+(-ke+S.height/2)+")");let Ye;const{rx:lt,ry:Pt}=t,{cssStyles:At}=t;if(t.look==="handDrawn"){const Ae=po.svg(i),mt=vo(t,{}),bt=lt||Pt?Ae.path(lv(Ie,He,Se,Ee,lt||0),mt):Ae.rectangle(Ie,He,Se,Ee,mt);Ye=i.insert(()=>bt,":first-child"),Ye.attr("class","basic label-container").attr("style",At||null)}else{Ye=i.insert("rect",":first-child"),Ye.attr("class","basic label-container __APA__").attr("style",a).attr("rx",lt??5).attr("ry",Pt??5).attr("x",Ie).attr("y",He).attr("width",Se).attr("height",Ee);const Ae="priority"in t&&t.priority;if(Ae){const mt=i.append("line"),bt=Ie+2,Dt=He+Math.floor((lt??0)/2),Je=He+Ee-Math.floor((lt??0)/2);mt.attr("x1",bt).attr("y1",Dt).attr("x2",bt).attr("y2",Je).attr("stroke-width","4").attr("stroke",Gte(Ae))}}return Eo(t,Ye),t.height=Ee,t.intersect=function(Ae){return co.rect(t,Ae)},i}Ze(pU,"kanbanItem");var qte=[{semanticName:"Process",name:"Rectangle",shortName:"rect",description:"Standard process shape",aliases:["proc","process","rectangle"],internalAliases:["squareRect"],handler:Y6},{semanticName:"Event",name:"Rounded Rectangle",shortName:"rounded",description:"Represents an event",aliases:["event"],internalAliases:["roundedRect"],handler:H6},{semanticName:"Terminal Point",name:"Stadium",shortName:"stadium",description:"Terminal point",aliases:["terminal","pill"],handler:X6},{semanticName:"Subprocess",name:"Framed Rectangle",shortName:"fr-rect",description:"Subprocess",aliases:["subprocess","subproc","framed-rectangle","subroutine"],handler:J6},{semanticName:"Database",name:"Cylinder",shortName:"cyl",description:"Database storage",aliases:["db","database","cylinder"],handler:_6},{semanticName:"Start",name:"Circle",shortName:"circle",description:"Starting point",aliases:["circ"],handler:u6},{semanticName:"Decision",name:"Diamond",shortName:"diam",description:"Decision-making step",aliases:["decision","diamond","question"],handler:V6},{semanticName:"Prepare Conditional",name:"Hexagon",shortName:"hex",description:"Preparation or condition step",aliases:["hexagon","prepare"],handler:C6},{semanticName:"Data Input/Output",name:"Lean Right",shortName:"lean-r",description:"Represents input or output",aliases:["lean-right","in-out"],internalAliases:["lean_right"],handler:R6},{semanticName:"Data Input/Output",name:"Lean Left",shortName:"lean-l",description:"Represents output or input",aliases:["lean-left","out-in"],internalAliases:["lean_left"],handler:O6},{semanticName:"Priority Action",name:"Trapezoid Base Bottom",shortName:"trap-b",description:"Priority action",aliases:["priority","trapezoid-bottom","trapezoid"],handler:nU},{semanticName:"Manual Operation",name:"Trapezoid Base Top",shortName:"trap-t",description:"Represents a manual task",aliases:["manual","trapezoid-top","inv-trapezoid"],internalAliases:["inv_trapezoid"],handler:D6},{semanticName:"Stop",name:"Double Circle",shortName:"dbl-circ",description:"Represents a stop point",aliases:["double-circle"],internalAliases:["doublecircle"],handler:x6},{semanticName:"Text Block",name:"Text Block",shortName:"text",description:"Text block",handler:iU},{semanticName:"Card",name:"Notched Rectangle",shortName:"notch-rect",description:"Represents a card",aliases:["card","notched-rectangle"],handler:c6},{semanticName:"Lined/Shaded Process",name:"Lined Rectangle",shortName:"lin-rect",description:"Lined process shape",aliases:["lined-rectangle","lined-process","lin-proc","shaded-process"],handler:G6},{semanticName:"Start",name:"Small Circle",shortName:"sm-circ",description:"Small starting point",aliases:["start","small-circle"],internalAliases:["stateStart"],handler:Q6},{semanticName:"Stop",name:"Framed Circle",shortName:"fr-circ",description:"Stop point",aliases:["stop","framed-circle"],internalAliases:["stateEnd"],handler:K6},{semanticName:"Fork/Join",name:"Filled Rectangle",shortName:"fork",description:"Fork or join in process flow",aliases:["join"],internalAliases:["forkJoin"],handler:S6},{semanticName:"Collate",name:"Hourglass",shortName:"hourglass",description:"Represents a collate operation",aliases:["hourglass","collate"],handler:E6},{semanticName:"Comment",name:"Curly Brace",shortName:"brace",description:"Adds a comment",aliases:["comment","brace-l"],handler:f6},{semanticName:"Comment Right",name:"Curly Brace",shortName:"brace-r",description:"Adds a comment",handler:m6},{semanticName:"Comment with braces on both sides",name:"Curly Braces",shortName:"braces",description:"Adds a comment",handler:g6},{semanticName:"Com Link",name:"Lightning Bolt",shortName:"bolt",description:"Communication link",aliases:["com-link","lightning-bolt"],handler:N6},{semanticName:"Document",name:"Document",shortName:"doc",description:"Represents a document",aliases:["doc","document"],handler:aU},{semanticName:"Delay",name:"Half-Rounded Rectangle",shortName:"delay",description:"Represents a delay",aliases:["half-rounded-rectangle"],handler:T6},{semanticName:"Direct Access Storage",name:"Horizontal Cylinder",shortName:"h-cyl",description:"Direct access storage",aliases:["das","horizontal-cylinder"],handler:rU},{semanticName:"Disk Storage",name:"Lined Cylinder",shortName:"lin-cyl",description:"Disk storage",aliases:["disk","lined-cylinder"],handler:B6},{semanticName:"Display",name:"Curved Trapezoid",shortName:"curv-trap",description:"Represents a display",aliases:["curved-trapezoid","display"],handler:y6},{semanticName:"Divided Process",name:"Divided Rectangle",shortName:"div-rect",description:"Divided process shape",aliases:["div-proc","divided-rectangle","divided-process"],handler:v6},{semanticName:"Extract",name:"Triangle",shortName:"tri",description:"Extraction process",aliases:["extract","triangle"],handler:oU},{semanticName:"Internal Storage",name:"Window Pane",shortName:"win-pane",description:"Internal storage",aliases:["internal-storage","window-pane"],handler:cU},{semanticName:"Junction",name:"Filled Circle",shortName:"f-circ",description:"Junction point",aliases:["junction","filled-circle"],handler:b6},{semanticName:"Loop Limit",name:"Trapezoidal Pentagon",shortName:"notch-pent",description:"Loop limit step",aliases:["loop-limit","notched-pentagon"],handler:sU},{semanticName:"Manual File",name:"Flipped Triangle",shortName:"flip-tri",description:"Manual file operation",aliases:["manual-file","flipped-triangle"],handler:w6},{semanticName:"Manual Input",name:"Sloped Rectangle",shortName:"sl-rect",description:"Manual input step",aliases:["manual-input","sloped-rectangle"],handler:q6},{semanticName:"Multi-Document",name:"Stacked Document",shortName:"docs",description:"Multiple documents",aliases:["documents","st-doc","stacked-document"],handler:U6},{semanticName:"Multi-Process",name:"Stacked Rectangle",shortName:"st-rect",description:"Multiple processes",aliases:["procs","processes","stacked-rectangle"],handler:z6},{semanticName:"Stored Data",name:"Bow Tie Rectangle",shortName:"bow-rect",description:"Stored data",aliases:["stored-data","bow-tie-rectangle"],handler:l6},{semanticName:"Summary",name:"Crossed Circle",shortName:"cross-circ",description:"Summary",aliases:["summary","crossed-circle"],handler:p6},{semanticName:"Tagged Document",name:"Tagged Document",shortName:"tag-doc",description:"Tagged document",aliases:["tag-doc","tagged-document"],handler:tU},{semanticName:"Tagged Process",name:"Tagged Rectangle",shortName:"tag-rect",description:"Tagged process",aliases:["tagged-rectangle","tag-proc","tagged-process"],handler:eU},{semanticName:"Paper Tape",name:"Flag",shortName:"flag",description:"Paper tape",aliases:["paper-tape"],handler:lU},{semanticName:"Odd",name:"Odd",shortName:"odd",description:"Odd shape",internalAliases:["rect_left_inv_arrow"],handler:W6},{semanticName:"Lined Document",name:"Lined Document",shortName:"lin-doc",description:"Lined document",aliases:["lined-document"],handler:F6}],Yte=Ze(()=>{const t=[...Object.entries({state:Z6,choice:h6,note:$6,rectWithTitle:j6,labelRect:P6,iconSquare:I6,iconCircle:A6,icon:k6,iconRounded:M6,imageSquare:L6,anchor:a6,kanbanItem:pU,classBox:uU,erBox:fD,requirementBox:dU}),...qte.flatMap(n=>[n.shortName,..."aliases"in n?n.aliases:[],..."internalAliases"in n?n.internalAliases:[]].map(a=>[a,n.handler]))];return Object.fromEntries(t)},"generateShapeMap"),fU=Yte();function Xte(e){return e in fU}Ze(Xte,"isValidShape");var uk=new Map;async function mU(e,t,n){let s,a;t.shape==="rect"&&(t.rx&&t.ry?t.shape="roundedRect":t.shape="squareRect");const d=t.shape?fU[t.shape]:void 0;if(!d)throw new Error(`No such shape: ${t.shape}. Please check your syntax.`);if(t.link){let f;n.config.securityLevel==="sandbox"?f="_top":t.linkTarget&&(f=t.linkTarget||"_blank"),s=e.insert("svg:a").attr("xlink:href",t.link).attr("target",f??null),a=await d(s,t,n)}else a=await d(e,t,n),s=a;return t.tooltip&&a.attr("title",t.tooltip),uk.set(t.id,s),t.haveCallback&&s.attr("class",s.attr("class")+" clickable"),s}Ze(mU,"insertNode");var Qfe=Ze((e,t)=>{uk.set(t.id,e)},"setNodeElem"),Jfe=Ze(()=>{uk.clear()},"clear"),eme=Ze(e=>{const t=uk.get(e.id);On.trace("Transforming node",e.diff,e,"translate("+(e.x-e.width/2-5)+", "+e.width/2+")");const n=8,s=e.diff||0;return e.clusterNode?t.attr("transform","translate("+(e.x+s-e.width/2)+", "+(e.y-e.height/2-n)+")"):t.attr("transform","translate("+e.x+", "+e.y+")"),s},"positionNode"),Zte=Ze((e,t,n,s,a,d)=>{t.arrowTypeStart&&YR(e,"start",t.arrowTypeStart,n,s,a,d),t.arrowTypeEnd&&YR(e,"end",t.arrowTypeEnd,n,s,a,d)},"addEdgeMarkers"),Kte={arrow_cross:{type:"cross",fill:!1},arrow_point:{type:"point",fill:!0},arrow_barb:{type:"barb",fill:!0},arrow_circle:{type:"circle",fill:!1},aggregation:{type:"aggregation",fill:!1},extension:{type:"extension",fill:!1},composition:{type:"composition",fill:!0},dependency:{type:"dependency",fill:!0},lollipop:{type:"lollipop",fill:!1},only_one:{type:"onlyOne",fill:!1},zero_or_one:{type:"zeroOrOne",fill:!1},one_or_more:{type:"oneOrMore",fill:!1},zero_or_more:{type:"zeroOrMore",fill:!1},requirement_arrow:{type:"requirement_arrow",fill:!1},requirement_contains:{type:"requirement_contains",fill:!1}},YR=Ze((e,t,n,s,a,d,f)=>{var F;const i=Kte[n];if(!i){On.warn(`Unknown arrow type: ${n}`);return}const S=i.type,L=`${a}_${d}-${S}${t==="start"?"Start":"End"}`;if(f&&f.trim()!==""){const G=f.replace(/[^\dA-Za-z]/g,"_"),q=`${L}_${G}`;if(!document.getElementById(q)){const Q=document.getElementById(L);if(Q){const te=Q.cloneNode(!0);te.id=q,te.querySelectorAll("path, circle, line").forEach(fe=>{fe.setAttribute("stroke",f),i.fill&&fe.setAttribute("fill",f)}),(F=Q.parentNode)==null||F.appendChild(te)}}e.attr(`marker-${t}`,`url(${s}#${q})`)}else e.attr(`marker-${t}`,`url(${s}#${L})`)},"addEdgeMarker"),o2=new Map,rf=new Map,tme=Ze(()=>{o2.clear(),rf.clear()},"clear"),dS=Ze(e=>e?e.reduce((n,s)=>n+";"+s,""):"","getLabelStyles"),Qte=Ze(async(e,t)=>{let n=cp(Bc().flowchart.htmlLabels);const s=await ux(e,t.label,{style:dS(t.labelStyle),useHtmlLabels:n,addSvgBackground:!0,isNode:!1});On.info("abc82",t,t.labelType);const a=e.insert("g").attr("class","edgeLabel"),d=a.insert("g").attr("class","label");d.node().appendChild(s);let f=s.getBBox();if(n){const S=s.children[0],E=mc(s);f=S.getBoundingClientRect(),E.attr("width",f.width),E.attr("height",f.height)}d.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),o2.set(t.id,a),t.width=f.width,t.height=f.height;let i;if(t.startLabelLeft){const S=await tb(t.startLabelLeft,dS(t.labelStyle)),E=e.insert("g").attr("class","edgeTerminals"),L=E.insert("g").attr("class","inner");i=L.node().appendChild(S);const F=S.getBBox();L.attr("transform","translate("+-F.width/2+", "+-F.height/2+")"),rf.get(t.id)||rf.set(t.id,{}),rf.get(t.id).startLeft=E,TS(i,t.startLabelLeft)}if(t.startLabelRight){const S=await tb(t.startLabelRight,dS(t.labelStyle)),E=e.insert("g").attr("class","edgeTerminals"),L=E.insert("g").attr("class","inner");i=E.node().appendChild(S),L.node().appendChild(S);const F=S.getBBox();L.attr("transform","translate("+-F.width/2+", "+-F.height/2+")"),rf.get(t.id)||rf.set(t.id,{}),rf.get(t.id).startRight=E,TS(i,t.startLabelRight)}if(t.endLabelLeft){const S=await tb(t.endLabelLeft,dS(t.labelStyle)),E=e.insert("g").attr("class","edgeTerminals"),L=E.insert("g").attr("class","inner");i=L.node().appendChild(S);const F=S.getBBox();L.attr("transform","translate("+-F.width/2+", "+-F.height/2+")"),E.node().appendChild(S),rf.get(t.id)||rf.set(t.id,{}),rf.get(t.id).endLeft=E,TS(i,t.endLabelLeft)}if(t.endLabelRight){const S=await tb(t.endLabelRight,dS(t.labelStyle)),E=e.insert("g").attr("class","edgeTerminals"),L=E.insert("g").attr("class","inner");i=L.node().appendChild(S);const F=S.getBBox();L.attr("transform","translate("+-F.width/2+", "+-F.height/2+")"),E.node().appendChild(S),rf.get(t.id)||rf.set(t.id,{}),rf.get(t.id).endRight=E,TS(i,t.endLabelRight)}return s},"insertEdgeLabel");function TS(e,t){Bc().flowchart.htmlLabels&&e&&(e.style.width=t.length*9+"px",e.style.height="12px")}Ze(TS,"setTerminalWidth");var Jte=Ze((e,t)=>{On.debug("Moving label abc88 ",e.id,e.label,o2.get(e.id),t);let n=t.updatedPath?t.updatedPath:t.originalPath;const s=Bc(),{subGraphTitleTotalMargin:a}=LL(s);if(e.label){const d=o2.get(e.id);let f=e.x,i=e.y;if(n){const S=c_.calcLabelPosition(n);On.debug("Moving label "+e.label+" from (",f,",",i,") to (",S.x,",",S.y,") abc88"),t.updatedPath&&(f=S.x,i=S.y)}d.attr("transform",`translate(${f}, ${i+a/2})`)}if(e.startLabelLeft){const d=rf.get(e.id).startLeft;let f=e.x,i=e.y;if(n){const S=c_.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_left",n);f=S.x,i=S.y}d.attr("transform",`translate(${f}, ${i})`)}if(e.startLabelRight){const d=rf.get(e.id).startRight;let f=e.x,i=e.y;if(n){const S=c_.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_right",n);f=S.x,i=S.y}d.attr("transform",`translate(${f}, ${i})`)}if(e.endLabelLeft){const d=rf.get(e.id).endLeft;let f=e.x,i=e.y;if(n){const S=c_.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_left",n);f=S.x,i=S.y}d.attr("transform",`translate(${f}, ${i})`)}if(e.endLabelRight){const d=rf.get(e.id).endRight;let f=e.x,i=e.y;if(n){const S=c_.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_right",n);f=S.x,i=S.y}d.attr("transform",`translate(${f}, ${i})`)}},"positionEdgeLabel"),eie=Ze((e,t)=>{const n=e.x,s=e.y,a=Math.abs(t.x-n),d=Math.abs(t.y-s),f=e.width/2,i=e.height/2;return a>=f||d>=i},"outsideNode"),tie=Ze((e,t,n)=>{On.debug(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(t)}
  insidePoint : ${JSON.stringify(n)}
  node        : x:${e.x} y:${e.y} w:${e.width} h:${e.height}`);const s=e.x,a=e.y,d=Math.abs(s-n.x),f=e.width/2;let i=n.x<t.x?f-d:f+d;const S=e.height/2,E=Math.abs(t.y-n.y),L=Math.abs(t.x-n.x);if(Math.abs(a-t.y)*f>Math.abs(s-t.x)*S){let F=n.y<t.y?t.y-S-a:a-S-t.y;i=L*F/E;const G={x:n.x<t.x?n.x+i:n.x-L+i,y:n.y<t.y?n.y+E-F:n.y-E+F};return i===0&&(G.x=t.x,G.y=t.y),L===0&&(G.x=t.x),E===0&&(G.y=t.y),On.debug(`abc89 top/bottom calc, Q ${E}, q ${F}, R ${L}, r ${i}`,G),G}else{n.x<t.x?i=t.x-f-s:i=s-f-t.x;let F=E*i/L,G=n.x<t.x?n.x+L-i:n.x-L+i,q=n.y<t.y?n.y+F:n.y-F;return On.debug(`sides calc abc89, Q ${E}, q ${F}, R ${L}, r ${i}`,{_x:G,_y:q}),i===0&&(G=t.x,q=t.y),L===0&&(G=t.x),E===0&&(q=t.y),{x:G,y:q}}},"intersection"),XR=Ze((e,t)=>{On.warn("abc88 cutPathAtIntersect",e,t);let n=[],s=e[0],a=!1;return e.forEach(d=>{if(On.info("abc88 checking point",d,t),!eie(t,d)&&!a){const f=tie(t,s,d);On.debug("abc88 inside",d,s,f),On.debug("abc88 intersection",f,t);let i=!1;n.forEach(S=>{i=i||S.x===f.x&&S.y===f.y}),n.some(S=>S.x===f.x&&S.y===f.y)?On.warn("abc88 no intersect",f,n):n.push(f),a=!0}else On.warn("abc88 outside",d,s),s=d,a||n.push(d)}),On.debug("returning points",n),n},"cutPathAtIntersect");function gU(e){const t=[],n=[];for(let s=1;s<e.length-1;s++){const a=e[s-1],d=e[s],f=e[s+1];(a.x===d.x&&d.y===f.y&&Math.abs(d.x-f.x)>5&&Math.abs(d.y-a.y)>5||a.y===d.y&&d.x===f.x&&Math.abs(d.x-a.x)>5&&Math.abs(d.y-f.y)>5)&&(t.push(d),n.push(s))}return{cornerPoints:t,cornerPointPositions:n}}Ze(gU,"extractCornerPoints");var ZR=Ze(function(e,t,n){const s=t.x-e.x,a=t.y-e.y,d=Math.sqrt(s*s+a*a),f=n/d;return{x:t.x-f*s,y:t.y-f*a}},"findAdjacentPoint"),iie=Ze(function(e){const{cornerPointPositions:t}=gU(e),n=[];for(let s=0;s<e.length;s++)if(t.includes(s)){const a=e[s-1],d=e[s+1],f=e[s],i=ZR(a,f,5),S=ZR(d,f,5),E=S.x-i.x,L=S.y-i.y;n.push(i);const F=Math.sqrt(2)*2;let G={x:f.x,y:f.y};if(Math.abs(d.x-a.x)>10&&Math.abs(d.y-a.y)>=10){On.debug("Corner point fixing",Math.abs(d.x-a.x),Math.abs(d.y-a.y));const q=5;f.x===i.x?G={x:E<0?i.x-q+F:i.x+q-F,y:L<0?i.y-F:i.y+F}:G={x:E<0?i.x-F:i.x+F,y:L<0?i.y-q+F:i.y+q-F}}else On.debug("Corner point skipping fixing",Math.abs(d.x-a.x),Math.abs(d.y-a.y));n.push(G,S)}else n.push(e[s]);return n},"fixCorners"),rie=Ze(function(e,t,n,s,a,d,f){var lt;const{handDrawnSeed:i}=Bc();let S=t.points,E=!1;const L=a;var F=d;const G=[];for(const Pt in t.cssCompiledStyles)t5(Pt)||G.push(t.cssCompiledStyles[Pt]);F.intersect&&L.intersect&&(S=S.slice(1,t.points.length-1),S.unshift(L.intersect(S[0])),On.debug("Last point APA12",t.start,"-->",t.end,S[S.length-1],F,F.intersect(S[S.length-1])),S.push(F.intersect(S[S.length-1]))),t.toCluster&&(On.info("to cluster abc88",n.get(t.toCluster)),S=XR(t.points,n.get(t.toCluster).node),E=!0),t.fromCluster&&(On.debug("from cluster abc88",n.get(t.fromCluster),JSON.stringify(S,null,2)),S=XR(S.reverse(),n.get(t.fromCluster).node).reverse(),E=!0);let q=S.filter(Pt=>!Number.isNaN(Pt.y));q=iie(q);let Q=aE;switch(Q=WE,t.curve){case"linear":Q=WE;break;case"basis":Q=aE;break;case"cardinal":Q=B5;break;case"bumpX":Q=D5;break;case"bumpY":Q=P5;break;case"catmullRom":Q=z5;break;case"monotoneX":Q=H5;break;case"monotoneY":Q=G5;break;case"natural":Q=Y5;break;case"step":Q=X5;break;case"stepAfter":Q=K5;break;case"stepBefore":Q=Z5;break;default:Q=aE}const{x:te,y:he}=oY(t),fe=OZ().x(te).y(he).curve(Q);let le;switch(t.thickness){case"normal":le="edge-thickness-normal";break;case"thick":le="edge-thickness-thick";break;case"invisible":le="edge-thickness-invisible";break;default:le="edge-thickness-normal"}switch(t.pattern){case"solid":le+=" edge-pattern-solid";break;case"dotted":le+=" edge-pattern-dotted";break;case"dashed":le+=" edge-pattern-dashed";break;default:le+=" edge-pattern-solid"}let Se,ke=fe(q);const Ee=Array.isArray(t.style)?t.style:t.style?[t.style]:[];let Ie=Ee.find(Pt=>Pt==null?void 0:Pt.startsWith("stroke:"));if(t.look==="handDrawn"){const Pt=po.svg(e);Object.assign([],q);const At=Pt.path(ke,{roughness:.3,seed:i});le+=" transition",Se=mc(At).select("path").attr("id",t.id).attr("class"," "+le+(t.classes?" "+t.classes:"")).attr("style",Ee?Ee.reduce((Ot,Ae)=>Ot+";"+Ae,""):"");let ht=Se.attr("d");Se.attr("d",ht),e.node().appendChild(Se.node())}else{const Pt=G.join(";"),At=Ee?Ee.reduce((Ae,mt)=>Ae+mt+";",""):"";let ht="";t.animate&&(ht=" edge-animation-fast"),t.animation&&(ht=" edge-animation-"+t.animation);const Ot=Pt?Pt+";"+At+";":At;Se=e.append("path").attr("d",ke).attr("id",t.id).attr("class"," "+le+(t.classes?" "+t.classes:"")+(ht??"")).attr("style",Ot),Ie=(lt=Ot.match(/stroke:([^;]+)/))==null?void 0:lt[1]}let He="";(Bc().flowchart.arrowMarkerAbsolute||Bc().state.arrowMarkerAbsolute)&&(He=gF(!0)),On.info("arrowTypeStart",t.arrowTypeStart),On.info("arrowTypeEnd",t.arrowTypeEnd),Zte(Se,t,He,f,s,Ie);let Ye={};return E&&(Ye.updatedPath=S),Ye.originalPath=t.points,Ye},"insertEdge"),nie=Ze((e,t,n,s)=>{t.forEach(a=>{xie[a](e,n,s)})},"insertMarkers"),sie=Ze((e,t,n)=>{On.trace("Making markers for ",n),e.append("defs").append("marker").attr("id",n+"_"+t+"-extensionStart").attr("class","marker extension "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),e.append("defs").append("marker").attr("id",n+"_"+t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},"extension"),oie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-compositionStart").attr("class","marker composition "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),e.append("defs").append("marker").attr("id",n+"_"+t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"composition"),aie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),e.append("defs").append("marker").attr("id",n+"_"+t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"aggregation"),lie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),e.append("defs").append("marker").attr("id",n+"_"+t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"dependency"),cie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),e.append("defs").append("marker").attr("id",n+"_"+t+"-lollipopEnd").attr("class","marker lollipop "+t).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},"lollipop"),hie=Ze((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),e.append("marker").attr("id",n+"_"+t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"point"),uie=Ze((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),e.append("marker").attr("id",n+"_"+t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"circle"),die=Ze((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),e.append("marker").attr("id",n+"_"+t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},"cross"),pie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","userSpaceOnUse").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"barb"),fie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-onlyOneStart").attr("class","marker onlyOne "+t).attr("refX",0).attr("refY",9).attr("markerWidth",18).attr("markerHeight",18).attr("orient","auto").append("path").attr("d","M9,0 L9,18 M15,0 L15,18"),e.append("defs").append("marker").attr("id",n+"_"+t+"-onlyOneEnd").attr("class","marker onlyOne "+t).attr("refX",18).attr("refY",9).attr("markerWidth",18).attr("markerHeight",18).attr("orient","auto").append("path").attr("d","M3,0 L3,18 M9,0 L9,18")},"only_one"),mie=Ze((e,t,n)=>{const s=e.append("defs").append("marker").attr("id",n+"_"+t+"-zeroOrOneStart").attr("class","marker zeroOrOne "+t).attr("refX",0).attr("refY",9).attr("markerWidth",30).attr("markerHeight",18).attr("orient","auto");s.append("circle").attr("fill","white").attr("cx",21).attr("cy",9).attr("r",6),s.append("path").attr("d","M9,0 L9,18");const a=e.append("defs").append("marker").attr("id",n+"_"+t+"-zeroOrOneEnd").attr("class","marker zeroOrOne "+t).attr("refX",30).attr("refY",9).attr("markerWidth",30).attr("markerHeight",18).attr("orient","auto");a.append("circle").attr("fill","white").attr("cx",9).attr("cy",9).attr("r",6),a.append("path").attr("d","M21,0 L21,18")},"zero_or_one"),gie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-oneOrMoreStart").attr("class","marker oneOrMore "+t).attr("refX",18).attr("refY",18).attr("markerWidth",45).attr("markerHeight",36).attr("orient","auto").append("path").attr("d","M0,18 Q 18,0 36,18 Q 18,36 0,18 M42,9 L42,27"),e.append("defs").append("marker").attr("id",n+"_"+t+"-oneOrMoreEnd").attr("class","marker oneOrMore "+t).attr("refX",27).attr("refY",18).attr("markerWidth",45).attr("markerHeight",36).attr("orient","auto").append("path").attr("d","M3,9 L3,27 M9,18 Q27,0 45,18 Q27,36 9,18")},"one_or_more"),yie=Ze((e,t,n)=>{const s=e.append("defs").append("marker").attr("id",n+"_"+t+"-zeroOrMoreStart").attr("class","marker zeroOrMore "+t).attr("refX",18).attr("refY",18).attr("markerWidth",57).attr("markerHeight",36).attr("orient","auto");s.append("circle").attr("fill","white").attr("cx",48).attr("cy",18).attr("r",6),s.append("path").attr("d","M0,18 Q18,0 36,18 Q18,36 0,18");const a=e.append("defs").append("marker").attr("id",n+"_"+t+"-zeroOrMoreEnd").attr("class","marker zeroOrMore "+t).attr("refX",39).attr("refY",18).attr("markerWidth",57).attr("markerHeight",36).attr("orient","auto");a.append("circle").attr("fill","white").attr("cx",9).attr("cy",18).attr("r",6),a.append("path").attr("d","M21,18 Q39,0 57,18 Q39,36 21,18")},"zero_or_more"),_ie=Ze((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-requirement_arrowEnd").attr("refX",20).attr("refY",10).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d",`M0,0
      L20,10
      M20,10
      L0,20`)},"requirement_arrow"),vie=Ze((e,t,n)=>{const s=e.append("defs").append("marker").attr("id",n+"_"+t+"-requirement_containsStart").attr("refX",0).attr("refY",10).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("g");s.append("circle").attr("cx",10).attr("cy",10).attr("r",9).attr("fill","none"),s.append("line").attr("x1",1).attr("x2",19).attr("y1",10).attr("y2",10),s.append("line").attr("y1",1).attr("y2",19).attr("x1",10).attr("x2",10)},"requirement_contains"),xie={extension:sie,composition:oie,aggregation:aie,dependency:lie,lollipop:cie,point:hie,circle:uie,cross:die,barb:pie,only_one:fie,zero_or_one:mie,one_or_more:gie,zero_or_more:yie,requirement_arrow:_ie,requirement_contains:vie},bie=nie,wie={common:sw,getConfig:ug,insertCluster:Ite,insertEdge:rie,insertEdgeLabel:Qte,insertMarkers:bie,insertNode:mU,interpolateToCurve:XL,labelHelper:Na,log:On,positionEdgeLabel:Jte},tT={},yU=Ze(e=>{for(const t of e)tT[t.name]=t},"registerLayoutLoaders"),Sie=Ze(()=>{yU([{name:"dagre",loader:Ze(async()=>await ah(()=>import("./dagre-FFZHY6LT-b2b434d1.js"),["assets/dagre-FFZHY6LT-b2b434d1.js","assets/graph-f2f0d433.js","assets/_baseUniq-21ee8b86.js","assets/layout-a55467e9.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js"]),"loader")}])},"registerDefaultLayoutLoaders");Sie();var ime=Ze(async(e,t)=>{if(!(e.layoutAlgorithm in tT))throw new Error(`Unknown layout algorithm: ${e.layoutAlgorithm}`);const n=tT[e.layoutAlgorithm];return(await n.loader()).render(e,t,wie,{algorithm:n.algorithm})},"render"),rme=Ze((e="",{fallback:t="dagre"}={})=>{if(e in tT)return e;if(t in tT)return On.warn(`Layout algorithm ${e} is not registered. Using ${t} as fallback.`),t;throw new Error(`Both layout algorithms ${e} and ${t} are not registered.`)},"getRegisteredLayoutAlgorithm"),KR={name:"mermaid",version:"11.8.1",description:"Markdown-ish syntax for generating flowcharts, mindmaps, sequence diagrams, class diagrams, gantt charts, git graphs and more.",type:"module",module:"./dist/mermaid.core.mjs",types:"./dist/mermaid.d.ts",exports:{".":{types:"./dist/mermaid.d.ts",import:"./dist/mermaid.core.mjs",default:"./dist/mermaid.core.mjs"},"./*":"./*"},keywords:["diagram","markdown","flowchart","sequence diagram","gantt","class diagram","git graph","mindmap","packet diagram","c4 diagram","er diagram","pie chart","pie diagram","quadrant chart","requirement diagram","graph"],scripts:{clean:"rimraf dist",dev:"pnpm -w dev","docs:code":"typedoc src/defaultConfig.ts src/config.ts src/mermaid.ts && prettier --write ./src/docs/config/setup","docs:build":"rimraf ../../docs && pnpm docs:code && pnpm docs:spellcheck && tsx scripts/docs.cli.mts","docs:verify":"pnpm docs:code && pnpm docs:spellcheck && tsx scripts/docs.cli.mts --verify","docs:pre:vitepress":"pnpm --filter ./src/docs prefetch && rimraf src/vitepress && pnpm docs:code && tsx scripts/docs.cli.mts --vitepress && pnpm --filter ./src/vitepress install --no-frozen-lockfile --ignore-scripts","docs:build:vitepress":"pnpm docs:pre:vitepress && (cd src/vitepress && pnpm run build) && cpy --flat src/docs/landing/ ./src/vitepress/.vitepress/dist/landing","docs:dev":'pnpm docs:pre:vitepress && concurrently "pnpm --filter ./src/vitepress dev" "tsx scripts/docs.cli.mts --watch --vitepress"',"docs:dev:docker":'pnpm docs:pre:vitepress && concurrently "pnpm --filter ./src/vitepress dev:docker" "tsx scripts/docs.cli.mts --watch --vitepress"',"docs:serve":"pnpm docs:build:vitepress && vitepress serve src/vitepress","docs:spellcheck":'cspell "src/docs/**/*.md"',"docs:release-version":"tsx scripts/update-release-version.mts","docs:verify-version":"tsx scripts/update-release-version.mts --verify","types:build-config":"tsx scripts/create-types-from-json-schema.mts","types:verify-config":"tsx scripts/create-types-from-json-schema.mts --verify",checkCircle:"npx madge --circular ./src",prepublishOnly:"pnpm docs:verify-version"},repository:{type:"git",url:"https://github.com/mermaid-js/mermaid"},author:"Knut Sveidqvist",license:"MIT",standard:{ignore:["**/parser/*.js","dist/**/*.js","cypress/**/*.js"],globals:["page"]},dependencies:{"@braintree/sanitize-url":"^7.0.4","@iconify/utils":"^2.1.33","@mermaid-js/parser":"workspace:^","@types/d3":"^7.4.3",cytoscape:"^3.29.3","cytoscape-cose-bilkent":"^4.1.0","cytoscape-fcose":"^2.2.0",d3:"^7.9.0","d3-sankey":"^0.12.3","dagre-d3-es":"7.0.11",dayjs:"^1.11.13",dompurify:"^3.2.5",katex:"^0.16.9",khroma:"^2.1.0","lodash-es":"^4.17.21",marked:"^15.0.7",roughjs:"^4.6.6",stylis:"^4.3.6","ts-dedent":"^2.2.0",uuid:"^11.1.0"},devDependencies:{"@adobe/jsonschema2md":"^8.0.2","@iconify/types":"^2.0.0","@types/cytoscape":"^3.21.9","@types/cytoscape-fcose":"^2.2.4","@types/d3-sankey":"^0.12.4","@types/d3-scale":"^4.0.9","@types/d3-scale-chromatic":"^3.1.0","@types/d3-selection":"^3.0.11","@types/d3-shape":"^3.1.7","@types/jsdom":"^21.1.7","@types/katex":"^0.16.7","@types/lodash-es":"^4.17.12","@types/micromatch":"^4.0.9","@types/stylis":"^4.2.7","@types/uuid":"^10.0.0",ajv:"^8.17.1",chokidar:"3.6.0",concurrently:"^9.1.2","csstree-validator":"^4.0.1",globby:"^14.0.2",jison:"^0.4.18","js-base64":"^3.7.7",jsdom:"^26.0.0","json-schema-to-typescript":"^15.0.4",micromatch:"^4.0.8","path-browserify":"^1.0.1",prettier:"^3.5.2",remark:"^15.0.1","remark-frontmatter":"^5.0.0","remark-gfm":"^4.0.1",rimraf:"^6.0.1","start-server-and-test":"^2.0.10","type-fest":"^4.35.0",typedoc:"^0.27.8","typedoc-plugin-markdown":"^4.4.2",typescript:"~5.7.3","unist-util-flatmap":"^1.0.0","unist-util-visit":"^5.0.0",vitepress:"^1.0.2","vitepress-plugin-search":"1.0.4-alpha.22"},files:["dist/","README.md"],publishConfig:{access:"public"}},Tie=Ze(e=>{var a;const{securityLevel:t}=Bc();let n=mc("body");if(t==="sandbox"){const f=((a=mc(`#i${e}`).node())==null?void 0:a.contentDocument)??document;n=mc(f.body)}return n.select(`#${e}`)},"selectSvgElement"),_U="comm",vU="rule",xU="decl",Cie="@import",Eie="@namespace",kie="@keyframes",Aie="@layer",bU=Math.abs,mD=String.fromCharCode;function wU(e){return e.trim()}function uE(e,t,n){return e.replace(t,n)}function Mie(e,t,n){return e.indexOf(t,n)}function M1(e,t){return e.charCodeAt(t)|0}function H1(e,t,n){return e.slice(t,n)}function l_(e){return e.length}function Iie(e){return e.length}function NC(e,t){return t.push(e),e}var dk=1,G1=1,SU=0,Ry=0,Bd=0,hw="";function gD(e,t,n,s,a,d,f,i){return{value:e,root:t,parent:n,type:s,props:a,children:d,line:dk,column:G1,length:f,return:"",siblings:i}}function Lie(){return Bd}function Die(){return Bd=Ry>0?M1(hw,--Ry):0,G1--,Bd===10&&(G1=1,dk--),Bd}function w0(){return Bd=Ry<SU?M1(hw,Ry++):0,G1++,Bd===10&&(G1=1,dk++),Bd}function Qv(){return M1(hw,Ry)}function dE(){return Ry}function pk(e,t){return H1(hw,e,t)}function iT(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Pie(e){return dk=G1=1,SU=l_(hw=e),Ry=0,[]}function Oie(e){return hw="",e}function NA(e){return wU(pk(Ry-1,lI(e===91?e+2:e===40?e+1:e)))}function Rie(e){for(;(Bd=Qv())&&Bd<33;)w0();return iT(e)>2||iT(Bd)>3?"":" "}function Nie(e,t){for(;--t&&w0()&&!(Bd<48||Bd>102||Bd>57&&Bd<65||Bd>70&&Bd<97););return pk(e,dE()+(t<6&&Qv()==32&&w0()==32))}function lI(e){for(;w0();)switch(Bd){case e:return Ry;case 34:case 39:e!==34&&e!==39&&lI(Bd);break;case 40:e===41&&lI(e);break;case 92:w0();break}return Ry}function Bie(e,t){for(;w0()&&e+Bd!==47+10;)if(e+Bd===42+42&&Qv()===47)break;return"/*"+pk(t,Ry-1)+"*"+mD(e===47?e:w0())}function Fie(e){for(;!iT(Qv());)w0();return pk(e,Ry)}function zie(e){return Oie(pE("",null,null,null,[""],e=Pie(e),0,[0],e))}function pE(e,t,n,s,a,d,f,i,S){for(var E=0,L=0,F=f,G=0,q=0,Q=0,te=1,he=1,fe=1,le=0,Se="",ke=a,Ee=d,Ie=s,He=Se;he;)switch(Q=le,le=w0()){case 40:if(Q!=108&&M1(He,F-1)==58){Mie(He+=uE(NA(le),"&","&\f"),"&\f",bU(E?i[E-1]:0))!=-1&&(fe=-1);break}case 34:case 39:case 91:He+=NA(le);break;case 9:case 10:case 13:case 32:He+=Rie(Q);break;case 92:He+=Nie(dE()-1,7);continue;case 47:switch(Qv()){case 42:case 47:NC(Uie(Bie(w0(),dE()),t,n,S),S),(iT(Q||1)==5||iT(Qv()||1)==5)&&l_(He)&&H1(He,-1,void 0)!==" "&&(He+=" ");break;default:He+="/"}break;case 123*te:i[E++]=l_(He)*fe;case 125*te:case 59:case 0:switch(le){case 0:case 125:he=0;case 59+L:fe==-1&&(He=uE(He,/\f/g,"")),q>0&&(l_(He)-F||te===0&&Q===47)&&NC(q>32?JR(He+";",s,n,F-1,S):JR(uE(He," ","")+";",s,n,F-2,S),S);break;case 59:He+=";";default:if(NC(Ie=QR(He,t,n,E,L,a,i,Se,ke=[],Ee=[],F,d),d),le===123)if(L===0)pE(He,t,Ie,Ie,ke,d,F,i,Ee);else{switch(G){case 99:if(M1(He,3)===110)break;case 108:if(M1(He,2)===97)break;default:L=0;case 100:case 109:case 115:}L?pE(e,Ie,Ie,s&&NC(QR(e,Ie,Ie,0,0,a,i,Se,a,ke=[],F,Ee),Ee),a,Ee,F,i,s?ke:Ee):pE(He,Ie,Ie,Ie,[""],Ee,0,i,Ee)}}E=L=q=0,te=fe=1,Se=He="",F=f;break;case 58:F=1+l_(He),q=Q;default:if(te<1){if(le==123)--te;else if(le==125&&te++==0&&Die()==125)continue}switch(He+=mD(le),le*te){case 38:fe=L>0?1:(He+="\f",-1);break;case 44:i[E++]=(l_(He)-1)*fe,fe=1;break;case 64:Qv()===45&&(He+=NA(w0())),G=Qv(),L=F=l_(Se=He+=Fie(dE())),le++;break;case 45:Q===45&&l_(He)==2&&(te=0)}}return d}function QR(e,t,n,s,a,d,f,i,S,E,L,F){for(var G=a-1,q=a===0?d:[""],Q=Iie(q),te=0,he=0,fe=0;te<s;++te)for(var le=0,Se=H1(e,G+1,G=bU(he=f[te])),ke=e;le<Q;++le)(ke=wU(he>0?q[le]+" "+Se:uE(Se,/&\f/g,q[le])))&&(S[fe++]=ke);return gD(e,t,n,a===0?vU:i,S,E,L,F)}function Uie(e,t,n,s){return gD(e,t,n,_U,mD(Lie()),H1(e,2,-2),0,s)}function JR(e,t,n,s,a){return gD(e,t,n,xU,H1(e,0,s),H1(e,s+1,-1),s,a)}function cI(e,t){for(var n="",s=0;s<e.length;s++)n+=t(e[s],s,e,t)||"";return n}function $ie(e,t,n,s){switch(e.type){case Aie:if(e.children.length)break;case Cie:case Eie:case xU:return e.return=e.return||e.value;case _U:return"";case kie:return e.return=e.value+"{"+cI(e.children,s)+"}";case vU:if(!l_(e.value=e.props.join(",")))return""}return l_(n=cI(e.children,s))?e.return=e.value+"{"+n+"}":""}var Vie=t4(Object.keys,Object);const Wie=Vie;var jie=Object.prototype,Hie=jie.hasOwnProperty;function Gie(e){if(!rk(e))return Wie(e);var t=[];for(var n in Object(e))Hie.call(e,n)&&n!="constructor"&&t.push(n);return t}var qie=xb(T_,"DataView");const hI=qie;var Yie=xb(T_,"Promise");const uI=Yie;var Xie=xb(T_,"Set");const dI=Xie;var Zie=xb(T_,"WeakMap");const pI=Zie;var eN="[object Map]",Kie="[object Object]",tN="[object Promise]",iN="[object Set]",rN="[object WeakMap]",nN="[object DataView]",Qie=vb(hI),Jie=vb(eT),ere=vb(uI),tre=vb(dI),ire=vb(pI),Xx=aw;(hI&&Xx(new hI(new ArrayBuffer(1)))!=nN||eT&&Xx(new eT)!=eN||uI&&Xx(uI.resolve())!=tN||dI&&Xx(new dI)!=iN||pI&&Xx(new pI)!=rN)&&(Xx=function(e){var t=aw(e),n=t==Kie?e.constructor:void 0,s=n?vb(n):"";if(s)switch(s){case Qie:return nN;case Jie:return eN;case ere:return tN;case tre:return iN;case ire:return rN}return t});const rre=Xx;var nre="[object Map]",sre="[object Set]",ore=Object.prototype,are=ore.hasOwnProperty;function sN(e){if(e==null)return!0;if(nk(e)&&(ZE(e)||typeof e=="string"||typeof e.splice=="function"||qL(e)||YL(e)||XE(e)))return!e.length;var t=rre(e);if(t==nre||t==sre)return!e.size;if(rk(e))return!Gie(e).length;for(var n in e)if(are.call(e,n))return!1;return!0}var TU="c4",lre=Ze(e=>/^\s*C4Context|C4Container|C4Component|C4Dynamic|C4Deployment/.test(e),"detector"),cre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./c4Diagram-6F6E4RAY-bf1fdb40.js"),["assets/c4Diagram-6F6E4RAY-bf1fdb40.js","assets/chunk-67H74DCK-bdda210a.js"]);return{id:TU,diagram:e}},"loader"),hre={id:TU,detector:lre,loader:cre},ure=hre,CU="flowchart",dre=Ze((e,t)=>{var n,s;return((n=t==null?void 0:t.flowchart)==null?void 0:n.defaultRenderer)==="dagre-wrapper"||((s=t==null?void 0:t.flowchart)==null?void 0:s.defaultRenderer)==="elk"?!1:/^\s*graph/.test(e)},"detector"),pre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./flowDiagram-PKI6S5ZS-59976b58.js"),["assets/flowDiagram-PKI6S5ZS-59976b58.js","assets/chunk-E2GYISFI-7208b217.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/channel-0281318f.js"]);return{id:CU,diagram:e}},"loader"),fre={id:CU,detector:dre,loader:pre},mre=fre,EU="flowchart-v2",gre=Ze((e,t)=>{var n,s,a;return((n=t==null?void 0:t.flowchart)==null?void 0:n.defaultRenderer)==="dagre-d3"?!1:(((s=t==null?void 0:t.flowchart)==null?void 0:s.defaultRenderer)==="elk"&&(t.layout="elk"),/^\s*graph/.test(e)&&((a=t==null?void 0:t.flowchart)==null?void 0:a.defaultRenderer)==="dagre-wrapper"?!0:/^\s*flowchart/.test(e))},"detector"),yre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./flowDiagram-PKI6S5ZS-59976b58.js"),["assets/flowDiagram-PKI6S5ZS-59976b58.js","assets/chunk-E2GYISFI-7208b217.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/channel-0281318f.js"]);return{id:EU,diagram:e}},"loader"),_re={id:EU,detector:gre,loader:yre},vre=_re,kU="er",xre=Ze(e=>/^\s*erDiagram/.test(e),"detector"),bre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./erDiagram-R3QVA2FD-765dc46f.js"),["assets/erDiagram-R3QVA2FD-765dc46f.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/channel-0281318f.js"]);return{id:kU,diagram:e}},"loader"),wre={id:kU,detector:xre,loader:bre},Sre=wre,AU="gitGraph",Tre=Ze(e=>/^\s*gitGraph/.test(e),"detector"),Cre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./gitGraphDiagram-GW3U2K7C-6feba8d1.js"),["assets/gitGraphDiagram-GW3U2K7C-6feba8d1.js","assets/chunk-353BL4L5-058c9c7e.js","assets/chunk-AACKK3MU-11343222.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js"]);return{id:AU,diagram:e}},"loader"),Ere={id:AU,detector:Tre,loader:Cre},kre=Ere,MU="gantt",Are=Ze(e=>/^\s*gantt/.test(e),"detector"),Mre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./ganttDiagram-EK5VF46D-aee86650.js"),["assets/ganttDiagram-EK5VF46D-aee86650.js","assets/linear-b11db215.js","assets/init-77b53fdd.js","assets/defaultLocale-b5afb42d.js"]);return{id:MU,diagram:e}},"loader"),Ire={id:MU,detector:Are,loader:Mre},Lre=Ire,IU="info",Dre=Ze(e=>/^\s*info/.test(e),"detector"),Pre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./infoDiagram-XT3IWWJI-317c1bad.js"),["assets/infoDiagram-XT3IWWJI-317c1bad.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js"]);return{id:IU,diagram:e}},"loader"),Ore={id:IU,detector:Dre,loader:Pre},LU="pie",Rre=Ze(e=>/^\s*pie/.test(e),"detector"),Nre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./pieDiagram-NIOCPIFQ-1ced0395.js"),["assets/pieDiagram-NIOCPIFQ-1ced0395.js","assets/chunk-353BL4L5-058c9c7e.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js","assets/arc-d5ccc914.js","assets/ordinal-ba9b4969.js","assets/init-77b53fdd.js"]);return{id:LU,diagram:e}},"loader"),Bre={id:LU,detector:Rre,loader:Nre},DU="quadrantChart",Fre=Ze(e=>/^\s*quadrantChart/.test(e),"detector"),zre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./quadrantDiagram-2OG54O6I-663b6efb.js"),["assets/quadrantDiagram-2OG54O6I-663b6efb.js","assets/linear-b11db215.js","assets/init-77b53fdd.js","assets/defaultLocale-b5afb42d.js"]);return{id:DU,diagram:e}},"loader"),Ure={id:DU,detector:Fre,loader:zre},$re=Ure,PU="xychart",Vre=Ze(e=>/^\s*xychart-beta/.test(e),"detector"),Wre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./xychartDiagram-H2YORKM3-b0c84ee6.js"),["assets/xychartDiagram-H2YORKM3-b0c84ee6.js","assets/init-77b53fdd.js","assets/ordinal-ba9b4969.js","assets/linear-b11db215.js","assets/defaultLocale-b5afb42d.js"]);return{id:PU,diagram:e}},"loader"),jre={id:PU,detector:Vre,loader:Wre},Hre=jre,OU="requirement",Gre=Ze(e=>/^\s*requirement(Diagram)?/.test(e),"detector"),qre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./requirementDiagram-SO3GGRV7-21fd77d4.js"),["assets/requirementDiagram-SO3GGRV7-21fd77d4.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js"]);return{id:OU,diagram:e}},"loader"),Yre={id:OU,detector:Gre,loader:qre},Xre=Yre,RU="sequence",Zre=Ze(e=>/^\s*sequenceDiagram/.test(e),"detector"),Kre=Ze(async()=>{const{diagram:e}=await ah(()=>import("./sequenceDiagram-ZIKVLSP4-049e2f41.js"),["assets/sequenceDiagram-ZIKVLSP4-049e2f41.js","assets/chunk-67H74DCK-bdda210a.js","assets/chunk-AACKK3MU-11343222.js"]);return{id:RU,diagram:e}},"loader"),Qre={id:RU,detector:Zre,loader:Kre},Jre=Qre,NU="class",ene=Ze((e,t)=>{var n;return((n=t==null?void 0:t.class)==null?void 0:n.defaultRenderer)==="dagre-wrapper"?!1:/^\s*classDiagram/.test(e)},"detector"),tne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./classDiagram-BGRH5UQR-173a6a91.js"),["assets/classDiagram-BGRH5UQR-173a6a91.js","assets/chunk-QEP2MXWD-9373b84c.js","assets/chunk-E2GYISFI-7208b217.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js"]);return{id:NU,diagram:e}},"loader"),ine={id:NU,detector:ene,loader:tne},rne=ine,BU="classDiagram",nne=Ze((e,t)=>{var n;return/^\s*classDiagram/.test(e)&&((n=t==null?void 0:t.class)==null?void 0:n.defaultRenderer)==="dagre-wrapper"?!0:/^\s*classDiagram-v2/.test(e)},"detector"),sne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./classDiagram-v2-O24JOBDK-173a6a91.js"),["assets/classDiagram-v2-O24JOBDK-173a6a91.js","assets/chunk-QEP2MXWD-9373b84c.js","assets/chunk-E2GYISFI-7208b217.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js"]);return{id:BU,diagram:e}},"loader"),one={id:BU,detector:nne,loader:sne},ane=one,FU="state",lne=Ze((e,t)=>{var n;return((n=t==null?void 0:t.state)==null?void 0:n.defaultRenderer)==="dagre-wrapper"?!1:/^\s*stateDiagram/.test(e)},"detector"),cne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./stateDiagram-XX37X6EN-5660ea4b.js"),["assets/stateDiagram-XX37X6EN-5660ea4b.js","assets/chunk-6OLS64BW-bb06b9a6.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/graph-f2f0d433.js","assets/_baseUniq-21ee8b86.js","assets/layout-a55467e9.js","assets/_basePickBy-51cb03d2.js"]);return{id:FU,diagram:e}},"loader"),hne={id:FU,detector:lne,loader:cne},une=hne,zU="stateDiagram",dne=Ze((e,t)=>{var n;return!!(/^\s*stateDiagram-v2/.test(e)||/^\s*stateDiagram/.test(e)&&((n=t==null?void 0:t.state)==null?void 0:n.defaultRenderer)==="dagre-wrapper")},"detector"),pne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./stateDiagram-v2-GD6S3NHB-23435db0.js"),["assets/stateDiagram-v2-GD6S3NHB-23435db0.js","assets/chunk-6OLS64BW-bb06b9a6.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js"]);return{id:zU,diagram:e}},"loader"),fne={id:zU,detector:dne,loader:pne},mne=fne,UU="journey",gne=Ze(e=>/^\s*journey/.test(e),"detector"),yne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./journeyDiagram-EWQZEKCU-a147848a.js"),["assets/journeyDiagram-EWQZEKCU-a147848a.js","assets/chunk-67H74DCK-bdda210a.js","assets/chunk-E2GYISFI-7208b217.js","assets/arc-d5ccc914.js"]);return{id:UU,diagram:e}},"loader"),_ne={id:UU,detector:gne,loader:yne},vne=_ne,xne=Ze((e,t,n)=>{On.debug(`rendering svg for syntax error
`);const s=Tie(t),a=s.append("g");s.attr("viewBox","0 0 2412 512"),yF(s,100,512,!0),a.append("path").attr("class","error-icon").attr("d","m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"),a.append("path").attr("class","error-icon").attr("d","m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"),a.append("path").attr("class","error-icon").attr("d","m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"),a.append("path").attr("class","error-icon").attr("d","m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"),a.append("path").attr("class","error-icon").attr("d","m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"),a.append("path").attr("class","error-icon").attr("d","m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"),a.append("text").attr("class","error-text").attr("x",1440).attr("y",250).attr("font-size","150px").style("text-anchor","middle").text("Syntax error in text"),a.append("text").attr("class","error-text").attr("x",1250).attr("y",400).attr("font-size","100px").style("text-anchor","middle").text(`mermaid version ${n}`)},"draw"),$U={draw:xne},bne=$U,wne={db:{},renderer:$U,parser:{parse:Ze(()=>{},"parse")}},Sne=wne,VU="flowchart-elk",Tne=Ze((e,t={})=>{var n;return/^\s*flowchart-elk/.test(e)||/^\s*flowchart|graph/.test(e)&&((n=t==null?void 0:t.flowchart)==null?void 0:n.defaultRenderer)==="elk"?(t.layout="elk",!0):!1},"detector"),Cne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./flowDiagram-PKI6S5ZS-59976b58.js"),["assets/flowDiagram-PKI6S5ZS-59976b58.js","assets/chunk-E2GYISFI-7208b217.js","assets/chunk-BFAMUDN2-8f8a50ee.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/channel-0281318f.js"]);return{id:VU,diagram:e}},"loader"),Ene={id:VU,detector:Tne,loader:Cne},kne=Ene,WU="timeline",Ane=Ze(e=>/^\s*timeline/.test(e),"detector"),Mne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./timeline-definition-RI47OAVP-f17af8d3.js"),["assets/timeline-definition-RI47OAVP-f17af8d3.js","assets/arc-d5ccc914.js"]);return{id:WU,diagram:e}},"loader"),Ine={id:WU,detector:Ane,loader:Mne},Lne=Ine,jU="mindmap",Dne=Ze(e=>/^\s*mindmap/.test(e),"detector"),Pne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./mindmap-definition-CZNETY7S-efa05079.js"),["assets/mindmap-definition-CZNETY7S-efa05079.js","assets/cytoscape.esm-f5f384c8.js"]);return{id:jU,diagram:e}},"loader"),One={id:jU,detector:Dne,loader:Pne},Rne=One,HU="kanban",Nne=Ze(e=>/^\s*kanban/.test(e),"detector"),Bne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./kanban-definition-ILFWEQ3N-fc771eca.js"),["assets/kanban-definition-ILFWEQ3N-fc771eca.js","assets/chunk-E2GYISFI-7208b217.js"]);return{id:HU,diagram:e}},"loader"),Fne={id:HU,detector:Nne,loader:Bne},zne=Fne,GU="sankey",Une=Ze(e=>/^\s*sankey-beta/.test(e),"detector"),$ne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./sankeyDiagram-4UZDY2LN-540318f7.js"),["assets/sankeyDiagram-4UZDY2LN-540318f7.js","assets/ordinal-ba9b4969.js","assets/init-77b53fdd.js"]);return{id:GU,diagram:e}},"loader"),Vne={id:GU,detector:Une,loader:$ne},Wne=Vne,qU="packet",jne=Ze(e=>/^\s*packet-beta/.test(e),"detector"),Hne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./diagram-5UYTHUR4-602d8fde.js"),["assets/diagram-5UYTHUR4-602d8fde.js","assets/chunk-353BL4L5-058c9c7e.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js"]);return{id:qU,diagram:e}},"loader"),Gne={id:qU,detector:jne,loader:Hne},YU="radar",qne=Ze(e=>/^\s*radar-beta/.test(e),"detector"),Yne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./diagram-ZTM2IBQH-ca5678c7.js"),["assets/diagram-ZTM2IBQH-ca5678c7.js","assets/chunk-353BL4L5-058c9c7e.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js"]);return{id:YU,diagram:e}},"loader"),Xne={id:YU,detector:qne,loader:Yne},XU="block",Zne=Ze(e=>/^\s*block-beta/.test(e),"detector"),Kne=Ze(async()=>{const{diagram:e}=await ah(()=>import("./blockDiagram-PHRCVELO-153da067.js"),["assets/blockDiagram-PHRCVELO-153da067.js","assets/chunk-E2GYISFI-7208b217.js","assets/clone-37f55ead.js","assets/_baseUniq-21ee8b86.js","assets/graph-f2f0d433.js","assets/channel-0281318f.js"]);return{id:XU,diagram:e}},"loader"),Qne={id:XU,detector:Zne,loader:Kne},Jne=Qne,ZU="architecture",ese=Ze(e=>/^\s*architecture/.test(e),"detector"),tse=Ze(async()=>{const{diagram:e}=await ah(()=>import("./architectureDiagram-NQ2NVSRB-b5bae043.js"),["assets/architectureDiagram-NQ2NVSRB-b5bae043.js","assets/chunk-353BL4L5-058c9c7e.js","assets/chunk-AACKK3MU-11343222.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js","assets/cytoscape.esm-f5f384c8.js"]);return{id:ZU,diagram:e}},"loader"),ise={id:ZU,detector:ese,loader:tse},rse=ise,KU="treemap",nse=Ze(e=>/^\s*treemap/.test(e),"detector"),sse=Ze(async()=>{const{diagram:e}=await ah(()=>import("./diagram-3EMPZRKU-7ba73afe.js"),["assets/diagram-3EMPZRKU-7ba73afe.js","assets/chunk-SKB7J2MH-a6afdc50.js","assets/chunk-353BL4L5-058c9c7e.js","assets/chunk-AACKK3MU-11343222.js","assets/mermaid-parser.core-3828e2d2.js","assets/_baseUniq-21ee8b86.js","assets/_basePickBy-51cb03d2.js","assets/clone-37f55ead.js","assets/defaultLocale-b5afb42d.js","assets/ordinal-ba9b4969.js","assets/init-77b53fdd.js"]);return{id:KU,diagram:e}},"loader"),ose={id:KU,detector:nse,loader:sse},oN=!1,fk=Ze(()=>{oN||(oN=!0,IE("error",Sne,e=>e.toLowerCase().trim()==="error"),IE("---",{db:{clear:Ze(()=>{},"clear")},styles:{},renderer:{draw:Ze(()=>{},"draw")},parser:{parse:Ze(()=>{throw new Error("Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks")},"parse")},init:Ze(()=>null,"init")},e=>e.toLowerCase().trimStart().startsWith("---")),bM(kne,Rne,rse),bM(ure,zne,ane,rne,Sre,Lre,Ore,Bre,Xre,Jre,vre,mre,Lne,kre,mne,une,vne,$re,Wne,Gne,Hre,Jne,Xne,ose))},"addDiagrams"),ase=Ze(async()=>{On.debug("Loading registered diagrams");const t=(await Promise.allSettled(Object.entries(B1).map(async([n,{detector:s,loader:a}])=>{if(a)try{CM(n)}catch{try{const{diagram:d,id:f}=await a();IE(f,d,s)}catch(d){throw On.error(`Failed to load external diagram with key ${n}. Removing from detectors.`),delete B1[n],d}}}))).filter(n=>n.status==="rejected");if(t.length>0){On.error(`Failed to load ${t.length} external diagrams`);for(const n of t)On.error(n);throw new Error(`Failed to load ${t.length} external diagrams`)}},"loadRegisteredDiagrams"),lse="graphics-document document";function QU(e,t){e.attr("role",lse),t!==""&&e.attr("aria-roledescription",t)}Ze(QU,"setA11yDiagramInfo");function JU(e,t,n,s){if(e.insert!==void 0){if(n){const a=`chart-desc-${s}`;e.attr("aria-describedby",a),e.insert("desc",":first-child").attr("id",a).text(n)}if(t){const a=`chart-title-${s}`;e.attr("aria-labelledby",a),e.insert("title",":first-child").attr("id",a).text(t)}}}Ze(JU,"addSVGa11yTitleDescription");var iw,fI=(iw=class{constructor(t,n,s,a,d){this.type=t,this.text=n,this.db=s,this.parser=a,this.renderer=d}static async fromText(t,n={}){var E,L;const s=ug(),a=_L(t,s);t=JJ(t)+`
`;try{CM(a)}catch{const F=a9(a);if(!F)throw new rF(`Diagram ${a} not found.`);const{id:G,diagram:q}=await F();IE(G,q)}const{db:d,parser:f,renderer:i,init:S}=CM(a);return f.parser&&(f.parser.yy=d),(E=d.clear)==null||E.call(d),S==null||S(s),n.title&&((L=d.setDiagramTitle)==null||L.call(d,n.title)),await f.parse(t),new iw(a,t,d,f,i)}async render(t,n){await this.renderer.draw(this.text,t,n,this)}getParser(){return this.parser}getType(){return this.type}},Ze(iw,"Diagram"),iw),aN=[],cse=Ze(()=>{aN.forEach(e=>{e()}),aN=[]},"attachFunctions"),hse=Ze(e=>e.replace(/^\s*%%(?!{)[^\n]+\n?/gm,"").trimStart(),"cleanupComments");function e$(e){const t=e.match(iF);if(!t)return{text:e,metadata:{}};let n=sY(t[1],{schema:nY})??{};n=typeof n=="object"&&!Array.isArray(n)?n:{};const s={};return n.displayMode&&(s.displayMode=n.displayMode.toString()),n.title&&(s.title=n.title.toString()),n.config&&(s.config=n.config),{text:e.slice(t[0].length),metadata:s}}Ze(e$,"extractFrontMatter");var use=Ze(e=>e.replace(/\r\n?/g,`
`).replace(/<(\w+)([^>]*)>/g,(t,n,s)=>"<"+n+s.replace(/="([^"]*)"/g,"='$1'")+">"),"cleanupText"),dse=Ze(e=>{const{text:t,metadata:n}=e$(e),{displayMode:s,title:a,config:d={}}=n;return s&&(d.gantt||(d.gantt={}),d.gantt.displayMode=s),{title:a,config:d,text:t}},"processFrontmatter"),pse=Ze(e=>{const t=c_.detectInit(e)??{},n=c_.detectDirective(e,"wrap");return Array.isArray(n)?t.wrap=n.some(({type:s})=>s==="wrap"):(n==null?void 0:n.type)==="wrap"&&(t.wrap=!0),{text:UJ(e),directive:t}},"processDirectives");function yD(e){const t=use(e),n=dse(t),s=pse(n.text),a=eD(n.config,s.directive);return e=hse(s.text),{code:e,title:n.title,config:a}}Ze(yD,"preprocessDiagram");function t$(e){const t=new TextEncoder().encode(e),n=Array.from(t,s=>String.fromCodePoint(s)).join("");return btoa(n)}Ze(t$,"toBase64");var fse=5e4,mse="graph TB;a[Maximum text size in diagram exceeded];style a fill:#faa",gse="sandbox",yse="loose",_se="http://www.w3.org/2000/svg",vse="http://www.w3.org/1999/xlink",xse="http://www.w3.org/1999/xhtml",bse="100%",wse="100%",Sse="border:0;margin:0;",Tse="margin:0",Cse="allow-top-navigation-by-user-activation allow-popups",Ese='The "iframe" tag is not supported by your browser.',kse=["foreignobject"],Ase=["dominant-baseline"];function _D(e){const t=yD(e);return AE(),S9(t.config??{}),t}Ze(_D,"processAndSetConfigs");async function i$(e,t){fk();try{const{code:n,config:s}=_D(e);return{diagramType:(await n$(n)).type,config:s}}catch(n){if(t!=null&&t.suppressErrors)return!1;throw n}}Ze(i$,"parse");var lN=Ze((e,t,n=[])=>`
.${e} ${t} { ${n.join(" !important; ")} !important; }`,"cssImportantStyles"),Mse=Ze((e,t=new Map)=>{var s;let n="";if(e.themeCSS!==void 0&&(n+=`
${e.themeCSS}`),e.fontFamily!==void 0&&(n+=`
:root { --mermaid-font-family: ${e.fontFamily}}`),e.altFontFamily!==void 0&&(n+=`
:root { --mermaid-alt-font-family: ${e.altFontFamily}}`),t instanceof Map){const i=e.htmlLabels??((s=e.flowchart)==null?void 0:s.htmlLabels)?["> *","span"]:["rect","polygon","ellipse","circle","path"];t.forEach(S=>{sN(S.styles)||i.forEach(E=>{n+=lN(S.id,E,S.styles)}),sN(S.textStyles)||(n+=lN(S.id,"tspan",((S==null?void 0:S.textStyles)||[]).map(E=>E.replace("color","fill"))))})}return n},"createCssStyles"),Ise=Ze((e,t,n,s)=>{const a=Mse(e,n),d=$9(t,a,e.themeVariables);return cI(zie(`${s}{${d}}`),$ie)},"createUserStyles"),Lse=Ze((e="",t,n)=>{let s=e;return!n&&!t&&(s=s.replace(/marker-end="url\([\d+./:=?A-Za-z-]*?#/g,'marker-end="url(#')),s=bb(s),s=s.replace(/<br>/g,"<br/>"),s},"cleanUpSvgCode"),Dse=Ze((e="",t)=>{var a,d;const n=(d=(a=t==null?void 0:t.viewBox)==null?void 0:a.baseVal)!=null&&d.height?t.viewBox.baseVal.height+"px":wse,s=t$(`<body style="${Tse}">${e}</body>`);return`<iframe style="width:${bse};height:${n};${Sse}" src="data:text/html;charset=UTF-8;base64,${s}" sandbox="${Cse}">
  ${Ese}
</iframe>`},"putIntoIFrame"),cN=Ze((e,t,n,s,a)=>{const d=e.append("div");d.attr("id",n),s&&d.attr("style",s);const f=d.append("svg").attr("id",t).attr("width","100%").attr("xmlns",_se);return a&&f.attr("xmlns:xlink",a),f.append("g"),e},"appendDivSvgG");function mI(e,t){return e.append("iframe").attr("id",t).attr("style","width: 100%; height: 100%;").attr("sandbox","")}Ze(mI,"sandboxedIframe");var Pse=Ze((e,t,n,s)=>{var a,d,f;(a=e.getElementById(t))==null||a.remove(),(d=e.getElementById(n))==null||d.remove(),(f=e.getElementById(s))==null||f.remove()},"removeExistingElements"),Ose=Ze(async function(e,t,n){var ht,Ot,Ae,mt,bt,Dt;fk();const s=_D(t);t=s.code;const a=ug();On.debug(a),t.length>((a==null?void 0:a.maxTextSize)??fse)&&(t=mse);const d="#"+e,f="i"+e,i="#"+f,S="d"+e,E="#"+S,L=Ze(()=>{const dt=mc(G?i:E).node();dt&&"remove"in dt&&dt.remove()},"removeTempElements");let F=mc("body");const G=a.securityLevel===gse,q=a.securityLevel===yse,Q=a.fontFamily;if(n!==void 0){if(n&&(n.innerHTML=""),G){const Je=mI(mc(n),f);F=mc(Je.nodes()[0].contentDocument.body),F.node().style.margin=0}else F=mc(n);cN(F,e,S,`font-family: ${Q}`,vse)}else{if(Pse(document,e,S,f),G){const Je=mI(mc("body"),f);F=mc(Je.nodes()[0].contentDocument.body),F.node().style.margin=0}else F=mc("body");cN(F,e,S)}let te,he;try{te=await fI.fromText(t,{title:s.title})}catch(Je){if(a.suppressErrorRendering)throw L(),Je;te=await fI.fromText("error"),he=Je}const fe=F.select(E).node(),le=te.type,Se=fe.firstChild,ke=Se.firstChild,Ee=(Ot=(ht=te.renderer).getClasses)==null?void 0:Ot.call(ht,t,te),Ie=Ise(a,le,Ee,d),He=document.createElement("style");He.innerHTML=Ie,Se.insertBefore(He,ke);try{await te.renderer.draw(t,e,KR.version,te)}catch(Je){throw a.suppressErrorRendering?L():bne.draw(t,e,KR.version),Je}const Ye=F.select(`${E} svg`),lt=(mt=(Ae=te.db).getAccTitle)==null?void 0:mt.call(Ae),Pt=(Dt=(bt=te.db).getAccDescription)==null?void 0:Dt.call(bt);s$(le,Ye,lt,Pt),F.select(`[id="${e}"]`).selectAll("foreignobject > *").attr("xmlns",xse);let At=F.select(E).node().innerHTML;if(On.debug("config.arrowMarkerAbsolute",a.arrowMarkerAbsolute),At=Lse(At,G,cp(a.arrowMarkerAbsolute)),G){const Je=F.select(E+" svg").node();At=Dse(At,Je)}else q||(At=N1.sanitize(At,{ADD_TAGS:kse,ADD_ATTR:Ase,HTML_INTEGRATION_POINTS:{foreignobject:!0}}));if(cse(),he)throw he;return L(),{diagramType:le,svg:At,bindFunctions:te.db.bindFunctions}},"render");function r$(e={}){var s;const t=nf({},e);t!=null&&t.fontFamily&&!((s=t.themeVariables)!=null&&s.fontFamily)&&(t.themeVariables||(t.themeVariables={}),t.themeVariables.fontFamily=t.fontFamily),b9(t),t!=null&&t.theme&&t.theme in ev?t.themeVariables=ev[t.theme].getThemeVariables(t.themeVariables):t&&(t.themeVariables=ev.default.getThemeVariables(t.themeVariables));const n=typeof t=="object"?x9(t):cF();yL(n.logLevel),fk()}Ze(r$,"initialize");var n$=Ze((e,t={})=>{const{code:n}=yD(e);return fI.fromText(n,t)},"getDiagramFromText");function s$(e,t,n,s){QU(t,e),JU(t,n,s,t.attr("id"))}Ze(s$,"addA11yInfo");var mb=Object.freeze({render:Ose,parse:i$,getDiagramFromText:n$,initialize:r$,getConfig:ug,setConfig:hF,getSiteConfig:cF,updateSiteConfig:w9,reset:Ze(()=>{AE()},"reset"),globalReset:Ze(()=>{AE(F1)},"globalReset"),defaultConfig:F1});yL(ug().logLevel);AE(ug());var Rse=Ze((e,t,n)=>{On.warn(e),JL(e)?(n&&n(e.str,e.hash),t.push({...e,message:e.str,error:e})):(n&&n(e),e instanceof Error&&t.push({str:e.message,message:e.message,hash:e.name,error:e}))},"handleError"),o$=Ze(async function(e={querySelector:".mermaid"}){try{await Nse(e)}catch(t){if(JL(t)&&On.error(t.str),Dy.parseError&&Dy.parseError(t),!e.suppressErrors)throw On.error("Use the suppressErrors option to suppress these errors"),t}},"run"),Nse=Ze(async function({postRenderCallback:e,querySelector:t,nodes:n}={querySelector:".mermaid"}){const s=mb.getConfig();On.debug(`${e?"":"No "}Callback function found`);let a;if(n)a=n;else if(t)a=document.querySelectorAll(t);else throw new Error("Nodes and querySelector are both undefined");On.debug(`Found ${a.length} diagrams`),(s==null?void 0:s.startOnLoad)!==void 0&&(On.debug("Start On Load: "+(s==null?void 0:s.startOnLoad)),mb.updateSiteConfig({startOnLoad:s==null?void 0:s.startOnLoad}));const d=new c_.InitIDGenerator(s.deterministicIds,s.deterministicIDSeed);let f;const i=[];for(const S of Array.from(a)){if(On.info("Rendering diagram: "+S.id),S.getAttribute("data-processed"))continue;S.setAttribute("data-processed","true");const E=`mermaid-${d.next()}`;f=S.innerHTML,f=D4(c_.entityDecode(f)).trim().replace(/<br\s*\/?>/gi,"<br/>");const L=c_.detectInit(f);L&&On.debug("Detected early reinit: ",L);try{const{svg:F,bindFunctions:G}=await h$(E,f,S);S.innerHTML=F,e&&await e(E),G&&G(S)}catch(F){Rse(F,i,Dy.parseError)}}if(i.length>0)throw i[0]},"runThrowsErrors"),a$=Ze(function(e){mb.initialize(e)},"initialize"),Bse=Ze(async function(e,t,n){On.warn("mermaid.init is deprecated. Please use run instead."),e&&a$(e);const s={postRenderCallback:n,querySelector:".mermaid"};typeof t=="string"?s.querySelector=t:t&&(t instanceof HTMLElement?s.nodes=[t]:s.nodes=t),await o$(s)},"init"),Fse=Ze(async(e,{lazyLoad:t=!0}={})=>{fk(),bM(...e),t===!1&&await ase()},"registerExternalDiagrams"),l$=Ze(function(){if(Dy.startOnLoad){const{startOnLoad:e}=mb.getConfig();e&&Dy.run().catch(t=>On.error("Mermaid failed to initialize",t))}},"contentLoaded");typeof document<"u"&&window.addEventListener("load",l$,!1);var zse=Ze(function(e){Dy.parseError=e},"setParseErrorHandler"),a2=[],BA=!1,c$=Ze(async()=>{if(!BA){for(BA=!0;a2.length>0;){const e=a2.shift();if(e)try{await e()}catch(t){On.error("Error executing queue",t)}}BA=!1}},"executeQueue"),Use=Ze(async(e,t)=>new Promise((n,s)=>{const a=Ze(()=>new Promise((d,f)=>{mb.parse(e,t).then(i=>{d(i),n(i)},i=>{var S;On.error("Error parsing",i),(S=Dy.parseError)==null||S.call(Dy,i),f(i),s(i)})}),"performCall");a2.push(a),c$().catch(s)}),"parse"),h$=Ze((e,t,n)=>new Promise((s,a)=>{const d=Ze(()=>new Promise((f,i)=>{mb.render(e,t,n).then(S=>{f(S),s(S)},S=>{var E;On.error("Error parsing",S),(E=Dy.parseError)==null||E.call(Dy,S),i(S),a(S)})}),"performCall");a2.push(d),c$().catch(a)}),"render"),Dy={startOnLoad:!0,mermaidAPI:mb,parse:Use,render:h$,init:Bse,run:o$,registerExternalDiagrams:Fse,registerLayoutLoaders:yU,initialize:a$,parseError:void 0,contentLoaded:l$,setParseErrorHandler:zse,detectType:_L,registerIconPacks:rte};/*! Check if previously processed *//*!
 * Wait for document loaded before starting the execution
 */const hN=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],iv=(()=>{if(typeof document>"u")return!1;const e=hN[0],t={};for(const n of hN)if((n==null?void 0:n[1])in document){for(const[a,d]of n.entries())t[e[a]]=d;return t}return!1})(),uN={change:iv.fullscreenchange,error:iv.fullscreenerror};let Ly={request(e=document.documentElement,t){return new Promise((n,s)=>{const a=()=>{Ly.off("change",a),n()};Ly.on("change",a);const d=e[iv.requestFullscreen](t);d instanceof Promise&&d.then(a).catch(s)})},exit(){return new Promise((e,t)=>{if(!Ly.isFullscreen){e();return}const n=()=>{Ly.off("change",n),e()};Ly.on("change",n);const s=document[iv.exitFullscreen]();s instanceof Promise&&s.then(n).catch(t)})},toggle(e,t){return Ly.isFullscreen?Ly.exit():Ly.request(e,t)},onchange(e){Ly.on("change",e)},onerror(e){Ly.on("error",e)},on(e,t){const n=uN[e];n&&document.addEventListener(n,t,!1)},off(e,t){const n=uN[e];n&&document.removeEventListener(n,t,!1)},raw:iv};Object.defineProperties(Ly,{isFullscreen:{get:()=>!!document[iv.fullscreenElement]},element:{enumerable:!0,get:()=>document[iv.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>!!document[iv.fullscreenEnabled]}});iv||(Ly={isEnabled:!1});const uu=(e,t,n=[],s=!1,a=null)=>{Ar(()=>{if(!e.current)return;const d=AUI.$(e.current);d.data("select2")&&d.select2("destroy");let f=a?AUI.$(a):d.closest(".modal, .popup, .dialog, .sidebar");f.length||(f=AUI.$("body")),d.select2({minimumResultsForSearch:s?1/0:0,dropdownParent:f});const i=S=>{t&&t(S)};return d.off(".reactSelect2").on("change.reactSelect2",i),()=>{d.off(".reactSelect2"),d.data("select2")&&d.select2("destroy")}},[e,s,a,...n])},Dr=()=>{const e=(le,Se,ke=null)=>{const Ee=Number(le),Ie=Number(Se),He=new Date,Ye=new Date(Ie,Ee+1,0).getDate(),Pt=He.getMonth()===Ee&&He.getFullYear()===Ie?He.getDate():Ye;let At=1,ht=1;if(ke){const mt=new Date(ke);if(mt.getMonth()===Ee&&mt.getFullYear()===Ie){const Dt=mt.getDate();ht=Math.ceil(Dt/7),At=(ht-1)*7+1}}const Ot=[];let Ae=ht;for(;At<=Pt;){let mt=At+6;mt>Ye&&(mt=Ye),Ot.push(`${At}-${mt} ${q[Ee]} <br /> (Week ${Ae})`),At=mt+1,Ae++}return Ot},t=le=>{const Se={hour:"2-digit",minute:"2-digit",hour12:!0},ke=le.toLocaleTimeString("en-US",Se);return`${le.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})} - ${ke}`},n=()=>{const le=new Date;return Array.from({length:7},(Se,ke)=>{const Ee=new Date;return Ee.setDate(le.getDate()-7+ke),`${Ee.getDate()}-${Ee.toLocaleString("default",{month:"short"})}-${Ee.getFullYear()}`})},s=le=>({Q1:["Q1 (Jan-Mar)"],Q2:["Q2 (Apr-Jun)"],Q3:["Q3 (Jul-Sep)"],Q4:["Q4 (Oct-Dec)"]})[le]||[],a=le=>({Q1:["January","February","March"],Q2:["April","May","June"],Q3:["July","August","September"],Q4:["October","November","December"]})[le]||[],d=()=>{const le=new Date;le.setMinutes(0,0,0);const Se=[];for(let ke=0;ke<=24;ke++){const Ee=new Date(le);Ee.setHours(le.getHours()-(24-ke));const Ie=Ee.toDateString()===le.toDateString(),He=Ee.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}).replace("am","AM").replace("pm","PM"),Ye=Ie?`${Ee.toLocaleDateString(void 0,{month:"short",day:"2-digit"})} - ${He}`:He,lt=`${Ee.getFullYear()}-${(Ee.getMonth()+1).toString().padStart(2,"0")}-${Ee.getDate().toString().padStart(2,"0")} ${Ee.getHours().toString().padStart(2,"0")}:00`;Se.push({label:Ye,key:lt})}return Se},f=(le,Se,ke)=>{Se=typeof Se=="string"?parseInt(Se,10):Se;const Ee=new Date(ke),Ie=Ee.getFullYear(),He=Math.floor(Ee.getMonth()/3),Ye=new Date,lt=Ye.getFullYear(),Pt=Math.floor(Ye.getMonth()/3),At={Q1:0,Q2:1,Q3:2,Q4:3}[le];return Se<Ie?!0:Se===Ie?Ie===lt?At<He||At>Pt:At<He:Se>Ie?Se<lt?!1:Se===lt?At>Pt:!0:!0},i=le=>le>=0&&le<=2?"Q1":le>=3&&le<=5?"Q2":le>=6&&le<=8?"Q3":"Q4",S=le=>le?["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(le.toLowerCase()):0,E=(le,Se)=>{const ke=new Date,Ee=ke.getFullYear(),Ie=Math.floor(ke.getMonth()/3),He={Q1:0,Q2:1,Q3:2,Q4:3}[le];return(Se?Number(Se):Ee)===Ee&&He>Ie},L=(le,Se,ke)=>{Se=typeof Se=="string"?parseInt(Se,10):Se;const Ee=new Date(ke);console.log("Cutoff date:",Ee);const Ie=Ee.getFullYear(),He=Ee.getMonth(),Ye=new Date,lt=Ye.getFullYear(),Pt=Ye.getMonth(),At=q.indexOf(le);return At===-1?(console.warn("Invalid month:",le),!0):Se<Ie?!0:Se===Ie?Ie===lt?At<He||At>Pt:At<He:Se>Ie?Se<lt?!1:Se===lt?At>Pt:!0:!0},F=le=>{const Se=new Date().getMonth();return q.indexOf(le)>Se},G=le=>{if(!le)return 0;const Se=le.match(/(\d+)Day\(s\)/),ke=le.match(/(\d+)H/),Ee=le.match(/(\d+)m/),Ie=le.match(/(\d+)s/),He=Se?parseInt(Se[1],10):0,Ye=ke?parseInt(ke[1],10):0,lt=Ee?parseInt(Ee[1],10):0,Pt=Ie?parseInt(Ie[1],10):0,ht=(He*24*3600+Ye*3600+lt*60+Pt)/3600;return parseFloat(ht.toFixed(2))},q=["January","February","March","April","May","June","July","August","September","October","November","December"],Q=(le,Se)=>{console.log("Selected year:",le,"Service start date:",Se);const ke=new Date,Ee=ke.getFullYear(),Ie=ke.getMonth(),He=new Date(Se),Ye=He.getFullYear(),lt=He.getMonth();return console.log("Cutoff year:",Ye,"Cutoff month index:",lt),le==Ee?q[Ie]:le==Ye?q[lt]:(le>Ye&&le<Ee,q[0])},te=["Q1","Q2","Q3","Q4"],he=new Date().getFullYear(),fe=[he-1,he,he+1];return{getMonthsForQuarter:s,getLabelForQuarter:a,formatHourLabel:t,generateWeeksForMonth:e,generateLast24Hours:d,parseMttrToHours:G,generateLast7Days:n,isQuarterDisabled:E,isMonthDisabled:F,isQuarterYearDisabled:f,isMonthYearDisabled:L,getDefaultMonth:Q,getQuarterFromMonth:i,getMonthIndex:S,months:q,quarters:te,years:fe,currentYear:he}},$se=({options:e=[],placeholder:t="Select an option",value:n=null,shouldDisabled:s=null,uptimeSelectedYear:a=null,serviceStartDate:d=null,onChange:f,display:i=!0,classNameList:S=null})=>{const[E,L]=It(!1),[F,G]=It(n),[q,Q]=It(!1),te=wo(null),he=wo(null);Ar(()=>{G(n)},[n]),Ar(()=>{const Se=ke=>{te.current&&!te.current.contains(ke.target)&&L(!1)};return document.addEventListener("mousedown",Se),()=>document.removeEventListener("mousedown",Se)},[]);const fe=Se=>{G(Se),L(!1),f&&f(Se)},le=()=>{L(Se=>{const ke=!Se;return ke&&setTimeout(()=>{if(te.current&&he.current){const Ee=te.current.getBoundingClientRect(),He=window.innerHeight-Ee.bottom,Ye=Ee.top,lt=he.current.scrollHeight;He<lt&&Ye>He?Q(!0):Q(!1)}},0),ke})};return B.createElement("div",{className:`form-group custom-select-group ${E?"open":""} ${i?"":"d-none"} ${S}`,ref:te},B.createElement("button",{type:"button",onClick:le,className:"custom-select"},B.createElement("span",null,F&&(F!=null&&F.label)?F.label:t)),E&&B.createElement("ul",{ref:he,className:`form-control-dropdown ${q?"open-up":"open-down"}`},e.map(Se=>{var Ee;let ke=!1;if(d){const Ie=(Ee=new Date(d))==null?void 0:Ee.getFullYear(),He=Dr().currentYear;ke=typeof s=="function"?s(Se.value,a,d):Se.value<Ie||Se.value>He}return B.createElement("li",{key:Se.value,onClick:()=>fe(Se),className:`form-control-dropdown-item ${(F==null?void 0:F.value)===Se.value?"selected":""} ${ke?"disabled":""}`},Se.label)})))},vD=({totalRecords:e,pageSize:t,page:n,onPageChange:s,onPageSizeChange:a})=>{const d=Math.ceil((Number(e)||0)/(Number(t)||1)),[f,i]=It(!1),S=wo(null),E=()=>{const G=[];if(f||d<=3){for(let q=1;q<=d;q++)G.push(q);return G}return n<=3?G.push(1,2,3,"...",d):n>=d-2?G.push(1,"...",d-2,d-1,d):G.push(1,"...",n-1,n,n+1,"...",d),G},L=()=>e<=10?[10]:e<=20?[10,20]:e<=30?[10,20,30]:e<=40?[10,20,30,40]:e<=50?[10,20,30,40,50]:[10,20,30,40,50],F=G=>{G!=="..."&&G!==n&&s(Number(G))};return uu(S,G=>a(Number(G.target.value)),[],!0,"#Tickets .tabular-content-container"),B.createElement(B.Fragment,null,B.createElement("div",{className:"page-record"},"Record",B.createElement($se,{options:L().map(G=>({value:G,label:`${G}`})),placeholder:null,onChange:G=>a(Number(G.value)),value:{value:t,label:`${t}`}})),B.createElement("div",{className:"pagination-wrapper"},B.createElement("nav",{"aria-label":"Custom Pagination"},B.createElement("ul",{className:"pagination mb-0"},B.createElement("li",{className:`page-item ${n==1?"disabled ":""}`},B.createElement("a",{className:`page-link ${n==1?"disabled ":""}`,role:"button",tabIndex:n==1?-1:0,onClick:()=>F(1)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_double_arrow_left"))),B.createElement("li",{className:`page-item ${n==1?"disabled disable-event":""}`},B.createElement("a",{className:`page-link ${n==1?"disabled disable-event":""}`,role:"button",tabIndex:n==1?-1:0,onClick:()=>F(Number(n)-1)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_left"))),E().map((G,q)=>B.createElement("li",{key:q,className:`page-item ${n==G?"active":""}`},G==="..."?B.createElement("a",{className:"page-link",role:"button",onClick:()=>i(!0),title:"Show all pages"},"..."):B.createElement("a",{className:n==G?"page-link active":"page-link",role:"button",onClick:()=>F(G)},G))),B.createElement("li",{className:`page-item ${n==d?"disabled disable-event":""}`},B.createElement("a",{className:`page-link ${n==d?"disabled disable-event":""}`,role:"button",tabIndex:n==d?-1:0,onClick:()=>F(Number(n)+1)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"))),B.createElement("li",{className:`page-item ${n==d?"disabled disable-event":""}`},B.createElement("a",{className:`page-link ${n==d?"disabled disable-event":""}`,role:"button",tabIndex:n==d?-1:0,onClick:()=>F(d)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_double_arrow_right")))))))},Vse=({supportDetail:e,viewDetailStatusValue:t})=>{var n,s;return console.debug("TicketBasicDetails ::: supportDetail",e),e==null?B.createElement("div",{className:"noRecordFound"},"No data available."):B.createElement("div",{className:"card ticket-detail-card"},B.createElement("div",{className:"card-title"},B.createElement("h4",null,"Basic Information"),B.createElement("div",{className:"posted-details"},(e==null?void 0:e.issueRaisedDateTime)&&B.createElement("div",{className:"date-time-dtls"},"Issue Raised Time: ",fa().formatDateTime((e==null?void 0:e.issueRaisedDateTime)||"-")))),B.createElement("div",{className:"card-body"},B.createElement("div",{className:"row"},B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Ticket ID"),B.createElement("div",{className:"value"},(e==null?void 0:e.ticketId)||"-"))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Service ID"),B.createElement("div",{className:"value"},(e==null?void 0:e.serviceId)||"-"))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Product"),B.createElement("div",{className:"value"},(e==null?void 0:e.serviceType)||"-"))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Service Impacted"),B.createElement("div",{className:"value"},(e==null?void 0:e.serviceImpacted)||"-"))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Nature Of Complaint"),B.createElement("div",{className:"value"},(e==null?void 0:e.suspectedTroubleComponent)||"-"))),["resolved","close","closed"].includes((n=e==null?void 0:e.status)==null?void 0:n.toLowerCase())&&B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Resolved Time"),B.createElement("div",{className:"value"},fa().formatDateTime((e==null?void 0:e.resolvedTime)||"-")))),["resolved","close","closed"].includes((s=e==null?void 0:e.status)==null?void 0:s.toLowerCase())&&B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Closed Date"),B.createElement("div",{className:"value"},fa().formatDateTime((e==null?void 0:e.ticketCloseDate)||"-")))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Priority"),B.createElement("div",{className:"value"},(e==null?void 0:e.priority)||"-"))),B.createElement("div",{className:"col-md-4 col-sm-6 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Severity"),B.createElement("div",{className:"value"},(e==null?void 0:e.severity)||"-"))),B.createElement("div",{className:"col-md-12 col-sm-12 mb-25"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Subject"),B.createElement("div",{className:"value"},(e==null?void 0:e.subject)||"-"))),B.createElement("div",{className:"col-md-12 col-sm-12"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Description"),B.createElement("div",{className:"value",dangerouslySetInnerHTML:{__html:(e==null?void 0:e.description)||"-"}}))))))},Wse=({supportETR:e})=>{console.debug("supportETR ::: ",e);const t=50,n=2*Math.PI*t;Ar(()=>{e&&s(e.progressPercent)},[e]);function s(a){const d=document.getElementById("progressCircle");if(a==0)d.strokeDashoffset=0,d.strokeDasharray=0;else{let f=n-a/100*n;d&&(d.style.strokeDashoffset=f,e!=null&&e.isTTR?d.classList.remove("ontrack"):a>=100?d.classList.add("overdue"):d.classList.remove("ontrack"))}}return e==null?B.createElement("div",{className:"alert alert-info",role:"alert"}," No data available for ETR."):B.createElement("div",{className:"card EST ticket-detail-card"},B.createElement("div",{className:"card-body text-center"},B.createElement("h2",null," ",e.label," "),B.createElement("div",{className:"EST-timer"},B.createElement("svg",{width:"400",height:"300",viewBox:"0 0 239 172",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B.createElement("g",{filter:"url(#filter0_i_2347_54845)"},B.createElement("path",{className:"EST-timer-main-circle",d:"M166.954 104.585C167.073 136.316 141.447 162.135 109.716 162.255C77.9854 162.374 52.1656 136.748 52.0462 105.017C51.9268 73.2865 77.5529 47.4667 109.284 47.3473C141.015 47.2278 166.834 72.8539 166.954 104.585Z",stroke:"white",strokeWidth:"15"})),B.createElement("circle",{cx:"109.539",cy:"104.862",r:"61.7789",stroke:"#D3D3D3",strokeWidth:"1",fill:"none"}),B.createElement("circle",{id:"progressCircle",cx:"109.539",cy:"104.862",r:"61.7789",stroke:"#3b82f6",strokeWidth:"10",fill:"none",className:"progress-bar",strokeLinecap:"round",strokeDasharray:"388",strokeDashoffset:"388"}),B.createElement("circle",{cx:"109.539",cy:"104.862",r:"50",fill:"none",className:"timer-circle"}),B.createElement("text",{x:"109.539",y:"95",className:"label-text",textAnchor:"middle"},"HH:MM"),B.createElement("text",{id:"timerText",x:"109.539",y:"122",className:`timer-text ${e==null?void 0:e.overdueClass} ${e==null?void 0:e.openTicketClass}ontrack`,textAnchor:"middle"},e.etrTime),B.createElement("defs",null,B.createElement("filter",{id:"boxShadowFilter",x:"50",y:"50",width:"120",height:"120",filterUnits:"userSpaceOnUse"},B.createElement("feDropShadow",{dx:"0",dy:"4",stdDeviation:"6",floodColor:"black",floodOpacity:"0.5"})))))))},dN=async(e,t,n,s)=>{var a;try{const d=`/o/krypton-common-api/v1.0/checkPermissions?userId=${e}&portletName=${t}&modelName=${n}&actionId=${s}`,f=await Go.get(d);return(a=f==null?void 0:f.data)!=null&&a.error?{error:f.data.error}:(f==null?void 0:f.data)===!1?{data:!1}:{data:(f==null?void 0:f.data)??!1}}catch(d){return console.error("Error checking permission:",d),{error:"Failed to check permission. Please try again later."}}},jse=async e=>{try{console.debug("documents",e);const t=`/o/krypton-common-api/v1.0/document-details?documents=${e}`;return await Go.get(t)}catch(t){return console.error("Error fetching support documents:",t),{error:"Failed to fetch support documents. Please try again later."}}},Hse=async e=>{try{const t=`/o/krypton-ticket-api/v1.0/ticket/attachments?ticketId=${e}`;return await Go.get(t)}catch(t){return console.error("Error fetching support documents:",t),{error:"Failed to fetch support documents. Please try again later."}}},Gse=async e=>{try{const t=`/o/krypton-ticket-api/v1.0/ticket/information?ticketId=${e}`;return await Go.get(t)}catch(t){return console.error("Error fetching ticket detail:",t),{error:"Failed to fetch ticket detail. Please try again later."}}},qse=e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=Uint8Array.from(t,d=>d.charCodeAt(0)),s=new Blob([n],{type:"application/pdf"});return URL.createObjectURL(s)},Yse=e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=Uint8Array.from(t,d=>d.charCodeAt(0)),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return URL.createObjectURL(s)},Xse=(e,t)=>{if(!e)return console.error("No file data available"),null;e.startsWith("data:image")&&(e=e.split(",")[1]);let n;try{n=atob(e)}catch(i){return console.error("Error decoding base64 string",i),null}const s=Uint8Array.from(n,i=>i.charCodeAt(0));let a,d;return["png","jpg","jpeg"].includes(t)&&(d=`image/${t}`,a=new Blob([s],{type:d})),URL.createObjectURL(a)},Zse=e=>{if(!e)return console.error("No file data available"),null;let t;try{t=atob(e)}catch(d){return console.error("Error decoding base64 string",d),null}const n=Uint8Array.from(t,d=>d.charCodeAt(0)),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});return URL.createObjectURL(s)},Kse=(e,t)=>{if(!e)return console.error("No file data available"),null;let n;try{n=atob(e)}catch(f){return console.error("Error decoding base64 string",f),null}const s=Uint8Array.from(n,f=>f.charCodeAt(0)),a=new Blob([s],{type:t});return URL.createObjectURL(a)},Qse=({supportDetail:e,supportId:t,detailPermissions:n})=>{var Ee;const[s,a]=It([]),[d,f]=It(!0),[i,S]=It(!1),[E,L]=It([]),[F,G]=It(""),[q,Q]=It(!1),[te,he]=It(!1),[fe,le]=It(!1);Ar(()=>{var He;const Ie=async()=>{var Ye,lt,Pt,At,ht,Ot,Ae,mt;if(!(!e||!e.attachments)){f(!0);try{const bt=await Hse(t);!bt||((Pt=(lt=(Ye=bt==null?void 0:bt.data)==null?void 0:Ye.items)==null?void 0:lt.documents)==null?void 0:Pt.statusCode)==="500"?(G((bt==null?void 0:bt.error)||"Documents not available."),a([])):(a(((ht=(At=bt==null?void 0:bt.data)==null?void 0:At.items)==null?void 0:ht.documents)||[]),G(((mt=(Ae=(Ot=bt==null?void 0:bt.data)==null?void 0:Ot.items)==null?void 0:Ae.documents)==null?void 0:mt.length)===0?"Documents not available.":""))}catch{console.error("Something went wrong in fetching documents."),S("Something went wrong in fetching documents.")}finally{f(!1)}}};(He=n==null?void 0:n.viewTicketDetailAttachments)!=null&&He.hasPermission&&s.length===0&&Ie()},[e,t]),Ar(()=>{if(!s||s.length===0)return;f(!0);const Ie=s.documents.map(He=>{const Ye=He==null?void 0:He.fileName.replace(/\.[^/.]+$/,""),lt=He==null?void 0:He.fileName.split(".").pop().toLowerCase();return{fileName:Ye,id:He==null?void 0:He.id,fileExtension:lt,base64String:He==null?void 0:He.base64String,fullFileName:He==null?void 0:He.fileName,description:He==null?void 0:He.description,size:He==null?void 0:He.fileSize}});console.debug("setDocUrls :: urls",Ie),L(Ie),f(!1)},[s]);const Se=(Ie,He,Ye)=>{if(!Ie||!He||!Ye){console.error("No base64 data provided.");return}try{let lt=null;He=="pdf"?lt=eG(Ie,Ye):["png","jpg","jpeg"].includes(He)&&(lt=nG(Ie,He,Ye))}catch(lt){console.error("Error generating preview",lt)}};Ar(()=>{var Ie,He;console.debug("Window: ",window),Q((Ie=window.validateEditRquestAccessObj)==null?void 0:Ie.hasImpersonated),he((He=window.validateEditRquestAccessObj)==null?void 0:He.hasImpersonationEditAccess)},[window.validateEditRquestAccessObj]),Ar(()=>{(()=>{var Ye;const He=!((Ye=n==null?void 0:n.downloadTicketDetailAttachments)!=null&&Ye.hasPermission)||q&&!te;le(He)})()},[q,te,n==null?void 0:n.downloadTicketDetailAttachments]),Ar(()=>{const Ie=document.getElementsByClassName("custom-tooltip"),He=Array.from(Ie).map(Ye=>new window.bootstrap.Tooltip(Ye));return()=>{He.forEach(Ye=>Ye.dispose())}},[]);const ke=(Ie,He,Ye)=>{try{const lt=atob(Ie),Pt=new Array(lt.length);for(let bt=0;bt<lt.length;bt++)Pt[bt]=lt.charCodeAt(bt);const At=new Uint8Array(Pt),Ot={pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",txt:"text/plain"}[Ye==null?void 0:Ye.toLowerCase()]||"application/octet-stream",Ae=new Blob([At],{type:Ot}),mt=document.createElement("a");mt.href=URL.createObjectURL(Ae),mt.download=He||`download.${Ye||"bin"}`,document.body.appendChild(mt),mt.click(),document.body.removeChild(mt),URL.revokeObjectURL(mt.href)}catch(lt){console.error("Download failed:",lt)}};return B.createElement(B.Fragment,null,d?B.createElement("div",{className:"loader_wrap"},B.createElement("div",{className:"loader"})):(Ee=n==null?void 0:n.viewTicketDetailAttachments)!=null&&Ee.hasPermission?(E==null?void 0:E.length)==0?B.createElement("div",{class:"alert alert-info",role:"alert"}," Documents not available."):F?B.createElement("div",{className:"col-md-12"},B.createElement("div",{className:"alert alert-info",role:"alert"},F)):i?B.createElement("div",{className:"alert alert-danger"},i):E&&(E==null?void 0:E.length)>0?B.createElement("ul",{className:"documents_list"},E.map((Ie,He)=>{var Ye;return B.createElement("li",null,B.createElement("div",{className:"docs_informations"},B.createElement("div",{className:"docs_type"},B.createElement("div",{className:"name"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},Ie.docsType=="pdf"?"picture_as_pdf":Ie.docsType=="xls"?"description":Ie.docsType=="img"?"image":"docs")),B.createElement("div",{className:"size"},Ie==null?void 0:Ie.size)),B.createElement("div",{className:"docs_details"},B.createElement("div",{className:"docs_name"},Ie==null?void 0:Ie.fileName)),B.createElement("div",{className:"buttons-group-inline"},B.createElement("span",{"data-toggle":"tooltip",title:["pdf","png","jpg","jpeg"].includes(Ie==null?void 0:Ie.fileExtension)?"View":"No preview available",className:"custom-tooltip"},B.createElement("a",{href:"javascript:void(0)",className:`${(Ye=n==null?void 0:n.previewTicketDetailAttachments)!=null&&Ye.hasPermission&&["pdf","png","jpg","jpeg"].includes(Ie==null?void 0:Ie.fileExtension)?"view-btn":"disable-event disabled"}`,onClick:()=>Se(Ie==null?void 0:Ie.base64String,Ie==null?void 0:Ie.fileExtension,Ie==null?void 0:Ie.fullFileName)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"visibility"))),B.createElement("a",{href:"javascript:void(0)",download:fe||Ie==null?void 0:Ie.fileName,className:`download download-btn ${fe?"disable-event disabled":""}`,title:"Download",onClick:lt=>{lt.preventDefault(),ke(Ie.base64String,Ie.fileName,Ie.fileExtension)}},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"file_save")))))})):B.createElement("div",{class:"alert alert-info",role:"alert"},"Something went wrong..."):B.createElement("div",{className:"alert alert-warning mt-3"}," You don't have the required permissions to view support attachment(s)."))},Jse=B.memo(({supportId:e,externalRefId:t,relatedTicketWidgetConfig:n,clubStatusesMap:s})=>{const[a,d]=It(!0),[f,i]=It(!1),[S,E]=It([]),[L,F]=It(!0),[G,q]=It(1),[Q,te]=It(10),[he,fe]=It(0),le=Ee=>{q(Ee)},Se=Ee=>{te(Ee),q(1)};if(Ar(()=>{(async()=>{const Ie=Number(Liferay.ThemeDisplay.getUserId()),He=await qg(Ie,"CX Krypton Permission","com.constl.krypton.rbac.Support","ViewRelatedTickets");F(He==null?void 0:He.data)})()},[]),Ar(()=>{L&&t&&(async()=>{var Ie,He;if(!n){d(!1),E([]),fe(0),q(1),te(10);return}try{d(!0);const{restBuilderApiURL:Ye,propsData:lt,ticketStatusRelationMappingKey:Pt}=n;let At=lt,ht=G,Ot=Q;G>0&&(At.page=ht),Q>0&&(At.pageSize=Ot);let Ae=JSON.stringify(At||{});Ae=Ae.split("$_externalRefEntityId_$").join(`'${t}'`),Ae=Ae.split("$_ticketId_$").join(`'${e}'`);const mt=btoa(Ae),bt=Liferay.ThemeDisplay.getUserId(),Dt=Liferay.ThemeDisplay.getSiteGroupId(),Je=`${Ye}?propsData=${mt}&userId=${bt}&siteId=${Dt}`,{data:dt}=await Go.get(Je);if(console.debug("data?.items?.length",(Ie=dt==null?void 0:dt.items)==null?void 0:Ie.length),(He=dt==null?void 0:dt.items)!=null&&He.length){const ui=dt.items.map(Vt=>{var ur;return{...Vt,status:(ur=Vt[Pt])==null?void 0:ur.statusVal}});E(ui),q(dt==null?void 0:dt.page),te(dt==null?void 0:dt.pageSize),fe(Number(dt==null?void 0:dt.totalCount))}else E([]),fe(0),q(1),te(10)}catch(Ye){console.error("Error fetching support user list:",Ye),E([]),fe(0),q(1),te(10)}finally{d(!1)}})()},[n,L,t,G,Q]),!L)return B.createElement("div",{className:"alert alert-warning mt-3"}," You don't have the required permissions to view related ticket(s).");const ke=(Ee,Ie)=>{for(const He in Ie)if((Array.isArray(Ie[He])?Ie[He]:String(Ie[He]).split(",")).map(lt=>lt.trim()).includes(Ee))return He;return Ee};return B.createElement(B.Fragment,null,a&&B.createElement(B.Fragment,null,B.createElement("div",{className:"tabular-content-container loader_wrap"},B.createElement("div",{className:"table-main-body"},B.createElement("div",{className:"table-container"},B.createElement("div",{class:"loader"}," "))))),f&&B.createElement("div",{className:"alert alert-danger mb-3 mt-3",role:"alert"},f),!a&&S.length>0&&B.createElement(B.Fragment,null,B.createElement("div",{className:"tabular-content-container"},B.createElement("div",{className:"table-main-body"},B.createElement("div",{className:"table-container"},B.createElement("table",{id:"example",className:"table dataTable",style:{width:"100%"}},B.createElement("thead",null,B.createElement("tr",null,B.createElement("th",null,"Ticket ID"),B.createElement("th",null,"Service ID"),B.createElement("th",null,"Subject"),B.createElement("th",null,"Status"),B.createElement("th",null,"Date"))),B.createElement("tbody",null,S.map(Ee=>{var Ie;return B.createElement("tr",{key:Ee==null?void 0:Ee.ticketId},B.createElement("td",null,Ee==null?void 0:Ee.ticketId),B.createElement("td",null,Ee==null?void 0:Ee.externalRefEntityId),B.createElement("td",null,Ee==null?void 0:Ee.subject),B.createElement("td",null,B.createElement("span",{className:`ticket-status-${(Ie=Ee==null?void 0:Ee.status)==null?void 0:Ie.split(" ").join("").toLowerCase()}`},ke(Ee==null?void 0:Ee.status,s))),B.createElement("td",null," ",fa().formatDate(Ee==null?void 0:Ee.ticketCreatedDate)))}))))),he>10&&B.createElement("div",{class:"table-footer"},B.createElement(vD,{onPageChange:le,onPageSizeChange:Se,page:G,pageSize:Q,totalRecords:he})))),!a&&S.length==0&&B.createElement(B.Fragment,null,B.createElement("div",{className:"tabular-content-container"},B.createElement("table",{id:"example",className:"table dataTable",style:{width:"100%"}},B.createElement("thead",null,B.createElement("tr",null,B.createElement("th",null,"Ticket ID"),B.createElement("th",null,"Service ID"),B.createElement("th",null,"Subject"),B.createElement("th",null,"Status"),B.createElement("th",null,"Date"))),B.createElement("tbody",null,B.createElement("td",{colspan:"5"},B.createElement("div",{class:"alert alert-info",role:"alert"}," No related tickets.")))))))}),u$=({constlSupportTeamWidgetsConfig:e,extraClass:t,hasPermission:n,externalReferenceId:s,extraTeamDetail:a,redirectFrom:d})=>{const[f,i]=It(!0),[S,E]=It(null);console.debug("extraTeamDetail ---------- ",a),Ar(()=>{n&&s&&(async()=>{var G,q;if(!e){i(!1),E([]);return}try{i(!0);const{restBuilderApiURL:Q,propsData:te,entityTypeId:he,supportUserContactMappingKey:fe}=e;let le=JSON.stringify(te||{});le=le.split("$_entityTypeMasterId_$").join(`'${he}'`),le=le.split("$_externalReferenceId_$").join(`'${s}'`);const Se=btoa(le),ke=Liferay.ThemeDisplay.getUserId(),Ee=Liferay.ThemeDisplay.getSiteGroupId(),Ie=`${Q}?propsData=${Se}&userId=${ke}&siteId=${Ee}`,{data:He}=await Go.get(Ie);let Ye=[];if(console.debug("Support Details :: getSupportUserList :: ",He),(G=He==null?void 0:He.facets[0])!=null&&G.facetValues){const lt=He.facets[0].facetValues.filter(Pt=>Pt.term!=="0").map(Pt=>Pt.term);Ye=await L(e,lt,ke)}if(console.debug("getSupportUserList :: roles :: ",Ye),(q=He==null?void 0:He.items)!=null&&q.length){const lt=He.items.map(Pt=>{var Ot;const At=Pt[fe]||{};return{roleName:((Ot=Ye.find(Ae=>Ae.id==(Pt==null?void 0:Pt.roleId)))==null?void 0:Ot.roleName)||"",firstName:At.firstName||"N/A",lastName:At.lastName||"",email:At.emailId||"N/A",mobile:At.mobileNo?`(+91) ${At.mobileNo}`:"N/A",designation:At.designation||"N/A"}});E(lt)}else E([])}catch(Q){console.error("Error fetching support user list:",Q),E([])}finally{i(!1)}})()},[e,n,s]);const L=async(F,G,q)=>{if(!(F!=null&&F.roleData))return[];const{roleData:Q}=F,{restBuilderApiURL:te,propsData:he}=Q;if(!te||!he)return console.error("Invalid role config data"),[];let fe=[],le=F==null?void 0:F.roleData,Se=le==null?void 0:le.restBuilderApiURL,ke=le.propsData;if(!le||!Se||!ke)return console.error("Invalid role config data"),[];for(const Ee of G)try{let Ie=JSON.stringify(he).split("{roleId}").join(Ee),He=btoa(Ie);const Ye=Liferay.ThemeDisplay.getSiteGroupId(),lt=`${te}?propsData=${He}&userId=${q}&siteId=${Ye}`,{data:Pt}=await Go.get(lt);Pt&&(Pt!=null&&Pt.id)&&fe.push({roleName:Pt.name,id:Ee})}catch(Ie){console.error("Error fetching role data:",Ie)}return fe};return n?B.createElement(B.Fragment,null,d=="order"?B.createElement("div",{className:`constl-team-card ${t||""}`},B.createElement("div",{className:"row loader_wrap"},f&&B.createElement("div",{className:"loader"}," "),!f&&[...Array.isArray(a)?a:a?[a]:[],...S||[]].map((F,G,q)=>{const Q=G<(Array.isArray(a)?a.length:a?1:0);return B.createElement("div",{className:"col-md-6 col-sm-6",key:G},B.createElement("div",{className:"team-card contacts-card"},B.createElement("h4",{className:"team-department"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"badge"),Q?"Customer Billing SPOC":(F==null?void 0:F.role)||(F==null?void 0:F.roleName)||"N/A"),B.createElement("div",{className:"team-detail"},B.createElement("div",{className:"team-profile"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"manage_accounts")),B.createElement("div",{className:"team-profile-detail"},B.createElement("div",{className:"name"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"person"),(F==null?void 0:F.name)||`${(F==null?void 0:F.firstName)||"N/A"} ${(F==null?void 0:F.lastName)||""}`),B.createElement("div",{className:"email"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"mail"),B.createElement("a",{href:`mailto:${(F==null?void 0:F.email)||""}`,title:"Email"},(F==null?void 0:F.email)||"N/A")),B.createElement("div",{className:"contact"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"call"),B.createElement("a",{href:`tel:${(F==null?void 0:F.phone)||""}`,title:"Call"},(F==null?void 0:F.phone)||(F==null?void 0:F.mobile)||"N/A"))))))}))):B.createElement("div",{className:`constl-team-card ${t||""}`},B.createElement("div",{className:"row loader_wrap"},f&&B.createElement("div",{className:"loader"}," "),!f&&S&&S.map((F,G)=>B.createElement("div",{className:"col-md-6 col-sm-12",key:G},B.createElement("div",{className:"team-card"},B.createElement("h4",{className:"team-department"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"badge"),(F==null?void 0:F.role)||(F==null?void 0:F.roleName)||"N/A"),B.createElement("div",{className:"team-detail"},B.createElement("div",{className:"team-profile"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"person")),B.createElement("div",{className:"team-profile-detail"},B.createElement("div",{className:"name"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"person"),(F==null?void 0:F.name)||`${(F==null?void 0:F.firstName)||"N/A"} ${(F==null?void 0:F.lastName)||""}`),B.createElement("div",{className:"email"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"mail"),B.createElement("a",{href:`mailto:${(F==null?void 0:F.email)||""}`,title:"Email"},(F==null?void 0:F.email)||"N/A")),B.createElement("div",{className:"contact"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"call"),B.createElement("a",{href:`tel:${(F==null?void 0:F.phone)||""}`,title:"Call"},(F==null?void 0:F.phone)||(F==null?void 0:F.mobile)||"N/A"))))))),!f&&S&&S.length===0&&B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"alert alert-info",role:"alert"},"No support users available."))))):B.createElement("div",{className:`constl-team-card ${t||""}`},B.createElement("div",{className:"title"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"groups_3"),"Constl Team"),B.createElement("div",{className:"alert alert-warning mt-3"},"You don't have the required permissions to view support member(s)."))},eoe=({supportDetail:e,supportId:t})=>{const[n,s]=It(null),[a,d]=It(!0),[f,i]=It(!1),[S,E]=It([]),[L,F]=It(!0),[G,q]=It(!0);return Ar(()=>{(async()=>{try{const te=Number(Liferay.ThemeDisplay.getUserId()),he=await dN(te,"CX Krypton Permission","com.constl.krypton.rbac.Support","ViewRcaDocument"),fe=await dN(te,"CX Krypton Permission","com.constl.krypton.rbac.Support","DownloadRcaDocument");F(he==null?void 0:he.data),q(fe==null?void 0:fe.data)}catch(te){console.error("Error checking permission:",te)}})()},[]),Ar(()=>{let Q=!0;return L&&(async()=>{var he;if(!(!e||!((he=e==null?void 0:e.rca)!=null&&he.length))){d(!0);try{if(!Q)return;console.debug("rca",e.rca);const fe=await Promise.all(e.rca.map(async le=>{var Se,ke;try{if(le&&(le!=null&&le.attachmentFileHref)){const Ee=await jse(le==null?void 0:le.attachmentFileHref);console.debug("fileInfoResp",Ee),(Ee==null?void 0:Ee.statusCode)==="500"&&console.error("Error fetching attachment:",Ee==null?void 0:Ee.error);let Ie=((ke=(Se=Ee==null?void 0:Ee.data)==null?void 0:Se.documents)==null?void 0:ke[0])||{};return{rcaDescription:le==null?void 0:le.description,rcaDate:le==null?void 0:le.dateTime,base64String:Ie.base64String||"",fileSize:Ie.fileSize||"",fileName:Ie.fileName||"",fileType:Ie.fileType||""}}else return{rcaDescription:le==null?void 0:le.description,rcaDate:le==null?void 0:le.dateTime,base64String:"",fileSize:"",fileName:"",fileType:""}}catch(Ee){return console.error("Error in fetching document for item:",le,Ee),{rcaDescription:le==null?void 0:le.description,rcaDate:le==null?void 0:le.dateTime,base64String:"",fileSize:"",fileName:"",fileType:""}}}));fe&&fe.length>0&&s(fe)}catch{Q&&i("Failed to fetch documents.")}finally{Q&&d(!1)}}})(),()=>{Q=!1}},[e,t,L]),Ar(()=>{if(!n||n.length===0)return;d(!0);const Q=n.map(te=>{if(te!=null&&te.base64String){const he=te==null?void 0:te.fileName.replace(/\.[^/.]+$/,""),fe=te==null?void 0:te.fileName.split(".").pop().toLowerCase();let le;switch(fe){case"pdf":le=qse(te==null?void 0:te.base64String);break;case"xls":case"csv":case"xlsx":le=Yse(te==null?void 0:te.base64String);break;case"png":case"jpg":case"jpeg":le=Xse(te==null?void 0:te.base64String,fe);break;case"docx":le=Zse(te==null?void 0:te.base64String);break;default:le=Kse(te==null?void 0:te.base64String,te==null?void 0:te.fileType)}return{url:le,fileName:he,rcaDescription:te==null?void 0:te.rcaDescription,fileSize:te==null?void 0:te.fileSize,rcaDate:te==null?void 0:te.rcaDate}}else return{rcaDescription:te==null?void 0:te.rcaDescription,rcaDate:te==null?void 0:te.rcaDate,url:"",fileName:"",fileSize:""}});console.debug("setDocUrls :: urls",Q),E(Q),d(!1)},[n]),B.createElement(B.Fragment,null,a?B.createElement("div",{className:"loader_wrap"},B.createElement("div",{className:"loader"})):L?(S==null?void 0:S.length)==0?B.createElement("div",{class:"alert alert-info",role:"alert"},"No RCA data available."):f?B.createElement("div",{className:"alert alert-danger"},f):S&&(S==null?void 0:S.length)>0?B.createElement("div",{className:"tabular-content-container"},B.createElement("div",{className:"table-main-body"},B.createElement("div",{className:"table-container"},B.createElement("table",{id:"example",className:"table dataTable",style:{width:"100%"}},B.createElement("thead",null,B.createElement("tr",null,B.createElement("th",null,"RCA Description"),B.createElement("th",null,"RCA Date"),G&&B.createElement("th",null,"Attachments"))),B.createElement("tbody",null,S.map(Q=>B.createElement("tr",null,B.createElement("td",null,B.createElement("div",{className:"value",dangerouslySetInnerHTML:{__html:(Q==null?void 0:Q.rcaDescription)||""}})),B.createElement("td",null," ",fa().formatDateTime(Q==null?void 0:Q.rcaDate)),G&&(Q!=null&&Q.url)?B.createElement("td",null,B.createElement("a",{href:Q==null?void 0:Q.url,download:Q==null?void 0:Q.fileName,className:"docs_type",title:"Download"},B.createElement("div",{class:"name"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"docs")),(Q==null?void 0:Q.fileSize)&&B.createElement("div",{className:"size"},Q==null?void 0:Q.fileSize))):B.createElement("td",null,"-")))))))):B.createElement("div",{class:"alert alert-info",role:"alert"},"Something went wrong..."):B.createElement("div",{className:"alert alert-warning mt-3"},"You don't have permission to view RCA information."))},d$=({serviceId:e,customerAccountNo:t,escalationMatrixConfig:n,escalationMatrixLevelConfig:s,escalationMatrixSegmentConfig:a,hasPermission:d,extraClass:f,ticketEscalationMatrixConfig:i,contactsConfig:S,customerConfig:E})=>{const[L,F]=It(!0);It([]),It([]),It("");const[G,q]=It("");It("");const[Q,te]=It(null),[he,fe]=It([]);console.log("customer config::",E),Ar(()=>{(async Ee=>{var Ie,He,Ye,lt,Pt,At,ht,Ot,Ae;console.debug("[fetchCustomer] Start  customerAccountNo:",Ee);try{if(!E||!E.entityData)return console.warn("[fetchCustomer] Missing config  exiting early"),{};const{restBuilderApiURL:mt,propsData:bt}=E.entityData;console.log("[fetchCustomer] Base URL:",mt);const Dt=JSON.parse(JSON.stringify(bt));(Ie=Dt==null?void 0:Dt.filters)!=null&&Ie.fields&&Dt.filters.fields.forEach(ur=>{ur.key==="customerAccountNo"&&(console.log("[fetchCustomer] Setting filter for customerAccountNo"),ur.value=`'${Ee}'`)});const Je=btoa(JSON.stringify(Dt)),dt=Liferay.ThemeDisplay.getSiteGroupId(),ui=Number(Liferay.ThemeDisplay.getUserId()),Vt=`${mt}?propsData=${Je}&userId=${ui}&siteId=${dt}`;console.log("[fetchCustomer] Final constructed URL:",Vt);const ei=await Go.get(Vt);console.log("[fetchCustomer] Response received:",(lt=(Ye=(He=ei==null?void 0:ei.data)==null?void 0:He.items)==null?void 0:Ye[0])==null?void 0:lt.r_customerCategoryMasterId_c_cstlcustomercategorymasterId),te((ht=(At=(Pt=ei==null?void 0:ei.data)==null?void 0:Pt.items)==null?void 0:At[0])==null?void 0:ht.r_customerCategoryMasterId_c_cstlcustomercategorymasterId),((Ae=(Ot=ei==null?void 0:ei.data)==null?void 0:Ot.items)==null?void 0:Ae.length)>0?console.log("[fetchCustomer] Customer data found, items count:",ei.data.items.length):console.warn("[fetchCustomer] No customer data found")}catch(mt){console.error("[fetchCustomer] Error fetching customer details:",mt)}return console.log("[fetchCustomer] End"),{}})(t)},[E,t]),Ar(()=>{console.log("customerCategoryId changed::",Q)},[Q]),Ar(()=>{const ke=Ye=>new URLSearchParams(window.location.search).get(Ye);console.debug("customerAccountNo --------- ",t),console.debug("serviceId --------- ",e),console.debug("escalationMatrixConfig --------- ",n),console.debug("ticketEscalationMatrixConfig --------- ",i);const Ee=ke("productName");let Ie=e?e.includes("PLC")?"Private Line":"Dark Fiber":null;console.debug("product from ticket ",Ie),(async()=>{var Ye,lt;console.debug(" fetchEscalationData() called"),F(!0);try{if(console.debug("customerAccountNo --------- ",t),console.debug("serviceId --------- ",e),console.debug("customerCategoryId --------- ",Q),console.debug("product------ ",Ee),!t||!e||!Q)return;const Pt="/o/krypton-escalation-matrix-api/v1.0/get-priority-escalation-matrix",At=new URLSearchParams({customerCategory:Q,customerAccountNumber:t,serviceId:e,product:Ee||Ie}),ht=`${Pt}?${At.toString()}`;console.debug("Fetching Escalation Matrix from:",ht);const Ot=await Go.get(ht,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.debug("Raw API Response:",Ot);let Ae=[];Array.isArray(Ot.data)?Ae=Ot.data:Array.isArray((Ye=Ot.data)==null?void 0:Ye.data)?Ae=Ot.data.data:Array.isArray((lt=Ot==null?void 0:Ot.data)==null?void 0:lt.items)&&(Ae=Ot.data.items),console.debug(`Escalation Matrix count: ${Ae.length}`,Ae),fe(Ae),F(!1),console.log("escalationData::",Ae)}catch(Pt){console.error("Error fetching escalation data:",Pt),fe([]),F(!1)}})()},[Q,e,t]),Ar(()=>{if(!t||!e||!Q){const ke=setTimeout(()=>{(!t||!e||!Q)&&F(!1)},3e3);return()=>clearTimeout(ke)}},[t,e,Q]);const le=ke=>{if(ke!=null&&ke.r_escalationLevelEmployeeUserId_user){const Ee=ke.r_escalationLevelEmployeeUserId_user,Ie=(He,Ye)=>{var lt,Pt;return((Pt=(lt=He==null?void 0:He.find(At=>At.name===Ye))==null?void 0:lt.customValue)==null?void 0:Pt.data)||"-"};return{name:(Ee==null?void 0:Ee.name)||"-",email:(Ee==null?void 0:Ee.emailAddress)||"-",deskContact:Ie(Ee==null?void 0:Ee.customFields,"Desk Contact"),personalContact:Ie(Ee==null?void 0:Ee.customFields,"Contact Number"),customerFacingRole:Ie(Ee==null?void 0:Ee.customFields,"Customer Facing Role")}}if(ke!=null&&ke.r_escalationLevelContactId_c_cstlcontacts){const Ee=ke.r_escalationLevelContactId_c_cstlcontacts;return{name:(Ee==null?void 0:Ee.firstName)+" "+(Ee==null?void 0:Ee.lastName)||"-",email:(Ee==null?void 0:Ee.emailId)||"-",deskContact:(ke==null?void 0:ke.contactDeskContact)||"-",personalContact:(Ee==null?void 0:Ee.mobileNo)||"-",customerFacingRole:(Ee==null?void 0:Ee.customerFacingRole)||"-"}}return{name:"-",email:"-",deskContact:"-",personalContact:"-",role:"-"}};if(!d)return B.createElement("div",{className:"alert alert-warning mt-3"}," You don't have the required permissions to view escalation matrix data.");const Se=async(ke,Ee)=>{var Ie,He;try{if(!Ee||Ee.length===0){showErrorMessage();return}if(console.log("escalationMatrixLevelConfig::",s),!s){console.log("not found config");return}const Ye=ke==="pdf"?s.entityData.exportPDFDataConfig:s.entityData.exportExcelData;if(!Ye){console.log("not found config");return}const{restBuilderApiURL:lt}=Ye,Pt=new Date,ht=`EscalationMatrix_${`${Pt.getFullYear()}-${String(Pt.getMonth()+1).padStart(2,"0")}-${String(Pt.getDate()).padStart(2,"0")}`}`,Ot="Escalation Matrix",Ae=["Level Name","Employee Name","Customer Facing Role","Duration","Desk Contact","Personal Contact","Email"],mt=["levelName","employeeName","customerFacingRole","duration","deskContact","personalContact","email"],bt=Ee.flatMap(Kt=>(Kt.escalationMatrixSegmentId||[]).map(Ui=>{var gi;const rr=le(Ui);return{segmentName:Kt.name,levelName:Ui.level,employeeName:rr.name,customerFacingRole:rr.customerFacingRole,duration:((gi=Ui==null?void 0:Ui.r_escalationLevelDurationId_c_cstlescalationdurationmaster)==null?void 0:gi.duration)||"",deskContact:rr.deskContact,personalContact:rr.personalContact,email:rr.email}})),Dt={title:Ot,fileHeaderList:Ae,keys:mt,data:bt,isMultipleTable:!0},Je=await Go.post(lt,Dt);if(!((Ie=Je==null?void 0:Je.data)!=null&&Ie.data))return;const dt=ke==="pdf"?Je.data.data.pdfByteArray:Je.data.data.excelByteArray;if(!dt){q(((He=Je.data)==null?void 0:He.errorMessage)||"Export failed");return}const ui=atob(dt),Vt=new Array(ui.length);for(let Kt=0;Kt<ui.length;Kt++)Vt[Kt]=ui.charCodeAt(Kt);const ei=new Uint8Array(Vt),ur=new Blob([ei],{type:ke==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Zt=document.createElement("a");Zt.href=URL.createObjectURL(ur),Zt.download=ht+".pdf",Zt.click(),URL.revokeObjectURL(Zt.href)}catch(Ye){console.error("Error exporting escalation matrix:",Ye)}};return B.createElement(B.Fragment,null,L&&B.createElement("div",{className:"tabular-content-container loader_wrap"},B.createElement("div",{className:"loader"}," ")),!L&&he&&he.length>0&&B.createElement("div",{className:"tabular-content-container loader_wrap"},B.createElement("div",{className:`escalation-matrixcard ${f}`},B.createElement("button",{className:"button button-icon download-escalation-button",onClick:()=>Se("pdf",he)},B.createElement("span",{class:"material-symbols-outlined"},"download")),B.createElement("div",{className:"row"},he.map(ke=>{var Ee;return B.createElement("div",{className:"col-md-6",key:ke==null?void 0:ke.id},B.createElement("div",{className:"escalation-matrix-wrap"},B.createElement("div",{className:"tabular-content-title mb-2"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"list_alt")," ",(ke==null?void 0:ke.name)||""),B.createElement("div",{className:"row"},(Ee=ke==null?void 0:ke.escalationMatrixSegmentId)==null?void 0:Ee.map((Ie,He)=>{var lt;const Ye=le(Ie);return B.createElement("div",{className:"col-12",key:He},B.createElement("div",{className:"escalation-card"},B.createElement("div",{className:"level-status"},Ie==null?void 0:Ie.level),B.createElement("div",{className:"escalation-card-details"},B.createElement("div",{className:"designation-title"},Ye.customerFacingRole,B.createElement("span",null,"(Duration: ",((lt=Ie==null?void 0:Ie.r_escalationLevelDurationId_c_cstlescalationdurationmaster)==null?void 0:lt.duration)||"-",")")),B.createElement("div",{className:"designation-profile"},B.createElement("div",null,Ye.name),B.createElement("div",null,B.createElement("span",null,"Desk Contact: "),Ye.deskContact!=="-"?B.createElement("a",{href:`tel:${Ye.deskContact}`},Ye.deskContact):"-"),B.createElement("div",null,B.createElement("span",null,"Contact: "),Ye.personalContact!=="-"?B.createElement("a",{href:`tel:${Ye.personalContact}`},Ye.personalContact):"-"),B.createElement("div",null,Ye.email!=="-"?B.createElement("a",{href:`mailto:${Ye.email}`},Ye.email):"-")))))}))))})))),!L&&he.length===0&&B.createElement("div",{className:"alert alert-info",role:"alert"},"Escalation Matrix data not available."))},toe=({totalStars:e=5,initialRating:t,onRatingChange:n,readOnly:s})=>{console.debug("StarRating component rendered with totalStars:",e,"initialRating:",t,"readOnly:",s);const[a,d]=It(0),[f,i]=It(0),S=E=>{s||(f===E?(i(0),d(0),n==null||n(0)):(i(E),d(0),n==null||n(E)))};return Ar(()=>{i(t??0)},[t]),B.createElement("div",{style:{display:"flex",gap:8}},[...Array(e)].map((E,L)=>{const F=L+1,G=(a||f)>=F;return B.createElement("span",{class:"material-symbols-outlined",style:{cursor:s?"default":"pointer",color:G?"#FFD700":"#ccc",transition:"color 0.2s ease",fontSize:"40px"},onMouseEnter:()=>!s&&d(F),onMouseLeave:()=>!s&&d(0),onClick:()=>S(F)},G?"star_shine":"star")}),s&&B.createElement("span",{className:"mt-1"},f," star",f===1?"":"s"))},ioe=({ticketId:e,serviceId:t,rating:n,description:s,setRating:a,setDescription:d,feedbackValidationError:f,feedbackTicketData:i})=>{const[S,E]=It(!1),[L,F]=It(0),[G,q]=It(""),Q=fe=>{console.debug("Selected Rating:",fe),a(fe)},te=fe=>{const le=fe.target.value;le.length<=3e3&&d(le)},he=async(fe,le)=>{var Ee,Ie,He,Ye,lt,Pt,At,ht,Ot,Ae,mt,bt,Dt,Je;const Se=`/o/krypton-common-api/v1.0/get-feedback?ratingsId=${fe}&commentId=${le}`,ke=await ZH(Se);console.debug("Feedback Response:",ke),((He=(Ie=(Ee=ke==null?void 0:ke.data)==null?void 0:Ee.data)==null?void 0:Ie.response)==null?void 0:He.status)=="Found"?(F((At=(Pt=(lt=(Ye=ke==null?void 0:ke.data)==null?void 0:Ye.data)==null?void 0:lt.response)==null?void 0:Pt.data)==null?void 0:At.score),q((mt=(Ae=(Ot=(ht=ke==null?void 0:ke.data)==null?void 0:ht.data)==null?void 0:Ot.response)==null?void 0:Ae.data)==null?void 0:mt.comment)):console.error("Feedback data not found :: ",(Je=(Dt=(bt=ke==null?void 0:ke.data)==null?void 0:bt.data)==null?void 0:Dt.response)==null?void 0:Je.message)};return Ar(()=>{let fe=0,le=0;if(i)if(console.debug("Feedback Ticket Data:",i),Array.isArray(i)&&i.length>0){const Se=i[0];fe=Se==null?void 0:Se.ratingsId,le=Se==null?void 0:Se.commentId,E(!0)}else console.debug("No feedback data found."),E(!1);fe>0&&he(fe,le)},[i]),B.createElement("div",{className:"row"},B.createElement("div",{className:"col-md-6 mb-25"},B.createElement("div",{className:"form-group"},B.createElement("label",{for:"serviceId"},"Service ID"),B.createElement("input",{type:"text",className:"form-control disabled",id:"serviceId",value:t,placeholder:"Enter Service ID"}))),B.createElement("div",{className:"col-md-6 mb-25"},B.createElement("div",{className:"form-group"},B.createElement("label",{for:"ticketId"},"Ticket ID"),B.createElement("input",{type:"text",className:"form-control disabled",id:"ticketId",value:e,placeholder:"Enter Ticket ID"}))),B.createElement("div",{className:"col-md-12 mb-25"},B.createElement("div",{className:"form-group"},B.createElement("label",{for:"ServiceID"},"How satisfied are you with our response?",B.createElement("span",null,"*")),B.createElement(toe,{initialRating:S?L:n,onRatingChange:Q,readOnly:S}),f.rating&&B.createElement("small",{className:"text-danger"},f.rating))),B.createElement("div",{className:"col-md-12 mb-25"},B.createElement("div",{className:"form-group textarea"},B.createElement("label",{for:"description"},"Description"),S?B.createElement("textarea",{id:"description",rows:"5",className:"form-control",value:G,readOnly:!0}):B.createElement("textarea",{id:"description",rows:"5",className:"form-control",placeholder:"Please share your experience with our support service...",value:s,onChange:te}),!S&&B.createElement("div",{className:"text-counter"},s.length,"/3000"),f.description&&B.createElement("small",{className:"text-danger"},f.description))))},roe=async(e,t,n,s)=>{var f,i,S,E;const d=await sG("/o/krypton-common-api/v1.0/feedback",e);return console.debug("addFeedback response:",d),((E=(S=(i=(f=d==null?void 0:d.data)==null?void 0:f.data)==null?void 0:i.data)==null?void 0:S.response)==null?void 0:E.status)=="Created"?($B(n,Liferay.ThemeDisplay.getUserId(),Liferay.ThemeDisplay.getSiteGroupId(),Liferay.ThemeDisplay.getCompanyId()),s(!1),!0):(console.error("Error adding feedback:",d==null?void 0:d.error),t(!0),s(!1),!1)},noe=(e,t,n,s,a,d,f)=>{d(!0);let i=!1;console.debug("addFeedback called with externalReferenceId:",e);const S={entityTypeId:t,externalReferenceId:e,portalCompanyId:Number(Liferay.ThemeDisplay.getCompanyId()),portalSiteId:Number(Liferay.ThemeDisplay.getSiteGroupId()),portalUserId:Number(Liferay.ThemeDisplay.getUserId()),comment:s,rating:n};return console.debug("feedbackPayload:",S),i=roe(S,a,f,d),i},p$=e=>{if(Array.isArray(e)){Number(Liferay.ThemeDisplay.getUserId());const t=Number(Liferay.ThemeDisplay.getSiteGroupId()),n=e.find(s=>s.ratingsId>0&&s.portalSiteId===t);return n?n.id:0}},soe=({supportDetail:e,supportId:t,externalRefId:n,escalationMasterWidgetsConfig:s,constlSupportTeamWidgetsConfig:a,viewDetailStatusValue:d,supportDetailsObjKeysWidgetsConfig:f,customerAccountNo:i,relatedTicketWidgetConfig:S,feedbackTicketId:E,feedbackServiceId:L,rating:F,description:G,setRating:q,setDescription:Q,feedbackValidationError:te,handleFeedbackSubmit:he,feedbackLoader:fe,feedbackTicketData:le,isTicketCreator:Se,ticketCreatedBy:ke,detailPermissions:Ee,clubStatusesMap:Ie,rootElement:He})=>{var Oi,cr;const[Ye,lt]=It("Attachments"),[Pt,At]=It({}),[ht,Ot]=It({}),[Ae,mt]=It({}),[bt,Dt]=It({}),[Je,dt]=It(!1),[ui,Vt]=It(!1),[ei,ur]=It({}),Zt=Number(Liferay.ThemeDisplay.getUserId());Ar(()=>{let ji=Number(Liferay.ThemeDisplay.getRealUserId());Zt!=ji&&Vt(!0)},[]),(ji=>new URLSearchParams(window.location.search).get(ji))("id");const Ui=f==null?void 0:f.rcaShowStates,rr=[{title:"Attachments",icon:"attach_file"},{title:`${Liferay.Language.get("krypton-service-detail-related-tickets-tab")}`,icon:"shoppingmode"},{title:"RCA",icon:"docs"},{title:"Escalation-Matrix",icon:"contact_mail"},{title:"Customer-Touchpoint",icon:"groups_2"},(d==="Closed"||d==="Close")&&(Se(ke)||Je)?{title:"Share-Feedback",icon:"share_reviews"}:null].filter(Boolean),gi=()=>{Liferay.on("allPortletsReady",function(){let ji=document.getElementsByTagName(`${He||"krypton-support-master-cx"}`);if(ji&&ji.length>0){let nn=ji[0].getAttribute("data-escmatrixconfig");if(nn!=null&&nn!=null){let Lt=atob(nn);At(JSON.parse(Lt))}let pr=ji[0].getAttribute("data-escmatrixSegmentconfig");if(pr!=null&&pr!=null){let Lt=atob(pr);Ot(JSON.parse(Lt))}let Ue=ji[0].getAttribute("data-fetchCustomer");if(Ue){let Lt=atob(Ue);ur(JSON.parse(Lt))}let ni=ji[0].getAttribute("data-escmatrixLevelconfig");if(ni!=null&&ni!=null){let Lt=atob(ni);mt(JSON.parse(Lt))}let fi=ji[0].getAttribute("data-fetchContacts");if(fi){let Lt=atob(fi);Dt(JSON.parse(Lt))}}})};return Ar(()=>{gi()},[]),Ar(()=>{i&&!Je&&(async()=>{const nn=await KH(Zt,i);console.debug("checkIsUserCustomerAdmin customerAccountNo :: ",i," isAdmin :: ",nn),nn&&dt(!0)})()},[i]),e==null?B.createElement("div",{className:"alert alert-info",role:"alert"}," ","No data available."):B.createElement(B.Fragment,null,B.createElement("div",{className:"card service-detail-card"},B.createElement("div",{className:"card-title"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"book_5")," ","More Information"),B.createElement("div",{className:"card-body"},B.createElement("div",{className:"tabular-tab"},B.createElement("ul",{className:"tabular-tab-nav"},rr.map(ji=>ji.title==="RCA"&&(e==null?void 0:e.serviceType)==="Dark Fiber"?null:ji.title=="RCA"?Ui!=null&&Ui.includes(typeof(e==null?void 0:e.status)=="string"?e.status.toLowerCase():"")?B.createElement("li",{key:ji.title,className:"tabular-item"},B.createElement("a",{href:"javascript:void(0)",className:Ye===ji.title?"active":"",onClick:()=>lt(ji.title)},B.createElement("span",{class:"material-symbols-outlined constl-icon"},ji.icon),ji.title.replace(/-/g," "))):B.createElement("li",{key:ji.title,className:"tabular-item disable-event"},B.createElement("a",{href:"javascript:void(0)",className:"disabled"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},ji.icon),ji.title.replace(/-/g," "))):B.createElement("li",{key:ji.title,className:"tabular-item"},B.createElement("a",{href:"javascript:void(0)",className:Ye===ji.title?"active":"",onClick:()=>lt(ji.title)},B.createElement("span",{class:"material-symbols-outlined constl-icon"},ji.icon),ji.title.replace(/-/g," ")))))),B.createElement("div",{className:"tabular-content"},Ye==="Attachments"&&B.createElement("div",{id:"Attachments",className:"tabular-item-content active"},B.createElement(Qse,{supportDetail:e,supportId:t,detailPermissions:Ee})),Ye===`${Liferay.Language.get("krypton-service-detail-related-tickets-tab")}`&&B.createElement("div",{id:Liferay.Language.get("krypton-service-detail-related-tickets-tab"),className:"tabular-item-content active"},B.createElement(Jse,{supportId:t,externalRefId:n,relatedTicketWidgetConfig:S,clubStatusesMap:Ie})),Ye==="RCA"&&B.createElement("div",{id:"RCA",className:"tabular-item-content active"},B.createElement(eoe,{supportDetail:e,supportId:t})),Ye==="Escalation-Matrix"&&B.createElement("div",{id:"Escalation-Matrix",className:"tabular-item-content active"},B.createElement(d$,{customerAccountNo:i,serviceId:e==null?void 0:e.serviceId,ticketEscalationMatrixConfig:Pt,escalationMatrixLevelConfig:Ae,escalationMatrixSegmentConfig:ht,hasPermission:(Oi=Ee==null?void 0:Ee.viewTicketDetailMatrix)==null?void 0:Oi.hasPermission,contactsConfig:bt,customerConfig:ei})),Ye==="Customer-Touchpoint"&&B.createElement("div",{id:"Customer-Touchpoint",className:"tabular-item-content active"},B.createElement(u$,{supportId:t,externalRefId:n,constlSupportTeamWidgetsConfig:a,hasPermission:(cr=Ee==null?void 0:Ee.viewTicketDetailConstlTeam)==null?void 0:cr.hasPermission,externalReferenceId:i})),Ye==="Share-Feedback"&&(d==="Closed"||d==="Close")&&(Se(ke)||Je)&&B.createElement("div",{className:"shareFeedback-card"},B.createElement("div",{className:"shareFeedback-card-body shareFeedback-form loader_wrap"},fe?B.createElement("div",{className:"loader"}):B.createElement(ioe,{ticketId:E,serviceId:L,rating:F,description:G,setRating:q,setDescription:Q,feedbackValidationError:te,feedbackTicketData:le})),p$(le)?"":B.createElement("div",{className:"shareFeedback-card-footer"},B.createElement("button",{className:`button button-primary ${ui?"disabled":""}`,title:"Submit Feedback",onClick:ji=>{!ui&&he(ji,!0)},disabled:ui},"Submit Feedback")))))))},ooe=({supportRFO:e})=>(console.debug("supportRFO ::: ",e),e==null?B.createElement("div",{className:"alert alert-info",role:"alert"}," No data available for RFO."):B.createElement("div",{className:"card RFO-details ticket-detail-card"},B.createElement("div",{className:"card-body"},B.createElement("h4",{className:"RFO-title mb-15"},"Reason for Outage (RFO) Details"),e.map(t=>B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"RFO-form-group-view"},B.createElement("div",{className:"RFO-label"},"RFO Date"),B.createElement("div",{className:"RFO-value"},fa().formatDateTime((t==null?void 0:t.date)||"-")))),B.createElement("div",{className:"col-12"},B.createElement("div",{className:"RFO-form-group-view"},B.createElement("div",{className:"RFO-label"},"RFO Description"),B.createElement("div",{className:"RFO-value",dangerouslySetInnerHTML:{__html:(t==null?void 0:t.description)||"-"}})))))))),aoe=()=>({getETRTime:t=>{console.debug("data",t);let n="00:00",s=0,a=0,d=0,f=0,i=0,S=!1;if(t!=null&&t.etr){const L=new Date,F=new Date(t.etr),G=new Date((t==null?void 0:t.createdDate)||(t==null?void 0:t.ticketCreatedDate));S=L>F;const q=Math.abs(F-L);s=Math.floor(q/36e5),a=Math.floor(q%36e5/6e4),n=`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`,f=Math.max(Math.floor((F-G)/6e4),1),d=Math.max(Math.floor((L-G)/6e4),0),i=Math.min(d/f*100,100)}return{assignedTo:t==null?void 0:t.assignedTo,etrTime:n??"N/A",hours:s,minutes:a,elapsedMinutes:d,label:S?"Resolution Overdue":"Estimated Time to Resolve",overdueClass:S?"overdue":"ontrack",totalDuration:f,progressPercent:i,isOverdue:S}}}),loe=({id:e,handleSideBar:t,externalRefId:n,escalationMasterWidgetsConfig:s,constlSupportTeamWidgetsConfig:a,viewDetailStatusValue:d,supportDetailsObjKeysWidgetsConfig:f,relatedTicketWidgetConfig:i,feedbackTicketId:S,feedbackServiceId:E,rating:L,description:F,setRating:G,setDescription:q,feedbackValidationError:Q,handleFeedbackSubmit:te,feedbackLoader:he,feedbackTicketData:fe,isTicketCreator:le,ticketCreatedBy:Se,clubStatusesMap:ke,rootElement:Ee,breadCrumbLable:Ie})=>{var rr,gi;const[He,Ye]=It(null),[lt,Pt]=It(null),[At,ht]=It(null),[Ot,Ae]=It(""),[mt,bt]=It(!1),[Dt,Je]=It(!0),[dt,ui]=It(!1),[Vt,ei]=It(!1),[ur,Zt]=It({viewTicketDetails:{key:"ViewTicketDetails",hasPermission:!0},viewCreateTicketEtr:{key:"ViewCreateTicketEtr",hasPermission:!0},viewCreateTicketOverview:{key:"ViewCreateTicketOverview",hasPermission:!0},viewTicketDetailRFO:{key:"ViewTicketDetailRFO",hasPermission:!0},viewTicketDetailConstlTeam:{key:"ViewTicketDetailConstlTeam",hasPermission:!0},viewTicketDetailMatrix:{key:"ViewTicketDetailMatrix",hasPermission:!0},viewTicketDetailAttachments:{key:"ViewTicketDetailAttachments",hasPermission:!0},previewTicketDetailAttachments:{key:"PreviewTicketDetailAttachments",hasPermission:!0},downloadTicketDetailAttachments:{key:"DownloadTicketDetailAttachments",hasPermission:!0}});console.debug("Support Details component supportId ----------- ",e);const Kt=Liferay.Language.get("krypton-open-ticket-etr-widget-label");console.log("clubStatusesFromSuportDetails",ke),Ar(()=>{const Oi=async()=>{var ji,nn,pr,Ue,ni,fi,Lt,pt;console.debug("fetchSupportDetails supportId",e),Je(!0);const cr=await Gse(e);if((cr==null?void 0:cr.statusCode)=="500")bt((cr==null?void 0:cr.error)||"Failed to retrieve support detail data"),ui(!0),Ye(null),Pt(null),ht(null),Je(!1);else if(ui(!1),Je(!1),cr&&(cr!=null&&cr.data)&&((ji=cr.data)!=null&&ji.items)){Ye((nn=cr==null?void 0:cr.data)==null?void 0:nn.items);let Nt=cr.data.items;console.debug("fetchSupportDetails response data",Nt),Ae(Nt==null?void 0:Nt.customerAccountNo),Nt!=null&&Nt.rfo&&ht(Nt.rfo);const Si={assignedTo:Nt==null?void 0:Nt.assignedTo,progressPercent:0,label:"Estimated Time to Resolve",etrTime:"00:00",hours:0,minutes:0,overdueClass:"",totalDuration:0};if(((Ue=f==null?void 0:f.rfoShowStates)==null?void 0:Ue.includes((pr=Nt==null?void 0:Nt.status)==null?void 0:pr.toLowerCase()))??!0){const Mr={assignedTo:Nt==null?void 0:Nt.assignedTo,etrTime:fa().formatToHoursMinutes(Nt.ttr??"00:00:00:00"),label:"Time to Resolve",overdueClass:"ontrack",progressPercent:100,isTTR:!0};Pt(Mr);return}const St={...Si,label:"Awaited"},Ht={...Si,overdueClass:"no-etr",etrTime:"00:00",label:Kt},nr=((fi=f==null?void 0:f.etrAwaitedStates)==null?void 0:fi.includes((ni=Nt==null?void 0:Nt.status)==null?void 0:ni.toLowerCase()))??!1,tr=(pt=f==null?void 0:f.openStates)==null?void 0:pt.includes((Lt=Nt==null?void 0:Nt.status)==null?void 0:Lt.toLowerCase());if(!(Nt!=null&&Nt.etr)){Pt(tr?Ht:nr?St:Si);return}if(Nt!=null&&Nt.etr&&tr){Pt(Ht);return}const kr=aoe().getETRTime(Nt);console.debug("fetchSupportDetails data from function getETR DATA :: etrData :: ",kr),Pt(kr)}};ur.viewTicketDetails.hasPermission&&Oi()},[e,ur.viewTicketDetails]),Ar(()=>{(async()=>{const cr=Object.values(ur).map(nn=>nn.key),ji=await VB("CX Krypton Permission","com.constl.krypton.rbac.Support",cr);if(ji!=null&&ji.data){const nn=Object.fromEntries(Object.entries(ur).map(([pr,Ue])=>{const ni=Ue.key in ji.data.data?ji.data.data[Ue.key]:Ue.hasPermission;return[pr,{...Ue,hasPermission:ni}]}));Zt(nn),ei(!0)}})()},[]);const Ui=(Oi,cr)=>Oi?cr&&Object.keys(cr).find(nn=>{let pr=cr[nn];return Array.isArray(pr)?pr=pr.map(Ue=>(Ue||"").trim()):typeof pr=="string"?pr=pr.split(",").map(Ue=>(Ue||"").trim()):pr=[],pr.some(Ue=>Ue.toLowerCase()===Oi.toLowerCase())})||Oi:null;return ur.viewTicketDetails.hasPermission?B.createElement(B.Fragment,null,B.createElement("div",{id:"ticketDetails",className:"sidebar ticketDetails show"},B.createElement("button",{className:"closebtn",onClick:()=>t(!1)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"close")),B.createElement("div",{className:"sidebar-wrapper"},B.createElement("div",{className:"sidebar-header"},B.createElement("div",{className:"ticket-breadcums"},B.createElement("ul",null,B.createElement("li",null,B.createElement("a",{href:"#",title:Ie,onClick:()=>t(!0)},Ie)),B.createElement("li",null,"Ticket Detail"))),B.createElement("h2",{className:"ticketDetail-title"},"Ticket Detail",(He==null?void 0:He.status)&&B.createElement("div",{className:`ticket-status-${typeof(He==null?void 0:He.status)=="string"?(rr=Ui(He==null?void 0:He.status,ke))==null?void 0:rr.split(" ").join("").toLowerCase():""}`},Ui(He==null?void 0:He.status,ke))),B.createElement("p",null,"Comprehensive information on your support ticket, including status, priority, and escalation options.")),B.createElement("div",{className:"sidebar-content loader_wrap"},Dt&&B.createElement("div",{class:"loader"}," "),dt&&B.createElement("div",{className:"alert alert-danger mb-3 mt-3",role:"alert"},mt),!Dt&&!dt&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-lg-8 col-md-8 mb-30"},ur.viewCreateTicketOverview.hasPermission?B.createElement(Vse,{supportDetail:He,viewDetailStatusValue:d}):B.createElement("div",{className:"alert alert-warning mt-3"}," You don't have the required permissions to view overview information.")),B.createElement("div",{className:"col-lg-4 col-md-4 mb-30"},B.createElement("div",{class:"row h-100"},B.createElement("div",{class:"col-12 mb-15 h-100"},ur.viewCreateTicketEtr.hasPermission?lt&&B.createElement(Wse,{supportETR:lt}):B.createElement("div",{className:"alert alert-warning mt-3"}," You don't have the required permissions to view ETR information.")),B.createElement("div",{className:"col-12"},ur.viewTicketDetailRFO.hasPermission&&((gi=f==null?void 0:f.rfoShowStates)==null?void 0:gi.includes(typeof(He==null?void 0:He.status)=="string"?He.status.toLowerCase():""))&&At&&B.createElement(ooe,{supportRFO:At})))),B.createElement("div",{className:"col-lg-12 col-md-12 mb-30"},B.createElement(soe,{supportDetail:He,supportId:e,externalRefId:n,escalationMasterWidgetsConfig:s,constlSupportTeamWidgetsConfig:a,viewDetailStatusValue:d,supportDetailsObjKeysWidgetsConfig:f,customerAccountNo:Ot,relatedTicketWidgetConfig:i,feedbackTicketId:S,feedbackServiceId:E,rating:L,description:F,setRating:G,setDescription:q,feedbackValidationError:Q,handleFeedbackSubmit:te,feedbackLoader:he,feedbackTicketData:fe,isTicketCreator:le,ticketCreatedBy:Se,detailPermissions:ur,clubStatusesMap:ke,rootElement:Ee}))))))):B.createElement(B.Fragment,null,B.createElement("div",{id:"ticketDetails",className:"sidebar ticketDetails show"},B.createElement("button",{className:"closebtn",onClick:()=>t(!1)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"close")),B.createElement("div",{className:"sidebar-wrapper"},B.createElement("div",{className:"sidebar-header"},B.createElement("div",{className:"ticket-breadcums"},B.createElement("ul",null,B.createElement("li",null,B.createElement("a",{href:"#",title:Ie},Ie)),B.createElement("li",null,"Ticket Detail"))),B.createElement("h2",null,"Ticket Detail"),B.createElement("p",null,"Comprehensive information on your support ticket, including status, priority, and escalation options.")),Vt&&B.createElement("div",{className:"sidebar-content loader_wrap"},B.createElement("div",{className:"row"},B.createElement("div",{className:"col-lg-12 col-md-12 mb-30"},B.createElement("div",{className:"alert alert-warning mt-3"},"You don't have the required permissions to view support detail.")))))))},coe=({ticketDetails:e,loadingTickets:t,page:n,setPage:s,pageSize:a,setPageSize:d,totalRecords:f,ticketDetailEscalationConfig:i,ticketDetailSupportTeamConfig:S,ticketDetailObjKeysWidgetsConfig:E,ticketDetailRelatedTicketWidgetConfig:L,clubStatuses:F})=>{var pi;console.debug("ticketDetails --------- ",e);const G=Number(Liferay.ThemeDisplay.getUserId()),[q,Q]=It(!1),[te,he]=It(0),[fe,le]=It(0),[Se,ke]=It(""),[Ee,Ie]=It(0),[He,Ye]=It(0),[lt,Pt]=It([]),[At,ht]=It(0),[Ot,Ae]=It(""),[mt,bt]=It(!1),[Dt,Je]=It(!1),[dt,ui]=It(!1),[Vt,ei]=It(""),[ur,Zt]=It({rating:"",description:""}),[Kt,Ui]=It(0),[rr,gi]=It(!1),[Oi,cr]=It(!1),[ji,nn]=It(!1);Ar(()=>{const St=document.querySelector(".overlay"),Ht=document.body;ji?(St==null||St.classList.add("active"),Ht.classList.add("mountDailog")):(St==null||St.classList.remove("active"),Ht.classList.remove("mountDailog"))},[ji]);const pr=St=>{s(St)},Ue=St=>{d(St),s(1)};Ar(()=>{const St=document.querySelector(".overlay");return St&&(q?St.classList.add("sidebar-show"):St.classList.remove("sidebar-show")),()=>{St&&St.classList.remove("sidebar-show")}},[q]);const ni=U3(St=>{var Ht;he((St==null?void 0:St.ticketId)??0),le((St==null?void 0:St.externalRefEntityId)??0),ke((Ht=St==null?void 0:St.r_ticketStatusMasterId_c_cstlstatusmaster)==null?void 0:Ht.statusVal),Ie((St==null?void 0:St.ticketId)??0),Ye((St==null?void 0:St.externalRefEntityId)??0),Pt((St==null?void 0:St.feedbackTicketId)??[]),Ui((St==null?void 0:St.createdBy)??0),Q(!0)},[]),fi=St=>{console.debug("handleSideBar close",St),Q(!1),Zt({rating:"",description:""}),ht(0),Ae("")},Lt=(St,Ht)=>{if(console.debug("handleFeedbackSubmit called"),At===0){Zt(tr=>({...tr,rating:"Please select a rating before submitting your feedback."}));return}else Zt(tr=>({...tr,rating:""}));if(Ot.trim()!==""&&Ot.length>3e3){Zt(tr=>({...tr,description:"Feedback must be within 3000 characters."}));return}else Zt(tr=>({...tr,description:""}));St.currentTarget.disabled=!0,noe(Ee??"",L==null?void 0:L.entityTypeId,At,Ot,ui,bt,`Feedback - Feedback successfully submitted for ticket ${Ee}.`)&&(ei("Thank you for your feedback!"),fi()),Ht&&(nn(!0),Je(!1))},pt=St=>{console.debug("handleCloseFeedbackPopup called"),console.debug("handleCloseFeedbackPopup isResetList :: ",St),ei(""),Ie(0),Ye(0),ht(0),Ae(""),bt(!1),ui(!1),Zt({rating:"",description:""}),Je(St),nn(!1)},Nt=St=>Number(G)===Number(St);Ar(()=>{let St=Number(Liferay.ThemeDisplay.getRealUserId());G!=St&&gi(!0)},[]),Ar(()=>{var St,Ht;console.debug("Window: ",window),gi((St=window.validateEditRquestAccessObj)==null?void 0:St.hasImpersonated),cr((Ht=window.validateEditRquestAccessObj)==null?void 0:Ht.hasImpersonationEditAccess)},[window.validateEditRquestAccessObj]),p$(Ee)>0;const Si=(St,Ht)=>{for(const nr in Ht)if(Ht[nr].split(",").map(tr=>tr.trim()).includes(St))return nr;return St};return B.createElement("div",{id:"Related-Tickets",className:"tabular-item-content mb-25"},B.createElement("div",{className:"tabular-content-container loader_wrap"},B.createElement("div",{className:"table-main-body"},B.createElement("div",{className:"table-container"},B.createElement("table",{id:"relatedTicketsTable",className:"table dataTable",style:{width:"100%"}},B.createElement("thead",null,B.createElement("tr",null,B.createElement("th",null,"Ticket ID"),B.createElement("th",null,"Subject"),B.createElement("th",null,"Status"),B.createElement("th",null,"Date"))),B.createElement("tbody",null,t&&B.createElement("div",{className:"loader"}),e&&(e==null||e==null||e.length==0)&&B.createElement("tr",null,B.createElement("td",{class:"text-center",colspan:"100%"},"No data available.")),e&&e!=null&&e!=null&&!t&&((pi=e==null?void 0:e.data)==null?void 0:pi.items.map(St=>{var Ht,nr,tr;return B.createElement("tr",{key:St==null?void 0:St.ticketId},B.createElement("td",null,B.createElement("a",{className:"text-nowrap",href:"javascript:void",onClick:()=>ni(St),title:"View"},St.ticketId??"")),B.createElement("td",null,St==null?void 0:St.subject),B.createElement("td",null,B.createElement("span",{className:`ticket-status-${(nr=Si((Ht=St==null?void 0:St.r_ticketStatusMasterId_c_cstlstatusmaster)==null?void 0:Ht.statusVal,F))==null?void 0:nr.split(" ").join("").toLowerCase()}`},Si((tr=St==null?void 0:St.r_ticketStatusMasterId_c_cstlstatusmaster)==null?void 0:tr.statusVal,F)||"N/A")),B.createElement("td",{className:"text-nowrap"}," ",fa().formatDate(St==null?void 0:St.ticketCreatedDate)))})))))),f>10&&B.createElement("div",{className:"table-footer"},B.createElement(vD,{totalRecords:f,pageSize:a,page:n,onPageSizeChange:Ue,onPageChange:pr})),q&&M2.createPortal(B.createElement(loe,{id:te,handleSideBar:fi,externalRefId:fe,escalationMasterWidgetsConfig:i,constlSupportTeamWidgetsConfig:S,viewDetailStatusValue:Se,supportDetailsObjKeysWidgetsConfig:E,relatedTicketWidgetConfig:L,feedbackTicketId:Ee,feedbackServiceId:He,rating:At,description:Ot,setRating:ht,setDescription:Ae,feedbackValidationError:ur,handleFeedbackSubmit:Lt,feedbackLoader:mt,feedbackTicketData:lt,isTicketCreator:Nt,ticketCreatedBy:Kt,clubStatusesMap:F,rootElement:"krypton-service-details-cx",breadCrumbLable:"Service Detail"}),document.body),ji&&B.createElement("div",{className:"modal theme-modal d-block",role:"dialog",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-xl modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},Vt?"":B.createElement("h4",{className:"modal-title"},"Share Feedback"),B.createElement("button",{type:"button",className:"close",onClick:()=>pt(!!Vt)},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"close"))),Vt&&B.createElement("div",{className:"ticket-details-success mb-5",align:"center"},B.createElement("div",{className:"icon"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"check_circle")),B.createElement("div",{className:"details font-weight-bold"},Vt)))))))},x_=e=>{if(!e)return"";const t={day:"2-digit",month:"short",year:"numeric"},n={hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0},s=new Date(e).toLocaleDateString("en-GB",t),a=new Date(e).toLocaleTimeString("en-GB",n);return`${s} ${a.toLowerCase()}`},hoe=e=>{if(!e||isNaN(e))return"0Day(s) 0H 0m 0s";const t=Math.floor(e/86400),n=e%86400,s=Math.floor(n/3600),a=n%3600,d=Math.floor(a/60),f=a%60;return`${t}Day(s) ${s}H ${d}m ${f}s`},uoe=e=>{if(!e||isNaN(e))return"00:00:00:00";const t=Math.floor(e/86400),n=e%86400,s=Math.floor(n/3600),a=n%3600,d=Math.floor(a/60),f=a%60;return`${t}:${s}:${d}:${f}`},doe=({orderDetail:e,hasDownloadPermission:t,serviceTestReports:n,isLoading:s,setIsLoading:a,showApiError:d})=>{const[f,i]=It([]),[S,E]=It(""),[L,F]=It(!1),[G,q]=It(!1),[Q,te]=It(!1);Ar(()=>{var Se,ke;console.debug("Window: ",window),F((Se=window.validateEditRquestAccessObj)==null?void 0:Se.hasImpersonated),q((ke=window.validateEditRquestAccessObj)==null?void 0:ke.hasImpersonationEditAccess)},[window.validateEditRquestAccessObj]),Ar(()=>{(()=>{te(L&&!G)})()},[L,G]),Ar(()=>{if(n&&n.length>0){a(!0);const Se=n.map(ke=>{const Ee=ke==null?void 0:ke.fileName.replace(/\.[^/.]+$/,""),Ie=ke==null?void 0:ke.fileName.split(".").pop().toLowerCase();return{url:ke==null?void 0:ke.href,fileName:Ee,id:ke==null?void 0:ke.id,description:ke==null?void 0:ke.description,size:ke==null?void 0:ke.fileSize,fileExtension:Ie,lastModifiedDate:ke==null?void 0:ke.lastModifiedDate,imgSrc:["xls","csv","xlsx"].includes(Ie)?"description":["png","jpg","jpeg"].includes(Ie)?"image":"picture_as_pdf"}});i(Se),a(!1)}},[n]);const he=async(Se,ke,Ee)=>{var He,Ye,lt;E("Your file is being generated. Please wait.");const Ie=await oG(Se);if(Ie&&((Ye=(He=Ie==null?void 0:Ie.data)==null?void 0:He.documents)==null?void 0:Ye.length)>0&&((lt=Ie==null?void 0:Ie.data)==null?void 0:lt.statusCode)==200)for(const Pt of Ie.data.documents){let At=null;Ee=="pdf"?At=tG(Pt==null?void 0:Pt.base64String):["xls","csv","xlsx"].includes(Ee)?At=iG(Pt==null?void 0:Pt.base64String):["png","jpg","jpeg"].includes(Ee)?At=rG(Pt==null?void 0:Pt.base64String,Ee):Ee=="kmz"?At=await QH(Pt==null?void 0:Pt.base64String):Ee=="kml"&&(At=await JH(Pt==null?void 0:Pt.base64String),ke=le(ke)),fe(At,ke)}setTimeout(()=>E(""),3e3)},fe=(Se,ke)=>{if(!Se||!ke){console.error("Invalid document URL or file name.");return}$B(`Service Detail - Test Report ${ke} downloaded successfully.`,Liferay.ThemeDisplay.getUserId(),Liferay.ThemeDisplay.getSiteGroupId(),Liferay.ThemeDisplay.getCompanyId());const Ee=document.createElement("a");Ee.href=Se,Ee.download=ke,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),setTimeout(()=>URL.revokeObjectURL(Ee.href),100)},le=Se=>Se.endsWith(".kml")?Se:`${Se}.kml`;return B.createElement(B.Fragment,null,B.createElement("div",{id:"Test-Reports",class:"tabular-item-content mb-25"},B.createElement("div",{class:"tabular-content-container loader_wrap"},s&&B.createElement("div",{className:"loader"}," "),d&&B.createElement("div",{className:"alert alert-info mb-3",role:"alert"},d),S&&B.createElement("div",{className:"col-md-12"},B.createElement("div",{className:"alert alert-info",role:"alert"},S)),!s&&!d&&f&&f.length==0&&B.createElement("div",{className:"col-md-12"},B.createElement("div",{className:"alert alert-info",role:"alert"},"Test Reports are not available.")),B.createElement("ul",{class:"documents_list"},!d&&n&&f&&f.map((Se,ke)=>B.createElement("li",{key:ke},B.createElement("div",{class:"docs_informations"},B.createElement("div",{class:"docs_type"},B.createElement("div",{class:"name"},B.createElement("span",{className:"material-symbols-outlined constl-icon"},Se==null?void 0:Se.imgSrc)),B.createElement("div",{class:"size"},Se==null?void 0:Se.size)),B.createElement("div",{class:"docs_details"},B.createElement("div",{class:"docs_name"},Se==null?void 0:Se.fileName),B.createElement("div",{class:"docs_dscrp"},Se==null?void 0:Se.description),B.createElement("div",{class:"docs_updated"},B.createElement("span",null,"Last Updated: "),Se!=null&&Se.lastModifiedDate?fa().formatDate((Se==null?void 0:Se.lastModifiedDate)??""):"")),t&&B.createElement("div",{className:"buttons-group-inline"},B.createElement("a",{href:"javascript:void(0)",className:`download download-btn ${Q?"disabled":""}`,title:"Download File",onClick:()=>{Q||he(Se==null?void 0:Se.url,Se==null?void 0:Se.fileName,Se==null?void 0:Se.fileExtension)}},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"file_save"))))))))))};var f$={exports:{}};(function(e,t){(function(n,s){e.exports=s()})(og,function(){var n,s,a;function d(i,S){if(!n)n=S;else if(!s)s=S;else{var E="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",L={};n(L),a=S(L),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}d(["exports"],function(i){var S=1e-6,E=typeof Float32Array<"u"?Float32Array:Array;function L(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=l*x-m*u;return w?(c[0]=x*(w=1/w),c[1]=-u*w,c[2]=-m*w,c[3]=l*w,c):null}function F(){var c=new E(9);return E!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function G(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=r[4],M=r[5],N=r[6],U=r[7],K=r[8];return c[0]=w*K-M*U,c[1]=m*U-u*K,c[2]=u*M-m*w,c[3]=M*N-x*K,c[4]=l*K-m*N,c[5]=m*x-l*M,c[6]=x*U-w*N,c[7]=u*N-l*U,c[8]=l*w-u*x,c}function q(c,r,l){var u=r[0],m=r[1],x=r[2],w=r[3],M=r[4],N=r[5],U=r[6],K=r[7],ee=r[8],oe=l[0],me=l[1],we=l[2],Le=l[3],ze=l[4],qe=l[5],ot=l[6],ct=l[7],Re=l[8];return c[0]=oe*u+me*w+we*U,c[1]=oe*m+me*M+we*K,c[2]=oe*x+me*N+we*ee,c[3]=Le*u+ze*w+qe*U,c[4]=Le*m+ze*M+qe*K,c[5]=Le*x+ze*N+qe*ee,c[6]=ot*u+ct*w+Re*U,c[7]=ot*m+ct*M+Re*K,c[8]=ot*x+ct*N+Re*ee,c}function Q(){var c=new E(16);return E!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function te(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function he(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=r[4],M=r[5],N=r[6],U=r[7],K=r[8],ee=r[9],oe=r[10],me=r[11],we=r[12],Le=r[13],ze=r[14],qe=r[15],ot=l*M-u*w,ct=l*N-m*w,Re=l*U-x*w,tt=u*N-m*M,ut=u*U-x*M,Tt=m*U-x*N,ri=K*Le-ee*we,Xt=K*ze-oe*we,si=K*qe-me*we,Ci=ee*ze-oe*Le,qi=ee*qe-me*Le,Fr=oe*qe-me*ze,gr=ot*Fr-ct*qi+Re*Ci+tt*si-ut*Xt+Tt*ri;return gr?(c[0]=(M*Fr-N*qi+U*Ci)*(gr=1/gr),c[1]=(m*qi-u*Fr-x*Ci)*gr,c[2]=(Le*Tt-ze*ut+qe*tt)*gr,c[3]=(oe*ut-ee*Tt-me*tt)*gr,c[4]=(N*si-w*Fr-U*Xt)*gr,c[5]=(l*Fr-m*si+x*Xt)*gr,c[6]=(ze*Re-we*Tt-qe*ct)*gr,c[7]=(K*Tt-oe*Re+me*ct)*gr,c[8]=(w*qi-M*si+U*ri)*gr,c[9]=(u*si-l*qi-x*ri)*gr,c[10]=(we*ut-Le*Re+qe*ot)*gr,c[11]=(ee*Re-K*ut-me*ot)*gr,c[12]=(M*Xt-w*Ci-N*ri)*gr,c[13]=(l*Ci-u*Xt+m*ri)*gr,c[14]=(Le*ct-we*tt-ze*ot)*gr,c[15]=(K*tt-ee*ct+oe*ot)*gr,c):null}function fe(c,r,l){var u=r[0],m=r[1],x=r[2],w=r[3],M=r[4],N=r[5],U=r[6],K=r[7],ee=r[8],oe=r[9],me=r[10],we=r[11],Le=r[12],ze=r[13],qe=r[14],ot=r[15],ct=l[0],Re=l[1],tt=l[2],ut=l[3];return c[0]=ct*u+Re*M+tt*ee+ut*Le,c[1]=ct*m+Re*N+tt*oe+ut*ze,c[2]=ct*x+Re*U+tt*me+ut*qe,c[3]=ct*w+Re*K+tt*we+ut*ot,c[4]=(ct=l[4])*u+(Re=l[5])*M+(tt=l[6])*ee+(ut=l[7])*Le,c[5]=ct*m+Re*N+tt*oe+ut*ze,c[6]=ct*x+Re*U+tt*me+ut*qe,c[7]=ct*w+Re*K+tt*we+ut*ot,c[8]=(ct=l[8])*u+(Re=l[9])*M+(tt=l[10])*ee+(ut=l[11])*Le,c[9]=ct*m+Re*N+tt*oe+ut*ze,c[10]=ct*x+Re*U+tt*me+ut*qe,c[11]=ct*w+Re*K+tt*we+ut*ot,c[12]=(ct=l[12])*u+(Re=l[13])*M+(tt=l[14])*ee+(ut=l[15])*Le,c[13]=ct*m+Re*N+tt*oe+ut*ze,c[14]=ct*x+Re*U+tt*me+ut*qe,c[15]=ct*w+Re*K+tt*we+ut*ot,c}function le(c,r,l){var u,m,x,w,M,N,U,K,ee,oe,me,we,Le=l[0],ze=l[1],qe=l[2];return r===c?(c[12]=r[0]*Le+r[4]*ze+r[8]*qe+r[12],c[13]=r[1]*Le+r[5]*ze+r[9]*qe+r[13],c[14]=r[2]*Le+r[6]*ze+r[10]*qe+r[14],c[15]=r[3]*Le+r[7]*ze+r[11]*qe+r[15]):(m=r[1],x=r[2],w=r[3],M=r[4],N=r[5],U=r[6],K=r[7],ee=r[8],oe=r[9],me=r[10],we=r[11],c[0]=u=r[0],c[1]=m,c[2]=x,c[3]=w,c[4]=M,c[5]=N,c[6]=U,c[7]=K,c[8]=ee,c[9]=oe,c[10]=me,c[11]=we,c[12]=u*Le+M*ze+ee*qe+r[12],c[13]=m*Le+N*ze+oe*qe+r[13],c[14]=x*Le+U*ze+me*qe+r[14],c[15]=w*Le+K*ze+we*qe+r[15]),c}function Se(c,r,l){var u=l[0],m=l[1],x=l[2];return c[0]=r[0]*u,c[1]=r[1]*u,c[2]=r[2]*u,c[3]=r[3]*u,c[4]=r[4]*m,c[5]=r[5]*m,c[6]=r[6]*m,c[7]=r[7]*m,c[8]=r[8]*x,c[9]=r[9]*x,c[10]=r[10]*x,c[11]=r[11]*x,c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15],c}function ke(c,r,l){var u=Math.sin(l),m=Math.cos(l),x=r[4],w=r[5],M=r[6],N=r[7],U=r[8],K=r[9],ee=r[10],oe=r[11];return r!==c&&(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c[4]=x*m+U*u,c[5]=w*m+K*u,c[6]=M*m+ee*u,c[7]=N*m+oe*u,c[8]=U*m-x*u,c[9]=K*m-w*u,c[10]=ee*m-M*u,c[11]=oe*m-N*u,c}function Ee(c,r,l){var u=Math.sin(l),m=Math.cos(l),x=r[0],w=r[1],M=r[2],N=r[3],U=r[8],K=r[9],ee=r[10],oe=r[11];return r!==c&&(c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c[0]=x*m-U*u,c[1]=w*m-K*u,c[2]=M*m-ee*u,c[3]=N*m-oe*u,c[8]=x*u+U*m,c[9]=w*u+K*m,c[10]=M*u+ee*m,c[11]=N*u+oe*m,c}function Ie(c,r,l){var u=Math.sin(l),m=Math.cos(l),x=r[0],w=r[1],M=r[2],N=r[3],U=r[4],K=r[5],ee=r[6],oe=r[7];return r!==c&&(c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c[0]=x*m+U*u,c[1]=w*m+K*u,c[2]=M*m+ee*u,c[3]=N*m+oe*u,c[4]=U*m-x*u,c[5]=K*m-w*u,c[6]=ee*m-M*u,c[7]=oe*m-N*u,c}function He(c,r){return c[0]=r[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=r[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=r[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Ye(c,r,l){var u,m,x,w=l[0],M=l[1],N=l[2],U=Math.hypot(w,M,N);return U<S?null:(w*=U=1/U,M*=U,N*=U,u=Math.sin(r),m=Math.cos(r),c[0]=w*w*(x=1-m)+m,c[1]=M*w*x+N*u,c[2]=N*w*x-M*u,c[3]=0,c[4]=w*M*x-N*u,c[5]=M*M*x+m,c[6]=N*M*x+w*u,c[7]=0,c[8]=w*N*x+M*u,c[9]=M*N*x-w*u,c[10]=N*N*x+m,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function lt(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=l+l,M=u+u,N=m+m,U=l*w,K=u*w,ee=u*M,oe=m*w,me=m*M,we=m*N,Le=x*w,ze=x*M,qe=x*N;return c[0]=1-ee-we,c[1]=K+qe,c[2]=oe-ze,c[3]=0,c[4]=K-qe,c[5]=1-U-we,c[6]=me+Le,c[7]=0,c[8]=oe+ze,c[9]=me-Le,c[10]=1-U-ee,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}Math.hypot||(Math.hypot=function(){for(var c=0,r=arguments.length;r--;)c+=arguments[r]*arguments[r];return Math.sqrt(c)});var Pt=fe;function At(){var c=new E(3);return E!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function ht(c){var r=new E(3);return r[0]=c[0],r[1]=c[1],r[2]=c[2],r}function Ot(c){return Math.hypot(c[0],c[1],c[2])}function Ae(c,r,l){var u=new E(3);return u[0]=c,u[1]=r,u[2]=l,u}function mt(c,r,l){return c[0]=r[0]+l[0],c[1]=r[1]+l[1],c[2]=r[2]+l[2],c}function bt(c,r,l){return c[0]=r[0]-l[0],c[1]=r[1]-l[1],c[2]=r[2]-l[2],c}function Dt(c,r,l){return c[0]=r[0]*l[0],c[1]=r[1]*l[1],c[2]=r[2]*l[2],c}function Je(c,r,l){return c[0]=Math.min(r[0],l[0]),c[1]=Math.min(r[1],l[1]),c[2]=Math.min(r[2],l[2]),c}function dt(c,r,l){return c[0]=Math.max(r[0],l[0]),c[1]=Math.max(r[1],l[1]),c[2]=Math.max(r[2],l[2]),c}function ui(c,r,l){return c[0]=r[0]*l,c[1]=r[1]*l,c[2]=r[2]*l,c}function Vt(c,r,l,u){return c[0]=r[0]+l[0]*u,c[1]=r[1]+l[1]*u,c[2]=r[2]+l[2]*u,c}function ei(c,r){var l=r[0]-c[0],u=r[1]-c[1],m=r[2]-c[2];return l*l+u*u+m*m}function ur(c){var r=c[0],l=c[1],u=c[2];return r*r+l*l+u*u}function Zt(c,r){return c[0]=-r[0],c[1]=-r[1],c[2]=-r[2],c}function Kt(c,r){var l=r[0],u=r[1],m=r[2],x=l*l+u*u+m*m;return x>0&&(x=1/Math.sqrt(x)),c[0]=r[0]*x,c[1]=r[1]*x,c[2]=r[2]*x,c}function Ui(c,r){return c[0]*r[0]+c[1]*r[1]+c[2]*r[2]}function rr(c,r,l){var u=r[0],m=r[1],x=r[2],w=l[0],M=l[1],N=l[2];return c[0]=m*N-x*M,c[1]=x*w-u*N,c[2]=u*M-m*w,c}function gi(c,r,l,u){var m=r[0],x=r[1],w=r[2];return c[0]=m+u*(l[0]-m),c[1]=x+u*(l[1]-x),c[2]=w+u*(l[2]-w),c}function Oi(c,r,l){var u=r[0],m=r[1],x=r[2],w=l[3]*u+l[7]*m+l[11]*x+l[15];return c[0]=(l[0]*u+l[4]*m+l[8]*x+l[12])/(w=w||1),c[1]=(l[1]*u+l[5]*m+l[9]*x+l[13])/w,c[2]=(l[2]*u+l[6]*m+l[10]*x+l[14])/w,c}function cr(c,r,l){var u=r[0],m=r[1],x=r[2];return c[0]=u*l[0]+m*l[3]+x*l[6],c[1]=u*l[1]+m*l[4]+x*l[7],c[2]=u*l[2]+m*l[5]+x*l[8],c}function ji(c,r,l){var u=l[0],m=l[1],x=l[2],w=r[0],M=r[1],N=r[2],U=m*N-x*M,K=x*w-u*N,ee=u*M-m*w,oe=m*ee-x*K,me=x*U-u*ee,we=u*K-m*U,Le=2*l[3];return K*=Le,ee*=Le,me*=2,we*=2,c[0]=w+(U*=Le)+(oe*=2),c[1]=M+K+me,c[2]=N+ee+we,c}function nn(c,r){return c[0]===r[0]&&c[1]===r[1]&&c[2]===r[2]}var pr=bt,Ue=Dt,ni=Ot;function fi(){var c=new E(4);return E!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Lt(c,r,l){return c[0]=r[0]*l,c[1]=r[1]*l,c[2]=r[2]*l,c[3]=r[3]*l,c}function pt(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=l*l+u*u+m*m+x*x;return w>0&&(w=1/Math.sqrt(w)),c[0]=l*w,c[1]=u*w,c[2]=m*w,c[3]=x*w,c}function Nt(c,r,l){var u=r[0],m=r[1],x=r[2],w=r[3];return c[0]=l[0]*u+l[4]*m+l[8]*x+l[12]*w,c[1]=l[1]*u+l[5]*m+l[9]*x+l[13]*w,c[2]=l[2]*u+l[6]*m+l[10]*x+l[14]*w,c[3]=l[3]*u+l[7]*m+l[11]*x+l[15]*w,c}function Si(){var c=new E(4);return E!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function pi(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function St(c,r,l){l*=.5;var u=r[0],m=r[1],x=r[2],w=r[3],M=Math.sin(l),N=Math.cos(l);return c[0]=u*N+w*M,c[1]=m*N+x*M,c[2]=x*N-m*M,c[3]=w*N-u*M,c}function Ht(c,r,l){l*=.5;var u=r[0],m=r[1],x=r[2],w=r[3],M=Math.sin(l),N=Math.cos(l);return c[0]=u*N-x*M,c[1]=m*N+w*M,c[2]=x*N+u*M,c[3]=w*N-m*M,c}At(),fi();var nr,tr,kr,Mr,Cr,Tn=pt,gs=(nr=At(),tr=Ae(1,0,0),kr=Ae(0,1,0),function(c,r,l){var u=Ui(r,l);return u<-.999999?(rr(nr,tr,r),ni(nr)<1e-6&&rr(nr,kr,r),Kt(nr,nr),function(m,x,w){w*=.5;var M=Math.sin(w);m[0]=M*x[0],m[1]=M*x[1],m[2]=M*x[2],m[3]=Math.cos(w)}(c,nr,Math.PI),c):u>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(rr(nr,r,l),c[0]=nr[0],c[1]=nr[1],c[2]=nr[2],c[3]=1+u,Tn(c,c))});function wn(){var c=new E(2);return E!=Float32Array&&(c[0]=0,c[1]=0),c}function bs(c,r){var l=new E(2);return l[0]=c,l[1]=r,l}function qn(c,r,l){return c[0]=r[0]+l[0],c[1]=r[1]+l[1],c}function Ls(c,r,l){return c[0]=r[0]-l[0],c[1]=r[1]-l[1],c}function ma(c,r,l){return c[0]=r[0]*l,c[1]=r[1]*l,c}function Ln(c){return Math.hypot(c[0],c[1])}function qo(c,r){var l=r[0],u=r[1],m=l*l+u*u;return m>0&&(m=1/Math.sqrt(m)),c[0]=r[0]*m,c[1]=r[1]*m,c}function zn(c,r){return c[0]*r[0]+c[1]*r[1]}function za(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}Si(),Si(),F(),wn();var $o,Aa,ja=function(){if(Cr)return Mr;function c(r,l,u,m){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=l,this.p2x=u,this.p2y=m}return Cr=1,Mr=c,c.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,l){if(l===void 0&&(l=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,m=0;m<8;m++){var x=this.sampleCurveX(u)-r;if(Math.abs(x)<l)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=x/w}var M=0,N=1;for(u=r,m=0;m<20&&(x=this.sampleCurveX(u),!(Math.abs(x-r)<l));m++)r>x?M=u:N=u,u=.5*(N-M)+M;return u},solve:function(r,l){return this.sampleCurveY(this.solveCurveX(r,l))}},Mr}(),Yn=za(ja);function hl(){if(Aa)return $o;function c(r,l){this.x=r,this.y=l}return Aa=1,$o=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,l){return this.clone()._rotateAround(r,l)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var l=r.x-this.x,u=r.y-this.y;return l*l+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,l){return Math.atan2(this.x*l-this.y*r,this.x*r+this.y*l)},_matMult:function(r){var l=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=l,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var l=Math.cos(r),u=Math.sin(r),m=u*this.x+l*this.y;return this.x=l*this.x-u*this.y,this.y=m,this},_rotateAround:function(r,l){var u=Math.cos(r),m=Math.sin(r),x=l.y+m*(this.x-l.x)+u*(this.y-l.y);return this.x=l.x+u*(this.x-l.x)-m*(this.y-l.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(r){return r instanceof c?r:Array.isArray(r)?new c(r[0],r[1]):r},$o}var fr=za(hl());function tc(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let l=0;l<c.length;l++)if(!tc(c[l],r[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const l in c)if(!tc(c[l],r[l]))return!1;return!0}return c===r}const Sh=Math.PI/180,bl=180/Math.PI;function Un(c){return c*Sh}function vi(c){return c*bl}const Ge=[[0,0],[1,0],[1,1],[0,1]];function Fe(c){if(c<=0)return 0;if(c>=1)return 1;const r=c*c,l=r*c;return 4*(c<.5?l:3*(c-r)+l-.75)}function rt(c,r,l,u){const m=new Yn(c,r,l,u);return function(x){return m.solve(x)}}const xt=rt(.25,.1,.25,1);function ft(c,r,l){return Math.min(l,Math.max(r,c))}function Jt(c,r,l){return(l=ft((l-c)/(r-c),0,1))*l*(3-2*l)}function xi(c,r,l){const u=l-r,m=((c-r)%u+u)%u+r;return m===r?l:m}function ti(c,r,l){if(!c.length)return l(null,[]);let u=c.length;const m=new Array(c.length);let x=null;c.forEach((w,M)=>{r(w,(N,U)=>{N&&(x=N),m[M]=U,--u==0&&l(x,m)})})}function ai(c,...r){for(const l of r)for(const u in l)c[u]=l[u];return c}let Yi=1;function Fi(){return Yi++}function Pr(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function ln(c,r){c.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function Qr(c,r,l){const u={};for(const m in c)u[m]=r.call(this,c[m],m,c);return u}function Or(c,r,l){const u={};for(const m in c)r.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function ii(c){return Array.isArray(c)?c.map(ii):typeof c=="object"&&c?Qr(c,ii):c}function xr(c,r){for(let l=0;l<c.length;l++)if(r.indexOf(c[l])>=0)return!0;return!1}const Xr={};function tn(c){Xr[c]||(typeof console<"u"&&console.warn(c),Xr[c]=!0)}function Jn(c,r,l){return(l.y-c.y)*(r.x-c.x)>(r.y-c.y)*(l.x-c.x)}function ds(c){let r=0;for(let l,u,m=0,x=c.length,w=x-1;m<x;w=m++)l=c[m],u=c[w],r+=(u.x-l.x)*(l.y+u.y);return r}function mi([c,r,l]){const u=Un(r+90),m=Un(l);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:r,polar:l}}function _r(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function zi(c){const r={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,m,x)=>{const w=m||x;return r[u]=!w||w.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let zr=null;function Yr(c,r){return[c[4*r],c[4*r+1],c[4*r+2],c[4*r+3]]}function yr(c,r,l,u){for(;r<l;){const m=r+l>>1;c[m]<u?r=m+1:l=m}return r}function Hr(c,r,l,u){for(;r<l;){const m=r+l>>1;c[m]<=u?r=m+1:l=m}return r}function rn(c){return c>0?1/(1.001-c):1+c}function is(c){return c>0?1-1/(1.001-c):-c}function Ps(c,r,l){return(c-r.min)*(l.max-l.min)/(r.max-r.min)+l.min}const vs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!vs.API_URL)return null;try{const c=new URL(vs.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ra(c){return vs.API_URL_REGEX.test(c)}function Po(c){return vs.API_SPRITE_REGEX.test(c)}let Sc,Xl,lh,ps,la,$u;function _u(){return Sc==null&&(Sc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Sc}const ch={now:()=>ps!==void 0?ps:performance.now(),setNow(c){ps=c},restoreNow(){ps=void 0},frame(c){const r=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(c,r=0){const{width:l,height:u}=c;la||(la=document.createElement("canvas"));const m=la.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>la.width||u>la.height)&&(la.width=l,la.height=u),m.clearRect(-r,-r,l+2*r,u+2*r),m.drawImage(c,0,0,l,u),m.getImageData(-r,-r,l+2*r,u+2*r)},resolveURL:c=>(Xl||(Xl=document.createElement("a")),Xl.href=c,Xl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(lh==null&&(lh=window.matchMedia("(prefers-reduced-motion: reduce)")),lh.matches)},hasCanvasFingerprintNoise(){if($u!==void 0)return $u;if(!_u())return $u=!1,!1;const c=new OffscreenCanvas(85,1),r=c.getContext("2d",{willReadFrequently:!0});let l=0;for(let m=0;m<c.width;++m)r.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,r.fillRect(m,0,1,1);const u=r.getImageData(0,0,c.width,c.height);l=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&l++!==u.data[m])return $u=!0,!0;return $u=!1,!1}};function Lc(c,r){const l=c.indexOf("?");if(l<0)return`${c}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(c.slice(l));for(const m in r)u.set(m,r[m]);return`${c.slice(0,l)}?${u.toString()}`}function zc(c,r={persistentParams:[]}){const l=c.indexOf("?");if(l<0)return c;const u=new URLSearchParams,m=new URLSearchParams(c.slice(l));for(const w of r.persistentParams){const M=m.get(w);M&&u.set(w,M)}const x=u.toString();return`${c.slice(0,l)}${x.length>0?`?${x}`:""}`}const Kh="mapbox-tiles";let ul=500,Uc=50;const du=["language","worldview","jobid"];let Yc,Ds;function Ys(){try{return caches}catch{}}function Cs(){const c=Ys();c&&Yc==null&&(Yc=c.open(Kh))}let to=1/0;const Xs={supported:!1,testSupport:function(c){!ca&&ba&&(fh?Dp(c):Bs=c)}};let Bs,ba,ca=!1,fh=!1;const Il=typeof self<"u"?self:{};function Dp(c){const r=c.createTexture();c.bindTexture(c.TEXTURE_2D,r);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,ba),c.isContextLost())return;Xs.supported=!0}catch{}c.deleteTexture(r),ca=!0}Il.document&&(ba=Il.document.createElement("img"),ba.onload=function(){Bs&&Dp(Bs),Bs=null,fh=!0},ba.onerror=function(){ca=!0,Bs=null},ba.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Th={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Th);class Vs extends Error{constructor(r,l,u){l===401&&ra(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pu=_r()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,vu=function(c,r){if(!(/^file:/.test(l=c.url)||/^file:/.test(pu())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const x=new AbortController,w=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:pu(),referrerPolicy:u.referrerPolicy,signal:x.signal});let M=!1,N=!1;const U=(K=w.url).indexOf("sku=")>0&&ra(K);var K;u.type==="json"&&w.headers.set("Accept","application/json");const ee=(me,we,Le)=>{if(N)return;if(me&&me.message!=="SecurityError"&&tn(me.toString()),we&&Le)return oe(we);const ze=Date.now();fetch(w).then(qe=>{if(qe.ok){const ot=U?qe.clone():null;return oe(qe,ot,ze)}return m(new Vs(qe.statusText,qe.status,u.url))}).catch(qe=>{qe.name!=="AbortError"&&m(new Error(`${qe.message} ${u.url}`))})},oe=(me,we,Le)=>{(u.type==="arrayBuffer"?me.arrayBuffer():u.type==="json"?me.json():me.text()).then(ze=>{N||(we&&Le&&function(qe,ot,ct){if(Cs(),Yc==null)return;const Re=zi(ot.headers.get("Cache-Control")||"");if(Re["no-store"])return;const tt={status:ot.status,statusText:ot.statusText,headers:new Headers};ot.headers.forEach((ri,Xt)=>tt.headers.set(Xt,ri)),Re["max-age"]&&tt.headers.set("Expires",new Date(ct+1e3*Re["max-age"]).toUTCString());const ut=tt.headers.get("Expires");if(!ut||new Date(ut).getTime()-ct<42e4)return;let Tt=zc(qe.url,{persistentParams:du});if(ot.status===206){const ri=qe.headers.get("Range");if(!ri)return;tt.status=200,Tt=Lc(Tt,{range:ri})}(function(ri,Xt){if(Ds===void 0)try{new Response(new ReadableStream),Ds=!0}catch{Ds=!1}Ds?Xt(ri.body):ri.blob().then(Xt).catch(si=>tn(si.message))})(ot,ri=>{const Xt=new Response((si=ot.status)!==200&&si!==404&&[101,103,204,205,304].includes(si)?null:ri,tt);var si;Cs(),Yc!=null&&Yc.then(Ci=>Ci.put(Tt,Xt)).catch(Ci=>tn(Ci.message))})}(w,we,Le),M=!0,m(null,ze,me.headers.get("Cache-Control"),me.headers.get("Expires")))}).catch(ze=>{N||m(new Error(ze.message))})};return U?function(me,we){if(Cs(),Yc==null)return we(null);Yc.then(Le=>{let ze=zc(me.url,{persistentParams:du});const qe=me.headers.get("Range");qe&&(ze=Lc(ze,{range:qe})),Le.match(ze).then(ot=>{const ct=function(Re){if(!Re)return!1;const tt=new Date(Re.headers.get("Expires")||0),ut=zi(Re.headers.get("Cache-Control")||"");return Number(tt)>Date.now()&&!ut["no-cache"]}(ot);Le.delete(ze).catch(we),ct&&Le.put(ze,ot.clone()).catch(we),we(null,ot,ct)}).catch(we)}).catch(we)}(w,ee):ee(null,null),{cancel:()=>{N=!0,M||x.abort()}}}(c,r);if(_r(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,r,void 0,!0)}var l;return function(u,m){const x=new XMLHttpRequest;x.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const w in u.headers)x.setRequestHeader(w,u.headers[w]);return u.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=u.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(u.type==="json")try{w=JSON.parse(x.response)}catch(M){return m(M)}m(null,w,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else m(new Vs(x.statusText,x.status,u.url))},x.send(u.body),{cancel:()=>x.abort()}}(c,r)},Qh=function(c,r){return vu(ai(c,{type:"arrayBuffer"}),r)};function Vf(c){const r=document.createElement("a");return r.href=c,r.protocol===location.protocol&&r.host===location.host}const Tc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hp,mh;hp=[],mh=0;const qa=function(c,r){if(Xs.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),mh>=vs.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:c,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return hp.push(x),x}mh++;let l=!1;const u=()=>{if(!l)for(l=!0,mh--;hp.length&&mh<vs.MAX_PARALLEL_IMAGE_REQUESTS;){const x=hp.shift(),{requestParameters:w,callback:M,cancelled:N}=x;N||(x.cancel=qa(w,M).cancel)}},m=Qh(c,(x,w,M,N)=>{u(),x?r(x):w&&(self.createImageBitmap?function(U,K){const ee=new Blob([new Uint8Array(U)],{type:"image/png"});createImageBitmap(ee).then(oe=>{K(null,oe)}).catch(oe=>{K(new Error(`Could not load image because of ${oe.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,(U,K)=>r(U,K,M,N)):function(U,K){const ee=new Image;ee.onload=()=>{K(null,ee),URL.revokeObjectURL(ee.src),ee.onload=null,requestAnimationFrame(()=>{ee.src=Tc})},ee.onerror=()=>K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const oe=new Blob([new Uint8Array(U)],{type:"image/png"});ee.src=U.byteLength?URL.createObjectURL(oe):Tc}(w,(U,K)=>r(U,K,M,N)))});return{cancel:()=>{m.cancel(),u()}}};var Ka,zd,Vu,Nh={exports:{}},Ud={exports:{}},up={exports:{}},hc=function(){if(Vu)return Nh.exports;Vu=1;var c=(Ka||(Ka=1,Ud.exports=function(l,u){var m,x,w,M,N,U,K,ee;for(x=l.length-(m=3&l.length),w=u,N=3432918353,U=461845907,ee=0;ee<x;)K=255&l.charCodeAt(ee)|(255&l.charCodeAt(++ee))<<8|(255&l.charCodeAt(++ee))<<16|(255&l.charCodeAt(++ee))<<24,++ee,w=27492+(65535&(M=5*(65535&(w=(w^=K=(65535&(K=(K=(65535&K)*N+(((K>>>16)*N&65535)<<16)&4294967295)<<15|K>>>17))*U+(((K>>>16)*U&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(K=0,m){case 3:K^=(255&l.charCodeAt(ee+2))<<16;case 2:K^=(255&l.charCodeAt(ee+1))<<8;case 1:w^=K=(65535&(K=(K=(65535&(K^=255&l.charCodeAt(ee)))*N+(((K>>>16)*N&65535)<<16)&4294967295)<<15|K>>>17))*U+(((K>>>16)*U&65535)<<16)&4294967295}return w^=l.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0}),Ud.exports),r=(zd||(zd=1,up.exports=function(l,u){for(var m,x=l.length,w=u^x,M=0;x>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(M)|(255&l.charCodeAt(++M))<<8|(255&l.charCodeAt(++M))<<16|(255&l.charCodeAt(++M))<<24))+((1540483477*(m>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++M;switch(x){case 3:w^=(255&l.charCodeAt(M+2))<<16;case 2:w^=(255&l.charCodeAt(M+1))<<8;case 1:w=1540483477*(65535&(w^=255&l.charCodeAt(M)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0}),up.exports);return Nh.exports=c,Nh.exports.murmur3=c,Nh.exports.murmur2=r,Nh.exports}(),fu=za(hc);class Ha{constructor(r,...l){ai(this,l[0]||{}),this.type=r}}class Ll extends Ha{constructor(r,l={}){super("error",ai({error:r},l))}}function vd(c,r,l){l[c]&&l[c].indexOf(r)!==-1||(l[c]=l[c]||[],l[c].push(r))}function Bh(c,r,l){if(l&&l[c]){const u=l[c].indexOf(r);u!==-1&&l[c].splice(u,1)}}class Wu{on(r,l){return this._listeners=this._listeners||{},vd(r,l,this._listeners),this}off(r,l){return Bh(r,l,this._listeners),Bh(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},vd(r,l,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,l){const u=typeof r=="string"?new Ha(r,l):r,m=u.type;if(this.listens(m)){u.target=this;const x=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const N of x)N.call(this,u);const w=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const N of w)Bh(m,N,this._oneTimeListeners),N.call(this,u);const M=this._eventedParent;M&&(ai(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(u))}else u instanceof Ll&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}class Xc{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new Xc(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[l,u]=r.split("");return new Xc({name:l,iconsetId:u})}static isEqual(r,l){return r.name===l.name&&r.iconsetId===l.iconsetId}toString(){return Xc.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ma,Cc={},Fh=function(){if(Ma)return Cc;Ma=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(x){return(x=Math.round(x))<0?0:x>255?255:x}function l(x){return r(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function u(x){return(w=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function m(x,w,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?x+(w-x)*M*6:2*M<1?w:3*M<2?x+(w-x)*(2/3-M)*6:x}try{Cc.parseCSSColor=function(x){var w,M=x.replace(/ /g,"").toLowerCase();if(M in c)return c[M].slice();if(M[0]==="#")return M.length===4?(w=parseInt(M.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:M.length===7&&(w=parseInt(M.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var N=M.indexOf("("),U=M.indexOf(")");if(N!==-1&&U+1===M.length){var K=M.substr(0,N),ee=M.substr(N+1,U-(N+1)).split(","),oe=1;switch(K){case"rgba":if(ee.length!==4)return null;oe=u(ee.pop());case"rgb":return ee.length!==3?null:[l(ee[0]),l(ee[1]),l(ee[2]),oe];case"hsla":if(ee.length!==4)return null;oe=u(ee.pop());case"hsl":if(ee.length!==3)return null;var me=(parseFloat(ee[0])%360+360)%360/360,we=u(ee[1]),Le=u(ee[2]),ze=Le<=.5?Le*(we+1):Le+we-Le*we,qe=2*Le-ze;return[r(255*m(qe,ze,me+1/3)),r(255*m(qe,ze,me)),r(255*m(qe,ze,me-1/3)),oe];default:return null}}return null}}catch{}return Cc}();class ao{constructor(r,l,u,m=1){this.r=r,this.g=l,this.b=u,this.a=m}static parse(r){if(!r)return;if(r instanceof ao)return r;if(typeof r!="string")return;const l=Fh.parseCSSColor(r);return l?new ao(l[0]/255,l[1]/255,l[2]/255,l[3]):void 0}toString(){const[r,l,u,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*l)},${Math.round(255*u)},${m})`}toNonPremultipliedRenderColor(r){const{r:l,g:u,b:m,a:x}=this;return new xu(r,l,u,m,x)}toPremultipliedRenderColor(r){const{r:l,g:u,b:m,a:x}=this;return new af(r,l*x,u*x,m*x,x)}clone(){return new ao(this.r,this.g,this.b,this.a)}}class Dl{constructor(r,l,u,m,x,w=!1){if(this.premultiplied=!1,this.premultiplied=w,r){const M=r.image.height,N=M*M;this.premultiplied?(l=x===0?0:l/x*(M-1),u=x===0?0:u/x*(M-1),m=x===0?0:m/x*(M-1)):(l*=M-1,u*=M-1,m*=M-1);const U=Math.floor(l),K=Math.floor(u),ee=Math.floor(m),oe=Math.ceil(l),me=Math.ceil(u),we=Math.ceil(m),Le=l-U,ze=u-K,qe=m-ee,ot=r.image.data,ct=4*(U+K*N+ee*M),Re=4*(U+K*N+we*M),tt=4*(U+me*N+ee*M),ut=4*(U+me*N+we*M),Tt=4*(oe+K*N+ee*M),ri=4*(oe+K*N+we*M),Xt=4*(oe+me*N+ee*M),si=4*(oe+me*N+we*M);if(ct<0||si>=ot.length)throw new Error("out of range");this.r=kn(kn(kn(ot[ct],ot[Re],qe),kn(ot[tt],ot[ut],qe),ze),kn(kn(ot[Tt],ot[ri],qe),kn(ot[Xt],ot[si],qe),ze),Le)/255*(this.premultiplied?x:1),this.g=kn(kn(kn(ot[ct+1],ot[Re+1],qe),kn(ot[tt+1],ot[ut+1],qe),ze),kn(kn(ot[Tt+1],ot[ri+1],qe),kn(ot[Xt+1],ot[si+1],qe),ze),Le)/255*(this.premultiplied?x:1),this.b=kn(kn(kn(ot[ct+2],ot[Re+2],qe),kn(ot[tt+2],ot[ut+2],qe),ze),kn(kn(ot[Tt+2],ot[ri+2],qe),kn(ot[Xt+2],ot[si+2],qe),ze),Le)/255*(this.premultiplied?x:1),this.a=x}else this.r=l,this.g=u,this.b=m,this.a=x}toArray(){const{r,g:l,b:u,a:m}=this;return[255*r,255*l,255*u,m]}toHslaArray(){let{r,g:l,b:u,a:m}=this;if(this.premultiplied){if(m===0)return[0,0,0,0];r/=m,l/=m,u/=m}const x=Math.min(Math.max(r,0),1),w=Math.min(Math.max(l,0),1),M=Math.min(Math.max(u,0),1),N=Math.min(x,w,M),U=Math.max(x,w,M),K=(N+U)/2;if(N===U)return[0,0,100*K,m];const ee=U-N,oe=K>.5?ee/(2-U-N):ee/(U+N);let me=0;return U===x?me=(w-M)/ee+(w<M?6:0):U===w?me=(M-x)/ee+2:U===M&&(me=(x-w)/ee+4),me*=60,[Math.min(Math.max(me,0),360),Math.min(Math.max(100*oe,0),100),Math.min(Math.max(100*K,0),100),m]}toArray01(){const{r,g:l,b:u,a:m}=this;return[r,l,u,m]}toArray01Scaled(r){const{r:l,g:u,b:m}=this;return[l*r,u*r,m*r]}toArray01Linear(){const{r,g:l,b:u,a:m}=this;return[Math.pow(r,2.2),Math.pow(l,2.2),Math.pow(u,2.2),m]}}class xu extends Dl{constructor(r,l,u,m,x){super(r,l,u,m,x,!1)}}class af extends Dl{constructor(r,l,u,m,x){super(r,l,u,m,x,!0)}}function kn(c,r,l){return c*(1-l)+r*l}function lf(c,r,l){return c.map((u,m)=>kn(u,r[m],l))}ao.black=new ao(0,0,0,1),ao.white=new ao(1,1,1,1),ao.transparent=new ao(0,0,0,0),ao.red=new ao(1,0,0,1),ao.blue=new ao(0,0,1,1);var ic=Object.freeze({__proto__:null,array:lf,color:function(c,r,l){return new ao(kn(c.r,r.r,l),kn(c.g,r.g,l),kn(c.b,r.b,l),kn(c.a,r.a,l))},number:kn});function wl(c,...r){for(const l of r)for(const u in l)c[u]=l[u];return c}class Qa extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class Zl{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[u,m]of l)this.bindings[u]=m}concat(r){return new Zl(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const $c={kind:"null"},vn={kind:"number"},os={kind:"string"},Zs={kind:"boolean"},zl={kind:"color"},bu={kind:"object"},Ks={kind:"value"},xd={kind:"collator"},ju={kind:"formatted"},Hu={kind:"resolvedImage"};function Sl(c,r){return{kind:"array",itemType:c,N:r}}function Ja(c){if(c.kind==="array"){const r=Ja(c.itemType);return typeof c.N=="number"?`array<${r}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${r}>`}return c.kind}const Gu=[$c,vn,os,Zs,zl,ju,bu,Sl(Ks),Hu];function zh(c,r){if(r.kind==="error")return null;if(c.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!zh(c.itemType,r.itemType))&&(typeof c.N!="number"||c.N===r.N))return null}else{if(c.kind===r.kind)return null;if(c.kind==="value"){for(const l of Gu)if(!zh(l,r))return null}}return`Expected ${Ja(c)} but found ${Ja(r)} instead.`}function Ch(c,r){return r.some(l=>l.kind===c.kind)}function hh(c,r){return r.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function vt(c,r){return c.kind==="array"&&r.kind==="array"?c.N===r.N&&vt(c.itemType,r.itemType):c.kind===r.kind}class Yt{constructor(r,l,u){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Di{constructor(r,l,u,m,x){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=u,this.fontStack=m,this.textColor=x}}class yi{constructor(r){this.sections=r}static fromString(r){return new yi([new Di(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof yi?r:yi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){const m=l.image.getPrimary().id.toString();r.push(["image",m]);continue}r.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class bi{constructor(r,l={}){if(this.id=Xc.from(r),this.options=Object.assign({},l),l.transform){const{a:u,b:m,c:x,d:w,e:M,f:N}=l.transform;this.options.transform=new DOMMatrix([u,m,x,w,M,N])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:l,c:u,d:m,e:x,f:w}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:l,c:u,d:m,e:x,f:w}})}static parse(r){let l,u,m,x;try{({name:l,iconsetId:u,params:m,transform:x}=JSON.parse(r)||{})}catch{return null}if(!l)return null;const{a:w,b:M,c:N,d:U,e:K,f:ee}=x||{};return new bi({name:l,iconsetId:u},{params:m,transform:new DOMMatrix([w,M,N,U,K,ee])})}scaleSelf(r,l){return this.options.transform.scaleSelf(r,l),this}}class Li{constructor(r,l,u,m,x=!1){this.primaryId=Xc.from(r),this.primaryOptions=l,u&&(this.secondaryId=Xc.from(u)),this.secondaryOptions=m,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new bi(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new bi(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?Li.build({name:r}):r}static build(r,l,u,m){return!r||typeof r=="object"&&!("name"in r)?null:new Li(r,u,l,m)}}function Tr(c,r,l,u){return typeof c=="number"&&c>=0&&c<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,r,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,r,l,u]:[c,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bi(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof ao||c instanceof Yt||c instanceof yi||c instanceof Li)return!0;if(Array.isArray(c)){for(const r of c)if(!Bi(r))return!1;return!0}if(typeof c=="object"){for(const r in c)if(!Bi(c[r]))return!1;return!0}return!1}function Gt(c){if(c===null)return $c;if(typeof c=="string")return os;if(typeof c=="boolean")return Zs;if(typeof c=="number")return vn;if(c instanceof ao)return zl;if(c instanceof Yt)return xd;if(c instanceof yi)return ju;if(c instanceof Li)return Hu;if(Array.isArray(c)){const r=c.length;let l;for(const u of c){const m=Gt(u);if(l){if(l===m)continue;l=Ks;break}l=m}return Sl(l||Ks,r)}return bu}function qr(c){const r=typeof c;return c===null?"":r==="string"||r==="number"||r==="boolean"?String(c):c instanceof yi||c instanceof Li||c instanceof ao?c.toString():JSON.stringify(c)}class sr{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Bi(r[1]))return l.error("invalid value");const u=r[1];let m=Gt(u);const x=l.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new sr(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ao?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof yi?this.value.serialize():this.value}}class Qi{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const sn={string:os,number:vn,boolean:Zs,object:bu};class hi{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let u,m=1;const x=r[0];if(x==="array"){let M,N;if(r.length>2){const U=r[1];if(typeof U!="string"||!(U in sn)||U==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=sn[U],m++}else M=Ks;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);N=r[2],m++}u=Sl(M,N)}else u=sn[x];const w=[];for(;m<r.length;m++){const M=l.parse(r[m],m,Ks);if(!M)return null;w.push(M)}return new hi(u,w)}evaluate(r){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(r);if(!zh(this.type,Gt(u)))return u;if(l===this.args.length-1)throw new Qi(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Ja(Gt(u))} but was expected to be of type ${Ja(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){l.push(u.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(u=>u.serialize()))}}class Pn{constructor(r){this.type=ju,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return l.error("First argument must be an image or text section.");const m=[];let x=!1;for(let w=1;w<=r.length-1;++w){const M=r[w];if(x&&typeof M=="object"&&!Array.isArray(M)){x=!1;let N=null;if(M["font-scale"]&&(N=l.parseObjectValue(M["font-scale"],w,"font-scale",vn),!N))return null;let U=null;if(M["text-font"]&&(U=l.parseObjectValue(M["text-font"],w,"text-font",Sl(os)),!U))return null;let K=null;if(M["text-color"]&&(K=l.parseObjectValue(M["text-color"],w,"text-color",zl),!K))return null;const ee=m[m.length-1];ee.scale=N,ee.font=U,ee.textColor=K}else{const N=l.parse(r[w],w,Ks);if(!N)return null;const U=N.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:N,scale:null,font:null,textColor:null})}}return new Pn(m)}evaluate(r){return new yi(this.sections.map(l=>{const u=l.content.evaluate(r);return vt(Gt(u),Hu)?new Di("",u,null,null,null):new Di(qr(u),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),r.push(u)}return r}}class as{constructor(r,l,u,m){this._imageWarnHistory={},this.type=Hu,this.namePrimary=r,this.nameSecondary=l,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(r,l){if(r.length<2)return l.error("Expected two or more arguments.");let u=1;const m=[];function x(){if(u<r.length){const M=l.parse(r[u],u++,os);return M?(m.push({image:M,options:{}}),!0):(l.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function w(){if(u<r.length){const N=r[u];if((M=N)===null||typeof M!="object"||Array.isArray(M))return!0;const U=N.params,K=N.iconset,ee=l.concat(u);if(!U&&!K)return u++,!0;if(U){if(typeof U!="object"||U.constructor!==Object)return ee.error('Image options "params" should be an object'),!1;const oe={},me=ee.concat(void 0,"params");for(const we in U){if(!we)return me.error("Image parameter name should be non-empty"),!1;const Le=me.concat(void 0,we).parse(U[we],void 0,zl,void 0,{typeAnnotation:"coerce"});if(!Le)return!1;oe[we]=Le}m[m.length-1].options.params=oe}if(K){if(typeof K!="object"||K.constructor!==Object)return ee.error('Image options "iconset" should be an object'),!1;if(!K.id)return ee.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=K}return u++,!0}var M;return!0}for(let M=0;M<2;M++)if(!x()||!w())return;return new as(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(r,l){const u={};if(l){for(const m in l)if(l[m])try{u[m]=l[m].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const l={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,m=Li.build(l,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(m&&r.availableImages){const x=m.getPrimary().id;if(m.available=r.availableImages.some(w=>Xc.isEqual(w,x)),m.available){const w=m.getSecondary()?m.getSecondary().id:null;w&&(m.available=r.availableImages.some(M=>Xc.isEqual(M,w)))}}return m}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&r(this.paramsPrimary[l]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&r(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(r,l){const u={};if(l&&(u.iconset={id:l}),r){u.params={};for(const m in r)r[m]&&(u.params[m]=r[m].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&r.push(l)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&r.push(l)}return r}}function Yo(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const Qn={"to-boolean":Zs,"to-color":zl,"to-number":vn,"to-string":os};class ro{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[0],m=[];let x=$c;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const w=r[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);x=Sl(l.expectedType.itemType,w)}else{if(!(w>0&&Bi(r[1][0])))return null;x=Sl(Gt(r[1][0]),w)}for(let M=0;M<w;M++){const N=r[1][M];let U;if(Yo(N)==="array")U=l.parse(N,void 0,x.itemType);else{const K=Yo(N);if(K!==x.itemType.kind)return l.error(`Expected ${x.itemType.kind} but found ${K}.`);U=l.registry.literal.parse(["literal",N===void 0?null:N],l)}if(!U)return null;m.push(U)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return l.error("Expected one argument.");x=Qn[u];for(let w=1;w<r.length;w++){const M=l.parse(r[w],w,Ks);if(!M)return null;m.push(M)}}return new ro(x,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,u;for(const m of this.args){if(l=m.evaluate(r),u=null,l instanceof ao)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Tr(l[0],l[1],l[2],l[3]),!u))return new ao(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Qi(u||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const u of this.args){if(l=u.evaluate(r),l===null)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Qi(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?yi.fromString(qr(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Li.build(qr(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(l=>l.evaluate(r)):qr(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new as(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Ao=["Unknown","Point","LineString","Polygon"];class el{constructor(r,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ao[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*l-r[0])+this.featureDistanceData.bearing[1]*(m*l-r[1])}return 0}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=ao.parse(r)),l}getConfig(r){return this.options?this.options.get(r):null}}class Mo{constructor(r,l,u,m,x){this.name=r,this.type=l,this._evaluate=u,this.args=m,this._overloadIndex=x}evaluate(r){if(!this._evaluate){const l=Mo.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const u=r[0],m=Mo.definitions[u];if(!m)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,M=[];let N=null,U=-1;for(const[K,ee]of w){if(Array.isArray(K)&&K.length!==r.length-1)continue;M.push(K),U++,N=new No(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const oe=[];let me=!1;for(let we=1;we<r.length;we++){const Le=r[we],ze=Array.isArray(K)?K[we-1]:K.type,qe=N.parse(Le,1+oe.length,ze);if(!qe){me=!0;break}oe.push(qe)}if(!me)if(Array.isArray(K)&&K.length!==oe.length)N.error(`Expected ${K.length} arguments, but found ${oe.length} instead.`);else{for(let we=0;we<oe.length;we++){const Le=Array.isArray(K)?K[we]:K.type,ze=oe[we];N.concat(we+1).checkSubtype(Le,ze.type)}if(N.errors.length===0)return new Mo(u,x,ee,oe,U)}}if(M.length===1)l.errors.push(...N.errors);else{const K=(M.length?M:w.map(([oe])=>oe)).map(Fs).join(" | "),ee=[];for(let oe=1;oe<r.length;oe++){const me=l.parse(r[oe],1+ee.length);if(!me)return null;ee.push(Ja(me.type))}l.error(`Expected arguments of type ${K}, but found (${ee.join(", ")}) instead.`)}return null}static register(r,l){Mo.definitions=l;for(const u in l)r[u]=Mo}}function Fs(c){return Array.isArray(c)?`(${c.map(Ja).join(", ")})`:`(${Ja(c.type)}...)`}class Jo{constructor(r,l,u){this.type=xd,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return l.error("Collator options argument must be an object.");const m=u["case-sensitive"]===void 0?l.parse(!1,1,Zs):l.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Zs);if(!m)return null;const x=u["diacritic-sensitive"]===void 0?l.parse(!1,1,Zs):l.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Zs);if(!x)return null;let w=null;return u.locale&&(w=l.parseObjectValue(u.locale,1,"locale",os),!w)?null:new Jo(m,x,w)}evaluate(r){return new Yt(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function ea(c,r,l=0,u=c.length-1,m=Ua){for(;u>l;){if(u-l>600){const N=u-l+1,U=r-l+1,K=Math.log(N),ee=.5*Math.exp(2*K/3),oe=.5*Math.sqrt(K*ee*(N-ee)/N)*(U-N/2<0?-1:1);ea(c,r,Math.max(l,Math.floor(r-U*ee/N+oe)),Math.min(u,Math.floor(r+(N-U)*ee/N+oe)),m)}const x=c[r];let w=l,M=u;for(So(c,l,r),m(c[u],x)>0&&So(c,l,u);w<M;){for(So(c,w,M),w++,M--;m(c[w],x)<0;)w++;for(;m(c[M],x)>0;)M--}m(c[l],x)===0?So(c,l,M):(M++,So(c,M,u)),M<=r&&(l=M+1),r<=M&&(u=M-1)}}function So(c,r,l){const u=c[r];c[r]=c[l],c[l]=u}function Ua(c,r){return c<r?-1:c>r?1:0}function Ul(c){let r=0;for(let l,u,m=0,x=c.length,w=x-1;m<x;w=m++)l=c[m],u=c[w],r+=(u.x-l.x)*(l.y+u.y);return r}function $l(c,r){c[0]=Math.min(c[0],r[0]),c[1]=Math.min(c[1],r[1]),c[2]=Math.max(c[2],r[0]),c[3]=Math.max(c[3],r[1])}function $a(c,r){return!(c[0]<=r[0]||c[2]>=r[2]||c[1]<=r[1]||c[3]>=r[3])}function Vl(c,r,l){const u=c[0]-r[0],m=c[1]-r[1],x=c[0]-l[0],w=c[1]-l[1];return u*w-x*m==0&&u*x<=0&&m*w<=0}function dl(c,r,l=!1){let u=!1;for(let M=0,N=r.length;M<N;M++){const U=r[M];for(let K=0,ee=U.length,oe=ee-1;K<ee;oe=K++){const me=U[oe],we=U[K];if(Vl(c,me,we))return l;(x=me)[1]>(m=c)[1]!=(w=we)[1]>m[1]&&m[0]<(w[0]-x[0])*(m[1]-x[1])/(w[1]-x[1])+x[0]&&(u=!u)}}var m,x,w;return u}function uh(c,r,l,u){const m=u[0]-l[0],x=u[1]-l[1],w=(c[0]-l[0])*x-m*(c[1]-l[1]),M=(r[0]-l[0])*x-m*(r[1]-l[1]);return w>0&&M<0||w<0&&M>0}function rc(c,r,l,u){return(m=[u[0]-l[0],u[1]-l[1]])[0]*(x=[r[0]-c[0],r[1]-c[1]])[1]-m[1]*x[0]!=0&&!(!uh(c,r,l,u)||!uh(l,u,c,r));var m,x}function Dc(c){const r=new fr(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new fr(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of c[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),l.x<u.x&&(l.x=u.x),l.y<u.y&&(l.y=u.y);return{min:r,max:l}}const Pc=8192;function Zc(c,r){const l=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(l*m*Pc),Math.round(u*m*Pc)]}function or(c,r){for(let l=0;l<r.length;l++)if(dl(c,r[l]))return!0;return!1}function Kr(c,r,l){for(const u of l)for(let m=0,x=u.length,w=x-1;m<x;w=m++)if(rc(c,r,u[w],u[m]))return!0;return!1}function Ur(c,r){for(let l=0;l<c.length;++l)if(!dl(c[l],r))return!1;for(let l=0;l<c.length-1;++l)if(Kr(c[l],c[l+1],r))return!1;return!0}function Kn(c,r){for(let l=0;l<r.length;l++)if(Ur(c,r[l]))return!0;return!1}function As(c,r,l){const u=[];for(let m=0;m<c.length;m++){const x=[];for(let w=0;w<c[m].length;w++){const M=Zc(c[m][w],l);$l(r,M),x.push(M)}u.push(x)}return u}function Xo(c,r,l){const u=[];for(let m=0;m<c.length;m++){const x=As(c[m],r,l);u.push(x)}return u}function pl(c,r,l,u){if(c[0]<l[0]||c[0]>l[2]){const m=.5*u;let x=c[0]-l[0]>m?-u:l[0]-c[0]>m?u:0;x===0&&(x=c[0]-l[2]>m?-u:l[2]-c[0]>m?u:0),c[0]+=x}$l(r,c)}function Fn(c,r,l,u){const m=Math.pow(2,u.z)*Pc,x=[u.x*Pc,u.y*Pc],w=[];if(!c)return w;for(const M of c)for(const N of M){const U=[N.x+x[0],N.y+x[1]];pl(U,r,l,m),w.push(U)}return w}function fs(c,r,l,u){const m=Math.pow(2,u.z)*Pc,x=[u.x*Pc,u.y*Pc],w=[];if(!c)return w;for(const N of c){const U=[];for(const K of N){const ee=[K.x+x[0],K.y+x[1]];$l(r,ee),U.push(ee)}w.push(U)}if(r[2]-r[0]<=m/2){(M=r)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const N of w)for(const U of N)pl(U,r,l,m)}var M;return w}class In{constructor(r,l){this.type=Zs,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Bi(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const x=u.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new In(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new In(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new In(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,u){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(u.type==="Polygon"){const M=As(u.coordinates,x,w),N=Fn(l.geometry(),m,x,w);if(!$a(m,x))return!1;for(const U of N)if(!dl(U,M))return!1}if(u.type==="MultiPolygon"){const M=Xo(u.coordinates,x,w),N=Fn(l.geometry(),m,x,w);if(!$a(m,x))return!1;for(const U of N)if(!or(U,M))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,u){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(u.type==="Polygon"){const M=As(u.coordinates,x,w),N=fs(l.geometry(),m,x,w);if(!$a(m,x))return!1;for(const U of N)if(!Ur(U,M))return!1}if(u.type==="MultiPolygon"){const M=Xo(u.coordinates,x,w),N=fs(l.geometry(),m,x,w);if(!$a(m,x))return!1;for(const U of N)if(!Kn(U,M))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ms={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ho=1/298.257223563,na=ho*(2-ho),ta=Math.PI/180;class Oo{static fromTile(r,l,u){const m=Math.PI*(1-2*(r+.5)/Math.pow(2,l)),x=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/ta;return new Oo(x,u)}static get units(){return Ms}constructor(r,l){if(r===void 0)throw new Error("No latitude given.");if(l&&!Ms[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Ms).join(", ")}`);const u=6378.137*ta*(l?Ms[l]:1),m=Math.cos(r*ta),x=1/(1-na*(1-m*m)),w=Math.sqrt(x);this.kx=u*w*m,this.ky=u*w*x*(1-na)}distance(r,l){const u=fl(r[0]-l[0])*this.kx,m=(r[1]-l[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(r,l){const u=fl(l[0]-r[0])*this.kx;return Math.atan2(u,(l[1]-r[1])*this.ky)/ta}destination(r,l,u){const m=u*ta;return this.offset(r,Math.sin(m)*l,Math.cos(m)*l)}offset(r,l,u){return[r[0]+l/this.kx,r[1]+u/this.ky]}lineDistance(r){let l=0;for(let u=0;u<r.length-1;u++)l+=this.distance(r[u],r[u+1]);return l}area(r){let l=0;for(let u=0;u<r.length;u++){const m=r[u];for(let x=0,w=m.length,M=w-1;x<w;M=x++)l+=fl(m[x][0]-m[M][0])*(m[x][1]+m[M][1])*(u?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(r,l){let u=0;if(l<=0)return r[0];for(let m=0;m<r.length-1;m++){const x=r[m],w=r[m+1],M=this.distance(x,w);if(u+=M,u>l)return To(x,w,(l-(u-M))/M)}return r[r.length-1]}pointToSegmentDistance(r,l,u){let[m,x]=l,w=fl(u[0]-m)*this.kx,M=(u[1]-x)*this.ky;if(w!==0||M!==0){const N=(fl(r[0]-m)*this.kx*w+(r[1]-x)*this.ky*M)/(w*w+M*M);N>1?(m=u[0],x=u[1]):N>0&&(m+=w/this.kx*N,x+=M/this.ky*N)}return w=fl(r[0]-m)*this.kx,M=(r[1]-x)*this.ky,Math.sqrt(w*w+M*M)}pointOnLine(r,l){let u=1/0,m=r[0][0],x=r[0][1],w=0,M=0;for(let N=0;N<r.length-1;N++){let U=r[N][0],K=r[N][1],ee=fl(r[N+1][0]-U)*this.kx,oe=(r[N+1][1]-K)*this.ky,me=0;ee===0&&oe===0||(me=(fl(l[0]-U)*this.kx*ee+(l[1]-K)*this.ky*oe)/(ee*ee+oe*oe),me>1?(U=r[N+1][0],K=r[N+1][1]):me>0&&(U+=ee/this.kx*me,K+=oe/this.ky*me)),ee=fl(l[0]-U)*this.kx,oe=(l[1]-K)*this.ky;const we=ee*ee+oe*oe;we<u&&(u=we,m=U,x=K,w=N,M=me)}return{point:[m,x],index:w,t:Math.max(0,Math.min(1,M))}}lineSlice(r,l,u){let m=this.pointOnLine(u,r),x=this.pointOnLine(u,l);if(m.index>x.index||m.index===x.index&&m.t>x.t){const U=m;m=x,x=U}const w=[m.point],M=m.index+1,N=x.index;!Io(u[M],w[0])&&M<=N&&w.push(u[M]);for(let U=M+1;U<=N;U++)w.push(u[U]);return Io(u[N],x.point)||w.push(x.point),w}lineSliceAlong(r,l,u){let m=0;const x=[];for(let w=0;w<u.length-1;w++){const M=u[w],N=u[w+1],U=this.distance(M,N);if(m+=U,m>r&&x.length===0&&x.push(To(M,N,(r-(m-U))/U)),m>=l)return x.push(To(M,N,(l-(m-U))/U)),x;m>r&&x.push(N)}return x}bufferPoint(r,l){const u=l/this.ky,m=l/this.kx;return[r[0]-m,r[1]-u,r[0]+m,r[1]+u]}bufferBBox(r,l){const u=l/this.ky,m=l/this.kx;return[r[0]-m,r[1]-u,r[2]+m,r[3]+u]}insideBBox(r,l){return fl(r[0]-l[0])>=0&&fl(r[0]-l[2])<=0&&r[1]>=l[1]&&r[1]<=l[3]}}function Io(c,r){return c[0]===r[0]&&c[1]===r[1]}function To(c,r,l){const u=fl(r[0]-c[0]);return[c[0]+u*l,c[1]+(r[1]-c[1])*l]}function fl(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class rl{constructor(r=[],l=(u,m)=>u<m?-1:u>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:u}=this,m=l[r];for(;r>0;){const x=r-1>>1,w=l[x];if(u(m,w)>=0)break;l[r]=w,r=x}l[r]=m}_down(r){const{data:l,compare:u}=this,m=this.length>>1,x=l[r];for(;r<m;){let w=1+(r<<1);const M=w+1;if(M<this.length&&u(l[M],l[w])<0&&(w=M),u(l[w],x)>=0)break;l[r]=l[w],r=w}l[r]=x}}var mr=8192;function Tl(c,r){return r.dist-c.dist}const Vo=100,Kc=50;function uc(c){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==c.length)return!1;for(let l=0;l<r.length;l++)if(r[l]!==c[l])return!1;return!0}function dc(c){return c[1]-c[0]+1}function Qc(c,r){const l=c[1]>=c[0]&&c[1]<r;return l||console.warn("Distance Expression: Index is out of range"),l}function bd(c,r){if(c[0]>c[1])return[null,null];const l=dc(c);if(r){if(l===2)return[c,null];const u=Math.floor(l/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(l===1)return[c,null];const u=Math.floor(l/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Jc(c,r){const l=[1/0,1/0,-1/0,-1/0];if(!Qc(r,c.length))return l;for(let u=r[0];u<=r[1];++u)$l(l,c[u]);return l}function ws(c){const r=[1/0,1/0,-1/0,-1/0];for(let l=0;l<c.length;++l)for(let u=0;u<c[l].length;++u)$l(r,c[l][u]);return r}function qu(c,r,l){if(uc(c)||uc(r))return NaN;let u=0,m=0;return c[2]<r[0]&&(u=r[0]-c[2]),c[0]>r[2]&&(u=c[0]-r[2]),c[1]>r[3]&&(m=c[1]-r[3]),c[3]<r[1]&&(m=r[1]-c[3]),l.distance([0,0],[u,m])}function Pp(c){return 360*c-180}function ga(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function cf(c,r){const l=Math.pow(2,r.z),u=(c.y/mr+r.y)/l;return[Pp((c.x/mr+r.x)/l),ga(u)]}function Eh(c,r){const l=[];for(let u=0;u<c.length;++u)l.push(cf(c[u],r));return l}function uo(c,r,l){const u=l.pointOnLine(r,c).point;return l.distance(c,u)}function Wl(c,r,l,u,m){const x=l.slice(u[0],u[1]+1);let w=1/0;for(let M=r[0];M<=r[1];++M)if((w=Math.min(w,uo(c[M],x,m)))===0)return 0;return w}function Kg(c,r,l,u,m){const x=Math.min(m.pointToSegmentDistance(c,l,u),m.pointToSegmentDistance(r,l,u)),w=Math.min(m.pointToSegmentDistance(l,c,r),m.pointToSegmentDistance(u,c,r));return Math.min(x,w)}function k0(c,r,l,u,m){if(!Qc(r,c.length)||!Qc(u,l.length))return NaN;let x=1/0;for(let w=r[0];w<r[1];++w)for(let M=u[0];M<u[1];++M){if(rc(c[w],c[w+1],l[M],l[M+1]))return 0;x=Math.min(x,Kg(c[w],c[w+1],l[M],l[M+1],m))}return x}function hf(c,r,l,u,m){if(!Qc(r,c.length)||!Qc(u,l.length))return NaN;let x=1/0;for(let w=r[0];w<=r[1];++w)for(let M=u[0];M<=u[1];++M)if((x=Math.min(x,m.distance(c[w],l[M])))===0)return x;return x}function Wf(c,r,l){if(dl(c,r,!0))return 0;let u=1/0;for(const m of r){const x=m.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[x-1]&&(u=Math.min(u,l.pointToSegmentDistance(c,m[x-1],m[0])))===0||(u=Math.min(u,uo(c,m,l)))===0)return u}return u}function pc(c,r,l,u){if(!Qc(r,c.length))return NaN;for(let x=r[0];x<=r[1];++x)if(dl(c[x],l,!0))return 0;let m=1/0;for(let x=r[0];x<r[1];++x)for(const w of l)for(let M=0,N=w.length,U=N-1;M<N;U=M++){if(rc(c[x],c[x+1],w[U],w[M]))return 0;m=Math.min(m,Kg(c[x],c[x+1],w[U],w[M],u))}return m}function Qg(c,r){for(const l of c)for(let u=0;u<=l.length-1;++u)if(dl(l[u],r,!0))return!0;return!1}function A0(c,r,l,u=1/0){const m=ws(c),x=ws(r);if(u!==1/0&&qu(m,x,l)>=u)return u;if($a(m,x)){if(Qg(c,r))return 0}else if(Qg(r,c))return 0;let w=u;for(const M of c)for(let N=0,U=M.length,K=U-1;N<U;K=N++)for(const ee of r)for(let oe=0,me=ee.length,we=me-1;oe<me;we=oe++){if(rc(M[K],M[N],ee[we],ee[oe]))return 0;w=Math.min(w,Kg(M[K],M[N],ee[we],ee[oe],l))}return w}function jf(c,r,l,u,m,x,w){if(x===null||w===null)return;const M=qu(Jc(u,x),Jc(m,w),l);M<r&&c.push({dist:M,range1:x,range2:w})}function Es(c,r,l,u,m=1/0){let x=Math.min(u.distance(c[0],l[0][0]),m);if(x===0)return x;const w=new rl([{dist:0,range1:[0,c.length-1],range2:[0,0]}],Tl),M=r?Kc:Vo,N=ws(l);for(;w.length;){const U=w.pop();if(U.dist>=x)continue;const K=U.range1;if(dc(K)<=M){if(!Qc(K,c.length))return NaN;if(r){const ee=pc(c,K,l,u);if((x=Math.min(x,ee))===0)return x}else for(let ee=K[0];ee<=K[1];++ee){const oe=Wf(c[ee],l,u);if((x=Math.min(x,oe))===0)return x}}else{const ee=bd(K,r);if(ee[0]!==null){const oe=qu(Jc(c,ee[0]),N,u);oe<x&&w.push({dist:oe,range1:ee[0],range2:[0,0]})}if(ee[1]!==null){const oe=qu(Jc(c,ee[1]),N,u);oe<x&&w.push({dist:oe,range1:ee[1],range2:[0,0]})}}}return x}function Ro(c,r,l,u,m,x=1/0){let w=Math.min(x,m.distance(c[0],l[0]));if(w===0)return w;const M=new rl([{dist:0,range1:[0,c.length-1],range2:[0,l.length-1]}],Tl),N=r?Kc:Vo,U=u?Kc:Vo;for(;M.length;){const K=M.pop();if(K.dist>=w)continue;const ee=K.range1,oe=K.range2;if(dc(ee)<=N&&dc(oe)<=U){if(!Qc(ee,c.length)||!Qc(oe,l.length))return NaN;if(r&&u?w=Math.min(w,k0(c,ee,l,oe,m)):r||u?r&&!u?w=Math.min(w,Wl(l,oe,c,ee,m)):!r&&u&&(w=Math.min(w,Wl(c,ee,l,oe,m))):w=Math.min(w,hf(c,ee,l,oe,m)),w===0)return w}else{const me=bd(ee,r),we=bd(oe,u);jf(M,w,m,c,l,me[0],we[0]),jf(M,w,m,c,l,me[0],we[1]),jf(M,w,m,c,l,me[1],we[0]),jf(M,w,m,c,l,me[1],we[1])}}return w}function eh(c,r,l,u,m=1/0){let x=m;const w=Jc(c,[0,c.length-1]);for(const M of l)if(!(x!==1/0&&qu(w,Jc(M,[0,M.length-1]),u)>=x)&&(x=Math.min(x,Ro(c,r,M,!0,u,x)),x===0))return x;return x}function gg(c,r,l,u,m=1/0){let x=m;const w=Jc(c,[0,c.length-1]);for(const M of l){if(x!==1/0&&qu(w,ws(M),u)>=x)continue;const N=Es(c,r,M,u,x);if(isNaN(N))return N;if((x=Math.min(x,N))===0)return x}return x}function uf(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class fo{constructor(r,l){this.type=vn,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(Bi(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(uf(u.features[m].geometry.type))return new fo(u,u.features[m].geometry)}else if(u.type==="Feature"){if(uf(u.geometry.type))return new fo(u,u.geometry)}else if(uf(u.type))return new fo(u,u)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const l=r.geometry(),u=r.canonicalID();if(l!=null&&u!=null){if(r.geometryType()==="Point")return function(m,x,w){const M=[];for(const U of m)for(const K of U)M.push(cf(K,x));const N=new Oo(M[0][1],"meters");return w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString"?Ro(M,!1,w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",N):w.type==="MultiLineString"?eh(M,!1,w.coordinates,N):w.type==="Polygon"||w.type==="MultiPolygon"?gg(M,!1,w.type==="Polygon"?[w.coordinates]:w.coordinates,N):null}(l,u,this.geometries);if(r.geometryType()==="LineString")return function(m,x,w){const M=[];for(const U of m){const K=[];for(const ee of U)K.push(cf(ee,x));M.push(K)}const N=new Oo(M[0][0][1],"meters");if(w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString")return eh(w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",M,N);if(w.type==="MultiLineString"){let U=1/0;for(let K=0;K<w.coordinates.length;K++){const ee=eh(w.coordinates[K],!0,M,N,U);if(isNaN(ee))return ee;if((U=Math.min(U,ee))===0)return U}return U}if(w.type==="Polygon"||w.type==="MultiPolygon"){let U=1/0;for(let K=0;K<M.length;K++){const ee=gg(M[K],!0,w.type==="Polygon"?[w.coordinates]:w.coordinates,N,U);if(isNaN(ee))return ee;if((U=Math.min(U,ee))===0)return U}return U}return null}(l,u,this.geometries);if(r.geometryType()==="Polygon")return function(m,x,w){const M=[];for(const U of function(K,ee){const oe=K.length;if(oe<=1)return[K];const me=[];let we,Le;for(let ze=0;ze<oe;ze++){const qe=Ul(K[ze]);qe!==0&&(K[ze].area=Math.abs(qe),Le===void 0&&(Le=qe<0),Le===qe<0?(we&&me.push(we),we=[K[ze]]):we.push(K[ze]))}return we&&me.push(we),me}(m)){const K=[];for(let ee=0;ee<U.length;++ee)K.push(Eh(U[ee],x));M.push(K)}const N=new Oo(M[0][0][0][1],"meters");if(w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString")return gg(w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",M,N);if(w.type==="MultiLineString"){let U=1/0;for(let K=0;K<w.coordinates.length;K++){const ee=gg(w.coordinates[K],!0,M,N,U);if(isNaN(ee))return ee;if((U=Math.min(U,ee))===0)return U}return U}return w.type==="Polygon"||w.type==="MultiPolygon"?function(U,K,ee){let oe=1/0;for(const me of U)for(const we of K){const Le=A0(me,we,ee,oe);if(isNaN(Le))return Le;if((oe=Math.min(oe,Le))===0)return oe}return oe}(w.type==="Polygon"?[w.coordinates]:w.coordinates,M,N):null}(l,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ml(c){if(c instanceof Mo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof In||c instanceof fo)return!1;if(c instanceof Np)return c.featureConstant;let r=!0;return c.eachChild(l=>{r&&!ml(l)&&(r=!1)}),r}function Hf(c){if(c instanceof Mo&&c.name==="feature-state")return!1;let r=!0;return c.eachChild(l=>{r&&!Hf(l)&&(r=!1)}),r}function df(c){if(c instanceof Np)return new Set([c.key]);let r=new Set;return c.eachChild(l=>{r=new Set([...r,...df(l)])}),r}function Op(c,r){if(c instanceof Mo&&r.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(u=>{l&&!Op(u,r)&&(l=!1)}),l}function zs(c,r,l){return[c,r,l].filter(Boolean).join("")}function Yu(c,r){switch(c){case"string":return qr(r);case"number":return+r;case"boolean":return!!r;case"color":return ao.parse(r);case"formatted":return yi.fromString(qr(r));case"resolvedImage":return Li.build(qr(r))}return r}function Rp(c,r,l,u){return u!==void 0&&(c=u*Math.round(c/u)),r!==void 0&&c<r&&(c=r),l!==void 0&&c>l&&(c=l),c}class Np{constructor(r,l,u,m=!1){this.type=r,this.key=l,this.scope=u,this.featureConstant=m}static parse(r,l){let u=l.expectedType;if(u==null&&(u=Ks),r.length<2||r.length>3)return l.error("Invalid number of arguments for 'config' expression.");const m=l.parse(r[1],1);if(!(m instanceof sr))return l.error("Key name of 'config' expression must be a string literal.");let x,w=!0;const M=qr(m.value);if(r.length>=3){const N=l.parse(r[2],2);if(!(N instanceof sr))return l.error("Scope of 'config' expression must be a string literal.");x=qr(N.value)}if(l.options){const N=zs(M,x,l._scope),U=l.options.get(N);U&&(w=ml(U.value||U.default))}return new Np(u,M,x,w)}evaluate(r){const l=zs(this.key,this.scope,r.scope),u=r.getConfig(l);if(!u)return null;const{type:m,value:x,values:w,minValue:M,maxValue:N,stepValue:U}=u,K=u.default.evaluate(r);let ee=K;if(x){const oe=r.scope;r.scope=(oe||"").split("").slice(1).join(""),ee=x.evaluate(r),r.scope=oe}return m&&(ee=Yu(m,ee)),ee===void 0||M===void 0&&N===void 0&&U===void 0||(typeof ee=="number"?ee=Rp(ee,M,N,U):Array.isArray(ee)&&(ee=ee.map(oe=>typeof oe=="number"?Rp(oe,M,N,U):oe))),x!==void 0&&ee!==void 0&&w&&!w.includes(ee)&&(ee=K,m&&(ee=Yu(m,ee))),(m&&m!==this.type||ee!==void 0&&!vt(Gt(ee),this.type))&&(ee=Yu(this.type.kind,ee)),ee}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class wd{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const u=r[1];return l.scope.has(u)?new wd(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class No{constructor(r,l=[],u,m=new Zl,x=[],w,M){this.registry=r,this.path=l,this.key=l.map(N=>typeof N=="string"?`['${N}']`:`[${N}]`).join(""),this.scope=m,this.errors=x,this.expectedType=u,this._scope=w,this.options=M}parse(r,l,u,m,x={}){return l||u?this.concat(l,null,u,m)._parse(r,x):this._parse(r,x)}parseObjectValue(r,l,u,m,x,w={}){return this.concat(l,u,m,x)._parse(r,w)}_parse(r,l){function u(m,x,w){return w==="assert"?new hi(x,[m]):w==="coerce"?new ro(x,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(m){let x=m.parse(r,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,M=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||M.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(w,M))return null}else x=u(x,w,l.typeAnnotation||"coerce");else x=u(x,w,l.typeAnnotation||"assert")}if(!(x instanceof sr)&&x.type.kind!=="resolvedImage"&&Cm(x)){const w=new el(this._scope,this.options);try{x=new sr(x.type,x.evaluate(w))}catch(M){return this.error(M.message),null}}return x}return ro.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,u,m){let x=typeof r=="number"?this.path.concat(r):this.path;x=typeof l=="string"?x.concat(l):x;const w=m?this.scope.concat(m):this.scope;return new No(this.registry,x,u||null,w,this.errors,this._scope,this.options)}error(r,...l){const u=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new Qa(u,r))}checkSubtype(r,l){const u=zh(r,l);return u&&this.error(u),u}}function Cm(c){if(c instanceof wd)return Cm(c.boundExpression);if(c instanceof Mo&&c.name==="error"||c instanceof Jo||c instanceof In||c instanceof fo||c instanceof Np)return!1;const r=c instanceof ro||c instanceof hi;let l=!0;return c.eachChild(u=>{l=r?l&&Cm(u):l&&u instanceof sr}),!!l&&ml(c)&&Op(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function yg(c,r){const l=c.length-1;let u,m,x=0,w=l,M=0;for(;x<=w;)if(M=Math.floor((x+w)/2),u=c[M],m=c[M+1],u<=r){if(M===l||r<m)return M;x=M+1}else{if(!(u>r))throw new Qi("Input is not a number.");w=M-1}return 0}class _g{constructor(r,l,u){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[m,x]of u)this.labels.push(m),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(r[1],1,vn);if(!u)return null;const m=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let w=1;w<r.length;w+=2){const M=w===1?-1/0:r[w],N=r[w+1],U=w,K=w+1;if(typeof M!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(m.length&&m[m.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const ee=l.parse(N,K,x);if(!ee)return null;x=x||ee.type,m.push([M,ee])}return new _g(x,u,m)}evaluate(r){const l=this.labels,u=this.outputs;if(l.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return u[0].evaluate(r);const x=l.length;return m>=l[x-1]?u[x-1].evaluate(r):u[yg(l,m)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}const M0=.95047,Em=1.08883,wu=4/29,Bp=6/29,zt=3*Bp*Bp,Gf=Bp*Bp*Bp,qf=Math.PI/180,Su=180/Math.PI;function wa(c){return c>Gf?Math.pow(c,1/3):c/zt+wu}function Xu(c){return c>Bp?c*c*c:zt*(c-wu)}function Jg(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function pf(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Fp(c){const r=pf(c.r),l=pf(c.g),u=pf(c.b),m=wa((.4124564*r+.3575761*l+.1804375*u)/M0),x=wa((.2126729*r+.7151522*l+.072175*u)/1);return{l:116*x-16,a:500*(m-x),b:200*(x-wa((.0193339*r+.119192*l+.9503041*u)/Em)),alpha:c.a}}function ey(c){let r=(c.l+16)/116,l=isNaN(c.a)?r:r+c.a/500,u=isNaN(c.b)?r:r-c.b/200;return r=1*Xu(r),l=M0*Xu(l),u=Em*Xu(u),new ao(Jg(3.2404542*l-1.5371385*r-.4985314*u),Jg(-.969266*l+1.8760108*r+.041556*u),Jg(.0556434*l-.2040259*r+1.0572252*u),c.alpha)}function I0(c,r,l){const u=r-c;return c+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Yf={forward:Fp,reverse:ey,interpolate:function(c,r,l){return{l:kn(c.l,r.l,l),a:kn(c.a,r.a,l),b:kn(c.b,r.b,l),alpha:kn(c.alpha,r.alpha,l)}}},dp={forward:function(c){const{l:r,a:l,b:u}=Fp(c),m=Math.atan2(u,l)*Su;return{h:m<0?m+360:m,c:Math.sqrt(l*l+u*u),l:r,alpha:c.a}},reverse:function(c){const r=c.h*qf,l=c.c;return ey({l:c.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:c.alpha})},interpolate:function(c,r,l){return{h:I0(c.h,r.h,l),c:kn(c.c,r.c,l),l:kn(c.l,r.l,l),alpha:kn(c.alpha,r.alpha,l)}}};var zy=Object.freeze({__proto__:null,hcl:dp,lab:Yf});class Oc{constructor(r,l,u,m,x){this.type=r,this.operator=l,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[w,M]of x)this.labels.push(w),this.outputs.push(M)}static interpolationFactor(r,l,u,m){let x=0;if(r.name==="exponential")x=Zu(l,r.base,u,m);else if(r.name==="linear")x=Zu(l,1,u,m);else if(r.name==="cubic-bezier"){const w=r.controlPoints;x=new Yn(w[0],w[1],w[2],w[3]).solve(Zu(l,1,u,m))}return x}static parse(r,l){let[u,m,x,...w]=r;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const U=m[1];if(typeof U!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:U}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const U=m.slice(1);if(U.length!==4||U.some(K=>typeof K!="number"||K<0||K>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:U}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,vn),!x)return null;const M=[];let N=null;u==="interpolate-hcl"||u==="interpolate-lab"?N=zl:l.expectedType&&l.expectedType.kind!=="value"&&(N=l.expectedType);for(let U=0;U<w.length;U+=2){const K=w[U],ee=w[U+1],oe=U+3,me=U+4;if(typeof K!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(M.length&&M[M.length-1][0]>=K)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);const we=l.parse(ee,me,N);if(!we)return null;N=N||we.type,M.push([K,we])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new Oc(N,u,m,x,M):l.error(`Type ${Ja(N)} is not interpolatable.`)}evaluate(r){const l=this.labels,u=this.outputs;if(l.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return u[0].evaluate(r);const x=l.length;if(m>=l[x-1])return u[x-1].evaluate(r);const w=yg(l,m),M=Oc.interpolationFactor(this.interpolation,m,l[w],l[w+1]),N=u[w].evaluate(r),U=u[w+1].evaluate(r);return this.operator==="interpolate"?ic[this.type.kind.toLowerCase()](N,U,M):this.operator==="interpolate-hcl"?dp.reverse(dp.interpolate(dp.forward(N),dp.forward(U),M)):Yf.reverse(Yf.interpolate(Yf.forward(N),Yf.forward(U),M))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Zu(c,r,l,u){const m=u-l,x=c-l;return m===0?0:r===1?x/m:(Math.pow(r,x)-1)/(Math.pow(r,m)-1)}class vg{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let u=null;const m=l.expectedType;m&&m.kind!=="value"&&(u=m);const x=[];for(const M of r.slice(1)){const N=l.parse(M,1+x.length,u,void 0,{typeAnnotation:"omit"});if(!N)return null;u=u||N.type,x.push(N)}const w=m&&x.some(M=>zh(m,M.type));return new vg(w?Ks:u,x)}evaluate(r){let l,u=null,m=0;for(const x of this.args){if(m++,u=x.evaluate(r),u&&u instanceof Li&&!u.available&&(l||(l=u),u=null,m===this.args.length))return l;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class xg{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let x=1;x<r.length-1;x+=2){const w=r[x];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const M=l.parse(r[x+1],x+1);if(!M)return null;u.push([w,M])}const m=l.parse(r[r.length-1],r.length-1,l.expectedType,u);return m?new xg(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,u]of this.bindings)r.push(l,u.serialize());return r.push(this.result.serialize()),r}}class Uy{constructor(r,l,u){this.type=r,this.index=l,this.input=u}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,vn),m=l.parse(r[2],2,Sl(l.expectedType||Ks));return u&&m?new Uy(m.type.itemType,u,m):null}evaluate(r){const l=this.index.evaluate(r),u=this.input.evaluate(r);if(l<0)throw new Qi(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Qi(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Qi(`Array index must be an integer, but found ${l} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ty{constructor(r,l,u){this.type=r,this.index=l,this.input=u}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,vn),m=l.parse(r[2],2,Sl(l.expectedType||Ks));return u&&m?new ty(m.type.itemType,u,m):null}evaluate(r){const l=this.index.evaluate(r),u=this.input.evaluate(r);if(l<0)throw new Qi(`Array index out of bounds: ${l} < 0.`);if(l>u.length-1)throw new Qi(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l===Math.floor(l))return u[l];const m=Math.floor(l),x=Math.ceil(l),w=u[m],M=u[x];if(typeof w!="number"||typeof M!="number")throw new Qi(`Cannot interpolate between non-number values at index ${l}.`);const N=l-m;return w*(1-N)+M*N}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Sd{constructor(r,l){this.type=Zs,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ks),m=l.parse(r[2],2,Ks);return u&&m?Ch(u.type,[Zs,os,vn,$c,Ks])?new Sd(u,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ja(u.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!hh(l,["boolean","string","number","null"]))throw new Qi(`Expected first argument to be of type boolean, string, number or null, but found ${Ja(Gt(l))} instead.`);if(!hh(u,["string","array"]))throw new Qi(`Expected second argument to be of type array or string, but found ${Ja(Gt(u))} instead.`);return u.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pp{constructor(r,l,u){this.type=vn,this.needle=r,this.haystack=l,this.fromIndex=u}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ks),m=l.parse(r[2],2,Ks);if(!u||!m)return null;if(!Ch(u.type,[Zs,os,vn,$c,Ks]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ja(u.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,vn);return x?new pp(u,m,x):null}return new pp(u,m)}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!hh(l,["boolean","string","number","null"]))throw new Qi(`Expected first argument to be of type boolean, string, number or null, but found ${Ja(Gt(l))} instead.`);if(!hh(u,["string","array"]))throw new Qi(`Expected second argument to be of type array or string, but found ${Ja(Gt(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return u.indexOf(l,m)}return u.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fp{constructor(r,l,u,m,x,w){this.inputType=r,this.type=l,this.input=u,this.cases=m,this.outputs=x,this.otherwise=w}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let u,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);const x={},w=[];for(let U=2;U<r.length-1;U+=2){let K=r[U];const ee=r[U+1];Array.isArray(K)||(K=[K]);const oe=l.concat(U);if(K.length===0)return oe.error("Expected at least one branch label.");for(const we of K){if(typeof we!="number"&&typeof we!="string")return oe.error("Branch labels must be numbers or strings.");if(typeof we=="number"&&Math.abs(we)>Number.MAX_SAFE_INTEGER)return oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof we=="number"&&Math.floor(we)!==we)return oe.error("Numeric branch labels must be integer values.");if(u){if(oe.checkSubtype(u,Gt(we)))return null}else u=Gt(we);if(x[String(we)]!==void 0)return oe.error("Branch labels must be unique.");x[String(we)]=w.length}const me=l.parse(ee,U,m);if(!me)return null;m=m||me.type,w.push(me)}const M=l.parse(r[1],1,Ks);if(!M)return null;const N=l.parse(r[r.length-1],r.length-1,m);return N?M.type.kind!=="value"&&l.concat(1).checkSubtype(u,M.type)?null:new fp(u,m,M,x,w,N):null}evaluate(r){const l=this.input.evaluate(r);return(vt(Gt(l),this.inputType)&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],m={};for(const w of l){const M=m[this.cases[w]];M===void 0?(m[this.cases[w]]=u.length,u.push([this.cases[w],[w]])):u[M][1].push(w)}const x=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,M]of u)r.push(M.length===1?x(M[0]):M.map(x)),r.push(this.outputs[w].serialize());return r.push(this.otherwise.serialize()),r}}class $y{constructor(r,l,u){this.type=r,this.branches=l,this.otherwise=u}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&l.expectedType.kind!=="value"&&(u=l.expectedType);const m=[];for(let w=1;w<r.length-1;w+=2){const M=l.parse(r[w],w,Zs);if(!M)return null;const N=l.parse(r[w+1],w+1,u);if(!N)return null;m.push([M,N]),u=u||N.type}const x=l.parse(r[r.length-1],r.length-1,u);return x?new $y(u,m,x):null}evaluate(r){for(const[l,u]of this.branches)if(l.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,u]of this.branches)r(l),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class km{constructor(r,l,u,m){this.type=r,this.input=l,this.beginIndex=u,this.endIndex=m}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ks),m=l.parse(r[2],2,vn);if(!u||!m)return null;if(!Ch(u.type,[Sl(Ks),os,Ks]))return l.error(`Expected first argument to be of type array or string, but found ${Ja(u.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,vn);return x?new km(u.type,u,m,x):null}return new km(u.type,u,m)}evaluate(r){const l=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!hh(l,["string","array"]))throw new Qi(`Expected first argument to be of type array or string, but found ${Ja(Gt(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return l.slice(u,m)}return l.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function iy(c,r){return c==="=="||c==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function zp(c,r,l,u){return u.compare(r,l)===0}function ff(c,r,l){const u=c!=="=="&&c!=="!=";return class m${constructor(x,w,M){this.type=Zs,this.lhs=x,this.rhs=w,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const M=x[0];let N=w.parse(x[1],1,Ks);if(!N)return null;if(!iy(M,N.type))return w.concat(1).error(`"${M}" comparisons are not supported for type '${Ja(N.type)}'.`);let U=w.parse(x[2],2,Ks);if(!U)return null;if(!iy(M,U.type))return w.concat(2).error(`"${M}" comparisons are not supported for type '${Ja(U.type)}'.`);if(N.type.kind!==U.type.kind&&N.type.kind!=="value"&&U.type.kind!=="value")return w.error(`Cannot compare types '${Ja(N.type)}' and '${Ja(U.type)}'.`);u&&(N.type.kind==="value"&&U.type.kind!=="value"?N=new hi(U.type,[N]):N.type.kind!=="value"&&U.type.kind==="value"&&(U=new hi(N.type,[U])));let K=null;if(x.length===4){if(N.type.kind!=="string"&&U.type.kind!=="string"&&N.type.kind!=="value"&&U.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(K=w.parse(x[3],3,xd),!K)return null}return new m$(N,U,K)}evaluate(x){const w=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(u&&this.hasUntypedArgument){const N=Gt(w),U=Gt(M);if(N.kind!==U.kind||N.kind!=="string"&&N.kind!=="number")throw new Qi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${N.kind}, ${U.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const N=Gt(w),U=Gt(M);if(N.kind!=="string"||U.kind!=="string")return r(x,w,M)}return this.collator?l(x,w,M,this.collator.evaluate(x)):r(x,w,M)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[c];return this.eachChild(w=>{x.push(w.serialize())}),x}}}const L0=ff("==",function(c,r,l){return r===l},zp),$d=ff("!=",function(c,r,l){return r!==l},function(c,r,l,u){return!zp(0,r,l,u)}),Vy=ff("<",function(c,r,l){return r<l},function(c,r,l,u){return u.compare(r,l)<0}),Am=ff(">",function(c,r,l){return r>l},function(c,r,l,u){return u.compare(r,l)>0}),mp=ff("<=",function(c,r,l){return r<=l},function(c,r,l,u){return u.compare(r,l)<=0}),C_=ff(">=",function(c,r,l){return r>=l},function(c,r,l,u){return u.compare(r,l)>=0});class Mm{constructor(r,l,u,m,x,w){this.type=os,this.number=r,this.locale=l,this.currency=u,this.unit=m,this.minFractionDigits=x,this.maxFractionDigits=w}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const u=l.parse(r[1],1,vn);if(!u)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let x=null;if(m.locale&&(x=l.parseObjectValue(m.locale,2,"locale",os),!x))return null;let w=null;if(m.currency&&(w=l.parseObjectValue(m.currency,2,"currency",os),!w))return null;let M=null;if(m.unit&&(M=l.parseObjectValue(m.unit,2,"unit",os),!M))return null;let N=null;if(m["min-fraction-digits"]&&(N=l.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",vn),!N))return null;let U=null;return m["max-fraction-digits"]&&(U=l.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",vn),!U)?null:new Mm(u,x,w,M,N,U)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Im{constructor(r){this.type=vn,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=l.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Ja(u.type)} instead.`):new Im(u):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Qi(`Expected value to be of type string or array, but found ${Ja(Gt(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}function Lm(c){return function(){c=1831565813+(c|=0)|0;let r=Math.imul(c^c>>>15,1|c);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const mf={"==":L0,"!=":$d,">":Am,"<":Vy,">=":C_,"<=":mp,array:hi,at:Uy,"at-interpolated":ty,boolean:hi,case:$y,coalesce:vg,collator:Jo,format:Pn,image:as,in:Sd,"index-of":pp,interpolate:Oc,"interpolate-hcl":Oc,"interpolate-lab":Oc,length:Im,let:xg,literal:sr,match:fp,number:hi,"number-format":Mm,object:hi,slice:km,step:_g,string:hi,"to-boolean":ro,"to-color":ro,"to-number":ro,"to-string":ro,var:wd,within:In,distance:fo,config:Np};function Wy(c,[r,l,u,m]){r=r.evaluate(c),l=l.evaluate(c),u=u.evaluate(c);const x=m?m.evaluate(c):1,w=Tr(r,l,u,x);if(w)throw new Qi(w);return new ao(r/255,l/255,u/255,x)}function bg(c,[r,l,u,m]){r=r.evaluate(c),l=l.evaluate(c),u=u.evaluate(c);const x=m?m.evaluate(c):1,w=function(U,K,ee,oe){return typeof U=="number"&&U>=0&&U<=360?typeof K=="number"&&K>=0&&K<=100&&typeof ee=="number"&&ee>=0&&ee<=100?oe===void 0||typeof oe=="number"&&oe>=0&&oe<=1?null:`Invalid hsla value [${[U,K,ee,oe].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof oe=="number"?[U,K,ee,oe]:[U,K,ee]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof oe=="number"?[U,K,ee,oe]:[U,K,ee]).join(", ")}]: 'h' must be between 0 and 360.`}(r,l,u,x);if(w)throw new Qi(w);const M=`hsla(${r}, ${l}%, ${u}%, ${x})`,N=ao.parse(M);if(!N)throw new Qi(`Failed to parse HSLA color: ${M}`);return N}function gf(c,r){return c in r}function Vd(c,r){const l=r[c];return l===void 0?null:l}function Td(c){return{type:c}}function jy(c){return{result:"success",value:c}}function Ku(c){return{result:"error",value:c}}function Tu(c,r){return!!c&&!!c.parameters&&c.parameters.indexOf(r)>-1}function Up(c){return c["property-type"]==="data-driven"}function gp(c){return Tu(c.expression,"measure-light")}function Cu(c){return Tu(c.expression,"zoom")}function Cd(c){return!!c.expression&&c.expression.interpolated}function $p(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function ry(c){return c}function Qu(c,r){const l=r.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),x=c.type||(Cd(r)?"exponential":"interval");if(l&&((c=wl({},c)).stops&&(c.stops=c.stops.map(U=>[U[0],ao.parse(U[1])])),c.default=ao.parse(c.default?c.default:r.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!zy[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let w,M,N;if(x==="exponential")w=yp;else if(x==="interval")w=Hy;else if(x==="categorical"){w=Dm,M=Object.create(null);for(const U of c.stops)M[U[0]]=U[1];N=typeof c.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);w=yf}if(u){const U={},K=[];for(let me=0;me<c.stops.length;me++){const we=c.stops[me],Le=we[0].zoom;U[Le]===void 0&&(U[Le]={zoom:Le,type:c.type,property:c.property,default:c.default,stops:[]},K.push(Le)),U[Le].stops.push([we[0].value,we[1]])}const ee=[];for(const me of K)ee.push([U[me].zoom,Qu(U[me],r)]);const oe={name:"linear"};return{kind:"composite",interpolationType:oe,interpolationFactor:Oc.interpolationFactor.bind(void 0,oe),zoomStops:ee.map(me=>me[0]),evaluate:({zoom:me},we)=>yp({stops:ee,base:c.base},r,me).evaluate(me,we)}}if(m){const U=x==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:Oc.interpolationFactor.bind(void 0,U),zoomStops:c.stops.map(K=>K[0]),evaluate:({zoom:K})=>w(c,r,K,M,N)}}return{kind:"source",evaluate(U,K){const ee=K&&K.properties?K.properties[c.property]:void 0;return ee===void 0?gh(c.default,r.default):w(c,r,ee,M,N)}}}function gh(c,r,l){return c!==void 0?c:r!==void 0?r:l!==void 0?l:void 0}function Dm(c,r,l,u,m){return gh(typeof l===m?u[l]:void 0,c.default,r.default)}function Hy(c,r,l){if(Yo(l)!=="number")return gh(c.default,r.default);const u=c.stops.length;if(u===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[u-1][0])return c.stops[u-1][1];const m=yg(c.stops.map(x=>x[0]),l);return c.stops[m][1]}function yp(c,r,l){const u=c.base!==void 0?c.base:1;if(Yo(l)!=="number")return gh(c.default,r.default);const m=c.stops.length;if(m===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[m-1][0])return c.stops[m-1][1];const x=yg(c.stops.map(K=>K[0]),l),w=function(K,ee,oe,me){const we=me-oe,Le=K-oe;return we===0?0:ee===1?Le/we:(Math.pow(ee,Le)-1)/(Math.pow(ee,we)-1)}(l,u,c.stops[x][0],c.stops[x+1][0]),M=c.stops[x][1],N=c.stops[x+1][1];let U=ic[r.type]||ry;if(c.colorSpace&&c.colorSpace!=="rgb"){const K=zy[c.colorSpace];U=(ee,oe)=>K.reverse(K.interpolate(K.forward(ee),K.forward(oe),w))}return typeof M.evaluate=="function"?{evaluate(...K){const ee=M.evaluate.apply(void 0,K),oe=N.evaluate.apply(void 0,K);if(ee!==void 0&&oe!==void 0)return U(ee,oe,w)}}:U(M,N,w)}function yf(c,r,l){return r.type==="color"?l=ao.parse(l):r.type==="formatted"?l=yi.fromString(l.toString()):r.type==="resolvedImage"?l=Li.build(l.toString()):Yo(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),gh(l,c.default,r.default)}Mo.register(mf,{error:[{kind:"error"},[os],(c,[r])=>{throw new Qi(r.evaluate(c))}],typeof:[os,[Ks],(c,[r])=>Ja(Gt(r.evaluate(c)))],"to-rgba":[Sl(vn,4),[zl],(c,[r])=>r.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Sl(vn,4),[zl],(c,[r])=>r.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[zl,[vn,vn,vn],Wy],rgba:[zl,[vn,vn,vn,vn],Wy],hsl:[zl,[vn,vn,vn],bg],hsla:[zl,[vn,vn,vn,vn],bg],has:{type:Zs,overloads:[[[os],(c,[r])=>gf(r.evaluate(c),c.properties())],[[os,bu],(c,[r,l])=>gf(r.evaluate(c),l.evaluate(c))]]},get:{type:Ks,overloads:[[[os],(c,[r])=>Vd(r.evaluate(c),c.properties())],[[os,bu],(c,[r,l])=>Vd(r.evaluate(c),l.evaluate(c))]]},"feature-state":[Ks,[os],(c,[r])=>Vd(r.evaluate(c),c.featureState||{})],properties:[bu,[],c=>c.properties()],"geometry-type":[os,[],c=>c.geometryType()],worldview:[os,[],c=>c.globals.worldview||""],id:[Ks,[],c=>c.id()],zoom:[vn,[],c=>c.globals.zoom],pitch:[vn,[],c=>c.globals.pitch||0],"distance-from-center":[vn,[],c=>c.distanceFromCenter()],"measure-light":[vn,[os],(c,[r])=>c.measureLight(r.evaluate(c))],"heatmap-density":[vn,[],c=>c.globals.heatmapDensity||0],"line-progress":[vn,[],c=>c.globals.lineProgress||0],"raster-value":[vn,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[vn,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[vn,[],c=>c.globals.skyRadialProgress||0],accumulated:[Ks,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[vn,Td(vn),(c,r)=>{let l=0;for(const u of r)l+=u.evaluate(c);return l}],"*":[vn,Td(vn),(c,r)=>{let l=1;for(const u of r)l*=u.evaluate(c);return l}],"-":{type:vn,overloads:[[[vn,vn],(c,[r,l])=>r.evaluate(c)-l.evaluate(c)],[[vn],(c,[r])=>-r.evaluate(c)]]},"/":[vn,[vn,vn],(c,[r,l])=>r.evaluate(c)/l.evaluate(c)],"%":[vn,[vn,vn],(c,[r,l])=>r.evaluate(c)%l.evaluate(c)],ln2:[vn,[],()=>Math.LN2],pi:[vn,[],()=>Math.PI],e:[vn,[],()=>Math.E],"^":[vn,[vn,vn],(c,[r,l])=>Math.pow(r.evaluate(c),l.evaluate(c))],sqrt:[vn,[vn],(c,[r])=>Math.sqrt(r.evaluate(c))],log10:[vn,[vn],(c,[r])=>Math.log(r.evaluate(c))/Math.LN10],ln:[vn,[vn],(c,[r])=>Math.log(r.evaluate(c))],log2:[vn,[vn],(c,[r])=>Math.log(r.evaluate(c))/Math.LN2],sin:[vn,[vn],(c,[r])=>Math.sin(r.evaluate(c))],cos:[vn,[vn],(c,[r])=>Math.cos(r.evaluate(c))],tan:[vn,[vn],(c,[r])=>Math.tan(r.evaluate(c))],asin:[vn,[vn],(c,[r])=>Math.asin(r.evaluate(c))],acos:[vn,[vn],(c,[r])=>Math.acos(r.evaluate(c))],atan:[vn,[vn],(c,[r])=>Math.atan(r.evaluate(c))],min:[vn,Td(vn),(c,r)=>Math.min(...r.map(l=>l.evaluate(c)))],max:[vn,Td(vn),(c,r)=>Math.max(...r.map(l=>l.evaluate(c)))],abs:[vn,[vn],(c,[r])=>Math.abs(r.evaluate(c))],round:[vn,[vn],(c,[r])=>{const l=r.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[vn,[vn],(c,[r])=>Math.floor(r.evaluate(c))],ceil:[vn,[vn],(c,[r])=>Math.ceil(r.evaluate(c))],"filter-==":[Zs,[os,Ks],(c,[r,l])=>c.properties()[r.value]===l.value],"filter-id-==":[Zs,[Ks],(c,[r])=>c.id()===r.value],"filter-type-==":[Zs,[os],(c,[r])=>c.geometryType()===r.value],"filter-<":[Zs,[os,Ks],(c,[r,l])=>{const u=c.properties()[r.value],m=l.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Zs,[Ks],(c,[r])=>{const l=c.id(),u=r.value;return typeof l==typeof u&&l<u}],"filter->":[Zs,[os,Ks],(c,[r,l])=>{const u=c.properties()[r.value],m=l.value;return typeof u==typeof m&&u>m}],"filter-id->":[Zs,[Ks],(c,[r])=>{const l=c.id(),u=r.value;return typeof l==typeof u&&l>u}],"filter-<=":[Zs,[os,Ks],(c,[r,l])=>{const u=c.properties()[r.value],m=l.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Zs,[Ks],(c,[r])=>{const l=c.id(),u=r.value;return typeof l==typeof u&&l<=u}],"filter->=":[Zs,[os,Ks],(c,[r,l])=>{const u=c.properties()[r.value],m=l.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Zs,[Ks],(c,[r])=>{const l=c.id(),u=r.value;return typeof l==typeof u&&l>=u}],"filter-has":[Zs,[Ks],(c,[r])=>r.value in c.properties()],"filter-has-id":[Zs,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Zs,[Sl(os)],(c,[r])=>r.value.indexOf(c.geometryType())>=0],"filter-id-in":[Zs,[Sl(Ks)],(c,[r])=>r.value.indexOf(c.id())>=0],"filter-in-small":[Zs,[os,Sl(Ks)],(c,[r,l])=>l.value.indexOf(c.properties()[r.value])>=0],"filter-in-large":[Zs,[os,Sl(Ks)],(c,[r,l])=>function(u,m,x,w){for(;x<=w;){const M=x+w>>1;if(m[M]===u)return!0;m[M]>u?w=M-1:x=M+1}return!1}(c.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Zs,overloads:[[[Zs,Zs],(c,[r,l])=>r.evaluate(c)&&l.evaluate(c)],[Td(Zs),(c,r)=>{for(const l of r)if(!l.evaluate(c))return!1;return!0}]]},any:{type:Zs,overloads:[[[Zs,Zs],(c,[r,l])=>r.evaluate(c)||l.evaluate(c)],[Td(Zs),(c,r)=>{for(const l of r)if(l.evaluate(c))return!0;return!1}]]},"!":[Zs,[Zs],(c,[r])=>!r.evaluate(c)],"is-supported-script":[Zs,[os],(c,[r])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(r.evaluate(c))}],upcase:[os,[os],(c,[r])=>r.evaluate(c).toUpperCase()],downcase:[os,[os],(c,[r])=>r.evaluate(c).toLowerCase()],concat:[os,Td(Ks),(c,r)=>r.map(l=>qr(l.evaluate(c))).join("")],"resolved-locale":[os,[xd],(c,[r])=>r.evaluate(c).resolvedLocale()],random:[vn,[vn,vn,Ks],(c,r)=>{const[l,u,m]=r.map(w=>w.evaluate(c));if(l>u||l===u)return l;let x;if(typeof m=="string")x=function(w){let M=0;if(w.length===0)return M;for(let N=0;N<w.length;N++)M=(M<<5)-M+w.charCodeAt(N),M|=0;return M}(m);else{if(typeof m!="number")throw new Qi(`Invalid seed input: ${m}`);x=m}return l+Lm(x)()*(u-l)}]});class Xf{constructor(r,l,u,m){this.expression=r,this._warningHistory={},this._evaluator=new el(u,m),this._defaultValue=l?function(x){return x.type==="color"&&($p(x.default)||Array.isArray(x.default))?new ao(0,0,0,0):x.type==="color"?ao.parse(x.default)||null:x.default===void 0?null:x.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=df(r)}evaluateWithoutErrorHandling(r,l,u,m,x,w,M,N){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=N||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,u,m,x,w,M,N){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=N||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new Qi(`Expected value to be one of ${Object.keys(this._enumValues).map(K=>JSON.stringify(K)).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${U.message}`)),this._defaultValue}}}function jl(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in mf}function Eu(c,r,l,u){const m=new No(mf,[],r?function(w){const M={color:zl,string:os,number:vn,enum:os,boolean:Zs,formatted:ju,resolvedImage:Hu};return w.type==="array"?Sl(M[w.value]||Ks,w.length):M[w.type]}(r):void 0,void 0,void 0,l,u),x=m.parse(c,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?jy(new Xf(x,r,l,u)):Ku(m.errors)}class Zf{constructor(r,l,u,m){this.kind=r,this._styleExpression=l,this.isLightConstant=u,this.isLineProgressConstant=m,this.isStateDependent=r!=="constant"&&!Hf(l.expression),this.configDependencies=df(l.expression)}evaluateWithoutErrorHandling(r,l,u,m,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,m,x,w)}evaluate(r,l,u,m,x,w){return this._styleExpression.evaluate(r,l,u,m,x,w)}}class gl{constructor(r,l,u,m,x,w){this.kind=r,this.zoomStops=u,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!Hf(l.expression),this.isLightConstant=x,this.isLineProgressConstant=w,this.configDependencies=df(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,l,u,m,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,m,x,w)}evaluate(r,l,u,m,x,w){return this._styleExpression.evaluate(r,l,u,m,x,w)}interpolationFactor(r,l,u){return this.interpolationType?Oc.interpolationFactor(this.interpolationType,r,l,u):0}}function ny(c,r,l,u){if((c=Eu(c,r,l,u)).result==="error")return c;const m=c.value.expression,x=ml(m);if(!x&&!Up(r))return Ku([new Qa("","data expressions not supported")]);const w=Op(m,["zoom","pitch","distance-from-center"]);if(!w&&!Cu(r))return Ku([new Qa("","zoom expressions not supported")]);const M=Op(m,["measure-light"]);if(!M&&!gp(r))return Ku([new Qa("","measure-light expression not supported")]);const N=Op(m,["line-progress"]);if(!N&&!function(ee){return Tu(ee.expression,"line-progress")}(r))return Ku([new Qa("","line-progress expression not supported")]);const U=r.expression&&r.expression.relaxZoomRestriction,K=ku(m);return K||w||U?K instanceof Qa?Ku([K]):K instanceof Oc&&!Cd(r)?Ku([new Qa("",'"interpolate" expressions cannot be used with this property')]):jy(K?new gl(x&&N?"camera":"composite",c.value,K.labels,K instanceof Oc?K.interpolation:void 0,M,N):new Zf(x&&N?"constant":"source",c.value,M,N)):Ku([new Qa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ed{constructor(r,l){this._parameters=r,this._specification=l,wl(this,Qu(this._parameters,this._specification))}static deserialize(r){return new Ed(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ku(c){let r=null;if(c instanceof xg)r=ku(c.result);else if(c instanceof vg){for(const l of c.args)if(r=ku(l),r)break}else(c instanceof _g||c instanceof Oc)&&c.input instanceof Mo&&c.input.name==="zoom"&&(r=c);return r instanceof Qa||c.eachChild(l=>{const u=ku(l);u instanceof Qa?r=u:r&&u&&r!==u&&(r=new Qa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var _p,yl,_f=function(){if(yl)return _p;yl=1,_p=r;var c=3;function r(l,u,m){var x=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var w=new Int32Array(this.arrayBuffer);l=w[0],this.d=(u=w[1])+2*(m=w[2]);for(var M=0;M<this.d*this.d;M++){var N=w[c+M],U=w[c+M+1];x.push(N===U?null:w.subarray(N,U))}var K=w[c+x.length+1];this.keys=w.subarray(w[c+x.length],K),this.bboxes=w.subarray(K),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var ee=0;ee<this.d*this.d;ee++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=l,this.padding=m,this.scale=u/l,this.uid=0;var oe=m/u*l;this.min=-oe,this.max=l+oe}return r.prototype.insert=function(l,u,m,x,w){this._forEachCell(u,m,x,w,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(w)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(l,u,m,x,w,M){this.cells[w].push(M)},r.prototype.query=function(l,u,m,x,w){var M=this.min,N=this.max;if(l<=M&&u<=M&&N<=m&&N<=x&&!w)return Array.prototype.slice.call(this.keys);var U=[];return this._forEachCell(l,u,m,x,this._queryCell,U,{},w),U},r.prototype._queryCell=function(l,u,m,x,w,M,N,U){var K=this.cells[w];if(K!==null)for(var ee=this.keys,oe=this.bboxes,me=0;me<K.length;me++){var we=K[me];if(N[we]===void 0){var Le=4*we;(U?U(oe[Le+0],oe[Le+1],oe[Le+2],oe[Le+3]):l<=oe[Le+2]&&u<=oe[Le+3]&&m>=oe[Le+0]&&x>=oe[Le+1])?(N[we]=!0,M.push(ee[we])):N[we]=!1}}},r.prototype._forEachCell=function(l,u,m,x,w,M,N,U){for(var K=this._convertToCellCoord(l),ee=this._convertToCellCoord(u),oe=this._convertToCellCoord(m),me=this._convertToCellCoord(x),we=K;we<=oe;we++)for(var Le=ee;Le<=me;Le++){var ze=this.d*Le+we;if((!U||U(this._convertFromCellCoord(we),this._convertFromCellCoord(Le),this._convertFromCellCoord(we+1),this._convertFromCellCoord(Le+1)))&&w.call(this,l,u,m,x,ze,M,N,U))return}},r.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},r.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,u=c+this.cells.length+1+1,m=0,x=0;x<this.cells.length;x++)m+=this.cells[x].length;var w=new Int32Array(u+m+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;for(var M=u,N=0;N<l.length;N++){var U=l[N];w[c+N]=M,w.set(U,M),M+=U.length}return w[c+l.length]=M,w.set(this.keys,M),w[c+l.length+1]=M+=this.keys.length,w.set(this.bboxes,M),M+=this.bboxes.length,w.buffer},_p}(),Au=za(_f);const Vp={};function mn(c,r,l={}){Object.defineProperty(c,"_classRegistryKey",{value:r,writable:!1}),Vp[r]={klass:c,omit:l.omit||[]}}mn(Object,"Object"),Au.serialize=function(c,r){const l=c.toArrayBuffer();return r&&r.add(l),{buffer:l}},Au.deserialize=function(c){return new Au(c.buffer)},Object.defineProperty(Au,"name",{value:"Grid"}),mn(Au,"Grid"),typeof DOMMatrix<"u"&&mn(DOMMatrix,"DOMMatrix"),mn(ao,"Color"),mn(Error,"Error"),mn(yi,"Formatted"),mn(Di,"FormattedSection"),mn(Vs,"AJAXError"),mn(Li,"ResolvedImage"),mn(Ed,"StylePropertyFunction"),mn(Xf,"StyleExpression",{omit:["_evaluator"]}),mn(Xc,"ImageId"),mn(bi,"ImageVariant"),mn(gl,"ZoomDependentExpression"),mn(Zf,"ZoomConstantExpression"),mn(Mo,"CompoundExpression",{omit:["_evaluate"]});for(const c in mf)Vp[mf[c]._classRegistryKey]||mn(mf[c],`Expression${c}`);function Ec(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function D0(c){return self.ImageBitmap&&c instanceof ImageBitmap}function mu(c,r){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Ec(c)||D0(c))return r&&r.add(c),c;if(ArrayBuffer.isView(c))return r&&r.add(c.buffer),c;if(c instanceof ImageData)return r&&r.add(c.data.buffer),c;if(Array.isArray(c)){const l=[];for(const u of c)l.push(mu(u,r));return l}if(c instanceof Map){const l={$name:"Map",entries:[]};for(const[u,m]of c.entries())l.entries.push(mu(u),mu(m,r));return l}if(c instanceof Set){const l={$name:"Set"};let u=0;for(const m of c.values())l[++u]=mu(m);return l}if(c instanceof DOMMatrix){const l={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of u)l[m]=c[m];return l}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const l=c.constructor,u=l._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const m=l.serialize?l.serialize(c,r):{};if(!l.serialize){for(const x in c)c.hasOwnProperty(x)&&(Vp[u].omit.indexOf(x)>=0||(m[x]=mu(c[x],r)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function Hl(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Ec(c)||D0(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Hl);if(typeof c=="object"){const r=c.$name||"Object";if(r==="Map"){const m=c.entries||[],x=new Map;for(let w=0;w<m.length;w+=2)x.set(Hl(m[w]),Hl(m[w+1]));return x}if(r==="Set"){const m=new Set;for(const x of Object.keys(c))x!=="$name"&&m.add(Hl(c[x]));return m}if(r==="DOMMatrix"){let m;return m=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(m)}if(r==="BigInt")return BigInt(c.value);const{klass:l}=Vp[r];if(!l)throw new Error(`Can't deserialize unregistered class "${r}".`);if(l.deserialize)return l.deserialize(c);const u=Object.create(l.prototype);for(const m of Object.keys(c))m!=="$name"&&(u[m]=Hl(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}const $n={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function kd(c){for(const r of c)if(Kf(r.charCodeAt(0)))return!0;return!1}function Wp(c){for(const r of c)if(!Pm(r.charCodeAt(0)))return!1;return!0}function Pm(c){return!($n.Arabic(c)||$n["Arabic Supplement"](c)||$n["Arabic Extended-A"](c)||$n["Arabic Presentation Forms-A"](c)||$n["Arabic Presentation Forms-B"](c))}function Kf(c){return!(c!==746&&c!==747&&(c<4352||!($n["Bopomofo Extended"](c)||$n.Bopomofo(c)||$n["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||$n["CJK Compatibility Ideographs"](c)||$n["CJK Compatibility"](c)||$n["CJK Radicals Supplement"](c)||$n["CJK Strokes"](c)||!(!$n["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||$n["CJK Unified Ideographs Extension A"](c)||$n["CJK Unified Ideographs"](c)||$n["Enclosed CJK Letters and Months"](c)||$n["Hangul Compatibility Jamo"](c)||$n["Hangul Jamo Extended-A"](c)||$n["Hangul Jamo Extended-B"](c)||$n["Hangul Jamo"](c)||$n["Hangul Syllables"](c)||$n.Hiragana(c)||$n["Ideographic Description Characters"](c)||$n.Kanbun(c)||$n["Kangxi Radicals"](c)||$n["Katakana Phonetic Extensions"](c)||$n.Katakana(c)&&c!==12540||!(!$n["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!$n["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||$n["Unified Canadian Aboriginal Syllabics"](c)||$n["Unified Canadian Aboriginal Syllabics Extended"](c)||$n["Vertical Forms"](c)||$n["Yijing Hexagram Symbols"](c)||$n["Yi Syllables"](c)||$n["Yi Radicals"](c))))}function vf(c){return!(Kf(c)||function(r){return!!($n["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||$n["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||$n["Letterlike Symbols"](r)||$n["Number Forms"](r)||$n["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||$n["Control Pictures"](r)&&r!==9251||$n["Optical Character Recognition"](r)||$n["Enclosed Alphanumerics"](r)||$n["Geometric Shapes"](r)||$n["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||$n["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||$n["CJK Symbols and Punctuation"](r)||$n.Katakana(r)||$n["Private Use Area"](r)||$n["CJK Compatibility Forms"](r)||$n["Small Form Variants"](r)||$n["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(c))}function Mu(c){return $n.Arabic(c)||$n["Arabic Supplement"](c)||$n["Arabic Extended-A"](c)||$n["Arabic Presentation Forms-A"](c)||$n["Arabic Presentation Forms-B"](c)}function P0(c){return c>=1424&&c<=2303||$n["Arabic Presentation Forms-A"](c)||$n["Arabic Presentation Forms-B"](c)}function O0(c,r){return!(!r&&P0(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||$n.Khmer(c))}function dh(c){for(const r of c)if(P0(r.charCodeAt(0)))return!0;return!1}const Uh={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Om=null,$h=Uh.unavailable,Ju=null;const Ad=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&($h=Uh.error),Om&&Om(c)};function Cl(){Wd.fire(new Ha("pluginStateChange",{pluginStatus:$h,pluginURL:Ju}))}const Wd=new Wu,jp=function(){return $h},wg=function(){if($h!==Uh.deferred||!Ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$h=Uh.loading,Cl(),Ju&&Qh({url:Ju},c=>{c?Ad(c):($h=Uh.loaded,Cl())})},jd={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$h===Uh.loaded||jd.applyArabicShaping!=null,isLoading:()=>$h===Uh.loading,setState(c){$h=c.pluginStatus,Ju=c.pluginURL},isParsing:()=>$h===Uh.parsing,isParsed:()=>$h===Uh.parsed,getPluginURL:()=>Ju};class sa{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness,this.worldview=l.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(l,u){for(const m of l)if(!O0(m.charCodeAt(0),u))return!1;return!0}(r,jd.isLoaded())}}class Rm{constructor(r,l,u,m){this.property=r,this.value=l,this.expression=function(x,w,M,N){if($p(x))return new Ed(x,w);if(jl(x)||Array.isArray(x)&&x.length>0){const U=ny(x,w,M,N);if(U.result==="error")throw new Error(U.value.map(K=>`${K.key}: ${K.message}`).join(", "));return U.value}{let U=x;return typeof x=="string"&&w.type==="color"&&(U=ao.parse(x)),{kind:"constant",configDependencies:new Set,evaluate:()=>U}}}(l===void 0?r.specification.default:l,r.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,u){return this.property.possiblyEvaluate(this,r,l,u)}}class Iu{constructor(r,l,u){this.property=r,this.value=new Rm(r,void 0,l,u)}transitioned(r,l){return new Nm(this.property,this.value,l,ai({},r.transition,this.transition),r.now)}untransitioned(){return new Nm(this.property,this.value,null,{},0)}}class R0{constructor(r,l,u){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=l,this._options=u,this.configDependencies=new Set}getValue(r){return ii(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Iu(this._values[r].property,this._scope,this._options)),this._values[r].value=new Rm(this._values[r].property,l===null?void 0:ii(l),this._scope,this._options),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,l){l&&(this._options=l);const u=this._properties.properties;if(r)for(const m in r){const x=r[m];if(m.endsWith("-transition")){const w=m.slice(0,-11);u[w]&&this.setTransition(w,x)}else u.hasOwnProperty(m)&&this.setValue(m,x)}}getTransition(r){return ii(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Iu(this._values[r].property)),this._values[r].transition=ii(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);u!==void 0&&(r[l]=u);const m=this.getTransition(l);m!==void 0&&(r[`${l}-transition`]=m)}return r}transitioned(r,l){const u=new Ia(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(r,l._values[m]);return u}untransitioned(){const r=new Ia(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Nm{constructor(r,l,u,m,x){const w=m.delay||0,M=m.duration||0;x=x||0,this.property=r,this.value=l,this.begin=x+w,this.end=this.begin+M,r.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(r,l,u){const m=r.now||0,x=this.value.possiblyEvaluate(r,l,u),w=this.prior;if(w){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return w.possiblyEvaluate(r,l,u);{const M=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(r,l,u),x,Fe(M))}}return x}}class Ia{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,u){const m=new Md(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].possiblyEvaluate(r,l,u);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Sg{constructor(r,l,u){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=l,this._options=u,this.configDependencies=new Set}getValue(r){return ii(this._values[r].value)}setValue(r,l){this._values[r]=new Rm(this._values[r].property,l===null?void 0:ii(l),this._scope,this._options),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);u!==void 0&&(r[l]=u)}return r}possiblyEvaluate(r,l,u){const m=new Md(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].possiblyEvaluate(r,l,u);return m}}class Qf{constructor(r,l,u){this.property=r,this.value=l,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,u,m){return this.property.evaluate(this.value,this.parameters,r,l,u,m)}}class Md{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Wi{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,u){const m=ic[this.specification.type];return m?m(r,l,u):r}}class cn{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,u,m){return new Qf(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},u,m)}:r.expression,l)}interpolate(r,l,u){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new Qf(this,{kind:"constant",value:void 0},r.parameters);const m=ic[this.specification.type];return m?new Qf(this,{kind:"constant",value:m(r.value.value,l.value.value,u)},r.parameters):r}evaluate(r,l,u,m,x,w){return r.kind==="constant"?r.value:r.evaluate(l,u,m,x,w)}}class Jf{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,m){return!!r.expression.evaluate(l,null,{},u,m)}interpolate(){return!1}}class ha{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new sa(0,{});for(const u in r){const m=r[u];m.specification.overridable&&this.overridableProperties.push(u);const x=this.defaultPropertyValues[u]=new Rm(m,void 0),w=this.defaultTransitionablePropertyValues[u]=new Iu(m);this.defaultTransitioningPropertyValues[u]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate(l)}}}mn(cn,"DataDrivenProperty"),mn(Wi,"DataConstantProperty"),mn(Jf,"ColorRampProperty");var wi=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function kh(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Tg(c){if(Array.isArray(c))return c.map(Tg);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const r={};for(const l in c)r[l]=Tg(c[l]);return r}return kh(c)}function La(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const r of c.slice(1))if(!La(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function sy(c,r="",l=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};La(c)||(c=ed(c));const m=c;let x=!0;try{x=function(K){if(!xf(K))return K;let ee=Tg(K);return kc(ee),ee=Bm(ee),ee}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let w=null,M=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){M=wi[`filter_${u}`];const K=Eu(x,M,r,l);if(K.result==="error")throw new Error(K.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));w=(ee,oe,me)=>K.value.evaluate(ee,oe,{},me)}let N=null,U=null;if(x!==m){const K=Eu(m,M,r,l);if(K.result==="error")throw new Error(K.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));N=(ee,oe,me,we,Le)=>K.value.evaluate(ee,oe,{},me,void 0,void 0,we,Le),U=!ml(K.value.expression)}return{filter:w,dynamicFilter:N||void 0,needGeometry:Jh(x),needFeature:!!U}}function Bm(c){if(!Array.isArray(c))return c;const r=function(l){if(ph.has(l[0])){for(let u=1;u<l.length;u++)if(xf(l[u]))return!0}return l}(c);return r===!0?r:r.map(l=>Bm(l))}function kc(c){let r=!1;const l=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)r=r||xf(c[u]),l.push(c[u+1]);l.push(c[c.length-1])}else if(c[0]==="match"){r=r||xf(c[1]);for(let u=2;u<c.length-1;u+=2)l.push(c[u+1]);l.push(c[c.length-1])}else if(c[0]==="step"){r=r||xf(c[1]);for(let u=1;u<c.length-1;u+=2)l.push(c[u+1])}r&&(c.length=0,c.push("any",...l));for(let u=1;u<c.length;u++)kc(c[u])}function xf(c){if(!Array.isArray(c))return!1;if((r=c[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<c.length;l++)if(xf(c[l]))return!0;return!1}const ph=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lu(c,r){return c<r?-1:c>r?1:0}function Jh(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let r=1;r<c.length;r++)if(Jh(c[r]))return!0;return!1}function ed(c){if(!c)return!0;const r=c[0];return c.length<=1?r!=="any":r==="=="?nc(c[1],c[2],"=="):r==="!="?Vh(nc(c[1],c[2],"==")):r==="<"||r===">"||r==="<="||r===">="?nc(c[1],c[2],r):r==="any"?(l=c.slice(1),["any"].concat(l.map(ed))):r==="all"?["all"].concat(c.slice(1).map(ed)):r==="none"?["all"].concat(c.slice(1).map(ed).map(Vh)):r==="in"?Gl(c[1],c.slice(2)):r==="!in"?Vh(Gl(c[1],c.slice(2))):r==="has"?oy(c[1]):r!=="!has"||Vh(oy(c[1]));var l}function nc(c,r,l){switch(c){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,c,r]}}function Gl(c,r){if(r.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",c,["literal",r.sort(Lu)]]:["filter-in-small",c,["literal",r]]}}function oy(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Vh(c){return["!",c]}const yh="";function vp(c,r){return r?`${c}${yh}${r}`:c}const Rc="-transition",eu=new Set(["fill","line","background","hillshade","raster"]);class th extends Wu{constructor(r,l,u,m,x){if(super(),this.id=r.id,this.fqid=vp(this.id,u),this.type=r.type,this.scope=u,this.lut=m,this.options=x,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const w=Eu(this.filter,wi[`filter_${r.type}`]);w.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...w.value.configDependencies]))}if(r.slot&&(this.slot=r.slot),l.layout&&(this._unevaluatedLayout=new Sg(l.layout,this.scope,x),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new R0(l.paint,this.scope,x);for(const w in r.paint)this.setPaintProperty(w,r.paint[w]);for(const w in r.layout)this.setLayoutProperty(w,r.layout[w]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Md(l.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&eu.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l){if(this.type==="custom"&&r==="visibility")return void(this.visibility=l);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,l),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(Rc)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l){const u=this._transitionablePaint,m=u._properties.properties;if(r.endsWith(Rc)){const ee=r.slice(0,-11);return m[ee]&&u.setTransition(ee,l||void 0),!1}if(!m[r])return!1;const x=u._values[r],w=x.value.isDataDriven(),M=x.value;u.setValue(r,l),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const N=u._values[r].value,U=N.isDataDriven(),K=r.endsWith("pattern")||r==="line-dasharray";return U||w||K||this._handleOverridablePaintPropertyUpdate(r,M,N)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,l,u){return null}_handleOverridablePaintPropertyUpdate(r,l,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){return Or({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Qf&&Up(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=sy(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(r){}queryIntersectsFeature(r,l,u,m,x,w,M,N,U){}}const Hd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ql{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Va{constructor(){this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&l.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function lo(c,r=1){let l=0,u=0;return{members:c.map(m=>{const x=Hd[m.type].BYTES_PER_ELEMENT,w=l=td(l,Math.max(r,x)),M=m.components||1;return u=Math.max(u,x),l+=x*M,{name:m.name,type:m.type,components:M,offset:w}}),size:td(l,Math.max(u,r)),alignment:r}}function td(c,r){return Math.ceil(c/r)*r}class Vc extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const m=2*r;return this.int16[m+0]=l,this.int16[m+1]=u,r}}Vc.prototype.bytesPerElement=4,mn(Vc,"StructArrayLayout2i4");class em extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,u)}emplace(r,l,u,m){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=u,this.int16[x+2]=m,r}}em.prototype.bytesPerElement=6,mn(em,"StructArrayLayout3i6");class tm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,u,m)}emplace(r,l,u,m,x){const w=4*r;return this.int16[w+0]=l,this.int16[w+1]=u,this.int16[w+2]=m,this.int16[w+3]=x,r}}tm.prototype.bytesPerElement=8,mn(tm,"StructArrayLayout4i8");class xp extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}xp.prototype.bytesPerElement=4,mn(xp,"StructArrayLayout1f4");class Gd extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,u)}emplace(r,l,u,m){const x=4*r,w=2*r;return this.int16[x+0]=l,this.int16[x+1]=u,this.float32[w+1]=m,r}}Gd.prototype.bytesPerElement=8,mn(Gd,"StructArrayLayout2i1f8");class im extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,u)}emplace(r,l,u,m){const x=4*r;return this.int16[x+0]=l,this.int16[x+1]=u,this.int16[x+2]=m,r}}im.prototype.bytesPerElement=8,mn(im,"StructArrayLayout3i8");class id extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,u,m,x)}emplace(r,l,u,m,x,w){const M=5*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=x,this.int16[M+4]=w,r}}id.prototype.bytesPerElement=10,mn(id,"StructArrayLayout5i10");class sc extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,u,m,x,w,M)}emplace(r,l,u,m,x,w,M,N){const U=6*r,K=12*r,ee=3*r;return this.int16[U+0]=l,this.int16[U+1]=u,this.uint8[K+4]=m,this.uint8[K+5]=x,this.uint8[K+6]=w,this.uint8[K+7]=M,this.float32[ee+2]=N,r}}sc.prototype.bytesPerElement=12,mn(sc,"StructArrayLayout2i4ub1f12");class Wc extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,u)}emplace(r,l,u,m){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=u,this.float32[x+2]=m,r}}Wc.prototype.bytesPerElement=12,mn(Wc,"StructArrayLayout3f12");class bf extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,u,m,x)}emplace(r,l,u,m,x,w){const M=6*r,N=3*r;return this.uint16[M+0]=l,this.uint16[M+1]=u,this.uint16[M+2]=m,this.uint16[M+3]=x,this.float32[N+2]=w,r}}bf.prototype.bytesPerElement=12,mn(bf,"StructArrayLayout4ui1f12");class Cg extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,u,m)}emplace(r,l,u,m,x){const w=4*r;return this.uint16[w+0]=l,this.uint16[w+1]=u,this.uint16[w+2]=m,this.uint16[w+3]=x,r}}Cg.prototype.bytesPerElement=8,mn(Cg,"StructArrayLayout4ui8");class Hp extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,m,x,w)}emplace(r,l,u,m,x,w,M){const N=6*r;return this.int16[N+0]=l,this.int16[N+1]=u,this.int16[N+2]=m,this.int16[N+3]=x,this.int16[N+4]=w,this.int16[N+5]=M,r}}Hp.prototype.bytesPerElement=12,mn(Hp,"StructArrayLayout6i12");class rd extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee,oe){const me=this.length;return this.resize(me+1),this.emplace(me,r,l,u,m,x,w,M,N,U,K,ee,oe)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe,me){const we=12*r;return this.int16[we+0]=l,this.int16[we+1]=u,this.int16[we+2]=m,this.int16[we+3]=x,this.uint16[we+4]=w,this.uint16[we+5]=M,this.uint16[we+6]=N,this.uint16[we+7]=U,this.int16[we+8]=K,this.int16[we+9]=ee,this.int16[we+10]=oe,this.int16[we+11]=me,r}}rd.prototype.bytesPerElement=24,mn(rd,"StructArrayLayout4i4ui4i24");class wf extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,m,x,w)}emplace(r,l,u,m,x,w,M){const N=10*r,U=5*r;return this.int16[N+0]=l,this.int16[N+1]=u,this.int16[N+2]=m,this.float32[U+2]=x,this.float32[U+3]=w,this.float32[U+4]=M,r}}wf.prototype.bytesPerElement=20,mn(wf,"StructArrayLayout3i3f20");class Pl extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,u,m)}emplace(r,l,u,m,x){const w=4*r;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=m,this.float32[w+3]=x,r}}Pl.prototype.bytesPerElement=16,mn(Pl,"StructArrayLayout4f16");class rm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}rm.prototype.bytesPerElement=4,mn(rm,"StructArrayLayout1ul4");class Wh extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const m=2*r;return this.uint16[m+0]=l,this.uint16[m+1]=u,r}}Wh.prototype.bytesPerElement=4,mn(Wh,"StructArrayLayout2ui4");class ih extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee,oe,me){const we=this.length;return this.resize(we+1),this.emplace(we,r,l,u,m,x,w,M,N,U,K,ee,oe,me)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we){const Le=20*r,ze=10*r;return this.int16[Le+0]=l,this.int16[Le+1]=u,this.int16[Le+2]=m,this.int16[Le+3]=x,this.int16[Le+4]=w,this.float32[ze+3]=M,this.float32[ze+4]=N,this.float32[ze+5]=U,this.float32[ze+6]=K,this.int16[Le+14]=ee,this.uint32[ze+8]=oe,this.uint16[Le+18]=me,this.uint16[Le+19]=we,r}}ih.prototype.bytesPerElement=40,mn(ih,"StructArrayLayout5i4f1i1ul2ui40");class Sf extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,u,m,x,w,M)}emplace(r,l,u,m,x,w,M,N){const U=8*r;return this.int16[U+0]=l,this.int16[U+1]=u,this.int16[U+2]=m,this.int16[U+4]=x,this.int16[U+5]=w,this.int16[U+6]=M,this.int16[U+7]=N,r}}Sf.prototype.bytesPerElement=16,mn(Sf,"StructArrayLayout3i2i2i16");class ay extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,u,m,x)}emplace(r,l,u,m,x,w){const M=4*r,N=8*r;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=m,this.int16[N+6]=x,this.int16[N+7]=w,r}}ay.prototype.bytesPerElement=16,mn(ay,"StructArrayLayout2f1f2i16");class Id extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,m,x,w)}emplace(r,l,u,m,x,w,M){const N=20*r,U=5*r;return this.uint8[N+0]=l,this.uint8[N+1]=u,this.float32[U+1]=m,this.float32[U+2]=x,this.float32[U+3]=w,this.float32[U+4]=M,r}}Id.prototype.bytesPerElement=20,mn(Id,"StructArrayLayout2ub4f20");class Ac extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,u)}emplace(r,l,u,m){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=u,this.uint16[x+2]=m,r}}Ac.prototype.bytesPerElement=6,mn(Ac,"StructArrayLayout3ui6");class qd extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt,ut){const Tt=30*r,ri=15*r,Xt=60*r;return this.int16[Tt+0]=l,this.int16[Tt+1]=u,this.int16[Tt+2]=m,this.float32[ri+2]=x,this.float32[ri+3]=w,this.uint16[Tt+8]=M,this.uint16[Tt+9]=N,this.uint32[ri+5]=U,this.uint32[ri+6]=K,this.uint32[ri+7]=ee,this.uint16[Tt+16]=oe,this.uint16[Tt+17]=me,this.uint16[Tt+18]=we,this.float32[ri+10]=Le,this.float32[ri+11]=ze,this.uint8[Xt+48]=qe,this.uint8[Xt+49]=ot,this.uint8[Xt+50]=ct,this.uint32[ri+13]=Re,this.int16[Tt+28]=tt,this.uint8[Xt+58]=ut,r}}qd.prototype.bytesPerElement=60,mn(qd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Eg extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt,ut,Tt,ri,Xt,si,Ci,qi,Fr,gr,Rr,$r,Zi){const Ir=this.length;return this.resize(Ir+1),this.emplace(Ir,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt,ut,Tt,ri,Xt,si,Ci,qi,Fr,gr,Rr,$r,Zi)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct,Re,tt,ut,Tt,ri,Xt,si,Ci,qi,Fr,gr,Rr,$r,Zi,Ir){const Hi=20*r,Xi=40*r,jr=80*r;return this.float32[Hi+0]=l,this.float32[Hi+1]=u,this.int16[Xi+4]=m,this.int16[Xi+5]=x,this.int16[Xi+6]=w,this.int16[Xi+7]=M,this.int16[Xi+8]=N,this.int16[Xi+9]=U,this.int16[Xi+10]=K,this.int16[Xi+11]=ee,this.int16[Xi+12]=oe,this.uint16[Xi+13]=me,this.uint16[Xi+14]=we,this.uint16[Xi+15]=Le,this.uint16[Xi+16]=ze,this.uint16[Xi+17]=qe,this.uint16[Xi+18]=ot,this.uint16[Xi+19]=ct,this.uint16[Xi+20]=Re,this.uint16[Xi+21]=tt,this.uint16[Xi+22]=ut,this.uint16[Xi+23]=Tt,this.uint16[Xi+24]=ri,this.uint16[Xi+25]=Xt,this.uint16[Xi+26]=si,this.uint16[Xi+27]=Ci,this.uint32[Hi+14]=qi,this.float32[Hi+15]=Fr,this.float32[Hi+16]=gr,this.float32[Hi+17]=Rr,this.float32[Hi+18]=$r,this.uint8[jr+76]=Zi,this.uint16[Xi+39]=Ir,r}}Eg.prototype.bytesPerElement=80,mn(Eg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Gp extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,m,x,w)}emplace(r,l,u,m,x,w,M){const N=6*r;return this.float32[N+0]=l,this.float32[N+1]=u,this.float32[N+2]=m,this.float32[N+3]=x,this.float32[N+4]=w,this.float32[N+5]=M,r}}Gp.prototype.bytesPerElement=24,mn(Gp,"StructArrayLayout6f24");class Ld extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,u,m,x)}emplace(r,l,u,m,x,w){const M=5*r;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=m,this.float32[M+3]=x,this.float32[M+4]=w,r}}Ld.prototype.bytesPerElement=20,mn(Ld,"StructArrayLayout5f20");class Dd extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,u,m,x,w,M)}emplace(r,l,u,m,x,w,M,N){const U=7*r;return this.float32[U+0]=l,this.float32[U+1]=u,this.float32[U+2]=m,this.float32[U+3]=x,this.float32[U+4]=w,this.float32[U+5]=M,this.float32[U+6]=N,r}}Dd.prototype.bytesPerElement=28,mn(Dd,"StructArrayLayout7f28");class Fm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee){const oe=this.length;return this.resize(oe+1),this.emplace(oe,r,l,u,m,x,w,M,N,U,K,ee)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe){const me=11*r;return this.float32[me+0]=l,this.float32[me+1]=u,this.float32[me+2]=m,this.float32[me+3]=x,this.float32[me+4]=w,this.float32[me+5]=M,this.float32[me+6]=N,this.float32[me+7]=U,this.float32[me+8]=K,this.float32[me+9]=ee,this.float32[me+10]=oe,r}}Fm.prototype.bytesPerElement=44,mn(Fm,"StructArrayLayout11f44");class nm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U){const K=this.length;return this.resize(K+1),this.emplace(K,r,l,u,m,x,w,M,N,U)}emplace(r,l,u,m,x,w,M,N,U,K){const ee=9*r;return this.float32[ee+0]=l,this.float32[ee+1]=u,this.float32[ee+2]=m,this.float32[ee+3]=x,this.float32[ee+4]=w,this.float32[ee+5]=M,this.float32[ee+6]=N,this.float32[ee+7]=U,this.float32[ee+8]=K,r}}nm.prototype.bytesPerElement=36,mn(nm,"StructArrayLayout9f36");class rh extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const m=2*r;return this.float32[m+0]=l,this.float32[m+1]=u,r}}rh.prototype.bytesPerElement=8,mn(rh,"StructArrayLayout2f8");class jh extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,u,m)}emplace(r,l,u,m,x){const w=6*r;return this.uint32[3*r+0]=l,this.uint16[w+2]=u,this.uint16[w+3]=m,this.uint16[w+4]=x,r}}jh.prototype.bytesPerElement=12,mn(jh,"StructArrayLayout1ul3ui12");class Pd extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}Pd.prototype.bytesPerElement=2,mn(Pd,"StructArrayLayout1ui2");class sm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze){const qe=this.length;return this.resize(qe+1),this.emplace(qe,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze)}emplace(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe){const ot=16*r;return this.float32[ot+0]=l,this.float32[ot+1]=u,this.float32[ot+2]=m,this.float32[ot+3]=x,this.float32[ot+4]=w,this.float32[ot+5]=M,this.float32[ot+6]=N,this.float32[ot+7]=U,this.float32[ot+8]=K,this.float32[ot+9]=ee,this.float32[ot+10]=oe,this.float32[ot+11]=me,this.float32[ot+12]=we,this.float32[ot+13]=Le,this.float32[ot+14]=ze,this.float32[ot+15]=qe,r}}sm.prototype.bytesPerElement=64,mn(sm,"StructArrayLayout16f64");class zm extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,m,x,w,M){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,u,m,x,w,M)}emplace(r,l,u,m,x,w,M,N){const U=10*r,K=5*r;return this.uint16[U+0]=l,this.uint16[U+1]=u,this.uint16[U+2]=m,this.uint16[U+3]=x,this.float32[K+2]=w,this.float32[K+3]=M,this.float32[K+4]=N,r}}zm.prototype.bytesPerElement=20,mn(zm,"StructArrayLayout4ui3f20");class Du extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.int16[1*r+0]=l,r}}Du.prototype.bytesPerElement=2,mn(Du,"StructArrayLayout1i2");class Pu extends Va{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint8[1*r+0]=l,r}}Pu.prototype.bytesPerElement=1,mn(Pu,"StructArrayLayout1ub1");class om extends ql{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}om.prototype.size=40;class Sa extends ih{get(r){return new om(this,r)}}mn(Sa,"CollisionBoxArray");class kg extends ql{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}kg.prototype.size=60;class Ou extends qd{get(r){return new kg(this,r)}}mn(Ou,"PlacedSymbolArray");class qp extends ql{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}qp.prototype.size=80;class tu extends Eg{get(r){return new qp(this,r)}}mn(tu,"SymbolInstanceArray");class Ag extends xp{getoffsetX(r){return this.float32[1*r+0]}}mn(Ag,"GlyphOffsetArray");class am extends Vc{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}mn(am,"SymbolLineVertexArray");class gu extends ql{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gu.prototype.size=12;class Ru extends jh{get(r){return new gu(this,r)}}mn(Ru,"FeatureIndexArray");class yc extends Wh{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}mn(yc,"FillExtrusionCentroidArray");class Gn extends ql{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Gn.prototype.size=6;class Um extends em{get(r){return new Gn(this,r)}}mn(Um,"FillExtrusionWallArray");const $m=lo([{name:"a_pos",components:2,type:"Int16"}],4),bp=lo([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Yp=lo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class nl{constructor(r=[]){this.segments=r}_prepareSegment(r,l,u,m){let x=this.segments[this.segments.length-1];return r>nl.MAX_VERTEX_ARRAY_LENGTH&&tn(`Max vertices per segment is ${nl.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>nl.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:l,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x}prepareSegment(r,l,u,m){return this._prepareSegment(r,l.length,u.length,m)}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,u,m){return new nl([{vertexOffset:r,primitiveOffset:l,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function nd(c,r){return 256*(c=ft(Math.floor(c),0,255))+ft(Math.floor(r),0,255)}nl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mn(nl,"SegmentVector");const Kl=lo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mg=lo([{name:"a_pattern_b",components:4,type:"Uint16"}]),_c=lo([{name:"a_dash",components:4,type:"Uint16"}]);class Xp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,l,u,m){this.ids.push(Vm(r)),this.positions.push(l,u,m)}eachPosition(r,l){const u=Vm(r);let m=0,x=this.ids.length-1;for(;m<x;){const w=m+x>>1;this.ids[w]>=u?x=w:m=w+1}for(;this.ids[m]===u;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(r,l){const u=new Float64Array(r.ids),m=new Uint32Array(r.positions);return Tf(u,m,0,u.length-1),l&&(l.add(u.buffer),l.add(m.buffer)),{ids:u,positions:m}}static deserialize(r){const l=new Xp;let u;l.ids=r.ids,l.positions=r.positions;for(const m of l.ids)m!==u&&l.uniqueIds.push(m),u=m;return l.indexed=!0,l}}function Vm(c){const r=+c;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:fu(String(c))}function Tf(c,r,l,u){for(;l<u;){const m=c[l+u>>1];let x=l-1,w=u+1;for(;;){do x++;while(c[x]<m);do w--;while(c[w]>m);if(x>=w)break;Cf(c,x,w),Cf(r,3*x,3*w),Cf(r,3*x+1,3*w+1),Cf(r,3*x+2,3*w+2)}w-l<u-w?(Tf(c,r,l,w),l=w+1):(Tf(c,r,w+1,u),u=w)}}function Cf(c,r,l){const u=c[r];c[r]=c[l],c[l]=u}mn(Xp,"FeaturePositionMap");class wp{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}set(r,l,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ig extends wp{constructor(r){super(r),this.current=0}set(r,l,u){this.fetchUniformLocation(r,l)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ya extends wp{constructor(r){super(r),this.current=0}set(r,l,u){this.fetchUniformLocation(r,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Ql extends wp{constructor(r){super(r),this.current=[0,0]}set(r,l,u){this.fetchUniformLocation(r,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Yd extends wp{constructor(r){super(r),this.current=[0,0,0]}set(r,l,u){this.fetchUniformLocation(r,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class ly extends wp{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,u){this.fetchUniformLocation(r,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Xd extends wp{constructor(r){super(r),this.current=ao.transparent.toPremultipliedRenderColor(null)}set(r,l,u){this.fetchUniformLocation(r,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const cy=new Float32Array(16);class Zp extends wp{constructor(r){super(r),this.current=cy}set(r,l,u){if(this.fetchUniformLocation(r,l)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Zd=new Float32Array(9),sd=new Float32Array(4);class Kd extends wp{constructor(r){super(r),this.current=sd}set(r,l,u){if(this.fetchUniformLocation(r,l)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Lg(c){return[nd(255*c.r,255*c.g),nd(255*c.b,255*c.a)]}class Dg{constructor(r,l,u,m){this.value=r,this.uniformNames=l.map(x=>`u_${x}`),this.type=u,this.context=m}setUniform(r,l,u,m,x){const w=m.constantOr(this.value);l.set(r,x,w instanceof ao?w.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):w)}getBinding(r,l){return this.type==="color"?new Xd(r):new ya(r)}}class lm{constructor(r,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,l){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(r,l,u,m,x){let w=null;x!=="u_pattern"&&x!=="u_dash"||(w=this.pattern),x==="u_pattern_b"&&(w=this.patternTransition),x==="u_pixel_ratio"&&(w=this.pixelRatio),w&&l.set(r,x,w)}getBinding(r,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new ly(r):new ya(r)}}class Nu{constructor(r,l,u,m){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,l,u,m,x,w,M,N){const U=this.paintVertexArray.length,K=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new sa(0,{brightness:w,worldview:N}),l,{},x,m,M):this.expression.kind==="constant"&&this.expression.value,ee=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new sa(0,{brightness:w,worldview:N}),l,{},x,m,M):this.lutExpression.value)==="none";this.paintVertexArray.resize(r),this._setPaintValue(U,r,K,ee?null:this.context.lut)}updatePaintArray(r,l,u,m,x,w,M,N){const U=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:M,worldview:N},u,m,void 0,x):this.expression.kind==="constant"&&this.expression.value,K=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new sa(0,{brightness:M,worldview:N}),u,m,void 0,x):this.lutExpression.value)==="none";this._setPaintValue(r,l,U,K?null:this.context.lut)}_setPaintValue(r,l,u,m){if(this.type==="color"){const x=Lg(u.toPremultipliedRenderColor(m));for(let w=r;w<l;w++)this.paintVertexArray.emplace(w,x[0],x[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class iu{constructor(r,l,u,m,x,w){this.expression=r,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=u,this.useIntegerZoom=m,this.context=x,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(r,l,u,m,x,w,M,N){const U=this.expression.evaluate(new sa(this.context.zoom,{brightness:w,worldview:N}),l,{},x,m,M),K=this.expression.evaluate(new sa(this.context.zoom+1,{brightness:w,worldview:N}),l,{},x,m,M),ee=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new sa(0,{brightness:w,worldview:N}),l,{},x,m,M):this.lutExpression.value)==="none",oe=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(oe,r,U,K,ee?null:this.context.lut)}updatePaintArray(r,l,u,m,x,w,M,N){const U=this.expression.evaluate({zoom:this.context.zoom,brightness:M,worldview:N},u,m,void 0,x),K=this.expression.evaluate({zoom:this.context.zoom+1,brightness:M,worldview:N},u,m,void 0,x),ee=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new sa(0,{brightness:M,worldview:N}),u,m,void 0,x):this.lutExpression.value)==="none";this._setPaintValue(r,l,U,K,ee?null:this.context.lut)}_setPaintValue(r,l,u,m,x){if(this.type==="color"){const w=Lg(u.toPremultipliedRenderColor(x)),M=Lg(u.toPremultipliedRenderColor(x));for(let N=r;N<l;N++)this.paintVertexArray.emplace(N,w[0],w[1],M[0],M[1])}else{for(let w=r;w<l;w++)this.paintVertexArray.emplace(w,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,u,m,x){const w=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,M=ft(this.expression.interpolationFactor(w,this.context.zoom,this.context.zoom+1),0,1);l.set(r,x,M)}getBinding(r,l){return new ya(r)}}class Bu{constructor(r,l,u,m,x){this.expression=r,this.layerId=x,this.paintVertexAttributes=(u==="array"?_c:Kl).members;for(let w=0;w<l.length;++w);this.paintVertexArray=new m,this.paintTransitionVertexArray=new Cg}populatePaintArray(r,l,u,m){const x=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(x,r,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(r,l,u,m,x,w,M){this._setPaintValues(r,l,u.patterns&&u.patterns[this.layerId],w)}_setPaintValues(r,l,u,m){if(!m||!u)return;const x=m[u[0]],w=m[u[1]];if(x){if(x){const{tl:M,br:N,pixelRatio:U}=x;for(let K=r;K<l;K++)this.paintVertexArray.emplace(K,M[0],M[1],N[0],N[1],U)}if(w){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:M,br:N}=w;for(let U=r;U<l;U++)this.paintTransitionVertexArray.emplace(U,M[0],M[1],N[0],N[1])}}}upload(r){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,Mg.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Wm{constructor(r,l,u=()=>!0){this.binders={},this._buffers=[],this.context=l;const m=[];for(const x in r.paint._values){const w=r.paint.get(x);if(x.endsWith("-use-theme")||!u(x)||!(w instanceof Qf&&Up(w.property.specification)))continue;const M=h(x,r.type),N=w.value,U=w.property.specification.type,K=!!w.property.useIntegerZoom,ee=x==="line-dasharray"||x.endsWith("pattern"),oe=r.paint.get(`${x}-use-theme`),me=x==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||oe&&oe.value.kind!=="constant";if(N.kind!=="constant"||me)if(N.kind==="source"||me||ee){const we=A(x,U,"source");this.binders[x]=ee?new Bu(N,M,U,we,r.id):new Nu(N,M,U,we),m.push(`/a_${x}`)}else{const we=A(x,U,"composite");this.binders[x]=new iu(N,M,U,K,l,we),m.push(`/z_${x}`)}else this.binders[x]=ee?new lm(N.value,M):new Dg(N.value,M,U,l),m.push(`/u_${x}`);oe&&(this.binders[x].lutExpression=oe.value)}this.cacheKey=m.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Nu||l instanceof iu?l.maxValue:0}populatePaintArrays(r,l,u,m,x,w,M,N){for(const U in this.binders){const K=this.binders[U];K.context=this.context,(K instanceof Nu||K instanceof iu||K instanceof Bu)&&K.populatePaintArray(r,l,u,m,x,w,M,N)}}setConstantPatternPositions(r,l){for(const u in this.binders){const m=this.binders[u];m instanceof lm&&m.setConstantPatternPositions(r,l)}}getPatternTransitionVertexBuffer(r){const l=this.binders[r];return l instanceof Bu?l.paintTransitionVertexBuffer:null}updatePaintArrays(r,l,u,m,x,w,M,N,U,K){let ee=!1;const oe=Object.keys(r),me=oe.length!==0&&!N,we=me?oe:l.uniqueIds;this.context.lut=x.lut;for(const Le in this.binders){const ze=this.binders[Le];if(ze.context=this.context,(ze instanceof Nu||ze instanceof iu||ze instanceof Bu)&&ze.expression&&ze.expression.kind&&ze.expression.kind!=="constant"&&(ze.expression.isStateDependent===!0||ze.expression.isLightConstant===!1)){const qe=x.paint.get(Le);ze.expression=qe.value;for(const ot of we){const ct=r[ot.toString()];l.eachPosition(ot,(Re,tt,ut)=>{const Tt=m.feature(Re);ze.updatePaintArray(tt,ut,Tt,ct,w,M,U,K)})}if(!me)for(const ot of u.uniqueIds){const ct=r[ot.toString()];u.eachPosition(ot,(Re,tt,ut)=>{const Tt=m.feature(Re);ze.updatePaintArray(tt,ut,Tt,ct,w,M,U,K)})}ee=!0}}return ee}defines(){const r=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Dg||u instanceof lm)&&r.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Nu||u instanceof iu||u instanceof Bu)for(let m=0;m<u.paintVertexAttributes.length;m++)r.push(u.paintVertexAttributes[m].name);if(u instanceof Bu)for(let m=0;m<Mg.members.length;m++)r.push(Mg.members[m].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Dg||u instanceof lm||u instanceof iu)for(const m of u.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Dg||m instanceof lm||m instanceof iu)for(const x of m.uniformNames)l.push({name:x,property:u,binding:m.getBinding(r,x)})}return l}setUniforms(r,l,u,m,x){for(const{name:w,property:M,binding:N}of u)this.binders[M].setUniform(r,N,x,m.get(M),w)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Nu||l instanceof iu||l instanceof Bu)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof Bu&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(r){for(const l in this.binders){const u=this.binders[l];(u instanceof Nu||u instanceof iu||u instanceof Bu)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Nu||l instanceof iu||l instanceof Bu)&&l.destroy()}}}class g{constructor(r,l,u=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new Wm(m,l,u);this.needsUpload=!1,this._featureMap=new Xp,this._featureMapWithoutIds=new Xp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,l,u,m,x,w,M,N,U){for(const K in this.programConfigurations)this.programConfigurations[K].populatePaintArrays(r,l,m,x,w,M,N,U);l.id!==void 0?this._featureMap.add(l.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,u,m,x,w,M,N){for(const U of u)this.needsUpload=this.programConfigurations[U.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,l,U,m,x,w,M||0,N)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const o={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function h(c,r){return o[c]||[c.replace(`${r}-`,"").replace(/-/g,"_")]}const y={"line-pattern":{source:bf,composite:bf},"fill-pattern":{source:bf,composite:bf},"fill-extrusion-pattern":{source:bf,composite:bf},"line-dasharray":{source:Cg,composite:Cg}},C={color:{source:rh,composite:Pl},number:{source:xp,composite:rh}};function A(c,r,l){const u=y[c];return u&&u[l]||C[r][l]}mn(Dg,"ConstantBinder"),mn(lm,"PatternConstantBinder"),mn(Nu,"SourceExpressionBinder"),mn(Bu,"PatternCompositeBinder"),mn(iu,"CompositeExpressionBinder"),mn(Wm,"ProgramConfiguration",{omit:["_buffers"]}),mn(g,"ProgramConfigurationSet");const R=mr/Math.PI/2,$=5,Z=6,se=16383,ue=64,be=[ue,32,16],ge=-R,Ce=R;function $e(c,r,l,u=R){return l=Un(l),[c*Math.sin(l)*u,-r*u,c*Math.cos(l)*u]}function Ne(c,r,l){return $e(Math.cos(Un(c)),Math.sin(Un(c)),r,l)}const We=63710088e-1,Xe=2*Math.PI*We;class et{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new et(xi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,u=this.lat*l,m=r.lat*l,x=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((r.lng-this.lng)*l);return We*Math.acos(Math.min(x,1))}toBounds(r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new _t({lng:this.lng-u,lat:this.lat-l},{lng:this.lng+u,lat:this.lat+l})}toEcef(r){return Ne(this.lat,this.lng,R+r*R/We)}static convert(r){if(r instanceof et)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new et(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new et(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class _t{constructor(r,l){if(r)if(l)this.setSouthWest(r).setNorthEast(l);else if(r.length===4){const u=r;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=r;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(r){return this._ne=r instanceof et?new et(r.lng,r.lat):et.convert(r),this}setSouthWest(r){return this._sw=r instanceof et?new et(r.lng,r.lat):et.convert(r),this}extend(r){const l=this._sw,u=this._ne;let m,x;if(r instanceof et)m=r,x=r;else{if(!(r instanceof _t))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(_t.convert(r)):this.extend(et.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(et.convert(r)):this;if(m=r._sw,x=r._ne,!m||!x)return this}return l||u?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),u.lng=Math.max(x.lng,u.lng),u.lat=Math.max(x.lat,u.lat)):(this._sw=new et(m.lng,m.lat),this._ne=new et(x.lng,x.lat)),this}getCenter(){return new et((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new et(this.getWest(),this.getNorth())}getSouthEast(){return new et(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:u}=et.convert(r);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(r){if(r)return r instanceof _t?r:new _t(r)}}const Ct=0,jt=25.5;function Ft(c){return Xe*Math.cos(c*Math.PI/180)}function Rt(c){return(180+c)/360}function Et(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Wt(c,r){return c/Ft(r)}function qt(c){return 360*c-180}function Ei(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Mi(c,r){return c*Ft(Ei(r))}const Ki=85.051129;function Ji(c){return Math.cos(Un(ft(c,-85.051129,Ki)))}function Er(c,r){const l=ft(r,Ct,jt),u=Math.pow(2,l);return Ji(c)*Xe/(512*u)}function Ti(c){return 1/Math.cos(c*Math.PI/180)}function $i(c,r=0){const l=Math.exp(Math.PI*(1-(c.y+r/mr)/(1<<c.z)*2));return 80150034*l/(l*l+1)/mr/(1<<c.z)}class li{constructor(r,l,u=0){this.x=+r,this.y=+l,this.z=+u}static fromLngLat(r,l=0){const u=et.convert(r);return new li(Rt(u.lng),Et(u.lat),Wt(l,u.lat))}toLngLat(){return new et(qt(this.x),Ei(this.y))}toAltitude(){return Mi(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xe*Ti(Ei(this.y))}}function dr(c,r,l,u,m,x,w,M,N){const U=(r+u)/2,K=(l+m)/2,ee=new fr(U,K);M(ee),function(oe,me,we,Le,ze,qe){const ot=we-ze,ct=Le-qe;return Math.abs((Le-me)*ot-(we-oe)*ct)/Math.hypot(ot,ct)}(ee.x,ee.y,x.x,x.y,w.x,w.y)>=N?(dr(c,r,l,U,K,x,ee,M,N),dr(c,U,K,u,m,ee,w,M,N)):c.push(w)}function Ni(c,r,l){let u=c[0],m=u.x,x=u.y;r(u);const w=[u];for(let M=1;M<c.length;M++){const N=c[M],{x:U,y:K}=N;r(N),dr(w,m,x,U,K,u,N,r,l),m=U,x=K,u=N}return w}function vr(c,r,l,u){if(u(r,l)){const m=r.add(l)._mult(.5);vr(c,r,m,u),vr(c,m,l,u)}else c.push(l)}function Nr(c,r){let l=c[0];const u=[l];for(let m=1;m<c.length;m++){const x=c[m];vr(u,l,x,r),l=x}return u}const ar=Math.pow(2,14)-1,Br=-ar-1;function dn(c,r){const l=Math.round(c.x*r),u=Math.round(c.y*r);return c.x=ft(l,Br,ar),c.y=ft(u,Br,ar),(l<c.x||l>c.x+1||u<c.y||u>c.y+1)&&tn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function pn(c,r,l){const u=c.loadGeometry(),m=c.extent,x=mr/m;if(r&&l&&l.projection.isReprojectedInTileSpace){const w=1<<r.z,{scale:M,x:N,y:U,projection:K}=l,ee=oe=>{const me=qt((r.x+oe.x/m)/w),we=Ei((r.y+oe.y/m)/w),Le=K.project(me,we);oe.x=(Le.x*M-N)*m,oe.y=(Le.y*M-U)*m};for(let oe=0;oe<u.length;oe++)if(c.type!==1)u[oe]=Ni(u[oe],ee,1);else{const me=[];for(const we of u[oe])we.x<0||we.x>=m||we.y<0||we.y>=m||(ee(we),me.push(we));u[oe]=me}}for(const w of u)for(const M of w)dn(M,x);return u}function on(c,r){return{type:c.type,id:c.id,properties:c.properties,geometry:r?pn(c):[]}}var bn,An,Vn,Zn,ys,Bo,Da,xo={};function ia(){if(An)return bn;An=1;var c=hl();function r(m,x,w,M,N){this.properties={},this.extent=w,this.type=0,this._pbf=m,this._geometry=-1,this._keys=M,this._values=N,m.readFields(l,this,x)}function l(m,x,w){m==1?x.id=w.readVarint():m==2?function(M,N){for(var U=M.readVarint()+M.pos;M.pos<U;){var K=N._keys[M.readVarint()],ee=N._values[M.readVarint()];N.properties[K]=ee}}(w,x):m==3?x.type=w.readVarint():m==4&&(x._geometry=w.pos)}function u(m){for(var x,w,M=0,N=0,U=m.length,K=U-1;N<U;K=N++)M+=((w=m[K]).x-(x=m[N]).x)*(x.y+w.y);return M}return bn=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var x,w=m.readVarint()+m.pos,M=1,N=0,U=0,K=0,ee=[];m.pos<w;){if(N<=0){var oe=m.readVarint();M=7&oe,N=oe>>3}if(N--,M===1||M===2)U+=m.readSVarint(),K+=m.readSVarint(),M===1&&(x&&ee.push(x),x=[]),x.push(new c(U,K));else{if(M!==7)throw new Error("unknown command "+M);x&&x.push(x[0].clone())}}return x&&ee.push(x),ee},r.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var x=m.readVarint()+m.pos,w=1,M=0,N=0,U=0,K=1/0,ee=-1/0,oe=1/0,me=-1/0;m.pos<x;){if(M<=0){var we=m.readVarint();w=7&we,M=we>>3}if(M--,w===1||w===2)(N+=m.readSVarint())<K&&(K=N),N>ee&&(ee=N),(U+=m.readSVarint())<oe&&(oe=U),U>me&&(me=U);else if(w!==7)throw new Error("unknown command "+w)}return[K,oe,ee,me]},r.prototype.toGeoJSON=function(m,x,w){var M,N,U=this.extent*Math.pow(2,w),K=this.extent*m,ee=this.extent*x,oe=this.loadGeometry(),me=r.types[this.type];function we(qe){for(var ot=0;ot<qe.length;ot++){var ct=qe[ot];qe[ot]=[360*(ct.x+K)/U-180,360/Math.PI*Math.atan(Math.exp((180-360*(ct.y+ee)/U)*Math.PI/180))-90]}}switch(this.type){case 1:var Le=[];for(M=0;M<oe.length;M++)Le[M]=oe[M][0];we(oe=Le);break;case 2:for(M=0;M<oe.length;M++)we(oe[M]);break;case 3:for(oe=function(qe){var ot=qe.length;if(ot<=1)return[qe];for(var ct,Re,tt=[],ut=0;ut<ot;ut++){var Tt=u(qe[ut]);Tt!==0&&(Re===void 0&&(Re=Tt<0),Re===Tt<0?(ct&&tt.push(ct),ct=[qe[ut]]):ct.push(qe[ut]))}return ct&&tt.push(ct),tt}(oe),M=0;M<oe.length;M++)for(N=0;N<oe[M].length;N++)we(oe[M][N])}oe.length===1?oe=oe[0]:me="Multi"+me;var ze={type:"Feature",geometry:{type:me,coordinates:oe},properties:this.properties};return"id"in this&&(ze.id=this.id),ze},bn}function sl(){if(Zn)return Vn;Zn=1;var c=ia();function r(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(l,this,m),this.length=this._features.length}function l(u,m,x){u===15?m.version=x.readVarint():u===1?m.name=x.readString():u===5?m.extent=x.readVarint():u===2?m._features.push(x.pos):u===3?m._keys.push(x.readString()):u===4&&m._values.push(function(w){for(var M=null,N=w.readVarint()+w.pos;w.pos<N;){var U=w.readVarint()>>3;M=U===1?w.readString():U===2?w.readFloat():U===3?w.readDouble():U===4?w.readVarint64():U===5?w.readVarint():U===6?w.readSVarint():U===7?w.readBoolean():null}return M}(x))}return Vn=r,r.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},Vn}function ls(){return Da||(Da=1,xo.VectorTile=function(){if(Bo)return ys;Bo=1;var c=sl();function r(l,u,m){if(l===3){var x=new c(m,m.readVarint()+m.pos);x.length&&(u[x.name]=x)}}return ys=function(l,u){this.layers=l.readFields(r,{},u)},ys}(),xo.VectorTileFeature=ia(),xo.VectorTileLayer=sl()),xo}var cs=ls();const Ts="3d_elevation_id",_a="level";class Jl{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,l){return this._valid&&r(l(this._geometry)),this}require(r,l,u){return this.get(r,!0,l,u)}optional(r,l,u){return this.get(r,!1,l,u)}success(){return this._valid}get(r,l,u,m){const x=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?u(m?m(x):x):l&&(this._valid=!1),this}}class Zo{constructor(r,l){this.featureFunc=r,this.vertexFunc=l}parseFeature(r,l,u){return this.featureFunc(r,l,u)}parseVertex(r,l,u){return this.vertexFunc(r,l,u)}}const Wo=new Zo((c,r,l)=>c.reset(r).require(Ts,u=>{l.id=u}).optional("fixed_height_relative",u=>{l.constantHeight=u},Ws.decodeRelativeHeight).geometry(u=>{l.bounds=u},Dc).success(),(c,r,l)=>c.reset(r).require(Ts,u=>{l.id=u}).require("elevation_idx",u=>{l.idx=u}).require("extent",u=>{l.extent=u}).require("height_relative",u=>{l.height=u},Ws.decodeRelativeHeight).geometry(u=>{l.position=u},Ws.getPoint).success()),ol=new Zo((c,r,l)=>c.reset(r).require(Ts,u=>{l.id=u}).optional("fixed_height",u=>{l.constantHeight=u},Ws.decodeMetricHeight).geometry(u=>{l.bounds=u},Dc).success(),(c,r,l)=>c.reset(r).require(Ts,u=>{l.id=u}).require("elevation_idx",u=>{l.idx=u}).require("extent",u=>{l.extent=u}).require("height",u=>{l.height=u},Ws.decodeMetricHeight).geometry(u=>{l.position=u},Ws.getPoint).success());class Ws{static getPoint(r){return bs(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static parse(r){const l=[],u=[],m=r.length,x=new Jl;for(let M=0;M<m;M++){const N=r.feature(M),U=N.properties.hasOwnProperty("version")?String(N.properties.version):void 0,K=(w=U)?w==="1.0.1"?ol:void 0:Wo;if(K===void 0){tn(`Unknown elevation feature version number ${U||"(unknown)"}`);continue}const ee=N.properties.hasOwnProperty("type")?N.properties.type:void 0;if(ee){if(cs.VectorTileFeature.types[N.type]==="Point"&&ee==="curve_point"){const oe={};K.parseVertex(x,N,oe)&&l.push(oe)}else if(cs.VectorTileFeature.types[N.type]==="Polygon"&&ee==="curve_meta"){const oe={};K.parseFeature(x,N,oe)&&u.push(oe)}}}var w;return{vertices:l,features:u}}}class ec{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,u){const m=zn(l,this.dir);if(Math.abs(m)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1])/m;return u[0]=this.pos[0]+this.dir[0]*x,u[1]=this.pos[1]+this.dir[1]*x,!0}}class Ta{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,u){const m=Ui(l,this.dir);if(Math.abs(m)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/m;return u[0]=this.pos[0]+this.dir[0]*x,u[1]=this.pos[1]+this.dir[1]*x,u[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(r,l,u){if(function(me,we){var Le=me[0],ze=me[1],qe=me[2],ot=we[0],ct=we[1],Re=we[2];return Math.abs(Le-ot)<=S*Math.max(1,Math.abs(Le),Math.abs(ot))&&Math.abs(ze-ct)<=S*Math.max(1,Math.abs(ze),Math.abs(ct))&&Math.abs(qe-Re)<=S*Math.max(1,Math.abs(qe),Math.abs(Re))}(this.pos,r)||l===0)return u[0]=u[1]=u[2]=0,!1;const[m,x,w]=this.dir,M=this.pos[0]-r[0],N=this.pos[1]-r[1],U=this.pos[2]-r[2],K=m*m+x*x+w*w,ee=2*(M*m+N*x+U*w),oe=ee*ee-4*K*(M*M+N*N+U*U-l*l);if(oe<0){const me=Math.max(-ee/2,0),we=M+m*me,Le=N+x*me,ze=U+w*me,qe=Math.hypot(we,Le,ze);return u[0]=we*l/qe,u[1]=Le*l/qe,u[2]=ze*l/qe,!1}{const me=(-ee-Math.sqrt(oe))/(2*K);if(me<0){const we=Math.hypot(M,N,U);return u[0]=M*l/we,u[1]=N*l/we,u[2]=U*l/we,!1}return u[0]=M+m*me,u[1]=N+x*me,u[2]=U+w*me,!0}}}class Ca{constructor(r,l,u,m,x){this.TL=r,this.TR=l,this.BR=u,this.BL=m,this.horizon=x}static fromInvProjectionMatrix(r,l,u){const m=[-1,1,1],x=[1,1,1],w=[1,-1,1],M=[-1,-1,1],N=Oi(m,m,r),U=Oi(x,x,r),K=Oi(w,w,r),ee=Oi(M,M,r);return new Ca(N,U,K,ee,l/u)}}function Ko(c,r,l){let u=1/0,m=-1/0;const x=[];for(const w of c){pr(x,w,r);const M=Ui(x,l);u=Math.min(u,M),m=Math.max(m,M)}return[u,m]}function bo(c,r){let l=!0;for(let u=0;u<c.planes.length;u++){const m=c.planes[u];let x=0;for(let w=0;w<r.length;w++)x+=Ui(m,r[w])+m[3]>=0;if(x===0)return 0;x!==r.length&&(l=!1)}return l?2:1}function Ya(c,r){for(const l of c.projections){const u=Ko(r,c.points[0],l.axis);if(l.projection[1]<u[0]||l.projection[0]>u[1])return 0}return 1}function _h(c,r){let l=0;const u=[0,0,0,0];for(let w=0;w<c.length;w++)u[0]=c[w][0],u[1]=c[w][1],u[2]=c[w][2],u[3]=1,(m=u)[0]*(x=r)[0]+m[1]*x[1]+m[2]*x[2]+m[3]*x[3]>=0&&l++;var m,x;return l}class ua{constructor(r,l){this.points=r||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=Fo.fromPoints(this.points),this.projections=[],this.frustumEdges=[pr([],this.points[2],this.points[3]),pr([],this.points[0],this.points[3]),pr([],this.points[4],this.points[0]),pr([],this.points[5],this.points[1]),pr([],this.points[6],this.points[2]),pr([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],x=[u[2],0,-u[0]];this.projections.push({axis:m,projection:Ko(this.points,this.points[0],m)}),this.projections.push({axis:x,projection:Ko(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(r,l,u,m){const x=Math.pow(2,u),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(U=>{const K=Nt([],U,r),ee=1/K[3]/l*x;return(oe=K)[0]=(me=K)[0]*(we=[ee,ee,m?1/K[3]:ee,ee])[0],oe[1]=me[1]*we[1],oe[2]=me[2]*we[2],oe[3]=me[3]*we[3],oe;var oe,me,we}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(U=>{const K=Kt([],rr([],pr([],w[U[0]],w[U[1]]),pr([],w[U[2]],w[U[1]]))),ee=-Ui(K,w[U[1]]);return K.concat(ee)}),N=[];for(let U=0;U<w.length;U++)N.push([w[U][0],w[U][1],w[U][2]]);return new ua(N,M)}intersectsPrecise(r,l,u){for(let m=0;m<l.length;m++)if(!_h(r,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!_h(r,this.planes[m]))return 0;for(const m of u)for(const x of this.frustumEdges){const w=rr([],m,x),M=Ot(w);if(M===0)continue;ui(w,w,1/M);const N=Ko(this.points,this.points[0],w),U=Ko(r,this.points[0],w);if(N[0]>U[1]||U[0]>N[1])return 0}return 1}containsPoint(r){for(const l of this.planes){const u=l[3];if(Ui([l[0],l[1],l[2]],r)+u<0)return!1}return!0}}class Fo{static fromPoints(r){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of r)Je(l,l,m),dt(u,u,m);return new Fo(l,u)}static fromTileIdAndHeight(r,l,u){const m=1<<r.canonical.z,x=r.canonical.x,w=r.canonical.y;return new Fo([x/m,w/m,l],[(x+1)/m,(w+1)/m,u])}static applyTransform(r,l){const u=r.getCorners();for(let m=0;m<u.length;++m)Oi(u[m],u[m],l);return Fo.fromPoints(u)}static applyTransformFast(r,l){const u=[l[12],l[13],l[14]],m=[...u];for(let x=0;x<3;x++)for(let w=0;w<3;w++){const M=l[4*w+x],N=M*r.min[w],U=M*r.max[w];u[x]+=Math.min(N,U),m[x]+=Math.max(N,U)}return new Fo(u,m)}static projectAabbCorners(r,l){const u=r.getCorners();for(let m=0;m<u.length;++m)Oi(u[m],u[m],l);return u}constructor(r,l){this.min=r,this.max=l,this.center=ui([],mt([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],u=ht(this.min),m=ht(this.max);for(let x=0;x<l.length;x++)u[x]=l[x]?this.min[x]:this.center[x],m[x]=l[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new Fo(u,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?bo(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?bo(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,l){return l||this.intersects(r)?Ya(r,this.getCorners()):0}intersectsPreciseFlat(r,l){return l||this.intersectsFlat(r)?Ya(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let l=0;l<3;++l)if(this.min[l]>r.max[l]||r.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],r.min[l]),this.max[l]=Math.max(this.max[l],r.max[l])}encapsulatePoint(r){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],r[l]),this.max[l]=Math.max(this.max[l],r[l])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}mn(Fo,"Aabb");class ru{constructor(r,l){this.feature=r,this.metersToTile=l,this.index=0}get(){const r=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,u=l[1],m=-l[0],x=(r.extent+1)*this.metersToTile;return[new fr(Math.trunc(r.position[0]+u*x),Math.trunc(r.position[1]+m*x)),new fr(Math.trunc(r.position[0]-u*x),Math.trunc(r.position[1]-m*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ah{constructor(r,l,u,m,x,w){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=r,this.heightRange={min:u,max:u},this.safeArea=l,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=x,this.edges=this.edges.filter(M=>{return M.a<this.vertices.length&&M.b<this.vertices.length&&!((N=this.vertices[M.a].position)[0]===(U=this.vertices[M.b].position)[0]&&N[1]===U[1]);var N,U}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const M of this.vertices)this.vertexProps.push({dir:bs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,M.height),this.heightRange.max=Math.max(this.heightRange.max,M.height);for(const M of this.edges){const N=this.vertices[M.a].position,U=this.vertices[M.b].position,K=Ls(wn(),U,N),ee=Ln(K),oe=ma(wn(),K,1/ee);this.edgeProps.push({vec:K,dir:oe,len:ee});const me=this.vertexProps[M.a].dir,we=this.vertexProps[M.b].dir;qn(me,me,oe),qn(we,we,oe)}for(const M of this.vertexProps)M.dir[0]===0&&M.dir[1]===0||qo(M.dir,M.dir);this.tessellate(w)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(r);if(l==null)return 0;const[u,m]=l;return kn(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,m)}computeSlopeNormal(r,l){const u=this.getClosestEdge(r);if(!u)return Ae(0,0,1);const m=u[0],x=this.edges[m],w=this.edgeProps[m].vec,M=Ae(w[0],w[1],(this.vertices[x.b].height-this.vertices[x.a].height)*l),N=Ae(M[1],-M[0],0);rr(N,N,M);const U=Ot(N);return U>0?ui(N,N,1/U):Ae(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let l=0,u=Number.POSITIVE_INFINITY,m=0;const x=bs(r.x,r.y);for(let w=0;w<this.edges.length;w++){const M=this.edges[w],N=this.edgeProps[w].dir,U=new ec(x,this.edgeProps[w].dir),K=this.vertices[M.a].position,ee=this.vertices[M.b].position,oe=wn(),me=wn(),we=U.intersectsPlane(K,this.vertexProps[M.a].dir,oe),Le=U.intersectsPlane(ee,this.vertexProps[M.b].dir,me);if(!we||!Le)continue;const ze=Ls(wn(),me,oe),qe=Ls(wn(),x,oe),ot=zn(ze,ze),ct=ot>0?zn(qe,ze)/ot:0,Re=ft(ct,0,1),tt=Math.abs((ct-Re)*this.edgeProps[w].len),ut=Ls(wn(),x,K),Tt=tt+Math.abs(zn(ut,bs(N[1],-N[0])));Tt<u&&(l=w,u=Tt,m=Re)}return[l,m]}tessellate(r){for(let l=this.edges.length-1;l>=0;--l){const u=this.edges[l].a,m=this.edges[l].b,{position:x,height:w,extent:M}=this.vertices[u],{position:N,height:U,extent:K}=this.vertices[m],ee=this.vertexProps[u].dir,oe=this.vertexProps[m].dir,me=Ae(x[0]/r,x[1]/r,w),we=Ae(N[0]/r,N[1]/r,U),Le=Ae(ee[1],-ee[0],0);ui(Le,Le,M);const ze=Ae(oe[1],-oe[0],0);if(ui(ze,ze,K),this.distSqLines(Ae(me[0]+.5*Le[0],me[1]+.5*Le[1],me[2]+.5*Le[2]),Ae(we[0]-.5*ze[0],we[1]-.5*ze[1],we[2]-.5*ze[2]),Ae(me[0]-.5*Le[0],me[1]-.5*Le[1],me[2]-.5*Le[2]),Ae(we[0]+.5*ze[0],we[1]+.5*ze[1],we[2]+.5*ze[2]))<=.0025000000000000005)continue;const qe=this.vertices.length,ot=qn(wn(),x,N);this.vertices.push({position:ma(ot,ot,.5),height:.5*(w+U),extent:.5*(M+K)});const ct=qn(wn(),ee,oe);this.vertexProps.push({dir:qo(ct,ct)}),this.edges.splice(l,1),this.edgeProps.splice(l,1),this.edges.push({a:u,b:qe}),this.edges.push({a:qe,b:m});const Re=Ls(wn(),this.vertices[qe].position,x),tt=Ln(Re),ut={vec:Re,dir:ma(wn(),Re,1/tt),len:tt};this.edgeProps.push(ut),this.edgeProps.push(ut)}}distSqLines(r,l,u,m){const x=bt(At(),l,r),w=bt(At(),m,u),M=bt(At(),r,u),N=Ui(x,x),U=Ui(x,w),K=Ui(x,M),ee=Ui(w,w),oe=Ui(w,M),me=N*ee-U*U;if(me===0){const ze=Ui(M,w)/Ui(w,w);return ei(gi(At(),u,m,ze),r)}const we=(U*oe-K*ee)/me,Le=(N*oe-U*K)/me;return ei(gi(At(),r,l,we),gi(At(),u,m,Le))}}class od{static parseFrom(r,l){const u=Ws.parse(r);if(!u)return[];let{vertices:m,features:x}=u;const w=1/$i(l);x.sort((K,ee)=>K.id-ee.id),m.sort((K,ee)=>K.id-ee.id||K.idx-ee.idx),m=m.filter((K,ee,oe)=>ee===oe.findIndex(me=>me.id===K.id&&me.idx===K.idx));const M=new Array;let N=0;const U=m.length;for(const K of x){if(K.constantHeight){M.push(new Ah(K.id,K.bounds,K.constantHeight));continue}for(;N!==U&&m[N].id<K.id;)N++;if(N===U||m[N].id!==K.id)continue;const ee=new Array,oe=new Array,me=N;for(;N!==U&&m[N].id===K.id;){const we=m[N];if(ee.push({position:we.position,height:we.height,extent:we.extent}),N!==me&&m[N-1].idx===we.idx-1){const Le=N-me;oe.push({a:Le-1,b:Le})}N++}M.push(new Ah(K.id,K.bounds,void 0,ee,oe,w))}return M}static getElevationFeature(r,l){if(!l)return;const u=+r.properties[Ts];return Number.isNaN(u)?void 0:l.find(m=>m.id===u)}}class Od{constructor(r,l){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(l)||(this.zScale=Math.pow(2,l.z-r.z),this.xOffset=(r.x*this.zScale-l.x)*mr,this.yOffset=(r.y*this.zScale-l.y)*mr)}constantElevation(r,l){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,l)}pointElevation(r,l,u){const m=this.constantElevation(l,u);return m??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(r),u))}computeBiasedHeight(r,l){return l<=0?r:r+l*Jt(0,l,r>=0?r:Math.abs(.5*r))}}mn(Ah,"ElevationFeature");class nu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Vc,this.indexArray=new Ac,this.segments=new nl,this.programConfigurations=new g(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new xp),this.worldview=r.worldview}updateFootprints(r,l){}populate(r,l,u,m){const x=this.layers[0],w=[];let M=null;x.type==="circle"&&(M=x.layout.get("circle-sort-key"));for(const{feature:U,id:K,index:ee,sourceLayerIndex:oe}of r){const me=this.layers[0]._featureFilter.needGeometry,we=on(U,me);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),we,u))continue;const Le=M?M.evaluate(we,{},u):void 0,ze={id:K,properties:U.properties,type:U.type,sourceLayerIndex:oe,index:ee,geometry:me?we.geometry:pn(U,u,m),patterns:{},sortKey:Le};w.push(ze)}M&&w.sort((U,K)=>U.sortKey-K.sortKey);let N=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Hp,N=m.projection);for(const U of w){const{geometry:K,index:ee,sourceLayerIndex:oe}=U,me=r[ee].feature;this.addFeature(U,K,ee,l.availableImages,u,N,l.brightness,l.elevationFeatures),l.featureIndex.insert(me,K,ee,oe,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,l,u,m,x,w,M){this.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,$m.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Yp.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,bp.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,l,u,m,x,w,M,N){let U;this.elevationMode!=="none"&&(U=od.getElevationFeature(r,N));for(const K of l)for(const ee of K){const oe=ee.x,me=ee.y;if(oe<0||oe>=mr||me<0||me>=mr)continue;if(w){const ze=w.projectTilePoint(oe,me,x),qe=w.upVector(x,oe,me);this.addGlobeExtVertex(ze,qe),this.addGlobeExtVertex(ze,qe),this.addGlobeExtVertex(ze,qe),this.addGlobeExtVertex(ze,qe)}const we=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),Le=we.vertexLength;if(this.addCircleVertex(oe,me,-1,-1),this.addCircleVertex(oe,me,1,-1),this.addCircleVertex(oe,me,1,1),this.addCircleVertex(oe,me,-1,1),this.elevationMode!=="none"){const ze=U?U.pointElevation(new fr(oe,me)):0;this.hasElevation=this.hasElevation||ze!==0;for(let qe=0;qe<4;qe++)this.elevatedLayoutVertexArray.emplaceBack(ze)}this.indexArray.emplaceBack(Le,Le+1,Le+2),this.indexArray.emplaceBack(Le,Le+2,Le+3),we.vertexLength+=4,we.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},m,x,M,void 0,this.worldview)}addCircleVertex(r,l,u,m){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*l+(m+1)/2)}addGlobeExtVertex(r,l){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}}function su(c,r){for(let l=0;l<c.length;l++)if(ep(r,c[l]))return!0;for(let l=0;l<r.length;l++)if(ep(c,r[l]))return!0;return!!cm(c,r)}function Qd(c,r,l){return!!ep(c,r)||!!Pg(r,c,l)}function ad(c,r){if(c.length===1)return um(r,c[0]);for(let l=0;l<r.length;l++){const u=r[l];for(let m=0;m<u.length;m++)if(ep(c,u[m]))return!0}for(let l=0;l<c.length;l++)if(um(r,c[l]))return!0;for(let l=0;l<r.length;l++)if(cm(c,r[l]))return!0;return!1}function Jd(c,r,l){if(c.length>1){if(cm(c,r))return!0;for(let u=0;u<r.length;u++)if(Pg(r[u],c,l))return!0}for(let u=0;u<c.length;u++)if(Pg(c[u],r,l))return!0;return!1}function cm(c,r){if(c.length===0||r.length===0)return!1;for(let l=0;l<c.length-1;l++){const u=c[l],m=c[l+1];for(let x=0;x<r.length-1;x++)if(hy(u,m,r[x],r[x+1]))return!0}return!1}function hy(c,r,l,u){return Jn(c,l,u)!==Jn(r,l,u)&&Jn(c,r,l)!==Jn(c,r,u)}function hm(c,r,l){return(c.x-l.x)*(r.y-l.y)-(c.y-l.y)*(r.x-l.x)}function uy(c,r,l,u){const m=hm(c,r,u),x=hm(c,r,l);if(Math.sign(m)===Math.sign(x))return;const w=hm(l,u,c),M=w+x-m;return Math.sign(w)!==Math.sign(M)?[w/(w-M),x/(x-m)]:void 0}function Pg(c,r,l){const u=l*l;if(r.length===1)return c.distSqr(r[0])<u;for(let m=1;m<r.length;m++)if(dy(c,r[m-1],r[m])<u)return!0;return!1}function dy(c,r,l){const u=r.distSqr(l);if(u===0)return c.distSqr(r);const m=((c.x-r.x)*(l.x-r.x)+(c.y-r.y)*(l.y-r.y))/u;return c.distSqr(m<0?r:m>1?l:l.sub(r)._mult(m)._add(r))}function um(c,r){let l,u,m,x=!1;for(let w=0;w<c.length;w++){l=c[w];for(let M=0,N=l.length-1;M<l.length;N=M++)u=l[M],m=l[N],u.y>r.y!=m.y>r.y&&r.x<(m.x-u.x)*(r.y-u.y)/(m.y-u.y)+u.x&&(x=!x)}return x}function ep(c,r){let l=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){const x=c[u],w=c[m];x.y>r.y!=w.y>r.y&&r.x<(w.x-x.x)*(r.y-x.y)/(w.y-x.y)+x.x&&(l=!l)}return l}function jm(c,r,l,u,m){for(const w of c)if(r<=w.x&&l<=w.y&&u>=w.x&&m>=w.y)return!0;const x=[new fr(r,l),new fr(r,m),new fr(u,m),new fr(u,l)];if(c.length>2){for(const w of x)if(ep(c,w))return!0}for(let w=0;w<c.length-1;w++)if(Sp(c[w],c[w+1],x))return!0;return!1}function Sp(c,r,l){const u=l[0],m=l[2];if(c.x<u.x&&r.x<u.x||c.x>m.x&&r.x>m.x||c.y<u.y&&r.y<u.y||c.y>m.y&&r.y>m.y)return!1;const x=Jn(c,r,l[0]);return x!==Jn(c,r,l[1])||x!==Jn(c,r,l[2])||x!==Jn(c,r,l[3])}function tp(c,r,l,u,m,x){let w=r.y-c.y,M=c.x-r.x;if(x=x||0){const N=w*w+M*M;if(N===0)return!0;const U=Math.sqrt(N);w/=U,M/=U}return!((l.x-c.x)*w+(l.y-c.y)*M-x<0||(u.x-c.x)*w+(u.y-c.y)*M-x<0||(m.x-c.x)*w+(m.y-c.y)*M-x<0)}function N0(c,r,l,u,m,x,w){return!(tp(c,r,u,m,x,w)||tp(r,l,u,m,x,w)||tp(l,c,u,m,x,w)||tp(u,m,c,r,l,w)||tp(m,x,c,r,l,w)||tp(x,u,c,r,l,w))}function Og(c,r,l){const u=r.paint.get(c).value;return u.kind==="constant"?u.value:l.programConfigurations.get(r.id).getMaxValue(c)}function B0(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Gy(c,r,l,u,m){if(!r[0]&&!r[1])return c;const x=fr.convert(r)._mult(m);l==="viewport"&&x._rotate(-u);const w=[];for(let M=0;M<c.length;M++)w.push(c[M].sub(x));return w}function qy(c,r,l,u){const m=fr.convert(c)._mult(u);return r==="viewport"&&m._rotate(-l),m}let hv,F0;function uv(c,r,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[c*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}mn(nu,"CircleBucket",{omit:["layers"]});class Rg{constructor(r,l,u){this.z=r,this.x=l,this.y=u,this.key=Ng(0,r,r,l,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const u=function(x,w,M){var N=uv(256*x,256*(w=Math.pow(2,M)-w-1),M),U=uv(256*(x+1),256*(w+1),M);return N[0]+","+N[1]+","+U[0]+","+U[1]}(this.x,this.y,this.z),m=function(x,w,M){let N,U="";for(let K=x;K>0;K--)N=1<<K-1,U+=(w&N?1:0)+(M&N?2:0);return U}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class py{constructor(r,l){this.wrap=r,this.canonical=l,this.key=Ng(r,l.z,l.z,l.x,l.y)}}class Hh{constructor(r,l,u,m,x){this.overscaledZ=r,this.wrap=l,this.canonical=new Rg(u,+m,+x),this.key=l===0&&r===u?this.canonical.key:Ng(l,r,u,m,x)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new Hh(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hh(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return Ng(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Ng(this.wrap*+l,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Hh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Hh(l,this.wrap,l,u,m),new Hh(l,this.wrap,l,u+1,m),new Hh(l,this.wrap,l,u,m+1),new Hh(l,this.wrap,l,u+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Hh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Hh(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new py(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ng(c,r,l,u,m){const x=1<<Math.min(l,22);let w=x*(m%x)+u%x;return c&&l<22&&(w+=x*x*((c<0?-2*c-1:2*c)%(1<<2*(22-l)))),16*(32*w+l)+(r-l)}const dv=[c=>{let r=c.canonical.x-1,l=c.wrap;return r<0&&(r=(1<<c.canonical.z)-1,l--),new Hh(c.overscaledZ,l,c.canonical.z,r,c.canonical.y)},c=>{let r=c.canonical.x+1,l=c.wrap;return r===1<<c.canonical.z&&(r=0,l++),new Hh(c.overscaledZ,l,c.canonical.z,r,c.canonical.y)},c=>new Hh(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Hh(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];mn(Rg,"CanonicalTileID"),mn(Hh,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pv=lo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yy}=pv,E_=lo([{name:"a_pos_3",components:3,type:"Int16"}]);var k_=lo([{name:"a_pos",type:"Int16",components:2}]);function fy(c){return c*R/We}const px=[new Fo([ge,ge,ge],[Ce,Ce,Ce]),new Fo([ge,ge,ge],[0,0,Ce]),new Fo([0,ge,ge],[Ce,0,Ce]),new Fo([ge,0,ge],[0,Ce,Ce]),new Fo([0,0,ge],[Ce,Ce,Ce])];function fv(c,r,l,u=!0){const m=ui([],c._camera.position,c.worldSize),x=[r,l,1,1];Nt(x,x,c.pixelMatrixInverse),Lt(x,x,1/x[3]);const w=Kt([],pr([],x,m)),M=c.globeMatrix,N=[M[12],M[13],M[14]],U=pr([],N,m),K=Ot(U),ee=Kt([],U),oe=c.worldSize/(2*Math.PI),me=Ui(ee,w),we=Math.asin(oe/K);if(we<Math.acos(me)){if(!u)return null;const si=[],Ci=[];ui(si,w,K/me),Kt(Ci,pr(Ci,si,U)),Kt(w,mt(w,U,ui(w,Ci,Math.tan(we)*K)))}const Le=[];new Ta(m,w).closestPointOnSphere(N,oe,Le);const ze=Kt([],Yr(M,0)),qe=Kt([],Yr(M,1)),ot=Kt([],Yr(M,2)),ct=Ui(ze,Le),Re=Ui(qe,Le),tt=Ui(ot,Le),ut=vi(Math.asin(-Re/oe));let Tt=vi(Math.atan2(ct,tt));Tt=c.center.lng+function(si,Ci){const qi=(Ci-si+180)%360-180;return qi<-180?qi+360:qi}(c.center.lng,Tt);const ri=Rt(Tt),Xt=ft(Et(ut),0,1);return new li(ri,Xt)}class fx{constructor(r,l,u){this.a=pr([],r,u),this.b=pr([],l,u),this.center=u;const m=Kt([],this.a),x=Kt([],this.b);this.angle=Math.acos(Ui(m,x))}}function Hm(c,r){if(c.angle===0)return null;let l;return l=c.a[r]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[r]/c.a[r]/Math.sin(c.angle)-1/Math.tan(c.angle)),l<0||l>1?null:function(u,m,x,w){const M=Math.sin(x);return u*(Math.sin((1-w)*x)/M)+m*(Math.sin(w*x)/M)}(c.a[r],c.b[r],c.angle,ft(l,0,1))+c.center[r]}function Kp(c){if(c.z<=1)return px[c.z+2*c.y+c.x];const r=my(Zy(c));return Fo.fromPoints(r)}function Qp(c,r,l){return ui(c,c,1-l),Vt(c,c,r,l)}function z0(c,r,l){for(const u of c)Oi(u,u,r),ui(u,u,l)}function Xy(c,r,l,u){const m=r/c.worldSize,x=c.globeMatrix;if(l.z<=1){const Xt=Kp(l).getCorners();return z0(Xt,x,m),Fo.fromPoints(Xt)}const w=Zy(l,u),M=my(w,R+fy(c._tileCoverLift));z0(M,x,m);const N=Number.MAX_VALUE,U=[-N,-N,-N],K=[N,N,N];if(w.contains(c.center)){for(const Ci of M)Je(K,K,Ci),dt(U,U,Ci);U[2]=0;const Xt=c.point,si=[Xt.x*m,Xt.y*m,0];return Je(K,K,si),dt(U,U,si),new Fo(K,U)}if(c._tileCoverLift>0){for(const Xt of M)Je(K,K,Xt),dt(U,U,Xt);return new Fo(K,U)}const ee=[x[12]*m,x[13]*m,x[14]*m],oe=w.getCenter(),me=ft(c.center.lat,-85.051129,Ki),we=ft(oe.lat,-85.051129,Ki),Le=Rt(c.center.lng),ze=Et(me);let qe=Le-Rt(oe.lng);const ot=ze-Et(we);qe>.5?qe-=1:qe<-.5&&(qe+=1);let ct=0;Math.abs(qe)>Math.abs(ot)?ct=qe>=0?1:3:(ct=ot>=0?0:2,Vt(ee,ee,[x[4]*m,x[5]*m,x[6]*m],-Math.sin(Un(ot>=0?w.getSouth():w.getNorth()))*R));const Re=M[ct],tt=M[(ct+1)%4],ut=new fx(Re,tt,ee),Tt=[Hm(ut,0)||Re[0],Hm(ut,1)||Re[1],Hm(ut,2)||Re[2]],ri=Ef(c.zoom);if(ri>0){const Xt=function({x:Ci,y:qi,z:Fr},gr,Rr,$r,Zi){const Ir=1/(1<<Fr);let Hi=Ci*Ir,Xi=Hi+Ir,jr=qi*Ir,Gr=jr+Ir,Hn=0;const Mn=(Hi+Xi)/2-$r;return Mn>.5?Hn=-1:Mn<-.5&&(Hn=1),Hi=((Hi+Hn)*gr-($r*=gr))*Rr+$r,Xi=((Xi+Hn)*gr-$r)*Rr+$r,jr=(jr*gr-(Zi*=gr))*Rr+Zi,Gr=(Gr*gr-Zi)*Rr+Zi,[[Hi,Gr,0],[Xi,Gr,0],[Xi,jr,0],[Hi,jr,0]]}(l,r,c._pixelsPerMercatorPixel,Le,ze);for(let Ci=0;Ci<M.length;Ci++)Qp(M[Ci],Xt[Ci],ri);const si=mt([],Xt[ct],Xt[(ct+1)%4]);ui(si,si,.5),Qp(Tt,si,ri)}for(const Xt of M)Je(K,K,Xt),dt(U,U,Xt);return K[2]=Math.min(Re[2],tt[2]),Je(K,K,Tt),dt(U,U,Tt),new Fo(K,U)}function Zy({x:c,y:r,z:l},u=!1){const m=1/(1<<l),x=new et(qt(c*m),r===(1<<l)-1&&u?-90:Ei((r+1)*m)),w=new et(qt((c+1)*m),r===0&&u?90:Ei(r*m));return new _t(x,w)}function my(c,r=R){const l=Un(c.getNorth()),u=Un(c.getSouth()),m=Math.cos(l),x=Math.cos(u),w=Math.sin(l),M=Math.sin(u),N=c.getWest(),U=c.getEast();return[$e(x,M,N,r),$e(x,M,U,r),$e(m,w,U,r),$e(m,w,N,r)]}function gy(c,r,l,u){const m=1<<l.z,x=(c/mr+l.x)/m;return Ne(Ei((r/mr+l.y)/m),qt(x),u)}function yy({min:c,max:r}){return se/Math.max(r[0]-c[0],r[1]-c[1],r[2]-c[2])}const A_=new Float64Array(16);function U0(c){const r=yy(c),l=He(A_,[r,r,r]);return le(l,l,Zt([],c.min))}function Ky(c){const r=(u=c.min,(l=A_)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const m=1/yy(c);return Se(r,r,[m,m,m])}function Bg(c){const r=mr/(2*Math.PI);return c/(2*Math.PI)/r}function Fg(c,r){return mr/(512*Math.pow(2,c))*yy(Kp(r))}function mv(c,r,l,u,m){const x=Bg(l),w=[c,r,-l/(2*Math.PI)],M=te(new Float64Array(16));return le(M,M,w),Se(M,M,[x,x,x]),ke(M,M,Un(-m)),Ee(M,M,Un(-u)),M}function Ef(c){return Jt($,Z,c)}function Qy(c,r){const l=Ne(r.lat,r.lng),u=function(we){const Le=Ne(we._center.lat,we._center.lng);let ze=rr([],Ae(0,1,0),Le);const qe=Ye([],-we.angle,Le);ze=Oi(ze,ze,qe),Ye(qe,-we._pitch,ze);const ot=Kt([],Le);return ui(ot,ot,fy(we.cameraToCenterDistance/we.pixelsPerMeter)),Oi(ot,ot,qe),mt([],Le,ot)}(c);return w=(m=bt([],u,l))[0],M=m[1],N=m[2],U=(x=l)[0],K=x[1],ee=x[2],me=(oe=Math.sqrt(w*w+M*M+N*N)*Math.sqrt(U*U+K*K+ee*ee))&&Ui(m,x)/oe,Math.acos(Math.min(Math.max(me,-1),1));var m,x,w,M,N,U,K,ee,oe,me}function Jy(c,r){return Qy(c,r)>Math.PI/2*1.01}const gv=Un(85),$0=Math.cos(gv),yv=Math.sin(gv),mx=Q(),M_=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function _v(c,r,l,u,m,x,w,M,N){if(x&&c.queryGeometry.isAboveHorizon)return!1;x&&(N*=c.pixelToTileUnitsFactor);const U=c.tileID.canonical,K=l.projection.upVectorScale(U,l.center.lat,l.worldSize).metersToTile;for(const ee of r)for(const oe of ee){const me=oe.add(M),we=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(me.x,me.y,!0):0,Le=l.projection.projectTilePoint(me.x,me.y,U);if(we>0){const ct=l.projection.upVector(U,me.x,me.y);Le.x+=ct[0]*K*we,Le.y+=ct[1]*K*we,Le.z+=ct[2]*K*we}const ze=x?me:I_(Le.x,Le.y,Le.z,u),qe=x?c.tilespaceRays.map(ct=>xv(ct,we)):c.queryGeometry.screenGeometry,ot=Nt([],[Le.x,Le.y,Le.z,1],u);if(!w&&x?N*=ot[3]/l.cameraToCenterDistance:w&&!x&&(N*=l.cameraToCenterDistance/ot[3]),x){const ct=Ei((oe.y/mr+U.y)/(1<<U.z));N/=l.projection.pixelsPerMeter(ct,1)/Wt(1,ct)}if(Qd(qe,ze,N))return!0}return!1}function I_(c,r,l,u){const m=Nt([],[c,r,l,1],u);return new fr(m[0]/m[3],m[1]/m[3])}const vv=Ae(0,0,0),e0=Ae(0,0,1);function xv(c,r){const l=At();return vv[2]=r,c.intersectsPlane(vv,e0,l),new fr(l[0],l[1])}class bv extends nu{}let wv,ld,ve,v;function k(c,{width:r,height:l},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*l*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*l*u);return c.width=r,c.height=l,c.data=m,c}function D(c,r,l){const{width:u,height:m}=r;u===c.width&&m===c.height||(V(c,r,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},l,null),c.width=u,c.height=m,c.data=r.data)}function V(c,r,l,u,m,x,w,M){if(m.width===0||m.height===0)return r;if(m.width>c.width||m.height>c.height||l.x>c.width-m.width||l.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||u.x>r.width-m.width||u.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const N=c.data,U=r.data,K=x===4&&M;for(let ee=0;ee<m.height;ee++){const oe=((l.y+ee)*c.width+l.x)*x,me=((u.y+ee)*r.width+u.x)*x;if(K)for(let we=0;we<m.width;we++){const Le=oe+we*x+3,ze=me+we*x;U[ze+0]=255,U[ze+1]=255,U[ze+2]=255,U[ze+3]=N[Le]}else if(w)for(let we=0;we<m.width;we++){const Le=oe+we*x,ze=me+we*x,qe=new ao(N[Le+0]/255,N[Le+1]/255,N[Le+2]/255,N[Le+3]).toNonPremultipliedRenderColor(w).toArray();U[ze+0]=qe[0],U[ze+1]=qe[1],U[ze+2]=qe[2],U[ze+3]=qe[3]}else for(let we=0;we<m.width*x;we++)U[me+we]=N[oe+we]}return r}mn(bv,"HeatmapBucket",{omit:["layers"]});class H{constructor(r,l){k(this,r,1,l)}resize(r){D(this,new H(r),1)}clone(){return new H({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,m,x){V(r,l,u,m,x,1,null)}}class Y{constructor(r,l){k(this,r,4,l)}resize(r){D(this,new Y(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Y({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,m,x,w,M){V(r,l,u,m,x,4,w,M)}}class J{constructor(r,l){this.width=r.width,this.height=r.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function ae(c){const r={},l=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new Y({width:l,height:u}),x=(w,M,N)=>{r[c.evaluationKey]=N;const U=c.expression.evaluate(r),K=U?U.toNonPremultipliedRenderColor(null):null;K&&(m.data[w+M+0]=Math.floor(255*K.r),m.data[w+M+1]=Math.floor(255*K.g),m.data[w+M+2]=Math.floor(255*K.b),m.data[w+M+3]=Math.floor(255*K.a))};if(c.clips)for(let w=0,M=0;w<u;++w,M+=4*l)for(let N=0,U=0;N<l;N++,U+=4){const K=N/(l-1),{start:ee,end:oe}=c.clips[w];x(M,U,ee*(1-K)+oe*K)}else for(let w=0,M=0;w<l;w++,M+=4)x(0,M,w/(l-1));return m}mn(H,"AlphaImage"),mn(Y,"RGBAImage");const _e=lo([{name:"a_pos",components:2,type:"Int16"}],4),Me=lo([{name:"a_road_z_offset",components:1,type:"Float32"}],4),xe=lo([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Pe=lo([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function je(c,r,l=2){const u=r&&r.length,m=u?r[0]*l:c.length;let x=Qe(c,0,m,l,!0);const w=[];if(!x||x.next===x.prev)return w;let M,N,U;if(u&&(x=function(K,ee,oe,me){const we=[];for(let Le=0,ze=ee.length;Le<ze;Le++){const qe=Qe(K,ee[Le]*me,Le<ze-1?ee[Le+1]*me:K.length,me,!1);qe===qe.next&&(qe.steiner=!0),we.push(wr(qe))}we.sort(ki);for(let Le=0;Le<we.length;Le++)oe=Ri(we[Le],oe);return oe}(c,r,x,l)),c.length>80*l){M=1/0,N=1/0;let K=-1/0,ee=-1/0;for(let oe=l;oe<m;oe+=l){const me=c[oe],we=c[oe+1];me<M&&(M=me),we<N&&(N=we),me>K&&(K=me),we>ee&&(ee=we)}U=Math.max(K-M,ee-N),U=U!==0?32767/U:0}return nt(x,w,l,M,N,U,0),w}function Qe(c,r,l,u,m){let x;if(m===function(w,M,N,U){let K=0;for(let ee=M,oe=N-U;ee<N;ee+=U)K+=(w[oe]-w[ee])*(w[ee+1]+w[oe+1]),oe=ee;return K}(c,r,l,u)>0)for(let w=r;w<l;w+=u)x=Ea(w/u|0,c[w],c[w+1],x);else for(let w=l-u;w>=r;w-=u)x=Ea(w/u|0,c[w],c[w+1],x);return x&&ms(x,x.next)&&(ka(x),x=x.next),x}function at(c,r){if(!c)return c;r||(r=c);let l,u=c;do if(l=!1,u.steiner||!ms(u,u.next)&&fn(u.prev,u,u.next)!==0)u=u.next;else{if(ka(u),u=r=u.prev,u===u.next)break;l=!0}while(l||u!==r);return r}function nt(c,r,l,u,m,x,w){if(!c)return;!w&&x&&function(N,U,K,ee){let oe=N;do oe.z===0&&(oe.z=hr(oe.x,oe.y,U,K,ee)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==N);oe.prevZ.nextZ=null,oe.prevZ=null,function(me){let we,Le=1;do{let ze,qe=me;me=null;let ot=null;for(we=0;qe;){we++;let ct=qe,Re=0;for(let ut=0;ut<Le&&(Re++,ct=ct.nextZ,ct);ut++);let tt=Le;for(;Re>0||tt>0&&ct;)Re!==0&&(tt===0||!ct||qe.z<=ct.z)?(ze=qe,qe=qe.nextZ,Re--):(ze=ct,ct=ct.nextZ,tt--),ot?ot.nextZ=ze:me=ze,ze.prevZ=ot,ot=ze;qe=ct}ot.nextZ=null,Le*=2}while(we>1)}(oe)}(c,u,m,x);let M=c;for(;c.prev!==c.next;){const N=c.prev,U=c.next;if(x?wt(c,u,m,x):it(c))r.push(N.i,c.i,U.i),ka(c),c=U.next,M=U.next;else if((c=U)===M){w?w===1?nt(c=kt(at(c),r),r,l,u,m,x,2):w===2&&Ai(c,r,l,u,m,x):nt(at(c),r,l,u,m,x,1);break}}}function it(c){const r=c.prev,l=c,u=c.next;if(fn(r,l,u)>=0)return!1;const m=r.x,x=l.x,w=u.x,M=r.y,N=l.y,U=u.y,K=Math.min(m,x,w),ee=Math.min(M,N,U),oe=Math.max(m,x,w),me=Math.max(M,N,U);let we=u.next;for(;we!==r;){if(we.x>=K&&we.x<=oe&&we.y>=ee&&we.y<=me&&yn(m,M,x,N,w,U,we.x,we.y)&&fn(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function wt(c,r,l,u){const m=c.prev,x=c,w=c.next;if(fn(m,x,w)>=0)return!1;const M=m.x,N=x.x,U=w.x,K=m.y,ee=x.y,oe=w.y,me=Math.min(M,N,U),we=Math.min(K,ee,oe),Le=Math.max(M,N,U),ze=Math.max(K,ee,oe),qe=hr(me,we,r,l,u),ot=hr(Le,ze,r,l,u);let ct=c.prevZ,Re=c.nextZ;for(;ct&&ct.z>=qe&&Re&&Re.z<=ot;){if(ct.x>=me&&ct.x<=Le&&ct.y>=we&&ct.y<=ze&&ct!==m&&ct!==w&&yn(M,K,N,ee,U,oe,ct.x,ct.y)&&fn(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,Re.x>=me&&Re.x<=Le&&Re.y>=we&&Re.y<=ze&&Re!==m&&Re!==w&&yn(M,K,N,ee,U,oe,Re.x,Re.y)&&fn(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;ct&&ct.z>=qe;){if(ct.x>=me&&ct.x<=Le&&ct.y>=we&&ct.y<=ze&&ct!==m&&ct!==w&&yn(M,K,N,ee,U,oe,ct.x,ct.y)&&fn(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;Re&&Re.z<=ot;){if(Re.x>=me&&Re.x<=Le&&Re.y>=we&&Re.y<=ze&&Re!==m&&Re!==w&&yn(M,K,N,ee,U,oe,Re.x,Re.y)&&fn(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function kt(c,r){let l=c;do{const u=l.prev,m=l.next.next;!ms(u,m)&&hs(u,l,l.next,m)&&us(u,m)&&us(m,u)&&(r.push(u.i,l.i,m.i),ka(l),ka(l.next),l=c=m),l=l.next}while(l!==c);return at(l)}function Ai(c,r,l,u,m,x){let w=c;do{let M=w.next.next;for(;M!==w.prev;){if(w.i!==M.i&&Rn(w,M)){let N=oa(w,M);return w=at(w,w.next),N=at(N,N.next),nt(w,r,l,u,m,x,0),void nt(N,r,l,u,m,x,0)}M=M.next}w=w.next}while(w!==c)}function ki(c,r){let l=c.x-r.x;return l===0&&(l=c.y-r.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(r.next.y-r.y)/(r.next.x-r.x)),l}function Ri(c,r){const l=function(m,x){let w=x;const M=m.x,N=m.y;let U,K=-1/0;if(ms(m,w))return w;do{if(ms(m,w.next))return w.next;if(N<=w.y&&N>=w.next.y&&w.next.y!==w.y){const Le=w.x+(N-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(Le<=M&&Le>K&&(K=Le,U=w.x<w.next.x?w:w.next,Le===M))return U}w=w.next}while(w!==x);if(!U)return null;const ee=U,oe=U.x,me=U.y;let we=1/0;w=U;do{if(M>=w.x&&w.x>=oe&&M!==w.x&&Jr(N<me?M:K,N,oe,me,N<me?K:M,N,w.x,w.y)){const Le=Math.abs(N-w.y)/(M-w.x);us(w,m)&&(Le<we||Le===we&&(w.x>U.x||w.x===U.x&&Sr(U,w)))&&(U=w,we=Le)}w=w.next}while(w!==ee);return U}(c,r);if(!l)return r;const u=oa(l,c);return at(u,u.next),at(l,l.next)}function Sr(c,r){return fn(c.prev,c,r.prev)<0&&fn(r.next,c,c.next)<0}function hr(c,r,l,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function wr(c){let r=c,l=c;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==c);return l}function Jr(c,r,l,u,m,x,w,M){return(m-w)*(r-M)>=(c-w)*(x-M)&&(c-w)*(u-M)>=(l-w)*(r-M)&&(l-w)*(x-M)>=(m-w)*(u-M)}function yn(c,r,l,u,m,x,w,M){return!(c===w&&r===M)&&Jr(c,r,l,u,m,x,w,M)}function Rn(c,r){return c.next.i!==r.i&&c.prev.i!==r.i&&!function(l,u){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==u.i&&m.next.i!==u.i&&hs(m,m.next,l,u))return!0;m=m.next}while(m!==l);return!1}(c,r)&&(us(c,r)&&us(r,c)&&function(l,u){let m=l,x=!1;const w=(l.x+u.x)/2,M=(l.y+u.y)/2;do m.y>M!=m.next.y>M&&m.next.y!==m.y&&w<(m.next.x-m.x)*(M-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next;while(m!==l);return x}(c,r)&&(fn(c.prev,c,r.prev)||fn(c,r.prev,r))||ms(c,r)&&fn(c.prev,c,c.next)>0&&fn(r.prev,r,r.next)>0)}function fn(c,r,l){return(r.y-c.y)*(l.x-r.x)-(r.x-c.x)*(l.y-r.y)}function ms(c,r){return c.x===r.x&&c.y===r.y}function hs(c,r,l,u){const m=jn(fn(c,r,l)),x=jn(fn(c,r,u)),w=jn(fn(l,u,c)),M=jn(fn(l,u,r));return m!==x&&w!==M||!(m!==0||!Is(c,l,r))||!(x!==0||!Is(c,u,r))||!(w!==0||!Is(l,c,u))||!(M!==0||!Is(l,r,u))}function Is(c,r,l){return r.x<=Math.max(c.x,l.x)&&r.x>=Math.min(c.x,l.x)&&r.y<=Math.max(c.y,l.y)&&r.y>=Math.min(c.y,l.y)}function jn(c){return c>0?1:c<0?-1:0}function us(c,r){return fn(c.prev,c,c.next)<0?fn(c,r,c.next)>=0&&fn(c,c.prev,r)>=0:fn(c,r,c.prev)<0||fn(c,c.next,r)<0}function oa(c,r){const l=Mh(c.i,c.x,c.y),u=Mh(r.i,r.x,r.y),m=c.next,x=r.prev;return c.next=r,r.prev=c,l.next=m,m.prev=l,u.next=l,l.prev=u,x.next=u,u.prev=x,u}function Ea(c,r,l,u){const m=Mh(c,r,l);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function ka(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Mh(c,r,l){return{i:c,x:r,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function da(c,r){const l=c.length;if(l<=1)return[c];const u=[];let m,x;for(let w=0;w<l;w++){const M=ds(c[w]);M!==0&&(c[w].area=Math.abs(M),x===void 0&&(x=M<0),x===M<0?(m&&u.push(m),m=[c[w]]):m.push(c[w]))}if(m&&u.push(m),r>1)for(let w=0;w<u.length;w++)u[w].length<=r||(ea(u[w],r,1,u[w].length-1,Ol),u[w]=u[w].slice(0,r));return u}function Ol(c,r){return r.area-c.area}function Co(c,r,l=1){if(!c)return null;const u=typeof c=="string"?Li.from(c).getPrimary():c.getPrimary(),m=typeof c=="string"?null:c.getSecondary();for(const x of[u,m]){if(!x)continue;const w=x.id.toString();r.has(w)||r.set(w,[]),x.scaleSelf(l),r.get(w).push(x)}return{primary:u.toString(),secondary:m?m.toString():null}}function Os(c,r,l,u){const m=u.patternDependencies;let x=!1;for(const w of r){const M=w.paint.get(`${c}-pattern`);M.isConstant()||(x=!0),Co(M.constantOr(null),m,l)&&(x=!0)}return x}function Us(c,r,l,u,m,x){const w=x.patternDependencies;for(const M of r){const N=M.paint.get(`${c}-pattern`).value;if(N.kind!=="constant"){let U=N.evaluate({zoom:u},l,{},x.availableImages);U=U&&U.name?U.name:U;const K=Co(U,w,m);if(!K)continue;const{primary:ee,secondary:oe}=K;ee&&(l.patterns[M.id]=[ee,oe].filter(Boolean))}}return l}class tl{constructor(){this.polygons=new Map}add(r,...l){this.polygons.has(r)?this.polygons.get(r).push(...l):this.polygons.set(r,l)}merge(r){for(const[l,u]of r.polygons)this.add(l,...u)}}class pa{constructor(){this.portals=[]}static evaluate(r){if(r.length===0)return new pa;let l=[];for(const U of r)l.push(...U.portals);if(l.length===0)return new pa;const u=(U,K)=>U<=0&&K<=0||U>=mr&&K>=mr;for(const U of l){const K=U.va,ee=U.vb;(u(K.x,ee.x)||u(K.y,ee.y))&&(U.type="border")}const m=l.filter(U=>U.type!=="unevaluated"),x=l.filter(U=>U.type==="unevaluated");if(x.length===0)return new pa;x.sort((U,K)=>U.hash===K.hash?U.isTunnel===K.isTunnel?0:U.isTunnel?-1:1:U.hash<K.hash?1:-1),l=m.concat(x);let w=m.length,M=w,N=w;do if(M++,M===l.length||l[w].hash!==l[M].hash){if(M-w==2){N<w&&(l[N]=l[w],l[w]=null);const U=l[N],K=l[M-1];U.type=U.isTunnel!==K.isTunnel?"tunnel":"polygon",U.connection={a:U.connection.a,b:K.connection.a},N++}w=M}while(w!==l.length);return l.splice(N),l.sort((U,K)=>U.hash<K.hash?1:-1),{portals:l}}}mn(pa,"ElevationPortalGraph"),mn(tl,"ElevationPolygons");class Ih{constructor(r,l,u){this.outPositions=r,this.outNormals=l,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(r,l,u){let m=r[2];u!=null&&(m*=u);const x=this.getVec3Bits(r)<<96n|this.getVec3Bits(l),w=this.vertexLookup.get(x);if(w!=null)return w;const M=this.outPositions.length;this.vertexLookup.set(x,M);const N=Math.trunc(16384*l[0]),U=Math.trunc(16384*l[1]),K=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(r[0],r[1],m),this.outNormals.emplaceBack(N,U,K),M}addVertices(r,l,...u){const m=[];for(const x of u){const w=this.addVertex(x,r,l);m.push(w)}return m}addTriangles(r,l,u){if(l&&u){const m=u.length===1,x=Ae(0,0,0);for(let w=0;w<r.length;w+=3){const M=l[r[w+0]],N=l[r[w+1]],U=l[r[w+2]],K=m?u[0]:u[r[w+1]],ee=m?u[0]:u[r[w+2]],oe=this.addVertex(Ae(M.x,M.y,m?u[0]:u[r[w+0]]),x),me=this.addVertex(Ae(N.x,N.y,K),x),we=this.addVertex(Ae(U.x,U.y,ee),x);this.outIndices.emplaceBack(oe,me,we)}}else for(let m=0;m<r.length;m+=3)this.outIndices.emplaceBack(r[m+0],r[m+1],r[m+2])}addQuad(r,l){const u=this.addVertices(l,void 0,...r.map(N=>Ae(N.coord.x,N.coord.y,N.height))),[m,x,w,M]=u;this.addTriangles([m,x,w,w,M,m])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(r){return this.view.setFloat32(0,r),BigInt(this.view.getUint32(0))}getVec3Bits(r){return this.getBits(r[0])<<64n|this.getBits(r[1])<<32n|this.getBits(r[2])}}class nh{constructor(r,l,u,m){this.unevaluatedPortals=new pa,this.portalPolygons=new tl,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Gd,this.vertexNormals=new im,this.indexArray=new Ac,this.tileToMeters=$i(r),this.bridgeProgramConfigurations=new g(l,{zoom:u,lut:m},x=>x!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new g(l,{zoom:u,lut:m},x=>x!=="fill-bridge-guard-rail-color")}addVertices(r,l){const u=this.unevalVertices.length;for(let m=0;m<r.length;m++)this.unevalVertices.push(r[m]),this.unevalHeights.push(l[m]);return u}addTriangles(r,l,u){const m=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of r)m.push(x+l)}addRenderableRing(r,l,u,m,x,w){const M=[new fr(x.min.x,x.min.y),new fr(x.max.x,x.min.y),new fr(x.max.x,x.max.y),new fr(x.min.x,x.max.y)];for(let N=0;N<u-1;N++){const U=l+N,K=U+1,ee=this.unevalVertices[U],oe=this.unevalVertices[K];if(!(ee.x>=x.min.x&&ee.x<=x.max.x&&ee.y>=x.min.y&&ee.y<=x.max.y||oe.x>=x.min.x&&oe.x<=x.max.x&&oe.y>=x.min.y&&oe.y<=x.max.y||Sp(ee,oe,M))||this.isOnBorder(ee.x,oe.x)||this.isOnBorder(ee.y,oe.y))continue;const me=nh.computeEdgeHash(this.unevalVertices[U],this.unevalVertices[K]);let we,Le=this.vertexHashLookup.get(nh.computePosHash(ee));Le!=null?we=Le.next:(Le=this.vertexHashLookup.get(nh.computePosHash(oe)),we=Le!=null?Le.prev:me),this.unevalEdges.push({polygonIdx:r,a:U,b:K,hash:me,portalHash:we,isTunnel:m,type:"unevaluated",featureInfo:w})}}addPortalCandidates(r,l,u,m,x){if(l.length===0)return;this.portalPolygons.add(r,{geometry:l,zLevel:x});const w=l[0];this.vertexHashLookup.clear();let M=nh.computeEdgeHash(w[w.length-2],w[w.length-1]);for(let N=0;N<w.length-1;N++){const U=w[N+0],K=w[N+1],ee=bs(K.x-U.x,K.y-U.y),oe=Ln(ee);if(oe===0)continue;let me="unevaluated";const we=m.pointElevation(U),Le=m.pointElevation(K);Math.abs(we)<.01&&Math.abs(Le)<.01?me="entrance":(this.isOnBorder(U.x,K.x)||this.isOnBorder(U.y,K.y))&&(me="border");const ze=nh.computeEdgeHash(U,K);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:U,vb:K,vab:ee,length:oe,hash:ze,isTunnel:u,type:me});const qe=nh.computePosHash(U);this.vertexHashLookup.set(qe,{prev:M,next:ze}),M=ze}}construct(r){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=oe=>{oe.primitiveLength=this.indexArray.length-oe.primitiveOffset},m=new Ih(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const x=l(),w=l(),M=l(),N=(oe,me)=>{oe.sort((Le,ze)=>Le.type===me&&ze.type!==me?-1:Le.type!==me&&ze.type===me?1:0);const we=oe.findIndex(Le=>Le.type!==me);return we>=0?we:oe.length};let U=0;this.unevalEdges.length>0&&(U=N(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:U},this.tileToMeters)),u(M);const K=l(),ee=l();if(this.unevalEdges.length>0){const oe=this.unevalEdges.splice(U),me=N(oe,"tunnel")+U;this.unevalEdges.push(...oe),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:U},{min:U,max:me})}u(K),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(ee),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(w),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(x),this.maskSegments=nl.simpleSegment(0,ee.primitiveOffset,0,ee.primitiveLength),this.depthSegments=nl.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableBridgeSegments=nl.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.renderableTunnelSegments=nl.simpleSegment(0,K.primitiveOffset,0,K.primitiveLength),this.shadowCasterSegments=nl.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(r,l,u,m,x,w,M,N){this.bridgeProgramConfigurations.updatePaintArrays(r,l,x,u,m,w,M,N),this.tunnelProgramConfigurations.updatePaintArrays(r,l,x,u,m,w,M,N)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,xe.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,Pe.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,l,u,m,x){const w=(M,N)=>{for(let U=0;U<N.length-1;U++){const K=N[U].featureIndex,ee=N[U+1].vertexStart,oe=r.feature(K);M.populatePaintArrays(ee,oe,K,{},u,l,m,void 0,x)}};w(this.bridgeProgramConfigurations,this.bridgeFeatureSections),w(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,l,u,m,x){const w=new Map;for(let M=m;M<x;M++){const N=u[M],U=N.a,K=N.b,ee=nh.computePosHash(r[U]),oe=nh.computePosHash(r[K]);w.has(ee)||w.set(ee,{}),w.has(oe)||w.set(oe,{});const me=w.get(ee),we=w.get(oe);l[U]<=0&&l[K]<=0||(me.to=K,we.from=U)}return w}constructBridgeStructures(r,l,u,m,x,w){r.clearVertexLookup();const M=this.computeVertexConnections(l,u,m,x.min,x.max),N=1/w,U=.5*N,K=me=>Ae(l[me].x,l[me].y,u[me]*N),ee=me=>{const we=M.get(nh.computePosHash(l[me])),Le=we.from,ze=we.to;if(!Le||!ze)return;const qe=K(Le),ot=K(me),ct=K(ze),Re=Ae(0,0,0);if(!nn(qe,ot)){const ut=pr(At(),ot,qe);mt(Re,Re,Kt(ut,ut))}if(!nn(ct,ot)){const ut=pr(At(),ct,ot);mt(Re,Re,Kt(ut,ut))}const tt=ni(Re);return tt>0?ui(Re,Re,1/tt):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(m,x.min,x.max,(me,we)=>me.featureInfo.featureIndex-we.featureInfo.featureIndex);for(let me=x.min;me<x.max;me++){const we=m[me];if(!we.featureInfo.guardRailEnabled)continue;const Le=this.prepareEdgePoints(l,u,we,(Ss,En)=>Ss>En);if(Le==null)continue;const ze=Le[0],qe=Le[1],ot=Ae(ze.coord.x,ze.coord.y,N*ze.height),ct=Ae(qe.coord.x,qe.coord.y,N*qe.height);if(nn(ot,ct))continue;const Re=pr(At(),ct,ot);Kt(Re,Re);const tt=Ss=>Kt(Ss,Ss),ut=ee(we.a)||Re,Tt=ee(we.b)||Re,ri=tt(Ae(ut[1],-ut[0],0)),Xt=tt(Ae(Tt[1],-Tt[0],0)),si=tt(rr(At(),ri,ut)),Ci=tt(rr(At(),Xt,Tt)),qi=At(),Fr=[mt(At(),ot,ui(qi,pr(qi,ri,si),U)),mt(At(),ot,ui(qi,mt(qi,ri,si),U)),mt(At(),ot,ui(qi,si,U)),ot],gr=[mt(At(),ct,ui(qi,pr(qi,Xt,Ci),U)),mt(At(),ct,ui(qi,mt(qi,Xt,Ci),U)),mt(At(),ct,ui(qi,Ci,U)),ct];oe=this.addFeatureSection(we.featureInfo.featureIndex,oe,this.bridgeFeatureSections,r);const[Rr,$r]=r.addVertices(ri,w,Fr[0],Fr[1]),[Zi,Ir]=r.addVertices(Xt,w,gr[0],gr[1]);r.addTriangles([Rr,$r,Zi,$r,Ir,Zi]);const[Hi,Xi]=r.addVertices(si,w,Fr[1],Fr[2]),[jr,Gr]=r.addVertices(Ci,w,gr[1],gr[2]);r.addTriangles([Hi,Xi,jr,Xi,Gr,jr]);const[Hn,Mn]=r.addVertices(Zt(ri,ri),w,Fr[2],Fr[3]),[hn,Wr]=r.addVertices(Zt(Xt,Xt),w,gr[2],gr[3]);r.addTriangles([Hn,Mn,hn,Mn,Wr,hn])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,l,u,m,x,w){r.clearVertexLookup();let M=Number.POSITIVE_INFINITY;const N=(K,ee)=>K.featureInfo.featureIndex-ee.featureInfo.featureIndex;this.sortSubarray(m,x.min,x.max,N),this.sortSubarray(m,w.min,w.max,N);const U=K=>Kt(K,K);for(let K=x.min;K<x.max;K++){const ee=this.prepareEdgePoints(l,u,m[K],(Le,ze)=>Le<ze);if(ee==null)continue;const[oe,me]=ee,we=U(Ae(-(me.coord.y-oe.coord.y),me.coord.x-oe.coord.x,0));M=this.addFeatureSection(m[K].featureInfo.featureIndex,M,this.tunnelFeatureSections,r),r.addQuad([oe,me,{coord:me.coord,height:m[K].isTunnel?-.1:0},{coord:oe.coord,height:m[K].isTunnel?-.1:0}],we)}for(let K=w.min;K<w.max;K++){const ee=m[K];ee.isTunnel&&([ee.a,ee.b]=[ee.b,ee.a]);const oe=l[ee.a],me=l[ee.b],we=U(Ae(-(me.y-oe.y),me.x-oe.x,0));M=this.addFeatureSection(ee.featureInfo.featureIndex,M,this.tunnelFeatureSections,r),r.addQuad([{coord:me,height:0},{coord:oe,height:0},{coord:oe,height:u[ee.a]+4},{coord:me,height:u[ee.b]+4}],we),r.addQuad([{coord:oe,height:0},{coord:me,height:0},{coord:me,height:u[ee.b]+4},{coord:oe,height:u[ee.a]+4}],we)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}prepareEdgePoints(r,l,u,m){let x=l[u.a],w=l[u.b];const M=m(x,0),N=m(w,0);if(M&&N)return[{coord:r[u.a],height:x},{coord:r[u.b],height:w}];if(!M&&!N)return;const U=r[u.a].clone(),K=r[u.b].clone();if(M){if(!N){const ee=w/(w-x);K.x=kn(K.x,U.x,ee),K.y=kn(K.y,U.y,ee),w=kn(w,x,ee)}}else{const ee=x/(x-w);U.x=kn(U.x,K.x,ee),U.y=kn(U.y,K.y,ee),x=kn(x,w,ee)}return[{coord:U,height:x},{coord:K,height:w}]}prepareEdges(r,l){if(l.length===0)return;l.sort((M,N)=>M.hash===N.hash?N.polygonIdx-M.polygonIdx:N.hash>M.hash?1:-1);let u=0,m=0,x=0,w=l[u].polygonIdx;do m++,(m===l.length||l[u].hash!==l[m].hash)&&((m-u==1||l[m-1].polygonIdx!==w)&&(x<u&&(l[x]=l[u],l[u]=null),l[x].type="none",x++),u=m,u!==l.length&&(w=l[u].polygonIdx));while(u!==l.length);if(l.splice(x),l.length!==0&&r.length!==0){l.sort((U,K)=>U.portalHash<K.portalHash?1:-1);let M=0,N=0;for(;M!==l.length&&N!==r.length;){const U=l[M],K=r[N];U.portalHash>K.hash?M++:K.hash>U.portalHash?N++:(U.type=K.type,M++)}}}isOnBorder(r,l){return r<=0&&l<=0||r>=mr&&l>=mr}addFeatureSection(r,l,u,m){return r!==l&&(l=r,u.push({featureIndex:r,vertexStart:m.getVertexCount()}),m.clearVertexLookup()),l}sortSubarray(r,l,u,m){const x=r.slice(l,u);x.sort(m),r.splice(l,x.length,...x)}static computeEdgeHash(r,l){return(r.y===l.y&&r.x>l.x||r.y>l.y)&&([r,l]=[l,r]),BigInt(nh.computePosHash(r))<<32n|BigInt(nh.computePosHash(l))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var va,ou={exports:{}},Lh=(va||(va=1,function(c,r){(function(l){function u(yt,Mt){return yt>Mt?1:yt<Mt?-1:0}var m=function(yt,Mt){yt===void 0&&(yt=u),Mt===void 0&&(Mt=!1),this._compare=yt,this._root=null,this._size=0,this._noDuplicates=!!Mt},x={size:{configurable:!0}};function w(yt,Mt,ir,Zr,un){var an=un-Zr;if(an>0){var Sn=Zr+Math.floor(an/2),rs={key:Mt[Sn],data:ir[Sn],parent:yt};return rs.left=w(rs,Mt,ir,Zr,Sn),rs.right=w(rs,Mt,ir,Sn+1,un),rs}return null}function M(yt,Mt,ir,Zr,un){if(!(ir>=Zr)){for(var an=yt[ir+Zr>>1],Sn=ir-1,rs=Zr+1;;){do Sn++;while(un(yt[Sn],an)<0);do rs--;while(un(yt[rs],an)>0);if(Sn>=rs)break;var go=yt[Sn];yt[Sn]=yt[rs],yt[rs]=go,go=Mt[Sn],Mt[Sn]=Mt[rs],Mt[rs]=go}M(yt,Mt,ir,rs,un),M(yt,Mt,rs+1,Zr,un)}}m.prototype.rotateLeft=function(yt){var Mt=yt.right;Mt&&(yt.right=Mt.left,Mt.left&&(Mt.left.parent=yt),Mt.parent=yt.parent),yt.parent?yt===yt.parent.left?yt.parent.left=Mt:yt.parent.right=Mt:this._root=Mt,Mt&&(Mt.left=yt),yt.parent=Mt},m.prototype.rotateRight=function(yt){var Mt=yt.left;Mt&&(yt.left=Mt.right,Mt.right&&(Mt.right.parent=yt),Mt.parent=yt.parent),yt.parent?yt===yt.parent.left?yt.parent.left=Mt:yt.parent.right=Mt:this._root=Mt,Mt&&(Mt.right=yt),yt.parent=Mt},m.prototype._splay=function(yt){for(;yt.parent;){var Mt=yt.parent;Mt.parent?Mt.left===yt&&Mt.parent.left===Mt?(this.rotateRight(Mt.parent),this.rotateRight(Mt)):Mt.right===yt&&Mt.parent.right===Mt?(this.rotateLeft(Mt.parent),this.rotateLeft(Mt)):Mt.left===yt&&Mt.parent.right===Mt?(this.rotateRight(Mt),this.rotateLeft(Mt)):(this.rotateLeft(Mt),this.rotateRight(Mt)):Mt.left===yt?this.rotateRight(Mt):this.rotateLeft(Mt)}},m.prototype.splay=function(yt){for(var Mt,ir,Zr,un,an;yt.parent;)(ir=(Mt=yt.parent).parent)&&ir.parent?((Zr=ir.parent).left===ir?Zr.left=yt:Zr.right=yt,yt.parent=Zr):(yt.parent=null,this._root=yt),un=yt.left,an=yt.right,yt===Mt.left?(ir&&(ir.left===Mt?(Mt.right?(ir.left=Mt.right,ir.left.parent=ir):ir.left=null,Mt.right=ir,ir.parent=Mt):(un?(ir.right=un,un.parent=ir):ir.right=null,yt.left=ir,ir.parent=yt)),an?(Mt.left=an,an.parent=Mt):Mt.left=null,yt.right=Mt,Mt.parent=yt):(ir&&(ir.right===Mt?(Mt.left?(ir.right=Mt.left,ir.right.parent=ir):ir.right=null,Mt.left=ir,ir.parent=Mt):(an?(ir.left=an,an.parent=ir):ir.left=null,yt.right=ir,ir.parent=yt)),un?(Mt.right=un,un.parent=Mt):Mt.right=null,yt.left=Mt,Mt.parent=yt)},m.prototype.replace=function(yt,Mt){yt.parent?yt===yt.parent.left?yt.parent.left=Mt:yt.parent.right=Mt:this._root=Mt,Mt&&(Mt.parent=yt.parent)},m.prototype.minNode=function(yt){if(yt===void 0&&(yt=this._root),yt)for(;yt.left;)yt=yt.left;return yt},m.prototype.maxNode=function(yt){if(yt===void 0&&(yt=this._root),yt)for(;yt.right;)yt=yt.right;return yt},m.prototype.insert=function(yt,Mt){var ir=this._root,Zr=null,un=this._compare;if(this._noDuplicates)for(;ir;){if(Zr=ir,un(ir.key,yt)===0)return;ir=un(ir.key,yt)<0?ir.right:ir.left}else for(;ir;)Zr=ir,ir=un(ir.key,yt)<0?ir.right:ir.left;return ir={key:yt,data:Mt,left:null,right:null,parent:Zr},Zr?un(Zr.key,ir.key)<0?Zr.right=ir:Zr.left=ir:this._root=ir,this.splay(ir),this._size++,ir},m.prototype.find=function(yt){for(var Mt=this._root,ir=this._compare;Mt;){var Zr=ir(Mt.key,yt);if(Zr<0)Mt=Mt.right;else{if(!(Zr>0))return Mt;Mt=Mt.left}}return null},m.prototype.contains=function(yt){for(var Mt=this._root,ir=this._compare;Mt;){var Zr=ir(yt,Mt.key);if(Zr===0)return!0;Mt=Zr<0?Mt.left:Mt.right}return!1},m.prototype.remove=function(yt){var Mt=this.find(yt);if(!Mt)return!1;if(this.splay(Mt),Mt.left)if(Mt.right){var ir=this.minNode(Mt.right);ir.parent!==Mt&&(this.replace(ir,ir.right),ir.right=Mt.right,ir.right.parent=ir),this.replace(Mt,ir),ir.left=Mt.left,ir.left.parent=ir}else this.replace(Mt,Mt.left);else this.replace(Mt,Mt.right);return this._size--,!0},m.prototype.removeNode=function(yt){if(!yt)return!1;if(this.splay(yt),yt.left)if(yt.right){var Mt=this.minNode(yt.right);Mt.parent!==yt&&(this.replace(Mt,Mt.right),Mt.right=yt.right,Mt.right.parent=Mt),this.replace(yt,Mt),Mt.left=yt.left,Mt.left.parent=Mt}else this.replace(yt,yt.left);else this.replace(yt,yt.right);return this._size--,!0},m.prototype.erase=function(yt){var Mt=this.find(yt);if(Mt){this.splay(Mt);var ir=Mt.left,Zr=Mt.right,un=null;ir&&(ir.parent=null,un=this.maxNode(ir),this.splay(un),this._root=un),Zr&&(ir?un.right=Zr:this._root=Zr,Zr.parent=un),this._size--}},m.prototype.pop=function(){var yt=this._root,Mt=null;if(yt){for(;yt.left;)yt=yt.left;Mt={key:yt.key,data:yt.data},this.remove(yt.key)}return Mt},m.prototype.next=function(yt){var Mt=yt;if(Mt)if(Mt.right)for(Mt=Mt.right;Mt&&Mt.left;)Mt=Mt.left;else for(Mt=yt.parent;Mt&&Mt.right===yt;)yt=Mt,Mt=Mt.parent;return Mt},m.prototype.prev=function(yt){var Mt=yt;if(Mt)if(Mt.left)for(Mt=Mt.left;Mt&&Mt.right;)Mt=Mt.right;else for(Mt=yt.parent;Mt&&Mt.left===yt;)yt=Mt,Mt=Mt.parent;return Mt},m.prototype.forEach=function(yt){for(var Mt=this._root,ir=[],Zr=!1,un=0;!Zr;)Mt?(ir.push(Mt),Mt=Mt.left):ir.length>0?(yt(Mt=ir.pop(),un++),Mt=Mt.right):Zr=!0;return this},m.prototype.range=function(yt,Mt,ir,Zr){for(var un=[],an=this._compare,Sn=this._root;un.length!==0||Sn;)if(Sn)un.push(Sn),Sn=Sn.left;else{if(an((Sn=un.pop()).key,Mt)>0)break;if(an(Sn.key,yt)>=0&&ir.call(Zr,Sn))return this;Sn=Sn.right}return this},m.prototype.keys=function(){for(var yt=this._root,Mt=[],ir=[],Zr=!1;!Zr;)yt?(Mt.push(yt),yt=yt.left):Mt.length>0?(yt=Mt.pop(),ir.push(yt.key),yt=yt.right):Zr=!0;return ir},m.prototype.values=function(){for(var yt=this._root,Mt=[],ir=[],Zr=!1;!Zr;)yt?(Mt.push(yt),yt=yt.left):Mt.length>0?(yt=Mt.pop(),ir.push(yt.data),yt=yt.right):Zr=!0;return ir},m.prototype.at=function(yt){for(var Mt=this._root,ir=[],Zr=!1,un=0;!Zr;)if(Mt)ir.push(Mt),Mt=Mt.left;else if(ir.length>0){if(Mt=ir.pop(),un===yt)return Mt;un++,Mt=Mt.right}else Zr=!0;return null},m.prototype.load=function(yt,Mt,ir){if(yt===void 0&&(yt=[]),Mt===void 0&&(Mt=[]),ir===void 0&&(ir=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Zr=yt.length;return ir&&M(yt,Mt,0,Zr-1,this._compare),this._root=w(null,yt,Mt,0,Zr),this._size=Zr,this},m.prototype.min=function(){var yt=this.minNode(this._root);return yt?yt.key:null},m.prototype.max=function(){var yt=this.maxNode(this._root);return yt?yt.key:null},m.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},m.createTree=function(yt,Mt,ir,Zr,un){return new m(ir,un).load(yt,Mt,Zr)},Object.defineProperties(m.prototype,x);var N=0,U=1,K=2,ee=3,oe=0,me=1,we=2,Le=3;function ze(yt,Mt,ir){Mt===null?(yt.inOut=!1,yt.otherInOut=!0):(yt.isSubject===Mt.isSubject?(yt.inOut=!Mt.inOut,yt.otherInOut=Mt.otherInOut):(yt.inOut=!Mt.otherInOut,yt.otherInOut=Mt.isVertical()?!Mt.inOut:Mt.inOut),Mt&&(yt.prevInResult=!qe(Mt,ir)||Mt.isVertical()?Mt.prevInResult:Mt));var Zr=qe(yt,ir);yt.resultTransition=Zr?function(un,an){var Sn,rs=!un.inOut,go=!un.otherInOut;switch(an){case oe:Sn=rs&&go;break;case me:Sn=rs||go;break;case Le:Sn=rs^go;break;case we:Sn=un.isSubject?rs&&!go:go&&!rs}return Sn?1:-1}(yt,ir):0}function qe(yt,Mt){switch(yt.type){case N:switch(Mt){case oe:return!yt.otherInOut;case me:return yt.otherInOut;case we:return yt.isSubject&&yt.otherInOut||!yt.isSubject&&!yt.otherInOut;case Le:return!0}break;case K:return Mt===oe||Mt===me;case ee:return Mt===we;case U:return!1}return!1}var ot=function(yt,Mt,ir,Zr,un){this.left=Mt,this.point=yt,this.otherEvent=ir,this.isSubject=Zr,this.type=un||N,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ct={inResult:{configurable:!0}};function Re(yt,Mt){return yt[0]===Mt[0]&&yt[1]===Mt[1]}ot.prototype.isBelow=function(yt){var Mt=this.point,ir=this.otherEvent.point;return this.left?(Mt[0]-yt[0])*(ir[1]-yt[1])-(ir[0]-yt[0])*(Mt[1]-yt[1])>0:(ir[0]-yt[0])*(Mt[1]-yt[1])-(Mt[0]-yt[0])*(ir[1]-yt[1])>0},ot.prototype.isAbove=function(yt){return!this.isBelow(yt)},ot.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ct.inResult.get=function(){return this.resultTransition!==0},ot.prototype.clone=function(){var yt=new ot(this.point,this.left,this.otherEvent,this.isSubject,this.type);return yt.contourId=this.contourId,yt.resultTransition=this.resultTransition,yt.prevInResult=this.prevInResult,yt.isExteriorRing=this.isExteriorRing,yt.inOut=this.inOut,yt.otherInOut=this.otherInOut,yt},Object.defineProperties(ot.prototype,ct);var tt=11102230246251565e-32,ut=134217729,Tt=(3+8*tt)*tt;function ri(yt,Mt,ir,Zr,un){var an,Sn,rs,go,yo=Mt[0],Hs=Zr[0],Fa=0,ll=0;Hs>yo==Hs>-yo?(an=yo,yo=Mt[++Fa]):(an=Hs,Hs=Zr[++ll]);var _o=0;if(Fa<yt&&ll<ir)for(Hs>yo==Hs>-yo?(rs=an-((Sn=yo+an)-yo),yo=Mt[++Fa]):(rs=an-((Sn=Hs+an)-Hs),Hs=Zr[++ll]),an=Sn,rs!==0&&(un[_o++]=rs);Fa<yt&&ll<ir;)Hs>yo==Hs>-yo?(rs=an-((Sn=an+yo)-(go=Sn-an))+(yo-go),yo=Mt[++Fa]):(rs=an-((Sn=an+Hs)-(go=Sn-an))+(Hs-go),Hs=Zr[++ll]),an=Sn,rs!==0&&(un[_o++]=rs);for(;Fa<yt;)rs=an-((Sn=an+yo)-(go=Sn-an))+(yo-go),yo=Mt[++Fa],an=Sn,rs!==0&&(un[_o++]=rs);for(;ll<ir;)rs=an-((Sn=an+Hs)-(go=Sn-an))+(Hs-go),Hs=Zr[++ll],an=Sn,rs!==0&&(un[_o++]=rs);return an===0&&_o!==0||(un[_o++]=an),_o}function Xt(yt){return new Float64Array(yt)}var si=33306690738754716e-32,Ci=22204460492503146e-32,qi=11093356479670487e-47,Fr=Xt(4),gr=Xt(8),Rr=Xt(12),$r=Xt(16),Zi=Xt(4);function Ir(yt,Mt,ir){var Zr=function(un,an,Sn,rs,go,yo){var Hs=(an-yo)*(Sn-go),Fa=(un-go)*(rs-yo),ll=Hs-Fa;if(Hs===0||Fa===0||Hs>0!=Fa>0)return ll;var _o=Math.abs(Hs+Fa);return Math.abs(ll)>=si*_o?ll:-function(oc,vl,Oa,Mc,kl,cl,xl){var Wa,Js,Ga,ac,ts,Qo,Al,xc,Bl,Dh,Za,vh,Mf,Rd,fd,If,t_,Ph,lu=oc-kl,Nd=Oa-kl,Cp=vl-cl,op=Mc-cl;Fr[0]=(fd=(xc=lu-(Al=(Qo=ut*lu)-(Qo-lu)))*(Dh=op-(Bl=(Qo=ut*op)-(Qo-op)))-((Rd=lu*op)-Al*Bl-xc*Bl-Al*Dh))-((Za=fd-(t_=(xc=Cp-(Al=(Qo=ut*Cp)-(Qo-Cp)))*(Dh=Nd-(Bl=(Qo=ut*Nd)-(Qo-Nd)))-((If=Cp*Nd)-Al*Bl-xc*Bl-Al*Dh)))+(ts=fd-Za))+(ts-t_),Fr[1]=(Mf=Rd-((vh=Rd+Za)-(ts=vh-Rd))+(Za-ts))-((Za=Mf-If)+(ts=Mf-Za))+(ts-If),Fr[2]=vh-((Ph=vh+Za)-(ts=Ph-vh))+(Za-ts),Fr[3]=Ph;var Hv=function(Tfe,eO){for(var tO=eO[0],pA=1;pA<4;pA++)tO+=eO[pA];return tO}(0,Fr),Zw=Ci*xl;if(Hv>=Zw||-Hv>=Zw||(Wa=oc-(lu+(ts=oc-lu))+(ts-kl),Ga=Oa-(Nd+(ts=Oa-Nd))+(ts-kl),Js=vl-(Cp+(ts=vl-Cp))+(ts-cl),ac=Mc-(op+(ts=Mc-op))+(ts-cl),Wa===0&&Js===0&&Ga===0&&ac===0)||(Zw=qi*xl+Tt*Math.abs(Hv),(Hv+=lu*ac+op*Wa-(Cp*Ga+Nd*Js))>=Zw||-Hv>=Zw))return Hv;Zi[0]=(fd=(xc=Wa-(Al=(Qo=ut*Wa)-(Qo-Wa)))*(Dh=op-(Bl=(Qo=ut*op)-(Qo-op)))-((Rd=Wa*op)-Al*Bl-xc*Bl-Al*Dh))-((Za=fd-(t_=(xc=Js-(Al=(Qo=ut*Js)-(Qo-Js)))*(Dh=Nd-(Bl=(Qo=ut*Nd)-(Qo-Nd)))-((If=Js*Nd)-Al*Bl-xc*Bl-Al*Dh)))+(ts=fd-Za))+(ts-t_),Zi[1]=(Mf=Rd-((vh=Rd+Za)-(ts=vh-Rd))+(Za-ts))-((Za=Mf-If)+(ts=Mf-Za))+(ts-If),Zi[2]=vh-((Ph=vh+Za)-(ts=Ph-vh))+(Za-ts),Zi[3]=Ph;var JV=ri(4,Fr,4,Zi,gr);Zi[0]=(fd=(xc=lu-(Al=(Qo=ut*lu)-(Qo-lu)))*(Dh=ac-(Bl=(Qo=ut*ac)-(Qo-ac)))-((Rd=lu*ac)-Al*Bl-xc*Bl-Al*Dh))-((Za=fd-(t_=(xc=Cp-(Al=(Qo=ut*Cp)-(Qo-Cp)))*(Dh=Ga-(Bl=(Qo=ut*Ga)-(Qo-Ga)))-((If=Cp*Ga)-Al*Bl-xc*Bl-Al*Dh)))+(ts=fd-Za))+(ts-t_),Zi[1]=(Mf=Rd-((vh=Rd+Za)-(ts=vh-Rd))+(Za-ts))-((Za=Mf-If)+(ts=Mf-Za))+(ts-If),Zi[2]=vh-((Ph=vh+Za)-(ts=Ph-vh))+(Za-ts),Zi[3]=Ph;var eW=ri(JV,gr,4,Zi,Rr);Zi[0]=(fd=(xc=Wa-(Al=(Qo=ut*Wa)-(Qo-Wa)))*(Dh=ac-(Bl=(Qo=ut*ac)-(Qo-ac)))-((Rd=Wa*ac)-Al*Bl-xc*Bl-Al*Dh))-((Za=fd-(t_=(xc=Js-(Al=(Qo=ut*Js)-(Qo-Js)))*(Dh=Ga-(Bl=(Qo=ut*Ga)-(Qo-Ga)))-((If=Js*Ga)-Al*Bl-xc*Bl-Al*Dh)))+(ts=fd-Za))+(ts-t_),Zi[1]=(Mf=Rd-((vh=Rd+Za)-(ts=vh-Rd))+(Za-ts))-((Za=Mf-If)+(ts=Mf-Za))+(ts-If),Zi[2]=vh-((Ph=vh+Za)-(ts=Ph-vh))+(Za-ts),Zi[3]=Ph;var tW=ri(eW,Rr,4,Zi,$r);return $r[tW-1]}(un,an,Sn,rs,go,yo,_o)}(yt[0],yt[1],Mt[0],Mt[1],ir[0],ir[1]);return Zr>0?-1:Zr<0?1:0}function Hi(yt,Mt){var ir=yt.point,Zr=Mt.point;return ir[0]>Zr[0]?1:ir[0]<Zr[0]?-1:ir[1]!==Zr[1]?ir[1]>Zr[1]?1:-1:function(un,an,Sn,rs){return un.left!==an.left?un.left?1:-1:Ir(Sn,un.otherEvent.point,an.otherEvent.point)!==0?un.isBelow(an.otherEvent.point)?-1:1:!un.isSubject&&an.isSubject?1:-1}(yt,Mt,ir)}function Xi(yt,Mt,ir){var Zr=new ot(Mt,!1,yt,yt.isSubject),un=new ot(Mt,!0,yt.otherEvent,yt.isSubject);return Re(yt.point,yt.otherEvent.point)&&console.warn("what is that, a collapsed segment?",yt),Zr.contourId=un.contourId=yt.contourId,Hi(un,yt.otherEvent)>0&&(yt.otherEvent.left=!0,un.left=!1),yt.otherEvent.otherEvent=un,yt.otherEvent=Zr,ir.push(un),ir.push(Zr),ir}function jr(yt,Mt){return yt[0]*Mt[1]-yt[1]*Mt[0]}function Gr(yt,Mt){return yt[0]*Mt[0]+yt[1]*Mt[1]}function Hn(yt,Mt,ir){var Zr=function(go,yo,Hs,Fa,ll){var _o=[yo[0]-go[0],yo[1]-go[1]],oc=[Fa[0]-Hs[0],Fa[1]-Hs[1]];function vl(Qo,Al,xc){return[Qo[0]+Al*xc[0],Qo[1]+Al*xc[1]]}var Oa=[Hs[0]-go[0],Hs[1]-go[1]],Mc=jr(_o,oc),kl=Mc*Mc,cl=Gr(_o,_o);if(kl>0){var xl=jr(Oa,oc)/Mc;if(xl<0||xl>1)return null;var Wa=jr(Oa,_o)/Mc;return Wa<0||Wa>1?null:xl===0||xl===1?[vl(go,xl,_o)]:Wa===0||Wa===1?[vl(Hs,Wa,oc)]:[vl(go,xl,_o)]}if((kl=(Mc=jr(Oa,_o))*Mc)>0)return null;var Js=Gr(_o,Oa)/cl,Ga=Js+Gr(_o,oc)/cl,ac=Math.min(Js,Ga),ts=Math.max(Js,Ga);return ac<=1&&ts>=0?ac===1?[vl(go,ac>0?ac:0,_o)]:ts===0?[vl(go,ts<1?ts:1,_o)]:[vl(go,ac>0?ac:0,_o),vl(go,ts<1?ts:1,_o)]:null}(yt.point,yt.otherEvent.point,Mt.point,Mt.otherEvent.point),un=Zr?Zr.length:0;if(un===0||un===1&&(Re(yt.point,Mt.point)||Re(yt.otherEvent.point,Mt.otherEvent.point))||un===2&&yt.isSubject===Mt.isSubject)return 0;if(un===1)return Re(yt.point,Zr[0])||Re(yt.otherEvent.point,Zr[0])||Xi(yt,Zr[0],ir),Re(Mt.point,Zr[0])||Re(Mt.otherEvent.point,Zr[0])||Xi(Mt,Zr[0],ir),1;var an=[],Sn=!1,rs=!1;return Re(yt.point,Mt.point)?Sn=!0:Hi(yt,Mt)===1?an.push(Mt,yt):an.push(yt,Mt),Re(yt.otherEvent.point,Mt.otherEvent.point)?rs=!0:Hi(yt.otherEvent,Mt.otherEvent)===1?an.push(Mt.otherEvent,yt.otherEvent):an.push(yt.otherEvent,Mt.otherEvent),Sn&&rs||Sn?(Mt.type=U,yt.type=Mt.inOut===yt.inOut?K:ee,Sn&&!rs&&Xi(an[1].otherEvent,an[0].point,ir),2):rs?(Xi(an[0],an[1].point,ir),3):an[0]!==an[3].otherEvent?(Xi(an[0],an[1].point,ir),Xi(an[1],an[2].point,ir),3):(Xi(an[0],an[1].point,ir),Xi(an[3].otherEvent,an[2].point,ir),3)}function Mn(yt,Mt){if(yt===Mt)return 0;if(Ir(yt.point,yt.otherEvent.point,Mt.point)!==0||Ir(yt.point,yt.otherEvent.point,Mt.otherEvent.point)!==0)return Re(yt.point,Mt.point)?yt.isBelow(Mt.otherEvent.point)?-1:1:yt.point[0]===Mt.point[0]?yt.point[1]<Mt.point[1]?-1:1:Hi(yt,Mt)===1?Mt.isAbove(yt.point)?-1:1:yt.isBelow(Mt.point)?-1:1;if(yt.isSubject!==Mt.isSubject)return yt.isSubject?-1:1;var ir=yt.point,Zr=Mt.point;return ir[0]===Zr[0]&&ir[1]===Zr[1]?(ir=yt.otherEvent.point)[0]===(Zr=Mt.otherEvent.point)[0]&&ir[1]===Zr[1]?0:yt.contourId>Mt.contourId?1:-1:Hi(yt,Mt)===1?1:-1}var hn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Wr(yt,Mt,ir,Zr){var un,an=yt+1,Sn=Mt[yt].point,rs=Mt.length;for(an<rs&&(un=Mt[an].point);an<rs&&un[0]===Sn[0]&&un[1]===Sn[1];){if(!ir[an])return an;++an<rs&&(un=Mt[an].point)}for(an=yt-1;ir[an]&&an>Zr;)an--;return an}hn.prototype.isExterior=function(){return this.holeOf==null};var Ss=Dn,En=Dn;function Dn(yt,Mt){if(!(this instanceof Dn))return new Dn(yt,Mt);if(this.data=yt||[],this.length=this.data.length,this.compare=Mt||ss,this.length>0)for(var ir=(this.length>>1)-1;ir>=0;ir--)this._down(ir)}function ss(yt,Mt){return yt<Mt?-1:yt>Mt?1:0}Dn.prototype={push:function(yt){this.data.push(yt),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var yt=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),yt}},peek:function(){return this.data[0]},_up:function(yt){for(var Mt=this.data,ir=this.compare,Zr=Mt[yt];yt>0;){var un=yt-1>>1,an=Mt[un];if(ir(Zr,an)>=0)break;Mt[yt]=an,yt=un}Mt[yt]=Zr},_down:function(yt){for(var Mt=this.data,ir=this.compare,Zr=this.length>>1,un=Mt[yt];yt<Zr;){var an=1+(yt<<1),Sn=an+1,rs=Mt[an];if(Sn<this.length&&ir(Mt[Sn],rs)<0&&(an=Sn,rs=Mt[Sn]),ir(rs,un)>=0)break;Mt[yt]=rs,yt=an}Mt[yt]=un}},Ss.default=En;var $s=Math.max,Rs=Math.min,no=0;function js(yt,Mt,ir,Zr,un,an){var Sn,rs,go,yo,Hs,Fa;for(Sn=0,rs=yt.length-1;Sn<rs;Sn++)if(yo=yt[Sn+1],Hs=new ot(go=yt[Sn],!1,void 0,Mt),Fa=new ot(yo,!1,Hs,Mt),Hs.otherEvent=Fa,go[0]!==yo[0]||go[1]!==yo[1]){Hs.contourId=Fa.contourId=ir,an||(Hs.isExteriorRing=!1,Fa.isExteriorRing=!1),Hi(Hs,Fa)>0?Fa.left=!0:Hs.left=!0;var ll=go[0],_o=go[1];un[0]=Rs(un[0],ll),un[1]=Rs(un[1],_o),un[2]=$s(un[2],ll),un[3]=$s(un[3],_o),Zr.push(Hs),Zr.push(Fa)}}var so=[];function Pa(yt,Mt,ir){typeof yt[0][0][0]=="number"&&(yt=[yt]),typeof Mt[0][0][0]=="number"&&(Mt=[Mt]);var Zr=function(_o,oc,vl){var Oa=null;return _o.length*oc.length==0&&(vl===oe?Oa=so:vl===we?Oa=_o:vl!==me&&vl!==Le||(Oa=_o.length===0?oc:_o)),Oa}(yt,Mt,ir);if(Zr)return Zr===so?null:Zr;var un=[1/0,1/0,-1/0,-1/0],an=[1/0,1/0,-1/0,-1/0],Sn=function(_o,oc,vl,Oa,Mc){var kl,cl,xl,Wa,Js,Ga,ac=new Ss(null,Hi);for(xl=0,Wa=_o.length;xl<Wa;xl++)for(Js=0,Ga=(kl=_o[xl]).length;Js<Ga;Js++)(cl=Js===0)&&no++,js(kl[Js],!0,no,ac,vl,cl);for(xl=0,Wa=oc.length;xl<Wa;xl++)for(Js=0,Ga=(kl=oc[xl]).length;Js<Ga;Js++)cl=Js===0,Mc===we&&(cl=!1),cl&&no++,js(kl[Js],!1,no,ac,Oa,cl);return ac}(yt,Mt,un,an,ir);if(Zr=function(_o,oc,vl,Oa,Mc){var kl=null;return(vl[0]>Oa[2]||Oa[0]>vl[2]||vl[1]>Oa[3]||Oa[1]>vl[3])&&(Mc===oe?kl=so:Mc===we?kl=_o:Mc!==me&&Mc!==Le||(kl=_o.concat(oc))),kl}(yt,Mt,un,an,ir))return Zr===so?null:Zr;for(var rs=function(_o){var oc,vl,Oa=function(xl){var Wa,Js,Ga,ac,ts=[];for(Js=0,Ga=xl.length;Js<Ga;Js++)((Wa=xl[Js]).left&&Wa.inResult||!Wa.left&&Wa.otherEvent.inResult)&&ts.push(Wa);for(var Qo=!1;!Qo;)for(Qo=!0,Js=0,Ga=ts.length;Js<Ga;Js++)Js+1<Ga&&Hi(ts[Js],ts[Js+1])===1&&(ac=ts[Js],ts[Js]=ts[Js+1],ts[Js+1]=ac,Qo=!1);for(Js=0,Ga=ts.length;Js<Ga;Js++)(Wa=ts[Js]).otherPos=Js;for(Js=0,Ga=ts.length;Js<Ga;Js++)(Wa=ts[Js]).left||(ac=Wa.otherPos,Wa.otherPos=Wa.otherEvent.otherPos,Wa.otherEvent.otherPos=ac);return ts}(_o),Mc={},kl=[],cl=function(){if(!Mc[oc]){var xl=kl.length,Wa=function(ts,Qo,Al){var xc=new hn;if(ts.prevInResult!=null){var Bl=ts.prevInResult,Dh=Bl.outputContourId;if(Bl.resultTransition>0){var Za=Qo[Dh];if(Za.holeOf!=null){var vh=Za.holeOf;Qo[vh].holeIds.push(Al),xc.holeOf=vh,xc.depth=Qo[Dh].depth}else Qo[Dh].holeIds.push(Al),xc.holeOf=Dh,xc.depth=Qo[Dh].depth+1}else xc.holeOf=null,xc.depth=Qo[Dh].depth}else xc.holeOf=null,xc.depth=0;return xc}(Oa[oc],kl,xl),Js=function(ts){Mc[ts]=!0,ts<Oa.length&&Oa[ts]&&(Oa[ts].outputContourId=xl)},Ga=oc,ac=oc;for(Wa.points.push(Oa[oc].point);Js(Ga),Js(Ga=Oa[Ga].otherPos),Wa.points.push(Oa[Ga].point),!((Ga=Wr(Ga,Oa,Mc,ac))==ac||Ga>=Oa.length)&&Oa[Ga];);kl.push(Wa)}};for(oc=0,vl=Oa.length;oc<vl;oc++)cl();return kl}(function(_o,oc,vl,Oa,Mc,kl){for(var cl,xl,Wa,Js=new m(Mn),Ga=[],ac=Math.min(Oa[2],Mc[2]);_o.length!==0;){var ts=_o.pop();if(Ga.push(ts),kl===oe&&ts.point[0]>ac||kl===we&&ts.point[0]>Oa[2])break;if(ts.left){xl=cl=Js.insert(ts),cl=cl!==(Wa=Js.minNode())?Js.prev(cl):null,xl=Js.next(xl);var Qo=cl?cl.key:null;if(ze(ts,Qo,kl),xl&&Hn(ts,xl.key,_o)===2&&(ze(ts,Qo,kl),ze(xl.key,ts,kl)),cl&&Hn(cl.key,ts,_o)===2){var Al=cl;ze(Qo,(Al=Al!==Wa?Js.prev(Al):null)?Al.key:null,kl),ze(ts,Qo,kl)}}else xl=cl=Js.find(ts=ts.otherEvent),cl&&xl&&(cl=cl!==Wa?Js.prev(cl):null,xl=Js.next(xl),Js.remove(ts),xl&&cl&&Hn(cl.key,xl.key,_o))}return Ga}(Sn,0,0,un,an,ir)),go=[],yo=0;yo<rs.length;yo++){var Hs=rs[yo];if(Hs.isExterior()){for(var Fa=[Hs.points],ll=0;ll<Hs.holeIds.length;ll++)Fa.push(rs[Hs.holeIds[ll]].points);go.push(Fa)}}return go}var _l={UNION:me,DIFFERENCE:we,INTERSECTION:oe,XOR:Le};l.diff=function(yt,Mt){return Pa(yt,Mt,we)},l.intersection=function(yt,Mt){return Pa(yt,Mt,oe)},l.operations=_l,l.union=function(yt,Mt){return Pa(yt,Mt,me)},l.xor=function(yt,Mt){return Pa(yt,Mt,Le)},Object.defineProperty(l,"__esModule",{value:!0})})(r)}(0,ou.exports)),ou.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Rl(c,r,l,u){const m=[],x=u===0?(w,M,N,U,K,ee)=>{w.push(new fr(ee,N+(ee-M)/(U-M)*(K-N)))}:(w,M,N,U,K,ee)=>{w.push(new fr(M+(ee-N)/(K-N)*(U-M),ee))};for(const w of c){const M=[];for(const N of w){if(N.length<=2)continue;const U=[];for(let oe=0;oe<N.length-1;oe++){const me=N[oe].x,we=N[oe].y,Le=N[oe+1].x,ze=N[oe+1].y,qe=u===0?me:we,ot=u===0?Le:ze;qe<r?ot>r&&x(U,me,we,Le,ze,r):qe>l?ot<l&&x(U,me,we,Le,ze,l):U.push(N[oe]),ot<r&&qe>=r&&x(U,me,we,Le,ze,r),ot>l&&qe<=l&&x(U,me,we,Le,ze,l)}let K=N[N.length-1];const ee=u===0?K.x:K.y;ee>=r&&ee<=l&&U.push(K),U.length&&(K=U[U.length-1],U[0].x===K.x&&U[0].y===K.y||U.push(U[0]),M.push(U))}M.length&&m.push(M)}return m}function t0(c,r){const l=kf(c),u=kf([r]),m=Lh.intersection(l,u);return m==null?[]:_y(m)}function Gm(c,r){let u=kf(c,65536);for(;r.valid();r.next()){const[m,x]=r.get(),w=m.x*65536,M=m.y*65536,N=x.x*65536,U=x.y*65536,K=N-w,ee=U-M,oe=Math.hypot(K,ee),me=Math.trunc(ee/oe*3),we=-Math.trunc(K/oe*3);u=Lh.diff(u,[[[w,M],[N,U],[N+me,U+we],[w+me,M+we],[w,M]]])}return _y(u,1/65536)}function kf(c,r=1){return[c.map(l=>l.map(u=>[u.x*r,u.y*r]))]}function _y(c,r=1){return c.map(l=>l.map((u,m)=>{const x=u.map(w=>new fr(w[0]*r,w[1]*r).round());return m>0&&x.reverse(),x}))}class ip{constructor(r,l){this.layoutVertexArray=new Vc,this.indexArray=new Ac,this.lineIndexArray=new Wh,this.triangleSegments=new nl,this.lineSegments=new nl,this.programConfigurations=new g(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new xp)}update(r,l,u,m,x,w,M,N){this.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,N)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,_e.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,Me.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,l,u,m,x,w,M){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,u,m,x,w,void 0,M)}}class qm{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new ip(r,!1),this.elevationBufferData=new ip(r,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview}updateFootprints(r,l){}populate(r,l,u,m){this.hasPattern=Os("fill",this.layers,this.pixelRatio,l);const x=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:M,id:N,index:U,sourceLayerIndex:K}of r){const ee=this.layers[0]._featureFilter.needGeometry,oe=on(M,ee);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),oe,u))continue;const me=x?x.evaluate(oe,{},u,l.availableImages):void 0,we={id:N,properties:M.properties,type:M.type,sourceLayerIndex:K,index:U,geometry:ee?oe.geometry:pn(M,u,m),patterns:{},sortKey:me};w.push(we)}x&&w.sort((M,N)=>M.sortKey-N.sortKey);for(const M of w){const{geometry:N,index:U,sourceLayerIndex:K}=M;if(this.hasPattern){const ee=Us("fill",this.layers,M,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ee)}else this.addFeature(M,N,U,u,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(r[U].feature,N,U,K,this.index)}}update(r,l,u,m,x,w,M){this.bufferData.update(r,l,u,m,x,w,M,this.worldview),this.elevationBufferData.update(r,l,u,m,x,w,M,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,l,u,m,x,w,M,this.worldview)}addFeatures(r,l,u,m,x,w){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,l,u,m,w,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,l,u,m,x,w=[],M,N){const U=da(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,U,m,u,N):this.addGeometry(U,this.bufferData),this.bufferData.populatePaintArrays(r,u,x,w,m,M,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,x,w,m,M,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,l,u,m,x){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(l,u,m,x,this.worldview))}addElevatedRoadFeature(r,l,u,m,x){const w=new Array,M=od.getElevationFeature(r,x);if(!M)return void this.addGeometry(l,this.bufferData);{const U=this.clipPolygonsToTile(l,1);U.length>0&&w.push({polygons:U,elevationFeature:M,elevationTileID:u})}const N={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:m};for(const U of w)if(U.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new nh(U.elevationTileID,this.layers,this.zoom,this.lut));const ee=U.elevationFeature.isTunnel();let oe=0;r.properties.hasOwnProperty(_a)&&(oe=+r.properties[_a]);for(const me of U.polygons)this.elevatedStructures.addPortalCandidates(U.elevationFeature.id,me,ee,U.elevationFeature,oe)}U.elevationFeature.constantHeight==null&&(U.polygons=this.prepareElevatedPolygons(U.polygons,U.elevationFeature,U.elevationTileID));const K=new Od(u,U.elevationTileID);this.addElevatedGeometry(U.polygons,K,U.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m,N)}}addElevatedGeometry(r,l,u,m,x,w){const M={elevation:u,elevationSampler:l,bias:m,index:x,featureInfo:w},[N,U]=this.addGeometry(r,this.elevationBufferData,M);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:N,max:U}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,N),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,U))}addGeometry(r,l,u){let m=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,w=null;u&&(w=u.elevationSampler.constantElevation(u.elevation,u.bias),w!=null&&(m=w,x=w));const M=(N,U,K)=>{if(u!=null)if(U.push(N),w!=null)l.elevatedLayoutVertexArray.emplaceBack(w),K.push(w);else{const ee=u.elevationSampler.pointElevation(N,u.elevation,u.bias);l.elevatedLayoutVertexArray.emplaceBack(ee),K.push(ee),m=Math.min(m,ee),x=Math.max(x,ee)}};for(const N of r){let U=0;for(const ct of N)U+=ct.length;const K=l.triangleSegments.prepareSegment(U,l.layoutVertexArray,l.indexArray),ee=K.vertexLength,oe=[],me=[],we=[],Le=[],ze=[],qe=l.layoutVertexArray.length;for(const ct of N){if(ct.length===0)continue;ct!==N[0]&&me.push(oe.length/2);const Re=l.lineSegments.prepareSegment(ct.length,l.layoutVertexArray,l.lineIndexArray),tt=Re.vertexLength;u&&ze.push(l.layoutVertexArray.length-qe),M(ct[0],we,Le),l.layoutVertexArray.emplaceBack(ct[0].x,ct[0].y),l.lineIndexArray.emplaceBack(tt+ct.length-1,tt),oe.push(ct[0].x),oe.push(ct[0].y);for(let ut=1;ut<ct.length;ut++)M(ct[ut],we,Le),l.layoutVertexArray.emplaceBack(ct[ut].x,ct[ut].y),l.lineIndexArray.emplaceBack(tt+ut-1,tt+ut),oe.push(ct[ut].x),oe.push(ct[ut].y);Re.vertexLength+=ct.length,Re.primitiveLength+=ct.length}const ot=je(oe,me);for(let ct=0;ct<ot.length;ct+=3)l.indexArray.emplaceBack(ee+ot[ct],ee+ot[ct+1],ee+ot[ct+2]);if(ot.length>0&&u&&this.elevationMode==="hd-road-base"){const ct=u.elevation.isTunnel(),Re=u.elevation.safeArea,tt=this.elevatedStructures.addVertices(we,Le);this.elevatedStructures.addTriangles(ot,tt,ct);const ut=ze.length;if(ut>0){for(let Tt=0;Tt<ut-1;Tt++)this.elevatedStructures.addRenderableRing(u.index,ze[Tt]+tt,ze[Tt+1]-ze[Tt],ct,Re,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,ze[ut-1]+tt,we.length-ze[ut-1],ct,Re,u.featureInfo)}}K.vertexLength+=U,K.primitiveLength+=ot.length/3}return[m,x]}prepareElevatedPolygons(r,l,u){const m=1/$i(u),x=[];for(const w of r){const M=Gm(w,new ru(l,m));x.push(...M)}return x}clipPolygonsToTile(r,l){const u=-l,m=-l,x=mr+l,w=mr+l;let M=0;const N=[],U=[];for(;M<r.length;M++){const oe=r[M],me=Dc(oe);(me.min.x>=u&&me.max.x<=x&&me.min.y>=m&&me.max.y<=w?N:U).push(oe)}if(N.length===r.length)return r;const K=[new fr(u,m),new fr(x,m),new fr(x,w),new fr(u,w),new fr(u,m)],ee=N;for(const oe of U)ee.push(...t0(oe,K));return ee}}let L_,D_,i0,P_;mn(qm,"FillBucket",{omit:["layers","patternFeatures"]}),mn(ip,"FillBufferData"),mn(nh,"ElevatedStructures");class gx{constructor(r,l,u,m){if(this.triangleCount=l.length/3,this.min=new fr(0,0),this.max=new fr(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[x,w]=[r[0].clone(),r[0].clone()];for(let ee=1;ee<r.length;++ee){const oe=r[ee];x.x=Math.min(x.x,oe.x),x.y=Math.min(x.y,oe.y),w.x=Math.max(w.x,oe.x),w.y=Math.max(w.y,oe.y)}if(m){const ee=Math.ceil(Math.max(w.x-x.x,w.y-x.y)/m);u=Math.max(u,ee)}if(u===0)return;this.min=x,this.max=w;const M=this.max.sub(this.min);M.x=Math.max(M.x,1),M.y=Math.max(M.y,1);const N=Math.max(M.x,M.y)/u;this.cellsX=Math.max(1,Math.ceil(M.x/N)),this.cellsY=Math.max(1,Math.ceil(M.y/N)),this.xScale=1/N,this.yScale=1/N;const U=[];for(let ee=0;ee<this.triangleCount;ee++){const oe=r[l[3*ee+0]].sub(this.min),me=r[l[3*ee+1]].sub(this.min),we=r[l[3*ee+2]].sub(this.min),Le=Ym(Math.floor(Math.min(oe.x,me.x,we.x)),this.xScale,this.cellsX),ze=Ym(Math.floor(Math.max(oe.x,me.x,we.x)),this.xScale,this.cellsX),qe=Ym(Math.floor(Math.min(oe.y,me.y,we.y)),this.yScale,this.cellsY),ot=Ym(Math.floor(Math.max(oe.y,me.y,we.y)),this.yScale,this.cellsY),ct=new fr(0,0),Re=new fr(0,0),tt=new fr(0,0),ut=new fr(0,0);for(let Tt=qe;Tt<=ot;++Tt){ct.y=Re.y=Tt*N,tt.y=ut.y=(Tt+1)*N;for(let ri=Le;ri<=ze;++ri)ct.x=tt.x=ri*N,Re.x=ut.x=(ri+1)*N,(N0(oe,me,we,ct,Re,ut)||N0(oe,me,we,ct,ut,tt))&&U.push({cellIdx:Tt*this.cellsX+ri,triIdx:ee})}}if(U.length===0)return;U.sort((ee,oe)=>ee.cellIdx-oe.cellIdx||ee.triIdx-oe.triIdx);let K=0;for(;K<U.length;){const ee=U[K].cellIdx,oe={start:this.payload.length,len:0};for(;K<U.length&&U[K].cellIdx===ee;)++oe.len,this.payload.push(U[K++].triIdx);this.cells[ee]=oe}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,l){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Ym(r.x-this.min.x,this.xScale,this.cellsX),m=Ym(r.y-this.min.y,this.yScale,this.cellsY),x=this.cells[m*this.cellsX+u];if(x){this._lazyInitLookup();for(let w=0;w<x.len;w++){const M=this.payload[x.start+w],N=Math.floor(M/8),U=1<<M%8;if(!(this.lookup[N]&U)&&(this.lookup[N]|=U,l.push(M),l.length===this.triangleCount))return}}}query(r,l,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>l.x||r.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const m=Ym(r.x-this.min.x,this.xScale,this.cellsX),x=Ym(l.x-this.min.x,this.xScale,this.cellsX),w=Ym(r.y-this.min.y,this.yScale,this.cellsY),M=Ym(l.y-this.min.y,this.yScale,this.cellsY);for(let N=w;N<=M;N++)for(let U=m;U<=x;U++){const K=this.cells[N*this.cellsX+U];if(K)for(let ee=0;ee<K.len;ee++){const oe=this.payload[K.start+ee],me=Math.floor(oe/8),we=1<<oe%8;if(!(this.lookup[me]&we)&&(this.lookup[me]|=we,u.push(oe),u.length===this.triangleCount))return}}}}function Ym(c,r,l){return Math.max(0,Math.min(l-1,Math.floor(c*r)))}mn(gx,"TriangleGridIndex");class O_{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[],this.worldview=r.worldview}updateFootprints(r,l){for(const u of this.footprints)l.push({footprint:u,id:r})}populate(r,l,u,m){const x=[];for(const{feature:w,id:M,index:N,sourceLayerIndex:U}of r){const K=this.layers[0]._featureFilter.needGeometry,ee=on(w,K);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),ee,u))continue;const oe={id:M,properties:w.properties,type:w.type,sourceLayerIndex:U,index:N,geometry:K?ee.geometry:pn(w,u,m),patterns:{}};x.push(oe)}for(const w of x){const{geometry:M,index:N,sourceLayerIndex:U}=w;this.addFeature(w,M,N,u,{},l.availableImages,l.brightness),l.featureIndex.insert(r[N].feature,M,N,U,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,l,u,m,x,w,M){}destroy(){}addFeature(r,l,u,m,x,w=[],M){for(const N of da(l,2)){const U=[],K=[],ee=[],oe=new fr(1/0,1/0),me=new fr(-1/0,-1/0);for(const ze of N)if(ze.length!==0){ze!==N[0]&&ee.push(K.length/2);for(let qe=0;qe<ze.length;qe++)K.push(ze[qe].x),K.push(ze[qe].y),U.push(ze[qe]),oe.x=Math.min(oe.x,ze[qe].x),oe.y=Math.min(oe.y,ze[qe].y),me.x=Math.max(me.x,ze[qe].x),me.y=Math.max(me.y,ze[qe].y)}const we=je(K,ee),Le=new gx(U,we,8,256);this.footprints.push({vertices:U,indices:we,grid:Le,min:oe,max:me})}}}mn(O_,"ClipBucket",{omit:["layers"]});const Sv=lo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yw=lo([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),yx=lo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),r0=lo([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Tv=lo([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Cb=lo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Fu}=Sv,cd=Number.MAX_SAFE_INTEGER;function V0(c,r,l,u){return c.order<r||c.order===cd||!(c.clipMask&l)||function(m,x){return x.length!==0&&x.find(w=>w===m)===void 0}(u,c.clipScope)}function R_(c,r){return c.x-r.x||c.y-r.y}function W0(c,r){return R_(c.min,r.min)===0&&R_(c.max,r.max)===0}function Cv(c,r){return!(c.min.x>r.max.x||c.max.x<r.min.x||c.min.y>r.max.y||c.max.y<r.min.y)}function _x(c,r){if(c.length!==r.length)return!1;for(let l=0;l<c.length;l++)if(c[l].sourceId!==r[l].sourceId||!W0(c[l],r[l])||c[l].order!==r[l].order||c[l].clipMask!==r[l].clipMask||!tc(c[l].clipScope,r[l].clipScope))return!1;return!0}function vy(c,r,l){const u=1/mr,m=1/(1<<l.canonical.z),x=(r.x*u+l.canonical.x)*m+l.wrap,w=(r.y*u+l.canonical.y)*m;return{min:new fr((c.x*u+l.canonical.x)*m+l.wrap,(c.y*u+l.canonical.y)*m),max:new fr(x,w)}}function vx(c,r,l){const u=1<<l.canonical.z,m=((r.x-l.wrap)*u-l.canonical.x)*mr,x=(r.y*u-l.canonical.y)*mr;return{min:new fr(((c.x-l.wrap)*u-l.canonical.x)*mr,(c.y*u-l.canonical.y)*mr),max:new fr(m,x)}}function xx(c,r,l,u,m,x,w){const M=c.indices,N=c.vertices,U=[];for(let K=u;K<u+m;K+=3){const ee=r[l[K+0]+x],oe=r[l[K+1]+x],me=r[l[K+2]+x],we=Math.min(ee.x,oe.x,me.x),Le=Math.max(ee.x,oe.x,me.x),ze=Math.min(ee.y,oe.y,me.y),qe=Math.max(ee.y,oe.y,me.y);U.length=0,c.grid.query(new fr(we,ze),new fr(Le,qe),U);for(let ot=0;ot<U.length;ot++){const ct=U[ot];if(N0(N[M[3*ct+0]],N[M[3*ct+1]],N[M[3*ct+2]],ee,oe,me,w))return!0}}return!1}function bx(c,r,l,u){if(!c||!l)return!1;let m=c.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(l.vertices.length<c.vertices.length)return bx(l,u,c,r);const x=r.canonical,w=u.canonical,M=Math.pow(2,w.z-x.z);m=c.vertices.map(N=>new fr((N.x+x.x*mr)*M-w.x*mr,(N.y+x.y*mr)*M-w.y*mr))}return xx(l,m,c.indices,0,c.indices.length,0,0)}function zu(c,r,l,u){const m=Math.pow(2,u.z-l.z);return new fr((c+l.x*mr)*m-u.x*mr,(r+l.y*mr)*m-u.y*mr)}function wx(c,r){const l=[];r.grid.queryPoint(c,l);const u=r.indices,m=r.vertices;for(let x=0;x<l.length;x++){const w=l[x];if(ep([m[u[3*w+0]],m[u[3*w+1]],m[u[3*w+2]]],c))return!0}return!1}const n0=[new fr(0,0),new fr(mr,0),new fr(mr,mr),new fr(0,mr)];function xy(c,r){const l=[];let u=[];if(!r||c.length<2)return[c];if(c.length===2)return Sp(c[0],c[1],n0)?[c]:[];for(let m=0;m<c.length+2;m++){const x=c[m%c.length],w=c[(m+1)%c.length],M=Sp(m===0?c[c.length-1]:c[(m-1)%c.length],x,n0),N=Sp(x,w,n0),U=M||N;U&&u.push(x),U&&N||u.length>0&&(u.length>1&&l.push(u),u=[])}return u.length>1&&l.push(u),l}const Sx=cs.VectorTileFeature.types,j0=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],_w=["fill-extrusion-flood-light-ground-radius"],vw=Math.pow(2,13),by=Math.pow(2,15)-1,Tx=new fr(0,1),hd=2147483648;function Xm(c,r,l,u,m,x,w,M){c.emplaceBack((r<<1)+w,(l<<1)+x,(Math.floor(u*vw)<<1)+m,Math.round(M))}function ud(c,r,l){c.emplaceBack(r.x*mr,r.y*mr,l?1:0)}function s0(c,r,l,u,m,x){c.emplaceBack(r.x,r.y,(l.x<<1)+u,(l.y<<1)+m,x)}function o0(c,r,l){c.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class H0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class N_{constructor(){this.centroidXY=new fr(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new fr(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new fr(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new fr(this.max.x-this.min.x,this.max.y-this.min.y)}}class wy{constructor(){this.acc=new fr(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,l){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=l.x,r.min.y=r.max.y=l.y)}appendEdge(r,l,u){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<r.min.x?(r.min.x=l.x,m=!0):l.x>r.max.x&&(r.max.x=l.x,m=!0),l.y<r.min.y?(r.min.y=l.y,m=!0):l.y>r.max.y&&(r.max.y=l.y,m=!0),((l.x===0||l.x===mr)&&l.x===u.x)!=((l.y===0||l.y===mr)&&l.y===u.y)&&this.processBorderOverlap(l,u),m&&this.checkBorderIntersection(l,u)}checkBorderIntersection(r,l){l.x<0!=r.x<0&&this.addBorderIntersection(0,kn(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>mr!=r.x>mr&&this.addBorderIntersection(1,kn(l.y,r.y,(mr-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,kn(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>mr!=r.y>mr&&this.addBorderIntersection(3,kn(l.x,r.x,(mr-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new fr(0,0):new fr(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0):0}}function B_(c,r){const l=c.add(r)._unit(),u=ft(c.x*l.x+c.y*l.y,-1,1);var m,x,w;return m=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(m)))/4*by*((x=c).x*(w=r).y-x.y*w.x<0?-1:1)}const xw=[c=>c.x<0,c=>c.x>mr,c=>c.y<0,c=>c.y>mr];function Zm(c,r,l,u){const m=[4];if(u===0)return m;l._mult(u);const x=c.sub(l),w=r.sub(l),M=[c,r,x,w];for(let N=0;N<4;N++)for(const U of M)if(xw[N](U)){m.push(N);break}return m}class Eb{constructor(r){this.vertexArray=new id,this.indexArray=new Ac,this.programConfigurations=new g(r.layers,{zoom:r.zoom,lut:r.lut},l=>_w.includes(l)),this._segments=new nl,this.hiddenByLandmarkVertexArray=new Pu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new nl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,l,u,m=!1){const x=r.length;if(x>2){let w=Math.max(0,this._segments.get().length-1);const M=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[w].length);let N;w!==this._segments.get().length-1&&(w++,this._segmentToGroundQuads[w]=[],this._segmentToRegionTriCounts[w]=[0,0,0,0,0]);{const U=r[0],K=r[1];N=B_(U.sub(r[x-1])._perp()._unit(),K.sub(U)._perp()._unit())}for(let U=0;U<x;U++){const K=U===x-1?0:U+1,ee=r[U],oe=r[K],me=r[K===x-1?0:K+1],we=oe.sub(ee)._perp()._unit(),Le=B_(we,me.sub(oe)._perp()._unit()),ze=N,qe=Le;if(F_(ee,oe,l)||m&&kv(ee,l)&&kv(oe,l)){N=Le;continue}const ot=M.vertexLength;s0(this.vertexArray,ee,oe,1,1,ze),s0(this.vertexArray,ee,oe,1,0,ze),s0(this.vertexArray,ee,oe,0,1,qe),s0(this.vertexArray,ee,oe,0,0,qe),M.vertexLength+=4;const ct=Zm(ee,oe,we,u);for(const Re of ct)this._segmentToGroundQuads[w].push({id:ot,region:Re}),this._segmentToRegionTriCounts[w][Re]+=2,M.primitiveLength+=2;N=Le}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),l=r.length;for(let u=0;u<l;u++)this._segmentToGroundQuads[u].sort((m,x)=>m.region-x.region);for(let u=0;u<l;u++){const m=this._segmentToGroundQuads[u],x=r[u],w=this._segmentToRegionTriCounts[u];w.reduce((N,U)=>N+U,0);let M=0;for(let N=0;N<=4;N++){const U=w[N];if(U!==0){let K=this.regionSegments[N];K||(K=this.regionSegments[N]=new nl);const ee={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+M,vertexLength:x.vertexLength,primitiveLength:U};K.get().push(ee)}M+=U}for(let N=0;N<m.length;N++){const U=m[N].id;this.indexArray.emplaceBack(U,U+1,U+3),this.indexArray.emplaceBack(U,U+3,U+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,l,u,m,x,w,M){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,l,u,m,x,w,void 0,M)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,yw.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,l,u,m,x,w,M,N){this.hasData()&&this.programConfigurations.updatePaintArrays(r,l,u,m,x,w,M,N)}updateHiddenByLandmark(r){if(!this.hasData())return;const l=r.groundVertexCount+r.groundVertexArrayOffset;if(r.groundVertexCount===0)return;const u=r.flags&hd?1:0;for(let m=r.groundVertexArrayOffset;m<l;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,Tv.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const l=this.regionSegments[r];l&&l.destroy()}}}}class G0{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ac,this.footprintVertices=new Vc,this.footprintSegments=[],this.layoutVertexArray=new tm,this.centroidVertexArray=new yc,this.wallVertexArray=new Um,this.indexArray=new Ac,this.programConfigurations=new g(r.layers,{zoom:r.zoom,lut:r.lut},l=>j0.includes(l)),this.segments=new nl,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new Eb(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview}updateFootprints(r,l){}populate(r,l,u,m){this.features=[],this.hasPattern=Os("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$i(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:w,index:M,sourceLayerIndex:N}of r){const U=this.layers[0]._featureFilter.needGeometry,K=on(x,U);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),K,u))continue;const ee={id:w,sourceLayerIndex:N,index:M,geometry:U?K.geometry:pn(x,u,m),properties:x.properties,type:x.type,patterns:{}},oe=this.layoutVertexArray.length,me=Sx[ee.type]==="Polygon";if(this.hasPattern)this.features.push(Us("fill-extrusion",this.layers,ee,this.zoom,this.pixelRatio,l));else if(this.wallMode)for(const we of ee.geometry)for(const Le of xy(we,me))this.addFeature(ee,[Le],M,u,{},l.availableImages,m,l.brightness);else this.addFeature(ee,ee.geometry,M,u,{},l.availableImages,m,l.brightness);l.featureIndex.insert(x,ee.geometry,M,N,this.index,oe)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,l,u,m,x,w){for(const M of this.features){const N=Sx[M.type]==="Polygon",{geometry:U}=M;if(this.wallMode)for(const K of U)for(const ee of xy(K,N))this.addFeature(M,[ee],M.index,l,u,m,x,w);else this.addFeature(M,U,M.index,l,u,m,x,w)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,l,u,m,x,w,M){this.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,this.worldview),this.groundEffect.update(r,l,x,u,m,w,M,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Fu),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,r0.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Cb.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,yx.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,m,x,w,M,N){const U=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,K=[new fr(0,0),new fr(mr,mr)],ee=M.projection,oe=ee.name==="globe",me=this.wallMode||Sx[r.type]==="Polygon",we=new wy;we.centroidDataIndex=this.centroidData.length;const Le=new N_,ze=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,qe=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let ot;if(Le.height=qe,Le.vertexArrayOffset=this.layoutVertexArray.length,Le.groundVertexArrayOffset=this.groundEffect.vertexArray.length,oe&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Hp),this.wallMode){if(oe)return void tn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;ot=function(si){const Ci=si[0].x===si[si.length-1].x&&si[0].y===si[si.length-1].y;(function(hn){let Wr=0;const Ss=hn.length;for(let En=0;En<Ss;En++)Wr+=(hn[(En+1)%Ss].x-hn[En].x)*(hn[(En+1)%Ss].y+hn[En].y);return Wr>=0})(si)||(si=si.reverse());const Fr={geometry:[],joinNormals:[],indices:[]},gr=[],Rr=[],$r=[];let Zi=si.length;for(;Zi>=2&&si[Zi-1].equals(si[Zi-2]);)Zi--;if(Zi<(Ci?3:2))return Fr;let Ir,Hi,Xi,jr,Gr,Hn=0;for(;Hn<Zi-1&&si[Hn].equals(si[Hn+1]);)Hn++;Ci&&(Ir=si[Zi-2],Gr=si[Hn].sub(Ir)._unit()._perp());for(let hn=Hn;hn<Zi;hn++){if(Xi=hn===Zi-1?Ci?si[Hn+1]:void 0:si[hn+1],Xi&&si[hn].equals(Xi))continue;Gr&&(jr=Gr),Ir&&(Hi=Ir),Ir=si[hn],Gr=Xi?Xi.sub(Ir)._unit()._perp():jr,jr=jr||Gr;let Wr=jr.add(Gr);Wr.x===0&&Wr.y===0||Wr._unit();const Ss=Wr.x*Gr.x+Wr.y*Gr.y,En=Ss!==0?1/Ss:1/0,Dn=jr.x*Gr.y-jr.y*Gr.x>0;let ss="miter";const $s=2;ss==="miter"&&En>$s&&(ss="bevel"),ss==="bevel"&&(En>100&&(ss="flipbevel"),En<$s&&(ss="miter"));const Rs=(no,js,so,Pa)=>{const _l=new fr(no.x,no.y),yt=new fr(no.x,no.y);_l.x+=js.x*Pa,_l.y+=js.y*Pa,yt.x-=js.x*Math.max(so,1),yt.y-=js.y*Math.max(so,1),$r.push(js),gr.push(_l),Rr.push(yt)};if(ss==="miter")Wr._mult(En),Rs(Ir,Wr,0,0);else if(ss==="flipbevel")Wr=Gr.mult(-1),Rs(Ir,Wr,0,0),Rs(Ir,Wr.mult(-1),0,0);else{const no=-Math.sqrt(En*En-1),js=Dn?no:0,so=Dn?0:no;Hi&&Rs(Ir,jr,js,so),Xi&&Rs(Ir,Gr,js,so)}}Fr.geometry=[...gr,...Rr.reverse(),gr[0]],Fr.joinNormals=[...$r,...$r.reverse(),$r[$r.length-1]];const Mn=Fr.geometry.length-1;for(let hn=0;hn<Mn/2;hn++)if(hn+1<Mn/2){let Wr=hn,Ss=hn+1,En=Mn-1-hn,Dn=Mn-2-hn;Wr=Wr===0?Mn-1:Wr-1,Ss=Ss===0?Mn-1:Ss-1,En=En===0?Mn-1:En-1,Dn=Dn===0?Mn-1:Dn-1,Fr.indices.push(En),Fr.indices.push(Ss),Fr.indices.push(Wr),Fr.indices.push(En),Fr.indices.push(Dn),Fr.indices.push(Ss)}return Fr}(l[0]),l=[ot.geometry]}const ct=(si,Ci)=>si<(Ci.length-1)/2||si===Ci.length-1,Re=this.wallMode?[l]:da(l,500);for(let si=Re.length-1;si>=0;si--){const Ci=Re[si];(Ci.length===0||(tt=Ci[0]).every(qi=>qi.x<=0)||tt.every(qi=>qi.x>=mr)||tt.every(qi=>qi.y<=0)||tt.every(qi=>qi.y>=mr))&&Re.splice(si,1)}var tt;let ut;if(oe)ut=Mb(Re,K,m);else{ut=[];for(const si of Re)ut.push({polygon:si,bounds:K})}const Tt=me?this.edgeRadius:0,ri=Tt>0&&this.zoom<17,Xt=(si,Ci)=>{if(si.length===0)return!1;const qi=si[si.length-1];return Ci.x===qi.x&&Ci.y===qi.y};for(const{polygon:si,bounds:Ci}of ut){let qi=0,Fr=0;for(const Zi of si)me&&!Zi[0].equals(Zi[Zi.length-1])&&Zi.push(Zi[0]),Fr+=me?Zi.length-1:Zi.length;const gr=this.segments.prepareSegment((me?5:4)*Fr,this.layoutVertexArray,this.indexArray);Le.footprintSegIdx<0&&(Le.footprintSegIdx=this.footprintSegments.length),Le.polygonSegIdx<0&&(Le.polygonSegIdx=this.polygonSegments.length);const Rr={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},$r=new H0;if($r.vertexOffset=this.footprintVertices.length,$r.indexOffset=3*this.footprintIndices.length,$r.ringIndices=[],me){const Zi=[],Ir=[];qi=gr.vertexLength;for(let Xi=0;Xi<si.length;Xi++){const jr=si[Xi];jr.length&&Xi!==0&&Ir.push(Zi.length/2);const Gr=[];let Hn,Mn;Hn=jr[1].sub(jr[0])._perp()._unit(),$r.ringIndices.push(jr.length-1);for(let hn=1;hn<jr.length;hn++){const Wr=jr[hn],Ss=jr[hn===jr.length-1?1:hn+1],En=Wr.clone();if(Tt){Mn=Ss.sub(Wr)._perp()._unit();const Dn=Hn.add(Mn)._unit(),ss=Tt*Math.min(4,1/(Hn.x*Dn.x+Hn.y*Dn.y));En.x+=ss*Dn.x,En.y+=ss*Dn.y,En.x=Math.round(En.x),En.y=Math.round(En.y),Hn=Mn}if(!ze||Tt!==0&&!ri||Xt(Gr,En)||Gr.push(En),Xm(this.layoutVertexArray,En.x,En.y,0,0,1,1,0),this.wallMode){const Dn=ct(hn,jr);ud(this.wallVertexArray,ot.joinNormals[hn],!Dn)}gr.vertexLength++,this.footprintVertices.emplaceBack(Wr.x,Wr.y),Zi.push(Wr.x,Wr.y),oe&&o0(this.layoutVertexExtArray,ee.projectTilePoint(En.x,En.y,m),ee.upVector(m,En.x,En.y))}ze&&(Tt===0||ri)&&(Gr.length!==0&&Xt(Gr,Gr[0])&&Gr.pop(),this.groundEffect.addData(Gr,Ci,U))}const Hi=this.wallMode?ot.indices:je(Zi,Ir);for(let Xi=0;Xi<Hi.length;Xi+=3)this.footprintIndices.emplaceBack($r.vertexOffset+Hi[Xi+0],$r.vertexOffset+Hi[Xi+1],$r.vertexOffset+Hi[Xi+2]),this.indexArray.emplaceBack(qi+Hi[Xi],qi+Hi[Xi+2],qi+Hi[Xi+1]),gr.primitiveLength++;$r.indexCount+=Hi.length,$r.vertexCount+=this.footprintVertices.length-$r.vertexOffset}for(let Zi=0;Zi<si.length;Zi++){const Ir=si[Zi];we.startRing(Le,Ir[0]);let Hi=Ir.length>4&&Cx(Ir[Ir.length-2],Ir[0],Ir[1]),Xi=Tt?bw(Ir[Ir.length-2],Ir[0],Ir[1],Tt):0;const jr=[];let Gr,Hn,Mn;Hn=Ir[1].sub(Ir[0])._perp()._unit();let hn=!0;for(let Wr=1,Ss=0;Wr<Ir.length;Wr++){let En=Ir[Wr-1],Dn=Ir[Wr];const ss=Ir[Wr===Ir.length-1?1:Wr+1];if(we.appendEdge(Le,Dn,En),F_(Dn,En,Ci)){Tt&&(Hn=ss.sub(Dn)._perp()._unit(),hn=!hn);continue}const $s=Dn.sub(En)._perp(),Rs=$s.x/(Math.abs($s.x)+Math.abs($s.y)),no=$s.y>0?1:0,js=En.dist(Dn);if(Ss+js>32768&&(Ss=0),Tt){Mn=ss.sub(Dn)._perp()._unit();let yt=kb(En,Dn,ss,Ev(Hn,Mn),Tt);isNaN(yt)&&(yt=0);const Mt=Dn.sub(En)._unit();En=En.add(Mt.mult(Xi))._round(),Dn=Dn.add(Mt.mult(-yt))._round(),Xi=yt,Hn=Mn,ze&&this.zoom>=17&&(Xt(jr,En)||jr.push(En),Xt(jr,Dn)||jr.push(Dn))}const so=gr.vertexLength,Pa=Ir.length>4&&Cx(En,Dn,ss);let _l=Ab(Ss,Hi,hn);if(Xm(this.layoutVertexArray,En.x,En.y,Rs,no,0,0,_l),Xm(this.layoutVertexArray,En.x,En.y,Rs,no,0,1,_l),this.wallMode){const yt=ct(Wr-1,Ir),Mt=ot.joinNormals[Wr-1];ud(this.wallVertexArray,Mt,yt),ud(this.wallVertexArray,Mt,yt)}if(Ss+=js,_l=Ab(Ss,Pa,!hn),Hi=Pa,Xm(this.layoutVertexArray,Dn.x,Dn.y,Rs,no,0,0,_l),Xm(this.layoutVertexArray,Dn.x,Dn.y,Rs,no,0,1,_l),this.wallMode){const yt=ct(Wr,Ir),Mt=ot.joinNormals[Wr];ud(this.wallVertexArray,Mt,yt),ud(this.wallVertexArray,Mt,yt)}if(gr.vertexLength+=4,this.indexArray.emplaceBack(so+0,so+1,so+2),this.indexArray.emplaceBack(so+1,so+3,so+2),gr.primitiveLength+=2,Tt){const yt=qi+(Wr===1?Ir.length-2:Wr-2),Mt=Wr===1?qi:yt+1;if(this.indexArray.emplaceBack(so+1,yt,so+3),this.indexArray.emplaceBack(yt,Mt,so+3),gr.primitiveLength+=2,Gr===void 0&&(Gr=so),!F_(ss,Ir[Wr],Ci)){const ir=Wr===Ir.length-1?Gr:gr.vertexLength;this.indexArray.emplaceBack(so+2,so+3,ir),this.indexArray.emplaceBack(so+3,ir+1,ir),this.indexArray.emplaceBack(so+3,Mt,ir+1),gr.primitiveLength+=3}hn=!hn}if(oe){const yt=this.layoutVertexExtArray,Mt=ee.projectTilePoint(En.x,En.y,m),ir=ee.projectTilePoint(Dn.x,Dn.y,m),Zr=ee.upVector(m,En.x,En.y),un=ee.upVector(m,Dn.x,Dn.y);o0(yt,Mt,Zr),o0(yt,Mt,Zr),o0(yt,ir,un),o0(yt,ir,un)}}me&&(qi+=Ir.length-1),ze&&Tt&&this.zoom>=17&&(jr.length!==0&&Xt(jr,jr[0])&&jr.pop(),this.groundEffect.addData(jr,Ci,U,Tt>0))}this.footprintSegments.push($r),Rr.triangleCount=this.indexArray.length-Rr.triangleArrayOffset,this.polygonSegments.push(Rr),++Le.footprintSegLen,++Le.polygonSegLen}if(Le.vertexCount=this.layoutVertexArray.length-Le.vertexArrayOffset,Le.groundVertexCount=this.groundEffect.vertexArray.length-Le.groundVertexArrayOffset,Le.vertexCount!==0){if(Le.centroidXY=we.borders?Tx:this.encodeCentroid(we,Le),this.centroidData.push(Le),we.borders){this.featuresOnBorder.push(we);const si=this.featuresOnBorder.length-1;for(let Ci=0;Ci<we.borders.length;Ci++)we.borders[Ci][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ci].push(si)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,x,w,m,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,u,x,w,m,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,qe)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((l,u)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let M=0;M<this.centroidData.length;M++){const N=this.centroidData[M],U=+(N.min.y+N.max.y>mr),K=2*U+(+(N.min.x+N.max.x>mr)^U);for(let ee=0;ee<N.polygonSegLen;ee++){const oe=N.polygonSegIdx+ee;r.push({centroidIdx:M,subtile:K,polygonSegmentIdx:oe,triangleSegmentIdx:this.polygonSegments[oe].triangleSegIdx})}}const l=new Ac;r.sort((M,N)=>M.triangleSegmentIdx===N.triangleSegmentIdx?M.subtile-N.subtile:M.triangleSegmentIdx-N.triangleSegmentIdx);let u=0,m=0,x=0;for(const M of r){if(M.triangleSegmentIdx!==u)break;x++}const w=r.length;for(;m!==r.length;){u=r[m].triangleSegmentIdx;let M=0,N=m,U=m;for(let K=N;K<x&&r[K].subtile===M;K++)U++;for(;N!==x;){const K=r[N];M=K.subtile;const ee=this.centroidData[K.centroidIdx].min.clone(),oe=this.centroidData[K.centroidIdx].max.clone(),me={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let we=N;we<U;we++){const Le=r[we],ze=this.polygonSegments[Le.polygonSegmentIdx],qe=this.centroidData[Le.centroidIdx].min,ot=this.centroidData[Le.centroidIdx].max,ct=this.indexArray.uint16;for(let Re=ze.triangleArrayOffset;Re<ze.triangleArrayOffset+ze.triangleCount;Re++)l.emplaceBack(ct[3*Re],ct[3*Re+1],ct[3*Re+2]);me.primitiveLength+=ze.triangleCount,ee.x=Math.min(ee.x,qe.x),ee.y=Math.min(ee.y,qe.y),oe.x=Math.max(oe.x,ot.x),oe.y=Math.max(oe.y,ot.y)}me.primitiveLength>0&&this.triangleSubSegments.push({segment:me,min:ee,max:oe}),N=U;for(let we=N;we<x&&r[we].subtile===r[N].subtile;we++)U++}m=x;for(let K=m;K<w&&r[K].triangleSegmentIdx===r[m].triangleSegmentIdx;K++)x++}l._trim(),this.indexArray=l}getVisibleSegments(r,l,u){const m=new nl;if(this.wallMode){for(const Le of this.triangleSubSegments)m.segments.push(Le.segment);return m}let x=0,w=0;const M=1<<r.canonical.z;if(l){const Le=l.getMinMaxForTile(r);Le&&(x=Le.min,w=Le.max)}w+=this.maxHeight;const N=r.toUnwrapped();let U;const K=[N.canonical.x/M+N.wrap,N.canonical.y/M],ee=[(N.canonical.x+1)/M+N.wrap,(N.canonical.y+1)/M],oe=(Le,ze,qe)=>[Le[0]*(1-qe[0])+ze[0]*qe[0],Le[1]*(1-qe[1])+ze[1]*qe[1]],me=[],we=[];for(const Le of this.triangleSubSegments){me[0]=Le.min.x/mr,me[1]=Le.min.y/mr,we[0]=Le.max.x/mr,we[1]=Le.max.y/mr;const ze=oe(K,ee,me),qe=oe(K,ee,we);if(new Fo([ze[0],ze[1],x],[qe[0],qe[1],w]).intersectsPrecise(u)===0){U&&(m.segments.push(U),U=void 0);continue}const ot=Le.segment;U&&U.vertexOffset!==ot.vertexOffset&&(m.segments.push(U),U=void 0),U?(U.vertexLength+=ot.vertexLength,U.primitiveLength+=ot.primitiveLength):U={vertexOffset:ot.vertexOffset,primitiveLength:ot.primitiveLength,vertexLength:ot.vertexLength,primitiveOffset:ot.primitiveOffset,sortKey:void 0,vaos:{}}}return U&&m.segments.push(U),m}encodeCentroid(r,l){const u=r.centroid(),m=l.span(),x=Math.min(7,Math.round(m.x*this.tileToMeter/10)),w=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new fr(ft(u.x,1,mr-1)<<3|x,ft(u.y,1,mr-1)<<3|w)}encodeBorderCentroid(r){if(!r.borders)return new fr(0,0);const l=r.borders,u=Number.MAX_VALUE;if(l[0][0]!==u||l[1][0]!==u){const m=l[0][0]!==u?0:1;return new fr(6|(l[0][0]!==u?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{const m=l[2][0]!==u?2:3;return new fr((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==u?0:65528))}}showCentroid(r){const l=this.centroidData[r.centroidDataIndex];l.flags&=hd,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const l=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,m=r.flags&hd?Tx:r.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||x!==m.x){for(let w=l;w<u;++w)this.centroidVertexArray.emplace(w,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,l,u){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(r.toUnwrapped());if(_x(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const w of this.centroidData)w.flags&=2147483647;const x=[];for(const w of this.activeReplacements){if(w.order<u)continue;const M=Math.max(1,Math.pow(2,w.footprintTileId.canonical.z-r.canonical.z));for(const N of this.centroidData)if(!(N.flags&hd||w.min.x>N.max.x||N.min.x>w.max.x||w.min.y>N.max.y||N.min.y>w.max.y))for(let U=0;U<N.footprintSegLen;U++){const K=this.footprintSegments[N.footprintSegIdx+U];if(x.length=0,Ib(this.footprintVertices,K.vertexOffset,K.vertexCount,w.footprintTileId.canonical,r.canonical,x),xx(w.footprint,x,this.footprintIndices.uint16,K.indexOffset,K.indexCount,-K.vertexOffset,-M)){N.flags|=hd;break}}}for(const w of this.centroidData)this.writeCentroidToBuffer(w);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,l,u){let m=!1;for(let x=0;x<u.footprintSegLen;x++){const w=this.footprintSegments[u.footprintSegIdx+x];let M=0;for(const N of w.ringIndices){for(let U=M,K=N+M-1;U<N+M;K=U++){const ee=this.footprintVertices.int16[2*(U+w.vertexOffset)+0],oe=this.footprintVertices.int16[2*(U+w.vertexOffset)+1],me=this.footprintVertices.int16[2*(K+w.vertexOffset)+1];oe>l!=me>l&&r<(this.footprintVertices.int16[2*(K+w.vertexOffset)+0]-ee)*(l-oe)/(me-oe)+ee&&(m=!m)}M=N}}return m}getHeightAtTileCoord(r,l){let u=Number.NEGATIVE_INFINITY,m=!0;const x=4*(r+mr)*mr+(l+mr);if(this.partLookup.hasOwnProperty(x)){const w=this.partLookup[x];return w?{height:w.height,hidden:!!(w.flags&hd)}:void 0}for(const w of this.centroidData)r>w.max.x||w.min.x>r||l>w.max.y||w.min.y>l||this.footprintContainsPoint(r,l,w)&&w&&w.height>u&&(u=w.height,this.partLookup[x]=w,m=!!(w.flags&hd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[x]=void 0}}function Ev(c,r){const l=c.add(r)._unit();return c.x*l.x+c.y*l.y}function bw(c,r,l,u){const m=r.sub(c)._perp()._unit(),x=l.sub(r)._perp()._unit();return kb(c,r,l,Ev(m,x),u)}function kb(c,r,l,u,m){const x=Math.sqrt(1-u*u);return Math.min(c.dist(r)/3,r.dist(l)/3,m*x/u)}function F_(c,r,l){return c.x<l[0].x&&r.x<l[0].x||c.x>l[1].x&&r.x>l[1].x||c.y<l[0].y&&r.y<l[0].y||c.y>l[1].y&&r.y>l[1].y}function kv(c,r){return c.x<r[0].x||c.x>r[1].x||c.y<r[0].y||c.y>r[1].y}function Cx(c,r,l){if(c.x<0||c.x>=mr||r.x<0||r.x>=mr||l.x<0||l.x>=mr)return!1;const u=l.sub(r),m=u.perp(),x=c.sub(r);return(u.x*x.x+u.y*x.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(x.x*x.x+x.y*x.y))>-.866&&m.x*x.x+m.y*x.y<0}function Ab(c,r,l){const u=r?2|c:-3&c;return l?1|u:-2&u}function Sy(){const c=Math.PI/32,r=Math.tan(c),l=We;return l*Math.sqrt(1+2*r*r)-l}function Mb(c,r,l){const u=1<<l.z,m=qt(l.x/u),x=qt((l.x+1)/u),w=Ei(l.y/u),M=Ei((l.y+1)/u);return function(N,U,K,ee,oe=0,me){const we=[];if(!N.length||!K||!ee)return we;const Le=(ut,Tt)=>{for(const ri of ut)we.push({polygon:ri,bounds:Tt})},ze=Math.ceil(Math.log2(K)),qe=Math.ceil(Math.log2(ee)),ot=ze-qe,ct=[];for(let ut=0;ut<Math.abs(ot);ut++)ct.push(ot>0?0:1);for(let ut=0;ut<Math.min(ze,qe);ut++)ct.push(0),ct.push(1);let Re=N;if(Re=Rl(Re,U[0].y-oe,U[1].y+oe,1),Re=Rl(Re,U[0].x-oe,U[1].x+oe,0),!Re.length)return we;const tt=[];for(ct.length?tt.push({polygons:Re,bounds:U,depth:0}):Le(Re,U);tt.length;){const ut=tt.pop(),Tt=ut.depth,ri=ct[Tt],Xt=ut.bounds[0],si=ut.bounds[1],Ci=ri===0?Xt.x:Xt.y,qi=ri===0?si.x:si.y,Fr=me?me(ri,Ci,qi):.5*(Ci+qi),gr=Rl(ut.polygons,Ci-oe,Fr+oe,ri),Rr=Rl(ut.polygons,Fr-oe,qi+oe,ri);if(gr.length){const $r=[Xt,new fr(ri===0?Fr:si.x,ri===1?Fr:si.y)];ct.length>Tt+1?tt.push({polygons:gr,bounds:$r,depth:Tt+1}):Le(gr,$r)}if(Rr.length){const $r=[new fr(ri===0?Fr:Xt.x,ri===1?Fr:Xt.y),si];ct.length>Tt+1?tt.push({polygons:Rr,bounds:$r,depth:Tt+1}):Le(Rr,$r)}}return we}(c,r,Math.ceil((x-m)/11.25),Math.ceil((w-M)/11.25),1,(N,U,K)=>{if(N===0)return .5*(U+K);{const ee=Ei((l.y+U/mr)/u);return(Et(.5*(Ei((l.y+K/mr)/u)+ee))*u-l.y)*mr}})}function Ib(c,r,l,u,m,x){const w=Math.pow(2,u.z-m.z);for(let M=0;M<l;M++){let N=c.int16[2*(M+r)+0],U=c.int16[2*(M+r)+1];N=(N+m.x*mr)*w-u.x*mr,U=(U+m.y*mr)*w-u.y*mr,x.push(new fr(N,U))}}let a0,Lb;mn(G0,"FillExtrusionBucket",{omit:["layers","features"]}),mn(N_,"PartData"),mn(H0,"FootprintSegment"),mn(wy,"BorderCentroidData"),mn(Eb,"GroundEffect");class Ty extends fr{constructor(r,l,u){super(r,l),this.z=u}}class Db extends Ty{constructor(r,l,u,m){super(r,l,u),this.w=m}}function Av(c,r,l,u){const m=l==="x"?"y":"x",x=(u-c[l])/(r[l]-c[l]);c[m]=Math.round(c[m]+(r[m]-c[m])*x),c[l]=u,c.hasOwnProperty("z")&&(c.z=kn(c.z,r.z,x)),c.hasOwnProperty("w")&&(c.w=kn(c.w,r.w,x))}function Pb(c,r,l,u){const m=l,x=u;for(const w of["x","y"]){let M=c,N=r;M[w]>=N[w]&&(M=r,N=c),M[w]<m&&N[w]>m&&Av(M,N,w,m),M[w]<x&&N[w]>x&&Av(N,M,w,x)}}function Mv(c,r,l,u,m,x){const w=[];for(let M=0;M<c.length;M++){const N=c[M];let U;const K=w.length;let ee=0;for(let oe=0;oe<N.length-1;oe++){let me=N[oe],we=N[oe+1],Le=0;const ze=ee;let qe,ot;x&&(Le=Math.hypot(we.x-me.x,we.y-me.y),ee+=Le,qe=me,ot=we),me.x<r&&we.x<r||(me.x<r?me=new fr(r,me.y+(r-me.x)/(we.x-me.x)*(we.y-me.y))._round():we.x<r&&(we=new fr(r,me.y+(r-me.x)/(we.x-me.x)*(we.y-me.y))._round()),me.y<l&&we.y<l||(me.y<l?me=new fr(me.x+(l-me.y)/(we.y-me.y)*(we.x-me.x),l)._round():we.y<l&&(we=new fr(me.x+(l-me.y)/(we.y-me.y)*(we.x-me.x),l)._round()),me.x>=u&&we.x>=u||(me.x>=u?me=new fr(u,me.y+(u-me.x)/(we.x-me.x)*(we.y-me.y))._round():we.x>=u&&(we=new fr(u,me.y+(u-me.x)/(we.x-me.x)*(we.y-me.y))._round()),me.y>=m&&we.y>=m||(me.y>=m?me=new fr(me.x+(m-me.y)/(we.y-me.y)*(we.x-me.x),m)._round():we.y>=m&&(we=new fr(me.x+(m-me.y)/(we.y-me.y)*(we.x-me.x),m)._round()),U&&me.equals(U[U.length-1])||(U=[me],w.push(U),x&&x.push({progress:{min:ze+Iv(qe,ot,me)*Le,max:1},parentIndex:M,prevPoint:qe,nextPoint:ot})),U.push(we),x&&(x[x.length-1].progress.max=ze+Iv(qe,ot,we)*Le,x[x.length-1].nextPoint=ot)))))}if(x&&ee>0)for(let oe=K;oe<w.length;oe++)x[oe].progress.min/=ee,x[oe].progress.max/=ee}return w}function ww(c,r,l,u,m){if(c.length<2)return void u.push(c);const x=[];for(;r.valid();){const[U,K]=r.get();for(let ee=0;ee<c.length-1;ee++){const oe=c[ee],me=c[ee+1],we=uy(oe,me,U,K);if(we){const[Le]=we,ze=new fr(kn(oe.x,me.x,Le),kn(oe.y,me.y,Le));x.push({t:ee+Le,distance:0,point:ze})}}r.next()}if(x.length===0)return void u.push(c);x.sort((U,K)=>U.t-K.t);let w=0,M=0,N=[];for(u.push(N);w!==c.length;){if(M===x.length){for(;w!==c.length;)N.length!==0&&N[N.length-1].equals(c[w])||N.push(c[w]),w++;break}x[M].t<=w?(N.length!==0&&N[N.length-1].equals(x[M].point)||N.push(x[M].point),Math.trunc(x[M].t),M++):(N.length!==0&&N[N.length-1].equals(c[w])||N.push(c[w]),w++)}}function Iv(c,r,l){return c.x!==r.x?(l.x-c.x)/(r.x-c.x):c.y!==r.y?(l.y-c.y)/(r.y-c.y):0}function l0(c,r){return c.x*r.x+c.y*r.y}function Ex(c,r){if(c.length===1){let l=0;const u=r[l++];let m;for(;!m||u.equals(m);)if(m=r[l++],!m)return 1/0;for(;l<r.length;l++){const x=r[l],w=c[0],M=m.sub(u),N=x.sub(u),U=w.sub(u),K=l0(M,M),ee=l0(M,N),oe=l0(N,N),me=l0(U,M),we=l0(U,N),Le=K*oe-ee*ee,ze=(oe*me-ee*we)/Le,qe=(K*we-ee*me)/Le,ot=u.z*(1-ze-qe)+m.z*ze+x.z*qe;if(isFinite(ot))return ot}return 1/0}{let l=1/0;for(const u of r)l=Math.min(l,u.z);return l}}function Ob(c,r,l,u,m,x,w,M){const N=w*m.getElevationAt(c,r,!0,!0),U=x[0]!==0,K=U?x[1]===0?w*(x[0]/7-450):w*function(ee,oe,me){const we=Math.floor(oe[0]/8),Le=Math.floor(oe[1]/8),ze=10*(oe[0]-8*we),qe=10*(oe[1]-8*Le),ot=ee.getElevationAt(we,Le,!0,!0),ct=ee.getMeterToDEM(me),Re=Math.floor(.5*(ze*ct-1)),tt=Math.floor(.5*(qe*ct-1)),ut=ee.tileCoordToPixel(we,Le),Tt=2*Re+1,ri=2*tt+1,Xt=function(Rr,$r,Zi,Ir,Hi){return[Rr.getElevationAtPixel($r,Zi,!0),Rr.getElevationAtPixel($r+Hi,Zi,!0),Rr.getElevationAtPixel($r,Zi+Hi,!0),Rr.getElevationAtPixel($r+Ir,Zi+Hi,!0)]}(ee,ut.x-Re,ut.y-tt,Tt,ri),si=Math.abs(Xt[0]-Xt[1]),Ci=Math.abs(Xt[2]-Xt[3]),qi=Math.abs(Xt[0]-Xt[2])+Math.abs(Xt[1]-Xt[3]),Fr=Math.min(.25,.5*ct*(si+Ci)/Tt),gr=Math.min(.25,.5*ct*qi/ri);return ot+Math.max(Fr*ze,gr*qe)}(m,x,M):N;return{base:N+(l===0?-1:l),top:U?Math.max(K+u,N+l+2):N+u}}class Sw{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tw{constructor(){this.tasks={},this.taskQueue=[],ln(["process"],this),this.invoker=new Sw(this.process),this.nextId=0}add(r,l){const u=this.nextId++,m=function({type:x,isSymbolTile:w,zoom:M}){return M=M||0,x==="message"?0:x!=="maybePrepare"||w?x!=="parseTile"||w?x==="parseTile"&&w?300-M:x==="maybePrepare"&&w?400-M:500:200-M:100-M}(l);if(m===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:l,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const x=this.tasks[this.taskQueue[m]];x.priority<l&&(l=x.priority,r=m)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class q0{constructor(r,l,u){this.target=r,this.parent=l,this.mapId=u,this.callbacks={},this.cancelCallbacks={},ln(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tw}send(r,l,u,m,x=!1,w){const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=w,this.callbacks[M]=u);const N=new Set;return this.target.postMessage({id:M,type:r,hasCallback:!!u,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:mu(l,N)},N),{cancel:()=>{u&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(r){const l=r.data;if(!l)return;const u=l.id;if(u&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(l.mustQueue||_r(self)){const m=this.callbacks[u],x=this.scheduler.add(()=>this.processTask(u,l),m&&m.metadata||{type:"message"});x&&(this.cancelCallbacks[u]=x)}else this.processTask(u,l)}processTask(r,l){if(delete this.cancelCallbacks[r],l.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(l.error?u(Hl(l.error)):u(null,Hl(l.data)))}else{const u=new Set,m=l.hasCallback?(w,M)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:w?mu(w):null,data:mu(M,u)},u)}:()=>{},x=Hl(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,x,m);else if(this.parent.getWorkerSource){const w=l.type.split("."),{source:M,scope:N}=x;this.parent.getWorkerSource(l.sourceMapId,w[0],M,N)[w[1]](x,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Y0={workerUrl:"",workerClass:null,workerParams:void 0};const Af="mapboxgl_preloaded_worker_pool";class dm{constructor(){this.active={}}acquire(r,l=dm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;)this.workers.push(Y0.workerClass!=null?new Y0.workerClass:new self.Worker(Y0.workerUrl,Y0.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Af]}numActive(){return Object.keys(this.active).length}}dm.workerCount=2;class Nc{constructor(r,l,u="Worker",m=dm.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Fi();const x=this.workerPool.acquire(this.id,m);for(let w=0;w<x.length;w++){const M=new Nc.Actor(x[w],l,this.id);M.name=`${u} ${w}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,u){ti(this.actors,(m,x)=>{m.send(r,l,x)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let rp,kx;function Lv(){return rp||(rp=new dm),rp}Nc.Actor=q0;class Cw{constructor(r){this.module=r}createIntArray(r){const l=new Int32Array(r),u=this.module.malloc(l.length*l.BYTES_PER_ELEMENT);return this.module.heap32.set(l,u/l.BYTES_PER_ELEMENT),u}createFloatArray(r){const l=new Float32Array(r),u=this.module.malloc(l.length*l.BYTES_PER_ELEMENT);return this.module.heapF32.set(l,u/l.BYTES_PER_ELEMENT),u}createStringBuffer(r){const l=this.module.malloc(r.length+1);for(let u=0;u<r.length;++u)this.module.heapU8[l+u]=r.charCodeAt(u);return this.module.heapU8[l+r.length]=0,l}readStringBuffer(r){let l="";for(;this.module.heapU8[r]!==0;)l+=String.fromCharCode(this.module.heapU8[r]),++r;return l}setStyle(r){const l=r.entranceColorRgb,u=r.facadeGlazingColorRgb,m=r.roofColorRgb,x=r.wallColorRgb,w=r.normalScale;this.module.setStyle(l[0],l[1],l[2],u[0],u[1],u[2],m[0],m[1],m[2],x[0],x[1],x[2],w[0],w[1],w[2],r.tileToMeters)}setAOOptions(r,l){this.module.setAOOptions(r?1:0,l)}setMetricOptions(r,l){this.module.setMetricOptions(r?1:0,l)}setFacadeOptions(r,l,u){this.module.setFacadeOptions(r,l,u)}generateMesh(r,l){for(const M of r){const N=this.createStringBuffer(M.roofType),U=[0],K=[];for(const me of M.coordinates)if(Array.isArray(me)){for(const we of me)K.push(we.x),K.push(we.y);U.push(K.length)}const ee=this.createIntArray(U),oe=this.createFloatArray(K);this.module.addFeature(M.id,M.sourceId,M.minHeight,M.height,N,M.roofType.length,oe,ee,U.length-1),this.module.free(N),this.module.free(ee),this.module.free(oe)}for(const M of l){let N;N=M.entrances?JSON.parse(M.entrances):[];const U=this.createFloatArray(N),K=[];for(const oe of M.coordinates)K.push(oe.x),K.push(oe.y);const ee=this.createFloatArray(K);this.module.addFacade(M.sourceId,M.crossPerc,M.distanceToRoad,U,N.length,ee,K.length),this.module.free(U),this.module.free(ee)}if(!this.module.generateMesh()){const M=this.module.getLastError();return this.readStringBuffer(M)}const u=this.module.getMeshCount(),m=new Array(u);for(let M=0;M<u;M++){const N=this.module.getPositionsPtr(M),U=this.module.getPositionsLength(M),K=new Float32Array(this.module.heapF32.buffer,N,U),ee=this.module.getNormalsPtr(M),oe=this.module.getNormalsLength(M),me=new Float32Array(this.module.heapF32.buffer,ee,oe),we=this.module.getColorsPtr(M),Le=this.module.getColorsLength(M),ze=new Uint8Array(this.module.heapU8.buffer,we,Le),qe=this.module.getAOPtr(M),ot=this.module.getAOLength(M),ct=new Float32Array(this.module.heapF32.buffer,qe,ot),Re=this.module.getIndicesPtr(M),tt=this.module.getIndicesLength(M),ut=new Int32Array(this.module.heap32.buffer,Re,tt),Tt=this.module.getBuildingPart(M),ri=this.readStringBuffer(Tt);m[M]={positions:K,normals:me,colors:ze,ao:ct,indices:ut,buildingPart:ri}}const x=this.module.getRingCount(),w=[];for(let M=0;M<x;M++){const N=this.module.getRingPtr(M),U=this.module.getRingLength(M),K=new Float32Array(this.module.heapF32.buffer,N,U);w.push(K)}return{meshes:m,modifiedPolygonRings:w}}}let X0,Km,sh,Qm,Jm,Z0=null,np=null,Rb=null,z_=null;function K0(){return _r(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Km||vs.DRACO_URL}function Nb(){if(_r(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Qm)return Qm;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Qm=WebAssembly.validate(c)?vs.MESHOPT_SIMD_URL:vs.MESHOPT_URL,Qm}const U_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ax={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Mx(c,r,l){const u=l.json.bufferViews.length,m=l.buffers.length;r.bufferView=u,l.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},l.buffers[m]=c}const Dv="KHR_draco_mesh_compression";function Ix(c,r){const l=c.extensions&&c.extensions[Dv];if(!l)return;const u=new sh.Decoder,m=Lx(r,l.bufferView),x=new sh.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,x))throw new Error("Failed to decode Draco mesh");const w=r.json.accessors[c.indices],M=U_[w.componentType],N=w.count*M.BYTES_PER_ELEMENT,U=sh._malloc(N);M===Uint16Array?u.GetTrianglesUInt16Array(x,N,U):u.GetTrianglesUInt32Array(x,N,U),Mx(sh.memory.buffer.slice(U,U+N),w,r),sh._free(U);for(const K of Object.keys(l.attributes)){const ee=u.GetAttributeByUniqueId(x,l.attributes[K]),oe=r.json.accessors[c.attributes[K]],me=Ax[oe.componentType],we=oe.count*Jp[oe.type]*U_[oe.componentType].BYTES_PER_ELEMENT,Le=sh._malloc(we);u.GetAttributeDataArrayForAllPoints(x,ee,sh[me],we,Le),Mx(sh.memory.buffer.slice(Le,Le+we),oe,r),sh._free(Le)}u.destroy(),x.destroy(),delete c.extensions[Dv]}const Pv="EXT_meshopt_compression";function Ew(c,r){if(!c.extensions||!c.extensions[Pv])return;const l=c.extensions[Pv],u=new Uint8Array(r.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);Jm.decodeGltfBuffer(m,l.count,l.byteStride,u,l.mode,l.filter),c.buffer=r.buffers.length,c.byteOffset=0,r.buffers[c.buffer]=m.buffer,delete c.extensions[Pv]}const zg=1179937895,Bb=new TextDecoder("utf8");function c0(c,r){return new URL(c,r).href}function Ug(c,r,l,u){return fetch(c0(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{r.buffers[l]=m})}function Lx(c,r){const l=c.json.bufferViews[r];return new Uint8Array(c.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function Dx(c,r,l,u){if(c.uri){const m=c0(c.uri,u);return fetch(m).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{r.images[l]=x})}if(c.bufferView!==void 0){const m=Lx(r,c.bufferView),x=new Blob([m],{type:c.mimeType});return createImageBitmap(x).then(w=>{r.images[l]=w})}}function Px(c,r=0,l){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,r,1)[0]===zg){const K=new Uint32Array(c,r);let ee=2;const oe=(K[ee++]>>2)-3,me=K[ee++]>>2;if(ee++,u.json=JSON.parse(Bb.decode(K.subarray(ee,ee+me))),ee+=me,ee<oe){const we=K[ee++];ee++;const Le=r+(ee<<2);u.buffers[0]=c.slice(Le,Le+we)}}else u.json=JSON.parse(Bb.decode(new Uint8Array(c,r)));const{buffers:m,images:x,meshes:w,extensionsUsed:M,bufferViews:N}=u.json;let U=Promise.resolve();if(m){const K=[];for(let ee=0;ee<m.length;ee++){const oe=m[ee];oe.uri?K.push(Ug(oe,u,ee,l)):u.buffers[ee]||(u.buffers[ee]=null)}U=Promise.all(K)}return U.then(()=>{const K=[],ee=M&&M.includes(Dv),oe=M&&M.includes(Pv);if(ee&&K.push(function(){if(!sh)return X0??(X0=function(me){let we,Le=null;function ze(){we=new Uint8Array(Le.buffer)}function qe(){throw new Error("Unexpected Draco error.")}const ot={a:{a:qe,d:function(ct,Re,tt){return we.copyWithin(ct,Re,Re+tt)},c:function(ct){const Re=we.length,tt=Math.max(ct>>>0,Math.ceil(1.2*Re)),ut=Math.ceil((tt-Re)/65536);try{return Le.grow(ut),ze(),!0}catch{return!1}},b:qe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(me,ot):me.then(ct=>ct.arrayBuffer()).then(ct=>WebAssembly.instantiate(ct,ot))).then(ct=>{const{Rb:Re,Qb:tt,P:ut,T:Tt,X:ri,Ja:Xt,La:si,Qa:Ci,Va:qi,Wa:Fr,eb:gr,jb:Rr,f:$r,e:Zi,yb:Ir,zb:Hi,Ab:Xi,Bb:jr,Db:Gr,Gb:Hn}=ct.instance.exports;Le=Zi;const Mn=(()=>{let hn=0,Wr=0,Ss=0,En=0;return Dn=>{Ss&&(Re(En),Re(hn),Wr+=Ss,Ss=hn=0),hn||(Wr+=128,hn=tt(Wr));const ss=Dn.length+7&-8;let $s=hn;ss>=Wr&&(Ss=ss,$s=En=tt(ss));for(let Rs=0;Rs<Dn.length;Rs++)we[$s+Rs]=Dn[Rs];return $s}})();return ze(),$r(),{memory:Zi,_free:Re,_malloc:tt,Mesh:class{constructor(){this.ptr=ut()}destroy(){Tt(this.ptr)}},Decoder:class{constructor(){this.ptr=Xt()}destroy(){Rr(this.ptr)}DecodeArrayToMesh(hn,Wr,Ss){const En=Mn(hn),Dn=si(this.ptr,En,Wr,Ss.ptr);return!!ri(Dn)}GetAttributeByUniqueId(hn,Wr){return{ptr:Ci(this.ptr,hn.ptr,Wr)}}GetTrianglesUInt16Array(hn,Wr,Ss){qi(this.ptr,hn.ptr,Wr,Ss)}GetTrianglesUInt32Array(hn,Wr,Ss){Fr(this.ptr,hn.ptr,Wr,Ss)}GetAttributeDataArrayForAllPoints(hn,Wr,Ss,En,Dn){gr(this.ptr,hn.ptr,Wr.ptr,Ss,En,Dn)}},DT_INT8:Ir(),DT_UINT8:Hi(),DT_INT16:Xi(),DT_UINT16:jr(),DT_UINT32:Gr(),DT_FLOAT32:Hn()}})}(fetch(K0())),X0.then(me=>{sh=me,X0=void 0}))}()),oe&&K.push(function(){if(Jm)return;const me=function(we){let Le;const ze=WebAssembly.instantiateStreaming(we,{}).then(ct=>{Le=ct.instance,Le.exports.__wasm_call_ctors()}),qe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ot={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ze,supported:!0,decodeGltfBuffer(ct,Re,tt,ut,Tt,ri){(function(Xt,si,Ci,qi,Fr,gr,Rr){const $r=Xt.exports.sbrk,Zi=qi+3&-4,Ir=$r(Zi*Fr),Hi=$r(gr.length),Xi=new Uint8Array(Xt.exports.memory.buffer);Xi.set(gr,Hi);const jr=si(Ir,qi,Fr,Hi,gr.length);if(jr===0&&Rr&&Rr(Ir,Zi,Fr),Ci.set(Xi.subarray(Ir,Ir+qi*Fr)),$r(Ir-$r(0)),jr!==0)throw new Error(`Malformed buffer data: ${jr}`)})(Le,Le.exports[ot[Tt]],ct,Re,tt,ut,Le.exports[qe[ri]])}}}(fetch(Nb()));return me.ready.then(()=>{Jm=me})}()),x)for(let me=0;me<x.length;me++)K.push(Dx(x[me],u,me,l));return(K.length?Promise.all(K):Promise.resolve()).then(()=>{if(ee&&w)for(const{primitives:me}of w)for(const we of me)Ix(we,u);if(oe&&w&&N)for(const me of N)Ew(me,u);return u})})}class Ov{constructor(r){this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.hasPattern=!1,this.worldview=r.worldview}updateFootprints(r,l){}prepare(){return function(){if(z_!=null||Rb!=null)return null;if(np!=null)return np;const r=fetch(vs.BUILDING_GEN_URL);return np=function(l){let u,m,x,w;function M(){u=new Uint8Array(w.buffer),m=new Int32Array(w.buffer),x=new Float32Array(w.buffer)}function N(){throw new Error("Unexpected BuildingGen error.")}const U=()=>{},K={a:{a:N,f:function(ee){const oe=u.length,me=Math.max(ee>>>0,Math.ceil(1.2*oe)),we=Math.ceil((me-oe)/65536);try{return w.grow(we),M(),!0}catch{return!1}},g:N,b:U,c:U,d:U,e:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(l,K):l.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,K))).then(ee=>{const oe=ee.instance.exports;return(0,oe.g)(),w=oe.f,M(),new Cw({setStyle:oe.h,setAOOptions:oe.i,setMetricOptions:oe.j,setFacadeOptions:oe.k,addFeature:oe.l,addFacade:oe.m,generateMesh:oe.n,getLastError:oe.o,getMeshCount:oe.p,getPositionsPtr:oe.q,getPositionsLength:oe.r,getNormalsPtr:oe.s,getNormalsLength:oe.t,getColorsPtr:oe.u,getColorsLength:oe.v,getAOPtr:oe.w,getAOLength:oe.x,getIndicesPtr:oe.y,getIndicesLength:oe.z,getBuildingPart:oe.A,getRingCount:oe.B,getRingPtr:oe.C,getRingLength:oe.D,free:oe.E,malloc:oe.F,heapU8:u,heap32:m,heapF32:x})})}(r).then(l=>(np=null,z_=l,z_)).catch(l=>{tn("Could not load building-gen"),np=null,Rb=l}),np}()}populate(r,l,u,m){}update(r,l,u,m,x,w,M){}isEmpty(){return!1}uploadPending(){return!1}upload(r){}destroy(){}getHeightAtTileCoord(r,l){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let Ox,Fb;mn(Ov,"BuildingBucket",{omit:["layers"]});const zb=lo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Ub=lo([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$b}=zb,kw=lo([{name:"a_packed",components:3,type:"Float32"}]),{members:Aw}=kw,Rx=lo([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:I}=Rx;class W{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new H({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const u=this.getKey(r,l);return this.positions[u]}trim(){const r=this.width,l=this.height=Pr(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,u){const m=[];let x=r.length%2==1?-r[r.length-1]*u:0,w=r[0]*u,M=!0;m.push({left:x,right:w,isDash:M,zeroLength:r[0]===0});let N=r[0];for(let U=1;U<r.length;U++){M=!M;const K=r[U];x=N*u,N+=K,w=N*u,m.push({left:x,right:w,isDash:M,zeroLength:K===0})}return m}addRoundDash(r,l,u){const m=l/2;for(let x=-u;x<=u;x++){const w=this.width*(this.nextRow+u+x);let M=0,N=r[M];for(let U=0;U<this.width;U++){U/N.right>1&&(N=r[++M]);const K=Math.abs(U-N.left),ee=Math.abs(U-N.right),oe=Math.min(K,ee);let me;const we=x/u*(m+1);if(N.isDash){const Le=m-Math.abs(we);me=Math.sqrt(oe*oe+Le*Le)}else me=m-Math.sqrt(oe*oe+we*we);this.image.data[w+U]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(r,l){for(let N=r.length-1;N>=0;--N){const U=r[N],K=r[N+1];U.zeroLength?r.splice(N,1):K&&K.isDash===U.isDash&&(K.left=U.left,r.splice(N,1))}const u=r[0],m=r[r.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const x=this.width*this.nextRow;let w=0,M=r[w];for(let N=0;N<this.width;N++){N/M.right>1&&(M=r[++w]);const U=Math.abs(N-M.left),K=Math.abs(N-M.right),ee=Math.min(U,K);this.image.data[x+N]=Math.max(0,Math.min(255,(M.isDash?ee:-ee)+l+128))}}addDash(r,l){const u=this.getKey(r,l);if(this.positions[u])return this.positions[u];const m=l==="round",x=m?7:0,w=2*x+1;if(this.nextRow+w>this.height)return tn("LineAtlas out of space"),null;r.length===0&&r.push(1);let M=0;for(let K=0;K<r.length;K++)r[K]<0&&(tn("Negative value is found in line dasharray, replacing values with 0"),r[K]=0),M+=r[K];if(M!==0){const K=this.width/M,ee=this.getDashRanges(r,this.width,K);m?this.addRoundDash(ee,K,x):this.addRegularDash(ee,l==="square"?.5*K:0)}const N=this.nextRow+x;this.nextRow+=w;const U={tl:[N,x],br:[M,0]};return this.positions[u]=U,U}}mn(W,"LineAtlas");const pe=cs.VectorTileFeature.types,Ve=Math.cos(Math.PI/180*37.5),gt=Math.cos(Math.PI/180*5);class Qt{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new sc,this.layoutVertexArray2=new Wc,this.patternVertexArray=new Wc,this.indexArray=new Ac,this.programConfigurations=new g(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new nl,this.maxLineLength=0,this.zOffsetVertexArray=new Wc,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:mr/64,this.worldview=r.worldview}updateFootprints(r,l){}populate(r,l,u,m){this.hasPattern=Os("line",this.layers,this.pixelRatio,l);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$i(u);const w=this.layers[0].layout.get("line-elevation-reference");if(w==="hd-road-markup")this.elevationType="road";else{const oe=this.layers[0].layout.get("line-z-offset"),me=oe.isConstant()&&!oe.constantOr(0);this.elevationType=w!=="sea"&&w!=="ground"&&me?"none":"offset",this.elevationType==="offset"&&w==="none"&&tn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&M!==void 0;const N=[];for(const{feature:oe,id:me,index:we,sourceLayerIndex:Le}of r){const ze=this.layers[0]._featureFilter.needGeometry,qe=on(oe,ze);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),qe,u))continue;const ot=x?x.evaluate(qe,{},u):void 0,ct={id:me,properties:oe.properties,type:oe.type,sourceLayerIndex:Le,index:we,geometry:ze?qe.geometry:pn(oe,u,m),patterns:{},sortKey:ot};N.push(ct)}x&&N.sort((oe,me)=>oe.sortKey-me.sortKey);const{lineAtlas:U,featureIndex:K}=l,ee=this.addConstantDashes(U);for(const oe of N){const{geometry:me,index:we,sourceLayerIndex:Le}=oe;if(ee&&this.addFeatureDashes(oe,U),this.hasPattern){const ze=Us("line",this.layers,oe,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ze)}else this.addFeature(oe,me,we,u,U.positions,l.availableImages,l.brightness,l.elevationFeatures);K.insert(r[we].feature,me,we,Le,this.index)}}addConstantDashes(r){let l=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,x=u.layout.get("line-cap").value;if(m.kind!=="constant"||x.kind!=="constant")l=!0;else{const w=x.value,M=m.value;if(!M)continue;r.addDash(M,w)}}return l}addFeatureDashes(r,l){const u=this.zoom;for(const m of this.layers){const x=m.paint.get("line-dasharray").value,w=m.layout.get("line-cap").value;if(x.kind==="constant"&&w.kind==="constant")continue;let M,N;if(x.kind==="constant"){if(M=x.value,!M)continue}else M=x.evaluate({zoom:u},r);N=w.kind==="constant"?w.value:w.evaluate({zoom:u},r),l.addDash(M,N),r.patterns[m.id]=[l.getKey(M,N)]}}update(r,l,u,m,x,w,M,N){this.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,N)}addFeatures(r,l,u,m,x,w){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,l,u,m,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Aw)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,I)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,Ub.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,$b),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,u,m,x,w,M,N){const U=this.layers[0].layout,K=U.get("line-join").evaluate(r,{}),ee=U.get("line-cap").evaluate(r,{}),oe=U.get("line-miter-limit"),me=U.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r,this.zOffsetValue=U.get("line-z-offset").value;const we=this.layers[0].paint.get("line-width").value;if(we.kind!=="constant"&&we.isLineProgressConstant===!1&&(this.variableWidthValue=we),this.elevationType==="road"){const Le=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,l,m,N,K,ee,oe,me)){const[ze,qe]=this.clipRuntimeLinesToTile(l,1);for(let ot=0;ot<ze.length;ot++){const ct=ze[ot],Re=qe[ot],tt={progress:{min:Re.progress.min,max:Re.progress.max},nextDir:this.computeSegNextDir(Re,ct),prevDir:this.computeSegPrevDir(Re,ct)};this.addLine(ct,r,m,K,ee,oe,me,tt)}this.fillNonElevatedRoadSegment(Le)}}else for(const Le of l)this.addLine(Le,r,m,K,ee,oe,me);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,x,w,m,M,void 0,this.worldview)}computeSegNextDir(r,l){return r.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(r,l){return l[1].sub(r.prevPoint).unit()}clipLinesToTile(r,l){return Mv(r,-l,-l,mr+l,mr+l)}clipRuntimeLinesToTile(r,l){const u=[];return[Mv(r,-l,-l,mr+l,mr+l,u),u]}addElevatedRoadFeature(r,l,u,m,x,w,M,N){const U=[],K=od.getElevationFeature(r,m);if(K){const ee=this.clipLinesToTile(l,1),oe=this.prepareElevatedLines(ee,K,u);for(const me of oe)U.push({geometry:me,elevation:K,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(U.length===0)return!1;for(const ee of U){const oe=this.layoutVertexArray.length;this.addLine(ee.geometry,r,u,x,w,M,N);const me=new Od(u,ee.elevationTileID);if(ee.elevation)for(let we=oe;we<this.layoutVertexArray.length;we++){const Le=new fr(this.layoutVertexArray.int16[6*we]>>1,this.layoutVertexArray.int16[6*we+1]>>1),ze=me.pointElevation(Le,ee.elevation,.05);this.updateHeightRange(ze),this.zOffsetVertexArray.emplaceBack(ze,0,0)}else this.fillNonElevatedRoadSegment(oe)}return!0}prepareElevatedLines(r,l,u){if(l.constantHeight!=null)return r;const m=[],x=1/$i(u);for(const w of r)ww(w,new ru(l,x),0,m);return m}fillNonElevatedRoadSegment(r){for(let l=r;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,l,u,m,x,w,M,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const U=m==="none";this.patternJoinNone=this.hasPattern&&U,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const K=N&&N.progress.min>0,ee=N&&N.progress.max<1;if(this.lineClips){let ri={min:this.lineClips.start,max:this.lineClips.end},Xt=1;if(N){const qi=this.lineClips.end-this.lineClips.start;ri=function(Fr,gr,Rr){return{min:Ps(Fr.min,gr,Rr),max:Ps(Fr.max,gr,Rr)}}(N.progress,{min:0,max:1},ri),qi>0&&(Xt=(ri.max-ri.min)/qi)}const si=+l.properties.mapbox_clip_feature_len,Ci=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(si)||Number.isNaN(Ci)){for(let Fr=0;Fr<r.length-1;Fr++)this.totalDistance+=r[Fr].dist(r[Fr+1]);const qi=this.totalDistance/(ri.max-ri.min);this.totalFeatureLength=Number.isFinite(qi)?qi:0,this.lineClips.start=ri.min,this.lineClips.end=ri.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=si,this.distance=Ci*Xt,this.lineClips.start=ri.min,this.lineClips.end=ri.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const oe=pe[l.type]==="Polygon";let me=r.length;for(;me>=2&&r[me-1].equals(r[me-2]);)me--;let we=0;for(;we<me-1&&r[we].equals(r[we+1]);)we++;if(me<(oe?3:2))return;m==="bevel"&&(w=1.05);const Le=this.segments.prepareSegment(10*me,this.layoutVertexArray,this.indexArray);let ze,qe,ot,ct,Re,tt,ut,Tt;N&&N.prevDir&&(tt=N.prevDir.perp()),N&&N.nextDir&&(ut=N.nextDir.perp()),this.e1=this.e2=-1,oe&&(ze=r[me-2],Re=r[we].sub(ze)._unit()._perp());for(let ri=we;ri<me;ri++){if(ot=ri===me-1?oe?r[we+1]:void 0:r[ri+1],ot&&r[ri].equals(ot))continue;Re&&(ct=Re),ze&&(qe=ze),ze=r[ri],Tt=this.evaluateLineProgressFeatures(qe?qe.dist(ze):0),Re=ot?ot.sub(ze)._unit()._perp():ct,ct=ct||Re;const Xt=qe&&ot;let si=Xt?m:oe||U?"butt":x;const Ci=ct.x*Re.x+ct.y*Re.y;if(U){const Hi=function(Xi){if(Xi.patternJoinNone){const jr=Xi.segmentPoints.length/2,Gr=Xi.lineSoFar-Xi.segmentStart;for(let Hn=0;Hn<jr;++Hn){const Mn=Xi.segmentPoints[2*Hn+1],hn=Math.round(Xi.segmentPoints[2*Hn])+.5+.25*Mn;Xi.patternVertexArray.emplaceBack(hn,Gr,Xi.segmentStart),Xi.patternVertexArray.emplaceBack(hn,Gr,Xi.segmentStart)}Xi.segmentPoints.length=0}Xi.e1=Xi.e2=-1};if(Xt&&Ci<gt){this.updateDistance(qe,ze),this.addCurrentVertex(ze,ct,1,1,Le,Tt),Hi(this),this.addCurrentVertex(ze,Re,-1,-1,Le,Tt);continue}if(qe){if(!ot){this.updateDistance(qe,ze),this.addCurrentVertex(ze,ct,1,1,Le,Tt),Hi(this);continue}si="miter"}}let qi=ct.add(Re);qi.x===0&&qi.y===0||qi._unit();const Fr=qi.x*Re.x+qi.y*Re.y,gr=Fr!==0?1/Fr:1/0,Rr=2*Math.sqrt(2-2*Fr),$r=Fr<Ve&&qe&&ot,Zi=ct.x*Re.y-ct.y*Re.x>0,Ir=this.overscaling<=16?15*mr/(512*this.overscaling):0;if(Xt&&si==="round"){if(gr<M)si="miter";else if(gr<=2){const Hi=Ii(ze,-10,mr+10);si=this.elevationType==="offset"&&(Hi||this.hasCrossSlope)?"miter":"fakeround"}}if(si==="miter"&&gr>w&&(si="bevel"),si==="bevel"&&(gr>2&&(si="flipbevel"),gr<w&&(si="miter")),qe&&!(si==="miter"&&$r)&&this.updateDistance(qe,ze),si==="miter")if($r){const Hi=ze.dist(qe);if(Hi>2*Ir){const jr=ze.sub(ze.sub(qe)._mult(Ir/Hi)._round());this.updateDistance(qe,jr),this.addCurrentVertex(jr,ct,0,0,Le,Tt),qe=jr}this.updateDistance(qe,ze),qi._mult(gr),this.addCurrentVertex(ze,qi,0,0,Le,Tt);const Xi=ze.dist(ot);if(Xi>2*Ir){const jr=ze.add(ot.sub(ze)._mult(Ir/Xi)._round());this.updateDistance(ze,jr),this.addCurrentVertex(jr,Re,0,0,Le,Tt),ze=jr}}else qi._mult(gr),this.addCurrentVertex(ze,qi,0,0,Le,Tt);else if(si==="flipbevel"){if(gr>100)qi=Re.mult(-1);else{const Hi=gr*ct.add(Re).mag()/ct.sub(Re).mag();qi._perp()._mult(Hi*(Zi?-1:1))}this.addCurrentVertex(ze,qi,0,0,Le,Tt),this.addCurrentVertex(ze,qi.mult(-1),0,0,Le,Tt)}else if(si==="bevel"||si==="fakeround"){Tt!=null&&qe&&this.addCurrentVertex(ze,ut||ct,-1,-1,Le,Tt);const Hi=ze.dist(qe)<=2*Ir&&si!=="bevel",Xi=qi.mult(Zi?1:-1);Xi._mult(gr);const jr=Re.mult(Zi?-1:1),Gr=ct.mult(Zi?-1:1),Hn=this.evaluateLineProgressFeatures(this.distance);if(Tt==null&&(this.addHalfVertex(ze,Xi.x,Xi.y,!1,!Zi,0,Le,Hn),Hi||this.addHalfVertex(ze,Xi.x+2*Gr.x,Xi.y+2*Gr.y,!1,Zi,0,Le,Hn)),si==="fakeround"){const Mn=Math.round(180*Rr/Math.PI/20);this.addHalfVertex(ze,Gr.x,Gr.y,!1,Zi,0,Le,Hn);for(let hn=0;hn<Mn;hn++){let Wr=hn/Mn;if(Wr!==.5){const En=Wr-.5;Wr+=Wr*En*(Wr-1)*((1.0904+Ci*(Ci*(3.55645-1.43519*Ci)-3.2452))*En*En+(.848013+Ci*(.215638*Ci-1.06021)))}const Ss=jr.sub(Gr)._mult(Wr)._add(Gr)._unit();this.addHalfVertex(ze,Ss.x,Ss.y,!1,Zi,0,Le,Hn)}this.addHalfVertex(ze,jr.x,jr.y,!1,Zi,0,Le,Hn)}Hi||Tt!=null||this.addHalfVertex(ze,Xi.x+2*jr.x,Xi.y+2*jr.y,!1,Zi,0,Le,Hn),Tt!=null&&ot&&this.addCurrentVertex(ze,tt||Re,1,1,Le,Tt)}else if(si==="butt")this.addCurrentVertex(ze,qi,0,0,Le,Tt);else if(si==="square"){if(!qe){const Hi=K?0:-1;this.addCurrentVertex(ze,qi,Hi,Hi,Le,Tt)}if(this.addCurrentVertex(ze,qi,0,0,Le,Tt),qe){const Hi=ee?0:1;this.addCurrentVertex(ze,qi,Hi,Hi,Le,Tt)}}else if(si==="round"){if(qe){const Hi=!Xt&&ut?ut:ct;this.addCurrentVertex(ze,Hi,0,0,Le,Tt),!Xt&&ee||this.addCurrentVertex(ze,Hi,1,1,Le,Tt,!0)}if(ot){const Hi=!Xt&&tt?tt:Re;!Xt&&K||this.addCurrentVertex(ze,Hi,-1,-1,Le,Tt,!0),this.addCurrentVertex(ze,Hi,0,0,Le,Tt)}}}}addVerticesTo(r,l,u,m,x,w,M,N,U,K){const ee=(l.w-r.w)/this.tessellationStep|0;let oe=0;const me=this.scaledDistance;if(ee>1){this.lineSoFar=r.w;const Le=(l.x-r.x)/ee,ze=(l.y-r.y)/ee,qe=(l.z-r.z)/ee,ot=(l.w-r.w)/ee;for(let ct=1;ct<ee;++ct){r.x+=Le,r.y+=ze,r.z+=qe,this.lineSoFar+=ot,oe+=ot;const Re=this.evaluateLineProgressFeatures(this.prevDistance+oe);this.scaledDistance=(this.prevDistance+oe)/this.totalDistance,this.addHalfVertex(r,u,m,K,!1,M,U,Re),this.addHalfVertex(r,x,w,K,!0,-N,U,Re)}}this.lineSoFar=l.w,this.scaledDistance=me;const we=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,u,m,K,!1,M,U,we),this.addHalfVertex(l,x,w,K,!0,-N,U,we)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):tn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(r,l,u,m,x,w,M=!1){const N=l.x+l.y*u,U=l.y-l.x*u,K=l.y*m-l.x,ee=-l.y-l.x*m;if(w!=null){const oe=this.elevationType==="offset",me=-10,we=mr+10,Le=w.zOffset,ze=new Db(r.x,r.y,Le,this.lineSoFar),qe=!!oe&&Ii(r,me,we),ot=this.lineSoFar,ct=this.distance;if(this.currentVertex)if(qe){const Re=this.currentVertexIsOutside,tt=this.currentVertex,ut=new Db(r.x,r.y,Le,this.lineSoFar);if(Pb(tt,ut,me,we),!Ii(ut,me,we)){if(Re){this.e1=this.e2=-1,this.distance-=tt.dist(ze),this.lineSoFar=tt.w;const Tt=this.evaluateLineProgressFeatures(tt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(tt,N,U,M,!1,u,x,Tt),this.addHalfVertex(tt,K,ee,M,!0,-m,x,Tt),this.prevDistance=this.distance}this.distance=this.prevDistance+tt.dist(ut),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(tt,ut,N,U,K,ee,u,m,x,M),this.distance=ct,this.scaledDistance=this.distance/this.totalDistance}}else{const Re=this.currentVertex;if(this.currentVertexIsOutside){Pb(Re,ze,me,we),this.e1=this.e2=-1,this.distance-=Re.dist(ze),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Re.w;const tt=this.evaluateLineProgressFeatures(Re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Re,N,U,M,!1,u,x,tt),this.addHalfVertex(Re,K,ee,M,!0,-m,x,tt),this.prevDistance=this.distance,this.distance=ct,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Re,ze,N,U,K,ee,u,m,x,M)}else qe||(this.addHalfVertex(r,N,U,M,!1,u,x,w),this.addHalfVertex(r,K,ee,M,!0,-m,x,w));this.currentVertex=ze,this.currentVertexIsOutside=qe,this.lineSoFar=ot}else this.addHalfVertex(r,N,U,M,!1,u,x,w),this.addHalfVertex(r,K,ee,M,!0,-m,x,w)}addHalfVertex({x:r,y:l},u,m,x,w,M,N,U){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),w||this.segmentPoints.push(this.lineSoFar-this.segmentStart,M)),this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(w?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(M===0?0:M<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const ee=kn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,ee)}const K=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),N.primitiveLength++),w?this.e2=K:this.e1=K,U!=null&&this.zOffsetVertexArray.emplaceBack(U.zOffset,U.variableWidth,U.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,l){this.prevDistance=this.distance,this.distance+=r.dist(l),this.updateScaledDistance()}}function Ii(c,r,l){return c.x<r||c.x>l||c.y<r||c.y>l}let Gi,br;function gn(c,r,l){return r*(mr/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}mn(Qt,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const _n=(c,r,l)=>(1-l)*c+l*r;function Cn(c,r){return 1/gn(c,1,r.tileZoom)}function _s(c,r,l,u){return c.translatePosMatrix(u||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Gs=c=>{const r=[];Lo(c)&&r.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const l=c.paint.get("line-trim-offset");l[0]===0&&l[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&r.push("LINE_JOIN_NONE"),r};function Lo(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let Ba;const zo=()=>Ba||(Ba={layout:Gi||(Gi=new ha({"line-cap":new cn(wi.layout_line["line-cap"]),"line-join":new cn(wi.layout_line["line-join"]),"line-miter-limit":new Wi(wi.layout_line["line-miter-limit"]),"line-round-limit":new Wi(wi.layout_line["line-round-limit"]),"line-sort-key":new cn(wi.layout_line["line-sort-key"]),"line-z-offset":new cn(wi.layout_line["line-z-offset"]),"line-elevation-reference":new Wi(wi.layout_line["line-elevation-reference"]),"line-cross-slope":new Wi(wi.layout_line["line-cross-slope"]),visibility:new Wi(wi.layout_line.visibility),"line-width-unit":new Wi(wi.layout_line["line-width-unit"])})),paint:br||(br=new ha({"line-opacity":new cn(wi.paint_line["line-opacity"]),"line-color":new cn(wi.paint_line["line-color"]),"line-translate":new Wi(wi.paint_line["line-translate"]),"line-translate-anchor":new Wi(wi.paint_line["line-translate-anchor"]),"line-width":new cn(wi.paint_line["line-width"]),"line-gap-width":new cn(wi.paint_line["line-gap-width"]),"line-offset":new cn(wi.paint_line["line-offset"]),"line-blur":new cn(wi.paint_line["line-blur"]),"line-dasharray":new cn(wi.paint_line["line-dasharray"]),"line-pattern":new cn(wi.paint_line["line-pattern"]),"line-pattern-cross-fade":new Wi(wi.paint_line["line-pattern-cross-fade"]),"line-gradient":new Jf(wi.paint_line["line-gradient"]),"line-trim-offset":new Wi(wi.paint_line["line-trim-offset"]),"line-trim-fade-range":new Wi(wi.paint_line["line-trim-fade-range"]),"line-trim-color":new Wi(wi.paint_line["line-trim-color"]),"line-emissive-strength":new Wi(wi.paint_line["line-emissive-strength"]),"line-border-width":new cn(wi.paint_line["line-border-width"]),"line-border-color":new cn(wi.paint_line["line-border-color"]),"line-occlusion-opacity":new Wi(wi.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},Ba);class al extends cn{possiblyEvaluate(r,l){return l=new sa(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition,worldview:l.worldview}),super.possiblyEvaluate(r,l)}evaluate(r,l,u,m){return l=ai({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(r,l,u,m)}}let Xa;function Tp(c,r){return r>0?r+2*c:c}const sp=lo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ef=lo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Gh=lo([{name:"a_projected_pos",components:4,type:"Float32"}],4);lo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pm=lo([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),fm=lo([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Vb=lo([{name:"a_texb",components:2,type:"Uint16"}]),Dk=lo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Pk=lo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);lo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const BT=lo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ok=lo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);lo([{name:"triangle",components:3,type:"Uint16"}]),lo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),lo([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),lo([{type:"Float32",name:"offsetX"}]),lo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qh=24;function FT(c,r,l){return c.sections.forEach(u=>{u.text=function(m,x,w){const M=x.layout.get("text-transform").evaluate(w,{});return M==="uppercase"?m=m.toLocaleUpperCase():M==="lowercase"&&(m=m.toLocaleLowerCase()),jd.applyArabicShaping&&(m=jd.applyArabicShaping(m)),m}(u.text,r,l)}),c}const Nx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Rk(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function Nk(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}var zT,Wb,UT,Mw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Rv(){return zT||(zT=1,Mw.read=function(c,r,l,u,m){var x,w,M=8*m-u-1,N=(1<<M)-1,U=N>>1,K=-7,ee=l?m-1:0,oe=l?-1:1,me=c[r+ee];for(ee+=oe,x=me&(1<<-K)-1,me>>=-K,K+=M;K>0;x=256*x+c[r+ee],ee+=oe,K-=8);for(w=x&(1<<-K)-1,x>>=-K,K+=u;K>0;w=256*w+c[r+ee],ee+=oe,K-=8);if(x===0)x=1-U;else{if(x===N)return w?NaN:1/0*(me?-1:1);w+=Math.pow(2,u),x-=U}return(me?-1:1)*w*Math.pow(2,x-u)},Mw.write=function(c,r,l,u,m,x){var w,M,N,U=8*x-m-1,K=(1<<U)-1,ee=K>>1,oe=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=u?0:x-1,we=u?1:-1,Le=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(M=isNaN(r)?1:0,w=K):(w=Math.floor(Math.log(r)/Math.LN2),r*(N=Math.pow(2,-w))<1&&(w--,N*=2),(r+=w+ee>=1?oe/N:oe*Math.pow(2,1-ee))*N>=2&&(w++,N/=2),w+ee>=K?(M=0,w=K):w+ee>=1?(M=(r*N-1)*Math.pow(2,m),w+=ee):(M=r*Math.pow(2,ee-1)*Math.pow(2,m),w=0));m>=8;c[l+me]=255&M,me+=we,M/=256,m-=8);for(w=w<<m|M,U+=m;U>0;c[l+me]=255&w,me+=we,w/=256,U-=8);c[l+me-we]|=128*Le}),Mw}function $_(){if(UT)return Wb;UT=1,Wb=r;var c=Rv();function r(Re){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Re)?Re:new Uint8Array(Re||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var l=4294967296,u=1/l,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function x(Re){return Re.type===r.Bytes?Re.readVarint()+Re.pos:Re.pos+1}function w(Re,tt,ut){return ut?4294967296*tt+(Re>>>0):4294967296*(tt>>>0)+(Re>>>0)}function M(Re,tt,ut){var Tt=tt<=16383?1:tt<=2097151?2:tt<=268435455?3:Math.floor(Math.log(tt)/(7*Math.LN2));ut.realloc(Tt);for(var ri=ut.pos-1;ri>=Re;ri--)ut.buf[ri+Tt]=ut.buf[ri]}function N(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeVarint(Re[ut])}function U(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeSVarint(Re[ut])}function K(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeFloat(Re[ut])}function ee(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeDouble(Re[ut])}function oe(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeBoolean(Re[ut])}function me(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeFixed32(Re[ut])}function we(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeSFixed32(Re[ut])}function Le(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeFixed64(Re[ut])}function ze(Re,tt){for(var ut=0;ut<Re.length;ut++)tt.writeSFixed64(Re[ut])}function qe(Re,tt){return(Re[tt]|Re[tt+1]<<8|Re[tt+2]<<16)+16777216*Re[tt+3]}function ot(Re,tt,ut){Re[ut]=tt,Re[ut+1]=tt>>>8,Re[ut+2]=tt>>>16,Re[ut+3]=tt>>>24}function ct(Re,tt){return(Re[tt]|Re[tt+1]<<8|Re[tt+2]<<16)+(Re[tt+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(Re,tt,ut){for(ut=ut||this.length;this.pos<ut;){var Tt=this.readVarint(),ri=Tt>>3,Xt=this.pos;this.type=7&Tt,Re(ri,tt,this),this.pos===Xt&&this.skip(Tt)}return tt},readMessage:function(Re,tt){return this.readFields(Re,tt,this.readVarint()+this.pos)},readFixed32:function(){var Re=qe(this.buf,this.pos);return this.pos+=4,Re},readSFixed32:function(){var Re=ct(this.buf,this.pos);return this.pos+=4,Re},readFixed64:function(){var Re=qe(this.buf,this.pos)+qe(this.buf,this.pos+4)*l;return this.pos+=8,Re},readSFixed64:function(){var Re=qe(this.buf,this.pos)+ct(this.buf,this.pos+4)*l;return this.pos+=8,Re},readFloat:function(){var Re=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Re},readDouble:function(){var Re=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Re},readVarint:function(Re){var tt,ut,Tt=this.buf;return tt=127&(ut=Tt[this.pos++]),ut<128?tt:(tt|=(127&(ut=Tt[this.pos++]))<<7,ut<128?tt:(tt|=(127&(ut=Tt[this.pos++]))<<14,ut<128?tt:(tt|=(127&(ut=Tt[this.pos++]))<<21,ut<128?tt:function(ri,Xt,si){var Ci,qi,Fr=si.buf;if(Ci=(112&(qi=Fr[si.pos++]))>>4,qi<128||(Ci|=(127&(qi=Fr[si.pos++]))<<3,qi<128)||(Ci|=(127&(qi=Fr[si.pos++]))<<10,qi<128)||(Ci|=(127&(qi=Fr[si.pos++]))<<17,qi<128)||(Ci|=(127&(qi=Fr[si.pos++]))<<24,qi<128)||(Ci|=(1&(qi=Fr[si.pos++]))<<31,qi<128))return w(ri,Ci,Xt);throw new Error("Expected varint not more than 10 bytes")}(tt|=(15&(ut=Tt[this.pos]))<<28,Re,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Re=this.readVarint();return Re%2==1?(Re+1)/-2:Re/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Re=this.readVarint()+this.pos,tt=this.pos;return this.pos=Re,Re-tt>=12&&m?function(ut,Tt,ri){return m.decode(ut.subarray(Tt,ri))}(this.buf,tt,Re):function(ut,Tt,ri){for(var Xt="",si=Tt;si<ri;){var Ci,qi,Fr,gr=ut[si],Rr=null,$r=gr>239?4:gr>223?3:gr>191?2:1;if(si+$r>ri)break;$r===1?gr<128&&(Rr=gr):$r===2?(192&(Ci=ut[si+1]))==128&&(Rr=(31&gr)<<6|63&Ci)<=127&&(Rr=null):$r===3?(qi=ut[si+2],(192&(Ci=ut[si+1]))==128&&(192&qi)==128&&((Rr=(15&gr)<<12|(63&Ci)<<6|63&qi)<=2047||Rr>=55296&&Rr<=57343)&&(Rr=null)):$r===4&&(qi=ut[si+2],Fr=ut[si+3],(192&(Ci=ut[si+1]))==128&&(192&qi)==128&&(192&Fr)==128&&((Rr=(15&gr)<<18|(63&Ci)<<12|(63&qi)<<6|63&Fr)<=65535||Rr>=1114112)&&(Rr=null)),Rr===null?(Rr=65533,$r=1):Rr>65535&&(Rr-=65536,Xt+=String.fromCharCode(Rr>>>10&1023|55296),Rr=56320|1023&Rr),Xt+=String.fromCharCode(Rr),si+=$r}return Xt}(this.buf,tt,Re)},readBytes:function(){var Re=this.readVarint()+this.pos,tt=this.buf.subarray(this.pos,Re);return this.pos=Re,tt},readPackedVarint:function(Re,tt){if(this.type!==r.Bytes)return Re.push(this.readVarint(tt));var ut=x(this);for(Re=Re||[];this.pos<ut;)Re.push(this.readVarint(tt));return Re},readPackedSVarint:function(Re){if(this.type!==r.Bytes)return Re.push(this.readSVarint());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readSVarint());return Re},readPackedBoolean:function(Re){if(this.type!==r.Bytes)return Re.push(this.readBoolean());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readBoolean());return Re},readPackedFloat:function(Re){if(this.type!==r.Bytes)return Re.push(this.readFloat());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readFloat());return Re},readPackedDouble:function(Re){if(this.type!==r.Bytes)return Re.push(this.readDouble());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readDouble());return Re},readPackedFixed32:function(Re){if(this.type!==r.Bytes)return Re.push(this.readFixed32());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readFixed32());return Re},readPackedSFixed32:function(Re){if(this.type!==r.Bytes)return Re.push(this.readSFixed32());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readSFixed32());return Re},readPackedFixed64:function(Re){if(this.type!==r.Bytes)return Re.push(this.readFixed64());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readFixed64());return Re},readPackedSFixed64:function(Re){if(this.type!==r.Bytes)return Re.push(this.readSFixed64());var tt=x(this);for(Re=Re||[];this.pos<tt;)Re.push(this.readSFixed64());return Re},skip:function(Re){var tt=7&Re;if(tt===r.Varint)for(;this.buf[this.pos++]>127;);else if(tt===r.Bytes)this.pos=this.readVarint()+this.pos;else if(tt===r.Fixed32)this.pos+=4;else{if(tt!==r.Fixed64)throw new Error("Unimplemented type: "+tt);this.pos+=8}},writeTag:function(Re,tt){this.writeVarint(Re<<3|tt)},realloc:function(Re){for(var tt=this.length||16;tt<this.pos+Re;)tt*=2;if(tt!==this.length){var ut=new Uint8Array(tt);ut.set(this.buf),this.buf=ut,this.length=tt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Re){this.realloc(4),ot(this.buf,Re,this.pos),this.pos+=4},writeSFixed32:function(Re){this.realloc(4),ot(this.buf,Re,this.pos),this.pos+=4},writeFixed64:function(Re){this.realloc(8),ot(this.buf,-1&Re,this.pos),ot(this.buf,Math.floor(Re*u),this.pos+4),this.pos+=8},writeSFixed64:function(Re){this.realloc(8),ot(this.buf,-1&Re,this.pos),ot(this.buf,Math.floor(Re*u),this.pos+4),this.pos+=8},writeVarint:function(Re){(Re=+Re||0)>268435455||Re<0?function(tt,ut){var Tt,ri;if(tt>=0?(Tt=tt%4294967296|0,ri=tt/4294967296|0):(ri=~(-tt/4294967296),4294967295^(Tt=~(-tt%4294967296))?Tt=Tt+1|0:(Tt=0,ri=ri+1|0)),tt>=18446744073709552e3||tt<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ut.realloc(10),function(Xt,si,Ci){Ci.buf[Ci.pos++]=127&Xt|128,Xt>>>=7,Ci.buf[Ci.pos++]=127&Xt|128,Xt>>>=7,Ci.buf[Ci.pos++]=127&Xt|128,Xt>>>=7,Ci.buf[Ci.pos++]=127&Xt|128,Ci.buf[Ci.pos]=127&(Xt>>>=7)}(Tt,0,ut),function(Xt,si){var Ci=(7&Xt)<<4;si.buf[si.pos++]|=Ci|((Xt>>>=3)?128:0),Xt&&(si.buf[si.pos++]=127&Xt|((Xt>>>=7)?128:0),Xt&&(si.buf[si.pos++]=127&Xt|((Xt>>>=7)?128:0),Xt&&(si.buf[si.pos++]=127&Xt|((Xt>>>=7)?128:0),Xt&&(si.buf[si.pos++]=127&Xt|((Xt>>>=7)?128:0),Xt&&(si.buf[si.pos++]=127&Xt)))))}(ri,ut)}(Re,this):(this.realloc(4),this.buf[this.pos++]=127&Re|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=127&(Re>>>=7)|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=127&(Re>>>=7)|(Re>127?128:0),Re<=127||(this.buf[this.pos++]=Re>>>7&127))))},writeSVarint:function(Re){this.writeVarint(Re<0?2*-Re-1:2*Re)},writeBoolean:function(Re){this.writeVarint(!!Re)},writeString:function(Re){Re=String(Re),this.realloc(4*Re.length),this.pos++;var tt=this.pos;this.pos=function(Tt,ri,Xt){for(var si,Ci,qi=0;qi<ri.length;qi++){if((si=ri.charCodeAt(qi))>55295&&si<57344){if(!Ci){si>56319||qi+1===ri.length?(Tt[Xt++]=239,Tt[Xt++]=191,Tt[Xt++]=189):Ci=si;continue}if(si<56320){Tt[Xt++]=239,Tt[Xt++]=191,Tt[Xt++]=189,Ci=si;continue}si=Ci-55296<<10|si-56320|65536,Ci=null}else Ci&&(Tt[Xt++]=239,Tt[Xt++]=191,Tt[Xt++]=189,Ci=null);si<128?Tt[Xt++]=si:(si<2048?Tt[Xt++]=si>>6|192:(si<65536?Tt[Xt++]=si>>12|224:(Tt[Xt++]=si>>18|240,Tt[Xt++]=si>>12&63|128),Tt[Xt++]=si>>6&63|128),Tt[Xt++]=63&si|128)}return Xt}(this.buf,Re,this.pos);var ut=this.pos-tt;ut>=128&&M(tt,ut,this),this.pos=tt-1,this.writeVarint(ut),this.pos+=ut},writeFloat:function(Re){this.realloc(4),c.write(this.buf,Re,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Re){this.realloc(8),c.write(this.buf,Re,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Re){var tt=Re.length;this.writeVarint(tt),this.realloc(tt);for(var ut=0;ut<tt;ut++)this.buf[this.pos++]=Re[ut]},writeRawMessage:function(Re,tt){this.pos++;var ut=this.pos;Re(tt,this);var Tt=this.pos-ut;Tt>=128&&M(ut,Tt,this),this.pos=ut-1,this.writeVarint(Tt),this.pos+=Tt},writeMessage:function(Re,tt,ut){this.writeTag(Re,r.Bytes),this.writeRawMessage(tt,ut)},writePackedVarint:function(Re,tt){tt.length&&this.writeMessage(Re,N,tt)},writePackedSVarint:function(Re,tt){tt.length&&this.writeMessage(Re,U,tt)},writePackedBoolean:function(Re,tt){tt.length&&this.writeMessage(Re,oe,tt)},writePackedFloat:function(Re,tt){tt.length&&this.writeMessage(Re,K,tt)},writePackedDouble:function(Re,tt){tt.length&&this.writeMessage(Re,ee,tt)},writePackedFixed32:function(Re,tt){tt.length&&this.writeMessage(Re,me,tt)},writePackedSFixed32:function(Re,tt){tt.length&&this.writeMessage(Re,we,tt)},writePackedFixed64:function(Re,tt){tt.length&&this.writeMessage(Re,Le,tt)},writePackedSFixed64:function(Re,tt){tt.length&&this.writeMessage(Re,ze,tt)},writeBytesField:function(Re,tt){this.writeTag(Re,r.Bytes),this.writeBytes(tt)},writeFixed32Field:function(Re,tt){this.writeTag(Re,r.Fixed32),this.writeFixed32(tt)},writeSFixed32Field:function(Re,tt){this.writeTag(Re,r.Fixed32),this.writeSFixed32(tt)},writeFixed64Field:function(Re,tt){this.writeTag(Re,r.Fixed64),this.writeFixed64(tt)},writeSFixed64Field:function(Re,tt){this.writeTag(Re,r.Fixed64),this.writeSFixed64(tt)},writeVarintField:function(Re,tt){this.writeTag(Re,r.Varint),this.writeVarint(tt)},writeSVarintField:function(Re,tt){this.writeTag(Re,r.Varint),this.writeSVarint(tt)},writeStringField:function(Re,tt){this.writeTag(Re,r.Bytes),this.writeString(tt)},writeFloatField:function(Re,tt){this.writeTag(Re,r.Fixed32),this.writeFloat(tt)},writeDoubleField:function(Re,tt){this.writeTag(Re,r.Fixed64),this.writeDouble(tt)},writeBooleanField:function(Re,tt){this.writeVarintField(Re,!!tt)}},Wb}var jb=za($_());const Bx=3;function Bk(c,r,l){r.glyphs=[],c===1&&l.readMessage(mm,r)}function mm(c,r,l){if(c===3){const{id:u,bitmap:m,width:x,height:w,left:M,top:N,advance:U}=l.readMessage(Nv,{});r.glyphs.push({id:u,bitmap:new H({width:x+2*Bx,height:w+2*Bx},m),metrics:{width:x,height:w,left:M,top:N,advance:U}})}else c===4?r.ascender=l.readSVarint():c===5&&(r.descender=l.readSVarint())}function Nv(c,r,l){c===1?r.id=l.readVarint():c===2?r.bitmap=l.readBytes():c===3?r.width=l.readVarint():c===4?r.height=l.readVarint():c===5?r.left=l.readSVarint():c===6?r.top=l.readSVarint():c===7&&(r.advance=l.readVarint())}const Fk=Bx,jc={horizontal:1,vertical:2,horizontalOnly:3};class Fx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,l){const u=new Fx;return u.scale=r||1,u.fontStack=l,u}static forImage(r){const l=new Fx;return l.image=r,l}}class Bv{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l,u){const m=new Bv;for(let x=0;x<r.sections.length;x++){const w=r.sections[x];w.image?m.addImageSection(w,u):m.addTextSection(w,l)}return m}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(l,u){let m="";for(let x=0;x<l.length;x++){const w=l.charCodeAt(x+1)||null,M=l.charCodeAt(x-1)||null;m+=!u&&(w&&vf(w)&&!Nx[l[x+1]]||M&&vf(M)&&!Nx[l[x-1]])||!Nx[l[x]]?l[x]:Nx[l[x]]}return m}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Hb[this.text.charCodeAt(u)];u++)r++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Hb[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const u=new Bv;return u.text=this.text.substring(r,l),u.sectionIndex=this.sectionIndex.slice(r,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Fx.forText(r.scale,r.fontStack||l));const u=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(u)}addImageSection(r,l){const u=r.image?r.image.getPrimary():null;if(!u)return void tn("Can't add FormattedSection with an empty image.");u.scaleSelf(l);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(Fx.forImage(u)),this.sectionIndex.push(this.sections.length-1)):tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Iw(c,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le=1){const ze=Bv.fromFeature(c,m,Le);ee===jc.vertical&&ze.verticalizePunctuation(oe);let qe=[];const ot=function(Tt,ri,Xt,si,Ci,qi){if(!Tt)return[];const Fr=[],gr=function(Ir,Hi,Xi,jr,Gr,Hn){let Mn=0;for(let hn=0;hn<Ir.length();hn++){const Wr=Ir.getSection(hn);Mn+=Lw(Ir.getCodePoint(hn),Wr,jr,Gr,Hi,Hn)}return Mn/Math.max(1,Math.ceil(Mn/Xi))}(Tt,ri,Xt,si,Ci,qi),Rr=Tt.text.indexOf("")>=0;let $r=0;for(let Ir=0;Ir<Tt.length();Ir++){const Hi=Tt.getSection(Ir),Xi=Tt.getCodePoint(Ir);if(Hb[Xi]||($r+=Lw(Xi,Hi,si,Ci,ri,qi)),Ir<Tt.length()-1){const jr=!((Zi=Xi)<11904||!($n["Bopomofo Extended"](Zi)||$n.Bopomofo(Zi)||$n["CJK Compatibility Forms"](Zi)||$n["CJK Compatibility Ideographs"](Zi)||$n["CJK Compatibility"](Zi)||$n["CJK Radicals Supplement"](Zi)||$n["CJK Strokes"](Zi)||$n["CJK Symbols and Punctuation"](Zi)||$n["CJK Unified Ideographs Extension A"](Zi)||$n["CJK Unified Ideographs"](Zi)||$n["Enclosed CJK Letters and Months"](Zi)||$n["Halfwidth and Fullwidth Forms"](Zi)||$n.Hiragana(Zi)||$n["Ideographic Description Characters"](Zi)||$n["Kangxi Radicals"](Zi)||$n["Katakana Phonetic Extensions"](Zi)||$n.Katakana(Zi)||$n["Vertical Forms"](Zi)||$n["Yi Radicals"](Zi)||$n["Yi Syllables"](Zi)));(Cy[Xi]||jr||Hi.image)&&Fr.push(V_(Ir+1,$r,gr,Fr,$T(Xi,Tt.getCodePoint(Ir+1),jr&&Rr),!1))}}var Zi;return Pw(V_(Tt.length(),$r,gr,Fr,0,!0))}(ze,U,x,r,u,me),{processBidirectionalText:ct,processStyledBidirectionalText:Re}=jd;if(ct&&ze.sections.length===1){const Tt=ct(ze.toString(),ot);for(const ri of Tt){const Xt=new Bv;Xt.text=ri,Xt.sections=ze.sections;for(let si=0;si<ri.length;si++)Xt.sectionIndex.push(0);qe.push(Xt)}}else if(Re){const Tt=Re(ze.text,ze.sectionIndex,ot);for(const ri of Tt){const Xt=new Bv;Xt.text=ri[0],Xt.sectionIndex=ri[1],Xt.sections=ze.sections,qe.push(Xt)}}else qe=function(Tt,ri){const Xt=[],si=Tt.text;let Ci=0;for(const qi of ri)Xt.push(Tt.substring(Ci,qi)),Ci=qi;return Ci<si.length&&Xt.push(Tt.substring(Ci,si.length)),Xt}(ze,ot);const tt=[],ut={positionedLines:tt,text:ze.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:ee,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Tt,ri,Xt,si,Ci,qi,Fr,gr,Rr,$r,Zi,Ir){let Hi=0,Xi=0,jr=0;const Gr=gr==="right"?1:gr==="left"?0:.5;let Hn=!1;for(const Dn of Ci){const ss=Dn.getSections();for(const $s of ss){if($s.image)continue;const Rs=ri[$s.fontStack];if(Rs&&(Hn=Rs.ascender!==void 0&&Rs.descender!==void 0,!Hn))break}if(!Hn)break}let Mn=0;for(const Dn of Ci){Dn.trim();const ss=Dn.getMaxScale(),$s=(ss-1)*qh,Rs={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[Mn]=Rs;const no=Rs.positionedGlyphs;let js=0;if(!Dn.length()){Xi+=qi,++Mn;continue}let so=0,Pa=0;for(let yt=0;yt<Dn.length();yt++){const Mt=Dn.getSection(yt),ir=Dn.getSectionIndex(yt),Zr=Dn.getCodePoint(yt);let un=Mt.scale,an=null,Sn=null,rs=null,go=qh,yo=0;Rr===jc.vertical&&((hn=Zr)===12312||hn===12313||hn===12316||hn===12540||hn===12448)&&(Rr=jc.horizontal);const Hs=!(Rr===jc.horizontal||!Zi&&!Kf(Zr)||Zi&&(Hb[Zr]||Mu(Zr)));if(Mt.image){const Fa=si.get(Mt.image.toString());if(!Fa)continue;rs=Mt.image,Tt.iconsInText=Tt.iconsInText||!0,Sn=Fa.paddedRect;const ll=Fa.displaySize;un=un*qh/Ir,an={width:ll[0],height:ll[1],left:0,top:-3,advance:Hs?ll[1]:ll[0],localGlyph:!1},yo=Hn?-an.height*un:ss*qh-17-ll[1]*un,go=an.advance;const _o=(Hs?ll[0]:ll[1])*un-qh*ss;_o>0&&_o>js&&(js=_o)}else{const Fa=Xt[Mt.fontStack];if(!Fa)continue;Fa[Zr]&&(Sn=Fa[Zr]);const ll=ri[Mt.fontStack];if(!ll)continue;const _o=ll.glyphs[Zr];if(!_o)continue;if(an=_o.metrics,go=Zr!==8203?qh:0,Hn){const oc=ll.ascender!==void 0?Math.abs(ll.ascender):0,vl=ll.descender!==void 0?Math.abs(ll.descender):0,Oa=(oc+vl)*un;so<Oa&&(so=Oa,Pa=(oc-vl)/2*un),yo=-oc*un}else yo=(ss-un)*qh-17}Hs?(Tt.verticalizable=!0,no.push({glyph:Zr,image:rs,x:Hi,y:Xi+yo,vertical:Hs,scale:un,localGlyph:an.localGlyph,fontStack:Mt.fontStack,sectionIndex:ir,metrics:an,rect:Sn}),Hi+=go*un+$r):(no.push({glyph:Zr,image:rs,x:Hi,y:Xi+yo,vertical:Hs,scale:un,localGlyph:an.localGlyph,fontStack:Mt.fontStack,sectionIndex:ir,metrics:an,rect:Sn}),Hi+=an.advance*un+$r)}no.length!==0&&(jr=Math.max(Hi-$r,jr),Hn?VT(no,Gr,js,Pa,qi*ss/2):VT(no,Gr,js,0,qi/2)),Hi=0;const _l=qi*ss+js;Rs.lineOffset=Math.max(js,$s),Xi+=_l,++Mn}var hn;const Wr=Xi,{horizontalAlign:Ss,verticalAlign:En}=Ow(Fr);(function(Dn,ss,$s,Rs,no,js){const so=(ss-$s)*no,Pa=-js*Rs;for(const _l of Dn)for(const yt of _l.positionedGlyphs)yt.x+=so,yt.y+=Pa})(Tt.positionedLines,Gr,Ss,En,jr,Wr),Tt.top+=-En*Wr,Tt.bottom=Tt.top+Wr,Tt.left+=-Ss*jr,Tt.right=Tt.left+jr,Tt.hasBaseline=Hn}(ut,r,l,u,qe,w,M,N,ee,U,oe,we),!function(Tt){for(const ri of Tt)if(ri.positionedGlyphs.length!==0)return!1;return!0}(tt))return ut}const Hb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lw(c,r,l,u,m,x){if(r.image){const w=u.get(r.image.toString());return w?w.displaySize[0]*r.scale*qh/x+m:0}{const w=l[r.fontStack],M=w&&w.glyphs[c];return M?M.metrics.advance*r.scale+m:0}}function Dw(c,r,l,u){const m=Math.pow(c-r,2);return u?c<r?m/2:2*m:m+Math.abs(l)*l}function $T(c,r,l){let u=0;return c===10&&(u-=1e4),l&&(u+=150),c!==40&&c!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function V_(c,r,l,u,m,x){let w=null,M=Dw(r,l,m,x);for(const N of u){const U=Dw(r-N.x,l,m,x)+N.badness;U<=M&&(w=N,M=U)}return{index:c,x:r,priorBreak:w,badness:M}}function Pw(c){return c?Pw(c.priorBreak).concat(c.index):[]}function Ow(c){let r=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function VT(c,r,l,u,m){if(!(r||l||u||m))return;const x=c.length-1,w=c[x],M=(w.x+w.metrics.advance*w.scale)*r;for(let N=0;N<=x;N++)c[N].x-=M,c[N].y+=l+u+m}function Rw(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function WT(c,r,l,u){const{horizontalAlign:m,verticalAlign:x}=Ow(u),w=l[0]-c.displaySize[0]*m,M=l[1]-c.displaySize[1]*x;return{imagePrimary:c,imageSecondary:r,top:M,bottom:M+c.displaySize[1],left:w,right:w+c.displaySize[0]}}function jT(c,r,l,u,m,x){const w=c.imagePrimary;let M;if(w.content){const ze=w.content,qe=w.pixelRatio||1;M=[ze[0]/qe,ze[1]/qe,w.displaySize[0]-ze[2]/qe,w.displaySize[1]-ze[3]/qe]}const N=r.left*x,U=r.right*x;let K,ee,oe,me;l==="width"||l==="both"?(me=m[0]+N-u[3],ee=m[0]+U+u[1]):(me=m[0]+(N+U-w.displaySize[0])/2,ee=me+w.displaySize[0]);const we=r.top*x,Le=r.bottom*x;return l==="height"||l==="both"?(K=m[1]+we-u[0],oe=m[1]+Le+u[2]):(K=m[1]+(we+Le-w.displaySize[1])/2,oe=K+w.displaySize[1]),{imagePrimary:w,imageSecondary:void 0,top:K,right:ee,bottom:oe,left:me,collisionPadding:M}}function HT(c){return!c.imagePrimary.stretchX}function GT(c){return!c.imagePrimary.stretchY}function qT(c){return{width:c.right-c.left,height:c.bottom-c.top}}const $g=128;function Gb(c,r,l){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new sa(c+1,{worldview:l}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:x}=u;let w=0;for(;w<m.length&&m[w]<=c;)w++;w=Math.max(0,w-1);let M=w;for(;M<m.length&&m[M]<c+1;)M++;M=Math.min(m.length-1,M);const N=m[w],U=m[M];return u.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:U,interpolationType:x}:{kind:"camera",minZoom:N,maxZoom:U,minSize:u.evaluate(new sa(N,{worldview:l})),maxSize:u.evaluate(new sa(U,{worldview:l})),interpolationType:x}}}function W_(c,{uSize:r,uSizeT:l},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/$g:c.kind==="composite"?kn(u/$g,m/$g,l):r}function Fv(c,r,l=1){let u=0,m=0;if(c.kind==="constant")m=c.layoutSize*l;else if(c.kind!=="source"){const{interpolationType:x,minZoom:w,maxZoom:M}=c,N=x?ft(Oc.interpolationFactor(x,r,w,M),0,1):0;c.kind==="camera"?m=kn(c.minSize,c.maxSize,N)*l:u=N*l}return{uSizeT:u,uSize:m}}class h0 extends fr{constructor(r,l,u,m,x){super(r,l),this.angle=m,this.z=u,x!==void 0&&(this.segment=x)}clone(){return new h0(this.x,this.y,this.z,this.angle,this.segment)}}function eg(c,r,l,u,m){if(r.segment===void 0)return!0;let x=r,w=r.segment+1,M=0;for(;M>-l/2;){if(w--,w<0)return!1;M-=c[w].dist(x),x=c[w]}M+=c[w].dist(c[w+1]),w++;const N=[];let U=0;for(;M<l/2;){const K=c[w],ee=c[w+1];if(!ee)return!1;let oe=c[w-1].angleTo(K)-K.angleTo(ee);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:M,angleDelta:oe}),U+=oe;M-N[0].distance>u;)U-=N.shift().angleDelta;if(U>m)return!1;w++,M+=K.dist(ee)}return!0}function qb(c){let r=0;for(let l=0;l<c.length-1;l++)r+=c[l].dist(c[l+1]);return r}function YT(c,r,l){return c?.6*r*l:0}function XT(c,r){return Math.max(c?c.right-c.left:0,r?r.right-r.left:0)}function zk(c,r,l,u,m,x){const w=YT(l,m,x),M=XT(l,u)*x;let N=0;const U=qb(c)/2;for(let K=0;K<c.length-1;K++){const ee=c[K],oe=c[K+1],me=ee.dist(oe);if(N+me>U){const we=(U-N)/me,Le=kn(ee.x,oe.x,we),ze=kn(ee.y,oe.y,we),qe=new h0(Le,ze,0,oe.angleTo(ee),K);return!w||eg(c,qe,M,w,r)?qe:void 0}N+=me}}function Uk(c,r,l,u,m,x,w,M,N){const U=YT(u,x,w),K=XT(u,m),ee=K*w,oe=c[0].x===0||c[0].x===N||c[0].y===0||c[0].y===N;return r-ee<r/4&&(r=ee+r/4),Nw(c,oe?r/2*M%r:(K/2+2*x)*w*M%r,r,U,l,ee,oe,!1,N)}function Nw(c,r,l,u,m,x,w,M,N){const U=x/2,K=qb(c);let ee=0,oe=r-l,me=[];for(let we=0;we<c.length-1;we++){const Le=c[we],ze=c[we+1],qe=Le.dist(ze),ot=ze.angleTo(Le);for(;oe+l<ee+qe;){oe+=l;const ct=(oe-ee)/qe,Re=kn(Le.x,ze.x,ct),tt=kn(Le.y,ze.y,ct);if(Re>=0&&Re<N&&tt>=0&&tt<N&&oe-U>=0&&oe+U<=K){const ut=new h0(Re,tt,0,ot,we);u&&!eg(c,ut,x,u,m)||me.push(ut)}}ee+=qe}return M||me.length||w||(me=Nw(c,ee/2,l,u,m,x,w,!0,N)),me}function ZT(c){let r=0,l=0;for(const w of c)r+=w.w*w.h,l=Math.max(l,w.w);c.sort((w,M)=>M.h-w.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let m=0,x=0;for(const w of c)for(let M=u.length-1;M>=0;M--){const N=u[M];if(!(w.w>N.w||w.h>N.h)){if(w.x=N.x,w.y=N.y,x=Math.max(x,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===N.w&&w.h===N.h){const U=u.pop();M<u.length&&(u[M]=U)}else w.h===N.h?(N.x+=w.w,N.w-=w.w):w.w===N.w?(N.y+=w.h,N.h-=w.h):(u.push({x:N.x+w.w,y:N.y,w:N.w-w.w,h:w.h}),N.y+=w.h,N.h-=w.h);break}}return{w:m,h:x,fill:r/(m*x)||0}}mn(h0,"Anchor");const j_=1;class zv{static getImagePositionScale(r,l,u){if(l&&r&&r.options&&r.options.transform){const m=r.options.transform;return{x:m.a,y:m.d}}return{x:u,y:u}}constructor(r,l,u,m){this.paddedRect=r;const{pixelRatio:x,version:w,stretchX:M,stretchY:N,content:U,sdf:K,usvg:ee}=l;this.pixelRatio=x,this.stretchX=M,this.stretchY=N,this.content=U,this.version=w,this.padding=u,this.sdf=K,this.usvg=ee,this.scale=zv.getImagePositionScale(m,ee,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Bw(c,r,l){const u=bi.parse(c),m=function(x,w,M=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*M[0])+2*w,h:(x.data?x.data.height:x.height*M[1])+2*w}}(r,l,[u.options.transform.a,u.options.transform.d]);return{bin:m,imagePosition:new zv(m,r,l,u),imageVariant:u}}class Fw{constructor(r,l,u){const m=new Map,x=new Map;this.haveRenderCallbacks=[];const w=[];this.addImages(r,m,j_,w),this.addImages(l,x,2,w);const{w:M,h:N}=ZT(w),U=new Y({width:M||1,height:N||1});for(const[K,ee]of r.entries()){const oe=m.get(K).paddedRect;Y.copy(ee.data,U,{x:0,y:0},{x:oe.x+j_,y:oe.y+j_},ee.data,u,ee.sdf)}for(const[K,ee]of l.entries()){const oe=x.get(K),me=oe.paddedRect;let we=oe.padding;const Le=me.x+we,ze=me.y+we,qe=ee.data.width,ot=ee.data.height;we=we>1?we-1:we,Y.copy(ee.data,U,{x:0,y:0},{x:Le,y:ze},ee.data,u),Y.copy(ee.data,U,{x:0,y:ot-we},{x:Le,y:ze-we},{width:qe,height:we},u),Y.copy(ee.data,U,{x:0,y:0},{x:Le,y:ze+ot},{width:qe,height:we},u),Y.copy(ee.data,U,{x:qe-we,y:0},{x:Le-we,y:ze},{width:we,height:ot},u),Y.copy(ee.data,U,{x:0,y:0},{x:Le+qe,y:ze},{width:we,height:ot},u),Y.copy(ee.data,U,{x:qe-we,y:ot-we},{x:Le-we,y:ze-we},{width:we,height:we},u),Y.copy(ee.data,U,{x:0,y:ot-we},{x:Le+qe,y:ze-we},{width:we,height:we},u),Y.copy(ee.data,U,{x:0,y:0},{x:Le+qe,y:ze+ot},{width:we,height:we},u),Y.copy(ee.data,U,{x:qe-we,y:0},{x:Le-we,y:ze+ot},{width:we,height:we},u)}this.lut=u,this.image=U,this.iconPositions=m,this.patternPositions=x}addImages(r,l,u,m){for(const[x,w]of r.entries()){const{bin:M,imagePosition:N,imageVariant:U}=Bw(x,w,u);l.set(x,N),m.push(M),w.hasRenderCallback&&this.haveRenderCallbacks.push(U.id)}}patchUpdatedImages(r,l,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>r.hasImage(m,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m of r.getUpdatedImages(u)){for(const x of this.iconPositions.keys()){const w=bi.parse(x);if(Xc.isEqual(w.id,m)){const M=r.getImage(m,u);this.patchUpdatedImage(this.iconPositions.get(x),M,l)}}for(const x of this.patternPositions.keys()){const w=bi.parse(x);if(Xc.isEqual(w.id,m)){const M=r.getImage(m,u);this.patchUpdatedImage(this.patternPositions.get(x),M,l)}}}}patchUpdatedImage(r,l,u){if(!r||!l||r.version===l.version)return;r.version=l.version;const[m,x]=r.tl,w=r.sdf;if(this.lut||w){const M={width:l.data.width,height:l.data.height},N=new Y(M);Y.copy(l.data,N,{x:0,y:0},{x:0,y:0},M,this.lut,w),u.update(N,{position:{x:m,y:x}})}else u.update(l.data,{position:{x:m,y:x}})}}mn(zv,"ImagePosition"),mn(Fw,"ImageAtlas");const Yb=1e20;function KT(c,r,l,u,m,x,w,M,N){for(let U=r;U<r+u;U++)QT(c,l*x+U,x,m,w,M,N);for(let U=l;U<l+m;U++)QT(c,U*x+r,1,u,w,M,N)}function QT(c,r,l,u,m,x,w){x[0]=0,w[0]=-1e20,w[1]=Yb,m[0]=c[r];for(let M=1,N=0,U=0;M<u;M++){m[M]=c[r+M*l];const K=M*M;do{const ee=x[N];U=(m[M]-m[ee]+K-ee*ee)/(M-ee)/2}while(U<=w[N]&&--N>-1);N++,x[N]=M,w[N]=U,w[N+1]=Yb}for(let M=0,N=0;M<u;M++){for(;w[N+1]<M;)N++;const U=x[N],K=M-U;c[r+M*l]=m[U]+K*K}}const Vg=2,zw={none:0,ideographs:1,all:2};class Uv{constructor(r,l,u){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r,l){this.urls[l]=r}getGlyphs(r,l,u){const m=[],x=this.urls[l]||vs.GLYPHS_URL;for(const w in r)for(const M of r[w])m.push({stack:w,id:M});ti(m,({stack:w,id:M},N)=>{let U=this.entries[w];U||(U=this.entries[w]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let K=U.glyphs[M];if(K!==void 0)return void N(null,{stack:w,id:M,glyph:K});if(K=this._tinySDF(U,w,M),K)return U.glyphs[M]=K,void N(null,{stack:w,id:M,glyph:K});const ee=Math.floor(M/256);if(256*ee>65535)return tn("glyphs > 65535 not supported"),void N(null,{stack:w,id:M,glyph:K});if(U.ranges[ee])return void N(null,{stack:w,id:M,glyph:K});let oe=U.requests[ee];oe||(oe=U.requests[ee]=[],Uv.loadGlyphRange(w,ee,x,this.requestManager,(me,we)=>{if(we){U.ascender=we.ascender,U.descender=we.descender;for(const Le in we.glyphs)this._doesCharSupportLocalGlyph(+Le)||(U.glyphs[+Le]=we.glyphs[+Le]);U.ranges[ee]=!0}for(const Le of oe)Le(me,we);delete U.requests[ee]})),oe.push((me,we)=>{me?N(me):we&&N(null,{stack:w,id:M,glyph:we.glyphs[M]||null})})},(w,M)=>{if(w)u(w);else if(M){const N={};for(const{stack:U,id:K,glyph:ee}of M)N[U]===void 0&&(N[U]={}),N[U].glyphs===void 0&&(N[U].glyphs={}),N[U].glyphs[K]=ee&&{id:ee.id,bitmap:ee.bitmap.clone(),metrics:ee.metrics},N[U].ascender=this.entries[U].ascender,N[U].descender=this.entries[U].descender;u(null,N)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==zw.none&&(this.localGlyphMode===zw.all?!!this.localFontFamily:!!this.localFontFamily&&($n["CJK Unified Ideographs"](r)||$n["Hangul Syllables"](r)||$n.Hiragana(r)||$n.Katakana(r)||$n["CJK Symbols and Punctuation"](r)||$n["CJK Unified Ideographs Extension A"](r)||$n["CJK Unified Ideographs Extension B"](r)||$n.Osage(r)))}_tinySDF(r,l,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let x=r.tinySDF;if(!x){let Le="400";/bold/i.test(l)?Le="900":/medium/i.test(l)?Le="500":/light/i.test(l)&&(Le="200"),x=r.tinySDF=new Uv.TinySDF({fontFamily:m,fontWeight:Le,fontSize:24*Vg,buffer:3*Vg,radius:8*Vg}),x.fontWeight=Le}if(this.localGlyphs[x.fontWeight][u])return this.localGlyphs[x.fontWeight][u];const w=String.fromCodePoint(u),{data:M,width:N,height:U,glyphWidth:K,glyphHeight:ee,glyphLeft:oe,glyphTop:me,glyphAdvance:we}=x.draw(w);return this.localGlyphs[x.fontWeight][u]={id:u,bitmap:new H({width:N,height:U},M),metrics:{width:K/Vg,height:ee/Vg,left:oe/Vg,top:me/Vg-27,advance:we/Vg,localGlyph:!0}}}}Uv.loadGlyphRange=function(c,r,l,u,m){const x=256*r,w=x+255,M=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",c).replace("{range}",`${x}-${w}`),Th.Glyphs);Qh(M,(N,U)=>{if(N)m(N);else if(U){const K={},ee=function(oe){return new jb(oe).readFields(Bk,{})}(U);for(const oe of ee.glyphs)K[oe.id]=oe;m(null,{glyphs:K,ascender:ee.ascender,descender:ee.descender})}})},Uv.TinySDF=class{constructor({fontSize:c=24,buffer:r=3,radius:l=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:x="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=l;const M=this.size=c+4*r,N=this._createCanvas(M),U=this.ctx=N.getContext("2d",{willReadFrequently:!0});U.font=`${w} ${x} ${c}px ${m}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(c){const r=document.createElement("canvas");return r.width=r.height=c,r}draw(c){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:x}=this.ctx.measureText(c),w=Math.ceil(l),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-m))),N=Math.min(this.size-this.buffer,w+Math.ceil(u)),U=M+2*this.buffer,K=N+2*this.buffer,ee=Math.max(U*K,0),oe=new Uint8ClampedArray(ee),me={data:oe,width:U,height:K,glyphWidth:M,glyphHeight:N,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(M===0||N===0)return me;const{ctx:we,buffer:Le,gridInner:ze,gridOuter:qe}=this;we.clearRect(Le,Le,M,N),we.fillText(c,Le,Le+w);const ot=we.getImageData(Le,Le,M,N);qe.fill(Yb,0,ee),ze.fill(0,0,ee);for(let ct=0;ct<N;ct++)for(let Re=0;Re<M;Re++){const tt=ot.data[4*(ct*M+Re)+3]/255;if(tt===0)continue;const ut=(ct+Le)*U+Re+Le;if(tt===1)qe[ut]=0,ze[ut]=Yb;else{const Tt=.5-tt;qe[ut]=Tt>0?Tt*Tt:0,ze[ut]=Tt<0?Tt*Tt:0}}KT(qe,0,0,U,K,U,this.f,this.v,this.z),KT(ze,Le,Le,M,N,U,this.f,this.v,this.z);for(let ct=0;ct<ee;ct++){const Re=Math.sqrt(qe[ct])-Math.sqrt(ze[ct]);oe[ct]=Math.round(255-255*(Re/this.radius+this.cutoff))}return me}};const H_=j_;function JT(c,r){return c+r[1]-r[0]}function eC(c,r,l,u,m=1){const x=[],w=c.imagePrimary,M=w.pixelRatio,N=w.paddedRect.w-2*H_,U=w.paddedRect.h-2*H_,K=(c.right-c.left)*m,ee=(c.bottom-c.top)*m,oe=w.stretchX||[[0,N]],me=w.stretchY||[[0,U]],we=oe.reduce(JT,0),Le=me.reduce(JT,0),ze=N-we,qe=U-Le;let ot=0,ct=we,Re=0,tt=Le,ut=0,Tt=ze,ri=0,Xt=qe;if(w.content&&u){const Ci=w.content;ot=Xb(oe,0,Ci[0]),Re=Xb(me,0,Ci[1]),ct=Xb(oe,Ci[0],Ci[2]),tt=Xb(me,Ci[1],Ci[3]),ut=Ci[0]-ot,ri=Ci[1]-Re,Tt=Ci[2]-Ci[0]-ct,Xt=Ci[3]-Ci[1]-tt}const si=(Ci,qi,Fr,gr)=>{const Rr=Zb(Ci.stretch-ot,ct,K,c.left*m),$r=zx(Ci.fixed-ut,Tt,Ci.stretch,we),Zi=Zb(qi.stretch-Re,tt,ee,c.top*m),Ir=zx(qi.fixed-ri,Xt,qi.stretch,Le),Hi=Zb(Fr.stretch-ot,ct,K,c.left*m),Xi=zx(Fr.fixed-ut,Tt,Fr.stretch,we),jr=Zb(gr.stretch-Re,tt,ee,c.top*m),Gr=zx(gr.fixed-ri,Xt,gr.stretch,Le),Hn=new fr(Rr,Zi),Mn=new fr(Hi,Zi),hn=new fr(Hi,jr),Wr=new fr(Rr,jr),Ss=new fr($r/M,Ir/M),En=new fr(Xi/M,Gr/M),Dn=r*Math.PI/180;if(Dn){const so=Math.sin(Dn),Pa=Math.cos(Dn),_l=[Pa,-so,so,Pa];Hn._matMult(_l),Mn._matMult(_l),Wr._matMult(_l),hn._matMult(_l)}const ss=Ci.stretch+Ci.fixed,$s=Fr.stretch+Fr.fixed,Rs=qi.stretch+qi.fixed,no=gr.stretch+gr.fixed,js=c.imageSecondary;return{tl:Hn,tr:Mn,bl:Wr,br:hn,texPrimary:{x:w.paddedRect.x+H_+ss,y:w.paddedRect.y+H_+Rs,w:$s-ss,h:no-Rs},texSecondary:js?{x:js.paddedRect.x+H_+ss,y:js.paddedRect.y+H_+Rs,w:$s-ss,h:no-Rs}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ss,pixelOffsetBR:En,minFontScaleX:Tt/M/K,minFontScaleY:Xt/M/ee,isSDF:l}};if(u&&(w.stretchX||w.stretchY)){const Ci=Uw(oe,ze,we),qi=Uw(me,qe,Le);for(let Fr=0;Fr<Ci.length-1;Fr++){const gr=Ci[Fr],Rr=Ci[Fr+1];for(let $r=0;$r<qi.length-1;$r++)x.push(si(gr,qi[$r],Rr,qi[$r+1]))}}else x.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:U+1}));return x}function Xb(c,r,l){let u=0;for(const m of c)u+=Math.max(r,Math.min(l,m[1]))-Math.max(r,Math.min(l,m[0]));return u}function Uw(c,r,l){const u=[{fixed:-1,stretch:0}];for(const[m,x]of c){const w=u[u.length-1];u.push({fixed:m-w.stretch,stretch:w.stretch}),u.push({fixed:m-w.stretch,stretch:w.stretch+(x-m)})}return u.push({fixed:r+H_,stretch:l}),u}function Zb(c,r,l,u){return c/r*l+u}function zx(c,r,l,u){return c-r*l/u}function tC(c,r,l,u){const m=r+c.positionedLines[u].lineOffset;return u===0?l+m/2:l+(m+(r+c.positionedLines[u-1].lineOffset))/2}function $k(c,r=1,l=!1){let u=1/0,m=1/0,x=-1/0,w=-1/0;const M=c[0];for(let me=0;me<M.length;me++){const we=M[me];(!me||we.x<u)&&(u=we.x),(!me||we.y<m)&&(m=we.y),(!me||we.x>x)&&(x=we.x),(!me||we.y>w)&&(w=we.y)}const N=Math.min(x-u,w-m);let U=N/2;const K=new rl([],Vk);if(N===0)return new fr(u,m);for(let me=u;me<x;me+=N)for(let we=m;we<w;we+=N)K.push(new $v(me+U,we+U,U,c));let ee=function(me){let we=0,Le=0,ze=0;const qe=me[0];for(let ot=0,ct=qe.length,Re=ct-1;ot<ct;Re=ot++){const tt=qe[ot],ut=qe[Re],Tt=tt.x*ut.y-ut.x*tt.y;Le+=(tt.x+ut.x)*Tt,ze+=(tt.y+ut.y)*Tt,we+=3*Tt}return new $v(Le/we,ze/we,0,me)}(c),oe=K.length;for(;K.length;){const me=K.pop();(me.d>ee.d||!ee.d)&&(ee=me,l&&console.log("found best %d after %d probes",Math.round(1e4*me.d)/1e4,oe)),me.max-ee.d<=r||(U=me.h/2,K.push(new $v(me.p.x-U,me.p.y-U,U,c)),K.push(new $v(me.p.x+U,me.p.y-U,U,c)),K.push(new $v(me.p.x-U,me.p.y+U,U,c)),K.push(new $v(me.p.x+U,me.p.y+U,U,c)),oe+=4)}return l&&(console.log(`num probes: ${oe}`),console.log(`best distance: ${ee.d}`)),ee.p}function Vk(c,r){return r.max-c.max}class $v{constructor(r,l,u,m){this.p=new fr(r,l),this.h=u,this.d=function(x,w){let M=!1,N=1/0;for(let U=0;U<w.length;U++){const K=w[U];for(let ee=0,oe=K.length,me=oe-1;ee<oe;me=ee++){const we=K[ee],Le=K[me];we.y>x.y!=Le.y>x.y&&x.x<(Le.x-we.x)*(x.y-we.y)/(Le.y-we.y)+we.x&&(M=!M),N=Math.min(N,dy(x,we,Le))}}return(M?1:-1)*Math.sqrt(N)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const Wk=Object.keys,Kb=Number.POSITIVE_INFINITY,iC=Math.sqrt(2);function rC(c,[r,l]){let u=0,m=0;if(l===Kb){r<0&&(r=0);const x=r/iC;switch(c){case"top-right":case"top-left":m=x-7;break;case"bottom-right":case"bottom-left":m=7-x;break;case"bottom":m=7-r;break;case"top":m=r-7}switch(c){case"top-right":case"bottom-right":u=-x;break;case"top-left":case"bottom-left":u=x;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),c){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(c){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,m]}function Qb(c,r,l,u,m,x,w,M,N){if(!r||!r.usvg)return;const U=qT(u),K=qT(m),ee=x!=="both"&&x!=="width"||!HT(u)?1:K.width/U.width,oe=x!=="both"&&x!=="height"||!GT(u)?1:K.height/U.height;l.scaleSelf(ee,oe);const me=l.toString();w.set(me,l),M.set(me,r);const{imagePosition:we}=Bw(me,r,j_);N.set(me,we)}function nC(c,r,l,u,m,x,w,M,N){if(!c)return;const U=function(K,ee,oe,me,we,Le){if(K.kind==="camera")return K.maxSize;if(K.kind==="composite"){const ze=ee.possiblyEvaluate(new sa(K.maxZoom,{worldview:Le}),oe).evaluate(we,{},oe),qe=ee.possiblyEvaluate(new sa(K.minZoom,{worldview:Le}),oe).evaluate(we,{},oe);return Math.max(ze,qe)}return ee.possiblyEvaluate(new sa(me,{worldview:Le})).evaluate(we,{},oe)}(r,l,u,m,x,N);return c.scaleSelf(U*M*w)}function sC(c,r,l,u,m,x,w,M,N){return{iconPrimary:nC(c.getPrimary(),r,l,u,m,x,w,M,N),iconSecondary:nC(c.getSecondary(),r,l,u,m,x,w,M,N)}}function jk(c,r,l){if(!r)return;const u=l.get(c.toString()),m=l.get(r.toString());m&&(u.paddedRect.w===m.paddedRect.w&&u.paddedRect.h===m.paddedRect.h||tn(`Mismatch in icon variant sizes: ${c.toString()} and ${r.toString()}`),u.usvg!==m.usvg&&tn(`Mismatch in icon variant image types: ${c.id} and ${r.id}`))}function $w(c,r,l,u){if(!c)return;const m=r.get(l.toString());if(c.imagePrimary=m,u){const x=r.get(u.toString());c.imageSecondary=x}}function ie(c,r){for(const l in c.horizontal)p(c.horizontal[l],r);p(c.vertical,r)}function p(c,r){if(c){for(const l of c.positionedLines)for(const u of l.positionedGlyphs)if(u.image!==null){const m=u.image.toString();u.rect=r.get(m).paddedRect}}}function b(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function T(c,r,l,u,m,x,w,M,N){const U=X(x.horizontal)||x.vertical,K=l.get("icon-text-fit-padding").evaluate(u,{},m);let ee,oe=r;return r&&N!=="none"&&(c.allowVerticalPlacement&&x.vertical&&(ee=jT(r,x.vertical,N,K,M,w)),U&&(oe=jT(r,U,N,K,M,w))),{defaultShapedIcon:oe,verticallyShapedIcon:ee}}function P(c,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe,ot,ct){let Re=w.textMaxSize.evaluate(r,{},oe);Re===void 0?Re=M*w.textScaleFactor:Re*=w.textScaleFactor;const tt=c.layers[0].layout,ut=X(l.horizontal)||l.vertical,Tt=me.name==="globe",ri=qh,Xt=c.tilePixelRatio*Re/ri,si=($r=c.overscaling,c.zoom>18&&$r>2&&($r>>=1),Math.max(mr/(512*$r),1)*tt.get("symbol-spacing")),Ci=tt.get("text-padding")*c.tilePixelRatio,qi=tt.get("icon-padding")*c.tilePixelRatio,Fr=Un(tt.get("text-max-angle")),gr=tt.get("icon-rotation-alignment")==="map"&&ct!=="point",Rr=si/2;var $r;c.hasAnyIconTextFit===!1&&ze!=="none"&&(c.hasAnyIconTextFit=!0);const Zi=r.properties?+r.properties[Ts]:null,Ir=Zi&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(Zi):65535,Hi=(Xi,jr,Gr)=>{if(jr.x<0||jr.x>=mr||jr.y<0||jr.y>=mr)return;let Hn=null;if(Tt){const{x:Mn,y:hn,z:Wr}=me.projectTilePoint(jr.x,jr.y,Gr);Hn={anchor:new h0(Mn,hn,Wr,0,void 0),up:me.upVector(Gr,jr.x,jr.y)}}(function(Mn,hn,Wr,Ss,En,Dn,ss,$s,Rs,no,js,so,Pa,_l,yt,Mt,ir,Zr,un,an,Sn,rs,go,yo,Hs,Fa,ll,_o,oc){const vl=Mn.addToLineVertexArray(hn,Ss);let Oa,Mc,kl,cl,xl,Wa,Js,Ga=0,ac=0,ts=0,Qo=0,Al=-1,xc=-1;const Bl={};let Dh=fu("");const Za=Wr?Wr.anchor:hn,vh=_o!=="none";let Mf=0,Rd=0;if(Rs._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ph=Rs.layout.get("text-offset").evaluate(Sn,{},Hs);Mf=Ph[0]*qh,Rd=Ph[1]*qh}else Mf=Rs.layout.get("text-radial-offset").evaluate(Sn,{},Hs)*qh,Rd=Kb;if(Mn.allowVerticalPlacement&&En.vertical){const Ph=En.vertical;if(yt)Wa=de(Ph),$s&&(Js=de($s));else{const lu=Rs.layout.get("text-rotate").evaluate(Sn,{},Hs)+90;kl=re(no,Za,hn,js,so,Pa,Ph,_l,lu,Mt),$s&&(cl=re(no,Za,hn,js,so,Pa,$s,Zr,lu))}}if(Dn){const Ph=Mn.iconSizeData,lu=Rs.layout.get("icon-rotate").evaluate(Sn,{},Hs),Nd=eC(Dn,lu,go,vh,rs.iconScaleFactor),Cp=$s?eC($s,lu,go,vh,rs.iconScaleFactor):void 0;Mc=re(no,Za,hn,js,so,Pa,Dn,Zr,lu,null),Ga=4*Nd.length;let op=null;Ph.kind==="source"?(op=[$g*Rs.layout.get("icon-size").evaluate(Sn,{},Hs)*rs.iconScaleFactor],op[0]>z&&tn(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${O}. Reduce your "icon-size".`)):Ph.kind==="composite"&&(op=[$g*rs.compositeIconSizes[0].evaluate(Sn,{},Hs)*rs.iconScaleFactor,$g*rs.compositeIconSizes[1].evaluate(Sn,{},Hs)*rs.iconScaleFactor],(op[0]>z||op[1]>z)&&tn(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${O}. Reduce your "icon-size".`)),Mn.addSymbols(Mn.icon,Nd,op,an,un,Sn,void 0,Wr,hn,vl.lineStartIndex,vl.lineLength,-1,yo,Hs,Fa,ll),Al=Mn.icon.placedSymbolArray.length-1,Cp&&(ac=4*Cp.length,Mn.addSymbols(Mn.icon,Cp,op,an,un,Sn,jc.vertical,Wr,hn,vl.lineStartIndex,vl.lineLength,-1,yo,Hs,Fa,ll),xc=Mn.icon.placedSymbolArray.length-1)}for(const Ph in En.horizontal){const lu=Ph,Nd=En.horizontal[lu];Oa||(Dh=fu(Nd.text),yt?xl=de(Nd):Oa=re(no,Za,hn,js,so,Pa,Nd,_l,Rs.layout.get("text-rotate").evaluate(Sn,{},Hs),Mt));const Cp=Nd.positionedLines.length===1;if(ts+=j(Mn,Wr,hn,Nd,ss,Rs,yt,Sn,Mt,vl,En.vertical?jc.horizontal:jc.horizontalOnly,Cp?Wk(En.horizontal):[lu],Bl,Al,rs,yo,Hs,Fa),Cp)break}En.vertical&&(Qo+=j(Mn,Wr,hn,En.vertical,ss,Rs,yt,Sn,Mt,vl,jc.vertical,["vertical"],Bl,xc,rs,yo,Hs,Fa));let fd=-1;const If=(Ph,lu)=>Ph?Math.max(Ph,lu):lu;fd=If(xl,fd),fd=If(Wa,fd),fd=If(Js,fd);const t_=fd>-1?1:0;Mn.glyphOffsetArray.length>=65535&&tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sn.sortKey!==void 0&&Mn.addToSortKeyRanges(Mn.symbolInstances.length,Sn.sortKey),Mn.symbolInstances.emplaceBack(hn.x,hn.y,Za.x,Za.y,Za.z,Bl.right>=0?Bl.right:-1,Bl.center>=0?Bl.center:-1,Bl.left>=0?Bl.left:-1,Bl.vertical>=0?Bl.vertical:-1,Al,xc,Dh,Oa!==void 0?Oa:Mn.collisionBoxArray.length,Oa!==void 0?Oa+1:Mn.collisionBoxArray.length,kl!==void 0?kl:Mn.collisionBoxArray.length,kl!==void 0?kl+1:Mn.collisionBoxArray.length,Mc!==void 0?Mc:Mn.collisionBoxArray.length,Mc!==void 0?Mc+1:Mn.collisionBoxArray.length,cl||Mn.collisionBoxArray.length,cl?cl+1:Mn.collisionBoxArray.length,js,ts,Qo,Ga,ac,t_,0,Mf,Rd,fd,0,vh?1:0,oc)})(c,jr,Hn,Xi,l,u,x,m,c.layers[0],c.collisionBoxArray,r.index,r.sourceLayerIndex,c.index,Ci,ot,U,0,qi,gr,qe,r,w,K,ee,oe,we,Le,ze,Ir)};if(ct==="line")for(const Xi of Mv(r.geometry,0,0,mr,mr)){const jr=Uk(Xi,si,Fr,l.vertical||ut,u,ri,Xt,c.overscaling,mr);for(const Gr of jr)ut&&ne(c,ut.text,Rr,Gr)||Hi(Xi,Gr,oe)}else if(ct==="line-center"){for(const Xi of r.geometry)if(Xi.length>1){const jr=zk(Xi,Fr,l.vertical||ut,u,ri,Xt);jr&&Hi(Xi,jr,oe)}}else if(r.type==="Polygon")for(const Xi of da(r.geometry,0)){const jr=$k(Xi,16);Hi(Xi[0],new h0(jr.x,jr.y,0,0,void 0),oe)}else if(r.type==="LineString")for(const Xi of r.geometry)Hi(Xi,new h0(Xi[0].x,Xi[0].y,0,0,void 0),oe);else if(r.type==="Point")for(const Xi of r.geometry)for(const jr of Xi)Hi([jr],new h0(jr.x,jr.y,0,0,void 0),oe)}const O=255,z=O*$g;function j(c,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze,qe){const ot=function(tt,ut,Tt,ri,Xt,si,Ci,qi){const Fr=[];if(ut.positionedLines.length===0)return Fr;const gr=ri.layout.get("text-rotate").evaluate(si,{})*Math.PI/180,Rr=function(Xi){const jr=Xi[0],Gr=Xi[1],Hn=jr*Gr;return Hn>0?[jr,-Gr]:Hn<0?[-jr,Gr]:jr===0?[Gr,jr]:[Gr,-jr]}(Tt);let $r=Math.abs(ut.top-ut.bottom);for(const Xi of ut.positionedLines)$r-=Xi.lineOffset;const Zi=ut.positionedLines.length,Ir=$r/Zi;let Hi=ut.top-Tt[1];for(let Xi=0;Xi<Zi;++Xi){const jr=ut.positionedLines[Xi];Hi=tC(ut,Ir,Hi,Xi);for(const Gr of jr.positionedGlyphs){if(!Gr.rect)continue;const Hn=Gr.rect||{};let Mn=Fk+1,hn=!0,Wr=1,Ss=0;if(Gr.image){const Sn=Ci.get(Gr.image.toString());if(!Sn)continue;if(Sn.sdf){tn("SDF images are not supported in formatted text and will be ignored.");continue}hn=!1,Wr=Sn.pixelRatio,Mn=j_/Wr}const En=(Xt||qi)&&Gr.vertical,Dn=Gr.metrics.advance*Gr.scale/2,ss=Gr.metrics,$s=Gr.rect;if($s===null)continue;qi&&ut.verticalizable&&(Ss=Gr.image?Dn-Gr.metrics.width*Gr.scale/2:0);const Rs=Xt?[Gr.x+Dn,Gr.y]:[0,0];let no=[0,0],js=[0,0],so=!1;Xt||(En?(js=[Gr.x+Dn+Rr[0],Gr.y+Rr[1]-Ss],so=!0):no=[Gr.x+Dn+Tt[0],Gr.y+Tt[1]-Ss]);const Pa=$s.w*Gr.scale/(Wr*(Gr.localGlyph?Vg:1)),_l=$s.h*Gr.scale/(Wr*(Gr.localGlyph?Vg:1));let yt,Mt,ir,Zr;if(En){const Sn=Gr.y-Hi,rs=new fr(-Dn,Dn-Sn),go=-Math.PI/2,yo=new fr(...js);yt=new fr(-Dn+no[0],no[1]),yt._rotateAround(go,rs)._add(yo),yt.x+=-Sn+Dn,yt.y-=(ss.left-Mn)*Gr.scale;const Hs=Gr.image?ss.advance*Gr.scale:qh*Gr.scale,Fa=String.fromCodePoint(Gr.glyph);Rk(Fa)?yt.x+=(1-Mn)*Gr.scale:Nk(Fa)?yt.x+=Hs-ss.height*Gr.scale+(-Mn-1)*Gr.scale:yt.x+=Gr.image||ss.width+2*Mn===$s.w&&ss.height+2*Mn===$s.h?(Hs-_l)/2:(Hs-(ss.height+2*Mn)*Gr.scale)/2,Mt=new fr(yt.x,yt.y-Pa),ir=new fr(yt.x+_l,yt.y),Zr=new fr(yt.x+_l,yt.y-Pa)}else{const Sn=(ss.left-Mn)*Gr.scale-Dn+no[0],rs=(-ss.top-Mn)*Gr.scale+no[1],go=Sn+Pa,yo=rs+_l;yt=new fr(Sn,rs),Mt=new fr(go,rs),ir=new fr(Sn,yo),Zr=new fr(go,yo)}if(gr){let Sn;Sn=Xt?new fr(0,0):so?new fr(Rr[0],Rr[1]):new fr(Tt[0],Tt[1]),yt._rotateAround(gr,Sn),Mt._rotateAround(gr,Sn),ir._rotateAround(gr,Sn),Zr._rotateAround(gr,Sn)}const un=new fr(0,0),an=new fr(0,0);Fr.push({tl:yt,tr:Mt,bl:ir,br:Zr,texPrimary:Hn,texSecondary:void 0,writingMode:ut.writingMode,glyphOffset:Rs,sectionIndex:Gr.sectionIndex,isSDF:hn,pixelOffsetTL:un,pixelOffsetBR:an,minFontScaleX:0,minFontScaleY:0})}}return Fr}(0,u,N,x,w,M,m,c.allowVerticalPlacement),ct=c.textSizeData;let Re=null;ct.kind==="source"?(Re=[$g*x.layout.get("text-size").evaluate(M,{},ze)*we.textScaleFactor],Re[0]>z&&tn(`${c.layerIds[0]}: Value for "text-size" is >= ${O}. Reduce your "text-size".`)):ct.kind==="composite"&&(Re=[$g*we.compositeTextSizes[0].evaluate(M,{},ze)*we.textScaleFactor,$g*we.compositeTextSizes[1].evaluate(M,{},ze)*we.textScaleFactor],(Re[0]>z||Re[1]>z)&&tn(`${c.layerIds[0]}: Value for "text-size" is >= ${O}. Reduce your "text-size".`)),c.addSymbols(c.text,ot,Re,N,w,M,K,r,l,U.lineStartIndex,U.lineLength,me,Le,ze,qe,!1);for(const tt of ee)oe[tt]=c.text.placedSymbolArray.length-1;return 4*ot.length}function X(c){for(const r in c)return c[r];return null}function re(c,r,l,u,m,x,w,M,N,U){let K=w.top,ee=w.bottom,oe=w.left,me=w.right;if(Rw(w)&&w.collisionPadding){const we=w.collisionPadding;oe-=we[0],K-=we[1],me+=we[2],ee+=we[3]}if(N){const we=new fr(oe,K),Le=new fr(me,K),ze=new fr(oe,ee),qe=new fr(me,ee),ot=Un(N);let ct=new fr(0,0);U&&(ct=new fr(U[0],U[1])),we._rotateAround(ot,ct),Le._rotateAround(ot,ct),ze._rotateAround(ot,ct),qe._rotateAround(ot,ct),oe=Math.min(we.x,Le.x,ze.x,qe.x),me=Math.max(we.x,Le.x,ze.x,qe.x),K=Math.min(we.y,Le.y,ze.y,qe.y),ee=Math.max(we.y,Le.y,ze.y,qe.y)}return c.emplaceBack(r.x,r.y,r.z,l.x,l.y,oe,K,me,ee,M,u,m,x),c.length-1}function de(c){Rw(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const r=c.bottom-c.top;return r>0?Math.max(10,r):null}function ne(c,r,l,u){const m=c.compareText;if(r in m){const x=m[r];for(let w=x.length-1;w>=0;w--)if(u.dist(x[w])<l)return!0}else m[r]=[];return m[r].push(u),!1}function ce(c,r){const l=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*r:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),x=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-c._pitch-l,.01));let w=Math.sin(c._pitch)*x+m;const M=m*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let N=Math.max(c.zoom-17,0);c.isOrthographic&&(N/=10),w*=1+N}return Math.min(1.01*w,M)}function ye(c,r){if(!r.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:r};const l=Math.pow(2,-c.z),u=c.x*l,m=(c.x+1)*l,x=c.y*l,w=(c.y+1)*l,M=qt(u),N=qt(m),U=Ei(x),K=Ei(w),ee=r.project(M,U),oe=r.project(N,U),me=r.project(N,K),we=r.project(M,K);let Le=Math.min(ee.x,oe.x,me.x,we.x),ze=Math.min(ee.y,oe.y,me.y,we.y),qe=Math.max(ee.x,oe.x,me.x,we.x),ot=Math.max(ee.y,oe.y,me.y,we.y);const ct=l/16;function Re(ut,Tt,ri,Xt,si,Ci){const qi=(ri+si)/2,Fr=(Xt+Ci)/2,gr=r.project(qt(qi),Ei(Fr)),Rr=Math.max(0,Le-gr.x,ze-gr.y,gr.x-qe,gr.y-ot);Le=Math.min(Le,gr.x),qe=Math.max(qe,gr.x),ze=Math.min(ze,gr.y),ot=Math.max(ot,gr.y),Rr>ct&&(Re(ut,gr,ri,Xt,qi,Fr),Re(gr,Tt,qi,Fr,si,Ci))}Re(ee,oe,u,x,m,x),Re(oe,me,m,x,m,w),Re(me,we,m,w,u,w),Re(we,ee,u,w,u,x),Le-=ct,ze-=ct,qe+=ct,ot+=ct;const tt=1/Math.max(qe-Le,ot-ze);return{scale:tt,x:Le*tt,y:ze*tt,x2:qe*tt,y2:ot*tt,projection:r}}function Te(c,{x:r,y:l},u=0){return new fr(((r-u)*c.scale-c.x)*mr,(l*c.scale-c.y)*mr)}const De=te(new Float32Array(16));class Oe{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new et(0,0)}projectTilePoint(r,l,u){return{x:r,y:l,z:0}}locationPoint(r,l,u,m=!0){return r._coordinatePoint(r.locationCoordinate(l,u),m)}pixelsPerMeter(r,l){return Wt(1,r)*l}pixelSpaceConversion(r,l,u){return 1}farthestPixelDistance(r){return ce(r,r.pixelsPerMeter)}pointCoordinate(r,l,u,m){const x=r.horizonLineFromTop(!1),w=new fr(l,Math.max(x,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(w,m))}pointCoordinate3D(r,l,u){const m=new fr(l,u);if(r.elevation)return r.elevation.pointCoordinate(m);{const x=this.pointCoordinate(r,m.x,m.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(r,l){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,l.x,l.y);const u=r.horizonLineFromTop();return l.y<u}createInversionMatrix(r,l){return De}createTileMatrix(r,l,u){let m,x,w;const M=u.canonical,N=te(new Float64Array(16));if(this.isReprojectedInTileSpace){const U=ye(M,this);m=1,x=U.x+u.wrap*U.scale,w=U.y,Se(N,N,[m/U.scale,m/U.scale,r.pixelsPerMeter/l])}else m=l/r.zoomScale(M.z),x=(M.x+Math.pow(2,M.z)*u.wrap)*m,w=M.y*m;return le(N,N,[x,w,0]),Se(N,N,[m/mr,m/mr,1]),N}upVector(r,l,u){return[0,0,1]}upVectorScale(r,l,u){return{metersToTile:1}}}class Be extends Oe{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,u]=this.parallels=r.parallels||[29.5,45.5],m=Math.sin(Un(l));this.n=(m+Math.sin(Un(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:u,c:m,r0:x}=this,w=Un(r-this.center[0]),M=Un(l),N=Math.sqrt(m-2*u*Math.sin(M))/u;return{x:N*Math.sin(w*u),y:N*Math.cos(w*u)-x,z:0}}unproject(r,l){const{n:u,c:m,r0:x}=this,w=x+l;let M=Math.atan2(r,Math.abs(w))*Math.sign(w);w*u<0&&(M-=Math.PI*Math.sign(r)*Math.sign(w));const N=Un(this.center[0])*u;M=xi(M,-Math.PI-N,Math.PI-N);const U=ft(vi(M/u)+this.center[0],-180,180),K=Math.asin(ft((m-(r*r+w*w)*u*u)/(2*u),-1,1)),ee=ft(vi(K),-85.051129,Ki);return new et(U,ee)}}const Ke=1.340264,st=-.081106,Bt=893e-6,Ut=.003796,$t=Math.sqrt(3)/2;class ci extends Oe{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const u=Math.asin($t*Math.sin(l)),m=u*u,x=m*m*m;return{x:.5*(r*Math.cos(u)/($t*(Ke+3*st*m+x*(7*Bt+9*Ut*m)))/Math.PI+.5),y:1-.5*(u*(Ke+st*m+x*(Bt+Ut*m))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,m=u*u,x=m*m*m;for(let K,ee,oe,me=0;me<12&&(ee=u*(Ke+st*m+x*(Bt+Ut*m))-l,oe=Ke+3*st*m+x*(7*Bt+9*Ut*m),K=ee/oe,u=ft(u-K,-Math.PI/3,Math.PI/3),m=u*u,x=m*m*m,!(Math.abs(K)<1e-12));++me);const w=$t*r*(Ke+3*st*m+x*(7*Bt+9*Ut*m))/Math.cos(u),M=Math.asin(Math.sin(u)/$t),N=ft(180*w/Math.PI,-180,180),U=ft(180*M/Math.PI,-85.051129,Ki);return new et(N,U)}}class oi extends Oe{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const u=360*(r-.5),m=ft(360*(.5-l),-85.051129,Ki);return new et(u,m)}}const di=Math.PI/2;function er(c){return Math.tan((di+c)/2)}class Vi extends Oe{constructor(r){super(r),this.center=r.center||[0,30];const[l,u]=this.parallels=r.parallels||[30,30];let m=Un(l),x=Un(u);this.southernCenter=m+x<0,this.southernCenter&&(m=-m,x=-x);const w=Math.cos(m),M=er(m);this.n=m===x?Math.sin(m):Math.log(w/Math.cos(x))/Math.log(er(x)/M),this.f=w*Math.pow(er(m),this.n)/this.n}project(r,l){l=Un(l),this.southernCenter&&(l=-l),r=Un(r-this.center[0]);const u=1e-6,{n:m,f:x}=this;x>0?l<-di+u&&(l=-di+u):l>di-u&&(l=di-u);const w=x/Math.pow(er(l),m);let M=w*Math.sin(m*r),N=x-w*Math.cos(m*r);return M=.5*(M/Math.PI+.5),N=.5*(N/Math.PI+.5),{x:M,y:this.southernCenter?N:1-N,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f:m}=this,x=m-l,w=Math.sign(x),M=Math.sign(u)*Math.sqrt(r*r+x*x);let N=Math.atan2(r,Math.abs(x))*w;x*u<0&&(N-=Math.PI*Math.sign(r)*w);const U=ft(vi(N/u)+this.center[0],-180,180),K=ft(vi(2*Math.atan(Math.pow(m/M,1/u))-di),-85.051129,Ki);return new et(U,this.southernCenter?-K:K)}}class lr extends Oe{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Rt(r),y:Et(l),z:0}}unproject(r,l){const u=qt(r),m=Ei(l);return new et(u,m)}}const Vr=Un(Ki);class Wn extends Oe{project(r,l){const u=(l=Un(l))*l,m=u*u;return{x:.5*((r=Un(r))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,m=25,x=0,w=u*u;do{w=u*u;const U=w*w;x=(u*(1.007226+w*(.015085+U*(.028874*w-.044475-.005916*U)))-l)/(1.007226+w*(.045255+U*(.259866*w-.311325-.005916*11*U))),u=ft(u-x,-Vr,Vr)}while(Math.abs(x)>1e-6&&--m>0);w=u*u;const M=ft(vi(r/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),N=vi(u);return new et(M,N)}}const xn=Un(Ki);class Nn extends Oe{project(r,l){l=Un(l),r=Un(r);const u=Math.cos(l),m=2/Math.PI,x=Math.acos(u*Math.cos(r/2)),w=Math.sin(x)/x,M=.5*(r*m+2*u*Math.sin(r/2)/w)||0,N=.5*(l+Math.sin(l)/w)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(N/Math.PI+1),z:0}}unproject(r,l){let u=r=(2*r-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,x=25;const w=1e-6;let M=0,N=0;do{const U=Math.cos(m),K=Math.sin(m),ee=2*K*U,oe=K*K,me=U*U,we=Math.cos(u/2),Le=Math.sin(u/2),ze=2*we*Le,qe=Le*Le,ot=1-me*we*we,ct=ot?1/ot:0,Re=ot?Math.acos(U*we)*Math.sqrt(1/ot):0,tt=.5*(2*Re*U*Le+2*u/Math.PI)-r,ut=.5*(Re*K+m)-l,Tt=.5*ct*(me*qe+Re*U*we*oe)+1/Math.PI,ri=ct*(ze*ee/4-Re*K*Le),Xt=.125*ct*(ee*Le-Re*K*me*ze),si=.5*ct*(oe*we+Re*qe*U)+.5,Ci=ri*Xt-si*Tt;M=(ut*ri-tt*si)/Ci,N=(tt*Xt-ut*Tt)/Ci,u=ft(u-M,-Math.PI,Math.PI),m=ft(m-N,-xn,xn)}while((Math.abs(M)>w||Math.abs(N)>w)&&--x>0);return new et(vi(u),vi(m))}}class Bn extends Oe{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Un(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:u,cosPhi:m}=this;return{x:Un(r)*m*u+.5,y:-Math.sin(Un(l))/m*u+.5,z:0}}unproject(r,l){const{scale:u,cosPhi:m}=this,x=-(l-.5)/u,w=ft(vi((r-.5)/u)/m,-180,180),M=Math.asin(ft(x*m,-1,1)),N=ft(vi(M),-85.051129,Ki);return new et(w,N)}}class Xn extends lr{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,u){const m=gy(r,l,u);return Oi(m,m,U0(Kp(u))),{x:m[0],y:m[1],z:m[2]}}locationPoint(r,l,u){const m=Ne(l.lat,l.lng),x=Kt([],m),w=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;Vt(m,m,x,Wt(1,0)*mr*w);const M=te(new Float64Array(16));return fe(M,r.pixelMatrix,r.globeMatrix),Oi(m,m,M),new fr(m[0],m[1])}pixelsPerMeter(r,l){return Wt(1,0)*l}pixelSpaceConversion(r,l,u){const m=Wt(1,r)*l,x=kn(Wt(1,45)*l,m,u);return this.pixelsPerMeter(r,l)/x}createTileMatrix(r,l,u){const m=Ky(Kp(u.canonical));return fe(new Float64Array(16),r.globeMatrix,m)}createInversionMatrix(r,l){const{center:u}=r,m=U0(Kp(l));return Ee(m,m,Un(u.lng)),ke(m,m,Un(u.lat)),Se(m,m,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(r,l,u,m){return fv(r,l,u,!0)||new li(0,0)}pointCoordinate3D(r,l,u){const m=this.pointCoordinate(r,l,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(r,l){return!fv(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=function(m,x){const w=m.cameraToCenterDistance,M=m._centerAltitude*x,N=m._camera,U=m._camera.forward(),K=mt([],ui([],U,-w),[0,0,M]),ee=m.worldSize/(2*Math.PI),oe=[0,0,-ee],me=m.width/m.height,we=Math.tan(m.fovAboveCenter),Le=ui([],N.up(),we),ze=ui([],N.right(),we*me),qe=Kt([],mt([],mt([],U,Le),ze)),ot=[];let ct;if(new Ta(K,qe).closestPointOnSphere(oe,ee,ot)){const Re=mt([],ot,oe),tt=pr([],Re,K);ct=Math.cos(m.fovAboveCenter)*Ot(tt)}else{const Re=pr([],K,oe),tt=pr([],oe,K);Kt(tt,tt);const ut=Ot(Re)-ee;ct=Math.sqrt(ut*(ut+2*ee));const Tt=Math.acos(ct/(ee+ut))-Math.acos(Ui(U,tt));ct*=Math.cos(Tt)}return 1.01*ct}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Ef(r.zoom);if(u>0){const m=ce(r,Wt(1,r.center.lat)*r.worldSize),x=r.worldSize/(2*Math.PI),w=Math.max(r.width,r.height)/r.worldSize*Math.PI;return kn(l,m+x*(1-Math.cos(w)),Math.pow(u,10))}return l}upVector(r,l,u){return gy(l,u,r,1)}upVectorScale(r){return{metersToTile:fy(yy(Kp(r)))}}}function es(c){const r=c.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(c.name){case"mercator":return new lr(c);case"equirectangular":return new oi(c);case"naturalEarth":return new Wn(c);case"equalEarth":return new ci(c);case"winkelTripel":return new Nn(c);case"albers":return l?new Bn(c):new Be(c);case"lambertConformalConic":return l?new Bn(c):new Vi(c);case"globe":return new Xn(c)}throw new Error(`Invalid projection name: ${c.name}`)}const ns=cs.VectorTileFeature.types,Qs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nl(c,r,l,u,m,x,w,M,N,U,K,ee,oe){const me=M?Math.min(z,Math.round(M[0])):0,we=M?Math.min(z,Math.round(M[1])):0;c.emplaceBack(r,l,Math.round(32*u),Math.round(32*m),x,w,(me<<1)+(N?1:0),we,16*U,16*K,256*ee,256*oe)}function Uo(c,r,l){c.emplaceBack(r,l)}function jo(c,r,l,u,m,x,w){c.emplaceBack(r,l,u,m,x,w)}const mo=(c,r,l,u)=>{for(let m=0;m<r;m++)c.emplaceBack(l[0],l[1],l[2],u[0],u[1],u[2])};function io(c,r,l,u,m){c.emplaceBack(r,l,u,m),c.emplaceBack(r,l,u,m),c.emplaceBack(r,l,u,m),c.emplaceBack(r,l,u,m)}function vc(c){for(const r of c.sections)if(dh(r.text))return!0;return!1}class El{constructor(r){this.layoutVertexArray=new rd,this.indexArray=new Ac,this.programConfigurations=r,this.segments=new nl,this.dynamicLayoutVertexArray=new Pl,this.opacityVertexArray=new rm,this.placedSymbolArray=new Ou,this.iconTransitioningVertexArray=new Wh,this.globeExtVertexArray=new wf,this.zOffsetVertexArray=new xp,this.orientationVertexArray=new Gp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,l,u,m,x){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,sp.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Gh.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Qs,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,Vb.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,ef.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,pm.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,fm.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}mn(El,"SymbolBuffers");class fc{constructor(r,l,u){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new u,this.segments=new nl,this.collisionVertexArray=new Id,this.collisionVertexArrayExt=new Pl}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Dk.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,Pk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mn(fc,"CollisionBuffers");class au{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.lut=r.lut,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(w=>w.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=te([]),this.placementViewportMatrix=te([]);const l=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.textSizeData=Gb(this.zoom,l["text-size"],this.worldview),this.iconSizeData=Gb(this.zoom,l["icon-size"],this.worldview);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),x=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(w=>jc[w]),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new El(new g(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new El(new g(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new Ag,this.lineVertexArray=new am,this.symbolInstances=new tu}calculateGlyphDependencies(r,l,u,m,x){for(const w of r){const M=w.codePointAt(0);if(M===void 0)break;if(l[M]=!0,m&&x&&M<=65535){const N=Nx[w];N&&(l[N.charCodeAt(0)]=!0)}}}updateFootprints(r,l){}updateReplacement(r,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const u=l.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!_x(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,l,u,m){const x=this.layers[0],w=x.layout,M=this.projection.name==="globe",N=w.get("text-font"),U=w.get("text-field"),K=w.get("icon-image"),[ee,oe]=w.get("icon-size-scale-range"),me=ft(l.scaleFactor||1,ee,oe),we=(U.value.kind!=="constant"||U.value.value instanceof yi&&!U.value.value.isEmpty()||U.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),Le=K.value.kind!=="constant"||!!K.value.value||Object.keys(K.parameters).length>0,ze=w.get("symbol-sort-key");if(this.features=[],!we&&!Le)return;const qe=l.iconDependencies,ot=l.glyphDependencies,ct=l.availableImages,Re=new sa(this.zoom,{worldview:this.worldview});for(const{feature:tt,id:ut,index:Tt,sourceLayerIndex:ri}of r){const Xt=x._featureFilter.needGeometry,si=on(tt,Xt);if(!x._featureFilter.filter(Re,si,u))continue;if(Xt||(si.geometry=pn(tt,u,m)),M&&tt.type!==1&&u.z<=5){const Rr=si.geometry,$r=.98078528056,Zi=(Ir,Hi)=>Ui(gy(Ir.x,Ir.y,u,1),gy(Hi.x,Hi.y,u,1))<$r;for(let Ir=0;Ir<Rr.length;Ir++)Rr[Ir]=Nr(Rr[Ir],Zi)}let Ci,qi;if(we){const Rr=x.getValueAndResolveTokens("text-field",si,u,ct),$r=yi.factory(Rr);vc($r)&&(this.hasRTLText=!0),(!this.hasRTLText||jp()==="unavailable"||this.hasRTLText&&jd.isParsed())&&(Ci=FT($r,x,si))}if(Le){const Rr=x.getValueAndResolveTokens("icon-image",si,u,ct);qi=typeof Rr=="string"?Li.build(Rr):Rr}if(!Ci&&!qi)continue;const Fr=this.sortFeaturesByKey?ze.evaluate(si,{},u):void 0,gr={id:ut,text:Ci,icon:qi,index:Tt,sourceLayerIndex:ri,geometry:si.geometry,properties:tt.properties,type:ns[tt.type],sortKey:Fr};if(this.features.push(gr),qi){const Rr=this.layers[0]._unevaluatedLayout._values,{iconPrimary:$r,iconSecondary:Zi}=sC(qi,this.iconSizeData,Rr["icon-size"],u,this.zoom,gr,this.pixelRatio,me,this.worldview),Ir=$r.id.toString();if(qe.has(Ir)?qe.get(Ir).push($r):qe.set(Ir,[$r]),Zi){const Hi=Zi.id.toString();qe.has(Hi)?qe.get(Hi).push(Zi):qe.set(Hi,[Zi])}}if(Ci){const Rr=N.evaluate(si,{},u).join(","),$r=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jc.vertical)>=0;for(const Zi of Ci.sections)if(Zi.image){const Ir=Zi.image.getPrimary().scaleSelf(this.pixelRatio),Hi=Ir.id.toString(),Xi=qe.get(Hi)||[];Xi.push(Ir),qe.set(Hi,Xi)}else{const Ir=kd(Ci.toString()),Hi=Zi.fontStack||Rr,Xi=ot[Hi]=ot[Hi]||{};this.calculateGlyphDependencies(Zi.text,Xi,$r,this.allowVerticalPlacement,Ir)}}}if(w.get("symbol-placement")==="line"&&(this.features=function(tt){const ut={},Tt={},ri=[];let Xt=0;function si(gr){ri.push(tt[gr]),Xt++}function Ci(gr,Rr,$r){const Zi=Tt[gr];return delete Tt[gr],Tt[Rr]=Zi,ri[Zi].geometry[0].pop(),ri[Zi].geometry[0]=ri[Zi].geometry[0].concat($r[0]),Zi}function qi(gr,Rr,$r){const Zi=ut[Rr];return delete ut[Rr],ut[gr]=Zi,ri[Zi].geometry[0].shift(),ri[Zi].geometry[0]=$r[0].concat(ri[Zi].geometry[0]),Zi}function Fr(gr,Rr,$r){const Zi=$r?Rr[0][Rr[0].length-1]:Rr[0][0];return`${gr}:${Zi.x}:${Zi.y}`}for(let gr=0;gr<tt.length;gr++){const Rr=tt[gr],$r=Rr.geometry,Zi=Rr.text?Rr.text.toString():null;if(!Zi){si(gr);continue}const Ir=Fr(Zi,$r),Hi=Fr(Zi,$r,!0);if(Ir in Tt&&Hi in ut&&Tt[Ir]!==ut[Hi]){const Xi=qi(Ir,Hi,$r),jr=Ci(Ir,Hi,ri[Xi].geometry);delete ut[Ir],delete Tt[Hi],Tt[Fr(Zi,ri[jr].geometry,!0)]=jr,ri[Xi].geometry=null}else Ir in Tt?Ci(Ir,Hi,$r):Hi in ut?qi(Ir,Hi,$r):(si(gr),ut[Ir]=Xt-1,Tt[Hi]=Xt-1)}return ri.filter(gr=>gr.geometry)}(this.features)),w.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const tt of l.elevationFeatures)this.elevationFeatureIdToIndex.set(tt.id,this.elevationFeatures.length),this.elevationFeatures.push(tt)}}else w.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((tt,ut)=>tt.sortKey-ut.sortKey)}update(r,l,u,m,x,w,M){this.text.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,l,x,u,m,w,M,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let l=!1;const u=$i(r),m=1/u;let x=!1,w=!1;for(let M=0;M<this.symbolInstances.length;M++){const N=this.symbolInstances.get(M),U=Ae(1,0,0),K=Ae(0,1,0),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:oe,numIconVertices:me,numVerticalIconVertices:we}=N,Le=ee>0||oe>0,ze=me>0,qe=this.elevationFeatures[N.elevationFeatureIndex];if(qe){const ot=new fr(N.tileAnchorX,N.tileAnchorY),ct=.075+qe.pointElevation(ot);N.zOffset!==ct&&(l=!0,N.zOffset=ct);const Re=qe.computeSlopeNormal(ot,m),tt=gs(Si(),Ae(0,0,1),Re);ji(U,U,tt),ji(K,K,tt),U[2]*=u,K[2]*=u,U[0]===1&&U[1]===0&&U[2]===0&&K[0]===0&&K[1]===1&&K[2]===0||(x=x||Le,w=w||ze)}if(Le&&(mo(this.text.orientationVertexArray,ee,U,K),mo(this.text.orientationVertexArray,oe,U,K)),ze){const{placedIconSymbolIndex:ot,verticalPlacedIconSymbolIndex:ct}=N;ot>=0&&mo(this.icon.orientationVertexArray,me,U,K),ct>=0&&mo(this.icon.orientationVertexArray,we,U,K)}}x||(this.text.orientationVertexArray=void 0),w||(this.icon.orientationVertexArray=void 0),l&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(x,w,M)=>{u+=w,u>x.length&&x.resize(u);for(let N=-w;N<0;N++)x.emplace(N+u,M)},l=(x,w,M)=>{m+=w,m>x.length&&x.resize(m);for(let N=-w;N<0;N++)x.emplace(N+m,M)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:N,numIconVertices:U}=w,K=w.zOffset,ee=U>0;if((M>0||N>0)&&(r(this.text.zOffsetVertexArray,M,K),r(this.text.zOffsetVertexArray,N,K)),ee){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:me}=w;oe>=0&&l(this.icon.zOffsetVertexArray,U,K),me>=0&&l(this.icon.zOffsetVertexArray,w.numVerticalIconVertices,K)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=es(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:m,y:x}of l)this.lineVertexArray.emplaceBack(m,x);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le,ze){const qe=r.indexArray,ot=r.layoutVertexArray,ct=r.globeExtVertexArray,Re=r.segments.prepareSegment(4*l.length,ot,qe,this.canOverlap?w.sortKey:void 0),tt=this.glyphOffsetArray.length,ut=Re.vertexLength,Tt=this.allowVerticalPlacement&&M===jc.vertical?Math.PI/2:0,ri=w.text&&w.text.sections;for(let si=0;si<l.length;si++){const{tl:Ci,tr:qi,bl:Fr,br:gr,texPrimary:Rr,texSecondary:$r,pixelOffsetTL:Zi,pixelOffsetBR:Ir,minFontScaleX:Hi,minFontScaleY:Xi,glyphOffset:jr,isSDF:Gr,sectionIndex:Hn}=l[si],Mn=Re.vertexLength,hn=jr[1];if(Nl(ot,U.x,U.y,Ci.x,hn+Ci.y,Rr.x,Rr.y,u,Gr,Zi.x,Zi.y,Hi,Xi),Nl(ot,U.x,U.y,qi.x,hn+qi.y,Rr.x+Rr.w,Rr.y,u,Gr,Ir.x,Zi.y,Hi,Xi),Nl(ot,U.x,U.y,Fr.x,hn+Fr.y,Rr.x,Rr.y+Rr.h,u,Gr,Zi.x,Ir.y,Hi,Xi),Nl(ot,U.x,U.y,gr.x,hn+gr.y,Rr.x+Rr.w,Rr.y+Rr.h,u,Gr,Ir.x,Ir.y,Hi,Xi),N){const{x:Wr,y:Ss,z:En}=N.anchor,[Dn,ss,$s]=N.up;jo(ct,Wr,Ss,En,Dn,ss,$s),jo(ct,Wr,Ss,En,Dn,ss,$s),jo(ct,Wr,Ss,En,Dn,ss,$s),jo(ct,Wr,Ss,En,Dn,ss,$s),io(r.dynamicLayoutVertexArray,Wr,Ss,En,Tt)}else io(r.dynamicLayoutVertexArray,U.x,U.y,U.z,Tt);if(ze){const Wr=$r||Rr;Uo(r.iconTransitioningVertexArray,Wr.x,Wr.y),Uo(r.iconTransitioningVertexArray,Wr.x+Wr.w,Wr.y),Uo(r.iconTransitioningVertexArray,Wr.x,Wr.y+Wr.h),Uo(r.iconTransitioningVertexArray,Wr.x+Wr.w,Wr.y+Wr.h)}qe.emplaceBack(Mn,Mn+1,Mn+2),qe.emplaceBack(Mn+1,Mn+2,Mn+3),Re.vertexLength+=4,Re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jr[0]),si!==l.length-1&&Hn===l[si+1].sectionIndex||r.programConfigurations.populatePaintArrays(ot.length,w,w.index,{},me,we,Le,ri&&ri[Hn],this.worldview)}const Xt=N?N.anchor:U;r.placedSymbolArray.emplaceBack(Xt.x,Xt.y,Xt.z,U.x,U.y,tt,this.glyphOffsetArray.length-tt,ut,K,ee,U.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],M,0,0,0,oe,0)}_commitLayoutVertex(r,l,u,m,x,w,M){r.emplaceBack(l,u,m,x,w,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(r,l,u,m,x,w,M){const N=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),U=N.vertexLength,K=M.tileAnchorX,ee=M.tileAnchorY;for(let me=0;me<4;me++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,l,r.padding,M.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,x,w,K,ee,new fr(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,x,w,K,ee,new fr(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,x,w,K,ee,new fr(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,x,w,K,ee,new fr(r.x1,r.y2)),N.vertexLength+=4;const oe=u.indexArray;oe.emplaceBack(U,U+1),oe.emplaceBack(U+1,U+2),oe.emplaceBack(U+2,U+3),oe.emplaceBack(U+3,U),N.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,u,m,x,w){for(let M=m;M<x;M++){const N=u.get(M),U=this.getSymbolInstanceTextSize(r,w,l,M);this._addCollisionDebugVertices(N,U,this.textCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(r,l,u,m,x,w){for(let M=m;M<x;M++){const N=u.get(M),U=this.getSymbolInstanceIconSize(r,l,w.placedIconSymbolIndex);this._addCollisionDebugVertices(N,U,this.iconCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,w)}}generateCollisionDebugBuffers(r,l,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fc(Sf,BT.members,Wh),this.iconCollisionBox=new fc(Sf,BT.members,Wh);const m=Fv(this.iconSizeData,r),x=Fv(this.textSizeData,r,u);for(let w=0;w<this.symbolInstances.length;w++){const M=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(x,r,l,M.textBoxStartIndex,M.textBoxEndIndex,M),this._addTextDebugCollisionBoxes(x,r,l,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M),this._addIconDebugCollisionBoxes(m,r,l,M.iconBoxStartIndex,M.iconBoxEndIndex,M),this._addIconDebugCollisionBoxes(m,r,l,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M)}}getSymbolInstanceTextSize(r,l,u,m){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),w=W_(this.textSizeData,r,x)/qh;return this.tilePixelRatio*w}getSymbolInstanceIconSize(r,l,u){const m=this.icon.placedSymbolArray.get(u),x=W_(this.iconSizeData,r,m);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(r,l,u,m){r.emplaceBack(l,-u,-u,m),r.emplaceBack(l,u,-u,m),r.emplaceBack(l,u,u,m),r.emplaceBack(l,-u,u,m)}_updateTextDebugCollisionBoxes(r,l,u,m,x,w,M){for(let N=m;N<x;N++){const U=u.get(N),K=this.getSymbolInstanceTextSize(r,w,l,N);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,K,U.padding,w.zOffset)}}_updateIconDebugCollisionBoxes(r,l,u,m,x,w,M){for(let N=m;N<x;N++){const U=u.get(N),K=this.getSymbolInstanceIconSize(r,l,w.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,K,U.padding,w.zOffset)}}updateCollisionDebugBuffers(r,l,u,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=Fv(this.iconSizeData,r,m),w=Fv(this.textSizeData,r,u);for(let M=0;M<this.symbolInstances.length;M++){const N=this.symbolInstances.get(M);this._updateTextDebugCollisionBoxes(w,r,l,N.textBoxStartIndex,N.textBoxEndIndex,N,u),this._updateTextDebugCollisionBoxes(w,r,l,N.verticalTextBoxStartIndex,N.verticalTextBoxEndIndex,N,u),this._updateIconDebugCollisionBoxes(x,r,l,N.iconBoxStartIndex,N.iconBoxEndIndex,N,m),this._updateIconDebugCollisionBoxes(x,r,l,N.verticalIconBoxStartIndex,N.verticalIconBoxEndIndex,N,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,u,m,x,w,M,N,U){const K={};if(l<u){const{x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re,featureIndex:tt}=r.get(l);K.textBox={x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re},K.textFeatureIndex=tt}if(m<x){const{x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re,featureIndex:tt}=r.get(m);K.verticalTextBox={x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re},K.verticalTextFeatureIndex=tt}if(w<M){const{x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re,featureIndex:tt}=r.get(w);K.iconBox={x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re},K.iconFeatureIndex=tt}if(N<U){const{x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re,featureIndex:tt}=r.get(N);K.verticalIconBox={x1:ee,y1:oe,x2:me,y2:we,padding:Le,projectedAnchorX:ze,projectedAnchorY:qe,projectedAnchorZ:ot,tileAnchorX:ct,tileAnchorY:Re},K.verticalIconFeatureIndex=tt}return K}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,l){const u=r.placedSymbolArray.get(l),m=u.vertexStartIndex+4*u.numGlyphs;for(let x=u.vertexStartIndex;x<m;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),u=Math.cos(r),m=[],x=[],w=[];for(let M=0;M<this.symbolInstances.length;++M){w.push(M);const N=this.symbolInstances.get(M);m.push(0|Math.round(l*N.tileAnchorX+u*N.tileAnchorY)),x.push(N.featureIndex)}return w.sort((M,N)=>m[M]-m[N]||x[N]-x[M]),w}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:U}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&w!==x&&w!==m&&this.addIndicesForPlacedSymbol(this.text,w),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N),U>=0&&this.addIndicesForPlacedSymbol(this.icon,U)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ey,gm,dd;mn(au,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),au.addDynamicAttributes=io;class pd{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:$c,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mn(pd,"FormatSectionOverride",{omit:["defaultValue"]});const Hc=()=>dd||(dd={layout:Ey||(Ey=new ha({"symbol-placement":new Wi(wi.layout_symbol["symbol-placement"]),"symbol-spacing":new Wi(wi.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wi(wi.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new cn(wi.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wi(wi.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Wi(wi.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Wi(wi.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Wi(wi.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wi(wi.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wi(wi.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wi(wi.layout_symbol["icon-rotation-alignment"]),"icon-size":new cn(wi.layout_symbol["icon-size"]),"icon-size-scale-range":new Wi(wi.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new cn(wi.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new cn(wi.layout_symbol["icon-text-fit-padding"]),"icon-image":new cn(wi.layout_symbol["icon-image"]),"icon-rotate":new cn(wi.layout_symbol["icon-rotate"]),"icon-padding":new Wi(wi.layout_symbol["icon-padding"]),"icon-keep-upright":new Wi(wi.layout_symbol["icon-keep-upright"]),"icon-offset":new cn(wi.layout_symbol["icon-offset"]),"icon-anchor":new cn(wi.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wi(wi.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wi(wi.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wi(wi.layout_symbol["text-rotation-alignment"]),"text-field":new cn(wi.layout_symbol["text-field"]),"text-font":new cn(wi.layout_symbol["text-font"]),"text-size":new cn(wi.layout_symbol["text-size"]),"text-size-scale-range":new Wi(wi.layout_symbol["text-size-scale-range"]),"text-max-width":new cn(wi.layout_symbol["text-max-width"]),"text-line-height":new cn(wi.layout_symbol["text-line-height"]),"text-letter-spacing":new cn(wi.layout_symbol["text-letter-spacing"]),"text-justify":new cn(wi.layout_symbol["text-justify"]),"text-radial-offset":new cn(wi.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wi(wi.layout_symbol["text-variable-anchor"]),"text-anchor":new cn(wi.layout_symbol["text-anchor"]),"text-max-angle":new Wi(wi.layout_symbol["text-max-angle"]),"text-writing-mode":new Wi(wi.layout_symbol["text-writing-mode"]),"text-rotate":new cn(wi.layout_symbol["text-rotate"]),"text-padding":new Wi(wi.layout_symbol["text-padding"]),"text-keep-upright":new Wi(wi.layout_symbol["text-keep-upright"]),"text-transform":new cn(wi.layout_symbol["text-transform"]),"text-offset":new cn(wi.layout_symbol["text-offset"]),"text-allow-overlap":new Wi(wi.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wi(wi.layout_symbol["text-ignore-placement"]),"text-optional":new Wi(wi.layout_symbol["text-optional"]),visibility:new Wi(wi.layout_symbol.visibility)})),paint:gm||(gm=new ha({"icon-opacity":new cn(wi.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new cn(wi.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new cn(wi.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new cn(wi.paint_symbol["text-emissive-strength"]),"icon-color":new cn(wi.paint_symbol["icon-color"]),"icon-halo-color":new cn(wi.paint_symbol["icon-halo-color"]),"icon-halo-width":new cn(wi.paint_symbol["icon-halo-width"]),"icon-halo-blur":new cn(wi.paint_symbol["icon-halo-blur"]),"icon-translate":new Wi(wi.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wi(wi.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wi(wi.paint_symbol["icon-image-cross-fade"]),"text-opacity":new cn(wi.paint_symbol["text-opacity"]),"text-occlusion-opacity":new cn(wi.paint_symbol["text-occlusion-opacity"]),"text-color":new cn(wi.paint_symbol["text-color"],{runtimeType:zl,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new cn(wi.paint_symbol["text-halo-color"]),"text-halo-width":new cn(wi.paint_symbol["text-halo-width"]),"text-halo-blur":new cn(wi.paint_symbol["text-halo-blur"]),"text-translate":new Wi(wi.paint_symbol["text-translate"]),"text-translate-anchor":new Wi(wi.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Wi(wi.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Wi(wi.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Wi(wi.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Wi(wi.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new cn(wi.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},dd);class Q0 extends th{constructor(r,l,u,m){super(r,Hc(),l,u,m),this._colorAdjustmentMatrix=te([]),this.hasInitialOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const x of u)m.indexOf(x)<0&&m.push(x);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,l,u,m){return this._saturation===r&&this._contrast===l&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(x,w,M,N){x=is(x),w=rn(w);const U=Q(),K=x/3,ee=1-2*K,oe=[ee,K,K,0,K,ee,K,0,K,K,ee,0,0,0,0,1],me=.5-.5*w,we=N-M;return fe(U,[we,0,0,0,0,we,0,0,0,0,we,0,M,M,M,1],[w,0,0,0,0,w,0,0,0,0,w,0,me,me,me,1]),fe(U,U,oe),U}(r,l,u,m),this._saturation=r,this._contrast=l,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,l,u,m){const x=this.layout.get(r).evaluate(l,{},u,m),w=this._unevaluatedLayout._values[r];return w.isDataDriven()||jl(w.value)||!x?x:function(M,N){return N.replace(/{([^{}]+)}/g,(U,K)=>K in M?String(M[K]):"")}(l.properties,x)}createBucket(r){return new au(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Hc().paint.overridableProperties){if(!Q0.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),u=new pd(l),m=new Xf(u,l.property.specification,this.scope,this.options);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new Zf("source",m):new gl("composite",m,l.value.zoomStops,l.value.interpolationType),this.paint._values[r]=new Qf(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&Q0.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const u=r.get("text-field"),m=Hc().paint.properties[l];let x=!1;const w=M=>{for(const N of M)if(m.overrides&&m.overrides.hasOverride(N))return void(x=!0)};if(u.value.kind==="constant"&&u.value.value instanceof yi)w(u.value.value.sections);else if(u.value.kind==="source"){const M=U=>{x||(U instanceof sr&&Gt(U.value)===ju?w(U.value.sections):U instanceof Pn?w(U.sections):U.eachChild(M))},N=u.value;N._styleExpression&&M(N._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,l,u){return{config:new Wm(this,{zoom:l,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let u0,J0,Vv,tg;var e_=lo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Jb(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Hk(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Gk{constructor(r,l,u,m){this.context=r,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=r.gl.createTexture(),this.update(l,{premultiply:m&&m.premultiply})}update(r,l){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,m=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:x}=this,{gl:w}=x,{x:M,y:N}=l&&l.position?l.position:{x:0,y:0},U=M+u,K=N+m;!this.size||this.size[0]===U&&this.size[1]===K||(w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(this.texture),this.texture=w.createTexture(),this.size=null),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA8&&(!l||l.premultiply!==!1));const ee=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&U>0&&K>0){const oe=this.useMipmap?Math.floor(Math.log2(Math.max(U,K)))+1:1;w.texStorage2D(w.TEXTURE_2D,oe,this.format,U,K),this.size=[U,K]}if(this.size)if(ee)w.texSubImage2D(w.TEXTURE_2D,0,M,N,Jb(this.format),Hk(this.format),r);else{const oe=r.data;oe&&w.texSubImage2D(w.TEXTURE_2D,0,M,N,u,m,Jb(this.format),Hk(this.format),oe)}this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(r,l,u=!1){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),r!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,r),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),l!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(r,l,u,m,x){const{context:w}=this,{gl:M}=w;M.bindTexture(M.TEXTURE_2D,this.texture),l!==this.magFilter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,l),this.magFilter=l),r!==this.minFilter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,this.useMipmap?r===M.NEAREST?M.NEAREST_MIPMAP_NEAREST:M.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,m),this.wrapT=m),x!==this.compareMode&&(x?(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_MODE,M.COMPARE_REF_TO_TEXTURE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_FUNC,x)):M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_MODE,M.NONE),this.compareMode=x)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class oC{constructor(r,l){this.context=r,this.texture=l}bind(r,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,r),this.minFilter=r),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}function aC(c,r,l,u,m,x,w,M){const N=[c,r,1,l,u,1,m,x,1],U=[w,M,1],K=G([],N),[ee,oe,me]=cr(U,U,K);return q(N,N,[ee,0,0,0,oe,0,0,0,me])}function jD(c,r,l,u,m,x,w,M){const N=function(U,K,ee,oe,me,we,Le,ze){const qe=aC(0,0,1,0,1,1,0,1),ot=aC(U,K,ee,oe,me,we,Le,ze);return q(ot,ot,G([],qe))}(c,r,l,u,m,x,w,M);return[N[2]/N[8]/mr,N[5]/N[8]/mr]}function lC(c){return[c[0],Math.min(Math.max(c[1],-85.051129),Ki)]}class HD extends Wu{constructor(r,l,u,m){super(),this.id=r,this.dispatcher=u,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(r,l){if(this._loaded=l||!1,this.fire(new Ha("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=qa(this.map._requestManager.transformRequest(this.url,Th.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Ll(u)):m&&(this.image=m instanceof HTMLImageElement?ch.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new oC(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ha("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof oC||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=r[0][1],u=r[0][1];for(const x of r)x[1]>u&&(u=x[1]),x[1]<l&&(l=x[1]);const m=(u+l)/2;if(m>Ki?this.onNorthPole=!0:m<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=r.map(li.fromLngLat);this.tileID=function(w){let M=1/0,N=1/0,U=-1/0,K=-1/0;for(const Le of w)M=Math.min(M,Le.x),N=Math.min(N,Le.y),U=Math.max(U,Le.x),K=Math.max(K,Le.y);const ee=Math.max(U-M,K-N),oe=Math.max(0,Math.floor(-Math.log(ee)/Math.LN2)),me=Math.pow(2,oe);let we=Math.floor((M+U)/2*me);return we>1&&(we-=1),new Rg(oe,we,Math.floor((N+K)/2*me))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ha("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const qe in this.tiles){const ot=this.tiles[qe];ot.state!=="loaded"&&(ot.state="loaded",ot.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=ye(new Rg(0,0,0),this.map.transform.projection),u=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(qe){const ot=qe[1].x-qe[0].x,ct=qe[1].y-qe[0].y,Re=qe[2].x-qe[1].x,tt=qe[2].y-qe[1].y,ut=qe[3].x-qe[2].x,Tt=qe[3].y-qe[2].y,ri=qe[0].x-qe[3].x,Xt=qe[0].y-qe[3].y,si=ot*tt-Re*ct,Ci=Re*Tt-ut*tt,qi=ut*Xt-ri*Tt,Fr=ri*ct-ot*Xt;return si>0&&Ci>0&&qi>0&&Fr>0||si<0&&Ci<0&&qi<0&&Fr<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=ye(this.tileID,this.map.transform.projection),[x,w,M,N]=this.coordinates.map(qe=>{const ot=m.projection.project(qe[0],qe[1]);return Te(m,ot)._round()});this.perspectiveTransform=jD(x.x,x.y,w.x,w.y,M.x,M.y,N.x,N.y);const U=this._boundsArray=new tm;U.emplaceBack(x.x,x.y,0,0),U.emplaceBack(w.x,w.y,mr,0),U.emplaceBack(N.x,N.y,0,mr),U.emplaceBack(M.x,M.y,mr,mr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(U,e_.members),this.boundsSegments=nl.simpleSegment(0,0,4,2);const K=[],ee=[lC((oe=this.coordinates)[0]),lC(oe[1]),lC(oe[2]),lC(oe[3])];var oe;const[me,we,Le,ze]=function(qe){let ot=qe[0][0],ct=ot,Re=qe[0][1],tt=Re;for(let ut=1;ut<qe.length;ut++)qe[ut][0]<ot?ot=qe[ut][0]:qe[ut][0]>ct&&(ct=qe[ut][0]),qe[ut][1]<Re?Re=qe[ut][1]:qe[ut][1]>tt&&(tt=qe[ut][1]);return[ot,Re,ct-ot,tt-Re]}(ee);{const qe=new tm,[ot,ct,Re,tt]=function(Zi){let Ir=Zi[0].x,Hi=Ir,Xi=Zi[0].y,jr=Xi;for(let Gr=1;Gr<Zi.length;Gr++)Zi[Gr].x<Ir?Ir=Zi[Gr].x:Zi[Gr].x>Hi&&(Hi=Zi[Gr].x),Zi[Gr].y<Xi?Xi=Zi[Gr].y:Zi[Gr].y>jr&&(jr=Zi[Gr].y);return[Ir,Xi,Hi-Ir,jr-Xi]}(u),ut=Zi=>[(Zi.x-ot)/Re,(Zi.y-ct)/tt],[Tt,ri,Xt,si]=u.map(ut),Ci=function(Zi,Ir,Hi,Xi,jr,Gr,Hn,Mn){const hn=aC(0,0,1,0,1,1,0,1);return q(hn,hn,G([],aC(Zi,Ir,Hi,Xi,jr,Gr,Hn,Mn)))}(Tt[0],Tt[1],ri[0],ri[1],Xt[0],Xt[1],si[0],si[1]);this.elevatedGlobePerspectiveTransform=jD(Tt[0],Tt[1],ri[0],ri[1],Xt[0],Xt[1],si[0],si[1]);const qi=(Zi,Ir)=>{K.push(Zi.lng);const Hi=Math.round((Zi.lng-me)/Le*mr),Xi=Math.round((Zi.lat-we)/ze*mr),jr=ut(Ir),Gr=cr([],[jr[0],jr[1],1],Ci),Hn=Math.round(Gr[0]/Gr[2]*mr),Mn=Math.round(Gr[1]/Gr[2]*mr);qe.emplaceBack(Hi,Xi,Hn,Mn)},Fr=u[3].x-u[0].x,gr=u[3].y-u[0].y,Rr=u[2].x-u[1].x,$r=u[2].y-u[1].y;for(let Zi=0;Zi<65;Zi++){const Ir=Zi/64,Hi=[u[0].x+Ir*Fr,u[0].y+Ir*gr],Xi=[u[1].x+Ir*Rr,u[1].y+Ir*$r],jr=Xi[0]-Hi[0],Gr=Xi[1]-Hi[1];for(let Hn=0;Hn<65;Hn++){const Mn=Hn/64,hn={x:Hi[0]+jr*Mn,y:Hi[1]+Gr*Mn};qi(l.projection.unproject(hn.x,hn.y),hn)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(qe,e_.members)}{this.maxLongitudeTriangleSize=0;let qe=[],ot=new Ac;const ct=(Re,tt,ut)=>{ot.emplaceBack(Re,tt,ut);const Tt=K[Re],ri=K[tt],Xt=K[ut],si=Math.min(Math.min(Tt,ri),Xt),Ci=Math.max(Math.max(Tt,ri),Xt)-si;Ci>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ci),qe.push(si+Ci/2)};for(let Re=0;Re<64;Re++)for(let tt=0;tt<64;tt++){const ut=65*Re+tt,Tt=ut+1,ri=ut+65,Xt=ri+1;ct(ut,ri,Tt),ct(Tt,ri,Xt)}[qe,ot]=function(Re,tt){const ut=Array.from({length:Re.length},(Xt,si)=>si);ut.sort((Xt,si)=>Re[Xt]-Re[si]);const Tt=[],ri=new Ac;for(let Xt=0;Xt<ut.length;Xt++){const si=ut[Xt];Tt.push(Re[si]);const Ci=3*si,qi=Ci+1;ri.emplaceBack(tt.uint16[Ci],tt.uint16[qi],tt.uint16[qi+1])}return[Tt,ri]}(qe,ot),this.elevatedGlobeTrianglesCenterLongitudes=qe,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(ot)}this.elevatedGlobeSegments=nl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Le/mr,0,ze/mr,0,0,we,me,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const l=this.map.painter.context,u=l.gl;!this._dirty||this.texture instanceof oC||(this.texture?this.texture.update(this.image):(this.texture=new Gk(l,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(l)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(x=r+180)+360*Math.round((u[0]-x)/360);var x;const w=new nl,M=(ee,oe)=>{w.segments.push({vertexOffset:0,primitiveOffset:ee,vertexLength:l.segments[0].vertexLength,primitiveLength:oe,sortKey:void 0,vaos:{}})},N=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=N){const ee=Hr(u,0,u.length,m+N);return ee===u.length||M(ee,yr(u,ee+1,u.length,m+360-N)-ee),w}m<u[0]&&(m+=360);const U=yr(u,0,u.length,m-N);if(U===u.length)return M(0,u.length),w;M(0,U-0);const K=Hr(u,U+1,u.length,m+N);return K!==u.length&&M(K,u.length-K),w}}const z8=(Math.pow(256,2)-1)/16907520;class GD extends th{constructor(r,l,u,m){super(r,{layout:Vv||(Vv=new ha({visibility:new Wi(wi.layout_raster.visibility)})),paint:tg||(tg=new ha({"raster-opacity":new Wi(wi.paint_raster["raster-opacity"]),"raster-color":new Jf(wi.paint_raster["raster-color"]),"raster-color-mix":new Wi(wi.paint_raster["raster-color-mix"]),"raster-color-range":new Wi(wi.paint_raster["raster-color-range"]),"raster-hue-rotate":new Wi(wi.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wi(wi.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wi(wi.paint_raster["raster-brightness-max"]),"raster-saturation":new Wi(wi.paint_raster["raster-saturation"]),"raster-contrast":new Wi(wi.paint_raster["raster-contrast"]),"raster-resampling":new Wi(wi.paint_raster["raster-resampling"]),"raster-fade-duration":new Wi(wi.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Wi(wi.paint_raster["raster-emissive-strength"]),"raster-array-band":new Wi(wi.paint_raster["raster-array-band"]),"raster-elevation":new Wi(wi.paint_raster["raster-elevation"]),"raster-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},l,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof HD&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=ae({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let qD,YD,XD,ZD,KD;class QD extends th{constructor(r,l,u,m){super(r,{layout:qD||(qD=new ha({visibility:new Wi(wi["layout_raster-particle"].visibility)})),paint:YD||(YD=new ha({"raster-particle-array-band":new Wi(wi["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Wi(wi["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Jf(wi["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Wi(wi["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Wi(wi["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Wi(wi["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Wi(wi["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Wi(wi["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},l,u,m),this._updateColorRamp(),this.lastInvalidatedAt=ch.now()}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ae({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ch.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class U8 extends th{constructor(r,l){super(r,{},l,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function qk(c,r,l){const u=[0,0,1],m=pi([]);return Ht(m,m,l?-Un(c)+Math.PI:Un(c)),St(m,m,-Un(r)),ji(u,u,m),Kt(u,u)}function JD(c,r){const l=cC(c.projection,c.zoom,c.width,c.height),u=function(x,w,M,N,U){const K=new et(M.lng-180*Wv,M.lat),ee=new et(M.lng+180*Wv,M.lat),oe=x.project(K.lng,K.lat),me=x.project(ee.lng,ee.lat),we=-Math.atan2(me.y-oe.y,me.x-oe.x),Le=li.fromLngLat(M);Le.y=ft(Le.y,-1+Wv,1-Wv);const ze=Le.toLngLat(),qe=x.project(ze.lng,ze.lat),ot=li.fromLngLat(ze);ot.x+=Wv;const ct=ot.toLngLat(),Re=x.project(ct.lng,ct.lat),tt=tP(Re.x-qe.x,Re.y-qe.y,we),ut=li.fromLngLat(ze);ut.y+=Wv;const Tt=ut.toLngLat(),ri=x.project(Tt.lng,Tt.lat),Xt=tP(ri.x-qe.x,ri.y-qe.y,we),si=Math.abs(tt.x)/Math.abs(Xt.y),Ci=te([]);Ie(Ci,Ci,-we*(1-(U?0:N)));const qi=te([]);return Se(qi,qi,[1,1-(1-si)*N,1]),qi[4]=-Xt.x/Xt.y*N,Ie(qi,qi,we),fe(qi,Ci,qi),qi}(c.projection,0,c.center,l,r),m=eP(c);return Se(u,u,[m,m,1]),u}function eP(c){const r=c.projection,l=cC(c.projection,c.zoom,c.width,c.height),u=Yk(r,c.center),m=Yk(r,et.convert(r.center));return Math.pow(2,u*l+(1-l)*m)}function cC(c,r,l,u,m=1/0){const x=c.range;if(!x)return 0;const w=Math.min(m,Math.max(l,u)),M=Math.log(w/1024)/Math.LN2;return Jt(x[0]+M,x[1]+M,r)}const Wv=1/4e4;function Yk(c,r){const l=ft(r.lat,-85.051129,Ki),u=new et(r.lng-180*Wv,l),m=new et(r.lng+180*Wv,l),x=c.project(u.lng,l),w=c.project(m.lng,l),M=li.fromLngLat(u),N=li.fromLngLat(m),U=w.x-x.x,K=w.y-x.y,ee=N.x-M.x,oe=N.y-M.y,me=Math.sqrt((ee*ee+oe*oe)/(U*U+K*K));return Math.log(me)/Math.LN2}function tP(c,r,l){const u=Math.cos(l),m=Math.sin(l);return{x:c*u-r*m,y:c*m+r*u}}function iP(c,r,l){te(c),Ie(c,c,Un(r[2])),ke(c,c,Un(r[0])),Ee(c,c,Un(r[1])),Se(c,c,l),fe(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function hC(c,r,l,u,m,x,w,M){const N=[l[0]-r[0],l[1]-r[1],0],U=[u[0]-r[0],u[1]-r[1],0];if(Ot(N)<1e-12||Ot(U)<1e-12)return pi(c);const K=rr([],N,U);Kt(K,K),bt(U,u,r),N[2]=(x-m)*M,U[2]=(w-m)*M;const ee=N;return rr(ee,N,U),Kt(ee,ee),gs(c,K,ee)}function Xk(c,r,l=!1){const u=Ef(r.zoom),m=function(x,w,M){const N=w.worldSize,U=[x[12],x[13],x[14]],K=Ei(U[1]/N),ee=qt(U[0]/N),oe=te([]),me=Wt(1,K)*N,we=Wt(1,0)*N*Er(K,w.zoom),Le=1/Bg(N);let ze=we*Le;if(M){const Re=cC(w.projection,w.zoom,w.width,w.height,1024);ze=Le*w.projection.pixelSpaceConversion(w.center.lat,N,Re)}const qe=Ne(K,ee);mt(qe,qe,ui([],Kt([],qe),me*ze*U[2]));const ot=function(Re){const tt=[Re[0],Re[1],Re[2]];let ut=[0,1,0];const Tt=rr([],ut,tt);return rr(ut,tt,Tt),ur(ut)===0&&(ut=[0,1,0],rr(Tt,tt,ut)),Kt(Tt,Tt),Kt(ut,ut),Kt(tt,tt),[Tt[0],Tt[1],Tt[2],0,ut[0],ut[1],ut[2],0,tt[0],tt[1],tt[2],0,Re[0],Re[1],Re[2],1]}(qe);Se(oe,oe,[ze,ze,ze*me]),le(oe,oe,[-U[0],-U[1],-U[2]]);const ct=fe([],w.globeMatrix,ot);return fe(ct,ct,oe),fe(ct,ct,x),ct}(c,r,l);if(u>0){const x=function(w,M){const N=M.worldSize,U=Wt(1,0)*N*Er(M.center.lat,M.zoom)/Bg(N),K=Wt(1,M.center.lat)*N,ee=te([]);return Ee(ee,ee,Un(M.center.lng)),ke(ee,ee,Un(M.center.lat)),le(ee,ee,[0,0,R]),Se(ee,ee,[U,U,U*K]),le(ee,ee,[M.point.x-.5*N,M.point.y-.5*N,0]),fe(ee,ee,w),fe(ee,M.globeMatrix,ee)}(c,r);return function(w,M,N){const U=(we,Le,ze)=>{const qe=Ot(we),ot=Ot(Le),ct=Qp(we,Le,ze);return ui(ct,ct,1/Ot(ct)*kn(qe,ot,ze))},K=U([w[0],w[1],w[2]],[M[0],M[1],M[2]],N),ee=U([w[4],w[5],w[6]],[M[4],M[5],M[6]],N),oe=U([w[8],w[9],w[10]],[M[8],M[9],M[10]],N),me=Qp([w[12],w[13],w[14]],[M[12],M[13],M[14]],N);return[K[0],K[1],K[2],0,ee[0],ee[1],ee[2],0,oe[0],oe[1],oe[2],0,me[0],me[1],me[2],1]}(m,x,u)}return m}function rP(c,r,l,u){const m=Fo.projectAabbCorners(u,l);let x=Number.MAX_VALUE,w=-1;for(let U=0;U<m.length;++U){const K=m[U];K[0]=(.5*K[0]+.5)*r.width,K[1]=(.5-.5*K[1])*r.height,K[2]<x&&(w=U,x=K[2])}const M=U=>new fr(m[U][0],m[U][1]);let N;switch(w){case 0:case 6:N=[M(1),M(5),M(4),M(7),M(3),M(2),M(1)];break;case 1:case 7:N=[M(0),M(4),M(5),M(6),M(2),M(3),M(0)];break;case 3:case 5:N=[M(1),M(0),M(4),M(7),M(6),M(2),M(1)];break;default:N=[M(1),M(5),M(6),M(7),M(3),M(0),M(1)]}if(su(c,N))return x}const $8=lo([{name:"a_pos_3f",components:3,type:"Float32"}]),V8=lo([{name:"a_color_3f",components:3,type:"Float32"}]),W8=lo([{name:"a_color_4f",components:4,type:"Float32"}]),j8=lo([{name:"a_uv_2f",components:2,type:"Float32"}]),H8=lo([{name:"a_normal_3f",components:3,type:"Float32"}]),G8=lo([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),q8=lo([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),nP={None:0,Model:1,Symbol:2,FillExtrusion:4};class uC{constructor(r,l,u,m){this.message=(r?`${r}: `:"")+u,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function Zk(c,r){const l=c.indexOf("://")===-1;try{return new URL(c,l&&r?"http://example.com":void 0),!0}catch{return!1}}class sP{constructor(r,l){this.feature=r,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class oP{constructor(){this.instancedDataArray=new sm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Kk{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs}updateFootprints(r,l){}populate(r,l,u,m){this.tileToMeter=$i(u);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:w,id:M,index:N,sourceLayerIndex:U}of r){const K=M??(w.properties&&w.properties.hasOwnProperty("id")?w.properties.id:void 0),ee=on(w,x);if(!this.layers[0]._featureFilter.filter(new sa(this.zoom,{worldview:this.worldview}),ee,u))continue;const oe={id:K,sourceLayerIndex:U,index:N,geometry:x?ee.geometry:pn(w,u,m),properties:w.properties,type:w.type,patterns:{}},me=this.addFeature(oe,oe.geometry,ee);me&&l.featureIndex.insert(w,oe.geometry,N,U,this.index,this.instancesPerModel[me].instancedDataArray.length,mr/32)}this.lookup=null}update(r,l,u,m){for(const x in this.instancesPerModel){const w=this.instancesPerModel[x];for(const M in r)w.idToFeaturesIndex.hasOwnProperty(M)&&(this.evaluate(w.features[w.idToFeaturesIndex[M]],r[M],w,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];for(const m of u.features){const x=this.layers[0],w=m.feature,M=this.canonical,N=x.paint.get("model-rotation").evaluate(w,{},M),U=x.paint.get("model-scale").evaluate(w,{},M),K=x.paint.get("model-translation").evaluate(w,{},M);nn(m.rotation,N)&&nn(m.scale,U)&&nn(m.translation,K)||(this.evaluate(m,m.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,l,u,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const x=l.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(_x(this.activeReplacements,x))return!1;this.activeReplacements=x;let w=!1;for(const M in this.instancesPerModel){const N=this.instancesPerModel[M],U=N.instancedDataArray;for(const K of N.features){const ee=K.instancedDataOffset,oe=K.instancedDataCount;for(let me=0;me<oe;me++){const we=16*(me+ee);let Le=U.float32[we+0];const ze=Le>mr;Le=ze?Le-mr:Le;const qe=Math.floor(Le),ot=U.float32[we+1];let ct=!1;for(const Re of this.activeReplacements)if(!V0(Re,u,nP.Model,m)&&!(Re.min.x>qe||qe>Re.max.x||Re.min.y>ot||ot>Re.max.y)&&(ct=wx(zu(qe,ot,r.canonical,Re.footprintTileId.canonical),Re.footprint),ct))break;U.float32[we]=ct?Le+mr:Le,w=w||ct!==ze}}}return w}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,G8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)r.removeModel(l,"",!0)}addFeature(r,l,u){const m=this.layers[0],x=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!x)return tn(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),x;(Zk(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new oP);const w=this.instancesPerModel[x],M=w.instancedDataArray,N=new sP(u,M.length);for(const U of l)for(const K of U){if(K.x<0||K.x>=mr||K.y<0||K.y>=mr)continue;const ee=(this.lookupDim-1)/mr,oe=this.lookupDim*(K.y*ee|0)+K.x*ee|0;if(this.lookup){if(this.lookup[oe]!==0)continue;this.lookup[oe]=1}this.instanceCount++;const me=M.length;M.resize(me+1),w.instancesEvaluatedElevation.push(0),M.float32[16*me]=K.x,M.float32[16*me+1]=K.y}return N.instancedDataCount=w.instancedDataArray.length-N.instancedDataOffset,N.instancedDataCount>0&&(r.id&&(w.idToFeaturesIndex[r.id]=w.features.length),w.features.push(N),this.evaluate(N,{},w,!1)),x}getModelUris(){return this.modelUris}evaluate(r,l,u,m){const x=this.layers[0],w=r.feature,M=this.canonical,N=r.rotation=x.paint.get("model-rotation").evaluate(w,l,M),U=r.scale=x.paint.get("model-scale").evaluate(w,l,M),K=r.translation=x.paint.get("model-translation").evaluate(w,l,M),ee=x.paint.get("model-color").evaluate(w,l,M);ee.a=x.paint.get("model-color-mix-intensity").evaluate(w,l,M);const oe=[];this.maxVerticalOffset<K[2]&&(this.maxVerticalOffset=K[2]),this.maxScale=Math.max(Math.max(this.maxScale,U[0]),Math.max(U[1],U[2])),iP(oe,N,U);const me=Math.round(100*ee.a)+ee.b/1.05;for(let we=0;we<r.instancedDataCount;++we){const Le=r.instancedDataOffset+we,ze=16*Le,qe=u.instancedDataArray.float32;let ot=0;m&&(ot=qe[ze+6]-u.instancesEvaluatedElevation[Le]);const ct=0|qe[ze+1];qe[ze]=(0|qe[ze])+ee.r/1.05,qe[ze+1]=ct+ee.g/1.05,qe[ze+2]=me,qe[ze+3]=1/(M.z>10?this.tileToMeter:$i(M,ct)),qe[ze+4]=K[0],qe[ze+5]=K[1],qe[ze+6]=K[2]+ot,qe[ze+7]=oe[0],qe[ze+8]=oe[1],qe[ze+9]=oe[2],qe[ze+10]=oe[4],qe[ze+11]=oe[5],qe[ze+12]=oe[6],qe[ze+13]=oe[8],qe[ze+14]=oe[9],qe[ze+15]=oe[10],u.instancesEvaluatedElevation[Le]=K[2]}}}let aP,lP;mn(Kk,"ModelBucket",{omit:["layers"]}),mn(oP,"PerModelAttributes"),mn(sP,"ModelFeature");const Ux=64,e1={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function cP(c,r,l,u,m,x,w,M,N,U=!1){const K=l.zoom,ee=l.project(u),oe=Er(u.lat,K),me=1/oe;te(c),le(c,c,[ee.x+w[0]*me,ee.y+w[1]*me,w[2]]);let we=1,Le=1;const ze=l.worldSize;if(U){if(l.projection.name==="mercator"){let Re=0;l.elevation&&(Re=l.elevation.getAtPointOrZero(new li(ee.x/ze,ee.y/ze),0));const tt=Nt([],[ee.x,ee.y,Re,1],l.projMatrix)[3]/l.cameraToCenterDistance;we=tt,Le=tt*Er(l.center.lat,K)}else if(l.projection.name==="globe"){const Re=Xk(c,l),tt=[0,0,0,1];Nt(tt,tt,fe([],l.projMatrix,Re));const ut=tt[3]/l.cameraToCenterDistance,Tt=Ef(K),ri=l.projection.pixelsPerMeter(u.lat,ze)*Er(u.lat,K),Xt=l.projection.pixelsPerMeter(l.center.lat,ze)*Er(l.center.lat,K);we=ut/kn(ri,Ji(l.center.lat),Tt),Le=ut*oe/ri,we*=Xt,Le*=Xt}}else we=me;Se(c,c,[we,we,Le]);const qe=[...c],ot=r.orientation,ct=[];if(iP(ct,[ot[0]+m[0],ot[1]+m[1],ot[2]+m[2]],x),fe(c,qe,ct),M&&l.elevation){let Re=0;const tt=[];if(N&&l.elevation){Re=function(Tt,ri,Xt,si,Ci){const qi=ri.elevation;if(!qi)return 0;const Fr=Fo.projectAabbCorners(Xt,si),gr=Wt(1,Ci.lat)*ri.worldSize,Rr=function(Wr,Ss){const En=[0,0,1],Dn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ss of Dn){const $s=Wr[ss.corners[0]],Rs=Wr[ss.corners[1]],no=Wr[ss.corners[2]],js=[Rs[0]-$s[0],Rs[1]-$s[1],Ss*(Rs[2]-$s[2])],so=rr(js,js,[no[0]-$s[0],no[1]-$s[1],Ss*(no[2]-$s[2])]);Kt(so,so),ss.dotProductWithUp=Ui(so,En)}return Dn.sort((ss,$s)=>ss.dotProductWithUp-$s.dotProductWithUp),Dn[0].corners}(Fr,gr),$r=Fr[Rr[0]],Zi=Fr[Rr[1]],Ir=Fr[Rr[2]],Hi=Fr[Rr[3]],Xi=qi.getAtPointOrZero(new li($r[0]/ri.worldSize,$r[1]/ri.worldSize),0),jr=qi.getAtPointOrZero(new li(Zi[0]/ri.worldSize,Zi[1]/ri.worldSize),0),Gr=qi.getAtPointOrZero(new li(Ir[0]/ri.worldSize,Ir[1]/ri.worldSize),0),Hn=qi.getAtPointOrZero(new li(Hi[0]/ri.worldSize,Hi[1]/ri.worldSize),0),Mn=(Xi+Hn)/2,hn=(jr+Gr)/2;return Mn>hn?jr<Gr?hC(Tt,Zi,Hi,$r,jr,Hn,Xi,gr):hC(Tt,Ir,$r,Hi,Gr,Xi,Hn,gr):Xi<Hn?hC(Tt,$r,Zi,Ir,Xi,jr,Gr,gr):hC(Tt,Hi,Ir,Zi,Hn,Gr,jr,gr),Math.max(Mn,hn)}(tt,l,r.aabb,c,u);const ut=fe([],lt([],tt),ct);fe(c,qe,ut)}else Re=l.elevation.getAtPointOrZero(new li(ee.x/ze,ee.y/ze),0);Re!==0&&(c[14]+=Re)}}function Vw(c,r,l=!1){c.uploaded||(c.gfxTexture=new Gk(r,c.image,l?r.gl.R8:r.gl.RGBA8,{useMipmap:c.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function Y8(c,r,l){c.indexBuffer=r.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=r.createVertexBuffer(c.vertexArray,$8.members,!1,!0),c.normalArray&&(c.normalBuffer=r.createVertexBuffer(c.normalArray,H8.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=r.createVertexBuffer(c.texcoordArray,j8.members,!1,!0)),c.colorArray&&(c.colorBuffer=r.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?V8:W8).members,!1,!0)),c.featureArray&&(c.pbrBuffer=r.createVertexBuffer(c.featureArray,q8.members,!0)),c.segments=nl.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&Vw(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Vw(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Vw(u.normalTexture,r),u.occlusionTexture&&Vw(u.occlusionTexture,r,l),u.emissionTexture&&Vw(u.emissionTexture,r)}function Qk(c,r,l){if(c.meshes)for(const u of c.meshes)Y8(u,r,l);if(c.children)for(const u of c.children)Qk(u,r,l)}function dC(c){if(c.meshes)for(const r of c.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(c.children)for(const r of c.children)dC(r)}function Jk(c){if(c.meshes)for(const l of c.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((r=l.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(c.children)for(const l of c.children)Jk(l)}class t1{constructor(r,l,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(r,l,u){const m=u||r.findDEMTileFor(l);if(!m||!m.dem)return;const x=m.dem,w=m.tileID,M=1<<l.canonical.z-w.canonical.z;return new t1(m,x.dim/mr/M,[(l.canonical.x/M-w.canonical.x)*x.dim,(l.canonical.y/M-w.canonical.y)*x.dim])}tileCoordToPixel(r,l){const u=l*this._scale+this._offset[1],m=Math.floor(r*this._scale+this._offset[0]),x=Math.floor(u);return new fr(m,x)}getElevationAt(r,l,u,m){const x=r*this._scale+this._offset[0],w=l*this._scale+this._offset[1],M=Math.floor(x),N=Math.floor(w),U=this._dem;return m=!!m,u?kn(kn(U.get(M,N,m),U.get(M,N+1,m),w-N),kn(U.get(M+1,N,m),U.get(M+1,N+1,m),w-N),x-M):U.get(M,N,m)}getElevationAtPixel(r,l,u){return this._dem.get(r,l,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Wt(1,r)*this._dem.stride}}const eA=new Float32Array(262144),$x=new Uint8Array(262144);function hP(c){let r=0;if(c.meshes)for(const l of c.meshes)r=Math.max(r,l.aabb.max[2]);if(c.children)for(const l of c.children)r=Math.max(r,hP(l));return r}function uP(c,r,l){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const m=Fo.applyTransform(u.aabb,c.matrix);l.insert(r,m.min[0],m.min[1],m.max[0],m.max[1])}if(c.children)for(const u of c.children)uP(u,r,l)}const dP=["","wall","door","roof","window","lamp","logo"];class pP{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:hP(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Fo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const l=new Fo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=Fo.applyTransformFast(u.aabb,this.node.matrix),l.encapsulate(u.transformedAabb)),r++;this.aabb=l}return this.aabb}}class pC{constructor(r,l,u,m,x,w,M,N){this.id=u,this.layers=r,this.layerIds=this.layers.map(U=>U.fqid),this.stateDependentLayerIds=this.layers.filter(U=>U.isStateDependent()).map(U=>U.id),this.modelTraits|=e1.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=e1.HasMapboxMeshFeatures),x&&(this.modelTraits|=e1.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=w,this.worldview=N,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const U of l)this.nodesInfo.push(new pP(U)),uP(U,M.featureIndexArray.length,M.grid),M.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,M.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(r,l){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&l.push({footprint:m.footprint,id:r})}}update(r){const l=Object.keys(r).length!==0;if(l&&!this.stateDependentLayers.length)return;const u=l?this.stateDependentLayers:this.layers;if(!tc(r,this.states))for(const m of u)this.evaluate(m,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const u of l){const m=u.node;this.uploaded?this.updatePbrBuffer(m):Qk(m,r,!0)}for(const u of l)dC(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let l=!1;if(!r.meshes)return l;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),l=!0);return l}needsReEvaluation(r,l,u){const m=r.transform.projectionOptions,x=r.style.getBrightness(),w=this.brightness!==x;if(!this.uploaded||this.dirty||m.name!==this.projection.name||Ww(u.paint.get("model-color").value,w)||Ww(u.paint.get("model-color-mix-intensity").value,w)||Ww(u.paint.get("model-roughness").value,w)||Ww(u.paint.get("model-emissive-strength").value,w)||Ww(u.paint.get("model-height-based-emissive-strength-multiplier").value,w)){this.projection=m,this.brightness=x;const M=this.getNodesInfo();for(const N of M)N.state=null;return!0}return!1}evaluateTransform(r,l){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const x of u){const w=x.feature;x.evaluatedTranslation=l.paint.get("model-translation").evaluate(w,{},m),x.evaluatedScale=l.paint.get("model-scale").evaluate(w,{},m)}}evaluate(r,l){const u=this.getNodesInfo();for(const m of u){if(!m.node.meshes)continue;const x=m.feature,w=l&&l[x.id];if(tc(w,m.state))continue;m.state=structuredClone(w);const M=m.node.meshes&&m.node.meshes[0].featureData,N=m.evaluatedColor[2],U=m.evaluatedRMEA[2],K=this.id.canonical;if(m.hasTranslucentParts=!1,M){for(let ee=0;ee<dP.length;ee++){const oe=dP[ee];oe.length&&(x.properties.part=oe);const me=r.paint.get("model-color").evaluate(x,w,K).toPremultipliedRenderColor(null),we=r.paint.get("model-color-mix-intensity").evaluate(x,w,K);m.evaluatedColor[ee]=[me.r,me.g,me.b,we],m.evaluatedRMEA[ee][0]=r.paint.get("model-roughness").evaluate(x,w,K),m.evaluatedRMEA[ee][2]=r.paint.get("model-emissive-strength").evaluate(x,w,K),m.evaluatedRMEA[ee][3]=me.a,m.emissionHeightBasedParams[ee]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,w,K),!m.hasTranslucentParts&&me.a<1&&(m.hasTranslucentParts=!0)}delete x.properties.part,Z8(m,N!==m.evaluatedColor[2]||U!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(x,w,K);m.evaluatedTranslation=r.paint.get("model-translation").evaluate(x,w,K),m.evaluatedScale=r.paint.get("model-scale").evaluate(x,w,K),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,l,u,m){const x=r.findDEMTileFor(u);if(x&&(x.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const w=t1.create(r,u,x);if(!w)return;this.modelTraits&e1.HasMapboxMeshFeatures&&this.updateDEM(r,w,u,m);for(const M of this.getNodesInfo()){const N=M.node;if(!N.footprint||!N.footprint.vertices||!N.footprint.vertices.length)continue;const U=N.footprint.vertices;let K=w.getElevationAt(U[0].x,U[0].y,!0,!0);for(let ee=1;ee<U.length;ee++)K=Math.min(K,w.getElevationAt(U[ee].x,U[ee].y,!0,!0));N.elevation=K}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=l}}updateDEM(r,l,u,m){let x=l._dem._modifiedForSources[m];if(x===void 0&&(l._dem._modifiedForSources[m]=[],x=l._dem._modifiedForSources[m]),x.includes(u.canonical))return;const w=l._dem.dim;x.push(u.canonical);let M=!1;for(const N of this.getNodesInfo()){const U=N.node;if(!U.footprint||!U.footprint.grid)continue;const K=U.footprint.grid,ee=l.tileCoordToPixel(K.min.x,K.min.y),oe=l.tileCoordToPixel(K.max.x,K.max.y),me=Math.min(Math.min(w-oe.y,ee.x),Math.min(ee.y,w-oe.x));if(me<0)continue;const we=ft(me,2,5);let Le=Math.max(0,ee.x-we),ze=Math.max(0,ee.y-we),qe=Math.min(oe.x+we,w-1),ot=Math.min(oe.y+we,w-1);for(let ut=ze;ut<=ot;++ut)for(let Tt=Le;Tt<=qe;++Tt)$x[ut*w+Tt]=255;let ct=0,Re=0;for(let ut=0;ut<K.cellsY;++ut)for(let Tt=0;Tt<K.cellsX;++Tt){if(!K.cells[ut*K.cellsX+Tt])continue;const ri=l.tileCoordToPixel(K.min.x+Tt/K.xScale,K.min.y+ut/K.yScale),Xt=l.tileCoordToPixel(K.min.x+(Tt+1)/K.xScale,K.min.y+(ut+1)/K.yScale);for(let si=ri.y;si<=Math.min(Xt.y+1,w-1);++si)for(let Ci=ri.x;Ci<=Math.min(Xt.x+1,w-1);++Ci)$x[si*w+Ci]===255&&($x[si*w+Ci]=0,ct+=l.getElevationAtPixel(Ci,si),Re++)}const tt=ct/Re;Le=Math.max(1,ee.x-we),ze=Math.max(1,ee.y-we),qe=Math.min(oe.x+we,w-2),ot=Math.min(oe.y+we,w-2),M=!0;for(let ut=ze;ut<=ot;++ut)for(let Tt=Le;Tt<=qe;++Tt)$x[ut*w+Tt]===0&&(eA[ut*w+Tt]=l._dem.set(Tt,ut,tt));for(let ut=1;ut<we;++ut){Le=Math.max(1,ee.x-ut),ze=Math.max(1,ee.y-ut),qe=Math.min(oe.x+ut,w-2),ot=Math.min(oe.y+ut,w-2);for(let Tt=ze;Tt<=ot;++Tt)for(let ri=Le;ri<=qe;++ri){const Xt=Tt*w+ri;if($x[Xt]===255){let si=0,Ci=0,qi=-1,Fr=-1;for(let gr=-1;gr<=1;++gr)for(let Rr=-1;Rr<=1;++Rr){const $r=(Tt+gr)*w+ri+Rr;if($x[$r]>=ut)continue;const Zi=eA[$r],Ir=Math.abs(Zi);Ir>Ci&&(si=Zi,Ci=Ir,qi=Rr,Fr=gr)}if(Ci>.1){const gr=1-(ut+.5*Math.abs(qi*Fr))/we;let Rr=l._dem.get(ri,Tt)+si*gr;const $r=l._dem.get(ri+qi,Tt+Fr),Zi=l._dem.get(ri-qi,Tt-Fr,!0);(Rr-$r)*(Rr-Zi)>0&&(Rr=($r+Zi)/2),eA[Xt]=l._dem.set(ri,Tt,Rr),$x[Xt]=ut}}}}}M&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=ch.now())}setFilter(r){this.filter=r?sy(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new sa(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const l of r)dC(l.node),Jk(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const u=l.getReplacementRegionsForTile(r.toUnwrapped());for(const m of this.getNodesInfo()){const x=m.node.footprint;m.hiddenByReplacement=!!x&&!u.find(w=>w.footprint===x)}}getHeightAtTileCoord(r,l){const u=[],m=[0,0,0],x=te([]);for(const w of this.getNodesInfo()){const M=w.node.meshes[0],N=M.transformedAabb;if(r<N.min[0]||l<N.min[1]||r>N.max[0]||l>N.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};he(x,w.node.matrix),m[0]=r,m[1]=l,Oi(m,m,x);const U=(m[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Ux|0,K=Math.min(63,(m[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Ux|0)*Ux+Math.min(63,U),ee=M.heightmap[K];if(!(ee<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:ee,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new fr(r,l),new fr(r,l),u),u.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Ww(c,r){return c instanceof Zf&&!c.isLightConstant&&r}function X8(c,r,l,u,m,x,w,M){let N=(61440&r|(61440&r)>>4)>>8,U=(3840&r|(3840&r)>>4)>>4,K=240&r|(240&r)>>4;l[3]>0&&(N=kn(N,255*l[0],l[3]),U=kn(U,255*l[1],l[3]),K=kn(K,255*l[2],l[3]));const ee=N<<8|U,oe=K<<8|Math.floor(255*u[3]),me=function(ut){const Tt=ft(ut,0,2);return Math.min(Math.round(.5*Tt*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],we=ft(m[0],0,1),Le=ft(m[1],0,1),ze=ft(m[2],0,1),qe=ft(m[3],0,1);let ot,ct,Re,tt;if(we!==Le&&w!==x&&Le!==we){const ut=w-x;ct=1/(ut*(Le-we)),Re=-(x+ut*we)/(ut*(Le-we));const Tt=ft(m[4],-1,1);tt=Math.pow(10,Tt),ot=255*ze<<8|255*qe}else ot=65535,ct=0,Re=1,tt=1;if(c.emplaceBack(ee,oe,me,ot,ct,Re,tt),M){const ut=M.length;M.clear();for(let Tt=0;Tt<ut;Tt++)M.emplaceBack(ee,oe,me,ot,ct,Re,tt)}}function Z8(c,r,l){const u=c.node;let m=0;const x=l&e1.HasMeshoptCompression;for(const w of u.meshes){if(u.lights&&u.lightMeshIndex===m||!w.featureData)continue;w.featureArray=new zm,w.featureArray.reserve(w.featureData.length);let M=r;for(const N of w.featureData){const U=x?65535&N:N>>16&65535,K=x?N>>16&65535:65535&N,ee=(15&K)<8?15&K:0,oe=c.evaluatedRMEA[ee],me=c.evaluatedColor[ee],we=c.emissionHeightBasedParams[ee];let Le;if(M&&ee===2&&u.lights&&(Le=new zm,Le.resize(10*u.lights.length)),X8(w.featureArray,U,me,oe,we,w.aabb.min[2],w.aabb.max[2],Le),Le&&M){M=!1;const ze=u.meshes[u.lightMeshIndex];ze.featureArray=Le,ze.featureArray._trim()}}w.featureArray._trim(),m++}}function fP(c,r,l,u){const m=1<<c.z;r.lat=Ei((u/mr+c.y)/m),r.lng=qt((l/mr+c.x)/m)}function K8(c,r,l,u){const m=c.getNodesInfo()[r];if(!m||m.hiddenByReplacement||!m.node.meshes)return;let x=Number.MAX_VALUE;const w=m.node,M=l.tile,N=u.calculatePosMatrix(M.tileID.toUnwrapped(),u.worldSize),U=m.evaluatedScale;let K=0;u.elevation&&w.elevation&&(K=w.elevation*u.elevation.exaggeration()),le(N,N,[(w.anchor?w.anchor[0]:0)*(U[0]-1),(w.anchor?w.anchor[1]:0)*(U[1]-1),K]),Se(N,N,U);const ee=l.queryGeometry,oe=ee.isPointQuery()?ee.screenBounds:ee.screenGeometry,me=function(Le){const ze=fe([],N,Le.matrix);fe(ze,u.expandedFarZProjMatrix,ze);for(let qe=0;qe<Le.meshes.length;++qe){const ot=Le.meshes[qe];if(qe===Le.lightMeshIndex)continue;const ct=rP(oe,u,ze,ot.aabb);ct!=null&&(x=Math.min(ct,x))}if(Le.children)for(const qe of Le.children)me(qe)};if(me(w),x===Number.MAX_VALUE)return;const we=new et(0,0);return fP(M.tileID.canonical,we,m.node.anchor[0],m.node.anchor[1]),{intersectionZ:x,position:we,feature:m.feature}}mn(pC,"Tiled3dModelBucket",{omit:["layers"]}),mn(pP,"Tiled3dModelFeature");const Q8={circle:class extends th{constructor(c,r,l,u){super(c,{layout:hv||(hv=new ha({"circle-sort-key":new cn(wi.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Wi(wi.layout_circle["circle-elevation-reference"]),visibility:new Wi(wi.layout_circle.visibility)})),paint:F0||(F0=new ha({"circle-radius":new cn(wi.paint_circle["circle-radius"]),"circle-color":new cn(wi.paint_circle["circle-color"]),"circle-blur":new cn(wi.paint_circle["circle-blur"]),"circle-opacity":new cn(wi.paint_circle["circle-opacity"]),"circle-translate":new Wi(wi.paint_circle["circle-translate"]),"circle-translate-anchor":new Wi(wi.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wi(wi.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wi(wi.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new cn(wi.paint_circle["circle-stroke-width"]),"circle-stroke-color":new cn(wi.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new cn(wi.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Wi(wi.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u)}createBucket(c){return new nu(c)}queryRadius(c){const r=c;return Og("circle-radius",this,r)+Og("circle-stroke-width",this,r)+B0(this.paint.get("circle-translate"))}queryIntersectsFeature(c,r,l,u,m,x,w,M){const N=qy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),U=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return _v(c,u,x,w,M,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",N,U)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,r,l){const u=M_(this);return{config:new Wm(this,{zoom:r,lut:l}),defines:u,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends th{createBucket(c){return new bv(c)}constructor(c,r,l,u){super(c,{layout:wv||(wv=new ha({visibility:new Wi(wi.layout_heatmap.visibility)})),paint:ld||(ld=new ha({"heatmap-radius":new cn(wi.paint_heatmap["heatmap-radius"]),"heatmap-weight":new cn(wi.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wi(wi.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Jf(wi.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wi(wi.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ae({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Og("heatmap-radius",this,c)}queryIntersectsFeature(c,r,l,u,m,x,w,M){const N=this.paint.get("heatmap-radius").evaluate(r,l);return _v(c,u,x,w,M,!0,!0,new fr(0,0),N)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,r,l){return c==="heatmap"?{config:new Wm(this,{zoom:r,lut:l}),overrideFog:!1}:{}}},hillshade:class extends th{constructor(c,r,l,u){super(c,{layout:ve||(ve=new ha({visibility:new Wi(wi.layout_hillshade.visibility)})),paint:v||(v=new ha({"hillshade-illumination-direction":new Wi(wi.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wi(wi.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wi(wi.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wi(wi.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wi(wi.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wi(wi.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Wi(wi.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,r,l){return{overrideFog:!1}}},fill:class extends th{constructor(c,r,l,u){super(c,{layout:L_||(L_=new ha({"fill-sort-key":new cn(wi.layout_fill["fill-sort-key"]),visibility:new Wi(wi.layout_fill.visibility),"fill-elevation-reference":new Wi(wi.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new cn(wi.layout_fill["fill-construct-bridge-guard-rail"])})),paint:D_||(D_=new ha({"fill-antialias":new Wi(wi.paint_fill["fill-antialias"]),"fill-opacity":new cn(wi.paint_fill["fill-opacity"]),"fill-color":new cn(wi.paint_fill["fill-color"]),"fill-outline-color":new cn(wi.paint_fill["fill-outline-color"]),"fill-translate":new Wi(wi.paint_fill["fill-translate"]),"fill-translate-anchor":new Wi(wi.paint_fill["fill-translate-anchor"]),"fill-pattern":new cn(wi.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Wi(wi.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Wi(wi.paint_fill["fill-emissive-strength"]),"fill-z-offset":new cn(wi.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new cn(wi.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new cn(wi.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),r=c&&c.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(c,r,l){return{config:new Wm(this,{zoom:r,lut:l}),overrideFog:!1}}recalculate(c,r){super.recalculate(c,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new qm(c)}queryRadius(){return B0(this.paint.get("fill-translate"))}queryIntersectsFeature(c,r,l,u,m,x){return!c.queryGeometry.isAboveHorizon&&ad(Gy(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?r&&!c:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends th{constructor(c,r,l,u){super(c,{layout:a0||(a0=new ha({visibility:new Wi(wi["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Wi(wi["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Lb||(Lb=new ha({"fill-extrusion-opacity":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new cn(wi["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cn(wi["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new cn(wi["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new cn(wi["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new cn(wi["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new cn(wi["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new cn(wi["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new cn(wi["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Wi(wi["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new G0(c)}queryRadius(){return B0(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,r,l,u,m,x,w,M,N){const U=qy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),K=this.paint.get("fill-extrusion-height").evaluate(r,l),ee=this.paint.get("fill-extrusion-base").evaluate(r,l),oe=[0,0],me=M&&x.elevation,we=x.elevation?x.elevation.exaggeration():1,Le=c.tile.getBucket(this);if(me&&Le instanceof G0){const Re=Le.centroidVertexArray,tt=N+1;tt<Re.length&&(oe[0]=Re.geta_centroid_pos0(tt),oe[1]=Re.geta_centroid_pos1(tt))}if(oe[0]===0&&oe[1]===1)return!1;x.projection.name==="globe"&&(u=Mb([u],[new fr(0,0),new fr(mr,mr)],c.tileID.canonical).map(Re=>Re.polygon).flat());const ze=me?M:null,[qe,ot]=function(Re,tt,ut,Tt,ri,Xt,si,Ci,qi,Fr,gr){return Re.projection.name==="globe"?function(Rr,$r,Zi,Ir,Hi,Xi,jr,Gr,Hn,Mn,hn){const Wr=[],Ss=[],En=Rr.projection.upVectorScale(hn,Rr.center.lat,Rr.worldSize).metersToTile,Dn=[0,0,0,1],ss=[0,0,0,1],$s=(no,js,so,Pa)=>{no[0]=js,no[1]=so,no[2]=Pa,no[3]=1},Rs=Sy();Zi>0&&(Zi+=Rs),Ir+=Rs;for(const no of $r){const js=[],so=[];for(const Pa of no){const _l=Pa.x+Hi.x,yt=Pa.y+Hi.y,Mt=Rr.projection.projectTilePoint(_l,yt,hn),ir=Rr.projection.upVector(hn,Pa.x,Pa.y);let Zr=Zi,un=Ir;if(jr){const an=Ob(_l,yt,Zi,Ir,jr,Gr,Hn,Mn);Zr+=an.base,un+=an.top}Zi!==0?$s(Dn,Mt.x+ir[0]*En*Zr,Mt.y+ir[1]*En*Zr,Mt.z+ir[2]*En*Zr):$s(Dn,Mt.x,Mt.y,Mt.z),$s(ss,Mt.x+ir[0]*En*un,Mt.y+ir[1]*En*un,Mt.z+ir[2]*En*un),Oi(Dn,Dn,Xi),Oi(ss,ss,Xi),js.push(new Ty(Dn[0],Dn[1],Dn[2])),so.push(new Ty(ss[0],ss[1],ss[2]))}Wr.push(js),Ss.push(so)}return[Wr,Ss]}(Re,tt,ut,Tt,ri,Xt,si,Ci,qi,Fr,gr):si?function(Rr,$r,Zi,Ir,Hi,Xi,jr,Gr,Hn){const Mn=[],hn=[],Wr=[0,0,0,1];for(const Ss of Rr){const En=[],Dn=[];for(const ss of Ss){const $s=ss.x+Ir.x,Rs=ss.y+Ir.y,no=Ob($s,Rs,$r,Zi,Xi,jr,Gr,Hn);Wr[0]=$s,Wr[1]=Rs,Wr[2]=no.base,Wr[3]=1,Nt(Wr,Wr,Hi),Wr[3]=Math.max(Wr[3],1e-5);const js=new Ty(Wr[0]/Wr[3],Wr[1]/Wr[3],Wr[2]/Wr[3]);Wr[0]=$s,Wr[1]=Rs,Wr[2]=no.top,Wr[3]=1,Nt(Wr,Wr,Hi),Wr[3]=Math.max(Wr[3],1e-5);const so=new Ty(Wr[0]/Wr[3],Wr[1]/Wr[3],Wr[2]/Wr[3]);En.push(js),Dn.push(so)}Mn.push(En),hn.push(Dn)}return[Mn,hn]}(tt,ut,Tt,ri,Xt,si,Ci,qi,Fr):function(Rr,$r,Zi,Ir,Hi){const Xi=[],jr=[],Gr=Hi[8]*$r,Hn=Hi[9]*$r,Mn=Hi[10]*$r,hn=Hi[11]*$r,Wr=Hi[8]*Zi,Ss=Hi[9]*Zi,En=Hi[10]*Zi,Dn=Hi[11]*Zi;for(const ss of Rr){const $s=[],Rs=[];for(const no of ss){const js=no.x+Ir.x,so=no.y+Ir.y,Pa=Hi[0]*js+Hi[4]*so+Hi[12],_l=Hi[1]*js+Hi[5]*so+Hi[13],yt=Hi[2]*js+Hi[6]*so+Hi[14],Mt=Hi[3]*js+Hi[7]*so+Hi[15],ir=Pa+Gr,Zr=_l+Hn,un=yt+Mn,an=Math.max(Mt+hn,1e-5),Sn=Pa+Wr,rs=_l+Ss,go=yt+En,yo=Math.max(Mt+Dn,1e-5);$s.push(new Ty(ir/an,Zr/an,un/an)),Rs.push(new Ty(Sn/yo,rs/yo,go/yo))}Xi.push($s),jr.push(Rs)}return[Xi,jr]}(tt,ut,Tt,ri,Xt)}(x,u,ee,K,U,w,ze,oe,we,x.center.lat,c.tileID.canonical),ct=c.queryGeometry;return function(Re,tt,ut){let Tt=1/0;ad(ut,tt)&&(Tt=Ex(ut,tt[0]));for(let ri=0;ri<tt.length;ri++){const Xt=tt[ri],si=Re[ri];for(let Ci=0;Ci<Xt.length-1;Ci++){const qi=Xt[Ci],Fr=[qi,Xt[Ci+1],si[Ci+1],si[Ci],qi];su(ut,Fr)&&(Tt=Math.min(Tt,Ex(ut,Fr)))}}return Tt!==1/0&&Tt}(qe,ot,ct.isPointQuery()?ct.screenBounds:ct.screenGeometry)}},building:class extends th{constructor(c,r,l,u){super(c,{layout:Ox||(Ox=new ha({visibility:new Wi(wi.layout_building.visibility),"building-roof-shape":new cn(wi.layout_building["building-roof-shape"]),"building-height":new cn(wi.layout_building["building-height"]),"building-base":new cn(wi.layout_building["building-base"])})),paint:Fb||(Fb=new ha({"building-opacity":new Wi(wi.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Wi(wi.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Wi(wi.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Wi(wi.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Wi(wi.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Wi(wi.paint_building["building-vertical-scale"]),"building-cast-shadows":new Wi(wi.paint_building["building-cast-shadows"]),"building-color":new cn(wi.paint_building["building-color"]),"building-emissive-strength":new cn(wi.paint_building["building-emissive-strength"]),"building-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Ov(c)}},line:class extends th{constructor(c,r,l,u){const m=zo();super(c,m,r,l,u),m.layout&&(this.layout=new Md(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof _g,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,r){super.recalculate(c,r),this.paint._values["line-floorwidth"]=(()=>{if(Xa)return Xa;const l=zo();return Xa=new al(l.paint.properties["line-width"].specification),Xa.useIntegerZoom=!0,Xa})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Qt(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,r,l){const u=Gs(this);return{config:new Wm(this,{zoom:r,lut:l}),defines:u,overrideFog:!1}}queryRadius(c){const r=c,l=Tp(Og("line-width",this,r),Og("line-gap-width",this,r)),u=Og("line-offset",this,r);return l/2+Math.abs(u)+B0(this.paint.get("line-translate"))}queryIntersectsFeature(c,r,l,u,m,x){if(c.queryGeometry.isAboveHorizon)return!1;const w=Gy(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),M=c.pixelToTileUnitsFactor/2*Tp(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),N=this.paint.get("line-offset").evaluate(r,l);return N&&(u=function(U,K){const ee=[],oe=new fr(0,0);for(let me=0;me<U.length;me++){const we=U[me],Le=[];for(let ze=0;ze<we.length;ze++){const qe=we[ze],ot=we[ze+1],ct=ze===0?oe:qe.sub(we[ze-1])._unit()._perp(),Re=ze===we.length-1?oe:ot.sub(qe)._unit()._perp(),tt=ct._add(Re)._unit();tt._mult(1/(tt.x*Re.x+tt.y*Re.y)),Le.push(tt._mult(K)._add(qe))}ee.push(Le)}return ee}(u,N*c.pixelToTileUnitsFactor)),function(U,K,ee){for(let oe=0;oe<K.length;oe++){const me=K[oe];if(U.length>=3){for(let we=0;we<me.length;we++)if(ep(U,me[we]))return!0}if(Jd(U,me,ee))return!0}return!1}(w,u,M)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Q0,background:class extends th{constructor(c,r,l,u){super(c,{layout:u0||(u0=new ha({visibility:new Wi(wi.layout_background.visibility)})),paint:J0||(J0=new ha({"background-pitch-alignment":new Wi(wi.paint_background["background-pitch-alignment"]),"background-color":new Wi(wi.paint_background["background-color"]),"background-pattern":new Wi(wi.paint_background["background-pattern"]),"background-opacity":new Wi(wi.paint_background["background-opacity"]),"background-emissive-strength":new Wi(wi.paint_background["background-emissive-strength"]),"background-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,r,l){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:GD,"raster-particle":QD,sky:class extends th{constructor(c,r,l,u){super(c,{layout:XD||(XD=new ha({visibility:new Wi(wi.layout_sky.visibility)})),paint:ZD||(ZD=new ha({"sky-type":new Wi(wi.paint_sky["sky-type"]),"sky-atmosphere-sun":new Wi(wi.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Wi(wi.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Wi(wi.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Wi(wi.paint_sky["sky-gradient-radius"]),"sky-gradient":new Jf(wi.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Wi(wi.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Wi(wi.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Wi(wi.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ae({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(c,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),m=!u,x=c.style.light,w=x.properties.get("position");return m&&x.properties.get("anchor")==="viewport"&&tn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?qk(w.azimuthal,90-w.polar,r):qk(u[0],90-u[1],r)}const l=this.paint.get("sky-gradient-center");return qk(l[0],90-l[1],r)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends th{constructor(c,r,l,u){super(c,{paint:KD||(KD=new ha({}))},r,null)}},model:class extends th{constructor(c,r,l,u){super(c,{layout:aP||(aP=new ha({visibility:new Wi(wi.layout_model.visibility),"model-id":new cn(wi.layout_model["model-id"])})),paint:lP||(lP=new ha({"model-opacity":new cn(wi.paint_model["model-opacity"]),"model-rotation":new cn(wi.paint_model["model-rotation"]),"model-scale":new cn(wi.paint_model["model-scale"]),"model-translation":new cn(wi.paint_model["model-translation"]),"model-color":new cn(wi.paint_model["model-color"]),"model-color-mix-intensity":new cn(wi.paint_model["model-color-mix-intensity"]),"model-type":new Wi(wi.paint_model["model-type"]),"model-cast-shadows":new Wi(wi.paint_model["model-cast-shadows"]),"model-receive-shadows":new Wi(wi.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Wi(wi.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new cn(wi.paint_model["model-emissive-strength"]),"model-roughness":new cn(wi.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new cn(wi.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Wi(wi.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Wi(wi.paint_model["model-front-cutoff"]),"model-color-use-theme":new cn({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Kk(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof pC?mr-1:0}queryIntersectsFeature(c,r,l,u,m,x){if(!this.modelManager)return!1;const w=this.modelManager,M=c.tile.getBucket(this);if(!(M&&M instanceof Kk))return!1;for(const N in M.instancesPerModel){const U=M.instancesPerModel[N],K=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(U.idToFeaturesIndex.hasOwnProperty(K)){const ee=U.features[U.idToFeaturesIndex[K]],oe=w.getModel(N,this.scope);if(!oe)return!1;let me=Q();const we=new et(0,0),Le=M.canonical;let ze=Number.MAX_VALUE;for(let qe=0;qe<ee.instancedDataCount;++qe){const ot=16*(ee.instancedDataOffset+qe),ct=U.instancedDataArray.float32,Re=[ct[ot+4],ct[ot+5],ct[ot+6]];fP(Le,we,ct[ot],0|ct[ot+1]),cP(me,oe,x,we,ee.rotation,ee.scale,Re,!1,!1,!1),x.projection.name==="globe"&&(me=Xk(me,x));const tt=fe([],x.projMatrix,me),ut=c.queryGeometry,Tt=rP(ut.isPointQuery()?ut.screenBounds:ut.screenGeometry,x,tt,oe.aabb);Tt!=null&&(ze=Math.min(Tt,ze))}return ze!==Number.MAX_VALUE&&ze}}return!1}_handleOverridablePaintPropertyUpdate(c,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const r=this._transitionablePaint._values[c];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof gl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends th{constructor(c,r,l,u){super(c,{layout:i0||(i0=new ha({"clip-layer-types":new Wi(wi.layout_clip["clip-layer-types"]),"clip-layer-scope":new Wi(wi.layout_clip["clip-layer-scope"])})),paint:P_||(P_=new ha({}))},r,l,u)}recalculate(c,r){super.recalculate(c,r)}createBucket(c){return new O_(c)}is3D(c){return!0}}},tA=new ao(0,0,0),iA={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},rA={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},fC={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},J8={PAINT_ORDER_FILL_AND_STROKE:1},jw={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},mP={MASK_TYPE_LUMINANCE:1};function eV(c,r,l){c===1&&r.icons.push(function(u,m){return function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:w}=x;if(w.content_area){const{content_area:M}=w;M.top==null&&(M.top=M.left),M.width==null&&(M.width=x.usvg_tree.width),M.height==null&&(M.height=M.width)}return w.stretch_x&&w.stretch_x.length&&gP(w,"x"),w.stretch_y&&w.stretch_y.length&&gP(w,"y"),x}(u.readFields(tV,{name:void 0},m))}(l,l.readVarint()+l.pos))}function gP(c,r){const l=[],u=c[`stretch_${r}`];let m=null;for(let x=0;x<u.length;x++)m===null?m=l.length===0?u[0]:l[l.length-1][1]+u[x]:(l.push([m,m+u[x]]),m=null);c[`stretch_${r}_areas`]=l}function tV(c,r,l){c===1?r.name=l.readString():c===2?r.metadata=function(u,m){return u.readFields(iV,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(l,l.readVarint()+l.pos):c===3&&(r.usvg_tree=function(u,m){return u.readFields(sV,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(l,l.readVarint()+l.pos),r.data="usvg_tree")}function iV(c,r,l){c===1?r.stretch_x=l.readPackedVarint():c===2?r.stretch_y=l.readPackedVarint():c===3?r.content_area=function(u,m){return u.readFields(rV,{left:0},m)}(l,l.readVarint()+l.pos):c===4&&r.variables.push(function(u,m){return u.readFields(nV,{name:void 0},m)}(l,l.readVarint()+l.pos))}function rV(c,r,l){c===1?r.left=l.readVarint():c===2?r.width=l.readVarint():c===3?r.top=l.readVarint():c===4&&(r.height=l.readVarint())}function nV(c,r,l){c===1?r.name=l.readString():c===2&&(r.rgb_color=yC(l.readVarint()),r.value="rgb_color")}function sV(c,r,l){c===1?r.width=r.height=l.readVarint():c===2?r.height=l.readVarint():c===3?r.children.push(mC(l,l.readVarint()+l.pos)):c===4?r.linear_gradients.push(function(u,m){return u.readFields(dV,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(l,l.readVarint()+l.pos)):c===5?r.radial_gradients.push(function(u,m){return u.readFields(fV,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(l,l.readVarint()+l.pos)):c===7?r.clip_paths.push(function(u,m){return u.readFields(mV,{children:[]},m)}(l,l.readVarint()+l.pos)):c===8&&r.masks.push(function(u,m){const x=u.readFields(gV,{left:0,width:20,mask_type:mP.MASK_TYPE_LUMINANCE,children:[]},m);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x}(l,l.readVarint()+l.pos))}function mC(c,r){return c.readFields(oV,{},r)}function oV(c,r,l){c===1?(r.group=function(u,m){return u.readFields(aV,{opacity:255,children:[]},m)}(l,l.readVarint()+l.pos),r.node="group"):c===2&&(r.path=function(u,m){return u.readFields(cV,{paint_order:1,commands:[],step:1,diffs:[],rule:iA.PATH_RULE_NON_ZERO},m)}(l,l.readVarint()+l.pos),r.node="path")}function aV(c,r,l){c===1?r.transform=gC(l,l.readVarint()+l.pos):c===2?r.opacity=l.readVarint():c===5?r.clip_path_idx=l.readVarint():c===6?r.mask_idx=l.readVarint():c===7&&r.children.push(mC(l,l.readVarint()+l.pos))}function gC(c,r){return c.readFields(lV,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function lV(c,r,l){c===1?r.sx=l.readFloat():c===2?r.ky=l.readFloat():c===3?r.kx=l.readFloat():c===4?r.sy=l.readFloat():c===5?r.tx=l.readFloat():c===6&&(r.ty=l.readFloat())}function cV(c,r,l){c===1?r.fill=function(u,m){return u.readFields(hV,{rgb_color:tA,paint:"rgb_color",opacity:255},m)}(l,l.readVarint()+l.pos):c===2?r.stroke=function(u,m){return u.readFields(uV,{rgb_color:tA,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(l,l.readVarint()+l.pos):c===3?r.paint_order=l.readVarint():c===5?l.readPackedVarint(r.commands):c===6?r.step=l.readFloat():c===7?l.readPackedSVarint(r.diffs):c===8&&(r.rule=l.readVarint())}function hV(c,r,l){c===1?(r.rgb_color=yC(l.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=l.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=l.readVarint(),r.paint="radial_gradient_idx"):c===5&&(r.opacity=l.readVarint())}function yC(c){return new ao((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function uV(c,r,l){c===1?(r.rgb_color=yC(l.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=l.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=l.readVarint(),r.paint="radial_gradient_idx"):c===5?l.readPackedFloat(r.dasharray):c===6?r.dashoffset=l.readFloat():c===7?r.miterlimit=l.readFloat():c===8?r.opacity=l.readVarint():c===9?r.width=l.readFloat():c===10?r.linecap=l.readVarint():c===11&&(r.linejoin=l.readVarint())}function dV(c,r,l){c===1?r.transform=gC(l,l.readVarint()+l.pos):c===2?r.spread_method=l.readVarint():c===3?r.stops.push(yP(l,l.readVarint()+l.pos)):c===4?r.x1=l.readFloat():c===5?r.y1=l.readFloat():c===6?r.x2=l.readFloat():c===7&&(r.y2=l.readFloat())}function yP(c,r){return c.readFields(pV,{offset:0,opacity:255,rgb_color:tA},r)}function pV(c,r,l){c===1?r.offset=l.readFloat():c===2?r.opacity=l.readVarint():c===3&&(r.rgb_color=yC(l.readVarint()))}function fV(c,r,l){c===1?r.transform=gC(l,l.readVarint()+l.pos):c===2?r.spread_method=l.readVarint():c===3?r.stops.push(yP(l,l.readVarint()+l.pos)):c===4?r.cx=l.readFloat():c===5?r.cy=l.readFloat():c===6?r.r=l.readFloat():c===7?r.fx=l.readFloat():c===8?r.fy=l.readFloat():c===9&&(r.fr=l.readFloat())}function mV(c,r,l){c===1?r.transform=gC(l,l.readVarint()+l.pos):c===2?r.clip_path_idx=l.readVarint():c===3&&r.children.push(mC(l,l.readVarint()+l.pos))}function gV(c,r,l){c===1?r.left=r.top=l.readFloat():c===2?r.width=r.height=l.readFloat():c===3?r.top=l.readFloat():c===4?r.height=l.readFloat():c===5?r.mask_type=l.readVarint():c===6?r.mask_idx=l.readVarint():c===7&&r.children.push(mC(l,l.readVarint()+l.pos))}class yV{static calculate(r={},l=[]){const u=new Map,m=new Map;if(Object.keys(r).length===0)return u;l.forEach(x=>{m.set(x.name,x.rgb_color||new ao(0,0,0))});for(const[x,w]of Object.entries(r))m.has(x)?u.set(m.get(x).toString(),w):console.warn(`Ignoring unknown image variable "${x}"`);return u}}function i1(c,r=255,l){const u=r/255,m=c.toString(),x=l.has(m)?l.get(m).clone():c.clone();return x.a*=u,x.toString()}function Hw(c,r){if(!_u()){const l=document.createElement("canvas");return l.width=c,l.height=r,l}return new OffscreenCanvas(c,r)}function _V(c,r){const l=yV.calculate(r.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,m=u.width,x=u.height,w=r.transform?r.transform:new DOMMatrix,M=Math.max(1,Math.round(m*w.a)),N=Math.max(1,Math.round(x*w.d)),U=new DOMMatrix([M/m,0,0,N/x,0,0]),K=Hw(M,N).getContext("2d");return nA(K,U,u,u,l),K.getImageData(0,0,M,N)}function nA(c,r,l,u,m){for(const x of u.children)_P(c,r,l,x,m)}function _P(c,r,l,u,m){u.group?(c.save(),function(x,w,M,N,U){const K=N.mask_idx!=null?M.masks[N.mask_idx]:null,ee=N.clip_path_idx!=null?M.clip_paths[N.clip_path_idx]:null;if(N.transform&&(w=r1(N.transform).preMultiplySelf(w)),!function(we,Le,ze){return we.opacity!==255||Le||ze}(N,ee!=null,K!=null))return void nA(x,w,M,N,U);const oe=Hw(x.canvas.width,x.canvas.height),me=oe.getContext("2d");nA(me,w,M,N,U),ee&&CP(me,w,M,ee),K&&EP(me,w,M,K,U),x.globalAlpha=N.opacity/255,x.drawImage(oe,0,0)}(c,r,l,u.group,m),c.restore()):u.path&&(c.save(),function(x,w,M,N,U){x.setTransform(w),N.paint_order===J8.PAINT_ORDER_FILL_AND_STROKE?(vP(x,M,N,U),bP(x,M,N,U)):(bP(x,M,N,U),vP(x,M,N,U))}(c,r,l,u.path,m),c.restore())}function vP(c,r,l,u){const m=l.fill;if(!m)return;const x=m.opacity/255;switch(c.save(),c.beginPath(),kP(l,c),m.paint){case"rgb_color":c.fillStyle=i1(m.rgb_color,m.opacity,u);break;case"linear_gradient_idx":{const w=r.linear_gradients[m.linear_gradient_idx];w.transform&&c.setTransform(r1(w.transform).preMultiplySelf(c.getTransform())),c.fillStyle=wP(c,w,x,u);break}case"radial_gradient_idx":{const w=r.radial_gradients[m.radial_gradient_idx];w.transform&&c.setTransform(r1(w.transform).preMultiplySelf(c.getTransform())),c.fillStyle=SP(c,w,x,u)}}c.fill(xP(l)),c.restore()}function xP(c){return c.rule===iA.PATH_RULE_NON_ZERO?"nonzero":c.rule===iA.PATH_RULE_EVEN_ODD?"evenodd":void 0}function bP(c,r,l,u){const m=l.stroke;if(!m)return;const x=AP(l);c.lineWidth=m.width,c.miterLimit=m.miterlimit,c.setLineDash(m.dasharray),c.lineDashOffset=m.dashoffset;const w=m.opacity/255;switch(m.paint){case"rgb_color":c.strokeStyle=i1(m.rgb_color,m.opacity,u);break;case"linear_gradient_idx":c.strokeStyle=wP(c,r.linear_gradients[m.linear_gradient_idx],w,u,!0);break;case"radial_gradient_idx":c.strokeStyle=SP(c,r.radial_gradients[m.radial_gradient_idx],w,u,!0)}switch(m.linejoin){case fC.LINE_JOIN_MITER_CLIP:case fC.LINE_JOIN_MITER:c.lineJoin="miter";break;case fC.LINE_JOIN_ROUND:c.lineJoin="round";break;case fC.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(m.linecap){case rA.LINE_CAP_BUTT:c.lineCap="butt";break;case rA.LINE_CAP_ROUND:c.lineCap="round";break;case rA.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(x)}function wP(c,r,l,u,m=!1){if(r.stops.length===1){const oe=r.stops[0];return i1(oe.rgb_color,oe.opacity*l,u)}const{x1:x,y1:w,x2:M,y2:N}=r;let U=new DOMPoint(x,w),K=new DOMPoint(M,N);if(m){const oe=r1(r.transform);U=oe.transformPoint(U),K=oe.transformPoint(K)}const ee=c.createLinearGradient(U.x,U.y,K.x,K.y);for(const oe of r.stops)ee.addColorStop(oe.offset,i1(oe.rgb_color,oe.opacity*l,u));return ee}function SP(c,r,l,u,m=!1){if(r.stops.length===1){const qe=r.stops[0];return i1(qe.rgb_color,qe.opacity*l,u)}const x=r1(r.transform),{fx:w,fy:M,fr:N,cx:U,cy:K,r:ee}=r;let oe=new DOMPoint(w,M),me=new DOMPoint(U,K),we=N,Le=ee;if(m){oe=x.transformPoint(oe),me=x.transformPoint(me);const qe=(x.a+x.d)/2;we=N*qe,Le=r.r*qe}const ze=c.createRadialGradient(oe.x,oe.y,we,me.x,me.y,Le);for(const qe of r.stops)ze.addColorStop(qe.offset,i1(qe.rgb_color,qe.opacity*l,u));return ze}function TP(c,r,l,u){const m=u.transform?r1(u.transform).preMultiplySelf(r):r,x=Hw(c.canvas.width,c.canvas.height),w=x.getContext("2d");for(const N of u.children)if(N.group)TP(w,m,l,N.group);else if(N.path){const U=N.path,K=new Path2D;K.addPath(AP(U),m),w.fill(K,xP(U))}const M=u.clip_path_idx!=null?l.clip_paths[u.clip_path_idx]:null;M&&CP(w,m,l,M),c.globalCompositeOperation="source-over",c.drawImage(x,0,0)}function CP(c,r,l,u){const m=Hw(c.canvas.width,c.canvas.height);TP(m.getContext("2d"),r,l,u),c.globalCompositeOperation="destination-in",c.drawImage(m,0,0)}function EP(c,r,l,u,m){if(u.children.length===0)return;const x=u.mask_idx!=null?l.masks[u.mask_idx]:null;x&&EP(c,r,l,x,m);const w=c.canvas.width,M=c.canvas.height,N=Hw(w,M),U=N.getContext("2d"),K=u.width,ee=u.height,oe=u.left,me=u.top,we=new Path2D,Le=new Path2D;Le.rect(oe,me,K,ee),we.addPath(Le,r),U.clip(we);for(const ot of u.children)_P(U,r,l,ot,m);const ze=U.getImageData(0,0,w,M),qe=ze.data;if(u.mask_type===mP.MASK_TYPE_LUMINANCE)for(let ot=0;ot<qe.length;ot+=4)qe[ot+3]=qe[ot+3]/255*(.2126*qe[ot]+.7152*qe[ot+1]+.0722*qe[ot+2]);U.putImageData(ze,0,0),c.globalCompositeOperation="destination-in",c.drawImage(N,0,0)}function r1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function kP(c,r){const l=c.step;let u=c.diffs[0]*l,m=c.diffs[1]*l;r.moveTo(u,m);for(let x=0,w=2;x<c.commands.length;x++)switch(c.commands[x]){case jw.PATH_COMMAND_MOVE:u+=c.diffs[w++]*l,m+=c.diffs[w++]*l,r.moveTo(u,m);break;case jw.PATH_COMMAND_LINE:u+=c.diffs[w++]*l,m+=c.diffs[w++]*l,r.lineTo(u,m);break;case jw.PATH_COMMAND_QUAD:{const M=u+c.diffs[w++]*l,N=m+c.diffs[w++]*l;u=M+c.diffs[w++]*l,m=N+c.diffs[w++]*l,r.quadraticCurveTo(M,N,u,m);break}case jw.PATH_COMMAND_CUBIC:{const M=u+c.diffs[w++]*l,N=m+c.diffs[w++]*l,U=M+c.diffs[w++]*l,K=N+c.diffs[w++]*l;u=U+c.diffs[w++]*l,m=K+c.diffs[w++]*l,r.bezierCurveTo(M,N,U,K,u,m);break}case jw.PATH_COMMAND_CLOSE:r.closePath()}return r}function AP(c){return kP(c,new Path2D)}class _C{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const l=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,l),l}put(r,l){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,l)}delete(r){this.cache.delete(r)}}mn(_C,"LRUCache");class sA{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Y(r,r.data)}getFromCache(r,l,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new _C(150)),this.cacheMap.get(u).get(vp(r.toString(),l))}setInCache(r,l,u,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new _C(150));const x=this.cacheDependenciesMap.get(m),w=vp(r.id.toString(),u);x.get(w)||x.set(w,new Set);const M=this.cacheMap.get(m),N=r.toString();x.get(w).add(N),M.put(vp(r.toString(),u),l)}removeImagesFromCacheByIds(r,l,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const m=this.cacheMap.get(u),x=this.cacheDependenciesMap.get(u);for(const w of r){const M=vp(w.toString(),l);if(x.has(M)){for(const N of x.get(M))m.delete(N);x.delete(M)}}}rasterize(r,l,u,m,x=_V){const w=this.getFromCache(r,u,m);if(w)return w.clone();const M=x(l.icon,r.options),N=sA._getImage(M);return this.setInCache(r,N,u,m),N.clone()}}class MP{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const u=this.toIdx(r,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function IP(c,r,l,u){let m=0,x=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(u[w])<1e-15){if(l[w]<c[w]||l[w]>r[w])return null}else{const M=1/u[w];let N=(c[w]-l[w])*M,U=(r[w]-l[w])*M;if(N>U){const K=N;N=U,U=K}if(N>m&&(m=N),U<x&&(x=U),m>x)return null}return m}function LP(c,r,l,u,m,x,w,M,N,U,K){const ee=u-c,oe=m-r,me=x-l,we=w-c,Le=M-r,ze=N-l,qe=K[1]*ze-K[2]*Le,ot=K[2]*we-K[0]*ze,ct=K[0]*Le-K[1]*we,Re=ee*qe+oe*ot+me*ct;if(Math.abs(Re)<1e-15)return null;const tt=1/Re,ut=U[0]-c,Tt=U[1]-r,ri=U[2]-l,Xt=(ut*qe+Tt*ot+ri*ct)*tt;if(Xt<0||Xt>1)return null;const si=Tt*me-ri*oe,Ci=ri*ee-ut*me,qi=ut*oe-Tt*ee,Fr=(K[0]*si+K[1]*Ci+K[2]*qi)*tt;return Fr<0||Xt+Fr>1?null:(we*si+Le*Ci+ze*qi)*tt}function DP(c,r,l){return(c-r)/(l-r)}function PP(c,r,l,u,m,x,w,M,N){const U=1<<l,K=x-u,ee=w-m,oe=(c+1)/U*K+u,me=(r+0)/U*ee+m,we=(r+1)/U*ee+m;M[0]=(c+0)/U*K+u,M[1]=me,N[0]=oe,N[1]=we}class OP{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(x){const w=Math.ceil(Math.log2(x.dim/8)),M=[];let N=Math.ceil(Math.pow(2,w));const U=1/N,K=(me,we,Le,ze,qe)=>{const ot=ze?1:0,ct=(me+1)*Le-ot,Re=we*Le,tt=(we+1)*Le-ot;qe[0]=me*Le,qe[1]=Re,qe[2]=ct,qe[3]=tt};let ee=new MP(N);const oe=[];for(let me=0;me<N*N;me++){K(me%N,Math.floor(me/N),U,!1,oe);const we=jv(oe[0],oe[1],x),Le=jv(oe[2],oe[1],x),ze=jv(oe[2],oe[3],x),qe=jv(oe[0],oe[3],x);ee.minimums.push(Math.min(we,Le,ze,qe)),ee.maximums.push(Math.max(we,Le,ze,qe)),ee.leaves.push(1)}for(M.push(ee),N/=2;N>=1;N/=2){const me=M[M.length-1];ee=new MP(N);for(let we=0;we<N*N;we++){K(we%N,Math.floor(we/N),2,!0,oe);const Le=me.getElevation(oe[0],oe[1]),ze=me.getElevation(oe[2],oe[1]),qe=me.getElevation(oe[2],oe[3]),ot=me.getElevation(oe[0],oe[3]),ct=me.isLeaf(oe[0],oe[1]),Re=me.isLeaf(oe[2],oe[1]),tt=me.isLeaf(oe[2],oe[3]),ut=me.isLeaf(oe[0],oe[3]),Tt=Math.min(Le.min,ze.min,qe.min,ot.min),ri=Math.max(Le.max,ze.max,qe.max,ot.max),Xt=ct&&Re&&tt&&ut;ee.maximums.push(ri),ee.minimums.push(Tt),ee.leaves.push(ri-Tt<=5&&Xt?1:0)}M.push(ee)}return M}(this.dem),u=l.length-1,m=l[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(r,l,u,m,x,w,M=1){return IP([r,l,-100],[u,m,this.maximums[0]*M],x,w)}raycast(r,l,u,m,x,w,M=1){if(!this.nodeCount)return null;const N=this.raycastRoot(r,l,u,m,x,w,M);if(N==null)return null;const U=[],K=[],ee=[],oe=[],me=[{idx:0,t:N,nodex:0,nodey:0,depth:0}];for(;me.length>0;){const{idx:we,t:Le,nodex:ze,nodey:qe,depth:ot}=me.pop();if(this.leaves[we]){PP(ze,qe,ot,r,l,u,m,ee,oe);const Re=1<<ot,tt=(ze+0)/Re,ut=(ze+1)/Re,Tt=(qe+0)/Re,ri=(qe+1)/Re,Xt=jv(tt,Tt,this.dem)*M,si=jv(ut,Tt,this.dem)*M,Ci=jv(ut,ri,this.dem)*M,qi=jv(tt,ri,this.dem)*M,Fr=LP(ee[0],ee[1],Xt,oe[0],ee[1],si,oe[0],oe[1],Ci,x,w),gr=LP(oe[0],oe[1],Ci,ee[0],oe[1],qi,ee[0],ee[1],Xt,x,w),Rr=Math.min(Fr!==null?Fr:Number.MAX_VALUE,gr!==null?gr:Number.MAX_VALUE);if(Rr!==Number.MAX_VALUE)return Rr;{const $r=Vt([],x,w,Le);if(RP(Xt,si,qi,Ci,DP($r[0],ee[0],oe[0]),DP($r[1],ee[1],oe[1]))>=$r[2])return Le}continue}let ct=0;for(let Re=0;Re<this._siblingOffset.length;Re++){PP((ze<<1)+this._siblingOffset[Re][0],(qe<<1)+this._siblingOffset[Re][1],ot+1,r,l,u,m,ee,oe),ee[2]=-100,oe[2]=this.maximums[this.childOffsets[we]+Re]*M;const tt=IP(ee,oe,x,w);if(tt!=null){const ut=tt;U[Re]=ut;let Tt=!1;for(let ri=0;ri<ct&&!Tt;ri++)ut>=U[K[ri]]&&(K.splice(ri,0,Re),Tt=!0);Tt||(K[ct]=Re),ct++}}for(let Re=0;Re<ct;Re++){const tt=K[Re];me.push({idx:this.childOffsets[we]+tt,t:U[tt],nodex:(ze<<1)+this._siblingOffset[tt][0],nodey:(qe<<1)+this._siblingOffset[tt][1],depth:ot+1})}}return null}_addNode(r,l,u){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,u,m,x){if(r[m].isLeaf(l,u)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const w=m-1,M=r[w];let N=0,U=0;for(let K=0;K<this._siblingOffset.length;K++){const ee=2*l+this._siblingOffset[K][0],oe=2*u+this._siblingOffset[K][1],me=M.getElevation(ee,oe),we=M.isLeaf(ee,oe),Le=this._addNode(me.min,me.max,we);we&&(N|=1<<K),U||(U=Le)}for(let K=0;K<this._siblingOffset.length;K++)N&1<<K||this._construct(r,2*l+this._siblingOffset[K][0],2*u+this._siblingOffset[K][1],w,U+K)}}function RP(c,r,l,u,m,x){return kn(kn(c,l,x),kn(r,u,x),m)}function jv(c,r,l){const u=l.dim,m=ft(c*u-.5,0,u-1),x=ft(r*u-.5,0,u-1),w=Math.floor(m),M=Math.floor(x),N=Math.min(w+1,u-1),U=Math.min(M+1,u-1);return RP(l.get(w,M),l.get(N,M),l.get(w,U),l.get(N,U),m-w,x-M)}const vV={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xV(c,r,l){return(256*c*256+256*r+l)/10-1e4}function bV(c,r,l){return 256*c+r+l/256-32768}class vC{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,u,m=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void tn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const x=this.dim=l.height-2,w=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let N=0;N<x;N++)w[this._idx(-1,N)]=w[this._idx(0,N)],w[this._idx(x,N)]=w[this._idx(x-1,N)],w[this._idx(N,-1)]=w[this._idx(N,0)],w[this._idx(N,x)]=w[this._idx(N,x-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(x,-1)]=w[this._idx(x-1,0)],w[this._idx(-1,x)]=w[this._idx(0,x-1)],w[this._idx(x,x)]=w[this._idx(x-1,x-1)]}const M=u==="terrarium"?bV:xV;for(let N=0;N<w.length;++N){const U=4*N;this.floatView[N]=M(this.pixels[U],this.pixels[U+1],this.pixels[U+2])}this._timestamp=ch.now()}_buildQuadTree(){this._tree=new OP(this)}get(r,l,u=!1){u&&(r=ft(r,-1,this.dim),l=ft(l,-1,this.dim));const m=this._idx(r,l);return this.floatView[m]}set(r,l,u){const m=this._idx(r,l),x=this.floatView[m];return this.floatView[m]=u,u-x}static getUnpackVector(r){return vV[r]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const u=[0,0,0,0],m=vC.getUnpackVector(l);let x=Math.floor((r+m[3])/m[2]);return u[2]=x%256,x=Math.floor(x/256),u[1]=x%256,x=Math.floor(x/256),u[0]=x,u}getPixels(){return new J({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,x=l*this.dim+this.dim,w=u*this.dim,M=u*this.dim+this.dim;switch(l){case-1:m=x-1;break;case 1:x=m+1}switch(u){case-1:w=M-1;break;case 1:M=w+1}const N=-l*this.dim,U=-u*this.dim;for(let K=w;K<M;K++)for(let ee=m;ee<x;ee++){const oe=4*this._idx(ee,K),me=4*this._idx(ee+N,K+U);this.pixels[oe+0]=r.pixels[me+0],this.pixels[oe+1]=r.pixels[me+1],this.pixels[oe+2]=r.pixels[me+2],this.pixels[oe+3]=r.pixels[me+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function wV(c,r,l){c===1?r.headerLength=l.readFixed32():c===2?r.x=l.readVarint():c===3?r.y=l.readVarint():c===4?r.z=l.readVarint():c===5&&r.layers.push(function(u,m){return u.readFields(kV,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(l,l.readVarint()+l.pos))}function SV(c,r,l){c===1?(r.delta_filter=function(u,m){return u.readFields(TV,{blockSize:0},m)}(l,l.readVarint()+l.pos),r.filter="delta_filter"):c===2?(l.readVarint(),r.filter="zigzag_filter"):c===3?(l.readVarint(),r.filter="bitshuffle_filter"):c===4&&(l.readVarint(),r.filter="byteshuffle_filter")}function TV(c,r,l){c===1&&(r.blockSize=l.readVarint())}function CV(c,r,l){c===1?(l.readVarint(),r.codec="gzip_data"):c===2?(l.readVarint(),r.codec="jpeg_image"):c===3?(l.readVarint(),r.codec="webp_image"):c===4&&(l.readVarint(),r.codec="png_image")}function EV(c,r,l){let u=0,m=0;c===1?r.firstByte=l.readFixed64():c===2?r.lastByte=l.readFixed64():c===3?r.filters.push(function(x,w){return x.readFields(SV,{},w)}(l,l.readVarint()+l.pos)):c===4?r.codec=function(x,w){return x.readFields(CV,{},w)}(l,l.readVarint()+l.pos):c===5?m=l.readFloat():c===6?u=l.readFloat():c===7?r.bands.push(l.readString()):c===8?r.offset=l.readDouble():c===9&&(r.scale=l.readDouble()),r.offset===0&&(r.offset=m),r.scale===0&&(r.scale=u)}function kV(c,r,l){c===1?r.version=l.readVarint():c===2?r.name=l.readString():c===3?r.units=l.readString():c===4?r.tileSize=l.readVarint():c===5?r.buffer=l.readVarint():c===6?r.pixelFormat=l.readVarint():c===7&&r.dataIndex.push(function(u,m){return u.readFields(EV,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(l,l.readVarint()+l.pos))}function AV(c,r,l){if(c===2)(function(u,m,x){u.readFields(MV,x,m)})(l,l.readVarint()+l.pos,r);else if(c===3)throw new Error("Not implemented")}function MV(c,r,l){if(c===1){let u=0;const m=l.readVarint()+l.pos;for(;l.pos<m;)r[u++]=l.readVarint()}}function IV(c,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let l=r[3];for(let u=2;u>=1;u--){const m=u===1?1:0,x=u===2?1:0;for(let w=0;w<r[0];w++){const M=r[1]*w;for(let N=m;N<r[1];N++){const U=r[2]*(N+M);for(let K=x;K<r[2];K++){const ee=r[3]*(K+U);for(let oe=0;oe<r[3];oe++){const me=ee+oe;c[me]+=c[me-l]}}}}l*=r[u]}return c}function LV(c){for(let r=0,l=c.length;r<l;r++)c[r]=c[r]>>>1^-(1&c[r]);return c}function DV(c,r){switch(r){case"uint32":return c;case"uint16":for(let l=0;l<c.length;l+=2){const u=c[l],m=c[l+1];c[l]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[l+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let l=0;l<c.length;l+=4){const u=c[l],m=c[l+1],x=c[l+2],w=c[l+3];c[l+0]=(192&u)>>6|(192&m)>>4|(192&x)>>2|192&w,c[l+1]=(48&u)>>4|(48&m)>>2|48&x|(48&w)<<2,c[l+2]=(12&u)>>2|12&m|(12&x)<<2|(12&w)<<4,c[l+3]=3&u|(3&m)<<2|(3&x)<<4|(3&w)<<6}return c;default:throw new Error(`Invalid pixel format, "${r}"`)}}mn(vC,"DEMData"),mn(OP,"DemMinMaxQuadTree",{omit:["dem"]});var Wg=Uint8Array,Gw=Uint16Array,PV=Int32Array,NP=new Wg([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),BP=new Wg([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OV=new Wg([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),FP=function(c,r){for(var l=new Gw(31),u=0;u<31;++u)l[u]=r+=1<<c[u-1];var m=new PV(l[30]);for(u=1;u<30;++u)for(var x=l[u];x<l[u+1];++x)m[x]=x-l[u]<<5|u;return{b:l,r:m}},zP=FP(NP,2),UP=zP.b,RV=zP.r;UP[28]=258,RV[258]=28;for(var NV=FP(BP,0).b,$P=new Gw(32768),Yh=0;Yh<32768;++Yh){var n1=(43690&Yh)>>1|(21845&Yh)<<1;$P[Yh]=((65280&(n1=(61680&(n1=(52428&n1)>>2|(13107&n1)<<2))>>4|(3855&n1)<<4))>>8|(255&n1)<<8)>>1}var qw=function(c,r,l){for(var u=c.length,m=0,x=new Gw(r);m<u;++m)c[m]&&++x[c[m]-1];var w,M=new Gw(r);for(m=1;m<r;++m)M[m]=M[m-1]+x[m-1]<<1;w=new Gw(1<<r);var N=15-r;for(m=0;m<u;++m)if(c[m])for(var U=m<<4|c[m],K=r-c[m],ee=M[c[m]-1]++<<K,oe=ee|(1<<K)-1;ee<=oe;++ee)w[$P[ee]>>N]=U;return w},Yw=new Wg(288);for(Yh=0;Yh<144;++Yh)Yw[Yh]=8;for(Yh=144;Yh<256;++Yh)Yw[Yh]=9;for(Yh=256;Yh<280;++Yh)Yw[Yh]=7;for(Yh=280;Yh<288;++Yh)Yw[Yh]=8;var VP=new Wg(32);for(Yh=0;Yh<32;++Yh)VP[Yh]=5;var BV=qw(Yw,9),FV=qw(VP,5),oA=function(c){for(var r=c[0],l=1;l<c.length;++l)c[l]>r&&(r=c[l]);return r},d0=function(c,r,l){var u=r/8|0;return(c[u]|c[u+1]<<8)>>(7&r)&l},aA=function(c,r){var l=r/8|0;return(c[l]|c[l+1]<<8|c[l+2]<<16)>>(7&r)},zV=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p0=function(c,r,l){var u=new Error(r||zV[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,p0),!l)throw u;return u},UV=new Wg(0),$V=typeof TextDecoder<"u"&&new TextDecoder;try{$V.decode(UV,{stream:!0})}catch{}const VV={gzip_data:"gzip"};class ky extends Error{constructor(r){super(r),this.name="MRTError"}}const WV={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},WP={uint32:1,uint16:2,uint8:4},jV={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let lA;class xC{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const l=this.layers[r];if(!l)throw new ky(`Layer '${r}' not found`);return l}getHeaderLength(r){const l=new Uint8Array(r),u=new DataView(r);if(l[0]!==13)throw new ky("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const l=new Uint8Array(r),u=this.getHeaderLength(r);if(l.length<u)throw new ky(`Expected header with length >= ${u} but got buffer of length ${l.length}`);const m=function(x,w){return x.readFields(wV,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new lA(l.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new ky(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const x of m.layers)this.layers[x.name]=new jP(x,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const l=[],u=this.getLayer(r.layerName);for(let m of r.blockIndices){const x=u.dataIndex[m],w=x.firstByte-r.firstByte,M=x.lastByte-r.firstByte;if(u._blocksInProgress.has(m))continue;const N={layerName:u.name,firstByte:w,lastByte:M,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[x.bands.length].concat(u.bandShape),buffer:u.buffer,codec:x.codec.codec,filters:x.filters.map(U=>U.filter)};u._blocksInProgress.add(m),l.push(N)}return new HP(l,()=>{l.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,x)=>{if(l.forEach(w=>u._blocksInProgress.delete(w.blockIndex)),m)throw m;x.forEach(w=>{this.getLayer(w.layerName).processDecodedData(w)})})}}class jP{constructor({version:r,name:l,units:u,tileSize:m,pixelFormat:x,buffer:w,dataIndex:M},N){if(this.version=r,this.version!==1)throw new ky(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=l,this.units=u,this.tileSize=m,this.buffer=w,this.pixelFormat=WV[x],this.dataIndex=M,this.bandShape=[m+2*w,m+2*w,WP[this.pixelFormat]],this._decodedBlocks=new _C(N?N.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return WP[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const l=r.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,r.data)}getBlockForBand(r){let l=0;switch(typeof r){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[x,w]of m.bands.entries())if(w===r)return{bandIndex:l+x,blockIndex:u,blockBandIndex:x};l+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(r>=l&&r<l+m.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-l};l+=m.bands.length}break;default:throw new ky(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let l=1/0,u=-1/0;const m=[],x=new Set;for(const w of r){const{blockIndex:M}=this.getBlockForBand(w);if(M<0)throw new ky(`Invalid band: ${JSON.stringify(w)}`);const N=this.dataIndex[M];m.includes(M)||m.push(M),x.add(M),l=Math.min(l,N.firstByte),u=Math.max(u,N.lastByte)}if(x.size>this.cacheSize)throw new ky(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:u,blockIndices:m}}hasBand(r){const{blockIndex:l}=this.getBlockForBand(r);return l>=0}hasDataForBand(r){const{blockIndex:l}=this.getBlockForBand(r);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(r){const{blockIndex:l,blockBandIndex:u}=this.getBlockForBand(r);if(l<0)throw new ky(`Band not found: ${JSON.stringify(r)}`);const m=this._decodedBlocks.get(l.toString());if(!m)throw new ky(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[l],w=this.bandShape.reduce((U,K)=>U*K,1),M=u*w,N=m.subarray(M,M+w);return{data:N,bytes:new Uint8Array(N.buffer).subarray(N.byteOffset,N.byteOffset+N.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}xC.setPbf=function(c){lA=c};class HP{constructor(r,l,u){this.tasks=r,this._onCancel=l,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,l){this._finalized||(this._onComplete(r,l),this._finalized=!0)}}function Vx(c,r){const l=c.json.bufferViews[r.bufferView],u=U_[r.componentType];return new u(c.buffers[l.buffer],(r.byteOffset||0)+(l.byteOffset||0),r.count*(l.byteStride&&l.byteStride!==Jp[r.type]*u.BYTES_PER_ELEMENT?l.byteStride/u.BYTES_PER_ELEMENT:Jp[r.type]))}function cA(c,r,l,u){const m=U_[r.componentType],x=function(K){switch(K){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),w=c.json.bufferViews[r.bufferView],M=w.byteStride?w.byteStride/m.BYTES_PER_ELEMENT:Jp[r.type],N=l.float32,U=N.length/l.capacity;for(let K=0,ee=0;K<r.count*M;K+=M,ee+=U)for(let oe=0;oe<U;oe++)N[ee+oe]=u[K+oe]*x;l._trim()}function HV(c,r,l){const u=c.indices,m=c.attributes,x={};x.indexArray=new Ac;const w=r.json.accessors[u],M=w.count/3;x.indexArray.reserve(M);const N=Vx(r,w);for(let oe=0;oe<M;oe++)x.indexArray.emplaceBack(N[3*oe],N[3*oe+1],N[3*oe+2]);x.indexArray._trim(),x.vertexArray=new Wc;const U=r.json.accessors[m.POSITION];x.vertexArray.reserve(U.count);const K=Vx(r,U);for(let oe=0;oe<U.count;oe++)x.vertexArray.emplaceBack(K[3*oe],K[3*oe+1],K[3*oe+2]);if(x.vertexArray._trim(),x.aabb=new Fo(U.min,U.max),x.centroid=function(oe,me){const we=[0,0,0],Le=oe.length;if(Le>0){for(let ze=0;ze<Le;ze++){const qe=3*oe[ze];we[0]+=me[qe],we[1]+=me[qe+1],we[2]+=me[qe+2]}we[0]/=Le,we[1]/=Le,we[2]/=Le}return we}(N,K),m.COLOR_0!==void 0){const oe=r.json.accessors[m.COLOR_0],me=Jp[oe.type],we=Vx(r,oe);x.colorArray=me===3?new Wc:new Pl,x.colorArray.resize(oe.count),cA(r,oe,x.colorArray,we)}if(m.NORMAL!==void 0){x.normalArray=new Wc;const oe=r.json.accessors[m.NORMAL];x.normalArray.resize(oe.count);const me=Vx(r,oe);cA(r,oe,x.normalArray,me)}if(m.TEXCOORD_0!==void 0&&l.length>0){x.texcoordArray=new rh;const oe=r.json.accessors[m.TEXCOORD_0];x.texcoordArray.resize(oe.count);const me=Vx(r,oe);cA(r,oe,x.texcoordArray,me)}if(m._FEATURE_ID_RGBA4444!==void 0){const oe=r.json.accessors[m._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=Vx(r,oe))}m._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(Vx(r,r.json.accessors[m._FEATURE_RGBA4444]).buffer));const ee=c.material;return x.material=function(oe,me){const{emissiveFactor:we=[0,0,0],alphaMode:Le="OPAQUE",alphaCutoff:ze=.5,normalTexture:qe,occlusionTexture:ot,emissiveTexture:ct,doubleSided:Re}=oe,{baseColorFactor:tt=[1,1,1,1],metallicFactor:ut=1,roughnessFactor:Tt=1,baseColorTexture:ri,metallicRoughnessTexture:Xt}=oe.pbrMetallicRoughness||{},si=ot?me[ot.index]:void 0;if(ot&&ot.extensions&&ot.extensions.KHR_texture_transform&&si){const Ci=ot.extensions.KHR_texture_transform;si.offsetScale=[Ci.offset[0],Ci.offset[1],Ci.scale[0],Ci.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ao(...tt),metallicFactor:ut,roughnessFactor:Tt,baseColorTexture:ri?me[ri.index]:void 0,metallicRoughnessTexture:Xt?me[Xt.index]:void 0},doubleSided:Re,emissiveFactor:new ao(...we),alphaMode:Le,alphaCutoff:ze,normalTexture:qe?me[qe.index]:void 0,occlusionTexture:si,emissionTexture:ct?me[ct.index]:void 0,defined:oe.defined===void 0}}(ee!==void 0?r.json.materials[ee]:{defined:!1},l),x}function GP(c,r,l){const{matrix:u,rotation:m,translation:x,scale:w,mesh:M,extras:N,children:U}=c,K={};if(K.matrix=u||function(ee,oe,me,we){var Le=oe[0],ze=oe[1],qe=oe[2],ot=oe[3],ct=Le+Le,Re=ze+ze,tt=qe+qe,ut=Le*ct,Tt=Le*Re,ri=Le*tt,Xt=ze*Re,si=ze*tt,Ci=qe*tt,qi=ot*ct,Fr=ot*Re,gr=ot*tt,Rr=we[0],$r=we[1],Zi=we[2];return ee[0]=(1-(Xt+Ci))*Rr,ee[1]=(Tt+gr)*Rr,ee[2]=(ri-Fr)*Rr,ee[3]=0,ee[4]=(Tt-gr)*$r,ee[5]=(1-(ut+Ci))*$r,ee[6]=(si+qi)*$r,ee[7]=0,ee[8]=(ri+Fr)*Zi,ee[9]=(si-qi)*Zi,ee[10]=(1-(ut+Xt))*Zi,ee[11]=0,ee[12]=me[0],ee[13]=me[1],ee[14]=me[2],ee[15]=1,ee}([],m||[0,0,0,1],x||[0,0,0],w||[1,1,1]),M!==void 0){K.meshes=l[M];const ee=K.anchor=[0,0];for(const oe of K.meshes){const{min:me,max:we}=oe.aabb;ee[0]+=me[0]+we[0],ee[1]+=me[1]+we[1]}ee[0]=Math.floor(ee[0]/K.meshes.length/2),ee[1]=Math.floor(ee[1]/K.meshes.length/2)}if(N&&(N.id&&(K.id=N.id),N.lights&&(K.lights=function(ee){if(!ee.length)return[];const oe=function(qe){const ot=atob(qe),ct=new Uint8Array(ot.length);for(let Re=0;Re<ot.length;Re++)ct[Re]=ot.codePointAt(Re);return ct}(ee),me=[],we=oe.length/24,Le=new Uint16Array(oe.buffer),ze=new Float32Array(oe.buffer);for(let qe=0;qe<we;qe++){const ot=Le[2*qe*6]/30,ct=Le[2*qe*6+1]/30,Re=Le[2*qe*6+10]/100,tt=ze[6*qe+1],ut=ze[6*qe+2],Tt=ze[6*qe+3],ri=ze[6*qe+4],Xt=Tt-tt,si=ri-ut,Ci=Math.hypot(Xt,si);me.push({pos:[tt+.5*Xt,ut+.5*si,ct],normal:[si/Ci,-Xt/Ci,0],width:Ci,height:ot,depth:Re,points:[tt,ut,Tt,ri]})}return me}(N.lights))),U){const ee=[];for(const oe of U)ee.push(GP(r.json.nodes[oe],r,l));K.children=ee}return K}function GV(c){if(c.vertices.length===0||c.indices.length===0)return null;const r=new gx(c.vertices,c.indices,8,256),[l,u]=[r.min.clone(),r.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:r,min:l,max:u}}function qV(c){if(!c.extras||!c.extras.ground)return null;const r=c.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const l=r[0];if(!l||!Array.isArray(l)||l.length===0)return null;const u=[];for(const w of l){if(!Array.isArray(w)||w.length!==2)continue;const M=w[0],N=w[1];typeof M=="number"&&typeof N=="number"&&u.push(new fr(M,N))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let w=0;w<u.length;w++){const M=u[w],N=u[(w+1)%u.length],U=u[(w+2)%u.length];m+=(M.x-N.x)*(U.y-N.y)-(U.x-N.x)*(M.y-N.y)}m>0&&u.reverse();const x=je(u.flatMap(w=>[w.x,w.y]),[]);return x.length===0?null:{vertices:u,indices:x}}function YV(c,r){const l=[],u=[];let m=0;const x=[];for(const w of c){m=l.length;const M=w.vertexArray.float32,N=w.indexArray.uint16;for(let U=0;U<w.vertexArray.length;U++)x[0]=M[3*U+0],x[1]=M[3*U+1],x[2]=M[3*U+2],Oi(x,x,r),l.push(new fr(x[0],x[1]));for(let U=0;U<3*w.indexArray.length;U++)u.push(N[U]+m)}if(u.length%3!=0)return null;for(let w=0;w<u.length;w+=3){const M=l[u[w+0]],N=l[u[w+1]],U=l[u[w+2]];(M.x-N.x)*(U.y-N.y)-(U.x-N.x)*(M.y-N.y)>0&&([u[w+1],u[w+2]]=[u[w+2],u[w+1]])}return{vertices:l,indices:u}}function qP(c){const r=function(N,U){const K=[],ee=WebGL2RenderingContext;if(N.json.textures)for(const oe of N.json.textures){const me={magFilter:ee.LINEAR,minFilter:ee.NEAREST,wrapS:ee.REPEAT,wrapT:ee.REPEAT};oe.sampler!==void 0&&Object.assign(me,N.json.samplers[oe.sampler]),K.push({image:U[oe.source],sampler:me,uploaded:!1})}return K}(c,c.images),l=function(N,U){const K=[];for(const ee of N.json.meshes){const oe=[];for(const me of ee.primitives)oe.push(HV(me,N,U));K.push(oe)}return K}(c,r),{scenes:u,scene:m,nodes:x}=c.json,w=u?u[m||0].nodes:x,M=[];for(const N of w)M.push(GP(x[N],c,l));return function(N,U,K){const ee={},oe=new Set;for(let me=0;me<N.length;me++){const we=K[U[me]];if(!we.extras)continue;const Le=we.extras["mapbox:footprint:version"],ze=we.extras["mapbox:footprint:id"];(Le||ze)&&oe.add(me),Le==="1.0.0"&&ze&&(ee[ze]=me)}for(let me=0;me<N.length;me++){if(oe.has(me))continue;const we=N[me],Le=K[U[me]];if(!Le.extras)continue;let ze=null;we.id in ee&&(ze=YV(N[ee[we.id]].meshes,we.matrix)),ze||(ze=qV(Le)),ze&&(we.footprint=GV(ze))}if(oe.size>0){const me=Array.from(oe.values()).sort((we,Le)=>we-Le);for(let we=me.length-1;we>=0;we--)N.splice(me[we],1)}}(M,w,c.json.nodes),M}function XV(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const r=c.vertexArray.float32,l=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=Ux/(c.aabb.max[0]-l+2),x=Ux/(c.aabb.max[1]-u+2);for(let w=0;w<r.length;w+=3){const M=r[w+2],N=(r[w+0]-l)*m|0,U=(r[w+1]-u)*x|0;M>c.heightmap[U*Ux+N]&&(c.heightmap[U*Ux+N]=M)}}function ZV(c,r){const l={};l.indexArray=new Ac,l.indexArray.reserve(4*c.length),l.vertexArray=new Wc,l.vertexArray.reserve(10*c.length),l.colorArray=new Pl,l.vertexArray.reserve(10*c.length);let u=0;for(const w of c){const M=Math.min(10,Math.max(4,1.3*w.height))*r,N=[-w.normal[1],w.normal[0],0],U=Math.min(.29,.1*w.width/w.depth),K=w.width-2*w.depth*r*(U+.01),ee=Vt([],w.pos,N,K/2),oe=Vt([],w.pos,N,-K/2),me=[ee[0],ee[1],ee[2]+w.height],we=[oe[0],oe[1],oe[2]+w.height],Le=Vt([],w.normal,N,U);ui(Le,Le,M);const ze=Vt([],w.normal,N,-U);ui(ze,ze,M),mt(Le,ee,Le),mt(ze,oe,ze),ee[2]+=.1,oe[2]+=.1,l.vertexArray.emplaceBack(Le[0],Le[1],Le[2]),l.vertexArray.emplaceBack(ze[0],ze[1],ze[2]),l.vertexArray.emplaceBack(ee[0],ee[1],ee[2]),l.vertexArray.emplaceBack(oe[0],oe[1],oe[2]),l.vertexArray.emplaceBack(me[0],me[1],me[2]),l.vertexArray.emplaceBack(we[0],we[1],we[2]),l.vertexArray.emplaceBack(ee[0],ee[1],ee[2]),l.vertexArray.emplaceBack(oe[0],oe[1],oe[2]),l.vertexArray.emplaceBack(Le[0],Le[1],Le[2]),l.vertexArray.emplaceBack(ze[0],ze[1],ze[2]);const qe=K/M/2;l.colorArray.emplaceBack(-qe-U,-1,qe,.8),l.colorArray.emplaceBack(qe+U,-1,qe,.8),l.colorArray.emplaceBack(-qe,0,qe,1.3),l.colorArray.emplaceBack(qe,0,qe,1.3),l.colorArray.emplaceBack(qe+U,-.8,qe,.7),l.colorArray.emplaceBack(qe+U,-.8,qe,.7),l.colorArray.emplaceBack(0,0,qe,1.3),l.colorArray.emplaceBack(0,0,qe,1.3),l.colorArray.emplaceBack(qe+U,-1.2,qe,.8),l.colorArray.emplaceBack(qe+U,-1.2,qe,.8),l.indexArray.emplaceBack(6+u,4+u,8+u),l.indexArray.emplaceBack(7+u,9+u,5+u),l.indexArray.emplaceBack(0+u,1+u,2+u),l.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0};m.emissiveFactor=ao.black;const x={};return x.baseColorFactor=ao.white,m.pbrMetallicRoughness=x,l.material=m,l.aabb=new Fo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}xC.performDecoding=function(c,r){const l=new Uint8Array(c);return Promise.all(r.tasks.map(u=>{const{layerName:m,firstByte:x,lastByte:w,pixelFormat:M,blockShape:N,blockIndex:U,filters:K,codec:ee}=u,oe=l.subarray(x,w+1),me=new Uint32Array(N[0]*N[1]*N[2]);let we;if(ee!=="gzip_data")throw new ky(`Unhandled codec: ${ee}`);return we=function(Le,ze){if(!globalThis.DecompressionStream&&ze==="gzip_data")return Promise.resolve(((Re=function(Tt){Tt[0]==31&&Tt[1]==139&&Tt[2]==8||p0(6,"invalid gzip data");var ri=Tt[3],Xt=10;4&ri&&(Xt+=2+(Tt[10]|Tt[11]<<8));for(var si=(ri>>3&1)+(ri>>4&1);si>0;si-=!Tt[Xt++]);return Xt+(2&ri)}(ct=Le))+8>ct.length&&p0(6,"invalid gzip data"),function(Tt,ri,Xt,si){var Ci=Tt.length;if(!Ci||ri.f&&!ri.l)return Xt||new Wg(0);var qi=!Xt,Fr=qi||ri.i!=2,gr=ri.i;qi&&(Xt=new Wg(3*Ci));var Rr,$r,Zi=function(Mc){var kl=Xt.length;if(Mc>kl){var cl=new Wg(Math.max(2*kl,Mc));cl.set(Xt),Xt=cl}},Ir=ri.f||0,Hi=ri.p||0,Xi=ri.b||0,jr=ri.l,Gr=ri.d,Hn=ri.m,Mn=ri.n,hn=8*Ci;do{if(!jr){Ir=d0(Tt,Hi,1);var Wr=d0(Tt,Hi+1,3);if(Hi+=3,!Wr){var Ss=Tt[(yt=4+((Hi+7)/8|0))-4]|Tt[yt-3]<<8,En=yt+Ss;if(En>Ci){gr&&p0(0);break}Fr&&Zi(Xi+Ss),Xt.set(Tt.subarray(yt,En),Xi),ri.b=Xi+=Ss,ri.p=Hi=8*En,ri.f=Ir;continue}if(Wr==1)jr=BV,Gr=FV,Hn=9,Mn=5;else if(Wr==2){var Dn=d0(Tt,Hi,31)+257,ss=d0(Tt,Hi+10,15)+4,$s=Dn+d0(Tt,Hi+5,31)+1;Hi+=14;for(var Rs=new Wg($s),no=new Wg(19),js=0;js<ss;++js)no[OV[js]]=d0(Tt,Hi+3*js,7);Hi+=3*ss;var so=oA(no),Pa=(1<<so)-1,_l=qw(no,so);for(js=0;js<$s;){var yt,Mt=_l[d0(Tt,Hi,Pa)];if(Hi+=15&Mt,(yt=Mt>>4)<16)Rs[js++]=yt;else{var ir=0,Zr=0;for(yt==16?(Zr=3+d0(Tt,Hi,3),Hi+=2,ir=Rs[js-1]):yt==17?(Zr=3+d0(Tt,Hi,7),Hi+=3):yt==18&&(Zr=11+d0(Tt,Hi,127),Hi+=7);Zr--;)Rs[js++]=ir}}var un=Rs.subarray(0,Dn),an=Rs.subarray(Dn);Hn=oA(un),Mn=oA(an),jr=qw(un,Hn),Gr=qw(an,Mn)}else p0(1);if(Hi>hn){gr&&p0(0);break}}Fr&&Zi(Xi+131072);for(var Sn=(1<<Hn)-1,rs=(1<<Mn)-1,go=Hi;;go=Hi){var yo=(ir=jr[aA(Tt,Hi)&Sn])>>4;if((Hi+=15&ir)>hn){gr&&p0(0);break}if(ir||p0(2),yo<256)Xt[Xi++]=yo;else{if(yo==256){go=Hi,jr=null;break}var Hs=yo-254;yo>264&&(Hs=d0(Tt,Hi,(1<<(_o=NP[js=yo-257]))-1)+UP[js],Hi+=_o);var Fa=Gr[aA(Tt,Hi)&rs],ll=Fa>>4;if(Fa||p0(3),Hi+=15&Fa,an=NV[ll],ll>3){var _o=BP[ll];an+=aA(Tt,Hi)&(1<<_o)-1,Hi+=_o}if(Hi>hn){gr&&p0(0);break}Fr&&Zi(Xi+131072);var oc=Xi+Hs;if(Xi<an){var vl=0-an,Oa=Math.min(an,oc);for(vl+Xi<0&&p0(3);Xi<Oa;++Xi)Xt[Xi]=(void 0)[vl+Xi]}for(;Xi<oc;++Xi)Xt[Xi]=Xt[Xi-an]}}ri.l=jr,ri.p=go,ri.b=Xi,ri.f=Ir,jr&&(Ir=1,ri.m=Hn,ri.d=Gr,ri.n=Mn)}while(!Ir);return Xi!=Xt.length&&qi?(Rr=Xt,(($r=Xi)==null||$r>Rr.length)&&($r=Rr.length),new Wg(Rr.subarray(0,$r))):Xt.subarray(0,Xi)}(ct.subarray(Re,-8),{i:2},new Wg(((qe=ct)[(ot=qe.length)-4]|qe[ot-3]<<8|qe[ot-2]<<16|qe[ot-1]<<24)>>>0))));var qe,ot,ct,Re;const tt=VV[ze];if(!tt)throw new Error(`Unhandled codec: ${ze}`);const ut=new globalThis.DecompressionStream(tt);return new Response(new Blob([Le]).stream().pipeThrough(ut)).arrayBuffer().then(Tt=>new Uint8Array(Tt))}(oe,ee).then(Le=>(function(ze,qe){ze.readFields(AV,qe)}(new lA(Le),me),new jV[M](me.buffer))),we.then(Le=>{for(let ze=K.length-1;ze>=0;ze--)switch(K[ze]){case"delta_filter":IV(Le,N);break;case"zigzag_filter":LV(Le);break;case"bitshuffle_filter":DV(Le,M);break;default:throw new ky(`Unhandled filter "${K[ze]}"`)}return{layerName:m,blockIndex:U,data:Le}}).catch(Le=>{throw Le})}))},mn(HP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),mn(xC,"MapboxRasterTile"),mn(jP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class YP{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const u=r[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const KV=["id","tile","layer","source","sourceLayer","state"];class s1{constructor(r,l,u,m,x){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=u,this._y=m,this.properties=r.properties,this.id=x}clone(){const r=new s1(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of KV)this[l]!==void 0&&(r[l]=this[l]);return r}}class XP{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Au(mr,16,0),this.featureIndexArray=new Ru,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,l,u,m,x,w=0,M=0){const N=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,x,w);const U=this.grid;for(let K=0;K<l.length;K++){const ee=l[K],oe=[1/0,1/0,-1/0,-1/0];for(let me=0;me<ee.length;me++){const we=ee[me];oe[0]=Math.min(oe[0],we.x),oe[1]=Math.min(oe[1],we.y),oe[2]=Math.max(oe[2],we.x),oe[3]=Math.max(oe[3],we.y)}M!==0&&(oe[0]-=M,oe[1]-=M,oe[2]+=M,oe[3]+=M),oe[0]<mr&&oe[1]<mr&&oe[2]>=0&&oe[3]>=0&&U.insert(N,oe[0],oe[1],oe[2],oe[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new cs.VectorTile(new jb(this.rawTileData)).layers,this.sourceLayerCoder=new YP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l){const{tilespaceGeometry:u,transform:m,tileTransform:x,pixelPosMatrix:w,availableImages:M,worldview:N}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const U=u.bufferedTilespaceBounds,K=this.grid.query(U.min.x,U.min.y,U.max.x,U.max.y,(we,Le,ze,qe)=>jm(u.bufferedTilespaceGeometry,we,Le,ze,qe));K.sort(QV);let ee=null;m.elevation&&K.length>0&&(ee=t1.create(m.elevation,this.tileID));const oe={};let me;for(let we=0;we<K.length;we++){const Le=K[we];if(Le===me)continue;me=Le;const ze=this.featureIndexArray.get(Le);let qe=null;this.is3DTile?this.loadMatchingModelFeature(oe,ze,r,u,m,N):this.loadMatchingFeature(oe,ze,r,M,N,(ot,ct,Re,tt=0)=>(qe||(qe=pn(ot,this.tileID.canonical,x)),ct.queryIntersectsFeature(u,ot,Re,qe,this.z,m,w,ee,tt)))}return oe}loadMatchingFeature(r,l,u,m,x,w){const{featureIndex:M,bucketIndex:N,sourceLayerIndex:U,layoutVertexArrayOffset:K}=l,ee=this.bucketLayerIDs[N],oe=u.layers,me=Object.keys(oe);if(me.length&&!xr(me,ee))return;const we=u.sourceCache,Le=this.sourceLayerCoder.decode(U),ze=this.vtLayers[Le].feature(M),qe=this.getId(ze,Le);for(let ot=0;ot<ee.length;ot++){const ct=ee[ot];if(!oe[ct])continue;const{styleLayer:Re,targets:tt}=oe[ct];let ut={};qe!==void 0&&(ut=we.getFeatureState(Re.sourceLayer,qe));const Tt=!w||w(ze,Re,ut,K);if(!Tt)continue;const ri=new s1(ze,this.z,this.x,this.y,qe);ri.tile=this.tileID.canonical,ri.state=ut;let Xt=this.serializedLayersCache.get(ct);Xt||(Xt=Re.serialize(),Xt.id=ct,this.serializedLayersCache.set(ct,Xt)),ri.source=Xt.source,ri.sourceLayer=Xt["source-layer"],ri.layer=ai({},Xt),ri.layer.paint=ZP(Xt.paint,Re.paint,ze,ut,m),ri.layer.layout=ZP(Xt.layout,Re.layout,ze,ut,m);let si=!1;for(const Ci of tt){this.updateFeatureProperties(ri,Ci);const{filter:qi}=Ci;if(qi){if(ze.properties=ri.properties,qi.needGeometry){const Fr=on(ze,!0);if(!qi.filter(new sa(this.tileID.overscaledZ,{worldview:x}),Fr,this.tileID.canonical))continue}else if(!qi.filter(new sa(this.tileID.overscaledZ,{worldview:x}),ze))continue}si=!0,Ci.targetId&&this.addFeatureVariant(ri,Ci)}si&&this.appendToResult(r,ct,M,ri,Tt)}}loadMatchingModelFeature(r,l,u,m,x,w){const{featureIndex:M,bucketIndex:N}=l,U=this.bucketLayerIDs[N],K=u.layers,ee=Object.keys(K);if(!ee.length||xr(ee,U))for(let oe=0;oe<U.length;oe++){const me=U[oe],{styleLayer:we,targets:Le}=K[me];if(we.type!=="model")continue;const ze=m.tile,qe=ze.getBucket(we);if(!(qe&&qe instanceof pC))continue;const ot=K8(qe,M,m,x);if(!ot)continue;const{z:ct,x:Re,y:tt}=ze.tileID.canonical,{feature:ut,intersectionZ:Tt,position:ri}=ot;let Xt={};ut.id!==void 0&&(Xt=u.sourceCache.getFeatureState(we.sourceLayer,ut.id));const si=new s1({},ct,Re,tt,ut.id);si.tile=this.tileID.canonical,si.state=Xt,si.properties=ut.properties,si.geometry={type:"Point",coordinates:[ri.lng,ri.lat]};let Ci=this.serializedLayersCache.get(me);Ci||(Ci=we.serialize(),Ci.id=me,this.serializedLayersCache.set(me,Ci)),si.source=Ci.source,si.sourceLayer=Ci["source-layer"],si.layer=ai({},Ci);let qi=!1;for(const Fr of Le){this.updateFeatureProperties(si,Fr);const{filter:gr}=Fr;if(gr){if(ut.properties=si.properties,gr.needGeometry){if(!gr.filter(new sa(this.tileID.overscaledZ,{worldview:w}),ut,this.tileID.canonical))continue}else if(!gr.filter(new sa(this.tileID.overscaledZ,{worldview:w}),ut))continue}qi=!0,Fr.targetId&&this.addFeatureVariant(si,Fr)}qi&&this.appendToResult(r,me,M,si,Tt)}}updateFeatureProperties(r,l,u){if(l.properties){const m={};for(const x in l.properties){const w=l.properties[x].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);w!=null&&(m[x]=w)}r.properties=m}}addFeatureVariant(r,l,u){const m={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(m.properties=r.properties),r.variants=r.variants||{},r.variants[l.targetId]=r.variants[l.targetId]||[],r.variants[l.targetId].push(m)}appendToResult(r,l,u,m,x){let w=r[l];w===void 0&&(w=r[l]=[]),w.push({featureIndex:u,feature:m,intersectionZ:x})}lookupSymbolFeatures(r,l,u,m,x,w){const M={};this.loadVTLayers();for(const N of r)this.loadMatchingFeature(M,{bucketIndex:l,sourceLayerIndex:u,featureIndex:N,layoutVertexArrayOffset:0},m,x,w);return M}loadFeature(r){const{featureIndex:l,sourceLayerIndex:u}=r;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),x=this.vtFeatures[m];if(x[l])return x[l];const w=this.vtLayers[m].feature(l);return x[l]=w,w}hasLayer(r){for(const l of this.bucketLayerIDs)for(const u of l)if(r===u)return!0;return!1}getId(r,l){let u=r.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const x=Eu(m);if(x.result!=="success"){const w=x.value.map(M=>`${M.key}: ${M.message}`).join(", ");return void tn(`Failed to create expression for promoteId: ${w}`)}this.promoteIdExpression=x.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new el),u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[m];typeof u=="boolean"&&(u=Number(u))}return u}}function ZP(c,r,l,u,m){return Qr(c,(x,w)=>{const M=r instanceof Md?r.get(w):null;return M&&M.evaluate?M.evaluate(l,u,void 0,m):M})}function QV(c,r){return r-c}mn(XP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const KP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hA{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const x=KP[15&u];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(r,2,1),[M]=new Uint32Array(r,4,1);return new hA(M,w,x,r)}constructor(r,l=64,u=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=KP.indexOf(this.ArrayType),w=2*r*this.ArrayType.BYTES_PER_ELEMENT,M=r*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-M%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+M+N,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+w+M+N),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+M+N,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=l,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return uA(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:M}=this,N=[0,x.length-1,0],U=[];for(;N.length;){const K=N.pop()||0,ee=N.pop()||0,oe=N.pop()||0;if(ee-oe<=M){for(let ze=oe;ze<=ee;ze++){const qe=w[2*ze],ot=w[2*ze+1];qe>=r&&qe<=u&&ot>=l&&ot<=m&&U.push(x[ze])}continue}const me=oe+ee>>1,we=w[2*me],Le=w[2*me+1];we>=r&&we<=u&&Le>=l&&Le<=m&&U.push(x[me]),(K===0?r<=we:l<=Le)&&(N.push(oe),N.push(me-1),N.push(1-K)),(K===0?u>=we:m>=Le)&&(N.push(me+1),N.push(ee),N.push(1-K))}return U}within(r,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:x,nodeSize:w}=this,M=[0,m.length-1,0],N=[],U=u*u;for(;M.length;){const K=M.pop()||0,ee=M.pop()||0,oe=M.pop()||0;if(ee-oe<=w){for(let ze=oe;ze<=ee;ze++)JP(x[2*ze],x[2*ze+1],r,l)<=U&&N.push(m[ze]);continue}const me=oe+ee>>1,we=x[2*me],Le=x[2*me+1];JP(we,Le,r,l)<=U&&N.push(m[me]),(K===0?r-u<=we:l-u<=Le)&&(M.push(oe),M.push(me-1),M.push(1-K)),(K===0?r+u>=we:l+u>=Le)&&(M.push(me+1),M.push(ee),M.push(1-K))}return N}}function uA(c,r,l,u,m,x){if(m-u<=l)return;const w=u+m>>1;QP(c,r,w,u,m,x),uA(c,r,l,u,w-1,1-x),uA(c,r,l,w+1,m,1-x)}function QP(c,r,l,u,m,x){for(;m>u;){if(m-u>600){const U=m-u+1,K=l-u+1,ee=Math.log(U),oe=.5*Math.exp(2*ee/3),me=.5*Math.sqrt(ee*oe*(U-oe)/U)*(K-U/2<0?-1:1);QP(c,r,l,Math.max(u,Math.floor(l-K*oe/U+me)),Math.min(m,Math.floor(l+(U-K)*oe/U+me)),x)}const w=r[2*l+x];let M=u,N=m;for(Xw(c,r,u,l),r[2*m+x]>w&&Xw(c,r,u,m);M<N;){for(Xw(c,r,M,N),M++,N--;r[2*M+x]<w;)M++;for(;r[2*N+x]>w;)N--}r[2*u+x]===w?Xw(c,r,u,N):(N++,Xw(c,r,N,m)),N<=l&&(u=N+1),l<=N&&(m=N-1)}}function Xw(c,r,l,u){dA(c,l,u),dA(r,2*l,2*u),dA(r,2*l+1,2*u+1)}function dA(c,r,l){const u=c[r];c[r]=c[l],c[l]=u}function JP(c,r,l,u){const m=c-l,x=r-u;return m*m+x*x}i.$=Mo,i.A=Ha,i.B=bi,i.C=vp,i.D=Nc,i.E=Wu,i.F=2,i.G=zv,i.H=ZT,i.I=Xc,i.J=Yo,i.K=class extends uC{},i.L=wl,i.M=kh,i.N=Cd,i.O=Up,i.P=fr,i.Q=Cu,i.R=Th,i.S=jl,i.T=Gk,i.U=Tg,i.V=uC,i.W=ny,i.X=Eu,i.Y=Hf,i.Z=Op,i._=ml,i.a=function(c){return vs.API_CDN_URL_REGEX.test(c)},i.a$=Fi,i.a0=Fh,i.a1=La,i.a2=$p,i.a3=gp,i.a4=function(c){const r=c.value;let l=[];if(!r)return l;const u=Yo(r);return u!=="string"?(l=l.concat([new uC(c.key,r,`string expected, "${u}" found`)]),l):(Zk(r,!0)||(l=l.concat([new uC(c.key,r,`invalid url "${r}"`)])),l)},i.a5=wi,i.a6=R0,i.a7=ha,i.a8=Wi,i.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return mi(c.expression.evaluate(r))}interpolate(c,r,l){return{x:kn(c.x,r.x,l),y:kn(c.y,r.y,l),z:kn(c.z,r.z,l),azimuthal:kn(c.azimuthal,r.azimuthal,l),polar:kn(c.polar,r.polar,l)}}},i.aA=Nt,i.aB=R,i.aC=ep,i.aD=Rt,i.aE=Ni,i.aF=function(c,r){const l={};for(let u=0;u<r.length;u++){const m=r[u];m in c&&(l[m]=c[m])}return l},i.aG=_t,i.aH=Et,i.aI=class{constructor(c){this.entries={},this.scheduler=c}request(c,r,l,u){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[x,w]=m.result;return this.scheduler?this.scheduler.add(()=>{u(x,w)},r):u(x,w),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=l((x,w)=>{m.result=[x,w];for(const M of m.callbacks)this.scheduler?this.scheduler.add(()=>{M(x,w)},r):M(x,w);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(x=>x!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},i.aJ=function(c,r,l){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{const x=Qh(c.request,(w,M,N,U)=>{w?m(w):M&&m(null,{vectorTile:l?void 0:new cs.VectorTile(new jb(M)),rawData:M,cacheControl:N,expires:U})});return()=>{x.cancel(),m()}},r)},i.aK=function(c){to++,to>Uc&&(c.getActor().send("enforceCacheSizeLimit",ul),to=0)},i.aL=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},i.aM=Hh,i.aN=GD,i.aO=QD,i.aP=HD,i.aQ=function(c,r){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let u=0;u<c.length;u++){const m=document.createElement("source");Vf(c[u])||(l.crossOrigin="Anonymous"),m.src=c[u],l.appendChild(m)}return{cancel:()=>{}}},i.aR=oC,i.aS=function(c){return fetch(c).then(r=>r.arrayBuffer()).then(r=>Px(r,0,c))},i.aT=qP,i.aU=class{constructor(c,r,l,u){this.id=c,this.position=r!=null?new et(r[0],r[1]):new et(0,0),this.orientation=l??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Fo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,r){if(fe(c.matrix,r,c.matrix),c.meshes)for(const l of c.meshes){const u=Fo.applyTransformFast(l.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const l of c.children)this._applyTransformations(l,c.matrix)}computeBoundsAndApplyParent(){const c=te([]);for(const r of this.nodes)this._applyTransformations(r,c)}computeModelMatrix(c,r,l,u,m,x,w=!1){cP(this.matrix,this,c.transform,this.position,r,l,u,m,x,w)}upload(c){if(!this.uploaded){for(const r of this.nodes)Qk(r,c);for(const r of this.nodes)dC(r);this.uploaded=!0}}destroy(){for(const c of this.nodes)Jk(c)}},i.aV=ln,i.aW=ye,i.aX=qt,i.aY=Ei,i.aZ=tm,i.a_=Ac,i.aa=sa,i.ab=gl,i.ac=li,i.ad=Oi,i.ae=Ot,i.af=Jt,i.ag=Md,i.ah=Ef,i.ai=kn,i.aj=mr,i.ak=lf,i.al=Un,i.am=ao,i.an=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return function([l,u]){const m=mi([1,l,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(r))}interpolate(c,r,l){return{x:kn(c.x,r.x,l),y:kn(c.y,r.y,l),z:kn(c.z,r.z,l)}}},i.ao=function(c,r,l=0,u=!0){const m=new fr(l,l),x=c.sub(m),w=r.add(m),M=[x,new fr(w.x,x.y),w,new fr(x.x,w.y)];return u&&M.push(x.clone()),M},i.ap=function(c,r){const l=[];for(let u=0;u<c.length;u++){const m=xi(u-1,-1,c.length-1),x=xi(u+1,-1,c.length-1),w=c[u],M=c[x],N=c[m].sub(w).unit(),U=M.sub(w).unit(),K=U.angleWithSep(N.x,N.y),ee=N.add(U).unit().mult(-1*r/Math.sin(K/2));l.push(w.add(ee))}return l},i.aq=Te,i.ar=jm,i.as=function(c,r,l=0){return Ae(((r.x-l)*c.scale-c.x)*mr,(r.y*c.scale-c.y)*mr,Mi(r.z,r.y))},i.at=pr,i.au=Kt,i.av=Ta,i.aw=gn,i.ax=function(c){let r=1/0,l=1/0,u=-1/0,m=-1/0;for(const x of c)r=Math.min(r,x.x),l=Math.min(l,x.y),u=Math.max(u,x.x),m=Math.max(m,x.y);return{min:new fr(r,l),max:new fr(u,m)}},i.ay=ft,i.az=fe,i.b=function(c){return vs.API_FONTS_REGEX.test(c)},i.b$=function(c,r,l){l*=.5;var u=r[0],m=r[1],x=r[2],w=r[3],M=Math.sin(l),N=Math.cos(l);return c[0]=u*N+m*M,c[1]=m*N-u*M,c[2]=x*N+w*M,c[3]=w*N-x*M,c},i.b0=Sa,i.b1=au,i.b2=function(){jd.isLoading()||jd.isLoaded()||jp()!=="deferred"||wg()},i.b3=sy,i.b4=on,i.b5=s1,i.b6=zi,i.b7=Qt,i.b8=qm,i.b9=pn,i.bA=function(c,r){const{x:l,y:u}=c.point,m=mv(l,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return fe(m,m,Ky(Kp(r)))},i.bB=L,i.bC=function(c){return c[0]=0,c[1]=0,c[2]=0,c},i.bD=function(c,r){return Math.hypot(r[0]-c[0],r[1]-c[1],r[2]-c[2])},i.bE=Vt,i.bF=rr,i.bG=Ui,i.bH=Fv,i.bI=jc,i.bJ=W_,i.bK=function(c,r,l,u,m){const x=5*r+2;c.float32[x+0]=l,c.float32[x+1]=u,c.float32[x+2]=m},i.bL=io,i.bM=Mv,i.bN=su,i.bO=qh,i.bP=V0,i.bQ=nP,i.bR=zu,i.bS=wx,i.bT=Ow,i.bU=rC,i.bV=b,i.bW=hA,i.bX=xi,i.bY=ui,i.bZ=ni,i.b_=pi,i.ba=Vc,i.bb=Pd,i.bc=k_,i.bd=nl,i.be=je,i.bf=e_,i.bg=function(c,r){const l=Ef(r.zoom);if(l===0)return Kp(c);const u=Zy(c),m=my(u),x=Rt(u.getWest())*r.worldSize,w=Rt(u.getEast())*r.worldSize,M=Et(u.getNorth())*r.worldSize,N=Et(u.getSouth())*r.worldSize,U=[x,M,0],K=[w,M,0],ee=[x,N,0],oe=[w,N,0],me=he([],r.globeMatrix);return Oi(U,U,me),Oi(K,K,me),Oi(ee,ee,me),Oi(oe,oe,me),m[0]=Qp(m[0],ee,l),m[1]=Qp(m[1],oe,l),m[2]=Qp(m[2],K,l),m[3]=Qp(m[3],U,l),Fo.fromPoints(m)},i.bh=U0,i.bi=he,i.bj=gy,i.bk=Qp,i.bl=em,i.bm=E_,i.bn=He,i.bo=le,i.bp=xC,i.bq=jb,i.br=Qh,i.bs=function(c,r){const l=[];for(const u in c)u in r||l.push(u);return l},i.bt=ti,i.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bv=tc,i.bw=function(c){var r=new E(16);return r[0]=c[0],r[1]=c[1],r[2]=c[2],r[3]=c[3],r[4]=c[4],r[5]=c[5],r[6]=c[6],r[7]=c[7],r[8]=c[8],r[9]=c[9],r[10]=c[10],r[11]=c[11],r[12]=c[12],r[13]=c[13],r[14]=c[14],r[15]=c[15],r},i.bx=te,i.by=Ie,i.bz=Q,i.c=Po,i.c$=Lv,i.c0=St,i.c1=Yr,i.c2=function(c,r){return c[0]=-r[0],c[1]=-r[1],c[2]=-r[2],c[3]=r[3],c},i.c3=lt,i.c4=function(c,r,l,u,m){var x,w=1/Math.tan(r/2);return c[0]=w/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=w,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,m!=null&&m!==1/0?(c[10]=(m+u)*(x=1/(u-m)),c[14]=2*m*u*x):(c[10]=-1,c[14]=-2*u),c},i.c5=function(c,r,l,u,m,x,w){var M=1/(r-l),N=1/(u-m),U=1/(x-w);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*N,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*U,c[11]=0,c[12]=(r+l)*M,c[13]=(m+u)*N,c[14]=(w+x)*U,c[15]=1,c},i.c6=Wt,i.c7=function(c,r,l){c[4*r+0]=l[0],c[4*r+1]=l[1],c[4*r+2]=l[2],c[4*r+3]=l[3]},i.c8=Ig,i.c9=Yd,i.cA=cC,i.cB=Pt,i.cC=JD,i.cD=function(c){const r=JD(c,!0);return L([],[r[0],r[1],r[4],r[5]])},i.cE=Se,i.cF=Ca,i.cG=ke,i.cH=function(c){const{x:r,y:l}=c.point,{lng:u,lat:m}=c._center;return mv(r,l,c.worldSize,u,m)},i.cI=Dt,i.cJ=vi,i.cK=Ng,i.cL=$,i.cM=function(c,r,l){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),r[m]<0&&(u+=(0-r[m])*(0-r[m]));return u},i.cN=function(c){return c*c*c*c*c},i.cO=Ft,i.cP=45,i.cQ=ly,i.cR=function(c,r,l){const u=Math.sqrt(c*c+r*r+l*l),m=u>0?Math.acos(l/u)*bl:0;let x=c!==0||r!==0?Math.atan2(-r,-c)*bl+90:0;return x<0&&(x+=360),[u,x,m]},i.cS=Ae,i.cT=mi,i.cU=$i,i.cV=mt,i.cW=Fo,i.cX=bt,i.cY=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},i.cZ=Zk,i.c_=function(c,r){return c.readFields(eV,{icons:[]},r)},i.ca=ya,i.cb=Ql,i.cc=Zp,i.cd=et,i.ce=es,i.cf=function(){var c=new E(4);return E!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},i.cg=function(c,r,l){var u=r[0],m=r[1],x=r[2],w=r[3],M=Math.sin(l),N=Math.cos(l);return c[0]=u*N+x*M,c[1]=m*N+w*M,c[2]=u*-M+x*N,c[3]=m*-M+w*N,c},i.ch=function(c,r){return c[0]===r[0]&&c[1]===r[1]&&c[2]===r[2]&&c[3]===r[3]},i.ci=nn,i.cj=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},i.ck=Tn,i.cl=ji,i.cm=py,i.cn=ua,i.co=eP,i.cp=Rg,i.cq=Xy,i.cr=function(c,r,l,u,m,x,w,M,N){if(N.name==="globe")return Xy(c,r,new Rg(l,u,m),!1);const U=ye({z:l,x:u,y:m},N);return new Fo([(x+U.x/U.scale)*r,r*(U.y/U.scale),w],[(x+U.x2/U.scale)*r,r*(U.y2/U.scale),M])},i.cs=function(c,r,l){return c[0]=Math.min(r[0],l[0]),c[1]=Math.min(r[1],l[1]),c[2]=Math.min(r[2],l[2]),c[3]=Math.min(r[3],l[3]),c},i.ct=function(c,r,l){return c[0]=Math.max(r[0],l[0]),c[1]=Math.max(r[1],l[1]),c[2]=Math.max(r[2],l[2]),c[3]=Math.max(r[3],l[3]),c},i.cu=function(c){const r=Math.round((c+45+360)%360/90)%4;return Ge[r]},i.cv=Ki,i.cw=Lt,i.cx=Z,i.cy=function(c){const r=te(new Float64Array(16));fe(r,c.pixelMatrix,c.globeMatrix);const l=[0,ge,0],u=[0,Ce,0];return Oi(l,l,r),Oi(u,u,r),[l[0]>0&&l[0]<=c.width&&l[1]>0&&l[1]<=c.height&&!Jy(c,new et(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Jy(c,new et(c.center.lat,-90))]},i.cz=function(c,r){const{scale:l}=c.tileTransform,u=l*mr/(c.tileSize*Math.pow(2,r.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(m,x,w){var M=x[1],N=x[2],U=x[3],K=w[0],ee=w[1];return m[0]=x[0]*K,m[1]=M*K,m[2]=N*ee,m[3]=U*ee,m}(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},i.d=function(c){return vs.API_TILEJSON_REGEX.test(c)},i.d$=Du,i.d0=Uv,i.d1=zw,i.d2=pu,i.d3=Ad,i.d4=zc,i.d5=fu,i.d6=ii,i.d7=function(c){const r=c.indexOf(yh);return r>=0?c.slice(0,r):c},i.d8=function(c){return c.indexOf(yh)>=0},i.d9=function(c){const r=c.lastIndexOf(yh);return r>=0?c.slice(r+1):""},i.dA=Fg,i.dB=rn,i.dC=is,i.dD=256,i.dE=function(c,r){const l=[0,0,0];return Oi(l,l,U0(Kp(r.canonical))),Oi(l,l,c),l},i.dF=c=>({u_matrix:new Zp(c),u_texsize:new Ql(c),u_pixels_to_tile_units:new Kd(c),u_device_pixel_ratio:new ya(c),u_width_scale:new ya(c),u_floor_width_scale:new ya(c),u_image:new Ig(c),u_units_to_pixels:new Ql(c),u_tile_units_to_pixels:new ya(c),u_alpha_discard_threshold:new ya(c),u_trim_offset:new Ql(c),u_trim_fade_range:new Ql(c),u_trim_color:new ly(c),u_emissive_strength:new ya(c),u_zbias_factor:new ya(c),u_tile_to_meter:new ya(c),u_ground_shadow_factor:new Yd(c),u_pattern_transition:new ya(c)}),i.dG=c=>({u_matrix:new Zp(c),u_pixels_to_tile_units:new Kd(c),u_device_pixel_ratio:new ya(c),u_width_scale:new ya(c),u_floor_width_scale:new ya(c),u_units_to_pixels:new Ql(c),u_dash_image:new Ig(c),u_gradient_image:new Ig(c),u_image_height:new ya(c),u_texsize:new Ql(c),u_tile_units_to_pixels:new ya(c),u_alpha_discard_threshold:new ya(c),u_trim_offset:new Ql(c),u_trim_fade_range:new Ql(c),u_trim_color:new ly(c),u_emissive_strength:new ya(c),u_zbias_factor:new ya(c),u_tile_to_meter:new ya(c),u_ground_shadow_factor:new Yd(c)}),i.dH=c=>({u_camera_to_center_distance:new ya(c),u_extrude_scale:new Kd(c),u_device_pixel_ratio:new ya(c),u_matrix:new Zp(c),u_inv_rot_matrix:new Zp(c),u_merc_center:new Ql(c),u_tile_id:new Yd(c),u_zoom_transition:new ya(c),u_up_dir:new Yd(c),u_emissive_strength:new ya(c)}),i.dI=ay,i.dJ=Ok,i.dK=M_,i.dL=(c,r,l,u,m,x)=>{const w=c.transform,M=w.projection.name==="globe";let N;if(x.paint.get("circle-pitch-alignment")==="map")if(M){const K=Fg(w.zoom,r.canonical)*w._pixelsPerMercatorPixel;N=Float32Array.from([K,0,0,K])}else N=w.calculatePixelsToTileUnitsMatrix(l);else N=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const U={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(w.projection),u_matrix:c.translatePosMatrix(r.projMatrix,l,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ch.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:mx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(M){U.u_inv_rot_matrix=u,U.u_merc_center=m,U.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],U.u_zoom_transition=Ef(w.zoom);const K=m[0]*mr,ee=m[1]*mr;U.u_up_dir=w.projection.upVector(new Rg(0,0,0),K,ee)}return U},i.dM=Gs,i.dN=Li,i.dO=(c,r,l,u,m,x,w,M,N,U)=>{const K=c.transform,ee=K.pitch<15?_n(.07,.7,ft((14-K.zoom)/5,0,1)):.07,oe=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:_s(c,r,l,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:K.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:m,u_width_scale:x,u_floor_width_scale:w,u_image:0,u_tile_units_to_pixels:Cn(r,K),u_units_to_pixels:[1/K.pixelsToGLUnits[0],1/K.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:M,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(oe?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:ee,u_tile_to_meter:$i(r.tileID.canonical,0),u_ground_shadow_factor:N,u_pattern_transition:U}},i.dP=(c,r,l,u,m,x,w,M,N,U)=>{const K=c.transform,ee=K.calculatePixelsToTileUnitsMatrix(r),oe=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",me=K.pitch<15?_n(.07,.7,ft((14-K.zoom)/5,0,1)):.07;return{u_matrix:_s(c,r,l,u),u_pixels_to_tile_units:ee,u_device_pixel_ratio:x,u_width_scale:w,u_floor_width_scale:M,u_units_to_pixels:[1/K.pixelsToGLUnits[0],1/K.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:Lo(l)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cn(r,c.transform),u_alpha_discard_threshold:0,u_trim_offset:N,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(oe?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:me,u_tile_to_meter:$i(r.tileID.canonical,0),u_ground_shadow_factor:U}},i.dQ=Pr,i.dR=ae,i.dS=Mi,i.dT=dv,i.dU=G0,i.dV=Sy,i.dW=hd,i.dX=450,i.dY=7,i.dZ=z8,i.d_=lo,i.da=function(c){const r=[],l=c.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},i.db=function(c,r,l,u){return c.type==="custom"?new U8(c,r):new Q8[c.type](c,r,l,u)},i.dc=Or,i.dd=function(c){const r=c.indexOf(yh);return r>=0?c.slice(r+1):""},i.de=class extends s1{constructor(c,r){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},i.df=Wd,i.dg=vu,i.dh=function(c){return c({pluginStatus:$h,pluginURL:Ju}),Wd.on("pluginStateChange",c),c},i.di=Xd,i.dj=class extends wp{constructor(c){super(c),this.current=Zd}set(c,r,l){if(this.fetchUniformLocation(c,r)){for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},i.dk=Fe,i.dl=function(c,r,l){const u=Ef(l.zoom),m=c.style.map._antialias,x=c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!x},i.dm=function(c){const r=c.pixelsPerMeter,l=r/Wt(1,c.center.lat),u=te(new Float64Array(16));return le(u,u,[c.point.x,c.point.y,0]),Se(u,u,[l,l,r]),Float32Array.from(u)},i.dn=Zy,i.dp=function(c){const r=Ki-5;c=ft(c,-80.051129,r)/r*90;const l=Math.pow(Math.abs(Math.sin(Un(c))),3);return Math.round(l*(be.length-1))},i.dq=function(c,r,l,u){const m=r.getNorth(),x=r.getSouth(),w=r.getWest(),M=r.getEast(),N=1<<c.z,U=M-w,K=m-x,ee=U/ue,oe=-K/be[l],me=[0,ee,0,oe,0,0,m,w,0];if(c.z>0){const we=180/u;q(me,me,[we/U+1,0,0,0,we/K+1,0,-.5*we/ee,.5*we/oe,1])}return me[2]=N,me[5]=c.x,me[8]=c.y,me},i.dr=Kp,i.ds=function(c,r,l){const u=te(new Float64Array(16)),m=(r/(1<<c)-.5)*Math.PI*2;return Ee(u,l.globeMatrix,m),Float32Array.from(u)},i.dt=class{isDataAvailableAtPoint(c){const r=this._source();if(this.isUsingMockSource()||!r||c.y<0||c.y>1)return!1;const l=r.getSource().maxzoom,u=1<<l,m=Math.floor(c.x),x=Math.floor((c.x-m)*u),w=Math.floor(c.y*u),M=this.findDEMTileFor(new Hh(l,m,l,x,w));return!(!M||!M.dem)}getAtPointOrZero(c,r=0){return this.getAtPoint(c,r)||0}getAtPoint(c,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||c.y<0||c.y>1)return r;const m=u.getSource().maxzoom,x=1<<m,w=Math.floor(c.x),M=c.x-w,N=new Hh(m,w,m,Math.floor(M*x),Math.floor(c.y*x)),U=this.findDEMTileFor(N);if(!U||!U.dem)return r;const K=U.dem,ee=1<<U.tileID.canonical.z,oe=(M*ee-U.tileID.canonical.x)*K.dim,me=(c.y*ee-U.tileID.canonical.y)*K.dim,we=Math.floor(oe),Le=Math.floor(me);return(l?this.exaggeration():1)*kn(kn(K.get(we,Le),K.get(we,Le+1),me-Le),kn(K.get(we+1,Le),K.get(we+1,Le+1),me-Le),oe-we)}getAtTileOffset(c,r,l){const u=1<<c.canonical.z;return this.getAtPointOrZero(new li(c.wrap+(c.canonical.x+r/mr)/u,(c.canonical.y+l/mr)/u))}getAtTileOffsetFunc(c,r,l,u){return m=>{const x=this.getAtTileOffset(c,m.x,m.y),w=u.upVector(c.canonical,m.x,m.y);return ui(w,w,x*u.upVectorScale(c.canonical,r,l).metersToTile),w}}getForTilePoints(c,r,l,u){if(this.isUsingMockSource())return!1;const m=t1.create(this,c,u);return!!m&&(r.forEach(x=>{x[2]=this.exaggeration()*m.getElevationAt(x[0],x[1],l)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(c);if(!r||!r.dem)return null;const l=r.dem.tree,u=r.tileID,m=1<<c.canonical.z-u.canonical.z;let x=c.canonical.x/m-u.canonical.x,w=c.canonical.y/m-u.canonical.y,M=0;for(let N=0;N<c.canonical.z-u.canonical.z&&!l.leaves[M];N++){x*=2,w*=2;const U=2*Math.floor(w)+Math.floor(x);M=l.childOffsets[M]+U,x%=1,w%=1}return{min:this.exaggeration()*l.minimums[M],max:this.exaggeration()*l.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let r=!1,l=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of c){const x=this.getMinMaxForTile(m.tileID);x&&(l=Math.min(l,x.min),u=Math.max(u,x.max),r=!0)}return r?{min:l,max:u}:null}},i.du=J,i.dv=fy,i.dw=function(c,r){return[Math.pow(c[0],2.2)*r,Math.pow(c[1],2.2)*r,Math.pow(c[2],2.2)*r]},i.dx=F,i.dy=function(c,r){var l=Math.sin(r),u=Math.cos(r);return c[0]=u,c[1]=l,c[2]=0,c[3]=-l,c[4]=u,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},i.dz=cr,i.e=vs,i.e$=YP,i.e0=256,i.e1=Ky,i.e2=Wc,i.e3=Ee,i.e4=function(c,r){return c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[4],c[4]=r[5],c[5]=r[6],c[6]=r[8],c[7]=r[9],c[8]=r[10],c},i.e5=Ld,i.e6=Dd,i.e7=Lm,i.e8=function(c,r,l,u,m){return ft((c-r)/(l-r)*(m-u)+u,u,m)},i.e9=Ht,i.eA=function(c,r,l){return c[0]=r[0]/l[0],c[1]=r[1]/l[1],c[2]=r[2]/l[2],c},i.eB=Ue,i.eC=Ne,i.eD=ur,i.eE=function(c,r,l,u){return c[0]=r,c[1]=l,c[2]=u,c},i.eF=function([c,r,l]){const u=Math.hypot(c,r,l),m=Math.atan2(c,l),x=.5*Math.PI-Math.acos(-r/u);return new et(vi(m),vi(x))},i.eG=pt,i.eH=Yk,i.eI=function(c){const r=c.navigator?c.navigator.userAgent:null;return!!function(l){if(zr==null){const u=l.navigator?l.navigator.userAgent:null;zr=!!l.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return zr}(c)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eJ=function(c,r){ul=c,Uc=r},i.eK=Jy,i.eL=Qy,i.eM=function(c){const r=[0,0,0],l=te(new Float64Array(16));return fe(l,c.pixelMatrix,c.globeMatrix),Oi(r,r,l),new fr(r[0],r[1])},i.eN=function(){const c=rp;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Af),rp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.eO=function(){Lv().acquire(Af)},i.eP=jp,i.eQ=function(c,r,l=!1){if($h===Uh.deferred||$h===Uh.loading||$h===Uh.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ju=ch.resolveURL(c),$h=Uh.deferred,Om=r,Cl(),l||wg()},i.eR=function(c){Qm=ch.resolveURL(c),Z0||(Z0=new Nc(Lv(),new Wu)),Z0.broadcast("setMeshoptUrl",Qm)},i.eS=Nb,i.eT=function(c){Km=ch.resolveURL(c),Z0||(Z0=new Nc(Lv(),new Wu)),Z0.broadcast("setDracoUrl",Km)},i.eU=K0,i.eV=Y0,i.eW=function(c){const r=Ys();if(!r)return;const l=r.delete(Kh);c&&l.then(()=>c()).catch(c)},i.eX=dm,i.eY=mn,i.eZ=H,i.e_=Vg,i.ea=function(c,r){var l=r[0],u=r[1],m=r[2],x=r[3],w=r[4],M=r[5],N=r[6],U=r[7],K=r[8],ee=K*w-M*U,oe=-K*x+M*N,me=U*x-w*N,we=l*ee+u*oe+m*me;return we?(c[0]=ee*(we=1/we),c[1]=(-K*u+m*U)*we,c[2]=(M*u-m*w)*we,c[3]=oe*we,c[4]=(K*l-m*N)*we,c[5]=(-M*l+m*x)*we,c[6]=me*we,c[7]=(-U*l+u*N)*we,c[8]=(w*l-u*x)*we,c):null},i.eb=Zt,i.ec=Er,i.ed=Xk,i.ee=function(c,r){if(c===r){var l=r[1],u=r[2],m=r[3],x=r[6],w=r[7],M=r[11];c[1]=r[4],c[2]=r[8],c[3]=r[12],c[4]=l,c[6]=r[9],c[7]=r[13],c[8]=u,c[9]=x,c[11]=r[14],c[12]=m,c[13]=w,c[14]=M}else c[0]=r[0],c[1]=r[4],c[2]=r[8],c[3]=r[12],c[4]=r[1],c[5]=r[5],c[6]=r[9],c[7]=r[13],c[8]=r[2],c[9]=r[6],c[10]=r[10],c[11]=r[14],c[12]=r[3],c[13]=r[7],c[14]=r[11],c[15]=r[15];return c},i.ef=At,i.eg=[1,1,1],i.eh=class{constructor(c,r,l,u){this.context=c,this.format=u,this.size=l,this.texture=c.gl.createTexture();const[m,x,w]=this.size,{gl:M}=c;M.bindTexture(M.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),M.texImage3D(M.TEXTURE_3D,0,this.format,m,x,w,0,Jb(this.format),Hk(this.format),r.data)}bind(c,r){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},i.ei=t1,i.ej=function(c,r,l,u){var m=new E(4);return m[0]=c,m[1]=r,m[2]=l,m[3]=u,m},i.ek=fi,i.el=function(c,r,l,u){var m=r[0],x=r[1],w=r[2],M=r[3];return c[0]=m+u*(l[0]-m),c[1]=x+u*(l[1]-x),c[2]=w+u*(l[2]-w),c[3]=M+u*(l[3]-M),c},i.em=e1,i.en=Wh,i.eo=rh,i.ep=function(c,r,l,u,m,x,w,M,N,U,K,ee,oe,me,we,Le){var ze=new E(16);return ze[0]=c,ze[1]=r,ze[2]=l,ze[3]=u,ze[4]=m,ze[5]=x,ze[6]=w,ze[7]=M,ze[8]=N,ze[9]=U,ze[10]=K,ze[11]=ee,ze[12]=oe,ze[13]=me,ze[14]=we,ze[15]=Le,ze},i.eq=We,i.er=nm,i.es=Fm,i.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new fr(1/0,1/0),max:new fr(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,r=!1){const l=vy(new fr(0,0),new fr(mr,mr),c),u=[];if(r&&!Cv(l,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!Cv(l,m))continue;const x=vx(m.min,m.max,c);u.push({min:x.min,max:x.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const l=[];for(const u of r.cache.getVisibleCoordinates()){const m=r.cache.getTile(u).buckets[r.layer];m&&m.updateFootprints(u.toUnwrapped(),l)}return l},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(c){const r=c.getFootprints();if(r.length===0)return;const l=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(const x of r){if(!x.footprint)continue;const w=vy(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:w.min,max:w.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:l,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,l)=>r.priority-l.priority||R_(r.min,l.min)||R_(r.max,l.max)||r.order-l.order||r.clipMask-l.clipMask||function(u,m){const x=(w,M)=>w+M;return u.length-m.length||u.reduce(x,"").localeCompare(m.reduce(x,""))}(r.clipScope,l.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let r=0;for(;!c&&r!==this._activeRegions.length;){const l=this._activeRegions[r],u=this._prevRegions[r];c=l.priority!==u.priority||!W0(l,u)||l.order!==u.order||l.clipMask!==u.clipMask||!tc(l.clipScope,u.clipScope),++r}}if(c){++this._updateTime;for(const l of this._activeRegions)l.order!==cd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const r=l=>{const u=this._activeRegions;if(l>=u.length)return l;const m=u[l].priority;for(;l<u.length&&u[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,u=r(l);for(;l!==u;){let m=l;const x=l;for(;m!==u;){const w=this._activeRegions[m];w.hiddenByOverlap=!1;for(let M=0;M<x;M++){const N=this._activeRegions[M];if(!N.hiddenByOverlap&&w.order===cd&&Cv(w,N)&&(w.hiddenByOverlap=bx(w.footprint,w.tileId,N.footprint,N.tileId),w.hiddenByOverlap))break}++m}l=u,u=r(l)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=c.length-1;r>=0;r--)this._addSource(c[r]);this._computeReplacement()}},i.eu=cd,i.ev=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,r){const l=new Vc,u=new Ac,m=[],x=c+1+2,w=r[0]+1,M=r[0]+1+(1+r.length),N=(U,K,ee)=>{let oe=U===x-1?U-2:U===0?U:U-1;return oe+=ee?24575:0,[oe,K]};for(let U=0;U<x;++U)l.emplaceBack(...N(U,0,!0));for(let U=0;U<w;++U)for(let K=0;K<x;++K)l.emplaceBack(...N(K,U,(K===0||K===x-1)&&!0));for(let U=0;U<r.length;++U){const K=r[U];for(let ee=0;ee<x;++ee)l.emplaceBack(...N(ee,K,!0))}for(let U=0;U<r.length;++U){const K=u.length,ee=r[U]+1+2,oe=new Ac;for(let Le=0;Le<ee-1;Le++){const ze=Le===ee-2,qe=ze?x*(M-r.length+U-Le):x;for(let ot=0;ot<x-1;ot++){const ct=Le*x+ot;Le===0||ze||ot===0||ot===x-2?(oe.emplaceBack(ct+1,ct,ct+qe),oe.emplaceBack(ct+qe,ct+qe+1,ct+1)):(u.emplaceBack(ct+1,ct,ct+qe),u.emplaceBack(ct+qe,ct+qe+1,ct+1))}}const me=nl.simpleSegment(0,K,l.length,u.length-K);for(let Le=0;Le<oe.uint16.length;Le+=3)u.emplaceBack(oe.uint16[Le],oe.uint16[Le+1],oe.uint16[Le+2]);const we=nl.simpleSegment(0,K,l.length,u.length-K);m.push({withoutSkirts:me,withSkirts:we})}return{vertices:l,indices:u,segments:m}}_createGrid(c){const r=this._fillGridMeshWithLods(ue,be);this._gridSegments=r.segments,this._gridBuffer=c.createVertexBuffer(r.vertices,k_.members),this._gridIndexBuffer=c.createIndexBuffer(r.indices,!0)}_createPoles(c){const r=new Ac;for(let w=0;w<=ue;w++)r.emplaceBack(0,w+1,w+2);this._poleIndexBuffer=c.createIndexBuffer(r,!0);const l=new Ld,u=new Ld,m=new Ld,x=new Ld;this._poleSegments=[];for(let w=0,M=0;w<$;w++){const N=360/(1<<w);l.emplaceBack(0,-R,0,.5,0),u.emplaceBack(0,-R,0,.5,1),m.emplaceBack(0,-R,0,.5,.5),x.emplaceBack(0,-R,0,.5,.5);for(let U=0;U<=ue;U++){let K=U/ue,ee=0;const oe=kn(0,N,K),[me,we,Le]=$e($0,yv,oe,R);l.emplaceBack(me,we,Le,K,ee),u.emplaceBack(me,we,Le,K,1-ee);const ze=Un(oe);K=.5+.5*Math.sin(ze),ee=.5+.5*Math.cos(ze),m.emplaceBack(me,we,Le,K,ee),x.emplaceBack(me,we,Le,K,1-ee)}this._poleSegments.push(nl.simpleSegment(M,0,66,64)),M+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(l,Yy,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,Yy,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,Yy,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(x,Yy,!1)}getGridBuffers(c,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},i.ew=rt,i.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.ey=xt,i.ez=Ti,i.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(r,l)=>String.fromCharCode(+("0x"+l))))},i.f0=XP,i.f1=W,i.f2=Ts,i.f3="hd_road_elevation",i.f4=od,i.f5=Qr,i.f6=pa,i.f7=Bw,i.f8=j_,i.f9=function(c,r,l,u,m,x,w,M=1,N,U,K){c.createArrays(),c.tilePixelRatio=mr/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const ee=c.layers[0].layout,oe=c.layers[0]._unevaluatedLayout._values,me={};me.scaleFactor=M,me.textSizeScaleRange=ee.get("text-size-scale-range"),me.iconSizeScaleRange=ee.get("icon-size-scale-range");const[we,Le]=me.textSizeScaleRange,[ze,qe]=me.iconSizeScaleRange;me.textScaleFactor=ft(me.scaleFactor,we,Le),me.iconScaleFactor=ft(me.scaleFactor,ze,qe);const ot=oe["text-size"],ct=oe["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:Xt,maxZoom:si}=c.textSizeData;me.compositeTextSizes=[ot.possiblyEvaluate(new sa(Xt,{worldview:K}),x),ot.possiblyEvaluate(new sa(si,{worldview:K}),x)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Xt,maxZoom:si}=c.iconSizeData;me.compositeIconSizes=[ct.possiblyEvaluate(new sa(Xt,{worldview:K}),x),ct.possiblyEvaluate(new sa(si,{worldview:K}),x)]}me.layoutTextSize=ot.possiblyEvaluate(new sa(w+1,{worldview:K}),x),me.layoutIconSize=ct.possiblyEvaluate(new sa(w+1,{worldview:K}),x),me.textMaxSize=ot.possiblyEvaluate(new sa(18,{worldview:K}),x);const Re=ee.get("symbol-placement"),tt=ee.get("text-rotation-alignment")==="map"&&Re!=="point",ut=ee.get("text-size");let Tt=!1;const ri=[];for(const Xt of c.features){const si=ee.get("text-font").evaluate(Xt,{},x).join(","),Ci=ut.evaluate(Xt,{},x)*me.textScaleFactor,qi=me.layoutTextSize.evaluate(Xt,{},x)*me.textScaleFactor,Fr=me.layoutIconSize.evaluate(Xt,{},x)*me.iconScaleFactor,gr={horizontal:{},vertical:void 0},Rr=Xt.text;let $r,Zi=[0,0];if(Rr){const ss=Rr.toString(),$s=ee.get("text-letter-spacing").evaluate(Xt,{},x)*qh,Rs=ee.get("text-line-height").evaluate(Xt,{},x)*qh,no=Wp(ss)?$s:0,js=ee.get("text-anchor").evaluate(Xt,{},x),so=ee.get("text-variable-anchor");if(!so){const ir=ee.get("text-radial-offset").evaluate(Xt,{},x);if(ir)Zi=rC(js,[ir*qh,Kb]);else{const Zr=ee.get("text-offset").evaluate(Xt,{},x);Zi=[Zr[0]*qh,Zr[1]*qh]}}let Pa=tt?"center":ee.get("text-justify").evaluate(Xt,{},x);const _l=Re==="point",yt=_l?ee.get("text-max-width").evaluate(Xt,{},x)*qh:1/0,Mt=ir=>{c.allowVerticalPlacement&&kd(ss)&&(gr.vertical=Iw(Rr,r,l,m,si,yt,Rs,js,ir,no,Zi,jc.vertical,!0,qi,Ci,N))};if(!tt&&so){const ir=Pa==="auto"?so.map(un=>b(un)):[Pa];let Zr=!1;for(let un=0;un<ir.length;un++){const an=ir[un];if(!gr.horizontal[an])if(Zr)gr.horizontal[an]=gr.horizontal[0];else{const Sn=Iw(Rr,r,l,m,si,yt,Rs,"center",an,no,Zi,jc.horizontal,!1,qi,Ci,N);Sn&&(gr.horizontal[an]=Sn,Zr=Sn.positionedLines.length===1)}}Mt("left")}else{if(Pa==="auto"&&(Pa=b(js)),_l||ee.get("text-writing-mode").indexOf("horizontal")>=0||!kd(ss)){const ir=Iw(Rr,r,l,m,si,yt,Rs,js,Pa,no,Zi,jc.horizontal,!1,qi,Ci,N);ir&&(gr.horizontal[Pa]=ir)}Mt(_l?"left":Pa)}}let Ir,Hi,Xi,jr,Gr,Hn,Mn=!1;const hn=ee.get("icon-text-fit").evaluate(Xt,{},x);if(Xt.icon&&Xt.icon.hasPrimary()){const ss=sC(Xt.icon,c.iconSizeData,oe["icon-size"],x,c.zoom,Xt,N,me.iconScaleFactor,K);Ir=ss.iconPrimary,Xi=ss.iconSecondary;const $s=Ir.toString();if(Hi=u.get($s),Hi&&(Gr=ee.get("icon-offset").evaluate(Xt,{},x),Hn=ee.get("icon-anchor").evaluate(Xt,{},x),$r=WT(m.get($s),Xi?m.get(Xi.toString()):void 0,Gr,Hn),Mn=Hi.sdf,c.sdfIcons===void 0?c.sdfIcons=Hi.sdf:c.sdfIcons!==Hi.sdf&&tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Hi.pixelRatio!==c.pixelRatio||ee.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),Xi){const Rs=Xi.toString();jr=u.get(Rs)}}Tt=Tt||!(!Xt.icon||!Xt.icon.hasSecondary());const Wr=X(gr.horizontal)||gr.vertical;c.iconsInText||(c.iconsInText=!!Wr&&Wr.iconsInText);const Ss=qi*me.textScaleFactor/qh,{defaultShapedIcon:En,verticallyShapedIcon:Dn}=T(c,$r,ee,Xt,x,gr,Ss,Gr,hn);hn!=="none"&&$r&&(HT($r)||GT($r))&&(Qb(0,Hi,Ir,$r,En,hn,U,u,m),Qb(0,jr,Xi,$r,En,hn,U,u,m),Dn&&(Qb(0,Hi,Ir,$r,Dn,hn,U,u,m),Qb(0,jr,Xi,$r,Dn,hn,U,u,m))),$r=En,ri.push({feature:Xt,shapedTextOrientations:gr,shapedText:Wr,shapedIcon:$r,iconPrimary:Ir,iconSecondary:Xi,iconOffset:Gr,iconAnchor:Hn,verticallyShapedIcon:Dn,layoutTextSize:qi,layoutIconSize:Fr,textOffset:Zi,isSDFIcon:Mn,iconTextFit:hn})}return{featureData:ri,sizes:me,hasAnySecondaryIcon:Tt,textAlongLine:tt,symbolPlacement:Re}},i.fa=Fw,i.fb=function(c,r,l,u,m,x,w,M,N,U){const{featureData:K,hasAnySecondaryIcon:ee,sizes:oe,textAlongLine:me,symbolPlacement:we}=r;for(const Le of K){const{shapedIcon:ze,verticallyShapedIcon:qe,feature:ot,shapedTextOrientations:ct,shapedText:Re,layoutTextSize:tt,textOffset:ut,isSDFIcon:Tt,iconPrimary:ri,iconSecondary:Xt,iconTextFit:si,iconOffset:Ci}=Le;$w(ze,U.iconPositions,ri,Xt),$w(qe,U.iconPositions,ri,Xt),ie(ct,U.iconPositions),jk(ri,Xt,U.iconPositions),(Re||ze)&&P(c,ot,ct,ze,qe,N,oe,tt,0,ut,Tt,u,m,w,M,ee,si,Ci,me,we)}l&&c.generateCollisionDebugBuffers(x,c.collisionBoxArray,oe.textScaleFactor)},i.fc=cs,i.fd=vC,i.fe=hl,i.ff=ls,i.fg=$_,i.fh=za,i.fi=function(c){let r=0;if(new Uint32Array(c,0,1)[0]!==zg){const l=new Uint32Array(c,0,7),[,,u,m,x,w]=l;r=l.byteLength+m+x+w+x,(u!==c.byteLength||r>=c.byteLength)&&tn("Invalid b3dm header information.")}return Px(c,r)},i.fj=function(c,r){const l=qP(c);for(const u of l){for(const m of u.meshes)XV(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(ZV(u.lights,r)))}return l},i.fk=pC,i.fl=_r,i.fm=q0,i.fn=jd,i.fo=Uh,i.fp=function(c){Cs(),Yc!=null&&Yc.then(r=>{r.keys().then(l=>{for(let u=0;u<l.length-c;u++)r.delete(l[u]).catch(m=>tn(m.message))}).catch(l=>tn(l.message))}).catch(r=>tn(r.message))},i.g=function(c,r){return vu(ai(c,{method:"GET"}),r)},i.h=ai,i.i=function(c){return vs.API_STYLE_REGEX.test(c)&&!Po(c)},i.j=function(c){return c.indexOf("mapbox:")===0},i.k=ra,i.l=Xs,i.m=function(c){return decodeURIComponent(atob(c).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.n=function(c,r){return vu(ai(c,{type:"json"}),r)},i.o=qa,i.p=function(c,r){return vu(ai(c,{method:"POST"}),r)},i.q=ch,i.r=Y,i.s=function(c){try{const r=self[c];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=_u,i.u=function(){return function c(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},i.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},i.w=tn,i.x=function(){return kx||(kx=new dm),kx},i.y=sA,i.z=Ll}),d(["./shared"],function(i){function S(vi){const Ge=vi?vi.url.toString():void 0;return Ge?performance.getEntriesByName(Ge):[]}function E(vi){if(typeof vi=="number"||typeof vi=="boolean"||typeof vi=="string"||vi==null)return JSON.stringify(vi);if(Array.isArray(vi)){let Fe="[";for(const rt of vi)Fe+=`${E(rt)},`;return`${Fe}]`}let Ge="{";for(const Fe of Object.keys(vi).sort())Ge+=`${Fe}:${E(vi[Fe])},`;return`${Ge}}`}function L(vi){let Ge="";for(const Fe of i.bu)Ge+=`/${E(vi[Fe])}`;return Ge}class F{constructor(Ge){this.keyCache={},this._layers={},this._layerConfigs={},Ge&&this.replace(Ge)}replace(Ge,Fe){this._layerConfigs={},this._layers={},this.update(Ge,[],Fe)}update(Ge,Fe,rt){this._options=rt;for(const ft of Ge)this._layerConfigs[ft.id]=ft,(this._layers[ft.id]=i.db(ft,this.scope,null,this._options)).compileFilter(rt),this.keyCache[ft.id]&&delete this.keyCache[ft.id];for(const ft of Fe)delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft];this.familiesBySource={};const xt=function(ft,Jt){const xi={};for(let ai=0;ai<ft.length;ai++){const Yi=ft[ai];let Fi=Jt&&Jt[Yi.id];Fi||(Yi.type==="symbol"?Fi=Yi.id:(Fi=L(Yi),Yi.type==="line"&&Yi.paint&&function ln(Qr){return typeof Qr=="string"&&Qr==="line-progress"||(Array.isArray(Qr)?Qr.some(ln):!(!Qr||typeof Qr!="object")&&Object.values(Qr).some(ln))}(Yi.paint["line-width"])&&(Fi+=`/${E(Yi.paint["line-width"])}`))),Jt&&(Jt[Yi.id]=Fi);let Pr=xi[Fi];Pr||(Pr=xi[Fi]=[]),Pr.push(Yi)}const ti=[];for(const ai in xi)ti.push(xi[ai]);return ti}(Object.values(this._layerConfigs),this.keyCache);for(const ft of xt){const Jt=ft.map(Pr=>this._layers[Pr.id]),xi=Jt[0];if(xi.visibility==="none")continue;const ti=xi.source||"";let ai=this.familiesBySource[ti];ai||(ai=this.familiesBySource[ti]={});const Yi=xi.sourceLayer||"_geojsonTileLayer";let Fi=ai[Yi];Fi||(Fi=ai[Yi]=[]),Fi.push(Jt)}}}const G=1*i.e_;class q{constructor(Ge){const Fe={},rt=[];for(const xi in Ge){const ti=Ge[xi],ai=Fe[xi]={};for(const Yi in ti.glyphs){const Fi=ti.glyphs[+Yi];if(!Fi||Fi.bitmap.width===0||Fi.bitmap.height===0)continue;const Pr=Fi.metrics.localGlyph?G:1,ln={x:0,y:0,w:Fi.bitmap.width+2*Pr,h:Fi.bitmap.height+2*Pr};rt.push(ln),ai[Yi]=ln}}const{w:xt,h:ft}=i.H(rt),Jt=new i.eZ({width:xt||1,height:ft||1});for(const xi in Ge){const ti=Ge[xi];for(const ai in ti.glyphs){const Yi=ti.glyphs[+ai];if(!Yi||Yi.bitmap.width===0||Yi.bitmap.height===0)continue;const Fi=Fe[xi][ai],Pr=Yi.metrics.localGlyph?G:1;i.eZ.copy(Yi.bitmap,Jt,{x:0,y:0},{x:Fi.x+Pr,y:Fi.y+Pr},Yi.bitmap)}}this.image=Jt,this.positions=Fe}}i.eY(q,"GlyphAtlas");class Q{constructor(Ge){this.tileID=new i.aM(Ge.tileID.overscaledZ,Ge.tileID.wrap,Ge.tileID.canonical.z,Ge.tileID.canonical.x,Ge.tileID.canonical.y),this.tileZoom=Ge.tileZoom,this.uid=Ge.uid,this.zoom=Ge.zoom,this.lut=Ge.lut,this.canonical=Ge.tileID.canonical,this.pixelRatio=Ge.pixelRatio,this.tileSize=Ge.tileSize,this.source=Ge.source,this.scope=Ge.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ge.showCollisionBoxes,this.collectResourceTiming=!!Ge.request&&Ge.request.collectResourceTiming,this.promoteId=Ge.promoteId,this.isSymbolTile=Ge.isSymbolTile,this.tileTransform=i.aW(Ge.tileID.canonical,Ge.projection),this.projection=Ge.projection,this.worldview=Ge.worldview,this.localizableLayerIds=Ge.localizableLayerIds,this.brightness=Ge.brightness,this.extraShadowCaster=!!Ge.extraShadowCaster,this.tessellationStep=Ge.tessellationStep,this.scaleFactor=Ge.scaleFactor,this.worldview=Ge.worldview}parse(Ge,Fe,rt,xt,ft,Jt){this.status="parsing",this.data=Ge,this.collisionBoxArray=new i.b0;const xi=new i.e$(Object.keys(Ge.layers).sort()),ti=new i.f0(this.tileID,this.promoteId);ti.bucketLayerIDs=[];const ai={},Yi=new i.f1(256,256),Fi={featureIndex:ti,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Yi,availableImages:rt,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Pr=[],ln=Fe.familiesBySource[this.source];for(const Or in ln){const ii=Ge.layers[Or];if(!ii)continue;let xr=!1,Xr=!1,tn=!1;for(const _r of ln[Or])_r[0].type==="symbol"?xr=!0:Xr=!0,_r[0].is3D()&&_r[0].type!=="model"&&(tn=!0);if(this.extraShadowCaster&&!tn||this.isSymbolTile===!0&&!xr||this.isSymbolTile===!1&&!Xr)continue;ii.version===1&&i.w(`Vector tile source "${this.source}" layer "${Or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Jn=xi.encode(Or),ds=[];let mi=!1;for(let _r=0,zi=0;_r<ii.length;_r++){const zr=ii.feature(_r),Yr=ti.getId(zr,Or);if(this.localizableLayerIds&&this.localizableLayerIds.has(Or)){const yr=zr.properties?zr.properties.worldview:null;if(this.worldview&&typeof yr=="string")if(yr==="all")zr.properties.$localized=!0;else{if(!yr.split(",").includes(this.worldview))continue;zr.properties.$localized=!0,zr.properties.worldview=this.worldview}}!mi&&zr.properties&&zr.properties.hasOwnProperty(i.f2)&&(mi=!0),ds.push({feature:zr,id:Yr,index:zi,sourceLayerIndex:Jn}),zi++}mi&&!Fi.elevationFeatures&&Ge.layers.hasOwnProperty(i.f3)&&(Fi.elevationFeatures=i.f4.parseFrom(Ge.layers[i.f3],this.canonical));for(const _r of ln[Or]){const zi=_r[0];if(this.extraShadowCaster&&(!zi.is3D()||zi.type==="model")||this.isSymbolTile!==void 0&&zi.type==="symbol"!==this.isSymbolTile||zi.minzoom&&this.zoom<Math.floor(zi.minzoom)||zi.maxzoom&&this.zoom>=zi.maxzoom||zi.visibility==="none")continue;te(_r,this.zoom,Fi.brightness,rt,this.worldview);const zr=ai[zi.id]=zi.createBucket({index:ti.bucketLayerIDs.length,layers:_r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xt,worldview:this.worldview});ti.bucketLayerIDs.push(_r.map(yr=>i.C(yr.id,yr.scope)));let Yr=zr.prepare?zr.prepare():null;Yr!=null?(Yr=Yr.then(()=>zr.populate(ds,Fi,this.tileID.canonical,this.tileTransform)),Pr.push(Yr)):zr.populate(ds,Fi,this.tileID.canonical,this.tileTransform)}}const Qr=()=>{let Or,ii,xr,Xr,tn,Jn;Yi.trim();const ds={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},mi=()=>{if(Or)return this.status="done",Jt(Or);if(this.extraShadowCaster)this.status="done",Jt(null,{buckets:Object.values(ai).filter(zi=>!zi.isEmpty()),featureIndex:ti,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Fi.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ii&&xr&&Xr){const zi=new q(ii),zr=new Map;for(const[Hr,rn]of xr.entries()){const{imagePosition:is}=i.f7(Hr,rn,i.f8);zr.set(Hr,is)}const Yr={};for(const Hr in ai){const rn=ai[Hr];rn instanceof i.b1&&(te(rn.layers,this.zoom,Fi.brightness,rt,this.worldview),Yr[Hr]=i.f9(rn,ii,zi.positions,xr,zr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,tn,this.worldview))}const yr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ft,xr,tn,()=>{yr.iconsPending=!1,_r(Yr,zi,yr)}),this.rasterizeIfNeeded(ft,Xr,Jn,()=>{yr.patternsPending=!1,_r(Yr,zi,yr)})}},_r=(zi,zr,Yr,yr)=>{if(Yr.iconsPending||Yr.patternsPending)return;const Hr=new i.fa(xr,Xr,this.lut);for(const rn in ai){const is=ai[rn];if(rn in zi)i.fb(is,zi[rn],this.showCollisionBoxes,rt,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,xr,Hr);else if(is.hasPattern&&(is instanceof i.b7||is instanceof i.b8||is instanceof i.dU)){te(is.layers,this.zoom,Fi.brightness,rt,this.worldview);const Ps=Object.fromEntries(Hr.patternPositions);is.addFeatures(Fi,this.tileID.canonical,Ps,rt,this.tileTransform,this.brightness)}}this.status="done",Jt(null,{buckets:Object.values(ai).filter(rn=>!rn.isEmpty()),featureIndex:ti,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zr.image,lineAtlas:Yi,imageAtlas:Hr,brightness:Fi.brightness})};if(!this.extraShadowCaster){const zi=i.f5(Fi.glyphDependencies,yr=>Object.keys(yr).map(Number));Object.keys(zi).length?ft.send("getGlyphs",{uid:this.uid,stacks:zi,scope:this.scope},(yr,Hr)=>{Or||(Or=yr,ii=Hr,mi())},void 0,!1,ds):ii={};const zr=Array.from(Fi.iconDependencies.keys()).map(yr=>i.I.parse(yr));zr.length?ft.send("getImages",{images:zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(yr,Hr)=>{Or||(Or=yr,xr=new Map,tn=this.updateImageMapAndGetImageTaskQueue(xr,Hr,Fi.iconDependencies),mi())},void 0,!1,ds):(xr=new Map,tn=new Map);const Yr=Array.from(Fi.patternDependencies.keys()).map(yr=>i.I.parse(yr));Yr.length?ft.send("getImages",{images:Yr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(yr,Hr)=>{Or||(Or=yr,Xr=new Map,Jn=this.updateImageMapAndGetImageTaskQueue(Xr,Hr,Fi.patternDependencies),mi())},void 0,!1,ds):(Xr=new Map,Jn=new Map)}if(Fi.elevationFeatures&&Fi.elevationFeatures.length>0){const zi=[];for(const Yr of Object.values(ai))if(Yr instanceof i.b8){const yr=Yr.getUnevaluatedPortalGraph();yr&&zi.push(yr)}const zr=i.f6.evaluate(zi);for(const Yr of Object.values(ai))if(Yr instanceof i.b8){const yr=Ge.layers[xi.decode(Yr.sourceLayerIndex)];Yr.setEvaluatedPortalGraph(zr,yr,this.tileID.canonical,Fi.availableImages,Fi.brightness)}}mi()};Pr.length>0?Promise.allSettled(Pr).then(Qr).catch(Jt):Qr()}rasterizeIfNeeded(Ge,Fe,rt,xt){Array.from(Fe.values()).some(ft=>ft.usvg)?this.rasterize(Ge,Fe,rt,xt):xt()}updateImageMapAndGetImageTaskQueue(Ge,Fe,rt){const xt=new Map;for(const ft of Fe.keys()){const Jt=rt.get(ft)||[];for(const xi of Jt){const ti=xi.toString(),ai=Fe.get(xi.id.toString());ai.usvg?xt.has(ti)||(xt.set(ti,xi),Ge.set(ti,Object.assign({},ai))):Ge.set(ti,ai)}}return xt}rasterize(Ge,Fe,rt,xt){this.rasterizeTask=Ge.send("rasterizeImages",{scope:this.scope,tasks:rt},(ft,Jt)=>{if(!ft)for(const[xi,ti]of Jt.entries()){const ai=Object.assign(Fe.get(xi),{data:ti});Fe.set(xi,ai)}xt()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function te(vi,Ge,Fe,rt,xt){const ft=new i.aa(Ge,{brightness:Fe,worldview:xt});for(const Jt of vi)Jt.recalculate(ft,rt)}class he extends i.E{constructor(Ge,Fe,rt,xt,ft,Jt,xi){super(),this.actor=Ge,this.layerIndex=Fe,this.availableImages=rt,this.availableModels=xt,this.loadVectorData=Jt||i.aJ,this.loading={},this.loaded={},this.deduped=new i.aI(Ge.scheduler),this.isSpriteLoaded=ft,this.scheduler=Ge.scheduler,this.brightness=xi}loadTile(Ge,Fe){const rt=Ge.uid,xt=Ge&&Ge.request,ft=xt&&xt.collectResourceTiming,Jt=this.loading[rt]=new Q(Ge);Jt.abort=this.loadVectorData(Ge,(xi,ti)=>{const ai=!this.loading[rt];if(delete this.loading[rt],Jt.cancelRasterize(),ai||xi||!ti)return Jt.status="done",ai||(this.loaded[rt]=Jt),Fe(xi);const Yi=ti.rawData,Fi={};ti.expires&&(Fi.expires=ti.expires),ti.cacheControl&&(Fi.cacheControl=ti.cacheControl),Jt.vectorTile=ti.vectorTile||new i.fc.VectorTile(new i.bq(Yi));const Pr=()=>{Jt.parse(Jt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ln,Qr)=>{if(ln||!Qr)return Fe(ln);const Or={};if(ft){const ii=S(xt);ii.length>0&&(Or.resourceTiming=JSON.parse(JSON.stringify(ii)))}Fe(null,i.h({rawTileData:Yi.slice(0)},Qr,Fi,Or))})};this.isSpriteLoaded?Pr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Pr,{type:"parseTile",isSymbolTile:Ge.isSymbolTile,zoom:Ge.tileZoom}):Pr()}),this.loaded=this.loaded||{},this.loaded[rt]=Jt})}reloadTile(Ge,Fe){const rt=this.loaded,xt=Ge.uid;if(rt&&rt[xt]){const ft=rt[xt];ft.scaleFactor=Ge.scaleFactor,ft.showCollisionBoxes=Ge.showCollisionBoxes,ft.projection=Ge.projection,ft.brightness=Ge.brightness,ft.tileTransform=i.aW(Ge.tileID.canonical,Ge.projection),ft.extraShadowCaster=Ge.extraShadowCaster,ft.lut=Ge.lut,ft.worldview=Ge.worldview;const Jt=(xi,ti)=>{const ai=ft.reloadCallback;ai&&(delete ft.reloadCallback,ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ai)),Fe(xi,ti)};ft.status==="parsing"?ft.reloadCallback=Jt:ft.status==="done"&&(ft.vectorTile?ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Jt):Jt())}else Fe(null,void 0)}abortTile(Ge,Fe){const rt=Ge.uid,xt=this.loading[rt];xt&&(xt.abort&&xt.abort(),delete this.loading[rt]),Fe()}removeTile(Ge,Fe){const rt=this.loaded,xt=Ge.uid;rt&&rt[xt]&&delete rt[xt],Fe()}}class fe{loadTile(Ge,Fe){const{uid:rt,encoding:xt,rawImageData:ft,padding:Jt}=Ge,xi=ImageBitmap&&ft instanceof ImageBitmap?this.getImageData(ft,Jt):ft;Fe(null,new i.fd(rt,xi,xt,Jt<1))}reloadTile(Ge,Fe){Fe(null,null)}abortTile(Ge,Fe){Fe()}removeTile(Ge,Fe){Fe()}getImageData(Ge,Fe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ge.width,Ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ge.width,this.offscreenCanvas.height=Ge.height,this.offscreenCanvasContext.drawImage(Ge,0,0,Ge.width,Ge.height);const rt=this.offscreenCanvasContext.getImageData(-Fe,-Fe,Ge.width+2*Fe,Ge.height+2*Fe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),rt}}i.bp.setPbf(i.bq);class le{constructor(Ge){this._mrt=new i.bp(Ge.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Ge.uid,this.tileID=Ge.tileID,this.source=Ge.source}parse(Ge,Fe){const rt=this._mrt;this.status="parsing",this._entireBuffer=Ge;try{rt.parseHeader(Ge),this._isHeaderLoaded=!0;const xt=[];for(const ft in rt.layers){const Jt=rt.getLayer(ft),xi=Jt.getDataRange(Jt.getBandList()),ti=rt.createDecodingTask(xi),ai=Ge.slice(xi.firstByte,xi.lastByte+1),Yi=i.bp.performDecoding(ai,ti).then(Fi=>ti.complete(null,Fi)).catch(Fi=>ti.complete(Fi,null));xt.push(Yi)}Promise.allSettled(xt).then(()=>Fe(null,rt)).catch(ft=>Fe(ft))}catch(xt){Fe(xt)}}}class Se{constructor(Ge){this.actor=Ge,this.loading={},this.loaded={}}loadTile(Ge,Fe){const rt=Ge.uid,xt=Ge.request,ft=this.loading[rt]=new le(Ge),{cancel:Jt}=i.br(xt,(xi,ti,ai,Yi)=>{const Fi=!this.loading[rt];if(delete this.loading[rt],Fi||xi||!ti)return ft.status="done",Fi||(this.loaded[rt]=ft),Fe(xi);ft.parse(ti,(Pr,ln)=>{if(Pr||!ln)return Fe(Pr);Fe(null,ln,ai,Yi)}),this.loaded[rt]=ft});ft.abort=Jt}reloadTile(Ge,Fe){Fe(null,void 0)}abortTile(Ge,Fe){const rt=Ge.uid,xt=this.loading[rt];xt&&(xt.abort&&xt.abort(),delete this.loading[rt]),Fe()}removeTile(Ge,Fe){const rt=Ge.uid;this.loaded[rt]&&delete this.loaded[rt],Fe()}decodeRasterArray(Ge,Fe){i.bp.performDecoding(Ge.buffer,Ge.task).then(rt=>Fe(null,rt)).catch(rt=>Fe(rt))}}const ke=i.fc.VectorTileFeature.prototype.toGeoJSON;class Ee{constructor(Ge){this._feature=Ge,this.extent=i.aj,this.type=Ge.type,this.properties=Ge.tags,"id"in Ge&&!isNaN(Ge.id)&&(this.id=parseInt(Ge.id,10))}loadGeometry(){if(this._feature.type===1){const Ge=[];for(const Fe of this._feature.geometry)Ge.push([new i.P(Fe[0],Fe[1])]);return Ge}{const Ge=[];for(const Fe of this._feature.geometry){const rt=[];for(const xt of Fe)rt.push(new i.P(xt[0],xt[1]));Ge.push(rt)}return Ge}}toGeoJSON(Ge,Fe,rt){return ke.call(this,Ge,Fe,rt)}}class Ie{constructor(Ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.aj,this.length=Ge.length,this._features=Ge}feature(Ge){return new Ee(this._features[Ge])}}class He{constructor(Ge,Fe){this.name=Ge,this.extent=i.aj,this.length=Fe.length,this._features=Fe}feature(Ge){return new Ee(this._features[Ge])}}class Ye extends Ie{constructor(Ge){super([]),this.layers={};for(const Fe in Ge)this.layers[Fe]=new He(Fe,Ge[Fe])}}const lt=64/4096,Pt=128;class At{constructor(){this.features=new Map}clear(){this.features.clear()}load(Ge=[],Fe){for(const rt of Ge){const xt=rt.id;if(xt==null)continue;let ft=this.features.get(xt);ft&&this.updateCache(ft,Fe),rt.geometry?(ft=Ot(rt),this.updateCache(ft,Fe),this.features.set(xt,ft)):this.features.delete(xt),this.updateCache(ft,Fe)}}updateCache(Ge,Fe){for(const{canonical:rt,uid:xt}of Object.values(Fe)){const{z:ft,x:Jt,y:xi}=rt;ht(Ge,Math.pow(2,ft),Jt,xi)&&delete Fe[xt]}}getTile(Ge,Fe,rt){const xt=Math.pow(2,Ge),ft=[];for(const Jt of this.features.values())ht(Jt,xt,Fe,rt)&&ft.push(Dt(Jt,xt,Fe,rt));return{features:ft}}getFeatures(){return[...this.features.values()]}}function ht({minX:vi,minY:Ge,maxX:Fe,maxY:rt},xt,ft,Jt){return vi<(ft+1+lt)/xt&&Ge<(Jt+1+lt)/xt&&Fe>(ft-lt)/xt&&rt>(Jt-lt)/xt}function Ot(vi){const{id:Ge,geometry:Fe,properties:rt}=vi;if(!Fe)return;if(Fe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:xt,coordinates:ft}=Fe,Jt={id:Ge,type:1,geometry:[],tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},xi=Jt.geometry;if(xt==="Point")Ae(ft,xi,Jt);else if(xt==="MultiPoint")for(const ti of ft)Ae(ti,xi,Jt);else if(xt==="LineString")Jt.type=2,mt(ft,xi,Jt);else if(xt==="MultiLineString")Jt.type=2,bt(ft,xi,Jt);else if(xt==="Polygon")Jt.type=3,bt(ft,xi,Jt,!0);else{if(xt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Jt.type=3;for(const ti of ft)bt(ti,xi,Jt,!0)}return Jt}function Ae([vi,Ge],Fe,rt){const xt=i.aD(vi);let ft=i.aH(Ge);ft=ft<0?0:ft>1?1:ft,Fe.push(xt,ft),rt.minX=Math.min(rt.minX,xt),rt.minY=Math.min(rt.minY,ft),rt.maxX=Math.max(rt.maxX,xt),rt.maxY=Math.max(rt.maxY,ft)}function mt(vi,Ge,Fe,rt=!1,xt=!1){const ft=[];for(const Jt of vi)Ae(Jt,ft,Fe);Ge.push(ft),rt&&function(Jt,xi){let ti=0;for(let ai=0,Yi=Jt.length,Fi=Yi-2;ai<Yi;Fi=ai,ai+=2)ti+=(Jt[ai]-Jt[Fi])*(Jt[ai+1]+Jt[Fi+1]);if(ti>0===xi)for(let ai=0,Yi=Jt.length;ai<Yi/2;ai+=2){const Fi=Jt[ai],Pr=Jt[ai+1];Jt[ai]=Jt[Yi-2-ai],Jt[ai+1]=Jt[Yi-1-ai],Jt[Yi-2-ai]=Fi,Jt[Yi-1-ai]=Pr}}(ft,xt)}function bt(vi,Ge,Fe,rt=!1){for(let xt=0;xt<vi.length;xt++)mt(vi[xt],Ge,Fe,rt,xt===0)}function Dt(vi,Ge,Fe,rt){const{id:xt,type:ft,geometry:Jt,tags:xi}=vi,ti=[];if(ft===1)(function(ai,Yi,Fi,Pr,ln){for(let Qr=0;Qr<ai.length;Qr+=2){const Or=Math.round(i.aj*(ai[Qr+0]*Yi-Fi)),ii=Math.round(i.aj*(ai[Qr+1]*Yi-Pr));ln.push([Or,ii])}})(Jt,Ge,Fe,rt,ti);else for(const ai of Jt)Je(ai,Ge,Fe,rt,ti);return{id:xt,type:ft,geometry:ti,tags:xi}}function Je(vi,Ge,Fe,rt,xt){const Jt=i.aj+Pt;let xi;for(let ti=0;ti<vi.length-2;ti+=2){let ai=Math.round(i.aj*(vi[ti+0]*Ge-Fe)),Yi=Math.round(i.aj*(vi[ti+1]*Ge-rt)),Fi=Math.round(i.aj*(vi[ti+2]*Ge-Fe)),Pr=Math.round(i.aj*(vi[ti+3]*Ge-rt));const ln=Fi-ai,Qr=Pr-Yi;ai<-128&&Fi<-128||(ai<-128?(Yi+=Math.round(Qr*((-128-ai)/ln)),ai=-128):Fi<-128&&(Pr=Yi+Math.round(Qr*((-128-ai)/ln)),Fi=-128),Yi<-128&&Pr<-128||(Yi<-128?(ai+=Math.round(ln*((-128-Yi)/Qr)),Yi=-128):Pr<-128&&(Fi=ai+Math.round(ln*((-128-Yi)/Qr)),Pr=-128),ai>=Jt&&Fi>=Jt||(ai>=Jt?(Yi+=Math.round(Qr*((Jt-ai)/ln)),ai=Jt):Fi>=Jt&&(Pr=Yi+Math.round(Qr*((Jt-ai)/ln)),Fi=Jt),Yi>=Jt&&Pr>=Jt||(Yi>=Jt?(ai+=Math.round(ln*((Jt-Yi)/Qr)),Yi=Jt):Pr>=Jt&&(Fi=ai+Math.round(ln*((Jt-Yi)/Qr)),Pr=Jt),xi&&ai===xi[xi.length-1][0]&&Yi===xi[xi.length-1][1]||(xi=[[ai,Yi]],xt.push(xi)),xi.push([Fi,Pr])))))}}var dt,ui,Vt,ei={exports:{}},ur=function(){if(Vt)return ei.exports;Vt=1;var vi=i.fg(),Ge=function(){if(ui)return dt;ui=1;var Yi=i.fe(),Fi=i.ff().VectorTileFeature;function Pr(Qr,Or){this.options=Or||{},this.features=Qr,this.length=Qr.length}function ln(Qr,Or){this.id=typeof Qr.id=="number"?Qr.id:void 0,this.type=Qr.type,this.rawGeometry=Qr.type===1?[Qr.geometry]:Qr.geometry,this.properties=Qr.tags,this.extent=Or||4096}return dt=Pr,Pr.prototype.feature=function(Qr){return new ln(this.features[Qr],this.options.extent)},ln.prototype.loadGeometry=function(){var Qr=this.rawGeometry;this.geometry=[];for(var Or=0;Or<Qr.length;Or++){for(var ii=Qr[Or],xr=[],Xr=0;Xr<ii.length;Xr++)xr.push(new Yi(ii[Xr][0],ii[Xr][1]));this.geometry.push(xr)}return this.geometry},ln.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qr=this.geometry,Or=1/0,ii=-1/0,xr=1/0,Xr=-1/0,tn=0;tn<Qr.length;tn++)for(var Jn=Qr[tn],ds=0;ds<Jn.length;ds++){var mi=Jn[ds];Or=Math.min(Or,mi.x),ii=Math.max(ii,mi.x),xr=Math.min(xr,mi.y),Xr=Math.max(Xr,mi.y)}return[Or,xr,ii,Xr]},ln.prototype.toGeoJSON=Fi.prototype.toGeoJSON,dt}();function Fe(Yi){var Fi=new vi;return function(Pr,ln){for(var Qr in Pr.layers)ln.writeMessage(3,rt,Pr.layers[Qr])}(Yi,Fi),Fi.finish()}function rt(Yi,Fi){var Pr;Fi.writeVarintField(15,Yi.version||1),Fi.writeStringField(1,Yi.name||""),Fi.writeVarintField(5,Yi.extent||4096);var ln={keys:[],values:[],keycache:{},valuecache:{}};for(Pr=0;Pr<Yi.length;Pr++)ln.feature=Yi.feature(Pr),Fi.writeMessage(2,xt,ln);var Qr=ln.keys;for(Pr=0;Pr<Qr.length;Pr++)Fi.writeStringField(3,Qr[Pr]);var Or=ln.values;for(Pr=0;Pr<Or.length;Pr++)Fi.writeMessage(4,ai,Or[Pr])}function xt(Yi,Fi){var Pr=Yi.feature;Pr.id!==void 0&&Fi.writeVarintField(1,Pr.id),Fi.writeMessage(2,ft,Yi),Fi.writeVarintField(3,Pr.type),Fi.writeMessage(4,ti,Pr)}function ft(Yi,Fi){var Pr=Yi.feature,ln=Yi.keys,Qr=Yi.values,Or=Yi.keycache,ii=Yi.valuecache;for(var xr in Pr.properties){var Xr=Pr.properties[xr],tn=Or[xr];if(Xr!==null){tn===void 0&&(ln.push(xr),Or[xr]=tn=ln.length-1),Fi.writeVarint(tn);var Jn=typeof Xr;Jn!=="string"&&Jn!=="boolean"&&Jn!=="number"&&(Xr=JSON.stringify(Xr));var ds=Jn+":"+Xr,mi=ii[ds];mi===void 0&&(Qr.push(Xr),ii[ds]=mi=Qr.length-1),Fi.writeVarint(mi)}}}function Jt(Yi,Fi){return(Fi<<3)+(7&Yi)}function xi(Yi){return Yi<<1^Yi>>31}function ti(Yi,Fi){for(var Pr=Yi.loadGeometry(),ln=Yi.type,Qr=0,Or=0,ii=Pr.length,xr=0;xr<ii;xr++){var Xr=Pr[xr],tn=1;ln===1&&(tn=Xr.length),Fi.writeVarint(Jt(1,tn));for(var Jn=ln===3?Xr.length-1:Xr.length,ds=0;ds<Jn;ds++){ds===1&&ln!==1&&Fi.writeVarint(Jt(2,Jn-1));var mi=Xr[ds].x-Qr,_r=Xr[ds].y-Or;Fi.writeVarint(xi(mi)),Fi.writeVarint(xi(_r)),Qr+=mi,Or+=_r}ln===3&&Fi.writeVarint(Jt(7,1))}}function ai(Yi,Fi){var Pr=typeof Yi;Pr==="string"?Fi.writeStringField(1,Yi):Pr==="boolean"?Fi.writeBooleanField(7,Yi):Pr==="number"&&(Yi%1!=0?Fi.writeDoubleField(3,Yi):Yi<0?Fi.writeSVarintField(6,Yi):Fi.writeVarintField(5,Yi))}return ei.exports=Fe,ei.exports.fromVectorTileJs=Fe,ei.exports.fromGeojsonVt=function(Yi,Fi){Fi=Fi||{};var Pr={};for(var ln in Yi)Pr[ln]=new Ge(Yi[ln].features,Fi),Pr[ln].name=ln,Pr[ln].version=Fi.version,Pr[ln].extent=Fi.extent;return Fe({layers:Pr})},ei.exports.GeoJSONWrapper=Ge,ei.exports}(),Zt=i.fh(ur);const Kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vi=>vi},Ui=Math.fround||(rr=new Float32Array(1),vi=>(rr[0]=+vi,rr[0]));var rr;const gi=3,Oi=5,cr=6;class ji{constructor(Ge){this.options=Object.assign(Object.create(Kt),Ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ge){const{log:Fe,minZoom:rt,maxZoom:xt}=this.options;Fe&&console.time("total time");const ft=`prepare ${Ge.length} points`;Fe&&console.time(ft),this.points=Ge;const Jt=[];for(let ti=0;ti<Ge.length;ti++){const ai=Ge[ti];if(!ai.geometry)continue;const[Yi,Fi]=ai.geometry.coordinates,Pr=Ui(Ue(Yi)),ln=Ui(ni(Fi));Jt.push(Pr,ln,1/0,ti,-1,1),this.options.reduce&&Jt.push(0)}let xi=this.trees[xt+1]=this._createTree(Jt);Fe&&console.timeEnd(ft);for(let ti=xt;ti>=rt;ti--){const ai=+Date.now();xi=this.trees[ti]=this._createTree(this._cluster(xi,ti)),Fe&&console.log("z%d: %d clusters in %dms",ti,xi.numItems,+Date.now()-ai)}return Fe&&console.timeEnd("total time"),this}getClusters(Ge,Fe){let rt=((Ge[0]+180)%360+360)%360-180;const xt=Math.max(-90,Math.min(90,Ge[1]));let ft=Ge[2]===180?180:((Ge[2]+180)%360+360)%360-180;const Jt=Math.max(-90,Math.min(90,Ge[3]));if(Ge[2]-Ge[0]>=360)rt=-180,ft=180;else if(rt>ft){const Fi=this.getClusters([rt,xt,180,Jt],Fe),Pr=this.getClusters([-180,xt,ft,Jt],Fe);return Fi.concat(Pr)}const xi=this.trees[this._limitZoom(Fe)],ti=xi.range(Ue(rt),ni(Jt),Ue(ft),ni(xt)),ai=xi.data,Yi=[];for(const Fi of ti){const Pr=this.stride*Fi;Yi.push(ai[Pr+Oi]>1?nn(ai,Pr,this.clusterProps):this.points[ai[Pr+gi]])}return Yi}getChildren(Ge){const Fe=this._getOriginId(Ge),rt=this._getOriginZoom(Ge),xt="No cluster with the specified id.",ft=this.trees[rt];if(!ft)throw new Error(xt);const Jt=ft.data;if(Fe*this.stride>=Jt.length)throw new Error(xt);const xi=this.options.radius/(this.options.extent*Math.pow(2,rt-1)),ti=ft.within(Jt[Fe*this.stride],Jt[Fe*this.stride+1],xi),ai=[];for(const Yi of ti){const Fi=Yi*this.stride;Jt[Fi+4]===Ge&&ai.push(Jt[Fi+Oi]>1?nn(Jt,Fi,this.clusterProps):this.points[Jt[Fi+gi]])}if(ai.length===0)throw new Error(xt);return ai}getLeaves(Ge,Fe,rt){const xt=[];return this._appendLeaves(xt,Ge,Fe=Fe||10,rt=rt||0,0),xt}getTile(Ge,Fe,rt){const xt=this.trees[this._limitZoom(Ge)],ft=Math.pow(2,Ge),{extent:Jt,radius:xi}=this.options,ti=xi/Jt,ai=(rt-ti)/ft,Yi=(rt+1+ti)/ft,Fi={features:[]};return this._addTileFeatures(xt.range((Fe-ti)/ft,ai,(Fe+1+ti)/ft,Yi),xt.data,Fe,rt,ft,Fi),Fe===0&&this._addTileFeatures(xt.range(1-ti/ft,ai,1,Yi),xt.data,ft,rt,ft,Fi),Fe===ft-1&&this._addTileFeatures(xt.range(0,ai,ti/ft,Yi),xt.data,-1,rt,ft,Fi),Fi.features.length?Fi:null}getClusterExpansionZoom(Ge){let Fe=this._getOriginZoom(Ge)-1;for(;Fe<=this.options.maxZoom;){const rt=this.getChildren(Ge);if(Fe++,rt.length!==1)break;Ge=rt[0].properties.cluster_id}return Fe}_appendLeaves(Ge,Fe,rt,xt,ft){const Jt=this.getChildren(Fe);for(const xi of Jt){const ti=xi.properties;if(ti&&ti.cluster?ft+ti.point_count<=xt?ft+=ti.point_count:ft=this._appendLeaves(Ge,ti.cluster_id,rt,xt,ft):ft<xt?ft++:Ge.push(xi),Ge.length===rt)break}return ft}_createTree(Ge){const Fe=new i.bW(Ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let rt=0;rt<Ge.length;rt+=this.stride)Fe.add(Ge[rt],Ge[rt+1]);return Fe.finish(),Fe.data=Ge,Fe}_addTileFeatures(Ge,Fe,rt,xt,ft,Jt){for(const xi of Ge){const ti=xi*this.stride,ai=Fe[ti+Oi]>1;let Yi,Fi,Pr;if(ai)Yi=pr(Fe,ti,this.clusterProps),Fi=Fe[ti],Pr=Fe[ti+1];else{const Or=this.points[Fe[ti+gi]];Yi=Or.properties;const[ii,xr]=Or.geometry.coordinates;Fi=Ue(ii),Pr=ni(xr)}const ln={type:1,geometry:[[Math.round(this.options.extent*(Fi*ft-rt)),Math.round(this.options.extent*(Pr*ft-xt))]],tags:Yi};let Qr;Qr=ai||this.options.generateId?Fe[ti+gi]:this.points[Fe[ti+gi]].id,Qr!==void 0&&(ln.id=Qr),Jt.features.push(ln)}}_limitZoom(Ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ge),this.options.maxZoom+1))}_cluster(Ge,Fe){const{radius:rt,extent:xt,reduce:ft,minPoints:Jt}=this.options,xi=rt/(xt*Math.pow(2,Fe)),ti=Ge.data,ai=[],Yi=this.stride;for(let Fi=0;Fi<ti.length;Fi+=Yi){if(ti[Fi+2]<=Fe)continue;ti[Fi+2]=Fe;const Pr=ti[Fi],ln=ti[Fi+1],Qr=Ge.within(ti[Fi],ti[Fi+1],xi),Or=ti[Fi+Oi];let ii=Or;for(const xr of Qr){const Xr=xr*Yi;ti[Xr+2]>Fe&&(ii+=ti[Xr+Oi])}if(ii>Or&&ii>=Jt){let xr,Xr=Pr*Or,tn=ln*Or,Jn=-1;const ds=(Fi/Yi<<5)+(Fe+1)+this.points.length;for(const mi of Qr){const _r=mi*Yi;if(ti[_r+2]<=Fe)continue;ti[_r+2]=Fe;const zi=ti[_r+Oi];Xr+=ti[_r]*zi,tn+=ti[_r+1]*zi,ti[_r+4]=ds,ft&&(xr||(xr=this._map(ti,Fi,!0),Jn=this.clusterProps.length,this.clusterProps.push(xr)),ft(xr,this._map(ti,_r)))}ti[Fi+4]=ds,ai.push(Xr/ii,tn/ii,1/0,ds,-1,ii),ft&&ai.push(Jn)}else{for(let xr=0;xr<Yi;xr++)ai.push(ti[Fi+xr]);if(ii>1)for(const xr of Qr){const Xr=xr*Yi;if(!(ti[Xr+2]<=Fe)){ti[Xr+2]=Fe;for(let tn=0;tn<Yi;tn++)ai.push(ti[Xr+tn])}}}}return ai}_getOriginId(Ge){return Ge-this.points.length>>5}_getOriginZoom(Ge){return(Ge-this.points.length)%32}_map(Ge,Fe,rt){if(Ge[Fe+Oi]>1){const Jt=this.clusterProps[Ge[Fe+cr]];return rt?Object.assign({},Jt):Jt}const xt=this.points[Ge[Fe+gi]].properties,ft=this.options.map(xt);return rt&&ft===xt?Object.assign({},ft):ft}}function nn(vi,Ge,Fe){return{type:"Feature",id:vi[Ge+gi],properties:pr(vi,Ge,Fe),geometry:{type:"Point",coordinates:[(rt=vi[Ge],360*(rt-.5)),fi(vi[Ge+1])]}};var rt}function pr(vi,Ge,Fe){const rt=vi[Ge+Oi],xt=rt>=1e4?`${Math.round(rt/1e3)}k`:rt>=1e3?Math.round(rt/100)/10+"k":rt,ft=vi[Ge+cr],Jt=ft===-1?{}:Object.assign({},Fe[ft]);return Object.assign(Jt,{cluster:!0,cluster_id:vi[Ge+gi],point_count:rt,point_count_abbreviated:xt})}function Ue(vi){return vi/360+.5}function ni(vi){const Ge=Math.sin(vi*Math.PI/180),Fe=.5-.25*Math.log((1+Ge)/(1-Ge))/Math.PI;return Fe<0?0:Fe>1?1:Fe}function fi(vi){const Ge=(180-360*vi)*Math.PI/180;return 360*Math.atan(Math.exp(Ge))/Math.PI-90}function Lt(vi,Ge,Fe,rt){let xt=rt;const ft=Ge+(Fe-Ge>>1);let Jt,xi=Fe-Ge;const ti=vi[Ge],ai=vi[Ge+1],Yi=vi[Fe],Fi=vi[Fe+1];for(let Pr=Ge+3;Pr<Fe;Pr+=3){const ln=pt(vi[Pr],vi[Pr+1],ti,ai,Yi,Fi);if(ln>xt)Jt=Pr,xt=ln;else if(ln===xt){const Qr=Math.abs(Pr-ft);Qr<xi&&(Jt=Pr,xi=Qr)}}xt>rt&&(Jt-Ge>3&&Lt(vi,Ge,Jt,rt),vi[Jt+2]=xt,Fe-Jt>3&&Lt(vi,Jt,Fe,rt))}function pt(vi,Ge,Fe,rt,xt,ft){let Jt=xt-Fe,xi=ft-rt;if(Jt!==0||xi!==0){const ti=((vi-Fe)*Jt+(Ge-rt)*xi)/(Jt*Jt+xi*xi);ti>1?(Fe=xt,rt=ft):ti>0&&(Fe+=Jt*ti,rt+=xi*ti)}return Jt=vi-Fe,xi=Ge-rt,Jt*Jt+xi*xi}function Nt(vi,Ge,Fe,rt){const xt={id:vi??null,type:Ge,geometry:Fe,tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")Si(xt,Fe);else if(Ge==="Polygon")Si(xt,Fe[0]);else if(Ge==="MultiLineString")for(const ft of Fe)Si(xt,ft);else if(Ge==="MultiPolygon")for(const ft of Fe)Si(xt,ft[0]);return xt}function Si(vi,Ge){for(let Fe=0;Fe<Ge.length;Fe+=3)vi.minX=Math.min(vi.minX,Ge[Fe]),vi.minY=Math.min(vi.minY,Ge[Fe+1]),vi.maxX=Math.max(vi.maxX,Ge[Fe]),vi.maxY=Math.max(vi.maxY,Ge[Fe+1])}function pi(vi,Ge,Fe,rt){if(!Ge.geometry)return;const xt=Ge.geometry.coordinates;if(xt&&xt.length===0)return;const ft=Ge.geometry.type,Jt=Math.pow(Fe.tolerance/((1<<Fe.maxZoom)*Fe.extent),2);let xi=[],ti=Ge.id;if(Fe.promoteId?ti=Ge.properties[Fe.promoteId]:Fe.generateId&&(ti=rt||0),ft==="Point")St(xt,xi);else if(ft==="MultiPoint")for(const ai of xt)St(ai,xi);else if(ft==="LineString")Ht(xt,xi,Jt,!1);else if(ft==="MultiLineString"){if(Fe.lineMetrics){for(const ai of xt)xi=[],Ht(ai,xi,Jt,!1),vi.push(Nt(ti,"LineString",xi,Ge.properties));return}nr(xt,xi,Jt,!1)}else if(ft==="Polygon")nr(xt,xi,Jt,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(const ai of Ge.geometry.geometries)pi(vi,{id:ti,geometry:ai,properties:Ge.properties},Fe,rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ai of xt){const Yi=[];nr(ai,Yi,Jt,!0),xi.push(Yi)}}vi.push(Nt(ti,ft,xi,Ge.properties))}function St(vi,Ge){Ge.push(tr(vi[0]),kr(vi[1]),0)}function Ht(vi,Ge,Fe,rt){let xt,ft,Jt=0;for(let ti=0;ti<vi.length;ti++){const ai=tr(vi[ti][0]),Yi=kr(vi[ti][1]);Ge.push(ai,Yi,0),ti>0&&(Jt+=rt?(xt*Yi-ai*ft)/2:Math.sqrt(Math.pow(ai-xt,2)+Math.pow(Yi-ft,2))),xt=ai,ft=Yi}const xi=Ge.length-3;Ge[2]=1,Lt(Ge,0,xi,Fe),Ge[xi+2]=1,Ge.size=Math.abs(Jt),Ge.start=0,Ge.end=Ge.size}function nr(vi,Ge,Fe,rt){for(let xt=0;xt<vi.length;xt++){const ft=[];Ht(vi[xt],ft,Fe,rt),Ge.push(ft)}}function tr(vi){return vi/360+.5}function kr(vi){const Ge=Math.sin(vi*Math.PI/180),Fe=.5-.25*Math.log((1+Ge)/(1-Ge))/Math.PI;return Fe<0?0:Fe>1?1:Fe}function Mr(vi,Ge,Fe,rt,xt,ft,Jt,xi){if(rt/=Ge,ft>=(Fe/=Ge)&&Jt<rt)return vi;if(Jt<Fe||ft>=rt)return null;const ti=[];for(const ai of vi){const Yi=ai.geometry;let Fi=ai.type;const Pr=xt===0?ai.minX:ai.minY,ln=xt===0?ai.maxX:ai.maxY;if(Pr>=Fe&&ln<rt){ti.push(ai);continue}if(ln<Fe||Pr>=rt)continue;let Qr=[];if(Fi==="Point"||Fi==="MultiPoint")Cr(Yi,Qr,Fe,rt,xt);else if(Fi==="LineString")Tn(Yi,Qr,Fe,rt,xt,!1,xi.lineMetrics);else if(Fi==="MultiLineString")wn(Yi,Qr,Fe,rt,xt,!1);else if(Fi==="Polygon")wn(Yi,Qr,Fe,rt,xt,!0);else if(Fi==="MultiPolygon")for(const Or of Yi){const ii=[];wn(Or,ii,Fe,rt,xt,!0),ii.length&&Qr.push(ii)}if(Qr.length){if(xi.lineMetrics&&Fi==="LineString"){for(const Or of Qr)ti.push(Nt(ai.id,Fi,Or,ai.tags));continue}Fi!=="LineString"&&Fi!=="MultiLineString"||(Qr.length===1?(Fi="LineString",Qr=Qr[0]):Fi="MultiLineString"),Fi!=="Point"&&Fi!=="MultiPoint"||(Fi=Qr.length===3?"Point":"MultiPoint"),ti.push(Nt(ai.id,Fi,Qr,ai.tags))}}return ti.length?ti:null}function Cr(vi,Ge,Fe,rt,xt){for(let ft=0;ft<vi.length;ft+=3){const Jt=vi[ft+xt];Jt>=Fe&&Jt<=rt&&bs(Ge,vi[ft],vi[ft+1],vi[ft+2])}}function Tn(vi,Ge,Fe,rt,xt,ft,Jt){let xi=gs(vi);const ti=xt===0?qn:Ls;let ai,Yi,Fi=vi.start;for(let ii=0;ii<vi.length-3;ii+=3){const xr=vi[ii],Xr=vi[ii+1],tn=vi[ii+2],Jn=vi[ii+3],ds=vi[ii+4],mi=xt===0?xr:Xr,_r=xt===0?Jn:ds;let zi=!1;Jt&&(ai=Math.sqrt(Math.pow(xr-Jn,2)+Math.pow(Xr-ds,2))),mi<Fe?_r>Fe&&(Yi=ti(xi,xr,Xr,Jn,ds,Fe),Jt&&(xi.start=Fi+ai*Yi)):mi>rt?_r<rt&&(Yi=ti(xi,xr,Xr,Jn,ds,rt),Jt&&(xi.start=Fi+ai*Yi)):bs(xi,xr,Xr,tn),_r<Fe&&mi>=Fe&&(Yi=ti(xi,xr,Xr,Jn,ds,Fe),zi=!0),_r>rt&&mi<=rt&&(Yi=ti(xi,xr,Xr,Jn,ds,rt),zi=!0),!ft&&zi&&(Jt&&(xi.end=Fi+ai*Yi),Ge.push(xi),xi=gs(vi)),Jt&&(Fi+=ai)}let Pr=vi.length-3;const ln=vi[Pr],Qr=vi[Pr+1],Or=xt===0?ln:Qr;Or>=Fe&&Or<=rt&&bs(xi,ln,Qr,vi[Pr+2]),Pr=xi.length-3,ft&&Pr>=3&&(xi[Pr]!==xi[0]||xi[Pr+1]!==xi[1])&&bs(xi,xi[0],xi[1],xi[2]),xi.length&&Ge.push(xi)}function gs(vi){const Ge=[];return Ge.size=vi.size,Ge.start=vi.start,Ge.end=vi.end,Ge}function wn(vi,Ge,Fe,rt,xt,ft){for(const Jt of vi)Tn(Jt,Ge,Fe,rt,xt,ft,!1)}function bs(vi,Ge,Fe,rt){vi.push(Ge,Fe,rt)}function qn(vi,Ge,Fe,rt,xt,ft){const Jt=(ft-Ge)/(rt-Ge);return bs(vi,ft,Fe+(xt-Fe)*Jt,1),Jt}function Ls(vi,Ge,Fe,rt,xt,ft){const Jt=(ft-Fe)/(xt-Fe);return bs(vi,Ge+(rt-Ge)*Jt,ft,1),Jt}function ma(vi,Ge){const Fe=[];for(let rt=0;rt<vi.length;rt++){const xt=vi[rt],ft=xt.type;let Jt;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")Jt=Ln(xt.geometry,Ge);else if(ft==="MultiLineString"||ft==="Polygon"){Jt=[];for(const xi of xt.geometry)Jt.push(Ln(xi,Ge))}else if(ft==="MultiPolygon"){Jt=[];for(const xi of xt.geometry){const ti=[];for(const ai of xi)ti.push(Ln(ai,Ge));Jt.push(ti)}}Fe.push(Nt(xt.id,ft,Jt,xt.tags))}return Fe}function Ln(vi,Ge){const Fe=[];Fe.size=vi.size,vi.start!==void 0&&(Fe.start=vi.start,Fe.end=vi.end);for(let rt=0;rt<vi.length;rt+=3)Fe.push(vi[rt]+Ge,vi[rt+1],vi[rt+2]);return Fe}function qo(vi,Ge){if(vi.transformed)return vi;const Fe=1<<vi.z,rt=vi.x,xt=vi.y;for(const ft of vi.features){const Jt=ft.geometry,xi=ft.type;if(ft.geometry=[],xi===1)for(let ti=0;ti<Jt.length;ti+=2)ft.geometry.push(zn(Jt[ti],Jt[ti+1],Ge,Fe,rt,xt));else for(let ti=0;ti<Jt.length;ti++){const ai=[];for(let Yi=0;Yi<Jt[ti].length;Yi+=2)ai.push(zn(Jt[ti][Yi],Jt[ti][Yi+1],Ge,Fe,rt,xt));ft.geometry.push(ai)}}return vi.transformed=!0,vi}function zn(vi,Ge,Fe,rt,xt,ft){return[Math.round(Fe*(vi*rt-xt)),Math.round(Fe*(Ge*rt-ft))]}function za(vi,Ge,Fe,rt,xt){const ft=Ge===xt.maxZoom?0:xt.tolerance/((1<<Ge)*xt.extent),Jt={features:[],numPoints:0,numSimplified:0,numFeatures:vi.length,source:null,x:Fe,y:rt,z:Ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xi of vi)$o(Jt,xi,ft,xt);return Jt}function $o(vi,Ge,Fe,rt){const xt=Ge.geometry,ft=Ge.type,Jt=[];if(vi.minX=Math.min(vi.minX,Ge.minX),vi.minY=Math.min(vi.minY,Ge.minY),vi.maxX=Math.max(vi.maxX,Ge.maxX),vi.maxY=Math.max(vi.maxY,Ge.maxY),ft==="Point"||ft==="MultiPoint")for(let xi=0;xi<xt.length;xi+=3)Jt.push(xt[xi],xt[xi+1]),vi.numPoints++,vi.numSimplified++;else if(ft==="LineString")Aa(Jt,xt,vi,Fe,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(let xi=0;xi<xt.length;xi++)Aa(Jt,xt[xi],vi,Fe,ft==="Polygon",xi===0);else if(ft==="MultiPolygon")for(let xi=0;xi<xt.length;xi++){const ti=xt[xi];for(let ai=0;ai<ti.length;ai++)Aa(Jt,ti[ai],vi,Fe,!0,ai===0)}if(Jt.length){let xi=Ge.tags||null;if(ft==="LineString"&&rt.lineMetrics){xi={};for(const ai in Ge.tags)xi[ai]=Ge.tags[ai];xi.mapbox_clip_start=xt.start/xt.size,xi.mapbox_clip_end=xt.end/xt.size}const ti={geometry:Jt,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:xi};Ge.id!==null&&(ti.id=Ge.id),vi.features.push(ti)}}function Aa(vi,Ge,Fe,rt,xt,ft){const Jt=rt*rt;if(rt>0&&Ge.size<(xt?Jt:rt))return void(Fe.numPoints+=Ge.length/3);const xi=[];for(let ti=0;ti<Ge.length;ti+=3)(rt===0||Ge[ti+2]>Jt)&&(Fe.numSimplified++,xi.push(Ge[ti],Ge[ti+1])),Fe.numPoints++;xt&&function(ti,ai){let Yi=0;for(let Fi=0,Pr=ti.length,ln=Pr-2;Fi<Pr;ln=Fi,Fi+=2)Yi+=(ti[Fi]-ti[ln])*(ti[Fi+1]+ti[ln+1]);if(Yi>0===ai)for(let Fi=0,Pr=ti.length;Fi<Pr/2;Fi+=2){const ln=ti[Fi],Qr=ti[Fi+1];ti[Fi]=ti[Pr-2-Fi],ti[Fi+1]=ti[Pr-1-Fi],ti[Pr-2-Fi]=ln,ti[Pr-1-Fi]=Qr}}(xi,ft),vi.push(xi)}const ja={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yn{constructor(Ge,Fe){const rt=(Fe=this.options=function(ft,Jt){for(const xi in Jt)ft[xi]=Jt[xi];return ft}(Object.create(ja),Fe)).debug;if(rt&&console.time("preprocess data"),Fe.maxZoom<0||Fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Fe.promoteId&&Fe.generateId)throw new Error("promoteId and generateId cannot be used together.");let xt=function(ft,Jt){const xi=[];if(ft.type==="FeatureCollection")for(let ti=0;ti<ft.features.length;ti++)pi(xi,ft.features[ti],Jt,ti);else pi(xi,ft.type==="Feature"?ft:{geometry:ft},Jt);return xi}(Ge,Fe);this.tiles={},this.tileCoords=[],rt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Fe.indexMaxZoom,Fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xt=function(ft,Jt){const xi=Jt.buffer/Jt.extent;let ti=ft;const ai=Mr(ft,1,-1-xi,xi,0,-1,2,Jt),Yi=Mr(ft,1,1-xi,2+xi,0,-1,2,Jt);return(ai||Yi)&&(ti=Mr(ft,1,-xi,1+xi,0,-1,2,Jt)||[],ai&&(ti=ma(ai,1).concat(ti)),Yi&&(ti=ti.concat(ma(Yi,-1)))),ti}(xt,Fe),xt.length&&this.splitTile(xt,0,0,0),rt&&(xt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ge,Fe,rt,xt,ft,Jt,xi){const ti=[Ge,Fe,rt,xt],ai=this.options,Yi=ai.debug;for(;ti.length;){xt=ti.pop(),rt=ti.pop(),Fe=ti.pop(),Ge=ti.pop();const Fi=1<<Fe,Pr=hl(Fe,rt,xt);let ln=this.tiles[Pr];if(!ln&&(Yi>1&&console.time("creation"),ln=this.tiles[Pr]=za(Ge,Fe,rt,xt,ai),this.tileCoords.push({z:Fe,x:rt,y:xt}),Yi)){Yi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Fe,rt,xt,ln.numFeatures,ln.numPoints,ln.numSimplified),console.timeEnd("creation"));const zi=`z${Fe}`;this.stats[zi]=(this.stats[zi]||0)+1,this.total++}if(ln.source=Ge,ft==null){if(Fe===ai.indexMaxZoom||ln.numPoints<=ai.indexMaxPoints)continue}else{if(Fe===ai.maxZoom||Fe===ft)continue;if(ft!=null){const zi=ft-Fe;if(rt!==Jt>>zi||xt!==xi>>zi)continue}}if(ln.source=null,Ge.length===0)continue;Yi>1&&console.time("clipping");const Qr=.5*ai.buffer/ai.extent,Or=.5-Qr,ii=.5+Qr,xr=1+Qr;let Xr=null,tn=null,Jn=null,ds=null,mi=Mr(Ge,Fi,rt-Qr,rt+ii,0,ln.minX,ln.maxX,ai),_r=Mr(Ge,Fi,rt+Or,rt+xr,0,ln.minX,ln.maxX,ai);Ge=null,mi&&(Xr=Mr(mi,Fi,xt-Qr,xt+ii,1,ln.minY,ln.maxY,ai),tn=Mr(mi,Fi,xt+Or,xt+xr,1,ln.minY,ln.maxY,ai),mi=null),_r&&(Jn=Mr(_r,Fi,xt-Qr,xt+ii,1,ln.minY,ln.maxY,ai),ds=Mr(_r,Fi,xt+Or,xt+xr,1,ln.minY,ln.maxY,ai),_r=null),Yi>1&&console.timeEnd("clipping"),ti.push(Xr||[],Fe+1,2*rt,2*xt),ti.push(tn||[],Fe+1,2*rt,2*xt+1),ti.push(Jn||[],Fe+1,2*rt+1,2*xt),ti.push(ds||[],Fe+1,2*rt+1,2*xt+1)}}getTile(Ge,Fe,rt){Ge=+Ge,Fe=+Fe,rt=+rt;const xt=this.options,{extent:ft,debug:Jt}=xt;if(Ge<0||Ge>24)return null;const xi=1<<Ge,ti=hl(Ge,Fe=Fe+xi&xi-1,rt);if(this.tiles[ti])return qo(this.tiles[ti],ft);Jt>1&&console.log("drilling down to z%d-%d-%d",Ge,Fe,rt);let ai,Yi=Ge,Fi=Fe,Pr=rt;for(;!ai&&Yi>0;)Yi--,Fi>>=1,Pr>>=1,ai=this.tiles[hl(Yi,Fi,Pr)];return ai&&ai.source?(Jt>1&&(console.log("found parent tile z%d-%d-%d",Yi,Fi,Pr),console.time("drilling down")),this.splitTile(ai.source,Yi,Fi,Pr,Ge,Fe,rt),Jt>1&&console.timeEnd("drilling down"),this.tiles[ti]?qo(this.tiles[ti],ft):null):null}}function hl(vi,Ge,Fe){return 32*((1<<vi)*Fe+Ge)+vi}function fr(vi,Ge){const Fe=vi.tileID.canonical;if(!this._geoJSONIndex)return void Ge(null,null);const rt=this._geoJSONIndex.getTile(Fe.z,Fe.x,Fe.y);if(!rt)return void Ge(null,null);const xt=ti=>ti.tags&&"3d_elevation_id"in ti.tags&&"source"in ti.tags&&ti.tags.source==="elevation",ft=rt.features.filter(ti=>xt(ti));let Jt;if(ft.length>0){const ti=rt.features.filter(ai=>!xt(ai));Jt=new Ye({_geojsonTileLayer:ti,hd_road_elevation:ft})}else Jt=new Ie(rt.features);let xi=Zt(Jt);xi.byteOffset===0&&xi.byteLength===xi.buffer.byteLength||(xi=new Uint8Array(xi)),Ge(null,{vectorTile:Jt,rawData:xi.buffer})}class tc extends he{constructor(Ge,Fe,rt,xt,ft,Jt,xi){super(Ge,Fe,rt,xt,ft,fr,xi),Jt&&(this.loadGeoJSON=Jt),this._dynamicIndex=new At}loadData(Ge,Fe){const rt=Ge&&Ge.request,xt=rt&&rt.collectResourceTiming;this.loadGeoJSON(Ge,(ft,Jt)=>{if(ft||!Jt)return Fe(ft);if(typeof Jt!="object")return Fe(new Error(`Input data given to '${Ge.source}' is not a valid GeoJSON object.`));{try{if(Ge.filter){const ti=i.X(Ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ti.result==="error")throw new Error(ti.value.map(ai=>`${ai.key}: ${ai.message}`).join(", "));Jt.features=Jt.features.filter(ai=>ti.value.evaluate({zoom:0},ai))}Ge.dynamic?(Jt.type==="Feature"&&(Jt={type:"FeatureCollection",features:[Jt]}),Ge.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Jt.features,this.loaded),Ge.cluster&&(Jt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Ge.cluster?new ji(function({superclusterOptions:ti,clusterProperties:ai}){if(!ai||!ti)return ti;const Yi={},Fi={},Pr={accumulated:null,zoom:0},ln={properties:null},Qr=Object.keys(ai);for(const Or of Qr){const[ii,xr]=ai[Or],Xr=i.X(xr),tn=i.X(typeof ii=="string"?[ii,["accumulated"],["get",Or]]:ii);Yi[Or]=Xr.value,Fi[Or]=tn.value}return ti.map=Or=>{ln.properties=Or;const ii={};for(const xr of Qr)ii[xr]=Yi[xr].evaluate(Pr,ln);return ii},ti.reduce=(Or,ii)=>{ln.properties=ii;for(const xr of Qr)Pr.accumulated=Or[xr],Or[xr]=Fi[xr].evaluate(Pr,ln)},ti}(Ge)).load(Jt.features):Ge.dynamic?this._dynamicIndex:function(ti,ai){return new Yn(ti,ai)}(Jt,Ge.geojsonVtOptions)}catch(ti){return Fe(ti)}const xi={};if(xt){const ti=S(rt);ti&&(xi.resourceTiming={},xi.resourceTiming[Ge.source]=JSON.parse(JSON.stringify(ti)))}Fe(null,xi)}})}reloadTile(Ge,Fe){const rt=this.loaded;return rt&&rt[Ge.uid]?Ge.partial?Fe(null,void 0):super.reloadTile(Ge,Fe):this.loadTile(Ge,Fe)}loadGeoJSON(Ge,Fe){if(Ge.request)i.n(Ge.request,Fe);else{if(typeof Ge.data!="string")return Fe(new Error(`Input data given to '${Ge.source}' is not a valid GeoJSON object.`));try{return Fe(null,JSON.parse(Ge.data))}catch{return Fe(new Error(`Input data given to '${Ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ge,Fe){try{Fe(null,this._geoJSONIndex.getClusterExpansionZoom(Ge.clusterId))}catch(rt){Fe(rt)}}getClusterChildren(Ge,Fe){try{Fe(null,this._geoJSONIndex.getChildren(Ge.clusterId))}catch(rt){Fe(rt)}}getClusterLeaves(Ge,Fe){try{Fe(null,this._geoJSONIndex.getLeaves(Ge.clusterId,Ge.limit,Ge.offset))}catch(rt){Fe(rt)}}}class Sh{constructor(Ge,Fe,rt){this.tileID=new i.aM(Ge.tileID.overscaledZ,Ge.tileID.wrap,Ge.tileID.canonical.z,Ge.tileID.canonical.x,Ge.tileID.canonical.y),this.tileZoom=Ge.tileZoom,this.uid=Ge.uid,this.zoom=Ge.zoom,this.canonical=Ge.tileID.canonical,this.pixelRatio=Ge.pixelRatio,this.tileSize=Ge.tileSize,this.source=Ge.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Ge.projection,this.brightness=Fe,this.worldview=rt}parse(Ge,Fe,rt,xt){this.status="parsing";const ft=new i.aM(rt.tileID.overscaledZ,rt.tileID.wrap,rt.tileID.canonical.z,rt.tileID.canonical.x,rt.tileID.canonical.y),Jt=[],xi=Fe.familiesBySource[rt.source],ti=new i.f0(ft,rt.promoteId);ti.bucketLayerIDs=[],ti.is3DTile=!0,i.fi(Ge).then(ai=>{if(!ai)return xt(new Error("Could not parse tile"));const Yi=ai.json.extensionsUsed&&ai.json.extensionsUsed.includes("MAPBOX_mesh_features")||ai.json.asset.extras&&ai.json.asset.extras.MAPBOX_mesh_features,Fi=ai.json.extensionsUsed&&ai.json.extensionsUsed.includes("EXT_meshopt_compression"),Pr=new i.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ln in xi)for(const Qr of xi[ln]){const Or=Qr[0];ti.bucketLayerIDs.push(Qr.map(Xr=>i.C(Xr.id,Xr.scope))),Or.recalculate(Pr,[]);const ii=i.fj(ai,1/i.cU(rt.tileID.canonical)),xr=new i.fk(Qr,ii,ft,Yi,Fi,this.brightness,ti,this.worldview);Yi||(xr.needsUpload=!0),Jt.push(xr),xr.evaluate(Or)}this.status="done",xt(null,{buckets:Jt,featureIndex:ti,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ai=>xt(new Error(ai.message)))}}class bl{constructor(Ge,Fe,rt,xt,ft,Jt,xi,ti){this.actor=Ge,this.layerIndex=Fe,this.availableImages=rt,this.availableModels=xt,this.brightness=xi,this.loading={},this.loaded={},this.worldview=ti}loadTile(Ge,Fe){const rt=Ge.uid,xt=this.loading[rt]=new Sh(Ge,this.brightness,this.worldview);i.br(Ge.request,(ft,Jt)=>{const xi=!this.loading[rt];return delete this.loading[rt],xi||ft?(xt.status="done",xi||(this.loaded[rt]=xt),Fe(ft)):Jt&&Jt.byteLength!==0?void xt.parse(Jt,this.layerIndex,Ge,(ti,ai)=>{xt.status="done",this.loaded=this.loaded||{},this.loaded[rt]=xt,ti||!ai?Fe(ti):Fe(null,ai)}):(xt.status="done",this.loaded[rt]=xt,Fe())})}reloadTile(Ge,Fe){const rt=this.loaded,xt=Ge.uid;if(rt&&rt[xt]){const ft=rt[xt];ft.projection=Ge.projection,ft.brightness=Ge.brightness;const Jt=(xi,ti)=>{ft.reloadCallback&&(delete ft.reloadCallback,this.loadTile(Ge,Fe)),Fe(xi,ti)};ft.status==="parsing"?ft.reloadCallback=Jt:ft.status==="done"&&this.loadTile(Ge,Fe)}}abortTile(Ge,Fe){const rt=Ge.uid;this.loading[rt]&&delete this.loading[rt],Fe()}removeTile(Ge,Fe){const rt=this.loaded,xt=Ge.uid;rt&&rt[xt]&&delete rt[xt],Fe()}}class Un{constructor(Ge){this.self=Ge,this.actor=new i.fm(Ge,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.ce({name:"mercator"}),this.workerSourceTypes={vector:he,geojson:tc,"raster-dem":fe,"raster-array":Se,"batched-model":bl},this.workerSources={},this.self.registerWorkerSource=(Fe,rt)=>{if(this.workerSourceTypes[Fe])throw new Error(`Worker source with name "${Fe}" already registered.`);this.workerSourceTypes[Fe]=rt},this.self.registerRTLTextPlugin=Fe=>{if(i.fn.isParsed())throw new Error("RTL text plugin already registered.");i.fn.setState({pluginStatus:i.fo.parsed,pluginURL:i.fn.getPluginURL()}),i.fn.applyArabicShaping=Fe.applyArabicShaping,i.fn.processBidirectionalText=Fe.processBidirectionalText,i.fn.processStyledBidirectionalText=Fe.processStyledBidirectionalText;for(const rt of this.rtlPluginParsingListeners)rt(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Ge,Fe,rt){delete this.layerIndexes[Ge],delete this.availableImages[Ge],delete this.availableModels[Ge],delete this.workerSources[Ge],rt()}checkIfReady(Ge,Fe,rt){rt()}setReferrer(Ge,Fe){this.referrer=Fe}spriteLoaded(Ge,Fe){this.isSpriteLoaded[Ge]||(this.isSpriteLoaded[Ge]={});const{scope:rt,isLoaded:xt}=Fe;if(this.isSpriteLoaded[Ge][rt]=xt,this.workerSources[Ge]&&this.workerSources[Ge][rt])for(const ft in this.workerSources[Ge][rt]){const Jt=this.workerSources[Ge][rt][ft];for(const xi in Jt){const ti=Jt[xi];ti instanceof he&&(ti.isSpriteLoaded=xt,ti.fire(new i.A("isSpriteLoaded")))}}}setImages(Ge,Fe,rt){this.availableImages[Ge]||(this.availableImages[Ge]={});const{scope:xt,images:ft}=Fe;if(this.availableImages[Ge][xt]=ft,this.workerSources[Ge]&&this.workerSources[Ge][xt]){for(const Jt in this.workerSources[Ge][xt]){const xi=this.workerSources[Ge][xt][Jt];for(const ti in xi)xi[ti].availableImages=ft}rt()}else rt()}setModels(Ge,{scope:Fe,models:rt},xt){if(this.availableModels[Ge]||(this.availableModels[Ge]={}),this.availableModels[Ge][Fe]=rt,this.workerSources[Ge]&&this.workerSources[Ge][Fe]){for(const ft in this.workerSources[Ge][Fe]){const Jt=this.workerSources[Ge][Fe][ft];for(const xi in Jt)Jt[xi].availableModels=rt}xt()}else xt()}setProjection(Ge,Fe){this.projections[Ge]=i.ce(Fe)}setBrightness(Ge,Fe,rt){this.brightness=Fe,rt()}setWorldview(Ge,Fe,rt){this.worldview=Fe,rt()}setLayers(Ge,Fe,rt){this.getLayerIndex(Ge,Fe.scope).replace(Fe.layers,Fe.options),rt()}updateLayers(Ge,Fe,rt){this.getLayerIndex(Ge,Fe.scope).update(Fe.layers,Fe.removedIds,Fe.options),rt()}loadTile(Ge,Fe,rt){Fe.projection=this.projections[Ge]||this.defaultProjection,this.getWorkerSource(Ge,Fe.type,Fe.source,Fe.scope).loadTile(Fe,rt)}decodeRasterArray(Ge,Fe,rt){this.getWorkerSource(Ge,Fe.type,Fe.source,Fe.scope).decodeRasterArray(Fe,rt)}reloadTile(Ge,Fe,rt){Fe.projection=this.projections[Ge]||this.defaultProjection,this.getWorkerSource(Ge,Fe.type,Fe.source,Fe.scope).reloadTile(Fe,rt)}abortTile(Ge,Fe,rt){this.getWorkerSource(Ge,Fe.type,Fe.source,Fe.scope).abortTile(Fe,rt)}removeTile(Ge,Fe,rt){this.getWorkerSource(Ge,Fe.type,Fe.source,Fe.scope).removeTile(Fe,rt)}removeSource(Ge,Fe,rt){if(!(this.workerSources[Ge]&&this.workerSources[Ge][Fe.scope]&&this.workerSources[Ge][Fe.scope][Fe.type]&&this.workerSources[Ge][Fe.scope][Fe.type][Fe.source]))return;const xt=this.workerSources[Ge][Fe.scope][Fe.type][Fe.source];delete this.workerSources[Ge][Fe.scope][Fe.type][Fe.source],xt.removeSource!==void 0?xt.removeSource(Fe,rt):rt()}loadWorkerSource(Ge,Fe,rt){try{this.self.importScripts(Fe.url),rt()}catch(xt){rt(xt.toString())}}syncRTLPluginState(Ge,Fe,rt){if(i.fn.isParsed())rt(null,!0);else if(i.fn.isParsing())this.rtlPluginParsingListeners.push(rt);else try{i.fn.setState(Fe);const xt=i.fn.getPluginURL();!i.fn.isLoaded()||i.fn.isParsed()||i.fn.isParsing()||xt==null||(i.fn.setState({pluginStatus:i.fo.parsing,pluginURL:i.fn.getPluginURL()}),this.self.importScripts(xt),i.fn.isParsed()?rt(null,!0):this.rtlPluginParsingListeners.push(rt))}catch(xt){rt(xt.toString())}}setDracoUrl(Ge,Fe){this.dracoUrl=Fe}getAvailableImages(Ge,Fe){this.availableImages[Ge]||(this.availableImages[Ge]={});let rt=this.availableImages[Ge][Fe];return rt||(rt=[]),rt}getAvailableModels(Ge,Fe){this.availableModels[Ge]||(this.availableModels[Ge]={});let rt=this.availableModels[Ge][Fe];return rt||(rt={}),rt}getLayerIndex(Ge,Fe){this.layerIndexes[Ge]||(this.layerIndexes[Ge]={});let rt=this.layerIndexes[Ge][Fe];return rt||(rt=this.layerIndexes[Ge][Fe]=new F,rt.scope=Fe),rt}getWorkerSource(Ge,Fe,rt,xt){const ft=this.workerSources;return ft[Ge]||(ft[Ge]={}),ft[Ge][xt]||(ft[Ge][xt]={}),ft[Ge][xt][Fe]||(ft[Ge][xt][Fe]={}),this.isSpriteLoaded[Ge]||(this.isSpriteLoaded[Ge]={}),ft[Ge][xt][Fe][rt]||(ft[Ge][xt][Fe][rt]=new this.workerSourceTypes[Fe]({send:(Jt,xi,ti,ai,Yi,Fi)=>this.actor.send(Jt,xi,ti,Ge,Yi,Fi),scheduler:this.actor.scheduler},this.getLayerIndex(Ge,xt),this.getAvailableImages(Ge,xt),this.getAvailableModels(Ge,xt),this.isSpriteLoaded[Ge][xt],void 0,this.brightness,this.worldview)),ft[Ge][xt][Fe][rt]}rasterizeImagesWorker(Ge,Fe,rt){const xt=new Map;for(const[ft,{image:Jt,imageVariant:xi}]of Fe.tasks.entries()){const ti=this.imageRasterizer.rasterize(xi,Jt,Fe.scope,Ge);xt.set(ft,ti)}rt(void 0,xt)}removeRasterizedImages(Ge,Fe,rt){this.imageRasterizer.removeImagesFromCacheByIds(Fe.imageIds,Fe.scope,Ge),rt()}enforceCacheSizeLimit(Ge,Fe){i.fp(Fe)}getWorkerPerformanceMetrics(Ge,Fe,rt){rt(void 0,void 0)}}return i.fl(self)&&(self.worker=new Un(self)),Un}),d(["./shared"],function(i){var S="3.13.0";const E={create:"create",load:"load",fullLoad:"fullLoad"},L={mark(g){performance.mark(g)},measure(g,o,h){performance.measure(g,o,h)}};function F(g){const o=g.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var G,q={},Q=function(){if(G)return q;function g(y){return!o(y)}function o(y){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,R,$=new Blob([""],{type:"text/javascript"}),Z=URL.createObjectURL($);try{R=new Worker(Z),A=!0}catch{A=!1}return R&&R.terminate(),URL.revokeObjectURL(Z),A}()?function(){var A=document.createElement("canvas");A.width=A.height=1;var R=A.getContext("2d");if(!R)return!1;var $=R.getImageData(0,0,1,1);return $&&$.width===A.width}()?(h[C=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[C]=function(A){var R,$=function(Z){var se=document.createElement("canvas"),ue=Object.create(g.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=Z,se.getContext("webgl2",ue)}(A);if(!$)return!1;try{R=$.createShader($.VERTEX_SHADER)}catch{return!1}return!(!R||$.isContextLost())&&($.shaderSource(R,"void main() {}"),$.compileShader(R),$.getShaderParameter(R,$.COMPILE_STATUS)===!0)}(C)),h[C]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var C}G=1,q.supported=g,q.notSupportedReason=o;var h={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},q}();function te(g,o,h){const y=document.createElement(g);return o!=null&&(y.className=o),h&&h.appendChild(y),y}function he(g,o,h){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const C of Object.keys(o))y.setAttributeNS(null,C,String(o[C]));return h&&h.appendChild(y),y}const fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,le=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Se;function ke(){fe&&le&&(Se=fe[le],fe[le]="none")}function Ee(){fe&&le&&(fe[le]=Se)}function Ie(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",Ie,!0)}function He(){window.addEventListener("click",Ie,!0),window.setTimeout(()=>{window.removeEventListener("click",Ie,!0)},0)}function Ye(g,o){const h=g.getBoundingClientRect();return At(g,h,o)}function lt(g,o){const h=g.getBoundingClientRect(),y=[];for(let C=0;C<o.length;C++)y.push(At(g,h,o[C]));return y}function Pt(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function At(g,o,h){const y=g.offsetWidth===o.width?1:g.offsetWidth/o.width;return new i.P((h.clientX-o.left)*y,(h.clientY-o.top)*y)}const ht="01",Ot="NO_ACCESS_TOKEN";class Ae{constructor(o,h,y){this._transformRequestFn=o,this._customAccessToken=h,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const o=function(){let h="";for(let y=0;y<10;y++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ht,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeStyleURL(o,h){if(!i.j(o))return o;const y=bt(o);return y.params.push(`sdk=js-${S}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeGlyphsURL(o,h){if(!i.j(o))return o;const y=bt(o);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeModelURL(o,h){if(!i.j(o))return o;const y=bt(o);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeSourceURL(o,h,y,C){if(!i.j(o))return o;const A=bt(o);return A.path=`/v4/${A.authority}.json`,A.params.push("secure"),y&&A.params.push(`language=${y}`),C&&A.params.push(`worldview=${C}`),this._makeAPIURL(A,this._customAccessToken||h)}normalizeIconsetURL(o,h){const y=bt(o);return i.j(o)?(y.path=`/styles/v1${y.path}/iconset.pbf`,this._makeAPIURL(y,this._customAccessToken||h)):Dt(y)}normalizeSpriteURL(o,h,y,C){const A=bt(o);return i.j(o)?(A.path=`/styles/v1${A.path}/sprite${h}${y}`,this._makeAPIURL(A,this._customAccessToken||C)):(A.path+=`${h}${y}`,Dt(A))}normalizeTileURL(o,h,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.j(o))return o;const C=bt(o);C.path=C.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||y&&C.authority!=="raster"&&y===512?"@2x":""}${i.l.supported?".webp":"$1"}`),C.authority==="raster"?C.path=`/${i.e.RASTER_URL_PREFIX}${C.path}`:C.authority==="rasterarrays"?C.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${C.path}`:C.authority==="3dtiles"?C.path=`/${i.e.TILES3D_URL_PREFIX}${C.path}`:(C.path=C.path.replace(/^.+\/v4\//,"/"),C.path=`/${i.e.TILE_URL_VERSION}${C.path}`);const A=this._customAccessToken||function(R){for(const $ of R){const Z=$.match(/^access_token=(.*)$/);if(Z)return Z[1]}return null}(C.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&A&&this._skuToken&&C.params.push(`sku=${this._skuToken}`),this._makeAPIURL(C,A)}canonicalizeTileURL(o,h){const y=bt(o);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return o;let C="mapbox://";y.path.match(/^\/raster\/v1\//)?C+=`raster/${y.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?C+=`rasterarrays/${y.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:C+=`tiles/${y.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let A=y.params;return h&&(A=A.filter(R=>!R.match(/^access_token=/))),A.length&&(C+=`?${A.join("&")}`),C}canonicalizeTileset(o,h){const y=!!h&&i.j(h),C=[];for(const A of o.tiles||[])i.k(A)?C.push(this.canonicalizeTileURL(A,y)):C.push(A);return C}_makeAPIURL(o,h){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",C=bt(i.e.API_URL);if(o.protocol=C.protocol,o.authority=C.authority,o.protocol==="http"){const A=o.params.indexOf("secure");A>=0&&o.params.splice(A,1)}if(C.path!=="/"&&(o.path=`${C.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Dt(o);if(h=h||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return o.params=o.params.filter(A=>A.indexOf("access_token")===-1),o.params.push(`access_token=${h||""}`),Dt(o)}}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(g){const o=g.match(mt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Dt(g){const o=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${o}`}const Je="mapbox.eventData";function dt(g){if(!g)return null;const o=g.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.m(o[1]))}catch{return null}}class ui{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const h=dt(i.e.ACCESS_TOKEN);let y="";return y=h&&h.u?i.f(h.u):i.e.ACCESS_TOKEN||"",o?`${Je}.${o}:${y}`:`${Je}:${y}`}fetchEventData(){const o=i.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid");if(o)try{const C=localStorage.getItem(h);C&&(this.eventData=JSON.parse(C));const A=localStorage.getItem(y);A&&(this.anonId=A)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const o=i.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid"),C=this.anonId;if(o&&C)try{localStorage.setItem(y,C),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,h,y,C){if(!i.e.EVENTS_URL)return;const A=bt(i.e.EVENTS_URL);A.params.push(`access_token=${C||i.e.ACCESS_TOKEN||""}`);const R={event:this.type,created:new Date(o).toISOString()},$=h?i.h(R,h):R,Z={url:Dt(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([$])};this.pendingRequest=i.p(Z,se=>{this.pendingRequest=null,y(se),this.saveEventData(),this.processRequests(C)})}queueRequest(o,h){this.queue.push(o),this.processRequests(h)}}const Vt=new class extends ui{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(h=>i.j(h)||i.k(h))&&this.queueRequest(Date.now(),o)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=dt(i.e.ACCESS_TOKEN),h=o?o.u:i.e.ACCESS_TOKEN;let y=h!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),y=!0);const C=this.queue.shift();if(this.eventData.lastSuccess){const A=new Date(this.eventData.lastSuccess),R=new Date(C),$=(C-this.eventData.lastSuccess)/864e5;y=y||$>=1||$<-1||A.getDate()!==R.getDate()}else y=!0;y?this.postEvent(C,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ht,"enabled.telemetry":!1,userId:this.anonId},A=>{A||(this.eventData.lastSuccess=C,this.eventData.tokenU=h)},g):this.processRequests()}},ei=Vt.postTurnstileEvent.bind(Vt),ur=new class extends ui{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,o,h,y){this.skuToken=o,this.errorCb=y,i.e.EVENTS_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(Ot)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ht,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g))}remove(){this.errorCb=null}},Zt=ur.postMapLoadEvent.bind(ur),Kt=new class extends ui{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let o=this.mapInstanceIdMap.get(g);return o||(o=i.u(),this.mapInstanceIdMap.set(g,o)),o}getEventId(g){const o=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,o+1),o}postStyleLoadEvent(g,o){const{map:h,style:y,importedStyles:C}=o;if(!i.e.EVENTS_URL||!g&&!i.e.ACCESS_TOKEN)return;const A=this.getMapInstanceId(h),R={mapInstanceId:A,eventId:this.getEventId(A),style:y};C.length&&(R.importedStyles=C),this.queueRequest({timestamp:Date.now(),payload:R},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:h}=this.queue.shift();this.postEvent(o,h,()=>{},g)}},Ui=Kt.postStyleLoadEvent.bind(Kt),rr=new class extends ui{constructor(){super("gljs.performance")}postPerformanceEvent(g,o){i.e.EVENTS_URL&&(g||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:h}=this.queue.shift(),y=function(C){const A=performance.getEntriesByType("resource"),R=performance.getEntriesByType("mark"),$=function(Ce){const $e={};if(Ce){for(const Ne in Ce)if(Ne!=="other")for(const We of Ce[Ne]){const Xe=`${Ne}ResolveRangeMin`,et=`${Ne}ResolveRangeMax`,_t=`${Ne}RequestCount`,Ct=`${Ne}RequestCachedCount`;$e[Xe]=Math.min($e[Xe]||1/0,We.startTime),$e[et]=Math.max($e[et]||-1/0,We.responseEnd);const jt=Ft=>{$e[Ft]===void 0&&($e[Ft]=0),++$e[Ft]};We.transferSize!==void 0&&We.transferSize===0&&jt(Ct),jt(_t)}}return $e}(function(Ce,$e){const Ne={};if(Ce)for(const We of Ce){const Xe=$e(We);Ne[Xe]===void 0&&(Ne[Xe]=[]),Ne[Xe].push(We)}return Ne}(A,F)),Z=window.devicePixelRatio,se=navigator.connection||navigator.mozConnection||navigator.webkitConnection,ue=se?se.effectiveType:void 0,be={counters:[],metadata:[],attributes:[]},ge=(Ce,$e,Ne)=>{Ne!=null&&Ce.push({name:$e,value:Ne.toString()})};for(const Ce in $)ge(be.counters,Ce,$[Ce]);if(C.interactionRange[0]!==1/0&&C.interactionRange[1]!==-1/0&&(ge(be.counters,"interactionRangeMin",C.interactionRange[0]),ge(be.counters,"interactionRangeMax",C.interactionRange[1])),R)for(const Ce of Object.keys(E)){const $e=E[Ce],Ne=R.find(We=>We.name===$e);Ne&&ge(be.counters,$e,Ne.startTime)}return ge(be.counters,"visibilityHidden",C.visibilityHidden),ge(be.attributes,"style",function(Ce){if(Ce)for(const $e of Ce){const Ne=$e.name.split("?")[0];if(i.i(Ne)){const We=Ne.split("/").slice(-2);if(We.length===2)return`mapbox://styles/${We[0]}/${We[1]}`}}}(A)),ge(be.attributes,"terrainEnabled",C.terrainEnabled?"true":"false"),ge(be.attributes,"fogEnabled",C.fogEnabled?"true":"false"),ge(be.attributes,"projection",C.projection),ge(be.attributes,"zoom",C.zoom),ge(be.metadata,"devicePixelRatio",Z),ge(be.metadata,"connectionEffectiveType",ue),ge(be.metadata,"navigatorUserAgent",navigator.userAgent),ge(be.metadata,"screenWidth",window.screen.width),ge(be.metadata,"screenHeight",window.screen.height),ge(be.metadata,"windowWidth",window.innerWidth),ge(be.metadata,"windowHeight",window.innerHeight),ge(be.metadata,"mapWidth",C.width/Z),ge(be.metadata,"mapHeight",C.height/Z),ge(be.metadata,"webglRenderer",C.renderer),ge(be.metadata,"webglVendor",C.vendor),ge(be.metadata,"sdkVersion",S),ge(be.metadata,"sdkIdentifier","mapbox-gl-js"),be}(h);for(const C of y.metadata);for(const C of y.counters);for(const C of y.attributes);this.postEvent(o,y,()=>{},g)}},gi=rr.postPerformanceEvent.bind(rr),Oi=new class extends ui{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,o,h,y){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const C=bt(i.e.API_URL+i.e.SESSION_PATH);C.params.push(`sku=${o||""}`),C.params.push(`access_token=${y||i.e.ACCESS_TOKEN||""}`);const A={url:Dt(C),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(A,R=>{this.pendingRequest=null,h(R),this.saveEventData(),this.processRequests(y)})}getSessionAPI(g,o,h,y){this.skuToken=o,this.errorCb=y,i.e.SESSION_PATH&&i.e.API_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(Ot)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||this.getSession(h,this.skuToken,y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g)}remove(){this.errorCb=null}},cr=Oi.getSessionAPI.bind(Oi),ji=new Set;function nn(g,o){o?ji.add(g):ji.delete(g)}class pr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,h){this._updatedSourceCaches[o]=h,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const h=o.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(o.id),this.setDirty()}removeLayer(o){const h=o.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][o.id]=o,this._updatedLayers[h].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const h in this._updatedLayers)o[h]=o[h]||{},o[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)o[h]=o[h]||{},o[h].removedIds=Object.keys(this._removedLayers[h]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ue(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class ni extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.r({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const h=this.atlasTexture.get(o);h&&(h.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(o.id,o)}removeImageProvider(o,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(o)}getPendingImageProviders(){const o=[];for(const h of this.imageProviders.values())for(const y of h.values())y.hasPendingRequests()&&o.push(y);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,h){if(this.loaded.get(h)!==o&&(this.loaded.set(h,o),o)){for(const{ids:y,callback:C}of this.requestors)this._notify(y,h,C);this.requestors=[]}}hasImage(o,h){return!!this.getImage(o,h)}getImage(o,h){return this.images.get(h).get(o.toString())}addImage(o,h,y){this._validate(o,y)&&this.images.get(h).set(o.toString(),y)}_validate(o,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "content" value`))),y=!1),y}_validateStretch(o,h){if(!o)return!0;let y=0;for(const C of o){if(C[0]<y||C[1]<C[0]||h<C[1])return!1;y=C[1]}return!0}_validateContent(o,h){return o?o.length!==4||!h.usvg&&(o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,h,y){const C=this.images.get(h).get(o.toString());y.version=C.version+1,this.images.get(h).set(o.toString(),y),this.updatedImages.get(h).add(o),this.removeFromImageRasterizerCache(o,h)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,h){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([o],h))}removeImage(o,h){const y=this.images.get(h),C=y.get(o.toString());y.delete(o.toString()),this.patterns.get(h).delete(o.toString()),this.removeFromImageRasterizerCache(o,h),C.userImage&&C.userImage.onRemove&&C.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(h=>i.I.from(h))}getImages(o,h,y){const C=[],A=[],R=this.imageProviders.get(h);for(const ue of o){if(!ue.iconsetId){C.push(ue);continue}const be=R.get(ue.iconsetId);be&&(this.getImage(ue,h)?A.push(ue):be.addPendingRequest(ue))}if(C.length===0)return void this._notify(A,h,y);let $=!0;const Z=!!this.loaded.get(h),se=this.images.get(h);if(!Z)for(const ue of C)se.has(ue.toString())||($=!1);Z||$?this._notify(C,h,y):this.requestors.push({ids:C,scope:h,callback:y})}rasterizeImages(o,h){const y=new Map,{tasks:C,scope:A}=o;for(const[R,$]of C.entries()){const Z=this.getImage($.id,A);Z&&y.set(R,{image:Z,imageVariant:$})}this._rasterizeImages(A,y,h)}_rasterizeImages(o,h,y){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:o},y);else{const C=new Map;for(const[A,{image:R,imageVariant:$}]of h.entries())C.set(A,this.imageRasterizer.rasterize($,R,o,0));y(void 0,C)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,h,y){const C=this.images.get(h),A=new Map;for(const R of o){if(!C.get(R.toString())){if(R.iconsetId)continue;this.fire(new i.A("styleimagemissing",{id:R.name}))}const $=C.get(R.toString());if(!$){i.w(`Image "${R.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const Z={data:$.usvg?null:$.data.clone(),pixelRatio:$.pixelRatio,sdf:$.sdf,usvg:$.usvg,version:$.version,stretchX:$.stretchX,stretchY:$.stretchY,content:$.content,hasRenderCallback:!!($.userImage&&$.userImage.render)};$.usvg&&Object.assign(Z,{width:$.icon.usvg_tree.width,height:$.icon.usvg_tree.height}),A.set(i.I.toString(R),Z)}y(null,A)}getPixelSize(o){const{width:h,height:y}=this.atlasImage.get(o);return{width:h,height:y}}getPattern(o,h,y){const C=o.toString(),A=this.patterns.get(h),R=A.get(C),$=this.getImage(o,h);if(!$)return null;if(R){if(R.position.version===$.version)return R.position;R.position.version=$.version}else{if($.usvg&&!$.data){const Z=this.getPatternInFlightId(C,h);if(this.patternsInFlight.has(Z))return null;this.patternsInFlight.add(Z);const se=new i.B(o).scaleSelf(i.q.devicePixelRatio),ue=new Map([[se.toString(),{image:$,imageVariant:se}]]);return this._rasterizeImages(h,ue,(be,ge)=>this.storePatternImage(se,h,$,y,ge)),null}this.storePattern(o,h,$)}return this._updatePatternAtlas(h,y),A.get(C).position}getPatternInFlightId(o,h){return i.C(o,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,h,y,C,A){const R=o.toString(),$=A?A.get(R):void 0;$&&(y.data=$,this.storePattern(o.id,h,y),this._updatePatternAtlas(h,C),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),h)))}storePattern(o,h,y){const C={w:y.data.width+2*i.F,h:y.data.height+2*i.F,x:0,y:0},A=new i.G(C,y,i.F);this.patterns.get(h).set(o.toString(),{bin:C,position:A})}bind(o,h){const y=o.gl;let C=this.atlasTexture.get(h);C?this.dirty&&(C.update(this.atlasImage.get(h)),this.dirty=!1):(C=new i.T(o,this.atlasImage.get(h),y.RGBA8),this.atlasTexture.set(h,C)),C.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(o,h){const y=this.patterns.get(o),C=Array.from(y.values()).map(({bin:se})=>se),{w:A,h:R}=i.H(C),$=this.atlasImage.get(o);$.resize({width:A||1,height:R||1});const Z=this.images.get(o);for(const[se,{bin:ue,position:be}]of y.entries()){let ge=be.padding;const Ce=ue.x+ge,$e=ue.y+ge,Ne=Z.get(se).data,We=Ne.width,Xe=Ne.height;ge=ge>1?ge-1:ge,i.r.copy(Ne,$,{x:0,y:0},{x:Ce,y:$e},{width:We,height:Xe},h),i.r.copy(Ne,$,{x:0,y:Xe-ge},{x:Ce,y:$e-ge},{width:We,height:ge},h),i.r.copy(Ne,$,{x:0,y:0},{x:Ce,y:$e+Xe},{width:We,height:ge},h),i.r.copy(Ne,$,{x:We-ge,y:0},{x:Ce-ge,y:$e},{width:ge,height:Xe},h),i.r.copy(Ne,$,{x:0,y:0},{x:Ce+We,y:$e},{width:ge,height:Xe},h),i.r.copy(Ne,$,{x:We-ge,y:Xe-ge},{x:Ce-ge,y:$e-ge},{width:ge,height:ge},h),i.r.copy(Ne,$,{x:0,y:Xe-ge},{x:Ce+We,y:$e-ge},{width:ge,height:ge},h),i.r.copy(Ne,$,{x:0,y:0},{x:Ce+We,y:$e+Xe},{width:ge,height:ge},h),i.r.copy(Ne,$,{x:We-ge,y:0},{x:Ce-ge,y:$e+Xe},{width:ge,height:ge},h)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,h){const y=this.images.get(h);for(const C of o){if(this.callbackDispatchedThisFrame.get(h).has(C.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(C.toString());const A=y.get(C.toString());Ue(A)&&this.updateImage(C,h,A)}}}function fi(g){const o=g.key,h=g.value,y=g.valueSpec||{},C=g.objectElementValidators||{},A=g.style,R=g.styleSpec;let $=[];const Z=i.J(h);if(Z!=="object")return[new i.V(o,h,`object expected, ${Z} found`)];for(const se in h){const ue=se.split(".")[0];let be;C[ue]?be=C[ue]:y[ue]?be=zn:C["*"]?be=C["*"]:y["*"]&&(be=zn),be?$=$.concat(be({key:(o&&`${o}.`)+se,value:h[se],valueSpec:y[ue]||y["*"],style:A,styleSpec:R,object:h,objectKey:se},h)):$.push(new i.K(o,h[se],`unknown property "${se}"`))}for(const se in y)C[se]||y[se].required&&y[se].default===void 0&&h[se]===void 0&&$.push(new i.V(o,h,`missing required property "${se}"`));return $}function Lt(g){const o=g.value,h=g.valueSpec,y=g.style,C=g.styleSpec,A=g.key,R=g.arrayElementValidator||zn;if(i.J(o)!=="array")return[new i.V(A,o,`array expected, ${i.J(o)} found`)];if(h.length&&o.length!==h.length)return[new i.V(A,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new i.V(A,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let $={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};C.$version<7&&($.function=h.function),i.J(h.value)==="object"&&($=h.value);let Z=[];for(let se=0;se<o.length;se++)Z=Z.concat(R({array:o,arrayIndex:se,value:o[se],valueSpec:$,style:y,styleSpec:C,key:`${A}[${se}]`},!0));return Z}function pt(g){const o=g.key,h=g.value,y=g.valueSpec;let C=i.J(h);if(C==="number"&&h!=h&&(C="NaN"),C!=="number")return[new i.V(o,h,`number expected, ${C} found`)];if("minimum"in y){let A=y.minimum;if(i.J(y.minimum)==="array"&&(A=y.minimum[g.arrayIndex]),h<A)return[new i.V(o,h,`${h} is less than the minimum value ${A}`)]}if("maximum"in y){let A=y.maximum;if(i.J(y.maximum)==="array"&&(A=y.maximum[g.arrayIndex]),h>A)return[new i.V(o,h,`${h} is greater than the maximum value ${A}`)]}return[]}function Nt(g){const o=g.valueSpec,h=i.M(g.value.type);let y,C,A,R={};const $=h!=="categorical"&&g.value.property===void 0,Z=!$,se=i.J(g.value.stops)==="array"&&i.J(g.value.stops[0])==="array"&&i.J(g.value.stops[0][0])==="object",ue=fi({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Ce){if(h==="identity")return[new i.V(Ce.key,Ce.value,'identity function may not have a "stops" property')];let $e=[];const Ne=Ce.value;return $e=$e.concat(Lt({key:Ce.key,value:Ne,valueSpec:Ce.valueSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:be})),i.J(Ne)==="array"&&Ne.length===0&&$e.push(new i.V(Ce.key,Ne,"array must have at least one stop")),$e},default:function(Ce){return zn({key:Ce.key,value:Ce.value,valueSpec:o,style:Ce.style,styleSpec:Ce.styleSpec})}}});return h==="identity"&&$&&ue.push(new i.V(g.key,g.value,'missing required property "property"')),h==="identity"||g.value.stops||ue.push(new i.V(g.key,g.value,'missing required property "stops"')),h==="exponential"&&g.valueSpec.expression&&!i.N(g.valueSpec)&&ue.push(new i.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(Z&&!i.O(g.valueSpec)?ue.push(new i.V(g.key,g.value,"property functions not supported")):$&&!i.Q(g.valueSpec)&&ue.push(new i.V(g.key,g.value,"zoom functions not supported"))),h!=="categorical"&&!se||g.value.property!==void 0||ue.push(new i.V(g.key,g.value,'"property" property is required')),ue;function be(Ce){let $e=[];const Ne=Ce.value,We=Ce.key;if(i.J(Ne)!=="array")return[new i.V(We,Ne,`array expected, ${i.J(Ne)} found`)];if(Ne.length!==2)return[new i.V(We,Ne,`array length 2 expected, length ${Ne.length} found`)];if(se){if(i.J(Ne[0])!=="object")return[new i.V(We,Ne,`object expected, ${i.J(Ne[0])} found`)];if(Ne[0].zoom===void 0)return[new i.V(We,Ne,"object stop key must have zoom")];if(Ne[0].value===void 0)return[new i.V(We,Ne,"object stop key must have value")];const Xe=i.M(Ne[0].zoom);if(typeof Xe!="number")return[new i.V(We,Ne[0].zoom,"stop zoom values must be numbers")];if(A&&A>Xe)return[new i.V(We,Ne[0].zoom,"stop zoom values must appear in ascending order")];Xe!==A&&(A=Xe,C=void 0,R={}),$e=$e.concat(fi({key:`${We}[0]`,value:Ne[0],valueSpec:{zoom:{}},style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:pt,value:ge}}))}else $e=$e.concat(ge({key:`${We}[0]`,value:Ne[0],style:Ce.style,styleSpec:Ce.styleSpec},Ne));return i.S(i.U(Ne[1]))?$e.concat([new i.V(`${We}[1]`,Ne[1],"expressions are not allowed in function stops.")]):$e.concat(zn({key:`${We}[1]`,value:Ne[1],valueSpec:o,style:Ce.style,styleSpec:Ce.styleSpec}))}function ge(Ce,$e){const Ne=i.J(Ce.value),We=i.M(Ce.value),Xe=Ce.value!==null?Ce.value:$e;if(y){if(Ne!==y)return[new i.V(Ce.key,Xe,`${Ne} stop domain type must match previous stop domain type ${y}`)]}else y=Ne;if(Ne!=="number"&&Ne!=="string"&&Ne!=="boolean"&&typeof We!="number"&&typeof We!="string"&&typeof We!="boolean")return[new i.V(Ce.key,Xe,"stop domain value must be a number, string, or boolean")];if(Ne!=="number"&&h!=="categorical"){let et=`number expected, ${Ne} found`;return i.O(o)&&h===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Ce.key,Xe,et)]}return h!=="categorical"||Ne!=="number"||typeof We=="number"&&isFinite(We)&&Math.floor(We)===We?h!=="categorical"&&Ne==="number"&&typeof We=="number"&&typeof C=="number"&&C!==void 0&&We<C?[new i.V(Ce.key,Xe,"stop domain values must appear in ascending order")]:(C=We,h==="categorical"&&We in R?[new i.V(Ce.key,Xe,"stop domain values must be unique")]:(R[We]=!0,[])):[new i.V(Ce.key,Xe,`integer expected, found ${String(We)}`)]}}function Si(g){const o=(g.expressionContext==="property"?i.W:i.X)(i.U(g.value),g.valueSpec);if(o.result==="error")return o.value.map(y=>new i.V(`${g.key}${y.key}`,g.value,y.message));const h=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!i.Y(h))return[new i.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return pi(h,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!i.Z(h,["zoom","feature-state"]))return[new i.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!i._(h))return[new i.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pi(g,o){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const C of o.valueSpec.expression.parameters)h.delete(C);if(h.size===0)return[];const y=[];return g instanceof i.$&&h.has(g.name)?[new i.V(o.key,o.value,`["${g.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(g.eachChild(C=>{y.push(...pi(C,o))}),y)}function St(g){const o=g.key,h=g.value,y=g.valueSpec,C=[];return Array.isArray(y.values)?y.values.indexOf(i.M(h))===-1&&C.push(new i.V(o,h,`expected one of [${y.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(y.values).indexOf(i.M(h))===-1&&C.push(new i.V(o,h,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(h)} found`)),C}function Ht(g){return i.a1(i.U(g.value))?Si(i.L({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):nr(g)}function nr(g){const o=g.value,h=g.key;if(i.J(o)!=="array")return[new i.V(h,o,`array expected, ${i.J(o)} found`)];const y=g.styleSpec;let C,A=[];if(o.length<1)return[new i.V(h,o,"filter array must have at least 1 element")];switch(A=A.concat(St({key:`${h}[0]`,value:o[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),i.M(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.M(o[1])==="$type"&&A.push(new i.V(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&A.push(new i.V(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(C=i.J(o[1]),C!=="string"&&A.push(new i.V(`${h}[1]`,o[1],`string expected, ${C} found`)));for(let R=2;R<o.length;R++)C=i.J(o[R]),i.M(o[1])==="$type"?A=A.concat(St({key:`${h}[${R}]`,value:o[R],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&A.push(new i.V(`${h}[${R}]`,o[R],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let R=1;R<o.length;R++)A=A.concat(nr({key:`${h}[${R}]`,value:o[R],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":C=i.J(o[1]),o.length!==2?A.push(new i.V(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):C!=="string"&&A.push(new i.V(`${h}[1]`,o[1],`string expected, ${C} found`))}return A}function tr(g,o){const h=g.key,y=g.style,C=g.layer,A=g.styleSpec,R=g.value,$=g.objectKey,Z=A[`${o}_${g.layerType}`];if(!Z)return[];const se=$.match(/^(.*)-use-theme$/);if(o==="paint"&&se&&Z[se[1]])return i.S(R)?[].concat(zn({key:g.key,value:R,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:y,styleSpec:A,expressionContext:"property",propertyType:o,propertyKey:$})):zn({key:h,value:R,valueSpec:{type:"string"},style:y,styleSpec:A});const ue=$.match(/^(.*)-transition$/);if(o==="paint"&&ue&&Z[ue[1]]&&Z[ue[1]].transition)return zn({key:h,value:R,valueSpec:A.transition,style:y,styleSpec:A});const be=g.valueSpec||Z[$];if(!be)return[new i.K(h,R,`unknown property "${$}"`)];let ge;if(i.J(R)==="string"&&i.O(be)&&!be.tokens&&(ge=/^{([^}]+)}$/.exec(R))){const $e=`\`{ "type": "identity", "property": ${ge?JSON.stringify(ge[1]):'"_"'} }\``;return[new i.V(h,R,`"${$}" does not support interpolation syntax
Use an identity property function instead: ${$e}.`)]}const Ce=[];if(g.layerType==="symbol")$!=="text-field"||!y||y.glyphs||y.imports||Ce.push(new i.V(h,R,'use of "text-field" requires a style "glyphs" property')),$==="text-font"&&i.a2(i.U(R))&&i.M(R.type)==="identity"&&Ce.push(new i.V(h,R,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&o==="paint"&&C&&C.layout&&C.layout.hasOwnProperty("model-id")&&i.O(be)&&(i.a3(be)||i.Q(be))){const $e=i.W(i.U(R),be),Ne=$e.value.expression||$e.value._styleExpression.expression;Ne&&!i.Z(Ne,["measure-light"])&&($==="model-emissive-strength"&&i._(Ne)&&i.Y(Ne)||Ce.push(new i.V(h,R,`${$} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Ce.concat(zn({key:g.key,value:R,valueSpec:be,style:y,styleSpec:A,expressionContext:"property",propertyType:o,propertyKey:$}))}function kr(g){return tr(g,"paint")}function Mr(g){return tr(g,"layout")}function Cr(g){let o=[];const h=g.value,y=g.key,C=g.style,A=g.styleSpec;h.type||h.ref||o.push(new i.V(y,h,'either "type" or "ref" is required'));let R=i.M(h.type);const $=i.M(h.ref);if(h.id){const Z=i.M(h.id);for(let se=0;se<g.arrayIndex;se++){const ue=C.layers[se];i.M(ue.id)===Z&&o.push(new i.V(y,h.id,`duplicate layer id "${h.id}", previously used at line ${ue.id.__line__}`))}}if("ref"in h){let Z;["type","source","source-layer","filter","layout"].forEach(se=>{se in h&&o.push(new i.V(y,h[se],`"${se}" is prohibited for ref layers`))}),C.layers.forEach(se=>{i.M(se.id)===$&&(Z=se)}),Z?Z.ref?o.push(new i.V(y,h.ref,"ref cannot reference another ref layer")):R=i.M(Z.type):typeof $=="string"&&o.push(new i.V(y,h.ref,`ref layer "${$}" not found`))}else if(R!=="background"&&R!=="sky"&&R!=="slot")if(h.source){const Z=C.sources&&C.sources[h.source],se=Z&&i.M(Z.type);Z?se==="vector"&&R==="raster"?o.push(new i.V(y,h.source,`layer "${h.id}" requires a raster source`)):se==="raster"&&R!=="raster"?o.push(new i.V(y,h.source,`layer "${h.id}" requires a vector source`)):se!=="vector"||h["source-layer"]?se==="raster-dem"&&R!=="hillshade"?o.push(new i.V(y,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):se!=="raster-array"||["raster","raster-particle"].includes(R)?R==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&se==="geojson"&&!Z.lineMetrics?o.push(new i.V(y,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):R==="raster-particle"&&se!=="raster-array"&&o.push(new i.V(y,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):o.push(new i.V(y,h.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(y,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new i.V(y,h.source,`source "${h.source}" not found`))}else o.push(new i.V(y,h,'missing required property "source"'));return o=o.concat(fi({key:y,value:h,valueSpec:A.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zn({key:`${y}.type`,value:h.type,valueSpec:A.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:Z=>Ht(i.L({layerType:R},Z)),layout:Z=>fi({layer:h,key:Z.key,value:Z.value,valueSpec:{},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":se=>Mr(i.L({layerType:R},se))}}),paint:Z=>fi({layer:h,key:Z.key,value:Z.value,valueSpec:{},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":se=>kr(i.L({layerType:R,layer:h},se))}})}})),o}function Tn(g){const o=g.value,h=g.key,y=i.J(o);return y!=="string"?[new i.V(h,o,`string expected, ${y} found`)]:[]}const gs={promoteId:function g({key:o,value:h}){if(i.J(h)==="string")return Tn({key:o,value:h});if(Array.isArray(h)){const y=[],C=i.U(h),A=i.X(C);return A.result==="error"&&A.value.forEach(R=>{y.push(new i.V(`${o}${R.key}`,null,`${R.message}`))}),i.Z(A.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),y}{const y=[];for(const C in h)y.push(...g({key:`${o}.${C}`,value:h[C]}));return y}}};function wn(g){const o=g.value,h=g.key,y=g.styleSpec,C=g.style;if(!o.type)return[new i.V(h,o,'"type" is required')];const A=i.M(o.type);let R=[];switch(["vector","raster","raster-dem","raster-array"].includes(A)&&(o.url||o.tiles||R.push(new i.K(h,o,'Either "url" or "tiles" is required.'))),A){case"vector":case"raster":case"raster-dem":case"raster-array":return R=R.concat(fi({key:h,value:o,valueSpec:y[`source_${A.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:gs})),R;case"geojson":if(R=fi({key:h,value:o,valueSpec:y.source_geojson,style:C,styleSpec:y,objectElementValidators:gs}),o.cluster)for(const $ in o.clusterProperties){const[Z,se]=o.clusterProperties[$],ue=typeof Z=="string"?[Z,["accumulated"],["get",$]]:Z;R.push(...Si({key:`${h}.${$}.map`,value:se,expressionContext:"cluster-map"})),R.push(...Si({key:`${h}.${$}.reduce`,value:ue,expressionContext:"cluster-reduce"}))}return R;case"video":return fi({key:h,value:o,valueSpec:y.source_video,style:C,styleSpec:y});case"image":return fi({key:h,value:o,valueSpec:y.source_image,style:C,styleSpec:y});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return St({key:`${h}.type`,value:o.type,valueSpec:{values:bs(y)}})}}function bs(g){return g.source.reduce((o,h)=>{const y=g[h];return y.type.type==="enum"&&(o=o.concat(Object.keys(y.type.values))),o},[])}function qn(g){const o=g.value,h=g.styleSpec,y=h.light,C=g.style;let A=[];const R=i.J(o);if(o===void 0)return A;if(R!=="object")return A=A.concat([new i.V("light",o,`object expected, ${R} found`)]),A;for(const $ in o){const Z=$.match(/^(.*)-transition$/),se=$.match(/^(.*)-use-theme$/);A=A.concat(se&&y[se[1]]?zn({key:$,value:o[$],valueSpec:{type:"string"},style:C,styleSpec:h}):Z&&y[Z[1]]&&y[Z[1]].transition?zn({key:$,value:o[$],valueSpec:h.transition,style:C,styleSpec:h}):y[$]?zn({key:$,value:o[$],valueSpec:y[$],style:C,styleSpec:h}):[new i.V($,o[$],`unknown property "${$}"`)])}return A}function Ls(g){const o=g.value;let h=[];if(!o)return h;const y=i.J(o);if(y!=="object")return h=h.concat([new i.V("light-3d",o,`object expected, ${y} found`)]),h;const C=g.styleSpec,A=C["light-3d"],R=g.key,$=g.style,Z=g.style.lights;for(const be of["type","id"])if(!(be in o))return h=h.concat([new i.V("light-3d",o,`missing property ${be} on light`)]),h;if(o.type&&Z)for(let be=0;be<g.arrayIndex;be++){const ge=i.M(o.type),Ce=Z[be];i.M(Ce.type)===ge&&h.push(new i.V(R,o.id,`duplicate light type "${o.type}", previously defined at line ${Ce.id.__line__}`))}const se=`properties_light_${o.type}`;if(!(se in C))return h=h.concat([new i.V("light-3d",o,`Invalid light type ${o.type}`)]),h;const ue=C[se];for(const be in o)if(be==="properties"){const ge=o[be],Ce=i.J(ge);if(Ce!=="object")return h=h.concat([new i.V("properties",ge,`object expected, ${Ce} found`)]),h;for(const $e in ge){const Ne=$e.match(/^(.*)-transition$/),We=$e.match(/^(.*)-use-theme$/);h=h.concat(We&&ue[We[1]]?zn({key:be,value:ge[$e],valueSpec:{type:"string"},style:$,styleSpec:C}):Ne&&ue[Ne[1]]&&ue[Ne[1]].transition?zn({key:be,value:o[be],valueSpec:C.transition,style:$,styleSpec:C}):ue[$e]?zn({key:$e,value:ge[$e],valueSpec:ue[$e],style:$,styleSpec:C}):[new i.K(g.key,ge[$e],`unknown property "${$e}"`)])}}else h=h.concat(A[be]?zn({key:be,value:o[be],valueSpec:A[be],style:$,styleSpec:C}):[new i.K(be,o[be],`unknown property "${be}"`)]);return h}function ma(g){const o=g.value,h=g.key,y=g.style,C=g.styleSpec,A=C.terrain;let R=[];const $=i.J(o);if(o===void 0||$==="null")return R;if($!=="object")return R=R.concat([new i.V("terrain",o,`object expected, ${$} found`)]),R;for(const Z in o){const se=Z.match(/^(.*)-transition$/),ue=Z.match(/^(.*)-use-theme$/);R=R.concat(ue&&A[ue[1]]?zn({key:Z,value:o[Z],valueSpec:{type:"string"},style:y,styleSpec:C}):se&&A[se[1]]&&A[se[1]].transition?zn({key:Z,value:o[Z],valueSpec:C.transition,style:y,styleSpec:C}):A[Z]?zn({key:Z,value:o[Z],valueSpec:A[Z],style:y,styleSpec:C}):[new i.K(Z,o[Z],`unknown property "${Z}"`)])}if(o.source){const Z=y.sources&&y.sources[o.source],se=Z&&i.M(Z.type);Z?se!=="raster-dem"&&R.push(new i.V(h,o.source,`terrain cannot be used with a source of type ${String(se)}, it only be used with a "raster-dem" source type`)):R.push(new i.V(h,o.source,`source "${o.source}" not found`))}else R.push(new i.V(h,o,'terrain is missing required property "source"'));return R}function Ln(g){const o=g.value,h=g.style,y=g.styleSpec,C=y.fog;let A=[];const R=i.J(o);if(o===void 0)return A;if(R!=="object")return A=A.concat([new i.V("fog",o,`object expected, ${R} found`)]),A;for(const $ in o){const Z=$.match(/^(.*)-transition$/),se=$.match(/^(.*)-use-theme$/);A=A.concat(se&&C[se[1]]?zn({key:$,value:o[$],valueSpec:{type:"string"},style:h,styleSpec:y}):Z&&C[Z[1]]&&C[Z[1]].transition?zn({key:$,value:o[$],valueSpec:y.transition,style:h,styleSpec:y}):C[$]?zn({key:$,value:o[$],valueSpec:C[$],style:h,styleSpec:y}):[new i.K($,o[$],`unknown property "${$}"`)])}return A}const qo={"*":()=>[],array:Lt,boolean:function(g){const o=g.value,h=g.key,y=i.J(o);return y!=="boolean"?[new i.V(h,o,`boolean expected, ${y} found`)]:[]},number:pt,color:function(g){const o=g.key,h=g.value,y=i.J(h);return y!=="string"?[new i.V(o,h,`color expected, ${y} found`)]:i.a0.parseCSSColor(h)===null?[new i.V(o,h,`color expected, "${h}" found`)]:[]},enum:St,filter:Ht,function:Nt,layer:Cr,object:fi,source:wn,model:i.a4,light:qn,"light-3d":Ls,terrain:ma,fog:Ln,string:Tn,formatted:function(g){return Tn(g).length===0?[]:Si(g)},resolvedImage:function(g){return Tn(g).length===0?[]:Si(g)},projection:function(g){const o=g.value,h=g.styleSpec,y=h.projection,C=g.style;let A=[];const R=i.J(o);if(R==="object")for(const $ in o)A=A.concat(zn({key:$,value:o[$],valueSpec:y[$],style:C,styleSpec:h}));else R!=="string"&&(A=A.concat([new i.V("projection",o,`object or string expected, ${R} found`)]));return A},import:function(g){const{value:o,styleSpec:h}=g,{data:y,...C}=o;Object.defineProperty(C,"__line__",{value:o.__line__,enumerable:!1});let A=fi(i.L({},g,{value:C,valueSpec:h.import}));return i.M(C.id)===""&&A.push(new i.V(`${g.key}.id`,C,"import id can't be an empty string")),y&&(A=A.concat($o(y,h,{key:`${g.key}.data`}))),A},iconset:function(g){const o=g.value,h=g.key,y=g.styleSpec,C=g.style;if(!o.type)return[new i.V(h,o,'"type" is required')];const A=i.M(o.type);let R=[];if(R=R.concat(fi({key:h,value:o,valueSpec:y[`iconset_${A}`],style:C,styleSpec:y})),A==="source"&&o.source){const $=C.sources&&C.sources[o.source],Z=$&&i.M($.type);$?Z!=="raster-array"&&R.push(new i.V(h,o.source,`iconset cannot be used with a source of type ${String(Z)}, it only be used with a "raster-array" source type`)):R.push(new i.V(h,o.source,`source "${o.source}" not found`))}return R}};function zn(g,o=!1){const h=g.value,y=g.valueSpec,C=g.styleSpec;if(y.expression&&i.a2(i.M(h)))return Nt(g);if(y.expression&&i.S(i.U(h)))return Si(g);if(y.type&&qo[y.type]){const A=qo[y.type](g);return o===!0&&A.length>0&&i.J(g.value)==="array"?Si(g):A}return fi(i.L({},g,{valueSpec:y.type?C[y.type]:y}))}function za(g){const o=g.value,h=g.key,y=Tn(g);return y.length||(o.indexOf("{fontstack}")===-1&&y.push(new i.V(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&y.push(new i.V(h,o,'"glyphs" url must include a "{range}" token'))),y}function $o(g,o=i.a5,h={}){return zn({key:h.key||"",value:g,valueSpec:o.$root,styleSpec:o,style:g,objectElementValidators:{glyphs:za,"*":()=>[]}})}function Aa(g,o=i.a5){return xt($o(g,o))}const ja=g=>xt(wn(g)),Yn=g=>xt(qn(g)),hl=g=>xt(Ls(g)),fr=g=>xt(ma(g)),tc=g=>xt(Ln(g)),Sh=g=>xt(function(o){const h=o.value,y=o.style,C=o.styleSpec,A=C.snow;let R=[];const $=i.J(h);if(h===void 0)return R;if($!=="object")return R=R.concat([new i.V("snow",h,`object expected, ${$} found`)]),R;for(const Z in h){const se=Z.match(/^(.*)-transition$/);R=R.concat(se&&A[se[1]]&&A[se[1]].transition?zn({key:Z,value:h[Z],valueSpec:C.transition,style:y,styleSpec:C}):A[Z]?zn({key:Z,value:h[Z],valueSpec:A[Z],style:y,styleSpec:C}):[new i.K(Z,h[Z],`unknown property "${Z}"`)])}return R}(g)),bl=g=>xt(function(o){const h=o.value,y=o.style,C=o.styleSpec,A=C.rain;let R=[];const $=i.J(h);if(h===void 0)return R;if($!=="object")return R=R.concat([new i.V("rain",h,`object expected, ${$} found`)]),R;for(const Z in h){const se=Z.match(/^(.*)-transition$/);R=R.concat(se&&A[se[1]]&&A[se[1]].transition?zn({key:Z,value:h[Z],valueSpec:C.transition,style:y,styleSpec:C}):A[Z]?zn({key:Z,value:h[Z],valueSpec:A[Z],style:y,styleSpec:C}):[new i.K(Z,h[Z],`unknown property "${Z}"`)])}return R}(g)),Un=g=>xt(Cr(g)),vi=g=>xt(Ht(g)),Ge=g=>xt(kr(g)),Fe=g=>xt(Mr(g)),rt=g=>xt(i.a4(g));function xt(g){return g.slice().sort((o,h)=>o.line&&h.line?o.line-h.line:0)}function ft(g,o){let h=!1;if(o&&o.length)for(const y of o)y instanceof i.K?i.w(y.message):(g.fire(new i.z(new Error(y.message))),h=!0);return h}let Jt;class xi extends i.E{constructor(o,h="flat"){super(),this._transitionable=new i.a6(Jt||(Jt=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(o,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h,y={}){this._validate(Yn,o,y)||(this._transitionable.setTransitionOrValue(o),this.id=h)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,y){return(!y||y.validate!==!1)&&ft(this,o.call(Aa,i.h({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let ti=class extends i.E{constructor(g,o,h,y,C){super(),this.scope=h,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),h,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=C}get(){return this._transitionable.serialize()}set(g,o){this._transitionable.setTransitionOrValue(g,o)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new i.aa(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const o=g.value.expression;if(!o)return null;let h=-1,y=-1,C=1;for(const A of o.zoomStops)C=o.evaluate(new i.aa(A,{worldview:this.worldview})),C>.01?(h=A,y=-1):y=A;return C<.01&&h>0&&y>h?[h,y]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof i.ab}};const ai=45,Yi=65,Fi=.05;function Pr(g,o,h,y){const C=i.af(ai,Yi,h),[A,R]=ln(g,y);let $=1-Math.min(1,Math.exp((o-A)/(R-A)*-6));return $*=$*$,$=Math.min(1,1.00747*$),$*C*g.alpha}function ln(g,o){const h=.5/Math.tan(.5*o);return[g.range[0]+h,g.range[1]+h]}function Qr(g,o,h,y,C){const A=i.ad([],[o,h,y],C.mercatorFogMatrix);return Pr(g,i.ae(A),C.pitch,C._fov)}function Or(g,o,h,y,C,A,R){const $=[[h,y,0],[C,y,0],[C,A,0],[h,A,0]];let Z=Number.MAX_VALUE,se=-Number.MAX_VALUE;for(const ue of $){const be=i.ad([],ue,o),ge=i.ae(be);Z=Math.min(Z,ge),se=Math.max(se,ge)}return[Pr(g,Z,R.pitch,R._fov),Pr(g,se,R.pitch,R._fov)]}class ii extends i.E{constructor(o,h,y,C){super();const A=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(A,y,new Map(C)),this.set(o,C),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.ag(A),this.scope=y}get state(){const o=this._transform,h=o.projection.name==="globe",y=i.ah(o.zoom),C=this.properties.get("range"),A=[.5,3];return{range:h?[i.ai(A[0],C[0],y),i.ai(A[1],C[1],y)]:C,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h,y={}){if(this._validate(tc,o,y))return;const C=i.h({},o);for(const A of Object.keys(i.a5.fog))C[A]===void 0&&(C[A]=i.a5.fog[A].default);this._options=C,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.af(ai,Yi,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(y,C,A){const R=i.ac.fromLngLat(C),$=A.elevation?A.elevation.getAtPointOrZero(R):0;return Qr(y,R.x,R.y,$,A)}(this.state,o,h):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Or(this.state,h,0,0,i.aj,i.aj,this._transform)}getOpacityForBounds(o,h,y,C,A){return this._transform.projection.supportsFog?Or(this.state,o,h,y,C,A,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ln(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const y of h){const C=o.points[y];let A;if(C[2]>=0)A=C;else{const R=o.points[y-4];A=i.ak(R,C,R[2]/(R[2]-C[2]))}if(Qr(this.state,A[0],A[1],0,this._transform)>=Fi)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,y){return(!y||y.validate!==!1)&&ft(this,o.call(Aa,i.h({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let xr,Xr,tn,Jn,ds=class extends i.E{constructor(g,o,h,y){super();const C=xr||(xr=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(C,h,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(C),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),y=i.al(h[0]),C=-Math.max(i.al(h[1]),.01),A=[Math.cos(y)*Math.cos(C),Math.sin(y)*Math.cos(C),Math.sin(C)],R=this.properties.get("vignette"),$=this.properties.get("vignette-color");return $.a=R,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*g),direction:A,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:$}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(Sh,g,h))return;const y=i.h({},g);for(const C of Object.keys(i.a5.snow))y[C]===void 0&&(y[C]=i.a5.snow[C].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&ft(this,g.call(Aa,i.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},mi=class extends i.E{constructor(g,o,h,y){super();const C=Xr||(Xr=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(C,h,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(C),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),y=i.al(h[0]),C=-Math.max(i.al(h[1]),.01),A=[Math.cos(y)*Math.cos(C),Math.sin(y)*Math.cos(C),Math.sin(C)],R=this.properties.get("vignette-color");return R.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*g),direction:A,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:R}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(bl,g,h))return;const y=i.h({},g);for(const C of Object.keys(i.a5.rain))y[C]===void 0&&(y[C]=i.a5.rain[C].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&ft(this,g.call(Aa,i.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class _r extends i.E{constructor(o,h,y,C){super(),this.scope=y,this._options=o,this.properties=new i.ag(h),this._transitionable=new i.a6(h,y,new Map(C)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,h){this._options=o,this._transitionable.setTransitionOrValue(o.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class zi{constructor(o,h,y,C){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,C)}static createFromScreenPoints(o,h){let y,C;if(o instanceof i.P||typeof o[0]=="number"){const A=i.P.convert(o);y=[A],C=h.isPointAboveHorizon(A)}else{const A=i.P.convert(o[0]),R=i.P.convert(o[1]),$=A.add(R)._div(2);y=[A,R],C=i.ao(A,R).every(Z=>h.isPointAboveHorizon(Z))&&h.isPointAboveHorizon($)}return new zi(y,h.getCameraPoint(),C,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],C=i.ao(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?C.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?C[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(C[3]=this.cameraPoint)),i.ap(C,o)}bufferedCameraGeometryGlobe(o){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],C=i.ao(h,y,o),A=this.cameraPoint.clone();switch(3*((A.y>h.y)+(A.y>y.y))+((A.x>h.x)+(A.x>y.x))){case 0:C[0]=A,C[4]=A.clone();break;case 1:C.splice(1,0,A);break;case 2:C[1]=A;break;case 3:C.splice(4,0,A);break;case 5:C.splice(2,0,A);break;case 6:C[3]=A;break;case 7:C.splice(3,0,A);break;case 8:C[2]=A}return C}containsTile(o,h,y,C=0){const A=o.queryPadding/h._pixelsPerMercatorPixel+1,R=y?this._bufferedCameraMercator(A,h):this._bufferedScreenMercator(A,h);let $=o.tileID.wrap+(R.unwrapped?C:0);const Z=R.polygon.map(We=>i.aq(o.tileTransform,We,$));if(!i.ar(Z,0,0,i.aj,i.aj))return;$=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?C:0);const se=this.screenGeometryMercator.polygon.map(We=>i.as(o.tileTransform,We,$)),ue=se.map(We=>new i.P(We[0],We[1])),be=h.getFreeCameraOptions().position||new i.ac(0,0,0),ge=i.as(o.tileTransform,be,$),Ce=se.map(We=>{const Xe=i.at(We,We,ge);return i.au(Xe,Xe),new i.av(ge,Xe)}),$e=i.aw(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ue,tilespaceRays:Ce,bufferedTilespaceGeometry:Z,bufferedTilespaceBounds:(Ne=i.ax(Z),Ne.min.x=i.ay(Ne.min.x,0,i.aj),Ne.min.y=i.ay(Ne.min.y,0,i.aj),Ne.max.x=i.ay(Ne.max.x,0,i.aj),Ne.max.y=i.ay(Ne.max.y,0,i.aj),Ne),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:$e};var Ne}_bufferedScreenMercator(o,h){const y=yr(o);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let C;return C=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(A=>h.pointCoordinate3D(A)),unwrapped:!0},this._screenRaycastCache[y]=C,C}}_bufferedCameraMercator(o,h){const y=yr(o);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let C;return C=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(A=>h.pointCoordinate3D(A)),unwrapped:!0},this._cameraRaycastCache[y]=C,C}}_projectAndResample(o,h){const y=function(A,R){const $=i.az([],R.pixelMatrix,R.globeMatrix),Z=[0,-i.aB,0,1],se=[0,i.aB,0,1],ue=[0,0,0,1];i.aA(Z,Z,$),i.aA(se,se,$),i.aA(ue,ue,$);const be=new i.P(Z[0]/Z[3],Z[1]/Z[3]),ge=new i.P(se[0]/se[3],se[1]/se[3]),Ce=i.aC(A,be)&&Z[3]<ue[3],$e=i.aC(A,ge)&&se[3]<ue[3];if(!Ce&&!$e)return null;const Ne=function(Rt,Et,Wt){for(let qt=1;qt<Rt.length;qt++){const Ei=Yr(Et.pointCoordinate3D(Rt[qt-1]).x),Mi=Yr(Et.pointCoordinate3D(Rt[qt]).x);if(Wt<0){if(Ei<Mi)return{idx:qt,t:-Ei/(Mi-1-Ei)}}else if(Mi<Ei)return{idx:qt,t:(1-Ei)/(Mi+1-Ei)}}return null}(A,R,Ce?-1:1);if(!Ne)return null;const{idx:We,t:Xe}=Ne;let et=We>1?zr(A.slice(0,We),R):[],_t=We<A.length?zr(A.slice(We),R):[];et=et.map(Rt=>new i.P(Yr(Rt.x),Rt.y)),_t=_t.map(Rt=>new i.P(Yr(Rt.x),Rt.y));const Ct=[...et];Ct.length===0&&Ct.push(_t[_t.length-1]);const jt=i.ai(Ct[Ct.length-1].y,(_t.length===0?et[0]:_t[0]).y,Xe);let Ft;return Ft=Ce?[new i.P(0,jt),new i.P(0,0),new i.P(1,0),new i.P(1,jt)]:[new i.P(1,jt),new i.P(1,1),new i.P(0,1),new i.P(0,jt)],Ct.push(...Ft),_t.length===0?Ct.push(et[0]):Ct.push(..._t),{polygon:Ct.map(Rt=>new i.ac(Rt.x,Rt.y)),unwrapped:!1}}(o,h);if(y)return y;const C=function(A,R){let $=!1,Z=-1/0,se=0;for(let be=0;be<A.length-1;be++)A[be].x>Z&&(Z=A[be].x,se=be);for(let be=0;be<A.length-1;be++){const ge=(se+be)%(A.length-1),Ce=A[ge],$e=A[ge+1];Math.abs(Ce.x-$e.x)>.5&&(Ce.x<$e.x?(Ce.x+=1,ge===0&&(A[A.length-1].x+=1)):($e.x+=1,ge+1===A.length-1&&(A[0].x+=1)),$=!0)}const ue=i.aD(R.center.lng);return $&&ue<Math.abs(ue-1)&&A.forEach(be=>{be.x-=1}),{polygon:A,unwrapped:$}}(zr(o,h).map(A=>new i.P(Yr(A.x),A.y)),h);return{polygon:C.polygon.map(A=>new i.ac(A.x,A.y)),unwrapped:C.unwrapped}}}function zr(g,o){return i.aE(g,h=>{const y=o.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function Yr(g){return g<0?1+g%1:g%1}function yr(g){return 100*g|0}function Hr(g,o,h,y,C){const A=function($,Z){if($)return C($);if(Z){if(g.url&&Z.tiles&&g.tiles&&delete g.tiles,Z.variants){if(!Array.isArray(Z.variants))return C(new Error("variants must be an array"));for(const ue of Z.variants){if(ue==null||typeof ue!="object"||ue.constructor!==Object)return C(new Error("variant must be an object"));if(!Array.isArray(ue.capabilities))return C(new Error("capabilities must be an array"));if(ue.capabilities.length===1&&ue.capabilities[0]==="meshopt"){Z=i.h(Z,ue);break}}}const se=i.aF(i.h({},Z,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);se.tiles=o.canonicalizeTileset(se,g.url),C(null,se)}},R=function($,Z,se){if(!$)return null;if(!Z&&!se)return $;se=se||$.worldview_default;const ue=Object.values($.language||{});if(ue.length===0)return null;const be=Object.values($.worldview||{});if(be.length===0)return null;const ge=ue.every($e=>$e===Z),Ce=be.every($e=>$e===se);return ge&&Ce?$:Z in($.language_options||{})||se in($.worldview_options||{})?null:$.language_options&&$.worldview_options?$:null}(g.data,h,y);return R?i.q.frame(()=>A(null,R)):g.url?i.n(o.transformRequest(o.normalizeSourceURL(g.url,null,h,y),i.R.Source),A):i.q.frame(()=>{const{data:$,...Z}=g;A(null,Z)})}function rn(g,o){const h=Math.pow(2,o.z),y=Math.floor(i.aD(g.getWest())*h),C=Math.floor(i.aH(g.getNorth())*h),A=Math.ceil(i.aD(g.getEast())*h),R=Math.ceil(i.aH(g.getSouth())*h);return o.x>=y&&o.x<A&&o.y>=C&&o.y<R}class is{constructor(o,h,y){this.bounds=o?i.aG.convert(this.validateBounds(o)):null,this.minzoom=h||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const h of o)this.extraBounds.push(i.aG.convert(this.validateBounds(h)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!rn(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(rn(h,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const h=new is(o.bounds,o.minzoom,o.maxzoom);return h.addExtraBounds(o.extra_bounds),h}}class Ps extends i.E{constructor(o,h,y,C){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.h(this,i.aF(h,["url","scheme","tileSize","promoteId"])),this._options=i.h({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C),this._tileWorkers={},this._deduped=new i.aI}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=Hr(this._options,this.map._requestManager,h,y,(C,A)=>{if(this._tileJSONRequest=null,this._loaded=!0,C)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new i.z(C));else if(A){if(i.h(this,A),this.hasWorldviews=!!A.worldview_options,A.worldview_default&&(this.worldviewDefault=A.worldview_default),A.vector_layers){this.vectorLayers=A.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const R of A.vector_layers)this.vectorLayerIds.push(R.id),A.worldview&&A.worldview[R.source]&&this.localizableLayerIds.add(R.id)}this.tileBounds=is.fromTileJSON(A),ei(A.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}o&&o(C)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}loadTile(o,h){const y=o.tileID.canonical.url(this.tiles,this.scheme),C=this.map._requestManager.normalizeTileURL(y),A=this.map._requestManager.transformRequest(C,i.R.Tile),R=this.map.style?this.map.style.getLut(this.scope):null,$=R?{image:R.image.clone()}:null,Z={request:A,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:$,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&i.j(y)&&(Z.localizableLayerIds=this.localizableLayerIds),Z.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",Z,se.bind(this));else if(o.actor=this._tileWorkers[C]=this._tileWorkers[C]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",Z,se.bind(this),void 0,!0);else{const ue=i.aJ.call({deduped:this._deduped},Z,(be,ge)=>{be||!ge?se.call(this,be):(Z.data={cacheControl:ge.cacheControl,expires:ge.expires,rawData:ge.rawData.slice(0)},o.actor&&o.actor.send("loadTile",Z,se.bind(this),void 0,!0))},!0);o.request={cancel:ue}}function se(ue,be){return delete o.request,o.aborted?h(null):ue&&ue.status!==404?h(ue):(be&&be.resourceTiming&&(o.resourceTiming=be.resourceTiming),this.map._refreshExpiredTiles&&be&&o.setExpiryData(be),o.loadVectorData(be,this.map.painter),i.aK(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vs extends i.E{constructor(o,h,y,C){super(),this.id=o,this.dispatcher=y,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.h({type:"raster"},h),i.h(this,i.aF(h,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=Hr(this._options,this.map._requestManager,null,h,(y,C)=>{this._tileJSONRequest=null,this._loaded=!0,y?this.fire(new i.z(y)):C&&(i.h(this,C),C.raster_layers&&(this.rasterLayers=C.raster_layers,this.rasterLayerIds=this.rasterLayers.map(A=>A.id)),this.tileBounds=is.fromTileJSON(C),ei(C.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),o&&o(y)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const y=i.q.devicePixelRatio>=2,C=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);o.request=i.o(this.map._requestManager.transformRequest(C,i.R.Tile),(A,R,$,Z)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):A?(o.state="errored",h(A)):R?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:$,expires:Z}),o.setTexture(R,this.map.painter),o.state="loaded",i.aK(this.dispatcher),void h(null)):h(null)))}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h&&h()}unloadTile(o,h){o.texture&&o.texture instanceof i.T?(o.destroy(!0),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ra extends vs{constructor(o,h,y,C){super(o,h,y,C),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.h({type:"raster-array"},h)}triggerRepaint(o){const h=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);h&&h.enabled&&y&&h._clearRenderCacheForTile(y.id,o.tileID),this.map.triggerRepaint()}loadTile(o,h){const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),C=this.map._requestManager.transformRequest(y,i.R.Tile),A={request:C,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=C,o.actor||(o.actor=this.dispatcher.getActor());const R=($,Z,se,ue)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if($)return $.name==="AbortError"?void 0:(o.state="errored",h($));if(this.map._refreshExpiredTiles&&Z&&o.setExpiryData({cacheControl:se,expires:ue}),this.partial)o.state="empty";else{if(!Z)return h(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=Z}h(null)};o.request=this.partial?o.fetchHeader(void 0,R.bind(this)):o.actor.send("loadTile",A,R.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){const y=o.texture;y&&y instanceof i.T?(o.destroy(!0),this.map.painter.saveTileTexture(y)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,h,y){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(h,y,(C,A)=>{if(C)return o.state="errored",this.fire(new i.z(C)),void this.triggerRepaint(o);A&&(o._isHeaderLoaded=!0,o.setTexture(A,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:A})=>A===o),y=h&&h.fields,C=y&&y.bands&&y.bands;return C?C[0]:0}getTextureDescriptor(o,h,y){if(!o)return;const C=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!C)return;let A=null;h instanceof i.aN?A=h.paint.get("raster-array-band"):h instanceof i.aO&&(A=h.paint.get("raster-particle-array-band"));const R=A||this.getInitialBand(C);if(R!=null)if(o.textureDescriptor){if(!o.updateNeeded(C,R)||y)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,C,R)}getImages(o,h){const y=new Map;for(const C of o)for(const A of h){const[R,$]=A.split("/"),Z=C.getLayer(R);if(!Z||!Z.hasBand($)||!Z.hasDataForBand($))continue;const{bytes:se,tileSize:ue,buffer:be}=Z.getBandView($),ge=ue+2*be,Ce={data:new i.r({width:ge,height:ge},se),pixelRatio:2,sdf:!1,usvg:!1,version:0};y.set(A,Ce)}return y}}const Po={vector:Ps,raster:vs,"raster-dem":class extends vs{constructor(g,o,h,y){super(g,o,h,y),this.type="raster-dem",this.maxzoom=22,this._options=i.h({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(C,A){C&&(g.state="errored",o(C)),A&&(g.dem=A,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",o(null))}g.request=i.o(this.map._requestManager.transformRequest(h,i.R.Tile),(function(C,A,R,$){if(delete g.request,g.aborted)g.state="unloaded",o(null);else if(C)g.state="errored",o(C);else if(A){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:R,expires:$});const Z=ImageBitmap&&A instanceof ImageBitmap&&i.t(),se=1-(A.width-i.aL(A.width))/2;se<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const ue=Z?A:i.q.getImageData(A,se),be={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:ue,encoding:this.encoding,padding:se};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",be,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const o=g.canonical,h=Math.pow(2,o.z),y=(o.x-1+h)%h,C=o.x===0?g.wrap-1:g.wrap,A=(o.x+1+h)%h,R=o.x+1===h?g.wrap+1:g.wrap,$={};return $[new i.aM(g.overscaledZ,C,o.z,y,o.y).key]={backfilled:!1},$[new i.aM(g.overscaledZ,R,o.z,A,o.y).key]={backfilled:!1},o.y>0&&($[new i.aM(g.overscaledZ,C,o.z,y,o.y-1).key]={backfilled:!1},$[new i.aM(g.overscaledZ,g.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},$[new i.aM(g.overscaledZ,R,o.z,A,o.y-1).key]={backfilled:!1}),o.y+1<h&&($[new i.aM(g.overscaledZ,C,o.z,y,o.y+1).key]={backfilled:!1},$[new i.aM(g.overscaledZ,g.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},$[new i.aM(g.overscaledZ,R,o.z,A,o.y+1).key]={backfilled:!1}),$}},"raster-array":ra,geojson:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=o.data,this._options=i.h({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const C=i.aj/this.tileSize;this.workerOptions=i.h({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*C,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*C,extent:i.aj,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.aj,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*C,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const h of this._data.features)o.set(h.id,h);for(const h of g.features)o.set(h.id,h);this._data.features=[...o.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterChildren(g,o){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterLeaves(g,o,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:o,offset:h},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const o=i.h({append:g},this.workerOptions);o.scope=this.scope;const h=this._data;typeof h=="string"?(o.request=this.map._requestManager.transformRequest(i.q.resolveURL(h),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(y,C)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new i.z(y));else{const A={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&C&&C.resourceTiming&&C.resourceTiming[this.id]&&(A.resourceTiming=C.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new i.A("data",A)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=i.C(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,o){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,C=y?{image:y.image.clone()}:null,A=this._partialReload,R={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:C,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:A,worldview:this.map.getWorldview()};g.request=this.actor.send(h,R,($,Z)=>A&&!Z?(g.state="loaded",o(null)):(delete g.request,g.destroy(),g.aborted?o(null):$?o($):(g.loadVectorData(Z,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,o){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aP{constructor(g,o,h,y){super(g,o,h,y),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const o of g.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aQ(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new i.z(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const o=this.video.seekable;g<o.start(0)||g>o.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,o=g.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(g,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aP,model:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const g=[];for(const o in this._options.models){const h=this._options.models[o],y=i.aS(this.map._requestManager.transformRequest(h.uri,i.R.Model).url).then(C=>{if(!C)return;const A=i.aT(C),R=new i.aU(o,h.position,h.orientation,A);R.computeBoundsAndApplyParent(),this.models.push(R)}).catch(C=>{this.fire(new i.z(new Error(`Could not load model ${o} from ${h.uri}: ${C.message}`)))});g.push(y)}Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new i.z(new Error(`Could not load models: ${o.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,o){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(g,o,h,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Hr(this._options,this.map._requestManager,o,h,(y,C)=>{this._tileJSONRequest=null,this._loaded=!0,y?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.z(y))):C&&(i.h(this,C),C.bounds&&(this.tileBounds=new is(C.bounds,this.minzoom,this.maxzoom)),ei(C.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=o;else{if(g.buckets){const A=Object.values(g.buckets);for(const R of A)R.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,C.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,C.bind(this),void 0,!0);function C(A,R){return g.aborted?o(null):A&&A.status!==404?o(A):(this.map._refreshExpiredTiles&&R&&g.setExpiryData(R),g.loadModelData(R,this.map.painter),g.state="loaded",void o(null))}}serialize(){return i.h({},this._options)}},canvas:class extends i.aP{constructor(g,o,h,y){super(g,o,h,y),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(A=>typeof A!="number"))||this.fire(new i.z(new i.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${g}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof i.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new is(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.h(this,i.aF(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:o,y:h,z:y}=g.canonical;return this._implementation.hasTile({x:o,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,o){const{x:h,y,z:C}=g.tileID.canonical,A=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:C},{signal:A.signal})).then((function(R){return delete g.request,g.aborted?(g.state="unloaded",o(null)):R===void 0?(g.state="errored",o(null)):R===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",o(null)):function($){return $ instanceof ImageData||$ instanceof HTMLCanvasElement||$ instanceof ImageBitmap||$ instanceof HTMLImageElement}(R)?(this.loadTileData(g,R),g.state="loaded",void o(null)):(g.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(R=>{R.name!=="AbortError"&&(g.state="errored",o(R))}),g.request.cancel=()=>A.abort()}loadTileData(g,o){g.setTexture(o,this.map.painter)}unloadTile(g,o){if(g.texture&&g.texture instanceof i.T?(g.destroy(!0),g.texture&&g.texture instanceof i.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y,z:C}=g.tileID.canonical;this._implementation.unloadTile({x:h,y,z:C})}o&&o()}abortTile(g,o){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=i.C(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Sc=function(g,o,h,y){const C=new Po[o.type](g,o,h,y);if(C.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${C.id}`);return i.aV(["load","abort","unload","serialize","prepare"],C),C};function Xl(g,o,h=""){return`${h}:${o.id||""}:${o.layer.id}:${function(y){if("layerId"in y)return`layer:${y.layerId}`;{const{featuresetId:C,importId:A}=y;return`featureset:${C}${A?`:import:${A}`:""}`}}(g.target)}`}function lh(g,o,h,y=""){if(g.uniqueFeatureID){const C=Xl(g,o,y);if(h.has(C))return!0;h.add(C)}return!1}function ps(g,o,h,y,C=!1){const A=o.sourceCache.transform,R=o.sourceCache.tilesIn(g,o.has3DLayers,C);R.sort(_u);const $=[];for(const Z of R){const se=Z.tile.queryRenderedFeatures(o,Z,h,y,A,C);Object.keys(se).length&&$.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:se})}return $.length===0?{}:function(Z){const se={},ue={};for(const be of Z){const ge=be.queryResults,Ce=be.wrappedTileID,$e=ue[Ce]=ue[Ce]||{};for(const Ne in ge){const We=ge[Ne],Xe=$e[Ne]=$e[Ne]||{},et=se[Ne]=se[Ne]||[];for(const _t of We)Xe[_t.featureIndex]||(Xe[_t.featureIndex]=!0,et.push(_t))}}return se}($)}function la(g,o,h,y,C,A){const R={},$=y.queryRenderedSymbols(g),Z=[];for(const se of Object.keys($).map(Number))Z.push(C[se]);Z.sort(_u);for(const se of Z){const ue=se.featureIndex.lookupSymbolFeatures($[se.bucketInstanceId],se.bucketIndex,se.sourceLayerIndex,o,h,A);for(const be in ue){const ge=R[be]=R[be]||[],Ce=ue[be];Ce.sort(($e,Ne)=>{const We=se.featureSortOrder;if(We){const Xe=We.indexOf($e.featureIndex);return We.indexOf(Ne.featureIndex)-Xe}return Ne.featureIndex-$e.featureIndex});for(const $e of Ce)ge.push($e)}}return R}function $u(g,o){const h=g.getRenderableIds().map(A=>g.getTileByID(A)),y=[],C={};for(let A=0;A<h.length;A++){const R=h[A],$=R.tileID.canonical.key;C[$]||(C[$]=!0,R.querySourceFeatures(y,o))}return y}function _u(g,o){const h=g.tileID,y=o.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function ch(g,o){const h={};if(!o)return h;for(const y of g){const C=y.layerIds.map(A=>o.getLayer(A)).filter(Boolean);if(C.length!==0){y.layers=C,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(A=>C.filter(R=>R.id===A)[0]));for(const A of C)h[A.fqid]=y}}return h}const Lc=32,zc=33,Kh=new Uint16Array(8184);for(let g=0;g<2046;g++){let o=g+2,h=0,y=0,C=0,A=0,R=0,$=0;for(1&o?C=A=R=Lc:h=y=$=Lc;(o>>=1)>1;){const se=h+C>>1,ue=y+A>>1;1&o?(C=h,A=y,h=R,y=$):(h=C,y=A,C=R,A=$),R=se,$=ue}const Z=4*g;Kh[Z+0]=h,Kh[Z+1]=y,Kh[Z+2]=C,Kh[Z+3]=A}const ul=new Uint16Array(2178),Uc=new Uint8Array(1089),du=new Uint16Array(1089);function Yc(g){return g===0?-.03125:g===32?.03125:0}const Ds=(()=>({type:2,extent:i.aj,loadGeometry:()=>[[new i.P(0,0),new i.P(i.aj+1,0),new i.P(i.aj+1,i.aj+1),new i.P(0,i.aj+1),new i.P(0,0)]]}))();class Ys{constructor(o,h,y,C,A,R){this.tileID=o,this.uid=i.a$(),this.uses=0,this.tileSize=h,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=A,C&&C.style&&(this._lastUpdatedBrightness=C.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",C&&C.transform&&(this.projection=C.transform.projection),this.worldview=R}registerFadeDuration(o){const h=o+this.timeAdded;h<i.q.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,h,y){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=ch(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const C in this.buckets){const A=this.buckets[C];if(A instanceof i.b1){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const C in this.buckets){const A=this.buckets[C];if(A instanceof i.b1&&A.hasRTLText){this.hasRTLText=!0,i.b2();break}}this.queryPadding=0;for(const C in this.buckets){const A=this.buckets[C],R=h.style.getOwnLayer(C);if(!R)continue;const $=R.queryRadius(A);this.queryPadding=Math.max(this.queryPadding,$)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b0}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,h,y){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,ch(o.buckets,h.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const C in this.buckets){const A=this.buckets[C];A.uploadPending()&&A.upload(o)}const h=o.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new i.T(o,y.image,h.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(o,h,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,y),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const C=h.style.getBrightness();(this._lastUpdatedBrightness||C)&&(this._lastUpdatedBrightness&&C&&Math.abs(this._lastUpdatedBrightness-C)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==C),this._lastUpdatedBrightness=C))}queryRenderedFeatures(o,h,y,C,A,R){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const $=function(Z,se){const ue=i.bn([],[.5*Z.width,.5*-Z.height,1]);return i.bo(ue,ue,[1,-1,0]),i.az(ue,ue,Z.calculateProjMatrix(se.toUnwrapped())),Float32Array.from(ue)}(A,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:h,pixelPosMatrix:$,transform:C,availableImages:y,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(o,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const C=y.loadVTLayers(),A=h?h.sourceLayer:"",R=C._geojsonTileLayer||C[A];if(!R)return;const $=i.b3(h&&h.filter),{z:Z,x:se,y:ue}=this.tileID.canonical,be={z:Z,x:se,y:ue};for(let ge=0;ge<R.length;ge++){const Ce=R.feature(ge);if($.needGeometry){const We=i.b4(Ce,!0);if(!$.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),We,this.tileID.canonical))continue}else if(!$.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),Ce))continue;const $e=y.getId(Ce,A),Ne=new i.b5(Ce,Z,se,ue,$e);Ne.tile=be,o.push(Ne)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const y=i.b6(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let C=!1;if(this.expirationTime>y)C=!1;else if(h)if(this.expirationTime<h)C=!0;else{const A=this.expirationTime-h;A?this.expirationTime=y+Math.max(A,3e4):C=!0}else C=!0;C?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,h){if(!this.latestFeatureIndex||!o.style)return;const y=this.latestFeatureIndex.loadVTLayers(),C=o.style.listImages(),A=o.style.getBrightness();for(const R in this.buckets){if(!o.style.hasLayer(R))continue;const $=this.buckets[R],Z=$.layers[0],se=Z.sourceLayer||"_geojsonTileLayer",ue=y[se],be=o.style.getLayerSourceCache(Z);let ge={};be&&(ge=be._state.getState(se,void 0));const Ce=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},$e=Object.keys(ge).length>0&&!h;$e&&!$.stateDependentLayers.length&&!h||$.update(ge,ue,C,Ce,$e?$.stateDependentLayers:$.layers,h,A),($ instanceof i.b7||$ instanceof i.b8)&&o._terrain&&o._terrain.enabled&&be&&$.uploadPending()&&o._terrain._clearRenderCacheForTile(be.id,this.tileID);const Ne=o&&o.style&&o.style.getOwnLayer(R);Ne&&(this.queryPadding=Math.max(this.queryPadding,Ne.queryRadius($)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.q.now()+o}setTexture(o,h){const y=h.context,C=y.gl;this.texture=this.texture||h.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(y,o,C.RGBA8,{useMipmap:!0}),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE))}setDependencies(o,h){const y={};for(const C of h)y[C]=!0;this.dependencies[o]=y}hasDependency(o,h){for(const y of o){const C=this.dependencies[y];if(C){for(const A of h)if(C[A])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const y=i.b9(Ds,this.tileID.canonical,this.tileTransform)[0],C=new i.ba,A=new i.bb;for(let R=0;R<y.length;R++){const{x:$,y:Z}=y[R];C.emplaceBack($,Z),A.emplaceBack(R)}A.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(A),this._tileDebugBuffer=o.createVertexBuffer(C,i.bc.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,C.length,A.length)}_makeTileBoundsBuffers(o,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const y=i.b9(Ds,this.tileID.canonical,this.tileTransform)[0];let C,A;if(this.isRaster){const R=function($,Z){const se=i.aW($,Z),ue=Math.pow(2,$.z);for(let We=0;We<zc;We++)for(let Xe=0;Xe<zc;Xe++){const et=i.aX(($.x+(Xe+Yc(Xe))/Lc)/ue),_t=i.aY(($.y+(We+Yc(We))/Lc)/ue),Ct=Z.project(et,_t),jt=We*zc+Xe;ul[2*jt+0]=Math.round((Ct.x*se.scale-se.x)*i.aj),ul[2*jt+1]=Math.round((Ct.y*se.scale-se.y)*i.aj)}Uc.fill(0),du.fill(0);for(let We=2045;We>=0;We--){const Xe=4*We,et=Kh[Xe+0],_t=Kh[Xe+1],Ct=Kh[Xe+2],jt=Kh[Xe+3],Ft=et+Ct>>1,Rt=_t+jt>>1,Et=Ft+Rt-_t,Wt=Rt+et-Ft,qt=_t*zc+et,Ei=jt*zc+Ct,Mi=Rt*zc+Ft,Ki=Math.hypot((ul[2*qt+0]+ul[2*Ei+0])/2-ul[2*Mi+0],(ul[2*qt+1]+ul[2*Ei+1])/2-ul[2*Mi+1])>=16;Uc[Mi]=Uc[Mi]||(Ki?1:0),We<1022&&(Uc[Mi]=Uc[Mi]||Uc[(_t+Wt>>1)*zc+(et+Et>>1)]||Uc[(jt+Wt>>1)*zc+(Ct+Et>>1)])}const be=new i.aZ,ge=new i.a_;let Ce=0;function $e(We,Xe){const et=Xe*zc+We;return du[et]===0&&(be.emplaceBack(ul[2*et+0],ul[2*et+1],We*i.aj/Lc,Xe*i.aj/Lc),du[et]=++Ce),du[et]-1}function Ne(We,Xe,et,_t,Ct,jt){const Ft=We+et>>1,Rt=Xe+_t>>1;if(Math.abs(We-Ct)+Math.abs(Xe-jt)>1&&Uc[Rt*zc+Ft])Ne(Ct,jt,We,Xe,Ft,Rt),Ne(et,_t,Ct,jt,Ft,Rt);else{const Et=$e(We,Xe),Wt=$e(et,_t),qt=$e(Ct,jt);ge.emplaceBack(Et,Wt,qt)}}return Ne(0,0,Lc,Lc,Lc,0),Ne(Lc,Lc,0,0,0,Lc),{vertices:be,indices:ge}}(this.tileID.canonical,h);C=R.vertices,A=R.indices}else{C=new i.aZ,A=new i.a_;for(const{x:$,y:Z}of y)C.emplaceBack($,Z,0,0);const R=i.be(C.int16.subarray(0,4*C.length),void 0,4);for(let $=0;$<R.length;$+=3)A.emplaceBack(R[$],R[$+1],R[$+2])}this._tileBoundsBuffer=o.createVertexBuffer(C,i.bf.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(A),this._tileBoundsSegments=i.bd.simpleSegment(0,0,C.length,A.length)}_makeGlobeTileDebugBuffers(o,h){const y=h.projection;if(!y||y.name!=="globe"||h.freezeTileCoverage)return;const C=this.tileID.canonical,A=i.bg(C,h),R=i.bh(A),$=i.ah(h.zoom);let Z;$>0&&(Z=i.bi(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,C,h,R,Z,$),this._makeGlobeTileDebugTextBuffer(o,C,h,R,Z,$)}_globePoint(o,h,y,C,A,R,$){let Z=i.bj(o,h,y);if(R){const se=1<<y.z,ue=i.aD(C.center.lng),be=i.aH(C.center.lat),ge=(y.x+.5)/se-ue;let Ce=0;ge>.5?Ce=-1:ge<-.5&&(Ce=1);let $e=(o/i.aj+y.x)/se+Ce,Ne=(h/i.aj+y.y)/se;$e=($e-ue)*C._pixelsPerMercatorPixel+ue,Ne=(Ne-be)*C._pixelsPerMercatorPixel+be;const We=[$e*C.worldSize,Ne*C.worldSize,0];i.ad(We,We,R),Z=i.bk(Z,We,$)}return i.ad(Z,Z,A)}_makeGlobeTileDebugBorderBuffer(o,h,y,C,A,R){const $=new i.ba,Z=new i.bb,se=new i.bl,ue=(ge,Ce,$e,Ne,We)=>{const Xe=($e-ge)/(We-1),et=(Ne-Ce)/(We-1),_t=$.length;for(let Ct=0;Ct<We;Ct++){const jt=ge+Ct*Xe,Ft=Ce+Ct*et;$.emplaceBack(jt,Ft);const Rt=this._globePoint(jt,Ft,h,y,C,A,R);se.emplaceBack(Rt[0],Rt[1],Rt[2]),Z.emplaceBack(_t+Ct)}},be=i.aj;ue(0,0,be,0,16),ue(be,0,be,be,16),ue(be,be,0,be,16),ue(0,be,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(Z),this._tileDebugBuffer=o.createVertexBuffer($,i.bc.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(se,i.bm.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,$.length,Z.length)}_makeGlobeTileDebugTextBuffer(o,h,y,C,A,R){const $=i.aj/4,Z=new i.ba,se=new i.a_,ue=new i.bl,be=25;se.reserve(32),Z.reserve(be),ue.reserve(be);const ge=(Ce,$e)=>be*Ce+$e;for(let Ce=0;Ce<be;Ce++){const $e=Ce*$;for(let Ne=0;Ne<be;Ne++){const We=Ne*$;Z.emplaceBack(We,$e);const Xe=this._globePoint(We,$e,h,y,C,A,R);ue.emplaceBack(Xe[0],Xe[1],Xe[2])}}for(let Ce=0;Ce<4;Ce++)for(let $e=0;$e<4;$e++){const Ne=ge(Ce,$e),We=ge(Ce,$e+1),Xe=ge(Ce+1,$e),et=ge(Ce+1,$e+1);se.emplaceBack(Ne,We,Xe),se.emplaceBack(Xe,We,et)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(se),this._tileDebugTextBuffer=o.createVertexBuffer(Z,i.bc.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(ue,i.bm.members),this._tileDebugTextSegments=i.bd.simpleSegment(0,0,be,32)}destroy(o=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bp.setPbf(i.bq);class Cs extends Ys{constructor(o,h,y,C,A){super(o,h,y,C,A),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexture(o,h){const y=h.context,C=y.gl;this.texture=this.texture||h.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o,{premultiply:!1}):this.texture=new i.T(y,o,C.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,h){const y=this._mrt=new i.bp(30),C=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.br(C,(A,R,$,Z)=>{if(A)h(A);else try{const se=y.getHeaderLength(R);if(se>o)return void(this.request=this.fetchHeader(se,h));y.parseHeader(R),this._isHeaderLoaded=!0;let ue=0;for(const be of Object.values(y.layers))ue=Math.max(ue,be.dataIndex[be.dataIndex.length-1].lastByte);R.byteLength>=ue&&(this.entireBuffer=R),h(null,this.entireBuffer||R,$,Z)}catch(se){h(se)}}),this.request}fetchBand(o,h,y){const C=this._mrt;if(!this._isHeaderLoaded||!C)return void y(new Error("Tile header is not ready"));const A=this.actor;if(!A)return void y(new Error("Can't fetch tile band without an actor"));let R;const $=(be,ge)=>{R.complete(be,ge),be?y(be):(this.updateTextureDescriptor(o,h),y(null,this.textureDescriptor&&this.textureDescriptor.img))},Z=(be,ge)=>{if(be)return y(be);const Ce=A.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ge,task:R},$,void 0,!0);this._workQueue.push(()=>{Ce&&Ce.cancel(),R.cancel()})},se=C.getLayer(o);if(!se)return void y(new Error(`Unknown sourceLayer "${o}"`));if(se.hasDataForBand(h))return this.updateTextureDescriptor(o,h),void y(null,this.textureDescriptor?this.textureDescriptor.img:null);const ue=se.getDataRange([h]);if(R=C.createDecodingTask(ue),!R||R.tasks.length)if(this.flushQueues(),this.entireBuffer)Z(null,this.entireBuffer.slice(ue.firstByte,ue.lastByte+1));else{const be=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ue.firstByte}-${ue.lastByte}`}}),ge=i.br(be,Z);this._fetchQueue.push(()=>{ge.cancel(),R.cancel()})}else y(null)}updateNeeded(o,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,h){if(!this._mrt)return;const y=this._mrt.getLayer(o);if(!y||!y.hasBand(h)||!y.hasDataForBand(h))return;const{bytes:C,tileSize:A,buffer:R,offset:$,scale:Z}=y.getBandView(h),se=A+2*R,ue=new i.r({width:se,height:se},C),be=this.texture;be&&be instanceof i.T&&be.update(ue,{premultiply:!1}),this.textureDescriptor={layer:o,band:h,img:ue,buffer:R,offset:$,tileSize:A,format:y.pixelFormat,mix:[Z,256*Z,65536*Z,16777216*Z]}}}class to{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,y){const C=o.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);const A={value:h,timeout:void 0};if(y!==void 0&&(A.timeout=setTimeout(()=>{this.remove(o,A)},y)),this.data[C].push(A),this.order.push(C),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const y=o.wrapped().key,C=h===void 0?0:this.data[y].indexOf(h),A=this.data[y][C];return this.data[y].splice(C,1),A.timeout&&clearTimeout(A.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const y in this.data)for(const C of this.data[y])o(C.value)||h.push(C);for(const y of h)this.remove(y.value.tileID,y)}}class Xs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,y){const C=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][C]=this.stateChanges[o][C]||{},i.h(this.stateChanges[o][C],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const A in this.state[o])A!==C&&(this.deletedStates[o][A]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][C]===null){this.deletedStates[o][C]={};for(const A in this.state[o][C])y[A]||(this.deletedStates[o][C][A]=null)}else for(const A in y)this.deletedStates[o]&&this.deletedStates[o][C]&&this.deletedStates[o][C][A]===null&&delete this.deletedStates[o][C][A]}removeFeatureState(o,h,y){if(this.deletedStates[o]===null)return;const C=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&h!==void 0)this.deletedStates[o][C]!==null&&(this.deletedStates[o][C]=this.deletedStates[o][C]||{},this.deletedStates[o][C][y]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][C])for(y in this.deletedStates[o][C]={},this.stateChanges[o][C])this.deletedStates[o][C][y]=null;else this.deletedStates[o][C]=null;else this.deletedStates[o]=null}getState(o,h){const y=this.state[o]||{},C=this.stateChanges[o]||{},A=this.deletedStates[o];if(A===null)return{};if(h!==void 0){const $=String(h),Z=i.h({},y[$],C[$]);if(A){const se=A[h];if(se===null)return{};for(const ue in se)delete Z[ue]}return Z}const R=i.h({},y,C);if(A)for(const $ in A)delete R[$];return R}initializeTileState(o,h){o.refreshFeatureState(h)}coalesceChanges(o,h){const y={};for(const C in this.stateChanges){this.state[C]=this.state[C]||{};const A={};for(const R in this.stateChanges[C])this.state[C][R]||(this.state[C][R]={}),i.h(this.state[C][R],this.stateChanges[C][R]),A[R]=this.state[C][R];y[C]=A}for(const C in this.deletedStates){this.state[C]=this.state[C]||{};const A={};if(this.deletedStates[C]===null)for(const R in this.state[C])A[R]={},this.state[C][R]={};else for(const R in this.deletedStates[C]){if(this.deletedStates[C][R]===null)this.state[C][R]={};else if(this.state[C][R])for(const $ of Object.keys(this.deletedStates[C][R]))delete this.state[C][R][$];A[R]=this.state[C][R]}y[C]=y[C]||{},i.h(y[C],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const C in o)o[C].refreshFeatureState(h)}}class Bs extends i.E{constructor(o,h,y){super(),this.id=o,this._onlySymbols=y,h.on("data",C=>{C.dataType==="source"&&C.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new to(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Xs,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,h){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(o),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(ba).map(o=>o.key)}getRenderableIds(o,h){const y=[];for(const C in this._tiles)this._isIdRenderable(+C,o,h)&&y.push(this._tiles[C]);return o?y.sort((C,A)=>{const R=C.tileID,$=A.tileID,Z=new i.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle),se=new i.P($.canonical.x,$.canonical.y)._rotate(this.transform.angle);return R.overscaledZ-$.overscaledZ||se.y-Z.y||se.x-Z.x}).map(C=>C.tileID.key):y.map(C=>C.tileID).sort(ba).map(C=>C.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h,y){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())&&(y||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,h){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,o,h)))}_tileLoaded(o,h,y,C){if(C)if(o.state="errored",C.status!==404)this._source.fire(new i.z(C,{tile:o}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const A=this.map.painter.terrain;this.update(this.transform,A.getScaledDemTileSize(),!0),A.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=i.q.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const h=this.getRenderableIds();for(let C=0;C<h.length;C++){const A=h[C];if(o.neighboringTiles&&o.neighboringTiles[A]){const R=this.getTileByID(A);y(o,R),y(R,o)}}function y(C,A){if(!C.dem||C.dem.borderReady)return;C.needsHillshadePrepare=!0,C.needsDEMTextureUpload=!0;let R=A.tileID.canonical.x-C.tileID.canonical.x;const $=A.tileID.canonical.y-C.tileID.canonical.y,Z=Math.pow(2,C.tileID.canonical.z),se=A.tileID.key;R===0&&$===0||Math.abs($)>1||(Math.abs(R)>1&&(Math.abs(R+Z)===1?R+=Z:Math.abs(R-Z)===1&&(R-=Z)),A.dem&&C.dem&&(C.dem.backfillBorder(A.dem,R,$),C.neighboringTiles&&C.neighboringTiles[se]&&(C.neighboringTiles[se].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,y,C){for(const A in this._tiles){let R=this._tiles[A];if(C[A]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>y)continue;let $=R.tileID;for(;R&&R.tileID.overscaledZ>h+1;){const se=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[se.key],R&&R.hasData()&&($=se)}let Z=$;for(;Z.overscaledZ>h;)if(Z=Z.scaledTo(Z.overscaledZ-1),o[Z.key]){C[$.key]=$;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=o.overscaledZ-1;y>=h;y--){const C=o.scaledTo(y),A=this._getLoadedTile(C);if(A)return A}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,h){h=h||this._source.tileSize;const y=Math.ceil(o.width/h)+1,C=Math.ceil(o.height/h)+1,A=Math.floor(y*C*5),R=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,A):A,$=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,R):R;this._cache.setMaxSize($)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const y={};for(const C in this._tiles){const A=this._tiles[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),y[A.tileID.key]=A}this._tiles=y;for(const C in this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(const C in this._tiles)this._setTileReloadTimer(+C,this._tiles[C])}}update(o,h,y,C,A){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(o,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const R=this._source.type==="batched-model";let $,Z=this._source.maxzoom;const se=this.map&&this.map.painter?this.map.painter._terrain:null;if(se&&se.sourceCache===this&&se.attenuationRange()){const ge=se.attenuationRange()[0],Ce=Math.floor(ge)-Math.log2(se.getDemUpscale());Z>Ce&&(Z=Ce)}if(this.used||this.usedForTerrain){if(this._source.tileID)$=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(ge=>new i.aM(ge.canonical.z,ge.wrap,ge.canonical.z,ge.canonical.x,ge.canonical.y));else if(this.tileCoverLift!==0){const ge=o.clone();ge.tileCoverLift=this.tileCoverLift,$=ge.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:Z,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:R}),this._source.minzoom<=1&&o.projection.name==="globe"&&($.push(new i.aM(1,0,1,0,0)),$.push(new i.aM(1,0,1,1,0)),$.push(new i.aM(1,0,1,0,1)),$.push(new i.aM(1,0,1,1,1)))}else if($=o.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:Z,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:R}),this._source.hasTile){const ge=this._source.hasTile.bind(this._source);$=$.filter(Ce=>ge(Ce))}}else $=[];if($.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ca(this._source.type)){const ge=o.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),Ce=Math.min(ge,this._source.maxzoom);if(R){const $e=o.extendTileCover($,Ce);for(const Ne of $e)$.push(Ne)}else if(A){const $e=o.extendTileCover($,Ce,this.transform._camera.forward());for(const Ne of $e)$.push(Ne)}else if(this.castsShadows&&C){const $e=o.extendTileCover($,Ce,C);for(const Ne of $e)this._shadowCasterTiles[Ne.key]=!0,$.push(Ne)}}const ue=this._updateRetainedTiles($);if(ca(this._source.type)&&$.length!==0){const ge={},Ce={},$e=Object.keys(ue);for(const We of $e){const Xe=ue[We],et=this._tiles[We];if(!et||et.fadeEndTime&&et.fadeEndTime<=i.q.now())continue;const _t=this.findLoadedParent(Xe,Math.max(Xe.overscaledZ-Bs.maxOverzooming,this._source.minzoom));_t&&(this._addTile(_t.tileID),ge[_t.tileID.key]=_t.tileID),Ce[We]=Xe}const Ne=$[$.length-1].overscaledZ;for(const We in this._tiles){const Xe=this._tiles[We];if(ue[We]||!Xe.hasData())continue;let et=Xe.tileID;for(;et.overscaledZ>Ne;){et=et.scaledTo(et.overscaledZ-1);const _t=this._tiles[et.key];if(_t&&_t.hasData()&&Ce[et.key]){ue[We]=Xe.tileID;break}}}for(const We in ge)ue[We]||(this._coveredTiles[We]=!0,ue[We]=ge[We])}for(const ge in ue)this._tiles[ge].clearFadeHold();const be=i.bs(this._tiles,ue);for(const ge of be){const Ce=this._tiles[ge];Ce.hasSymbolBuckets&&!Ce.holdingForFade()?Ce.setHoldDuration(this.map._fadeDuration):Ce.hasSymbolBuckets&&!Ce.symbolFadeFinished()||this._removeTile(+ge)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const h={};if(o.length===0)return h;const y={},C=o.reduce((se,ue)=>Math.min(se,ue.overscaledZ),1/0),A=o[0].overscaledZ,R=Math.max(A-Bs.maxOverzooming,this._source.minzoom),$=Math.max(A+Bs.maxUnderzooming,this._source.minzoom),Z={};for(const se of o){const ue=this._addTile(se);h[se.key]=se,ue.hasData()||C<this._source.maxzoom&&(Z[se.key]=se)}this._retainLoadedChildren(Z,C,$,h);for(const se of o){let ue=this._tiles[se.key];if(ue.hasData())continue;if(se.canonical.z>=this._source.maxzoom){const ge=se.children(this._source.maxzoom)[0],Ce=this.getTile(ge);if(Ce&&Ce.hasData()){h[ge.key]=ge;continue}}else{const ge=se.children(this._source.maxzoom);if(h[ge[0].key]&&h[ge[1].key]&&h[ge[2].key]&&h[ge[3].key])continue}let be=ue.wasRequested();for(let ge=se.overscaledZ-1;ge>=R;--ge){const Ce=se.scaledTo(ge);if(y[Ce.key]||(y[Ce.key]=!0,ue=this.getTile(Ce),!ue&&be&&(ue=this._addTile(Ce)),ue&&(h[Ce.key]=Ce,be=ue.wasRequested(),ue.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let y,C=this._tiles[o].tileID;for(;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){y=this._loadedParentTiles[C.key];break}h.push(C.key);const A=C.scaledTo(C.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;C=A}for(const A of h)this._loadedParentTiles[A]=y}}_addTile(o){let h=this._tiles[o.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const y=!!h;if(!y){const C=this.map?this.map.painter:null,A=this._source.tileSize*o.overscaleFactor();h=this._source.type==="raster-array"?new Cs(o,A,this.transform.tileZoom,C,this._isRaster):new Ys(o,A,this.transform.tileZoom,C,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))}return h.uses++,this._tiles[o.key]=h,y||this._source.fire(new i.A("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=h.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,h,y){const C=[],A=this.transform;if(!A)return C;const R=A.projection.name==="globe",$=i.aD(A.center.lng);for(const Z in this._tiles){const se=this._tiles[Z];if(y&&se.clearQueryDebugViz(),se.holdingForFade())continue;let ue;if(R){const be=se.tileID.canonical;if(be.z===0){const ge=[Math.abs(i.ay($,...fh(be,-1))-$),Math.abs(i.ay($,...fh(be,1))-$)];ue=[0,2*ge.indexOf(Math.min(...ge))-1]}else{const ge=[Math.abs(i.ay($,...fh(be,-1))-$),Math.abs(i.ay($,...fh(be,0))-$),Math.abs(i.ay($,...fh(be,1))-$)];ue=[ge.indexOf(Math.min(...ge))-1]}}else ue=[0];for(const be of ue){const ge=o.containsTile(se,A,h,be);ge&&C.push(ge)}}return C}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,h){const y=this.getRenderableIds(o,h).map(A=>this._tiles[A].tileID),C=this.transform.projection.name==="globe";for(const A of y)A.projMatrix=this.transform.calculateProjMatrix(A.toUnwrapped()),A.expandedProjMatrix=C?this.transform.calculateProjMatrix(A.toUnwrapped(),!1,!0):A.projMatrix;return y}sortCoordinatesByDistance(o){const h=o.slice(),y=this.transform._camera.position,C=this.transform._camera.forward(),A={};for(const R of h){const $=1/(1<<R.canonical.z);A[R.key]=((R.canonical.x+.5)*$+R.wrap-y[0])*C[0]+((R.canonical.y+.5)*$-y[1])*C[1]-y[2]*C[2]}return h.sort((R,$)=>A[R.key]-A[$.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(ca(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(o,h,y){this._state.updateState(o=o||"_geojsonTileLayer",h,y)}removeFeatureState(o,h,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,y)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,y){const C=this._tiles[o];C&&C.setDependencies(h,y)}reloadTilesForDependencies(o,h){for(const y in this._tiles)this._tiles[y].hasDependency(o,h)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(o,h))}_preloadTiles(o,h){if(!this._sourceLoaded){const Z=()=>{this._sourceLoaded&&(this._source.off("data",Z),this._preloadTiles(o,h))};return void this._source.on("data",Z)}const y=new Map,C=Array.isArray(o)?o:[o],A=this.map.painter.terrain,R=this.usedForTerrain&&A?A.getScaledDemTileSize():this._source.tileSize;for(const Z of C){const se=Z.coveringTiles({tileSize:R,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ue of se)y.set(ue.key,ue);this.usedForTerrain&&Z.updateElevation(!1)}const $=Array.from(y.values());i.bt($,(Z,se)=>{const ue=new Ys(Z,this._source.tileSize*Z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(ue,be=>{this._source.type==="raster-dem"&&ue.dem&&this._backfillDEM(ue),se(be,ue)})},h)}}function ba(g,o){const h=Math.abs(2*g.wrap)-+(g.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||y-h||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function ca(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function fh(g,o){const h=1<<g.z;return[g.x/h+o,(g.x+1)/h+o]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class Il{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,h=!1;for(const y in this.style._mergedLayers){const C=this.style._mergedLayers[y];if(C.type==="fill-extrusion"||C.type==="building")this.layers.push({layer:C,visible:o,visibilityChanged:h});else if(C.type==="model"){const A=this.style.getLayerSource(C);A&&A.type==="batched-model"&&this.layers.push({layer:C,visible:o,visibilityChanged:h})}}}onNewFrame(o){this.layersGotHidden=!1;for(const h of this.layers){const y=h.layer;let C=!1;y.type==="fill-extrusion"?C=!y.isHidden(o)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="building"?C=!y.isHidden(o)&&y.paint.get("building-opacity")>0:y.type==="model"&&(C=!y.isHidden(o)&&y.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!C&&h.visible,h.visible=C}}updateZOffset(o,h){this.currentBuildingBuckets=[];for(const C of this.layers){const A=C.layer,R=this.style.getLayerSourceCache(A);let $=1;A.type==="fill-extrusion"?$=C.visible?A.paint.get("fill-extrusion-vertical-scale"):0:A.type==="building"&&($=C.visible?A.paint.get("building-vertical-scale"):0);let Z=R?R.getTile(h):null;if(!Z&&R&&h.canonical.z>R.getSource().minzoom){let se=h.scaledTo(Math.min(R.getSource().maxzoom,h.overscaledZ-1));for(;se.overscaledZ>=R.getSource().minzoom&&(Z=R.getTile(se),!Z&&se.overscaledZ!==0);)se=se.scaledTo(se.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:Z?Z.getBucket(A):null,tileID:Z?Z.tileID:h,verticalScale:$})}o.hasAnyZOffset=!1;let y=!1;for(let C=0;C<o.symbolInstances.length;C++){const A=o.symbolInstances.get(C),R=A.zOffset,$=this._getHeightAtTileOffset(h,A.tileAnchorX,A.tileAnchorY);A.zOffset=$!==Number.NEGATIVE_INFINITY?$:R,y||R===A.zOffset||(y=!0),o.hasAnyZOffset||A.zOffset===0||(o.hasAnyZOffset=!0)}y&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,h,y,C){let A=h,R=y;if(o.canonical.z!==C.canonical.z){const $=C.canonical,Z=1/(1<<o.canonical.z-$.z);A=(h+o.canonical.x*i.aj)*Z-$.x*i.aj|0,R=(y+o.canonical.y*i.aj)*Z-$.y*i.aj|0}return{tileX:A,tileY:R}}_getHeightAtTileOffset(o,h,y){let C,A;for(let R=0;R<this.layers.length;++R){const $=this.layers[R].layer;if($.type!=="fill-extrusion"&&$.type!=="building")continue;const{bucket:Z,tileID:se,verticalScale:ue}=this.currentBuildingBuckets[R];if(!Z)continue;const{tileX:be,tileY:ge}=this._mapCoordToOverlappingTile(o,h,y,se),Ce=Z.getHeightAtTileCoord(be,ge);Ce&&Ce.height!==void 0&&(Ce.hidden?C=Ce.height:A=Math.max(Ce.height*ue,A||0))}if(A!==void 0)return A;for(let R=0;R<this.layers.length;++R){const $=this.layers[R];if($.layer.type!=="model"||!$.visible)continue;const{bucket:Z,tileID:se}=this.currentBuildingBuckets[R];if(!Z)continue;const{tileX:ue,tileY:be}=this._mapCoordToOverlappingTile(o,h,y,se),ge=Z.getHeightAtTileCoord(ue,be);if(ge&&!ge.hidden)return ge.height===void 0&&C!==void 0?Math.min(ge.maxHeight,C)*ge.verticalScale:ge.height?ge.height*ge.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Dp(g,o){const h={};for(const y in g)y!=="ref"&&(h[y]=g[y]);return i.bu.forEach(y=>{y in o&&(h[y]=o[y])}),h}function Th(g){g=g.slice();const o=Object.create(null);for(let h=0;h<g.length;h++)o[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Dp(g[h],o[g[h].ref]));return g}const Vs={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function pu(g,o,h){h.push({command:Vs.addSource,args:[g,o[g]]})}function vu(g,o,h){o.push({command:Vs.removeSource,args:[g]}),h[g]=!0}function Qh(g,o,h,y){vu(g,h,y),pu(g,o,h)}function Vf(g,o,h){let y;for(y in g[h])if(g[h].hasOwnProperty(y)&&y!=="data"&&!i.bv(g[h][y],o[h][y]))return!1;for(y in o[h])if(o[h].hasOwnProperty(y)&&y!=="data"&&!i.bv(g[h][y],o[h][y]))return!1;return!0}function Tc(g,o,h,y,C,A){let R;for(R in o=o||{},g=g||{})g.hasOwnProperty(R)&&(i.bv(g[R],o[R])||h.push({command:A,args:[y,R,o[R],C]}));for(R in o)o.hasOwnProperty(R)&&!g.hasOwnProperty(R)&&(i.bv(g[R],o[R])||h.push({command:A,args:[y,R,o[R],C]}))}function hp(g){return g.id}function mh(g,o){return g[o.id]=o,g}class qa{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.ay(o,0,1);let h=1,y=this._distances[h];const C=o*this.paddedLength+this.padding;for(;y<C&&h<this._distances.length;)y=this._distances[++h];const A=h-1,R=this._distances[A],$=y-R,Z=$>0?(C-R)/$:0;return this.points[A].mult(1-Z).add(this.points[h].mult(Z))}}class Ka{constructor(o,h,y){const C=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(h/y);for(let R=0;R<this.xCellCount*this.yCellCount;R++)C.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,y,C,A){this._forEachCell(h,y,C,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(C),this.bboxes.push(A)}insertCircle(o,h,y,C){this._forEachCell(h-C,y-C,h+C,y+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(y),this.circles.push(C)}_insertBoxCell(o,h,y,C,A,R){this.boxCells[A].push(R)}_insertCircleCell(o,h,y,C,A,R){this.circleCells[A].push(R)}_query(o,h,y,C,A,R){if(y<0||o>this.width||C<0||h>this.height)return!A&&[];const $=[];if(o<=0&&h<=0&&this.width<=y&&this.height<=C){if(A)return!0;for(let Z=0;Z<this.boxKeys.length;Z++)$.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const se=this.circles[3*Z],ue=this.circles[3*Z+1],be=this.circles[3*Z+2];$.push({key:this.circleKeys[Z],x1:se-be,y1:ue-be,x2:se+be,y2:ue+be})}return R?$.filter(R):$}return this._forEachCell(o,h,y,C,this._queryCell,$,{hitTest:A,seenUids:{box:{},circle:{}}},R),A?$.length>0:$}_queryCircle(o,h,y,C,A){const R=o-y,$=o+y,Z=h-y,se=h+y;if($<0||R>this.width||se<0||Z>this.height)return!C&&[];const ue=[];return this._forEachCell(R,Z,$,se,this._queryCellCircle,ue,{hitTest:C,circle:{x:o,y:h,radius:y},seenUids:{box:{},circle:{}}},A),C?ue.length>0:ue}query(o,h,y,C,A){return this._query(o,h,y,C,!1,A)}hitTest(o,h,y,C,A){return this._query(o,h,y,C,!0,A)}hitTestCircle(o,h,y,C){return this._queryCircle(o,h,y,!0,C)}_queryCell(o,h,y,C,A,R,$,Z){const se=$.seenUids,ue=this.boxCells[A];if(ue!==null){const ge=this.bboxes;for(const Ce of ue)if(!se.box[Ce]){se.box[Ce]=!0;const $e=4*Ce;if(o<=ge[$e+2]&&h<=ge[$e+3]&&y>=ge[$e+0]&&C>=ge[$e+1]&&(!Z||Z(this.boxKeys[Ce]))){if($.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[Ce],x1:ge[$e],y1:ge[$e+1],x2:ge[$e+2],y2:ge[$e+3]})}}}const be=this.circleCells[A];if(be!==null){const ge=this.circles;for(const Ce of be)if(!se.circle[Ce]){se.circle[Ce]=!0;const $e=3*Ce;if(this._circleAndRectCollide(ge[$e],ge[$e+1],ge[$e+2],o,h,y,C)&&(!Z||Z(this.circleKeys[Ce]))){if($.hitTest)return R.push(!0),!0;{const Ne=ge[$e],We=ge[$e+1],Xe=ge[$e+2];R.push({key:this.circleKeys[Ce],x1:Ne-Xe,y1:We-Xe,x2:Ne+Xe,y2:We+Xe})}}}}}_queryCellCircle(o,h,y,C,A,R,$,Z){const se=$.circle,ue=$.seenUids,be=this.boxCells[A];if(be!==null){const Ce=this.bboxes;for(const $e of be)if(!ue.box[$e]){ue.box[$e]=!0;const Ne=4*$e;if(this._circleAndRectCollide(se.x,se.y,se.radius,Ce[Ne+0],Ce[Ne+1],Ce[Ne+2],Ce[Ne+3])&&(!Z||Z(this.boxKeys[$e])))return R.push(!0),!0}}const ge=this.circleCells[A];if(ge!==null){const Ce=this.circles;for(const $e of ge)if(!ue.circle[$e]){ue.circle[$e]=!0;const Ne=3*$e;if(this._circlesCollide(Ce[Ne],Ce[Ne+1],Ce[Ne+2],se.x,se.y,se.radius)&&(!Z||Z(this.circleKeys[$e])))return R.push(!0),!0}}}_forEachCell(o,h,y,C,A,R,$,Z){const se=this._convertToXCellCoord(o),ue=this._convertToYCellCoord(h),be=this._convertToXCellCoord(y),ge=this._convertToYCellCoord(C);for(let Ce=se;Ce<=be;Ce++)for(let $e=ue;$e<=ge;$e++)if(A.call(this,o,h,y,C,this.xCellCount*$e+Ce,R,$,Z))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,y,C,A,R){const $=C-o,Z=A-h,se=y+R;return se*se>$*$+Z*Z}_circleAndRectCollide(o,h,y,C,A,R,$){const Z=(R-C)/2,se=Math.abs(o-(C+Z));if(se>Z+y)return!1;const ue=($-A)/2,be=Math.abs(h-(A+ue));if(be>ue+y)return!1;if(se<=Z||be<=ue)return!0;const ge=se-Z,Ce=be-ue;return ge*ge+Ce*Ce<=y*y}}const zd={unknown:0,flipRequired:1,flipNotRequired:2},Vu=Math.tan(85*Math.PI/180);function Nh(g,o,h,y,C,A,R){const $=i.bz();if(h)if(A.name==="globe"){const Z=i.bA(C,o);i.az($,$,Z)}else{const Z=i.bB([],R);$[0]=Z[0],$[1]=Z[1],$[4]=Z[2],$[5]=Z[3],y||i.by($,$,C.angle)}else i.az($,C.labelPlaneMatrix,g);return $}function Ud(g,o,h,y,C,A,R){const $=Nh(g,o,h,y,C,A,R);return A.name==="globe"&&h||($[2]=$[6]=$[10]=$[14]=0),$}function up(g,o,h,y,C,A,R){if(h){if(A.name==="globe"){const $=Nh(g,o,h,y,C,A,R);return i.bi($,$),i.az($,g,$),$}{const $=i.bw(g),Z=i.bx([]);return Z[0]=R[0],Z[1]=R[1],Z[4]=R[2],Z[5]=R[3],i.az($,$,Z),y||i.by($,$,-C.angle),$}}return C.glCoordMatrix}function hc(g,o,h,y){const C=[g,o,h,1];h?i.aA(C,C,y):ao(C,C,y);const A=C[3];return C[0]/=A,C[1]/=A,C[2]/=A,C}function fu(g,o){return Math.min(.5+g/o*.5,1.5)}function Ha(g,o){const h=g[0]/g[3],y=g[1]/g[3];return h>=-o[0]&&h<=o[0]&&y>=-o[1]&&y<=o[1]}function Ll(g,o,h,y,C,A,R,$,Z,se){const ue=h.transform,be=y?g.textSizeData:g.iconSizeData,ge=i.bH(be,h.transform.zoom),Ce=ue.projection.name==="globe",$e=[256/h.width*2+1,256/h.height*2+1],Ne=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Ne.clear();let We=null;Ce&&(We=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const Xe=g.lineVertexArray,et=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,_t=h.transform.width/h.transform.height;let Ct,jt=!1;for(let Ft=0;Ft<et.length;Ft++){const Rt=et.get(Ft),{numGlyphs:Et,writingMode:Wt}=Rt;if(Wt!==i.bI.vertical||jt||Ct===i.bI.horizontal||(jt=!0),Ct=Wt,(Rt.hidden||Wt===i.bI.vertical)&&!jt){Fh(Et,Ne);continue}jt=!1;const qt=new i.P(Rt.tileAnchorX,Rt.tileAnchorY);let{x:Ei,y:Mi,z:Ki}=ue.projection.projectTilePoint(qt.x,qt.y,se.canonical);if(Z){const[dn,pn,on]=Z(qt);Ei+=dn,Mi+=pn,Ki+=on}const Ji=[Ei,Mi,Ki,1];if(i.aA(Ji,Ji,o),!Ha(Ji,$e)){Fh(Et,Ne);continue}const Er=Ji[3],Ti=fu(h.transform.getCameraToCenterDistance(ue.projection),Er),$i=i.bJ(be,ge,Rt),li=R?$i/Ti:$i*Ti,dr=hc(Ei,Mi,Ki,C);if(dr[3]<=0){Fh(Et,Ne);continue}let Ni={};const vr=i.al(g.layers[0].layout.get("text-max-angle")),Nr=Math.cos(vr),ar=R?null:Z,Br=Wu(Rt,li,!1,$,o,C,A,g.glyphOffsetArray,Xe,Ne,We,dr,qt,Ni,_t,ar,ue.projection,se,R,Nr);jt=Br.useVertical,ar&&Br.needsFlipping&&(Ni={}),(Br.notEnoughRoom||jt||Br.needsFlipping&&Wu(Rt,li,!0,$,o,C,A,g.glyphOffsetArray,Xe,Ne,We,dr,qt,Ni,_t,ar,ue.projection,se,R,Nr).notEnoughRoom)&&Fh(Et,Ne)}y?(g.text.dynamicLayoutVertexBuffer.updateData(Ne),We&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(We)):(g.icon.dynamicLayoutVertexBuffer.updateData(Ne),We&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(We))}function vd(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We){const{lineStartIndex:Xe,glyphStartIndex:et,segment:_t}=$,Ct=et+$.numGlyphs,jt=Xe+$.lineLength,Ft=o.getoffsetX(et),Rt=o.getoffsetX(Ct-1),Et=Cc(g*Ft,h,y,C,A,R,_t,Xe,jt,Z,se,ue,be,ge,!0,Ce,$e,Ne,We);if(!Et)return null;const Wt=Cc(g*Rt,h,y,C,A,R,_t,Xe,jt,Z,se,ue,be,ge,!0,Ce,$e,Ne,We);return Wt?{first:Et,last:Wt}:null}function Bh(g,o,h,y){return g===i.bI.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:g===i.bI.vertical?y>0?{needsFlipping:!0}:null:o!==zd.unknown&&function(C,A){return C===0||Math.abs(A/C)>Vu}(h,y)?o===zd.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Wu(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et,_t){const Ct=o/24,jt=g.lineOffsetX*Ct,Ft=g.lineOffsetY*Ct,{lineStartIndex:Rt,glyphStartIndex:Et,numGlyphs:Wt,segment:qt,writingMode:Ei,flipState:Mi}=g,Ki=Rt+g.lineLength,Ji=Er=>{if(ue){const[dr,Ni,vr]=Er.up,Nr=se.length;i.bK(ue,Nr+0,dr,Ni,vr),i.bK(ue,Nr+1,dr,Ni,vr),i.bK(ue,Nr+2,dr,Ni,vr),i.bK(ue,Nr+3,dr,Ni,vr)}const[Ti,$i,li]=Er.point;i.bL(se,Ti,$i,li,Er.angle)};if(Wt>1){const Er=vd(Ct,$,jt,Ft,h,be,ge,g,Z,A,Ce,Ne,!1,We,Xe,et,_t);if(!Er)return{notEnoughRoom:!0};if(y&&!h){let[Ti,$i,li]=Er.first.point,[dr,Ni,vr]=Er.last.point;[Ti,$i]=hc(Ti,$i,li,R),[dr,Ni]=hc(dr,Ni,vr,R);const Nr=Bh(Ei,Mi,(dr-Ti)*$e,Ni-$i);if(g.flipState=Nr&&Nr.needsFlipping?zd.flipRequired:zd.flipNotRequired,Nr)return Nr}Ji(Er.first);for(let Ti=Et+1;Ti<Et+Wt-1;Ti++){const $i=Cc(Ct*$.getoffsetX(Ti),jt,Ft,h,be,ge,qt,Rt,Ki,Z,A,Ce,Ne,!1,!1,We,Xe,et,_t);if(!$i)return se.length-=4*(Ti-Et),{notEnoughRoom:!0};Ji($i)}Ji(Er.last)}else{if(y&&!h){const Ti=hc(ge.x,ge.y,0,C),$i=Rt+qt+1,li=new i.P(Z.getx($i),Z.gety($i)),dr=hc(li.x,li.y,0,C),Ni=dr[3]>0?dr:Ma(ge,li,Ti,1,C,void 0,We,Xe.canonical),vr=Bh(Ei,Mi,(Ni[0]-Ti[0])*$e,Ni[1]-Ti[1]);if(g.flipState=vr&&vr.needsFlipping?zd.flipRequired:zd.flipNotRequired,vr)return vr}const Er=Cc(Ct*$.getoffsetX(Et),jt,Ft,h,be,ge,qt,Rt,Ki,Z,A,Ce,Ne,!1,!1,We,Xe,et,_t);if(!Er)return{notEnoughRoom:!0};Ji(Er)}return{}}function Xc(g,o,h,y,C){const{x:A,y:R,z:$}=y.projectTilePoint(g.x,g.y,o);if(!C)return hc(A,R,$,h);const[Z,se,ue]=C(g);return hc(A+Z,R+se,$+ue,h)}function Ma(g,o,h,y,C,A,R,$){const Z=Xc(g.sub(o)._unit()._add(g),$,C,R,A);return i.at(Z,h,Z),i.au(Z,Z),i.bE(Z,h,Z,y)}function Cc(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et){const _t=y?g-o:g+o;let Ct=_t>0?1:-1,jt=0;y&&(Ct*=-1,jt=Math.PI),Ct<0&&(jt+=Math.PI);let Ft=$+R+(Ct>0?0:1)|0,Rt=C,Et=C,Wt=0,qt=0;const Ei=Math.abs(_t),Mi=[],Ki=[];let Ji=A,Er=Ji,Ti=i.bC([]);const $i=()=>Ma(Er,Ji,Et,Ei-Wt+1,ue,ge,Ne,We.canonical);for(;Wt+qt<=Ei;){if(Ft+=Ct,Ft<$||Ft>=Z)return null;if(Et=Rt,Er=Ji,Mi.push(Et),Ce&&Ki.push(Er),Ji=new i.P(se.getx(Ft),se.gety(Ft)),Rt=be[Ft],!Rt){const on=Xc(Ji,We.canonical,ue,Ne,ge);Rt=on[3]>0?be[Ft]=on:$i()}Wt+=qt;const dn=i.at([],Rt,Et),pn=i.bD(Et,Rt);if(h&&pn>0&&qt>0&&i.bG(Ti,dn)/(qt*pn)<et)return null;qt=pn,Ti=dn}$e&&ge&&(be[Ft]&&(Rt=$i(),qt=i.bD(Et,Rt),Ti=i.at([],Rt,Et)),be[Ft]=Rt);const li=(Ei-Wt)/qt,dr=Ji.sub(Er)._mult(li)._add(Er),Ni=i.bE([],Et,Ti,li);let vr=[0,0,1],Nr=Ti[0],ar=Ti[1];if(Xe&&(vr=Ne.upVector(We.canonical,dr.x,dr.y),vr[0]!==0||vr[1]!==0||vr[2]!==1)){const dn=[vr[2],0,-vr[0]],pn=i.bF([],vr,dn);i.au(dn,dn),i.au(pn,pn),Nr=i.bG(Ti,dn),ar=i.bG(Ti,pn)}if(h){const dn=i.bF([],vr,Ti);i.au(dn,dn),i.bE(Ni,Ni,dn,h*Ct)}const Br=jt+Math.atan2(ar,Nr);return Mi.push(Ni),Ce&&Ki.push(dr),{point:Ni,angle:Br,path:Mi,tilePath:Ki,up:vr}}function Fh(g,o){const h=o.length,y=h+4*g;o.resize(y),o.float32.fill(-1/0,4*h,4*y)}function ao(g,o,h){const y=o[0],C=o[1];return g[0]=h[0]*y+h[4]*C+h[12],g[1]=h[1]*y+h[5]*C+h[13],g[3]=h[3]*y+h[7]*C+h[15],g}const Dl=100;class xu{constructor(o,h,y=new Ka(o.width+200,o.height+200,25),C=new Ka(o.width+200,o.height+200,25)){this.transform=o,this.grid=y,this.ignoredGrid=C,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Dl,this.screenBottomBoundary=o.height+Dl,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,y,C,A,R,$,Z){let se=y.projectedAnchorX,ue=y.projectedAnchorY,be=y.projectedAnchorZ;const ge=y.elevation,Ce=y.tileID,$e=o.getProjection();if(ge&&Ce){const[Ft,Rt,Et]=$e.upVector(Ce.canonical,y.tileAnchorX,y.tileAnchorY),Wt=$e.upVectorScale(Ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;se+=Ft*ge*Wt,ue+=Rt*ge*Wt,be+=Et*ge*Wt}const Ne=this.projectAndGetPerspectiveRatio($,se,ue,be,y.tileID,$e.name==="globe"||!!ge||this.transform.pitch>0,$e),We=R*Ne.perspectiveRatio,Xe=(y.x1*h+C.x-y.padding)*We+Ne.point.x,et=(y.y1*h+C.y-y.padding)*We+Ne.point.y,_t=(y.x2*h+C.x+y.padding)*We+Ne.point.x,Ct=(y.y2*h+C.y+y.padding)*We+Ne.point.y,jt=Ne.perspectiveRatio<=.55||Ne.occluded;return!this.isInsideGrid(Xe,et,_t,Ct)||!A&&this.grid.hitTest(Xe,et,_t,Ct,Z)||jt?{box:[],offscreen:!1,occluded:Ne.occluded}:{box:[Xe,et,_t,Ct],offscreen:this.isOffscreen(Xe,et,_t,Ct),occluded:!1}}placeCollisionCircles(o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne){const We=[],Xe=this.transform.elevation,et=o.getProjection(),_t=Xe?Xe.getAtTileOffsetFunc(Ne,this.transform.center.lat,this.transform.worldSize,et):null,Ct=new i.P(y.tileAnchorX,y.tileAnchorY);let{x:jt,y:Ft,z:Rt}=et.projectTilePoint(Ct.x,Ct.y,Ne.canonical);if(_t){const[vr,Nr,ar]=_t(Ct);jt+=vr,Ft+=Nr,Rt+=ar}const Et=et.name==="globe",Wt=this.projectAndGetPerspectiveRatio($,jt,Ft,Rt,Ne,Et||!!Xe||this.transform.pitch>0,et),{perspectiveRatio:qt}=Wt,Ei=(be?R/qt:R*qt)/i.bO,Mi=hc(jt,Ft,Rt,Z),Ki=y.lineOffsetX*Ei,Ji=y.lineOffsetY*Ei,Er=i.al(o.layers[0].layout.get("text-max-angle")),Ti=Math.cos(Er),$i=Wt.signedDistanceFromCamera>0?vd(Ei,A,Ki,Ji,!1,Mi,Ct,y,C,Z,{},Xe&&!be?_t:null,be&&!!Xe,et,Ne,be,Ti):null;let li=!1,dr=!1,Ni=!0;if($i&&!Wt.occluded){const vr=.5*Ce*qt+$e,Nr=new i.P(-100,-100),ar=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Br=new qa,{first:dn,last:pn}=$i,on=dn.path.length;let bn=[];for(let Zn=on-1;Zn>=1;Zn--)bn.push(dn.path[Zn]);for(let Zn=1;Zn<pn.path.length;Zn++)bn.push(pn.path[Zn]);const An=2.5*vr;se&&(bn=bn.map(([Zn,ys,Bo],Da)=>(_t&&!Et&&(Bo=_t(Da<on-1?dn.tilePath[on-1-Da]:pn.tilePath[Da-on+2])[2]),hc(Zn,ys,Bo,se))),bn.some(Zn=>Zn[3]<=0)&&(bn=[]));let Vn=[];if(bn.length>0){let Zn=1/0,ys=-1/0,Bo=1/0,Da=-1/0;for(const xo of bn)Zn=Math.min(Zn,xo[0]),Bo=Math.min(Bo,xo[1]),ys=Math.max(ys,xo[0]),Da=Math.max(Da,xo[1]);ys>=Nr.x&&Zn<=ar.x&&Da>=Nr.y&&Bo<=ar.y&&(Vn=[bn.map(xo=>new i.P(xo[0],xo[1]))],(Zn<Nr.x||ys>ar.x||Bo<Nr.y||Da>ar.y)&&(Vn=i.bM(Vn,Nr.x,Nr.y,ar.x,ar.y)))}for(const Zn of Vn){Br.reset(Zn,.25*vr);let ys=0;ys=Br.length<=.5*vr?1:Math.ceil(Br.paddedLength/An)+1;for(let Bo=0;Bo<ys;Bo++){const Da=Bo/Math.max(ys-1,1),xo=Br.lerp(Da),ia=xo.x+Dl,sl=xo.y+Dl;We.push(ia,sl,vr,0);const ls=ia-vr,cs=sl-vr,Ts=ia+vr,_a=sl+vr;if(Ni=Ni&&this.isOffscreen(ls,cs,Ts,_a),dr=dr||this.isInsideGrid(ls,cs,Ts,_a),!h&&this.grid.hitTestCircle(ia,sl,vr,ge)&&(li=!0,!ue))return{circles:[],offscreen:!1,collisionDetected:li,occluded:!1}}}}return{circles:!ue&&li||!dr?[]:We,offscreen:Ni,collisionDetected:li,occluded:Wt.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,C=1/0,A=-1/0,R=-1/0;for(const ue of o){const be=new i.P(ue.x+Dl,ue.y+Dl);y=Math.min(y,be.x),C=Math.min(C,be.y),A=Math.max(A,be.x),R=Math.max(R,be.y),h.push(be)}const $=this.grid.query(y,C,A,R).concat(this.ignoredGrid.query(y,C,A,R)),Z={},se={};for(const ue of $){const be=ue.key;if(Z[be.bucketInstanceId]===void 0&&(Z[be.bucketInstanceId]={}),Z[be.bucketInstanceId][be.featureIndex])continue;const ge=[new i.P(ue.x1,ue.y1),new i.P(ue.x2,ue.y1),new i.P(ue.x2,ue.y2),new i.P(ue.x1,ue.y2)];i.bN(h,ge)&&(Z[be.bucketInstanceId][be.featureIndex]=!0,se[be.bucketInstanceId]===void 0&&(se[be.bucketInstanceId]=[]),se[be.bucketInstanceId].push(be.featureIndex))}return se}insertCollisionBox(o,h,y,C,A){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:C,collisionGroupID:A},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,y,C,A){const R=h?this.ignoredGrid:this.grid,$={bucketInstanceId:y,featureIndex:C,collisionGroupID:A};for(let Z=0;Z<o.length;Z+=4)R.insertCircle($,o[Z],o[Z+1],o[Z+2])}projectAndGetPerspectiveRatio(o,h,y,C,A,R,$){const Z=[h,y,C,1];let se=!1;C||this.transform.pitch>0?(i.aA(Z,Z,o),this.fogState&&A&&$.name!=="globe"&&(se=function(ge,Ce,$e,Ne,We,Xe){const et=Xe.calculateFogTileMatrix(We),_t=[Ce,$e,Ne];return i.ad(_t,_t,et),Pr(ge,i.ae(_t),Xe.pitch,Xe._fov)}(this.fogState,h,y,C,A.toUnwrapped(),this.transform)>.9)):ao(Z,Z,o);const ue=Z[3];return{point:new i.P((Z[0]/ue+1)/2*this.transform.width+Dl,(-Z[1]/ue+1)/2*this.transform.height+Dl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance($)/ue*.5,1.5),signedDistanceFromCamera:ue,occluded:R&&Z[2]>ue||se}}isOffscreen(o,h,y,C){return y<Dl||o>=this.screenRightBoundary||C<Dl||h>this.screenBottomBoundary}isInsideGrid(o,h,y,C){return y>=0&&o<this.gridRightBoundary&&C>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=i.bx([]);return i.bo(o,o,[-100,-100,0]),o}}function af(g,o,h){const y=o.createTileMatrix(g,g.worldSize,h.toUnwrapped());return i.az(new Float32Array(16),g.projMatrix,y)}function kn(g,o,h){if(o.projection.name===h.projection.name)return g.projMatrix;const y=h.clone();return y.setProjection(o.projection),af(y,o.getProjection(),g)}function lf(g,o,h){return o.name===h.projection.name?g.projMatrix:af(h,o,g)}class ic{constructor(o,h,y,C){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):C&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class wl{constructor(o,h,y,C,A,R=!1){this.text=new ic(o?o.text:null,h,y,A),this.icon=new ic(o?o.icon:null,h,C,A),this.clipped=R}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qa{constructor(o,h,y,C=!1){this.text=o,this.icon=h,this.skipFade=y,this.clipped=C}}class Zl{constructor(){this.invProjMatrix=i.bz(),this.viewportMatrix=i.bz(),this.circles=[]}}class $c{constructor(o,h,y,C,A){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=C,this.tileID=A}}class vn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[o]}}function os(g,o,h,y,C){const{horizontalAlign:A,verticalAlign:R}=i.bT(g),$=-(A-.5)*o,Z=-(R-.5)*h,se=i.bU(g,y);return new i.P($+se[0]*C,Z+se[1]*C)}function Zs(g,o,h,y,C){const A=new i.P(g,o);return h&&A._rotate(y?C:-C),A}class zl{constructor(o,h,y,C,A,R){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new xu(this.transform,A),this.buildingIndex=R,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new vn(y),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,y,C,A=1){const R=y.getBucket(h),$=y.latestFeatureIndex;if(!R||!$||h.fqid!==R.layerIds[0])return;const Z=R.layers[0].layout,se=R.layers[0].paint,ue=y.collisionBoxArray,be=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),ge=y.tileSize/i.aj,Ce=y.tileID.toUnwrapped();this.transform.setProjection(R.projection);const $e=(Ne=y.tileID,We=R.getProjection(),Xe=this.transform,We.name===this.projection?Xe.calculateProjMatrix(Ne.toUnwrapped()):af(Xe,We,Ne));var Ne,We,Xe;const et=Z.get("text-pitch-alignment")==="map",_t=Z.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Ct=h.dynamicFilter(),jt=h.dynamicFilterNeedsFeature(),Ft=this.transform.calculatePixelsToTileUnitsMatrix(y),Rt=Ud($e,y.tileID.canonical,et,_t,this.transform,R.getProjection(),Ft);let Et=null;if(et){const $i=up($e,y.tileID.canonical,et,_t,this.transform,R.getProjection(),Ft);Et=i.az([],this.transform.labelPlaneMatrix,$i)}let Wt=null;Ct&&y.latestFeatureIndex&&(Wt={unwrappedTileID:Ce,dynamicFilter:Ct,dynamicFilterNeedsFeature:jt}),this.retainedQueryData[R.bucketInstanceId]=new $c(R.bucketInstanceId,$,R.sourceLayerIndex,R.index,y.tileID);const[qt,Ei]=R.layers[0].layout.get("text-size-scale-range"),Mi=i.ay(A,qt,Ei),[Ki,Ji]=Z.get("icon-size-scale-range"),Er=i.ay(A,Ki,Ji),Ti={bucket:R,layout:Z,paint:se,posMatrix:$e,textLabelPlaneMatrix:Rt,labelToScreenMatrix:Et,clippingData:Wt,scale:be,textPixelRatio:ge,holdingForFade:y.holdingForFade(),collisionBoxArray:ue,partiallyEvaluatedTextSize:i.bH(R.textSizeData,this.transform.zoom,Mi),partiallyEvaluatedIconSize:i.bH(R.iconSizeData,this.transform.zoom,Er),collisionGroup:this.collisionGroups.get(R.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(C)for(const $i of R.sortKeyRanges){const{sortKey:li,symbolInstanceStart:dr,symbolInstanceEnd:Ni}=$i;o.push({sortKey:li,symbolInstanceStart:dr,symbolInstanceEnd:Ni,parameters:Ti})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:R.symbolInstances.length,parameters:Ti})}attemptAnchorPlacement(o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et){const{textOffset0:_t,textOffset1:Ct,crossTileID:jt}=ge,Ft=[_t,Ct],Rt=os(o,y,C,Ft,A),Et=this.collisionIndex.placeCollisionBox($e,A,h,Zs(Rt.x,Rt.y,R,$,this.transform.angle),be,Z,se,ue.predicate);if(We){const Wt=$e.getSymbolInstanceIconSize(et,this.transform.zoom,ge.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($e,Wt,We,Zs(Rt.x,Rt.y,R,$,this.transform.angle),be,Z,se,ue.predicate).box.length===0)return}if(Et.box.length>0){let Wt;return this.prevPlacement&&this.prevPlacement.variableOffsets[jt]&&this.prevPlacement.placements[jt]&&this.prevPlacement.placements[jt].text&&(Wt=this.prevPlacement.variableOffsets[jt].anchor),this.variableOffsets[jt]={textOffset:Ft,width:y,height:C,anchor:o,textScale:A,prevAnchor:Wt},this.markUsedJustification($e,o,ge,Ne),$e.allowVerticalPlacement&&(this.markUsedOrientation($e,Ne,ge),this.placedOrientations[jt]=Ne),{shift:Rt,placedGlyphBoxes:Et}}}placeLayerBucketPart(o,h,y,C,A=1){const{bucket:R,layout:$,paint:Z,posMatrix:se,textLabelPlaneMatrix:ue,labelToScreenMatrix:be,clippingData:ge,textPixelRatio:Ce,holdingForFade:$e,collisionBoxArray:Ne,partiallyEvaluatedTextSize:We,partiallyEvaluatedIconSize:Xe,collisionGroup:et,latestFeatureIndex:_t}=o.parameters,Ct=$.get("text-optional"),jt=$.get("icon-optional"),Ft=$.get("text-allow-overlap"),Rt=$.get("icon-allow-overlap"),Et=$.get("text-rotation-alignment")==="map",Wt=$.get("text-pitch-alignment")==="map",qt=Z.get("symbol-z-offset"),Ei=$.get("symbol-elevation-reference")==="sea",[Mi,Ki]=$.get("text-size-scale-range"),[Ji,Er]=$.get("icon-size-scale-range"),Ti=i.ay(A,Mi,Ki),$i=i.ay(A,Ji,Er);this.transform.setProjection(R.projection);let li=Ft&&(Rt||!R.hasIconData()||jt),dr=Rt&&(Ft||!R.hasTextData()||Ct);const Ni=!qt.isConstant();!R.collisionArrays&&Ne&&R.deserializeCollisionBoxes(Ne),y&&C&&R.updateCollisionDebugBuffers(this.transform.zoom,Ne,Ti,$i);const vr=(ar,Br,dn)=>{const{crossTileID:pn,numVerticalGlyphVertices:on}=ar;let bn=null;if(ge&&ge.dynamicFilterNeedsFeature||Ni){const Ca=this.retainedQueryData[R.bucketInstanceId];bn=_t.loadFeature({featureIndex:ar.featureIndex,bucketIndex:Ca.bucketIndex,sourceLayerIndex:Ca.sourceLayerIndex,layoutVertexArrayOffset:0})}if(ge&&!(0,ge.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},bn,this.retainedQueryData[R.bucketInstanceId].tileID.canonical,new i.P(ar.tileAnchorX,ar.tileAnchorY),this.transform.calculateDistanceTileData(ge.unwrappedTileID)))return this.placements[pn]=new Qa(!1,!1,!1,!0),void h.add(pn);const An=qt.evaluate(bn,{});if(h.has(pn))return;if($e)return void(this.placements[pn]=new Qa(!1,!1,!1));let Vn=!1,Zn=!1,ys=!0,Bo=!1,Da=!1,xo=null,ia={box:null,offscreen:null,occluded:null},sl={box:null},ls=null,cs=null,Ts=null,_a=0,Jl=0,Zo=0;dn.textFeatureIndex?_a=dn.textFeatureIndex:ar.useRuntimeCollisionCircles&&(_a=ar.featureIndex),dn.verticalTextFeatureIndex&&(Jl=dn.verticalTextFeatureIndex);const Wo=Ca=>{Ca.tileID=this.retainedQueryData[R.bucketInstanceId].tileID;const Ko=this.transform.elevation;Ca.elevation=Ei?An:An+(Ko?Ko.getAtTileOffset(Ca.tileID,Ca.tileAnchorX,Ca.tileAnchorY):0),Ca.elevation+=ar.zOffset},ol=dn.textBox;if(ol){Wo(ol);const Ca=bo=>{let Ya=i.bI.horizontal;if(R.allowVerticalPlacement&&!bo&&this.prevPlacement){const _h=this.prevPlacement.placedOrientations[pn];_h&&(this.placedOrientations[pn]=_h,Ya=_h,this.markUsedOrientation(R,Ya,ar))}return Ya},Ko=(bo,Ya)=>{if(R.allowVerticalPlacement&&on>0&&dn.verticalTextBox){for(const _h of R.writingModes)if(_h===i.bI.vertical?(ia=Ya(),sl=ia):ia=bo(),ia&&ia.box&&ia.box.length)break}else ia=bo()};if($.get("text-variable-anchor")){let bo=$.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pn]){const ua=this.prevPlacement.variableOffsets[pn];bo.indexOf(ua.anchor)>0&&(bo=bo.filter(Fo=>Fo!==ua.anchor),bo.unshift(ua.anchor))}const Ya=(ua,Fo,ru)=>{const Ah=R.getSymbolInstanceTextSize(We,ar,this.transform.zoom,Br),od=(ua.x2-ua.x1)*Ah+2*ua.padding,Od=(ua.y2-ua.y1)*Ah+2*ua.padding,nu=ar.hasIconTextFit&&!Rt?Fo:null;nu&&Wo(nu);let su={box:[],offscreen:!1,occluded:!1};const Qd=Ft?2*bo.length:bo.length;for(let ad=0;ad<Qd;++ad){const Jd=this.attemptAnchorPlacement(bo[ad%bo.length],ua,od,Od,Ah,Et,Wt,Ce,se,et,ad>=bo.length,ar,Br,R,ru,nu,We,Xe);if(Jd&&(su=Jd.placedGlyphBoxes,su&&su.box&&su.box.length)){Vn=!0,xo=Jd.shift;break}}return su};Ko(()=>Ya(ol,dn.iconBox,i.bI.horizontal),()=>{const ua=dn.verticalTextBox;return ua&&Wo(ua),R.allowVerticalPlacement&&!(ia&&ia.box&&ia.box.length)&&on>0&&ua?Ya(ua,dn.verticalIconBox,i.bI.vertical):{box:null,offscreen:null,occluded:null}}),ia&&(Vn=ia.box,ys=ia.offscreen,Bo=ia.occluded);const _h=Ca(!(!ia||!ia.box));if(!Vn&&this.prevPlacement){const ua=this.prevPlacement.variableOffsets[pn];ua&&(this.variableOffsets[pn]=ua,this.markUsedJustification(R,ua.anchor,ar,_h))}}else{const bo=(Ya,_h)=>{const ua=R.getSymbolInstanceTextSize(We,ar,this.transform.zoom,Br,A),Fo=this.collisionIndex.placeCollisionBox(R,ua,Ya,new i.P(0,0),Ft,Ce,se,et.predicate);return Fo&&Fo.box&&Fo.box.length&&(this.markUsedOrientation(R,_h,ar),this.placedOrientations[pn]=_h),Fo};Ko(()=>bo(ol,i.bI.horizontal),()=>{const Ya=dn.verticalTextBox;return R.allowVerticalPlacement&&on>0&&Ya?(Wo(Ya),bo(Ya,i.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Ca(!!(ia&&ia.box&&ia.box.length))}}if(ls=ia,Vn=ls&&ls.box&&ls.box.length>0,ys=ls&&ls.offscreen,Bo=ls&&ls.occluded,ar.useRuntimeCollisionCircles){const Ca=R.text.placedSymbolArray.get(ar.centerJustifiedTextSymbolIndex>=0?ar.centerJustifiedTextSymbolIndex:ar.verticalPlacedTextSymbolIndex),Ko=i.bJ(R.textSizeData,We,Ca),bo=$.get("text-padding");cs=this.collisionIndex.placeCollisionCircles(R,Ft,Ca,R.lineVertexArray,R.glyphOffsetArray,Ko,se,ue,be,y,Wt,et.predicate,ar.collisionCircleDiameter*Ko/i.bO,bo,this.retainedQueryData[R.bucketInstanceId].tileID),Vn=Ft||cs.circles.length>0&&!cs.collisionDetected,ys=ys&&cs.offscreen,Bo=cs.occluded}if(dn.iconFeatureIndex&&(Zo=dn.iconFeatureIndex),dn.iconBox){const Ca=Ko=>{Wo(Ko);const bo=ar.hasIconTextFit&&xo?Zs(xo.x,xo.y,Et,Wt,this.transform.angle):new i.P(0,0),Ya=R.getSymbolInstanceIconSize(Xe,this.transform.zoom,ar.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(R,Ya,Ko,bo,Rt,Ce,se,et.predicate)};sl&&sl.box&&sl.box.length&&dn.verticalIconBox?(Ts=Ca(dn.verticalIconBox),Zn=Ts.box.length>0):(Ts=Ca(dn.iconBox),Zn=Ts.box.length>0),ys=ys&&Ts.offscreen,Da=Ts.occluded}const Ws=Ct||ar.numHorizontalGlyphVertices===0&&on===0,ec=jt||ar.numIconVertices===0;if(Ws||ec?ec?Ws||(Zn=Zn&&Vn):Vn=Zn&&Vn:Zn=Vn=Zn&&Vn,Vn&&ls&&ls.box&&this.collisionIndex.insertCollisionBox(ls.box,$.get("text-ignore-placement"),R.bucketInstanceId,sl&&sl.box&&Jl?Jl:_a,et.ID),Zn&&Ts&&this.collisionIndex.insertCollisionBox(Ts.box,$.get("icon-ignore-placement"),R.bucketInstanceId,Zo,et.ID),cs&&(Vn&&this.collisionIndex.insertCollisionCircles(cs.circles,$.get("text-ignore-placement"),R.bucketInstanceId,_a,et.ID),y)){const Ca=R.bucketInstanceId;let Ko=this.collisionCircleArrays[Ca];Ko===void 0&&(Ko=this.collisionCircleArrays[Ca]=new Zl);for(let bo=0;bo<cs.circles.length;bo+=4)Ko.circles.push(cs.circles[bo+0]),Ko.circles.push(cs.circles[bo+1]),Ko.circles.push(cs.circles[bo+2]),Ko.circles.push(cs.collisionDetected?1:0)}const Ta=R.projection.name!=="globe";li=li&&(Ta||!Bo),dr=dr&&(Ta||!Da),this.placements[pn]=new Qa(Vn||li,Zn||dr,ys||R.justReloaded),h.add(pn)},Nr=this.retainedQueryData[R.bucketInstanceId].tileID;if(R.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(R,Nr),R.elevationType==="road"&&R.updateRoadElevation(Nr.canonical),R.updateZOffset(),R.sortFeaturesByY){const ar=R.getSortedSymbolIndexes(this.transform.angle);for(let Br=ar.length-1;Br>=0;--Br){const dn=ar[Br];vr(R.symbolInstances.get(dn),dn,R.collisionArrays[dn])}R.hasAnyZOffset&&i.w(`${R.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(R.hasAnyZOffset){const ar=R.getSortedIndexesByZOffset();for(let Br=0;Br<ar.length;++Br){const dn=ar[Br];vr(R.symbolInstances.get(dn),dn,R.collisionArrays[dn])}}else for(let ar=o.symbolInstanceStart;ar<o.symbolInstanceEnd;ar++)vr(R.symbolInstances.get(ar),ar,R.collisionArrays[ar]);if(y&&R.bucketInstanceId in this.collisionCircleArrays){const ar=this.collisionCircleArrays[R.bucketInstanceId];i.bi(ar.invProjMatrix,se),ar.viewportMatrix=this.collisionIndex.getViewportMatrix()}R.justReloaded=!1}markUsedJustification(o,h,y,C){const{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:$,verticalPlacedTextSymbolIndex:Z,crossTileID:se}=y,ue=i.bV(h),be=C===i.bI.vertical?Z:ue==="left"?A:ue==="center"?R:ue==="right"?$:-1;A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=be>=0&&A!==be?0:se),R>=0&&(o.text.placedSymbolArray.get(R).crossTileID=be>=0&&R!==be?0:se),$>=0&&(o.text.placedSymbolArray.get($).crossTileID=be>=0&&$!==be?0:se),Z>=0&&(o.text.placedSymbolArray.get(Z).crossTileID=be>=0&&Z!==be?0:se)}markUsedOrientation(o,h,y){const C=h===i.bI.horizontal||h===i.bI.horizontalOnly?h:0,A=h===i.bI.vertical?h:0,{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:$,rightJustifiedTextSymbolIndex:Z,verticalPlacedTextSymbolIndex:se}=y,ue=o.text.placedSymbolArray;R>=0&&(ue.get(R).placedOrientation=C),$>=0&&(ue.get($).placedOrientation=C),Z>=0&&(ue.get(Z).placedOrientation=C),se>=0&&(ue.get(se).placedOrientation=A)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const C=h?h.symbolFadeChange(o):1,A=h?h.opacities:{},R=h?h.variableOffsets:{},$=h?h.placedOrientations:{};for(const Z in this.placements){const se=this.placements[Z],ue=A[Z];ue?(this.opacities[Z]=new wl(ue,C,se.text,se.icon,null,se.clipped),y=y||se.text!==ue.text.placed||se.icon!==ue.icon.placed):(this.opacities[Z]=new wl(null,C,se.text,se.icon,se.skipFade,se.clipped),y=y||se.text||se.icon)}for(const Z in A){const se=A[Z];if(!this.opacities[Z]){const ue=new wl(se,C,!1,!1);ue.isHidden()||(this.opacities[Z]=ue,y=y||se.text.placed||se.icon.placed)}}for(const Z in R)this.variableOffsets[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.variableOffsets[Z]=R[Z]);for(const Z in $)this.placedOrientations[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.placedOrientations[Z]=$[Z]);y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h,y,C){const A=new Set;for(const R of h){const $=R.getBucket(o);$&&R.latestFeatureIndex&&o.fqid===$.layerIds[0]&&(this.updateBucketOpacities($,A,R,R.collisionBoxArray,y,C,R.tileID,o.scope),$.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset($,R.tileID),$.elevationType==="road"&&$.updateRoadElevation(R.tileID.canonical),$.updateZOffset())}}updateBucketOpacities(o,h,y,C,A,R,$,Z){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const se=o.layers[0].layout,ue=o.layers[0].paint,be=!!o.layers[0].dynamicFilter(),ge=new wl(null,0,!1,!1,!0),Ce=se.get("text-allow-overlap"),$e=se.get("icon-allow-overlap"),Ne=se.get("text-variable-anchor"),We=se.get("text-rotation-alignment")==="map",Xe=se.get("text-pitch-alignment")==="map",et=ue.get("symbol-z-offset"),_t=se.get("symbol-elevation-reference")==="sea",Ct=!et.isConstant(),jt=new wl(null,0,Ce&&($e||!o.hasIconData()||se.get("icon-optional")),$e&&(Ce||!o.hasTextData()||se.get("text-optional")),!0);!o.collisionArrays&&C&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(C);const Ft=(Et,Wt,qt)=>{for(let Ei=0;Ei<Wt/4;Ei++)Et.opacityVertexArray.emplaceBack(qt)};let Rt=0;R&&o.updateReplacement($,R);for(let Et=0;Et<o.symbolInstances.length;Et++){const Wt=o.symbolInstances.get(Et),{numHorizontalGlyphVertices:qt,numVerticalGlyphVertices:Ei,crossTileID:Mi,numIconVertices:Ki,tileAnchorX:Ji,tileAnchorY:Er}=Wt;let Ti=null;const $i=this.retainedQueryData[o.bucketInstanceId];Ct&&Wt&&$i&&(Ti=y.latestFeatureIndex.loadFeature({featureIndex:Wt.featureIndex,bucketIndex:$i.bucketIndex,sourceLayerIndex:$i.sourceLayerIndex,layoutVertexArrayOffset:0}));const li=et.evaluate(Ti,{}),dr=h.has(Mi);let Ni=this.opacities[Mi];dr?Ni=ge:Ni||(Ni=jt,this.opacities[Mi]=Ni),h.add(Mi);const vr=qt>0||Ei>0,Nr=Ki>0,ar=this.placedOrientations[Mi],Br=ar===i.bI.vertical,dn=ar===i.bI.horizontal||ar===i.bI.horizontalOnly;!vr&&!Nr||Ni.isHidden()||Rt++;let pn=!1;if((vr||Nr)&&R)for(const on of o.activeReplacements){if(i.bP(on,A,i.bQ.Symbol,Z)||on.min.x>Ji||Ji>on.max.x||on.min.y>Er||Er>on.max.y)continue;const bn=i.bR(Ji,Er,$.canonical,on.footprintTileId.canonical);if(pn=i.bS(bn,on.footprint),pn)break}if(vr){const on=pn?Ch:zh(Ni.text);Ft(o.text,qt,Br?Ch:on),Ft(o.text,Ei,dn?Ch:on);const bn=Ni.text.isHidden(),{leftJustifiedTextSymbolIndex:An,centerJustifiedTextSymbolIndex:Vn,rightJustifiedTextSymbolIndex:Zn,verticalPlacedTextSymbolIndex:ys}=Wt,Bo=o.text.placedSymbolArray,Da=bn||Br?1:0;An>=0&&(Bo.get(An).hidden=Da),Vn>=0&&(Bo.get(Vn).hidden=Da),Zn>=0&&(Bo.get(Zn).hidden=Da),ys>=0&&(Bo.get(ys).hidden=bn||dn?1:0);const xo=this.variableOffsets[Mi];xo&&this.markUsedJustification(o,xo.anchor,Wt,ar);const ia=this.placedOrientations[Mi];ia&&(this.markUsedJustification(o,"left",Wt,ia),this.markUsedOrientation(o,ia,Wt))}if(Nr){const on=pn?Ch:zh(Ni.icon),{placedIconSymbolIndex:bn,verticalPlacedIconSymbolIndex:An}=Wt,Vn=o.icon.placedSymbolArray,Zn=Ni.icon.isHidden()?1:0;bn>=0&&(Ft(o.icon,Ki,Br?Ch:on),Vn.get(bn).hidden=Zn),An>=0&&(Ft(o.icon,Wt.numVerticalIconVertices,dn?Ch:on),Vn.get(An).hidden=Zn)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const on=o.collisionArrays[Et];if(on){let bn=new i.P(0,0),An=!0;if(on.textBox||on.verticalTextBox){if(Ne){const Zn=this.variableOffsets[Mi];Zn?(bn=os(Zn.anchor,Zn.width,Zn.height,Zn.textOffset,Zn.textScale),We&&bn._rotate(Xe?this.transform.angle:-this.transform.angle)):An=!1}be&&(An=!Ni.clipped),on.textBox&&bu(o.textCollisionBox.collisionVertexArray,Ni.text.placed,!An||Br,li,_t,bn.x,bn.y),on.verticalTextBox&&bu(o.textCollisionBox.collisionVertexArray,Ni.text.placed,!An||dn,li,_t,bn.x,bn.y)}const Vn=An&&!!(!dn&&on.verticalIconBox);on.iconBox&&bu(o.iconCollisionBox.collisionVertexArray,Ni.icon.placed,Vn,li,_t,Wt.hasIconTextFit?bn.x:0,Wt.hasIconTextFit?bn.y:0),on.verticalIconBox&&bu(o.iconCollisionBox.collisionVertexArray,Ni.icon.placed,!Vn,li,_t,Wt.hasIconTextFit?bn.x:0,Wt.hasIconTextFit?bn.y:0)}}}if(o.fullyClipped=Rt===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Et=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Et.invProjMatrix,o.placementViewportMatrix=Et.viewportMatrix,o.collisionCircleArray=Et.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function bu(g,o,h,y,C,A,R){g.emplaceBack(o?1:0,h?1:0,A||0,R||0,y,C?1:0),g.emplaceBack(o?1:0,h?1:0,A||0,R||0,y,C?1:0),g.emplaceBack(o?1:0,h?1:0,A||0,R||0,y,C?1:0),g.emplaceBack(o?1:0,h?1:0,A||0,R||0,y,C?1:0)}const Ks=Math.pow(2,25),xd=Math.pow(2,24),ju=Math.pow(2,17),Hu=Math.pow(2,16),Sl=Math.pow(2,9),Ja=Math.pow(2,8),Gu=Math.pow(2,1);function zh(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Ks+o*xd+h*ju+o*Hu+h*Sl+o*Ja+h*Gu+o}const Ch=0;class hh{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,h,y,C,A,R){const $=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts($,C,o[this._currentTileIndex],this._sortAcrossTiles,R),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,$.sort((Z,se)=>Z.sortKey-se.sortKey));this._currentPartIndex<$.length;){const Z=$[this._currentPartIndex];if(h.placeLayerBucketPart(Z,this._seenCrossTileIDs,y,Z.symbolInstanceStart===0,R),this._currentPartIndex++,A())return!0}return!1}}class vt{constructor(o,h,y,C,A,R,$,Z,se){this.placement=new zl(o,A,R,$,Z,se),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(o,h,y,C,A){const R=i.q.now(),$=()=>{const Z=i.q.now()-R;return!this._forceFullPlacement&&Z>2};for(;this._currentPlacementIndex>=0;){const Z=h[o[this._currentPlacementIndex]],se=this.placement.collisionIndex.transform.zoom;if(Z.type==="symbol"&&(!Z.minzoom||Z.minzoom<=se)&&(!Z.maxzoom||Z.maxzoom>se)){const ue=Z,be=ue.layout.get("symbol-z-elevate"),ge=ue.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ce=ue.layout.get("symbol-z-order"),$e=Ce==="viewport-y"||Ce==="auto"&&!(Ce!=="viewport-y"&&ge),Ne=ue.layout.get("text-allow-overlap")||ue.layout.get("icon-allow-overlap")||ue.layout.get("text-ignore-placement")||ue.layout.get("icon-ignore-placement"),We=$e&&Ne,Xe=this._inProgressLayer=this._inProgressLayer||new hh(ue),et=i.C(Z.source,Z.scope);if(Xe.continuePlacement(be||We?C[et]:y[et],this.placement,this._showCollisionBoxes,Z,$,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Yt=512/i.aj/2;class Di{constructor(o,h,y){this.tileID=o,this.bucketInstanceId=y,this.index=new i.bW(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const C=o.canonical.x*i.aj,A=o.canonical.y*i.aj;for(let R=0;R<h.length;R++){const{key:$,crossTileID:Z,tileAnchorX:se,tileAnchorY:ue}=h.get(R),be=Math.floor((C+se)*Yt),ge=Math.floor((A+ue)*Yt);this.index.add(be,ge),this.keys.push($),this.crossTileIDs.push(Z)}this.index.finish()}findMatches(o,h,y){const C=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),A=Yt/Math.pow(2,h.canonical.z-this.tileID.canonical.z),R=h.canonical.x*i.aj,$=h.canonical.y*i.aj;for(let Z=0;Z<o.length;Z++){const se=o.get(Z);if(se.crossTileID)continue;const{key:ue,tileAnchorX:be,tileAnchorY:ge}=se,Ce=Math.floor((R+be)*A),$e=Math.floor(($+ge)*A),Ne=this.index.range(Ce-C,$e-C,Ce+C,$e+C).sort((We,Xe)=>We-Xe);for(const We of Ne){const Xe=this.crossTileIDs[We];if(this.keys[We]===ue&&!y.has(Xe)){y.add(Xe),se.crossTileID=Xe;break}}}}}class yi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const y in this.indexes){const C=this.indexes[y],A={};for(const R in C){const $=C[R];$.tileID=$.tileID.unwrapTo($.tileID.wrap+h),A[$.tileID.key]=$}this.indexes[y]=A}this.lng=o}addBucket(o,h,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const C=this.usedCrossTileIDs[o.overscaledZ];for(const A in this.indexes){const R=this.indexes[A];if(Number(A)>o.overscaledZ)for(const $ in R){const Z=R[$];Z.tileID.isChildOf(o)&&Z.findMatches(h.symbolInstances,o,C)}else{const $=R[o.scaledTo(Number(A)).key];$&&$.findMatches(h.symbolInstances,o,C)}}for(let A=0;A<h.symbolInstances.length;A++){const R=h.symbolInstances.get(A);R.crossTileID||(R.crossTileID=y.generate(),C.add(R.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Di(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[o].delete(y)}removeStaleBuckets(o){let h=!1;for(const y in this.indexes){const C=this.indexes[y];for(const A in C)o[C[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,C[A]),delete C[A],h=!0)}return h}}class Li{constructor(){this.layerIndexes={},this.crossTileIDs=new yi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,y,C){let A=this.layerIndexes[o.fqid];A===void 0&&(A=this.layerIndexes[o.fqid]=new bi);let R=!1;const $={};C.name!=="globe"&&A.handleWrapJump(y);for(const Z of h){const se=Z.getBucket(o);se&&o.fqid===se.layerIds[0]&&(se.bucketInstanceId||(se.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(Z.tileID,se,this.crossTileIDs)&&(R=!0),$[se.bucketInstanceId]=!0)}return A.removeStaleBuckets($)&&(R=!0),R}pruneUnusedLayers(o){const h={};o.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const Tr=771;class Bi{constructor(o,h,y,C){this.blendFunction=o,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=y,this.blendEquation=C}}Bi.Replace=[1,0,1,0],Bi.disabled=new Bi(Bi.Replace,i.am.transparent,[!1,!1,!1,!1]),Bi.unblended=new Bi(Bi.Replace,i.am.transparent,[!0,!0,!0,!0]),Bi.alphaBlended=new Bi([1,Tr,1,Tr],i.am.transparent,[!0,!0,!0,!0]),Bi.alphaBlendedNonPremultiplied=new Bi([770,Tr,770,Tr],i.am.transparent,[!0,!0,!0,!0]),Bi.multiply=new Bi([774,0,774,0],i.am.transparent,[!0,!0,!0,!0]);class Gt{constructor(o,h,y){this.func=o,this.mask=h,this.range=y}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const qr=7680;class sr{constructor(o,h,y,C,A,R){this.test=o,this.ref=h,this.mask=y,this.fail=C,this.depthFail=A,this.pass=R}}sr.disabled=new sr({func:519,mask:0},0,0,qr,qr,qr);const Qi=1029,sn=2305;class hi{constructor(o,h,y){this.enable=o,this.mode=h,this.frontFace=y}}function Pn(g,o){const h=i.c1(g,3);i.c3(g,o),i.c7(g,3,h)}function as(g,o){const h=i.b_([]);return i.b$(h,h,-o),i.c0(h,h,-g),h}function Yo(g,o){const h=[g[0],g[1],0],y=[o[0],o[1],0];if(i.ae(h)>=1e-15){const R=i.au([],h);i.bY(y,R,i.bG(y,R)),o[0]=y[0],o[1]=y[1]}const C=i.bF([],o,g);if(i.bZ(C)<1e-15)return null;const A=Math.atan2(-C[1],C[0]);return as(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),A)}hi.disabled=new hi(!1,Qi,sn),hi.backCCW=new hi(!0,Qi,sn),hi.backCW=new hi(!0,Qi,2304),hi.frontCW=new hi(!0,1028,2304),hi.frontCCW=new hi(!0,1028,sn);class Qn{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){const h=o instanceof i.ac?o:new i.ac(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=i.bX(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const y=this.position,C=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(o)):0,A=i.ac.fromLngLat(o,C),R=[A.x-y.x,A.y-y.y,A.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Yo(R,h)}setPitchBearing(o,h){this.orientation=as(i.al(o),i.al(-h))}}class ro{constructor(o,h){this._transform=i.bx([]),this.orientation=h,this.position=o}get mercatorPosition(){const o=this.position;return new i.ac(o[0],o[1],o[2])}get position(){const o=i.c1(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&i.c7(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.b_([]),o&&Pn(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=as(o,h),Pn(this._transform,this._orientation)}forward(){const o=i.c1(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.c1(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.c1(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const y=new Float64Array(16);return i.bi(y,this.getWorldToCamera(o,h)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,h,y){const C=this.position;i.bY(C,C,-o);const A=new Float64Array(16);return i.bn(A,[y,y,y]),i.bo(A,A,C),A[10]*=h,A}getWorldToCamera(o,h){const y=new Float64Array(16),C=new Float64Array(4),A=this.position;return i.c2(C,this._orientation),i.bY(A,A,-o),i.c3(y,C),i.bo(y,y,A),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(o,h,y,C){const A=new Float64Array(16);return i.c4(A,o,h,y,C),A}getCameraToClipOrthographic(o,h,y,C,A,R){const $=new Float64Array(16);return i.c5($,o,h,y,C,A,R),$}getDistanceToElevation(o,h=!1){const y=o===0?0:i.c6(o,h?i.aY(this.position[1]):this.position[1]),C=this.forward();return(y-this.position[2])/C[2]}clone(){return new ro([...this.position],[...this.orientation])}}const Ao={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class el{constructor(o=0,h=0,y=0,C=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=y,this.right=C}interpolate(o,h,y){return h.top!=null&&o.top!=null&&(this.top=i.ai(o.top,h.top,y)),h.bottom!=null&&o.bottom!=null&&(this.bottom=i.ai(o.bottom,h.bottom,y)),h.left!=null&&o.left!=null&&(this.left=i.ai(o.left,h.left,y)),h.right!=null&&o.right!=null&&(this.right=i.ai(o.right,h.right,y)),this}getCenter(o,h){const y=i.ay((this.left+o-this.right)/2,0,o),C=i.ay((this.top+h-this.bottom)/2,0,h);return new i.P(y,C)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new el(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Mo=15;class Fs{constructor(o,h,y,C,A,R,$){this.tileSize=512,this._renderWorldCopies=A===void 0||A,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=C??60,this.setProjection(R),this.setMaxBounds($),this.width=0,this.height=0,this._center=new i.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new el,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ro,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Fs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Mo}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(o||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.aF(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=i.ce(this.projectionOptions);const y=this.getProjection(),C=!i.bv(h,y);return C&&this._calcMatrices(),this.mercatorFromTransition=!1,C}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.ce({name:"mercator"});const h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bX(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const h=-o*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.cf(),i.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=i.ay(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.al(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let C=0,A=0;for(let R=0;R<h.length;R++){const $=new i.P(h[R][0]*this.width,y+h[R][1]*(this.height-y)),Z=o.pointCoordinate($);if(!Z)continue;const se=1/Math.hypot(Z[0]-this._camera.position[0],Z[1]-this._camera.position[1]);C+=Z[3]*se,A+=se}return A===0?NaN:C/A}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,C=this._mercatorZfromZoom(o),A=this._mercatorZfromZoom(this._maxZoom),R=Math.max(C-y,A);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let y;y=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const C=i.ae(i.at([],this._camera.position,y));return i.ay(this._zoomFromMercatorZ(C),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!i.ch(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const y=[o.position.x,o.position.y,o.position.z];i.ci(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new Qn;return h.position=new i.ac(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!i.cj(o))return!1;i.ck(o,o);const h=i.cl([],[0,0,-1],o),y=i.cl([],[0,-1,0],o);if(y[2]<0)return!1;const C=Yo(h,y);return!!C&&(this._camera.orientation=C,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,C=this.cameraToCenterDistance;o[2]=i.ay(o[2],C/y,C/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,y){this._unmodified=!1,this._edgeInsets.interpolate(o,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new i.cm(0,o)];if(this.renderWorldCopies){const y=this.pointCoordinate(new i.P(0,0)),C=this.pointCoordinate(new i.P(this.width,0)),A=this.pointCoordinate(new i.P(this.width,this.height)),R=this.pointCoordinate(new i.P(0,this.height)),$=Math.floor(Math.min(y.x,C.x,A.x,R.x)),Z=Math.floor(Math.max(y.x,C.x,A.x,R.x)),se=1;for(let ue=$-se;ue<=Z+se;ue++)ue!==0&&h.push(new i.cm(ue,o))}return h}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,h,y){let C=[];const A=y!=null,R=!A;if(R&&this.zoom<h||A&&y[0]===0&&y[1]===0)return C;const $=new Set,Z=(ue,be,ge,Ce,$e)=>{const Ne=i.cK(be,ue,ge,Ce,$e);$.has(Ne)||(C.push(new i.aM(ue,be,ge,Ce,$e)),$.add(Ne))};for(let ue=0;ue<o.length;ue++){const be=o[ue];if(R&&be.canonical.z!==h)continue;const ge=be.canonical,Ce=be.overscaledZ,$e=be.wrap,Ne=1<<ge.z,We=ge.x+1<Ne,Xe=ge.x>0,et=ge.y+1<Ne,_t=ge.y>0,Ct=be.wrap-(Xe?0:1),jt=be.wrap+(We?0:1),Ft=Xe?ge.x-1:Ne-1,Rt=We?ge.x+1:0;if(A)y[0]<0?(Z(Ce,jt,ge.z,Rt,ge.y),y[1]<0&&et&&(Z(Ce,$e,ge.z,ge.x,ge.y+1),Z(Ce,jt,ge.z,Rt,ge.y+1)),y[1]>0&&_t&&(Z(Ce,$e,ge.z,ge.x,ge.y-1),Z(Ce,jt,ge.z,Rt,ge.y-1))):y[0]>0?(Z(Ce,Ct,ge.z,Ft,ge.y),y[1]<0&&et&&(Z(Ce,$e,ge.z,ge.x,ge.y+1),Z(Ce,Ct,ge.z,Ft,ge.y+1)),y[1]>0&&_t&&(Z(Ce,$e,ge.z,ge.x,ge.y-1),Z(Ce,Ct,ge.z,Ft,ge.y-1))):y[1]<0&&et?Z(Ce,$e,ge.z,ge.x,ge.y+1):_t&&Z(Ce,$e,ge.z,ge.x,ge.y-1);else{const Et=be.visibleQuadrants;1&Et&&(Z(Ce,Ct,ge.z,Ft,ge.y),_t&&(Z(Ce,$e,ge.z,ge.x,ge.y-1),Z(Ce,Ct,ge.z,Ft,ge.y-1))),2&Et&&(Z(Ce,jt,ge.z,Rt,ge.y),_t&&(Z(Ce,$e,ge.z,ge.x,ge.y-1),Z(Ce,jt,ge.z,Rt,ge.y-1))),4&Et&&(Z(Ce,Ct,ge.z,Ft,ge.y),et&&(Z(Ce,$e,ge.z,ge.x,ge.y+1),Z(Ce,Ct,ge.z,Ft,ge.y+1))),8&Et&&(Z(Ce,jt,ge.z,Rt,ge.y),et&&(Z(Ce,$e,ge.z,ge.x,ge.y+1),Z(Ce,jt,ge.z,Rt,ge.y+1)))}}const se=[];for(const ue of C)C.some(be=>ue.isChildOf(be))||se.push(ue);if(C=se.filter(ue=>!o.some(be=>!!(ue.overscaledZ<h&&be.isChildOf(ue))||ue.equals(be)||ue.isChildOf(be))),R){const ue=1<<h,be=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ge=[ue*be.x,ue*be.y],Ce=4,$e=Ce*Ce;C=C.filter(Ne=>{const We=Ne.canonical.x+.5-ge[0],Xe=Ne.canonical.y+.5-ge[1];return We*We+Xe*Xe<$e})}return C}coveringTiles(o){let h=this.coveringZoomLevel(o);const y=h,C=this.elevation&&this.elevation.exaggeration(),A=C&&!o.isTerrainDEM,R=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);const $=this.locationCoordinate(this.center),Z=this.center.lat,se=1<<h,ue=[se*$.x,se*$.y,0],be=this.projection.name==="globe",ge=!be,Ce=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,ge),$e=be?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ne=se*i.c6(1,this.center.lat),We=this._camera.position[2]/i.c6(1,this.center.lat),Xe=[se*$e.x,se*$e.y,We*(ge?1:Ne)],et=be||C,_t=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Ct=this.isLODDisabled(!0)?h:0;let jt;if(this._elevation&&o.isTerrainDEM)jt=1e4*this._elevation.exaggeration();else if(this._elevation){const li=this._elevation.getMinMaxForVisibleTiles();jt=li?li.max:this._centerAltitude}else jt=this._centerAltitude;const Ft=o.isTerrainDEM?-jt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Rt=this.projection.isReprojectedInTileSpace?i.co(this):1,Et=li=>{const Ni=new i.ac(li.x+25e-6,li.y,li.z),vr=new i.ac(li.x,li.y+25e-6,li.z),Nr=li.toLngLat(),ar=Ni.toLngLat(),Br=vr.toLngLat(),dn=this.locationCoordinate(Nr),pn=this.locationCoordinate(ar),on=this.locationCoordinate(Br),bn=Math.hypot(pn.x-dn.x,pn.y-dn.y),An=Math.hypot(on.x-dn.x,on.y-dn.y);return Math.sqrt(bn*An)*Rt/25e-6},Wt=li=>{const dr=jt,Ni=Ft;return{aabb:i.cr(this,se,0,0,0,li,Ni,dr,this.projection),zoom:0,x:0,y:0,minZ:Ni,maxZ:dr,wrap:li,fullyVisible:!1}},qt=[];let Ei=[];const Mi=h,Ki=o.reparseOverscaled?y:h,Ji=(We-this._centerAltitude)*Ne,Er=li=>{if(!this._elevation||!li.tileID||!R)return;const dr=this._elevation.getMinMaxForTile(li.tileID),Ni=li.aabb;dr?(Ni.min[2]=dr.min,Ni.max[2]=dr.max,Ni.center[2]=(Ni.min[2]+Ni.max[2])/2):(li.shouldSplit=$i(li),li.shouldSplit||(Ni.min[2]=Ni.max[2]=Ni.center[2]=this._centerAltitude))},Ti=(li,dr)=>{if(.707*dr<li)return 1;const Ni=dr/li;return Ni/(1.4144271570014144+(Math.pow(1.1,Ni-1.4144271570014144+1)-1)/(1.1-1)-1)},$i=li=>{if(li.zoom<Ct)return!0;if(li.zoom===Mi)return!1;if(li.shouldSplit!=null)return li.shouldSplit;const dr=li.aabb.distanceX(Xe),Ni=li.aabb.distanceY(Xe);let vr=Ji,Nr=1;if(be){vr=li.aabb.distanceZ(Xe);const An=Math.pow(2,li.zoom),Vn=i.aY((li.y+1)/An),Zn=i.aY(li.y/An),ys=Math.min(Math.max(Z,Vn),Zn),Bo=i.cO(ys)/i.cO(Z);if(Nr=ys===Z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bo/this._mercatorScaleRatio),this.zoom<=i.cL&&li.zoom===Mi-1&&Bo>=.9)return!0}else if(A&&(vr=li.aabb.distanceZ(Xe)*Ne),this.projection.isReprojectedInTileSpace&&y<=5){const An=Math.pow(2,li.zoom),Vn=Et(new i.ac((li.x+.5)/An,(li.y+.5)/An));Nr=Vn>.85?1:Vn}if(!R){const An=Math.sqrt(dr*dr+Ni*Ni+vr*vr);let Vn=(1<<Mi-li.zoom)*_t*Nr;return Vn*=Ti(Math.max(vr,Ji),An),An<Vn}let ar=Number.MAX_VALUE,Br=0;const dn=li.aabb.getCorners(),pn=[];for(const An of dn){i.at(pn,An,Xe),be||(A?pn[2]*=Ne:pn[2]=Ji);const Vn=i.bG(pn,this._camera.forward());Vn<ar&&(ar=Vn,Br=Math.abs(pn[2]))}let on=(1<<Mi-li.zoom)*_t*Nr;if(on*=Ti(Math.max(Br,Ji),ar),ar<on)return!0;const bn=li.aabb.closestPoint(ue);return bn[0]===ue[0]&&bn[1]===ue[1]};if(this.renderWorldCopies)for(let li=1;li<=3;li++)qt.push(Wt(-li)),qt.push(Wt(li));for(qt.push(Wt(0));qt.length>0;){const li=qt.pop(),dr=li.x,Ni=li.y;let vr=li.fullyVisible;const Nr=()=>this.projection.name==="globe"&&(li.y===0||li.y===(1<<li.zoom)-1);if(!vr){let ar=et?li.aabb.intersects(Ce):li.aabb.intersectsFlat(Ce);if(ar===0&&Nr()){const Br=new i.cp(li.zoom,dr,Ni);ar=i.cq(this,se,Br,!0).intersects(Ce)}if(ar===0)continue;vr=ar===2}if(li.zoom!==Mi&&$i(li))for(let ar=0;ar<4;ar++){const Br=(dr<<1)+ar%2,dn=(Ni<<1)+(ar>>1),pn={aabb:R?li.aabb.quadrant(ar):i.cr(this,se,li.zoom+1,Br,dn,li.wrap,li.minZ,li.maxZ,this.projection),zoom:li.zoom+1,x:Br,y:dn,wrap:li.wrap,fullyVisible:vr,tileID:void 0,shouldSplit:void 0,minZ:li.minZ,maxZ:li.maxZ};A&&!be&&(pn.tileID=new i.aM(li.zoom+1===Mi?Ki:li.zoom+1,li.wrap,li.zoom+1,Br,dn),Er(pn)),qt.push(pn)}else{const ar=li.zoom===Mi?Ki:li.zoom;if(o.minzoom&&o.minzoom>ar)continue;let Br=0;if(!vr){let bn=et?li.aabb.intersectsPrecise(Ce):li.aabb.intersectsPreciseFlat(Ce);if(bn===0&&Nr()){const An=new i.cp(li.zoom,dr,Ni);bn=i.cq(this,se,An,!0).intersectsPrecise(Ce)}if(bn===0)continue;if(o.calculateQuadrantVisibility)if(Ce.containsPoint(li.aabb.center))Br=15;else for(let An=0;An<4;An++)li.aabb.quadrant(An).intersects(Ce)!==0&&(Br|=1<<An)}const dn=ue[0]-(.5+dr+(li.wrap<<li.zoom))*(1<<h-li.zoom),pn=ue[1]-.5-Ni,on=li.tileID?li.tileID:new i.aM(ar,li.wrap,li.zoom,dr,Ni);o.calculateQuadrantVisibility&&(on.visibleQuadrants=Br),Ei.push({tileID:on,distanceSq:dn*dn+pn*pn})}}if(this.fogCullDistSq){const li=this.fogCullDistSq,dr=this.horizonLineFromTop();Ei=Ei.filter(Ni=>{const vr=[0,0,0,1],Nr=[i.aj,i.aj,0,1],ar=this.calculateFogTileMatrix(Ni.tileID.toUnwrapped());i.aA(vr,vr,ar),i.aA(Nr,Nr,ar);const Br=i.cs([],vr,Nr),dn=i.ct([],vr,Nr),pn=i.cM(Br,dn);if(pn===0)return!0;let on=!1;const bn=this._elevation;if(bn&&pn>li&&dr!==0){const An=this.calculateProjMatrix(Ni.tileID.toUnwrapped());let Vn;o.isTerrainDEM||(Vn=bn.getMinMaxForTile(Ni.tileID)),Vn||(Vn={min:Ft,max:jt});const Zn=i.cu(this.rotation),ys=[Zn[0]*i.aj,Zn[1]*i.aj,Vn.max];i.ad(ys,ys,An),on=(1-ys[1])*this.height*.5<dr}return pn<li||on})}return Ei.sort((li,dr)=>li.distanceSq-dr.distanceSq).map(li=>li.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=i.ay(o.lat,-85.051129,i.cv),y=this.projection.project(o.lng,h);return new i.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,h){let y,C;const A=this.centerPoint;if(this.projection.name==="globe"){const $=this.worldSize;y=(h.x-A.x)/$,C=(h.y-A.y)/$}else{const $=this.pointCoordinate(h),Z=this.pointCoordinate(A);y=$.x-Z.x,C=$.y-Z.y}const R=this.locationCoordinate(o);this.setLocation(new i.ac(R.x-y,R.y-C))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,h){return this.projection.locationPoint(this,o,h)}locationPoint3D(o,h){return this.projection.locationPoint(this,o,h,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,h){return this.coordinateLocation(this.pointCoordinate3D(o,h))}locationCoordinate(o,h){const y=h?i.c6(h,o.lat):void 0,C=this.projection.project(o.lng,o.lat);return new i.ac(C.x,C.y,y)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){const y=h??this._centerAltitude,C=[o.x,o.y,0,1],A=[o.x,o.y,1,1];i.aA(C,C,this.pixelMatrixInverse),i.aA(A,A,this.pixelMatrixInverse);const R=A[3];i.cw(C,C,1/C[3]),i.cw(A,A,1/R);const $=C[2],Z=A[2];return{p0:C,p1:A,t:$===Z?0:(y-$)/(Z-$)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],y=[o.x,o.y,1,1];return i.aA(h,h,this.pixelMatrixInverse),i.aA(y,y,this.pixelMatrixInverse),i.cw(h,h,1/h[3]),i.cw(y,y,1/y[3]),h[2]=i.c6(h[2],this._center.lat)*this.worldSize,y[2]=i.c6(y[2],this._center.lat)*this.worldSize,i.cw(h,h,1/this.worldSize),i.cw(y,y,1/this.worldSize),new i.av([h[0],h[1],h[2]],i.au([],i.at([],y,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:y,t:C}=o,A=i.c6(h[2],this._center.lat),R=i.c6(y[2],this._center.lat);return new i.ac(i.ai(h[0],y[0],C)/this.worldSize,i.ai(h[1],y[1],C)/this.worldSize,i.ai(A,R,C))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o,h){if(!this.elevation)return this.pointCoordinate(o,h);let y=this.projection.pointCoordinate3D(this,o.x,o.y);if(y)return new i.ac(y[0],y[1],y[2]);let C=0,A=this.horizonLineFromTop();if(o.y>A)return this.pointCoordinate(o,h);const R=.02*A,$=o.clone();for(let Z=0;Z<10&&A-C>R;Z++){$.y=i.ai(C,A,.66);const se=this.projection.pointCoordinate3D(this,$.x,$.y);se?(A=$.y,y=se):C=$.y}return y?new i.ac(y[0],y[1],y[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cx)return!this.isPointAboveHorizon(o);const h=this.pointCoordinate(o);return h.y>=0&&h.y<=1}_coordinatePoint(o,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,C=[o.x*this.worldSize,o.y*this.worldSize,y+o.toAltitude(),1];return i.aA(C,C,this.pixelMatrix),C[3]>0?new i.P(C[0]/C[3],C[1]/C[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,A=this.pointLocation3D(new i.P(h,o)),R=this.pointLocation3D(new i.P(C,o)),$=this.pointLocation3D(new i.P(C,y)),Z=this.pointLocation3D(new i.P(h,y));let se=Math.min(A.lng,R.lng,$.lng,Z.lng),ue=Math.max(A.lng,R.lng,$.lng,Z.lng),be=Math.min(A.lat,R.lat,$.lat,Z.lat),ge=Math.max(A.lat,R.lat,$.lat,Z.lat);const Ce=Math.pow(2,-this.zoom)/16*270,$e=this.projection.name==="globe"?1:4,Ne=(We,Xe,et,_t,Ct)=>{const jt=(We+et)/2,Ft=(Xe+_t)/2,Rt=new i.P(jt,Ft),{lng:Et,lat:Wt}=this.pointLocation3D(Rt),qt=Math.max(0,se-Et,be-Wt,Et-ue,Wt-ge);se=Math.min(se,Et),ue=Math.max(ue,Et),be=Math.min(be,Wt),ge=Math.max(ge,Wt),(Ct<$e||qt>Ce)&&(Ne(We,Xe,jt,Ft,Ct+1),Ne(jt,Ft,et,_t,Ct+1))};if(Ne(h,o,C,o,1),Ne(C,o,C,y,1),Ne(C,y,h,y,1),Ne(h,y,h,o,1),this.projection.name==="globe"){const[We,Xe]=i.cy(this);We?(ge=90,ue=180,se=-180):Xe&&(be=-90,ue=180,se=-180)}return new i.aG(new i.cd(se,be),new i.cd(ue,ge))}_getBoundsRectangular(o,h){const{top:y,left:C}=this._edgeInsets,A=this.height-this._edgeInsets.bottom,R=this.width-this._edgeInsets.right,$=new i.P(C,y),Z=new i.P(R,y),se=new i.P(R,A),ue=new i.P(C,A);let be=this.pointCoordinate($,o),ge=this.pointCoordinate(Z,o);const Ce=this.pointCoordinate(se,h),$e=this.pointCoordinate(ue,h),Ne=(We,Xe)=>(Xe.y-We.y)/(Xe.x-We.x);return be.y>1&&ge.y>=0?be=new i.ac((1-$e.y)/Ne($e,be)+$e.x,1):be.y<0&&ge.y<=1&&(be=new i.ac(-$e.y/Ne($e,be)+$e.x,0)),ge.y>1&&be.y>=0?ge=new i.ac((1-Ce.y)/Ne(Ce,ge)+Ce.x,1):ge.y<0&&be.y<=1&&(ge=new i.ac(-Ce.y/Ne(Ce,ge)+Ce.x,0)),new i.aG().extend(this.coordinateLocation(be)).extend(this.coordinateLocation(ge)).extend(this.coordinateLocation($e)).extend(this.coordinateLocation(Ce))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=o.visibleDemTiles.reduce((y,C)=>{if(C.dem){const A=C.dem.tree;y.min=Math.min(y.min,A.minimums[0]),y.max=Math.max(y.max,A.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-85.051129,this.maxLat=i.cv,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aD(this.minLng)*this.tileSize,this.worldMaxX=i.aD(this.maxLng)*this.tileSize,this.worldMinY=i.aH(this.maxLat)*this.tileSize,this.worldMaxY=i.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){const h=o.key,y=this._distanceTileDataCache;if(y[h])return y[h];const C=o.canonical,A=1/this.height,R=this.cameraWorldSize,$=R/this.zoomScale(C.z),Z=(C.x+Math.pow(2,C.z)*o.wrap)*$,se=C.y*$,ue=this.point;ue.x*=R/this.worldSize,ue.y*=R/this.worldSize;const be=this.angle,ge=Math.sin(-be),Ce=-Math.cos(-be);return y[h]={bearing:[ge,Ce],center:[(ue.x-Z)*A,(ue.y-se)*A],scale:$/i.aj*A},y[h]}calculateFogTileMatrix(o){const h=o.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const C=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.az(C,this.worldToFogMatrix,C),y[h]=new Float32Array(C),y[h]}calculateProjMatrix(o,h=!1,y=!1){const C=o.key;let A;if(A=y?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,A[C])return A[C];const R=this.calculatePosMatrix(o,this.worldSize);let $;return $=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.az(R,$,R),A[C]=new Float32Array(R),A[C]}calculatePixelsToTileUnitsMatrix(o){const h=o.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const C=i.cz(o,this);return y[h]=C,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,h=i.bn([],[o,o,o]);return i.az(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const h=i.c6(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),C=this._camera.forward(),A=i.c6(1,this._center.lat);y[2]/=A,C[2]/=A,i.au(C,C);const R=o.raycast(y,C,o.exaggeration());if(R){const $=i.bE([],y,C,R),Z=new i.ac($[0],$[1],i.c6($[2],i.aY($[1]))),se=(Z.z+i.ae([Z.x-y[0],Z.y-y[1],Z.z-y[2]*A]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(se),this._centerAltitude=Z.toAltitude(),this._center=this.coordinateLocation(Z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const h=this._elevation,y=i.c6(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(y),A=h.getAtPointOrZero(new i.ac(...C)),R=this.pixelsPerMeter/this.worldSize*A,$=this._minimumHeightOverTerrain(),Z=C[2]-R;if(Z<=$)if(Z<0||o){const se=this.locationCoordinate(this._center,this._centerAltitude),ue=[C[0],C[1],se.z-C[2]],be=i.ae(ue);ue[2]-=($-Z)/this._pixelsPerMercatorPixel;const ge=i.ae(ue);if(ge===0)return;i.bY(ue,ue,be/ge*this._pixelsPerMercatorPixel),this._camera.position=[C[0],C[1],se.z*this._pixelsPerMercatorPixel-ue[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const ge=this.center;return ge.lat=i.ay(ge.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(ge.lng=i.ay(ge.lng,this.minLng,this.maxLng)),this.center=ge,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:C}=this.point;let A=0,R=y,$=C;const Z=this.width/2,se=this.height/2,ue=this.worldMinY*this.scale,be=this.worldMaxY*this.scale;if(C-se<ue&&($=ue+se),C+se>be&&($=be-se),be-ue<this.height&&(A=Math.max(A,this.height/(be-ue)),$=(be+ue)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ge=this.worldMinX*this.scale,Ce=this.worldMaxX*this.scale,$e=this.worldSize/2-(ge+Ce)/2;R=(y+$e+this.worldSize)%this.worldSize-$e,R-Z<ge&&(R=ge+Z),R+Z>Ce&&(R=Ce-Z),Ce-ge<this.width&&(A=Math.max(A,this.width/(Ce-ge)),R=(Ce+ge)/2)}R===y&&$===C||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(R,$))),A&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(A)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.c6(1,this.center.lat)/i.c6(1,i.cP));const C=i.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,C),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const A=this.projection.zAxisUnit==="meters"?y:1,R=this._camera.getWorldToCamera(this.worldSize,A);let $;const Z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(Z[8]=2*-o.x/this.width,Z[9]=2*o.y/this.height,this.isOrthographic){let Wt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),qt=Wt*this.aspect,Ei=-qt,Mi=-Wt;qt-=o.x,Ei-=o.x,Wt+=o.y,Mi+=o.y,$=this._camera.getCameraToClipOrthographic(Ei,qt,Mi,Wt,this._nearZ,this._farZ),((Ki,Ji,Er,Ti)=>{for(let $i=0;$i<16;$i++)Ki[$i]=i.ai(Ji[$i],Er[$i],Ti)})($,$,Z,i.cN(this.pitch>=Mo?1:this.pitch/Mo))}else $=Z;const se=i.cB([],Z,R);let ue=i.cB([],$,R);if(this.projection.isReprojectedInTileSpace){const Wt=this.locationCoordinate(this.center),qt=i.bx([]);i.bo(qt,qt,[Wt.x*this.worldSize,Wt.y*this.worldSize,0]),i.az(qt,qt,i.cC(this)),i.bo(qt,qt,[-Wt.x*this.worldSize,-Wt.y*this.worldSize,0]),i.az(ue,ue,qt),i.az(se,se,qt),this.inverseAdjustmentMatrix=i.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cE([],ue,[this.worldSize,this.worldSize,this.worldSize/A,1]),this.projMatrix=ue,this.invProjMatrix=i.bi(new Float64Array(16),this.projMatrix),h){const Wt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Wt[8]=2*-o.x/this.width,Wt[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cB([],Wt,R)}else this.expandedFarZProjMatrix=this.projMatrix;const be=i.bi([],$);this.frustumCorners=i.cF.fromInvProjectionMatrix(be,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const ge=new Float32Array(16);i.bx(ge),i.cE(ge,ge,[1,-1,1]),i.cG(ge,ge,this._pitch),i.by(ge,ge,this.angle);const Ce=i.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bw(Ce);const $e=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Ce[8]=2*-o.x/this.width,Ce[9]=2*(o.y+$e)/this.height,this.skyboxMatrix=i.az(ge,Ce,ge);const Ne=this.point,We=Ne.x,Xe=Ne.y,et=this.width%2/2,_t=this.height%2/2,Ct=Math.cos(this.angle),jt=Math.sin(this.angle),Ft=We-Math.round(We)+Ct*et+jt*_t,Rt=Xe-Math.round(Xe)+Ct*_t+jt*et,Et=new Float64Array(ue);if(i.bo(Et,Et,[Ft>.5?Ft-1:Ft,Rt>.5?Rt-1:Rt,0]),this.alignedProjMatrix=Et,ue=i.bz(),i.cE(ue,ue,[this.width/2,-this.height/2,1]),i.bo(ue,ue,[1,-1,0]),this.labelPlaneMatrix=ue,ue=i.bz(),i.cE(ue,ue,[1,-1,1]),i.bo(ue,ue,[-1,-1,0]),i.cE(ue,ue,[2/this.width,2/this.height,1]),this.glCoordMatrix=ue,this.pixelMatrix=i.az(new Float64Array(16),this.labelPlaneMatrix,se),this._calcFogMatrices(),this._distanceTileDataCache={},ue=i.bi(new Float64Array(16),this.pixelMatrix),!ue)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=ue,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cH(this);const Wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad(Wt,Wt,R),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ue;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,C=1/this.height/this._pixelsPerMercatorPixel,A=[o,o,h];i.bY(A,A,C),i.bY(y,y,-1),i.cI(y,y,A);const R=i.bz();i.bo(R,R,y),i.cE(R,R,A),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,C)}_computeCameraPosition(o){const h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),C=this.point,A=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[C.x/this.worldSize-y[0]*A,C.y/this.worldSize-y[1]*A,o/this.worldSize*this._centerAltitude-y[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],C=o[2];let A=1;this.projection.wrap&&(this.center=this.center.wrap()),C>0&&(A=Math.min((h-y)/C,1)),this._camera.position=i.bE([],this._camera.position,o,A),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:C}=this._camera.getPitchBearing(),A=i.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.al(this._maxPitch)),$=Math.max((o[2]-A)/Math.cos(y),R),Z=this._zoomFromMercatorZ($);i.bE(o,o,h,$),this._pitch=i.ay(y,i.al(this.minPitch),i.al(this.maxPitch)),this.angle=i.bX(C,-Math.PI,Math.PI),this._setZoom(i.ay(Z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let h=0,y=i.cx,C=0,A=1/0;for(;y-h>1e-6&&y>h;){const R=h+.5*(y-h),$=this.tileSize*Math.pow(2,R),Z=this.getCameraToCenterDistance(this.projection,R,$),se=this.scaleZoom(Z/(Math.max(0,o)*this.tileSize)),ue=Math.abs(R-se);ue<A&&(A=ue,C=R),R<se?h=R:y=R}return C}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){const y=Math.min(o.x,h.x),C=Math.max(o.x,h.x),A=Math.min(o.y,h.y),R=Math.max(o.y,h.y);if(A<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const $=[new i.P(y,A),new i.P(C,R),new i.P(y,R),new i.P(C,A)],Z=this.renderWorldCopies?-3:0,se=this.renderWorldCopies?4:1;for(const ue of $){const be=this.pointRayIntersection(ue);if(be.t<0)return!0;const ge=this.rayIntersectionCoordinate(be);if(ge.x<Z||ge.y<0||ge.x>se||ge.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,h){const y=i.ae(i.at([],this._camera.position,o)),C=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(C)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([h,y,C],A){const R=[h,y,C,1];i.aA(R,R,A);const $=R[3]=Math.max(R[3],1e-6);return R[0]/=$,R[1]/=$,R[2]/=$,R}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,h=this.zoom,y=this.worldSize){const C=i.cA(o,h,this.width,this.height,1024),A=o.pixelSpaceConversion(this.center.lat,y,C);let R=.5/Math.tan(.5*this._fov)*this.height*A;return this.isOrthographic&&(R=i.ai(1,R,i.cN(this.pitch>=Mo?1:this.pitch/Mo))),R}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.az(o,o,this.globeMatrix),o}getFrustum(o){return i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Jo=(g,o)=>{if(o>0&&g.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,y=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),C=h.isLODDisabled(!1)?i.af(60,45,h.pitch):i.af(30,15,h.pitch),A=h._farZ-h._nearZ,R=o*h.height,$=((1-(Z=C))*h.cameraToCenterDistance+Z*(h._farZ+R))*y;var Z;return{shouldRenderCutoff:C<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,($-h._nearZ)/A,($-R-h._nearZ)/A]}}},ea={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class So{constructor(o,h){this.aabb=o,this.lastCascade=h}}class Ua{add(o,h){const y=this.receivers[o.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],h.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],h.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],h.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],h.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],h.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],h.max[2])):this.receivers[o.key]=new So(h,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,h,y){const C=i.cW.fromPoints(o.points);let A=0;for(const R in this.receivers){const $=this.receivers[R];if(!$||!C.intersectsAabb($.aabb))continue;$.aabb.min=C.closestPoint($.aabb.min),$.aabb.max=C.closestPoint($.aabb.max);const Z=$.aabb.getCorners();for(let se=0;se<y.length;se++){let ue=!0;for(const be of Z){const ge=[be[0]*h,be[1]*h,be[2]];if(i.ad(ge,ge,y[se].matrix),ge[0]<-1||ge[0]>1||ge[1]<-1||ge[1]>1){ue=!1;break}}if($.lastCascade=se,A=Math.max(A,se),ue)break}}return A+1}}class Ul{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ua,this._depthMode=new Gt(o.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(ea,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(ea,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(ea,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,h){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const C=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||C<=0||(this._shadowLayerCount=y.style.order.reduce(($e,Ne)=>{const We=y.style._mergedLayers[Ne];return $e+(We.hasShadowPass()&&!We.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const A=y.context,R=ea.shadowMapResolution,$=ea.shadowMapResolution;if(this._cascades.length===0||ea.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $e=0;$e<ea.cascadeCount;++$e){const Ne=y._shadowMapDebug,We=A.gl,Xe=A.createFramebuffer(R,$,Ne,"texture"),et=new i.T(A,{width:R,height:$,data:null},We.DEPTH_COMPONENT16);if(Xe.depthAttachment.set(et.texture),Ne){const _t=new i.T(A,{width:R,height:$,data:null},We.RGBA8);Xe.colorAttachment.set(_t.texture)}this._cascades.push({framebuffer:Xe,texture:et,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cn,scale:0})}}this.shadowDirection=$a(h);let Z=0;if(o.elevation){const $e=o.elevation,Ne=[1e4,-1e4];$e.visibleDemTiles.filter(We=>We.dem).forEach(We=>{const Xe=We.dem.tree;Ne[0]=Math.min(Ne[0],Xe.minimums[0]),Ne[1]=Math.max(Ne[1],Xe.maximums[0])}),Ne[0]!==1e4&&(Z=(Ne[1]-Ne[0])*$e.exaggeration())}const se=1.5*o.cameraToCenterDistance,ue=3*se,be=new Float64Array(16);for(let $e=0;$e<this._cascades.length;++$e){const Ne=this._cascades[$e];let We=o.height/50,Xe=1;ea.cascadeCount===1?Xe=ue:$e===0?Xe=se:(We=se,Xe=ue);const[et,_t]=dl(o,this.shadowDirection,We,Xe,ea.shadowMapResolution,Z);Ne.scale=o.scale,Ne.matrix=et,Ne.boundingSphereRadius=_t,i.bi(be,Ne.matrix),Ne.frustum=i.cn.fromInvProjectionMatrix(be,1,0,!0),Ne.far=Xe}const ge=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ge].far,this._cascades[ge].far],this._uniformValues.u_shadow_intensity=C,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ea.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ea.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ao.ShadowMap0,this._uniformValues.u_shadowmap_1=Ao.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Ce=y.transform.elevation;for(const $e of this._groundShadowTiles){let Ne={min:0,max:0};if(Ce){const We=Ce.getMinMaxForTile($e);We&&(Ne=We)}this.addShadowReceiver($e.toUnwrapped(),Ne.min,Ne.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,h){if(!this.enabled)return;const y=this.painter,C=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),C.viewport.set([0,0,ea.shadowMapResolution,ea.shadowMapResolution]);for(let A=0;A<this._numCascadesToRender;++A){y.currentShadowCascade=A,C.bindFramebuffer.set(this._cascades[A].framebuffer.framebuffer),C.clear({color:i.am.white,depth:1});for(const R of o.order){const $=o._mergedLayers[R];if(!$.hasShadowPass()||$.isHidden(y.transform.zoom))continue;const Z=o.getLayerSourceCache($),se=Z?h[Z.id]:void 0;($.type==="model"||se&&se.length)&&y.renderLayer(y,Z,$,se)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,h=o.style,y=o.context,C=y.gl,A=h.directionalLight,R=h.ambientLight;if(!A||!R)return;const $=[],Z=Jo(o,o.longestCutoffRange);Z.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),$.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&$.push("NORMAL_OFFSET");const se=Vl(h,A,R),ue=new Gt(C.LEQUAL,Gt.ReadOnly,o.depthRangeFor3D),be=new sr({func:C.EQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.KEEP);for(const ge of this._groundShadowTiles){const Ce=ge.toUnwrapped(),$e=o.isTileAffectedByFog(ge),Ne=o.getOrCreateProgram("groundShadow",{defines:$,overrideFog:$e});this.setupShadows(Ce,Ne),o.uploadCommonUniforms(y,Ne,Ce,null,Z);const We={u_matrix:o.transform.calculateProjMatrix(Ce),u_ground_shadow_factor:se};Ne.draw(o,C.TRIANGLES,ue,be,Bi.multiply,hi.disabled,We,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Bi.unblended:Bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const h=this.painter.transform,y=h.calculatePosMatrix(o,h.worldSize);return i.az(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(o){return i.az(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,h,y,C=0){if(!this.enabled)return;const A=this.painter.transform,R=this.painter.context,$=R.gl,Z=this._uniformValues,se=new Float64Array(16),ue=A.calculatePosMatrix(o,A.worldSize);for(let be=0;be<this._cascades.length;be++)i.az(se,this._cascades[be].matrix,ue),Z[be===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(se),R.activeTexture.set($.TEXTURE0+Ao.ShadowMap0+be),this._cascades[be].texture.bindExtraParam($.LINEAR,$.LINEAR,$.CLAMP_TO_EDGE,$.CLAMP_TO_EDGE,$.GREATER);if(this.useNormalOffset=!!y,this.useNormalOffset){const be=i.cU(o.canonical),ge=2/A.tileSize*i.aj/ea.shadowMapResolution,Ce=ge*this._cascades[0].boundingSphereRadius,$e=ge*this._cascades[this._cascades.length-1].boundingSphereRadius,Ne=(y==="vector-tile"?1:3)/Math.pow(2,C-o.canonical.z-(1-A.zoom+Math.floor(A.zoom)));Z.u_shadow_normal_offset=[be,Ce*Ne,$e*Ne],Z.u_shadow_bias=[6e-5,.0012,.012]}else Z.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(R,Z)}setupShadowsFromMatrix(o,h,y=!1){if(!this.enabled)return;const C=this.painter.context,A=C.gl,R=this._uniformValues,$=new Float64Array(16);for(let Z=0;Z<ea.cascadeCount;Z++)i.az($,this._cascades[Z].matrix,o),R[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from($),C.activeTexture.set(A.TEXTURE0+Ao.ShadowMap0+Z),this._cascades[Z].texture.bindExtraParam(A.LINEAR,A.LINEAR,A.CLAMP_TO_EDGE,A.CLAMP_TO_EDGE,A.GREATER);if(this.useNormalOffset=y,y){const Z=ea.normalOffset;R.u_shadow_normal_offset=[1,Z,Z],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(C,R)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,h,y,C){if(C[2]>=0)return{};const A=function(Z,se,ue){const be=ue/(1<<Z.canonical.z);return new i.cW([Z.canonical.x*be+Z.wrap*ue,Z.canonical.y*be+Z.wrap*ue,0],[(Z.canonical.x+1)*be+Z.wrap*ue,(Z.canonical.y+1)*be+Z.wrap*ue,se])}(o,h,y).getCorners(),R=h/-C[2];C[0]<0?(i.cV(A[0],A[0],[C[0]*R,0,0]),i.cV(A[3],A[3],[C[0]*R,0,0])):C[0]>0&&(i.cV(A[1],A[1],[C[0]*R,0,0]),i.cV(A[2],A[2],[C[0]*R,0,0])),C[1]<0?(i.cV(A[0],A[0],[0,C[1]*R,0]),i.cV(A[1],A[1],[0,C[1]*R,0])):C[1]>0&&(i.cV(A[2],A[2],[0,C[1]*R,0]),i.cV(A[3],A[3],[0,C[1]*R,0]));const $={};return $.vertices=A,$.planes=[$l(A[1],A[0],A[4]),$l(A[2],A[1],A[5]),$l(A[3],A[2],A[6]),$l(A[0],A[3],A[7])],$}addShadowReceiver(o,h,y){this._receivers.add(o,i.cW.fromTileIdAndHeight(o,h,y))}getMaxCascadeForTile(o){const h=this._receivers.get(o);return h&&h.lastCascade?h.lastCascade:0}}function $l(g,o,h){const y=i.at([],h,o),C=i.at([],g,o),A=i.bF([],y,C),R=i.ae(A);return R===0?[0,0,1,0]:(i.bY(A,A,1/R),[A[0],A[1],A[2],-i.bG(A,o)])}function $a(g){const o=g.properties.get("direction"),h=i.cR(o.x,o.y,o.z);h[2]=i.ay(h[2],0,75);const y=i.cT([h[0],h[1],h[2]]);return i.cS(y.x,y.y,y.z)}function Vl(g,o,h){const y=o.properties.get("color-use-theme")==="none",C=o.properties.get("color"),A=o.properties.get("intensity"),R=o.properties.get("direction"),$=[R.x,R.y,R.z],Z=h.properties.get("color-use-theme")==="none",se=h.properties.get("color"),ue=h.properties.get("intensity"),be=Math.max(i.bG([0,0,1],$),0),ge=[0,0,0];i.bY(ge,se.toPremultipliedRenderColor(Z?null:g.getLut(o.scope)).toArray01Linear().slice(0,3),ue);const Ce=[0,0,0];return i.bY(Ce,C.toPremultipliedRenderColor(y?null:g.getLut(h.scope)).toArray01Linear().slice(0,3),be*A),i.cY([ge[0]>0?ge[0]/(ge[0]+Ce[0]):0,ge[1]>0?ge[1]/(ge[1]+Ce[1]):0,ge[2]>0?ge[2]/(ge[2]+Ce[2]):0])}function dl(g,o,h,y,C,A){const R=g.zoom,$=g.scale,Z=g.worldSize,se=1/Z,ue=g.aspect,be=Math.sqrt(1+ue*ue)*Math.tan(.5*g.fovX),ge=be*be,Ce=y-h,$e=y+h;let Ne,We;ge>Ce/$e?(Ne=y,We=y*be):(Ne=.5*$e*(1+ge),We=.5*Math.sqrt(Ce*Ce+2*(y*y+h*h)*ge+$e*$e*ge*ge));const Xe=g.projection.pixelsPerMeter(g.center.lat,Z),et=g._camera.getCameraToWorldMercator(),_t=[0,0,-Ne*se];i.ad(_t,_t,et);let Ct=We*se;const jt=g._edgeInsets;if(!(jt.left===0&&jt.top===0&&jt.right===0&&jt.bottom===0||jt.left===jt.right&&jt.top===jt.bottom)){const vr=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?Xe:1),Nr=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,y);Nr[8]=2*-g.centerOffset.x/g.width,Nr[9]=2*g.centerOffset.y/g.height;const ar=new Float64Array(16);i.cB(ar,Nr,vr);const Br=new Float64Array(16);i.bi(Br,ar);const dn=i.cn.fromInvProjectionMatrix(Br,Z,R,!0);for(const pn of dn.points){const on=((Ft=pn)[0]/=$,Ft[1]/=$,Ft[2]=i.c6(Ft[2],g._center.lat),Ft);Ct=Math.max(Ct,i.bZ(i.cX([],_t,on)))}}var Ft;Ct*=C/(C-1);const Rt=Math.acos(o[2]),Et=Math.atan2(-o[0],-o[1]),Wt=new ro;Wt.position=_t,Wt.setPitchBearing(Rt,Et);const qt=Wt.getWorldToCamera(Z,Xe),Ei=Ct*Z,Mi=Math.min(g._mercatorZfromZoom(17)*Z*-2,-2*Ei),Ki=Wt.getCameraToClipOrthographic(-Ei,Ei,-Ei,Ei,Mi,(Ei+A*Xe)/o[2]),Ji=new Float64Array(16);i.az(Ji,Ki,qt);const Er=i.cS(Math.floor(1e6*_t[0])/1e6*Z,Math.floor(1e6*_t[1])/1e6*Z,0),Ti=.5*C,$i=[0,0,0];i.ad($i,Er,Ji),i.bY($i,$i,Ti);const li=[Math.floor($i[0]),Math.floor($i[1]),Math.floor($i[2])],dr=[0,0,0];i.at(dr,$i,li),i.bY(dr,dr,-1/Ti);const Ni=new Float64Array(16);return i.bx(Ni),i.bo(Ni,Ni,dr),i.az(Ji,Ni,Ji),[Ji,Ei]}class uh extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,h){return i.aS(this.requestManager.transformRequest(h,i.R.Model).url).then(y=>{if(!y)return;const C=i.aT(y),A=new i.aU(o,void 0,void 0,C);return A.computeBoundsAndApplyParent(),A}).catch(y=>{if(y&&y.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${o} from ${h}: ${y.message}`)))})}load(o,h,y={forceReload:!1}){this.models[h]||(this.models[h]={});const C=Object.keys(o),A=[],R=[];for(const $ of C){const Z=o[$];this.hasURLBeenRequested(Z)&&!y.forceReload||(this.modelByURL[Z]={modelId:$,scope:h},A.push(this.loadModel($,Z)),R.push($)),this.models[h][$]||(this.models[h][$]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+R.length,Promise.allSettled(A).then($=>{for(let Z=0;Z<$.length;Z++){const{status:se}=$[Z];if(se==="rejected")continue;const{value:ue}=$[Z];this.models[h][R[Z]]||(this.models[h][R[Z]]={model:null,numReferences:1}),this.models[h][R[Z]].model=ue}this.numModelsLoading[h]-=R.length,this.fire(new i.A("data",{dataType:"style"}))}).catch($=>{this.fire(new i.z(new Error(`Could not load models: ${$.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,h,y={exactIdMatch:!1}){return!!(y.exactIdMatch?this.getModel(o,h):this.getModelByURL(this.modelUris[h][o]))}getModel(o,h){return this.models[h]||(this.models[h]={}),this.models[h][o]?this.models[h][o].model:void 0}getModelByURL(o){if(!o)return null;const h=this.modelByURL[o];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(o,h){return this.models[h]&&this.models[h][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,h,y){this.models[y]||(this.models[y]={}),this.modelUris[y]||(this.modelUris[y]={});const C=this.requestManager.normalizeModelURL(h);if((this.hasModel(o,y,{exactIdMatch:!0})||this.hasModelBeenAdded(o,y))&&this.modelUris[y][o]===C)this.models[y][o].numReferences++;else if(this.hasURLBeenRequested(C)){const{scope:A,modelId:R}=this.modelByURL[C];this.models[A][R].numReferences++}else this.modelUris[y][o]=C,this.load({[o]:this.modelUris[y][o]},y)}addModelURLs(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const y=this.modelUris[h];for(const C in o)y[C]=this.requestManager.normalizeModelURL(o[C])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const y={};for(const C of o)this.hasModel(C,h,{exactIdMatch:!0})||this.hasURLBeenRequested(C)?this.models[h][C].numReferences++:this.modelUris[h][C]&&!this.hasURLBeenRequested(C)?y[C]=this.modelUris[h][C]:!this.hasURLBeenRequested(C)&&i.cZ(C,!1)&&(this.modelUris[h][C]=this.requestManager.normalizeModelURL(C),y[C]=this.modelUris[h][C]);this.load(y,h)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,h,y=!1){if(this.models[h]&&this.models[h][o]&&(this.models[h][o].numReferences--,this.models[h][o].numReferences===0)){const C=this.modelUris[h][o];y||delete this.modelUris[h][o],delete this.modelByURL[C];const A=this.models[h][o].model;if(!A)return;delete this.models[h][o],A.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const h of Object.keys(this.models[o])){const y=this.models[o][h].model;delete this.models[o][h],y&&y.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,h){this.models[h]||(this.models[h]={});for(const y in this.models[h])this.models[h][y].model&&this.models[h][y].model.upload(o.context)}}const rc=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),Dc={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Pc(g){return g=g||{},Object.assign(g,Dc)}class Zc extends i.E{constructor(o){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},i.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=o,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=o.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=o.stylesheet.indoor.buildingFeaturesetId,this._scope=o.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:o=>(o.feature&&o.feature.properties.floorplan&&this.selectFloorplan(o.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const o=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone"))};if(this._map.transform.zoom<13)return void o();const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=this._map.transform.width,C=this._map.transform.height,A=y*(2/3),R=C*(2/3),$=.5*(y-A),Z=.5*(C-R),se=[new i.P($,Z),new i.P($+A,Z+R)],ue=this._map.queryRenderedFeatures(se,h);ue.length>0?this._selectedFloorplan&&ue[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=ue[0],this._floorplanSelected()):o()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const o=this._floorplanStates[this._indoorData.id].selectedBuilding,h=o?this._indoorData.buildings.find($=>$.id===o):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,y=this._floorplanStates[this._indoorData.id].selectedLevel,C=this._indoorData.levels.find($=>$.id===y),A=this._indoorData.levels.find($=>!(!h||!h.levels)&&Number($.levelOrder)===0&&h.levels.includes($.id)),R=C?C.id:A?A.id:void 0;this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:R})),h&&this._buildingSelected(h,!1),R&&this._levelSelected(R)}_buildingSelected(o,h){if(!o||!o.id)return void console.warn("IndoorManager: Building or building id is undefined");h&&o.extent&&this._map.fitBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=o?o.id:void 0;const y=this._indoorData.levels.filter(C=>o.levels.includes(C.id));this.fire(new i.A("buildingselected",{buildingId:o.id,levels:y}))}_levelSelected(o){const h=this._indoorData.levels.find(y=>y.id===o);h?(this._updateLevels(h,!0),this.fire(new i.A("levelselected",{levelId:h.id}))):console.warn(`IndoorManager: Level with ID ${o} not found in the current floorplan.`)}_updateLevels(o,h){if(!o||!o.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function y(se){const ue=se.indexOf("/floor/");if(ue===-1)return se;const be=ue+7,ge=se.indexOf("/",be);return ge===-1?se.slice(be):se.slice(be,ge)}this._floorplanStates[this._indoorData.id].selectedLevel=o.id;const C=[],A={},R={},$={},Z={};for(const se of this._indoorData.levels){if(C.push(se.id),A[se.id]=se.levelOrder>=0?3*Math.abs(se.levelOrder+1):3*Math.abs(se.levelOrder),R[se.id]=se.levelOrder>=0?3*se.levelOrder:0,this.mergeFloors){const ue=y(o.id),be=y(se.id);$[se.id]=be===ue?"true":"false"}else $[se.id]=se.id===o.id?"true":"false";Z[se.id]=se.levelOrder<o.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",$]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",Z]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",o.levelOrder<0)}selectFloorplan(o){const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],C=this._map.queryRenderedFeatures(y,h);if(C.length>0){for(const A of C)if(JSON.parse(A.properties["indoor-data"]).id===o){this._selectedFloorplan=A,this._floorplanSelected();break}}}selectBuilding(o){const h=this._indoorData.buildings.find(y=>y.id===o);this._buildingSelected(h,!0)}selectLevel(o){this._levelSelected(o)}}function or(g){if(!g.metadata||!g.metadata.content_area)return;const o=i.q.devicePixelRatio,{left:h,top:y,width:C,height:A}=g.metadata.content_area,R=h*o,$=y*o;return[R,$,R+C*o,$+A*o]}function Kr(g){if(g)return g.map(([o,h])=>[o*i.q.devicePixelRatio,h*i.q.devicePixelRatio])}class Ur{constructor(o,h,y){this.id=o,this.scope=h,this.sourceCache=y,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return o;const y=this.sourceCache.getSource();if(!(y instanceof ra))return o;const C=h.map(R=>this.sourceCache.getTile(R)),A=y.getImages(C,Array.from(this.pendingRequests));for(const[R,$]of A)o.set(i.I.from({name:R,iconsetId:this.id}),$),this.pendingRequests.delete(R);for(const R of this.pendingRequests)this.missingRequests.add(R);return this.pendingRequests.clear(),o}}const Kn=(g,o)=>ft(g,o&&o.filter(h=>h.identifier!=="source.canvas")),As=i.aF(Vs,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Xo=i.aF(Vs,["setCenter","setZoom","setBearing","setPitch"]),pl=new Set(["background","sky","slot","custom"]),Fn={version:8,layers:[],sources:{}},fs={duration:300,delay:0};class In extends i.E{constructor(o,h={}){super(),this.map=o,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=i.h({},fs),this._buildingIndex=new Il(this),this.crossTileSymbolIndex=new Li,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new pr,this.dispatcher=h.dispatcher?h.dispatcher:new i.D(i.c$(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new ni(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.d0(o._requestManager,h.localFontFamily?i.d1.all:h.localIdeographFontFamily?i.d1.ideographs:i.d1.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new uh(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.d2());const y=this;this._rtlTextPluginCallback=In.registerForPluginStateChange(C=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},(A,R)=>{if(i.d3(A),R&&R.every($=>$))for(const $ in y._sourceCaches){const Z=y._sourceCaches[$],se=Z.getSource().type;se!=="vector"&&se!=="geojson"||Z.reload()}})}),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const A=this.getOwnSource(C.sourceId);if(A&&A.vectorLayerIds)for(const R in this._layers){const $=this._layers[R];$.source===A.id&&this._validateLayer($)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.j(o))return o;const h=i.d4(o);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.d5(JSON.stringify(o))}`}_diffStyle(o,h,y){this.globalId=this._getGlobalId(o);const C=(A,R)=>{try{R(null,this.setState(A,y))}catch($){R($,!1)}};if(typeof o=="string"){const A=this.map._requestManager.normalizeStyleURL(o),R=this.map._requestManager.transformRequest(A,i.R.Style);i.n(R,($,Z)=>{$?this.fire(new i.z($)):Z&&C(Z,h)})}else typeof o=="object"&&C(o,h)}loadURL(o,h={}){this.fire(new i.A("dataloading",{dataType:"style"}));const y=typeof h.validate=="boolean"?h.validate:!i.j(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,h.accessToken),this.resolvedImports.add(o);const C=this.importsCache.get(o);if(C)return this._load(C,y);const A=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.n(A,(R,$)=>{if(this._request=null,R)this.fire(new i.z(R));else if($)return this.importsCache.set(o,$),this._load($,y)})}loadJSON(o,h={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.q.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Fn,!1)}_loadImports(o,h,y){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const C=[];for(const A of o){const R=this._createFragmentStyle(A),$=new Promise(ue=>{R.once("style.import.load",ue),R.once("error",ue)}).then(()=>this.mergeAll());if(C.push($),this.resolvedImports.has(A.url)){R.loadEmpty();continue}const Z=A.data||this.importsCache.get(A.url);Z?(R.loadJSON(Z,{validate:h}),this._isInternalStyle(Z)&&(R.globalId=null)):A.url?R.loadURL(A.url,{validate:h}):R.loadEmpty();const se={style:R,id:A.id,config:A.config};if(y){const ue=this.fragments.findIndex(({id:be})=>be===y);this.fragments=this.fragments.slice(0,ue).concat(se).concat(this.fragments.slice(ue))}else this.fragments.push(se)}return Promise.allSettled(C)}getImportGlobalIds(o=this,h=new Set){for(const y of o.fragments)y.style.globalId&&h.add(y.style.globalId),this.getImportGlobalIds(y.style,h);return[...h.values()]}_createFragmentStyle(o){const h=this.scope?i.C(o.id,this.scope):o.id;let y;const C=this._initialConfig&&this._initialConfig[h];(o.config||C)&&(y=i.h({},o.config,C));const A=new In(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return A.setEventedParent(this.map,{style:A}),A}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,h){const y=o.indoor?Pc(o.schema):o.schema;if(this._isInternalStyle(o)){const R=i.h({},Fn,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(R,h)}if(this.updateConfig(this._config,y),h&&Kn(this,Aa(o)))return;this._loaded=!0,this.stylesheet=i.d6(o);const C=()=>{for(const se in o.sources)this.addSource(se,o.sources[se],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const se in o.iconsets)this.addIconset(se,o.iconsets[se]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(o.glyphs);const R=Th(this.stylesheet.layers);if(this._order=R.map(se=>se.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const se=this.stylesheet.lights[0];this.light=new xi(se.properties,se.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new xi(this.stylesheet.light)),this._layers={};for(const se of R){const ue=i.db(se,this.scope,this._styleColorTheme.lut,this.options);ue.configDependencies.size!==0&&this._configDependentLayers.add(ue.fqid),ue.setEventedParent(this,{layer:{id:ue.id}}),this._layers[ue.id]=ue;const be=this.getOwnLayerSourceCache(ue),ge=!!this.directionalLight&&this.directionalLight.shadowsEnabled();be&&ue.canCastShadows()&&ge&&(be.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const $=this.stylesheet.terrain;$&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain($,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const Z=this.isRootStyle();o.imports?this._loadImports(o.imports,h).then(()=>{this._reloadImports(),this.fire(new i.A(Z?"style.load":"style.import.load"))}).catch(se=>{this.fire(new i.z(new Error("Failed to load imports",se))),this.fire(new i.A(Z?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(Z?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const A=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(A){const R=this._evaluateColorThemeData(A);this._loadColorTheme(R).then(()=>{C()}).catch($=>{i.w(`Couldn't load color theme from the stylesheet: ${$}`),C()})}else this._styleColorTheme.lut=null,C()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,h,y,C,A,R,$,Z,se,ue;const be={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(ge=>{if(ge.stylesheet){if(ge.light!=null&&(o=ge.light),ge.stylesheet.lights)for(const Ce of ge.stylesheet.lights)Ce.type==="ambient"&&ge.ambientLight!=null&&(h=ge.ambientLight),Ce.type==="directional"&&ge.directionalLight!=null&&(y=ge.directionalLight);C=this._prioritizeTerrain(C,ge.terrain,ge.stylesheet.terrain),ge.stylesheet.fog&&ge.fog!=null&&(A=ge.fog),ge.stylesheet.snow&&ge.snow!=null&&(R=ge.snow),ge.stylesheet.rain&&ge.rain!=null&&($=ge.rain),ge.stylesheet.camera!=null&&(ue=ge.stylesheet.camera),ge.stylesheet.projection!=null&&(Z=ge.stylesheet.projection),ge.stylesheet.transition!=null&&(se=ge.stylesheet.transition),be[ge.scope]=ge._styleColorTheme}}),this.light=o,this.ambientLight=h,this.directionalLight=y,this.fog=A,this.snow=R,this.rain=$,this._styleColorThemeForScope=be,C===null?delete this.terrain:this.terrain=C,this.camera=ue||{"camera-projection":"perspective"},this.projection=Z||{name:"mercator"},this.transition=i.h({},fs,se),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const h=y=>{for(const C of y.fragments)h(C.style);o(y)};h(this)}_prioritizeTerrain(o,h,y){const C=o&&o.drapeRenderMode===0;return y===null?h&&h.drapeRenderMode===0?h:C?o:null:h!=null&&(!o||C||h&&h.drapeRenderMode===1)?h:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{o=this._prioritizeTerrain(o,h.terrain,h.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(o=h.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},h={},y={};this.forEachFragmentStyle(C=>{for(const A in C._sourceCaches){const R=i.C(A,C.scope);o[R]=C._sourceCaches[A]}for(const A in C._otherSourceCaches){const R=i.C(A,C.scope);h[R]=C._otherSourceCaches[A]}for(const A in C._symbolSourceCaches){const R=i.C(A,C.scope);y[R]=C._symbolSourceCaches[A]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=y}mergeLayers(){const o={},h=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(A=>{for(const R of A._order){const $=A._layers[R];if($.type==="slot"){const Z=i.d7(R);if(o[Z])continue;o[Z]=[]}$.slot&&o[$.slot]?o[$.slot].push($):h.push($)}}),this._mergedOrder=[];const C=(A=[])=>{for(const R of A)if(R.type==="slot"){const $=i.d7(R.id);o[$]&&C(o[$]),this._mergedSlots.push($)}else{const $=i.C(R.id,R.scope);this._mergedOrder.push($),y[$]=R,R.is3D(!!this.terrain)&&(this._has3DLayers=!0),R.type==="circle"&&(this._hasCircleLayers=!0),R.type==="symbol"&&(this._hasSymbolLayers=!0),R.type==="clip"&&(this._clipLayerPresent=!0)}};C(h),this._mergedOrder.sort((A,R)=>{const $=y[A],Z=y[R];return $.hasInitialOcclusionOpacityProperties?Z.is3D(!!this.terrain)?1:0:$.is3D(!!this.terrain)&&Z.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=i.h({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(h,y,C,A){const R=i.h({},y);for(const Z of Object.keys(i.a5.colorTheme))R[Z]===void 0&&(R[Z]=i.a5.colorTheme[Z].default);const $=new i.a6(rc,h,new Map(C));return $.setTransitionOrValue(R,C),$.untransitioned().possiblyEvaluate(new i.aa(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,C)=>{const A="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let R=o;R.startsWith(A)||(R=A+R);const $=i.I.from("mapbox-reserved-lut"),Z=new Image;Z.src=R,Z.onerror=()=>{this._styleColorTheme.lutLoading=!1,C(new Error("Failed to load image data"))},Z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void y();this._styleColorTheme.lutLoading=!1;const{width:se,height:ue,data:be}=i.q.getImageData(Z);if(ue>32)return void C(new Error("The height of the image must be less than or equal to 32 pixels."));if(se!==ue*ue)return void C(new Error("The width of the image must be equal to the height squared."));this.getImage($)&&this.removeImage($),this.addImage($,{data:new i.r({width:se,height:ue},be),pixelRatio:1,sdf:!1,usvg:!1,version:0});const ge=this.imageManager.getImage($,this.scope);ge?(this._styleColorTheme.lut={image:ge.data,data:o},y()):C(new Error("Missing LUT image."))}})}getLut(o){const h=this._styleColorThemeForScope[o];return h?h.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(h,y,C){let A,R,$;const Z=i.q.devicePixelRatio>1?"@2x":"";let se=i.n(y.transformRequest(y.normalizeSpriteURL(h,Z,".json"),i.R.SpriteJSON),(ge,Ce)=>{se=null,$||($=ge,A=Ce,be())}),ue=i.o(y.transformRequest(y.normalizeSpriteURL(h,Z,".png"),i.R.SpriteImage),(ge,Ce)=>{ue=null,$||($=ge,R=Ce,be())});function be(){if($)C($);else if(A&&R){const ge=i.q.getImageData(R),Ce={};for(const $e in A){const{width:Ne,height:We,x:Xe,y:et,sdf:_t,pixelRatio:Ct,stretchX:jt,stretchY:Ft,content:Rt}=A[$e],Et=new i.r({width:Ne,height:We});i.r.copy(ge,Et,{x:Xe,y:et},{x:0,y:0},{width:Ne,height:We},null),Ce[$e]={data:Et,pixelRatio:Ct,sdf:_t,stretchX:jt,stretchY:Ft,content:Rt,usvg:!1}}C(null,Ce)}}return{cancel(){se&&(se.cancel(),se=null),ue&&(ue.cancel(),ue=null)}}}(o,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new i.z(h));else if(y){const C=new Map;for(const A in y)C.set(i.I.from(A),y[A]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(o,h){if(h.type==="sprite")return void this._loadSprite(h.url);const y=this.getOwnSourceCache(h.source);if(!y)return void this.fire(new i.z(new Error(`Source "${h.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const C=y.getSource();if(C.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${h.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));C.partial=!1;const A=new Ur(o,this.scope,y);this.imageManager.addImageProvider(A,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.j(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const h=this.map._spriteFormat==="auto";var y,C;this._spriteRequest=(C=(A,R)=>{if(this._spriteRequest=null,A)h?this._loadSprite(o):this.fire(new i.z(A));else if(R){const $=new Map;for(const Z in R)$.set(i.I.from(Z),R[Z]);this.addImages($)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.br((y=this.map._requestManager).transformRequest(y.normalizeIconsetURL(o),i.R.Iconset),(A,R)=>{if(A)return void C(A);const $={},Z=i.c_(new i.bq(R));for(const se of Z.icons){const ue={version:1,pixelRatio:i.q.devicePixelRatio,content:or(se),stretchX:se.metadata?Kr(se.metadata.stretch_x_areas):void 0,stretchY:se.metadata?Kr(se.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:se};$[se.name]=ue}C(null,$)}))}_validateLayer(o){const h=this.getOwnSource(o.source);if(!h)return;const y=o.sourceLayer;y&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(y)===-1)&&this.fire(new i.z(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,h)=>{const y=this.fragments[h];return y&&y.style&&(o.data=y.style.serialize()),o})}_serializeSources(){const o={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();o[y.id]||(o[y.id]=y.serialize())}return o}_serializeLayers(o){const h=[];for(const y of o){const C=this._layers[y];C&&C.type!=="custom"&&h.push(C.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const h=this.getOwnLayer(o);if(h)return h;this.fire(new i.z(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const h=this.getOwnSource(o);if(h)return h;this.fire(new i.z(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,h){const y=this.map.painter;if(y)for(let C=o.minzoom||0;C<(o.maxzoom||25.5);C++){const A=o.getProgramIds();if(A)for(const R of A){const $=o.getDefaultProgramParams(R,h.zoom,this._styleColorTheme.lut);$&&(y.style=this,this.fog&&(y._fogVisible=!0,$.overrideFog=!0,y.getOrCreateProgram(R,$)),y._fogVisible=!1,$.overrideFog=!1,y.getOrCreateProgram(R,$),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&($.overrideRtt=!0,y.getOrCreateProgram(R,$)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const h=this.calculateLightsBrightness();o.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const y=this._changes.isDirty();let C=!1;if(this._changes.isDirty()){const $=this._changes.getLayerUpdatesByScope();for(const Z in $){const{updatedIds:se,removedIds:ue}=$[Z];(se||ue)&&(this._updateWorkerLayers(Z,se,ue),C=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const A={};for(const $ in this._mergedSourceCaches){const Z=this._mergedSourceCaches[$];A[$]=Z.used,Z.used=!1,Z.tileCoverLift=0}for(const $ of this._mergedOrder){const Z=this._mergedLayers[$];if(Z.recalculate(o,this._availableImages),!Z.isHidden(o.zoom)){const se=this.getLayerSourceCache(Z);se&&(se.used=!0,se.tileCoverLift=Math.max(se.tileCoverLift,Z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(Z,o)}):this.precompilePrograms(Z,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&C&&this.mergeLayers();const R=this.imageManager.getPendingImageProviders();for(const $ of R)$.sourceCache.used=!0;for(const $ in A){const Z=this._mergedSourceCaches[$];A[$]!==Z.used&&Z.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:Z.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),y&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const h of o){const y=h.resolvePendingRequests(),C=this.getFragmentStyle(h.scope);C&&C.addImages(y)}}_updateTilesForChangedImages(){const o={};for(const h in this._mergedSourceCaches){const y=this._mergedSourceCaches[h].getSource().scope;o[y]=o[y]||this._changes.getUpdatedImages(y),o[y].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o[y])}for(const h in o)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(o,h,y){const C=this.getFragmentStyle(o);C&&this.dispatcher.broadcast("updateLayers",{layers:h?C._serializeLayers(h):[],scope:o,removedIds:y||[],options:C.options})}setState(o,h){if(this._checkLoaded(),Kn(this,Aa(o)))return!1;(o=i.d6(o)).layers=Th(o.layers);const y=function(R,$){if(!R)return[{command:Vs.setStyle,args:[$]}];let Z=[];try{if(!i.bv(R.version,$.version))return[{command:Vs.setStyle,args:[$]}];if(i.bv(R.center,$.center)||Z.push({command:Vs.setCenter,args:[$.center]}),i.bv(R.zoom,$.zoom)||Z.push({command:Vs.setZoom,args:[$.zoom]}),i.bv(R.bearing,$.bearing)||Z.push({command:Vs.setBearing,args:[$.bearing]}),i.bv(R.pitch,$.pitch)||Z.push({command:Vs.setPitch,args:[$.pitch]}),i.bv(R.sprite,$.sprite)||Z.push({command:Vs.setSprite,args:[$.sprite]}),i.bv(R.glyphs,$.glyphs)||Z.push({command:Vs.setGlyphs,args:[$.glyphs]}),i.bv(R.imports,$.imports)||function(Ce=[],$e=[],Ne){$e=$e||[];const We=(Ce=Ce||[]).map(hp),Xe=$e.map(hp),et=Ce.reduce(mh,{}),_t=$e.reduce(mh,{}),Ct=We.slice();let jt,Ft,Rt,Et;for(jt=0,Ft=0;jt<We.length;jt++)Rt=We[jt],_t.hasOwnProperty(Rt)?Ft++:(Ne.push({command:Vs.removeImport,args:[Rt]}),Ct.splice(Ct.indexOf(Rt,Ft),1));for(jt=0,Ft=0;jt<Xe.length;jt++)Rt=Xe[Xe.length-1-jt],Ct[Ct.length-1-jt]!==Rt&&(et.hasOwnProperty(Rt)?(Ne.push({command:Vs.removeImport,args:[Rt]}),Ct.splice(Ct.lastIndexOf(Rt,Ct.length-Ft),1)):Ft++,Et=Ct[Ct.length-jt],Ne.push({command:Vs.addImport,args:[_t[Rt],Et]}),Ct.splice(Ct.length-jt,0,Rt));for(const Wt of $e){const qt=et[Wt.id];qt&&(delete qt.data,i.bv(qt,Wt)||Ne.push({command:Vs.updateImport,args:[Wt.id,Wt]}))}}(R.imports,$.imports,Z),i.bv(R.transition,$.transition)||Z.push({command:Vs.setTransition,args:[$.transition]}),i.bv(R.light,$.light)||Z.push({command:Vs.setLight,args:[$.light]}),i.bv(R.fog,$.fog)||Z.push({command:Vs.setFog,args:[$.fog]}),i.bv(R.snow,$.snow)||Z.push({command:Vs.setSnow,args:[$.snow]}),i.bv(R.rain,$.rain)||Z.push({command:Vs.setRain,args:[$.rain]}),i.bv(R.projection,$.projection)||Z.push({command:Vs.setProjection,args:[$.projection]}),i.bv(R.lights,$.lights)||Z.push({command:Vs.setLights,args:[$.lights]}),i.bv(R.camera,$.camera)||Z.push({command:Vs.setCamera,args:[$.camera]}),i.bv(R.iconsets,$.iconsets)||function(Ce,$e,Ne){let We;for(We in $e=$e||{},Ce=Ce||{})Ce.hasOwnProperty(We)&&($e.hasOwnProperty(We)||Ne.push({command:Vs.removeIconset,args:[We]}));for(We in $e){if(!$e.hasOwnProperty(We))continue;const Xe=$e[We];Ce.hasOwnProperty(We)?i.bv(Ce[We],Xe)||(Ne.push({command:Vs.removeIconset,args:[We]}),Ne.push({command:Vs.addIconset,args:[We,Xe]})):Ne.push({command:Vs.addIconset,args:[We,Xe]})}}(R.iconsets,$.iconsets,Z),!i.bv(R["color-theme"],$["color-theme"]))return[{command:Vs.setStyle,args:[$]}];const se={},ue=[];(function(Ce,$e,Ne,We){let Xe;for(Xe in $e=$e||{},Ce=Ce||{})Ce.hasOwnProperty(Xe)&&($e.hasOwnProperty(Xe)||vu(Xe,Ne,We));for(Xe in $e){if(!$e.hasOwnProperty(Xe))continue;const et=$e[Xe];Ce.hasOwnProperty(Xe)?i.bv(Ce[Xe],et)||(Ce[Xe].type==="geojson"&&et.type==="geojson"&&Vf(Ce,$e,Xe)?Ne.push({command:Vs.setGeoJSONSourceData,args:[Xe,et.data]}):Qh(Xe,$e,Ne,We)):pu(Xe,$e,Ne)}})(R.sources,$.sources,ue,se);const be=[];R.layers&&R.layers.forEach(Ce=>{Ce.source&&se[Ce.source]?Z.push({command:Vs.removeLayer,args:[Ce.id]}):be.push(Ce)});let ge=R.terrain;ge&&se[ge.source]&&(Z.push({command:Vs.setTerrain,args:[void 0]}),ge=void 0),Z=Z.concat(ue),i.bv(ge,$.terrain)||Z.push({command:Vs.setTerrain,args:[$.terrain]}),function(Ce,$e,Ne){$e=$e||[];const We=(Ce=Ce||[]).map(hp),Xe=$e.map(hp),et=Ce.reduce(mh,{}),_t=$e.reduce(mh,{}),Ct=We.slice(),jt=Object.create(null);let Ft,Rt,Et,Wt,qt,Ei,Mi;for(Ft=0,Rt=0;Ft<We.length;Ft++)Et=We[Ft],_t.hasOwnProperty(Et)?Rt++:(Ne.push({command:Vs.removeLayer,args:[Et]}),Ct.splice(Ct.indexOf(Et,Rt),1));for(Ft=0,Rt=0;Ft<Xe.length;Ft++)Et=Xe[Xe.length-1-Ft],Ct[Ct.length-1-Ft]!==Et&&(et.hasOwnProperty(Et)?(Ne.push({command:Vs.removeLayer,args:[Et]}),Ct.splice(Ct.lastIndexOf(Et,Ct.length-Rt),1)):Rt++,Ei=Ct[Ct.length-Ft],Ne.push({command:Vs.addLayer,args:[_t[Et],Ei]}),Ct.splice(Ct.length-Ft,0,Et),jt[Et]=!0);for(Ft=0;Ft<Xe.length;Ft++)if(Et=Xe[Ft],Wt=et[Et],qt=_t[Et],!jt[Et]&&!i.bv(Wt,qt))if(i.bv(Wt.source,qt.source)&&i.bv(Wt["source-layer"],qt["source-layer"])&&i.bv(Wt.type,qt.type)){for(Mi in Tc(Wt.layout,qt.layout,Ne,Et,null,Vs.setLayoutProperty),Tc(Wt.paint,qt.paint,Ne,Et,null,Vs.setPaintProperty),i.bv(Wt.slot,qt.slot)||Ne.push({command:Vs.setSlot,args:[Et,qt.slot]}),i.bv(Wt.filter,qt.filter)||Ne.push({command:Vs.setFilter,args:[Et,qt.filter]}),i.bv(Wt.minzoom,qt.minzoom)&&i.bv(Wt.maxzoom,qt.maxzoom)||Ne.push({command:Vs.setLayerZoomRange,args:[Et,qt.minzoom,qt.maxzoom]}),Wt)Wt.hasOwnProperty(Mi)&&Mi!=="layout"&&Mi!=="paint"&&Mi!=="filter"&&Mi!=="metadata"&&Mi!=="minzoom"&&Mi!=="maxzoom"&&Mi!=="slot"&&(Mi.indexOf("paint.")===0?Tc(Wt[Mi],qt[Mi],Ne,Et,Mi.slice(6),Vs.setPaintProperty):i.bv(Wt[Mi],qt[Mi])||Ne.push({command:Vs.setLayerProperty,args:[Et,Mi,qt[Mi]]}));for(Mi in qt)qt.hasOwnProperty(Mi)&&!Wt.hasOwnProperty(Mi)&&Mi!=="layout"&&Mi!=="paint"&&Mi!=="filter"&&Mi!=="metadata"&&Mi!=="minzoom"&&Mi!=="maxzoom"&&Mi!=="slot"&&(Mi.indexOf("paint.")===0?Tc(Wt[Mi],qt[Mi],Ne,Et,Mi.slice(6),Vs.setPaintProperty):i.bv(Wt[Mi],qt[Mi])||Ne.push({command:Vs.setLayerProperty,args:[Et,Mi,qt[Mi]]}))}else Ne.push({command:Vs.removeLayer,args:[Et]}),Ei=Ct[Ct.lastIndexOf(Et)+1],Ne.push({command:Vs.addLayer,args:[qt,Ei]})}(be,$.layers,Z)}catch(se){console.warn("Unable to compute style diff:",se),Z=[{command:Vs.setStyle,args:[$]}]}return Z}(this.serialize(),o).filter(R=>!(R.command in Xo));if(y.length===0)return!1;const C=y.filter(R=>!(R.command in As));if(C.length>0)throw new Error(`Unimplemented: ${C.map(R=>R.command).join(", ")}.`);const A=[];return y.forEach(R=>{A.push(this[R.command](...R.args))}),h&&Promise.all(A).then(h).catch(h),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){for(const[h,y]of o.entries()){if(this.getImage(h))return this.fire(new i.z(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,y),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(o,h){return this.getImage(o)?this.fire(new i.z(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,h),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(o,h,y=!1){this.imageManager.updateImage(o,this.scope,h),y&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new i.A("data",{dataType:"style"})),this}addModel(o,h,y={}){return this._checkLoaded(),this._validate(rt,`models.${o}`,h,null,y)||(this.modelManager.addModel(o,h,this.scope),this.fire(new i.A("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,h,y={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(ja,`sources.${o}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const C=Sc(o,h,this.dispatcher,this);C.scope=this.scope,C.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(C.id),source:C.serialize(),sourceId:C.id}));const A=R=>{const $=(R?"symbol:":"other:")+C.id,Z=i.C($,this.scope),se=this._sourceCaches[$]=new Bs(Z,C,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[C.id]=se,se.onAdd(this.map)};A(!1),h.type!=="vector"&&h.type!=="geojson"||A(!0),C.onAdd&&C.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const h=this.getOwnSource(o);if(!h)throw new Error("There is no source with this ID");for(const C in this._layers)if(this._layers[C].source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while layer "${C}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const C=Object.entries(this.stylesheet.iconsets).find(([A,R])=>R.type==="source"&&R.source===o);if(C)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while iconset "${C[0]}" is using it.`)))}const y=this.getOwnSourceCaches(o);for(const C of y){const A=i.d7(C.id);delete this._sourceCaches[A],this._changes.discardSourceCacheUpdate(C.id),C.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:C.getSource().id})),C.setEventedParent(null),C.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getOwnSource(o).setData(h),this._changes.setDirty()}getOwnSource(o){const h=this.getOwnSourceCache(o);return h&&h.getSource()}getOwnSources(){const o=[];for(const h in this._otherSourceCaches){const y=this.getOwnSourceCache(h);y&&o.push(y.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const h in o){const y=o[h]._tiles;for(const C in y){const A=y[C];if(A.state!=="loaded"&&A.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const A of o){if(this._validate(hl,"lights",A))return;switch(A.type){case"ambient":if(this.ambientLight){const R=this.ambientLight;R.set(A),R.updateTransitions(h)}else this.ambientLight=new _r(A,tn||(tn=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const R=this.directionalLight;R.set(A),R.updateTransitions(h)}else this.directionalLight=new _r(A,Jn||(Jn=new i.a7({direction:new i.an(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=Object.assign(h,{worldview:this.map.getWorldview()}),C=new i.aa(this.z||0,y);this.ambientLight&&this.ambientLight.recalculate(C),this.directionalLight&&this.directionalLight.recalculate(C),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,h=this.ambientLight;if(!o||!h)return;const y=ge=>.2126*(ge[0]<=.03928?ge[0]/12.92:Math.pow((ge[0]+.055)/1.055,2.4))+.7152*(ge[1]<=.03928?ge[1]/12.92:Math.pow((ge[1]+.055)/1.055,2.4))+.0722*(ge[2]<=.03928?ge[2]/12.92:Math.pow((ge[2]+.055)/1.055,2.4)),C=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),A=o.properties.get("intensity"),R=o.properties.get("direction"),$=1-i.cR(R.x,R.y,R.z)[2]/90,Z=y(C)*A*$,se=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),ue=h.properties.get("intensity"),be=y(se)*ue;return Number(((Z+be)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.d8(o)){const h=i.d9(o),y=this.fragments.find(({id:A})=>A===h);if(!y)return;const C=i.d7(o);return y.style.getFragmentStyle(C)}{const h=this.fragments.find(({id:y})=>y===o);return h?h.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const h={},y=(C,A="")=>`${C}::${A}`;this._featuresetSelectors={};for(const C in o){const A=this._featuresetSelectors[C]=[];for(const R of o[C].selectors){if(R.featureNamespace){const Z=this.getOwnLayer(R.layer);if(!Z){i.w(`Layer is undefined for selector: ${R.layer}`);continue}const se=y(Z.source,Z.sourceLayer);if(se in h&&h[se]!==R.featureNamespace){i.w(`"featureNamespace ${R.featureNamespace} of featureset ${C}'s selector is not associated to the same source, skip this selector`);continue}h[se]=R.featureNamespace}let $;if(R.properties)for(const Z in R.properties){const se=i.X(R.properties[Z]);se.result==="success"&&($=$||{},$[Z]=se.value)}A.push({layerId:R.layer,namespace:R.featureNamespace,properties:$,uniqueFeatureID:R._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const h=this.getFragmentStyle(o);if(!h||!h.stylesheet.featuresets)return[];const y=[];for(const C in h.stylesheet.featuresets)y.push({featuresetId:C,importId:h.scope?h.scope:void 0});return y}getFeaturesetLayers(o,h){const y=this.getFragmentStyle(h),C=y.stylesheet.featuresets;if(!C||!C[o])return this.fire(new i.z(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const A=[];for(const R of C[o].selectors){const $=y.getOwnLayer(R.layer);$&&A.push($)}return A}getConfigProperty(o,h){const y=this.getFragmentStyle(o);if(!y)return null;const C=i.C(h,y.scope),A=y.options.get(C),R=A?A.value||A.default:null;return R?R.serialize():null}setConfigProperty(o,h,y){const C=this.getFragmentStyle(o);if(!C)return;const A=C.stylesheet.indoor?Pc(C.stylesheet.schema):C.stylesheet.schema;if(!A||!A[h])return;const R=i.X(y);if(R.result!=="success")return void Kn(this,R.value);const $=R.value.expression,Z=i.C(h,C.scope),se=C.options.get(Z);if(!se)return;let ue;const{minValue:be,maxValue:ge,stepValue:Ce,type:$e,values:Ne}=A[h],We=i.X(A[h].default);We.result==="success"&&(ue=We.value.expression),ue?(this.options.set(Z,Object.assign({},se,{value:$,default:ue,minValue:be,maxValue:ge,stepValue:Ce,type:$e,values:Ne})),this.updateConfigDependencies(h)):this.fire(new i.z(new Error(`No schema defined for the config option "${h}" in the "${o}" fragment.`)))}getConfig(o){const h=this.getFragmentStyle(o);if(!h)return null;const y=h.stylesheet.schema;if(!y)return null;const C={};for(const A in y){const R=i.C(A,h.scope),$=h.options.get(R),Z=$?$.value||$.default:null;C[A]=Z?Z.serialize():null}return C}setConfig(o,h){const y=this.getFragmentStyle(o);y&&(y.updateConfig(h,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const h=this.getFragmentStyle(o);return h?h.stylesheet.schema:null}setSchema(o,h){const y=this.getFragmentStyle(o);y&&(y.stylesheet.schema=h,y.updateConfig(y._config,h),this.updateConfigDependencies())}updateConfig(o,h){if(this._config=o,o||h)if(h)for(const y in h){let C,A;const R=i.X(h[y].default);if(R.result==="success"&&(C=R.value.expression),o&&o[y]!==void 0){const ge=i.X(o[y]);ge.result==="success"&&(A=ge.value.expression)}const{minValue:$,maxValue:Z,stepValue:se,type:ue,values:be}=h[y];if(C){const ge=i.C(y,this.scope);this.options.set(ge,{default:C,value:A,minValue:$,maxValue:Z,stepValue:se,type:ue,values:be})}else this.fire(new i.z(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const h of this._configDependentLayers){const y=this.getLayer(h);if(y){if(o&&!y.configDependencies.has(o))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const y=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(y){const C=h._evaluateColorThemeData(y);(!h._styleColorTheme.lut&&C!==""||h._styleColorTheme.lut&&C!==h._styleColorTheme.lut.data)&&h.setColorTheme(y)}}),this._changes.setDirty()}addLayer(o,h,y={}){this._checkLoaded();const C=o.id;if(this._layers[C])return void this.fire(new i.z(new Error(`Layer with id "${C}" already exists on this map`)));let A;if(o.type==="custom"){if(Kn(this,i.da(o)))return;A=i.db(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(C,o.source),o=i.d6(o),o=i.h(o,{source:C})),this._validate(Un,`layers.${C}`,o,{arrayIndex:-1},y))return;A=i.db(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(A),A.setEventedParent(this,{layer:{id:C}})}A.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid);let R=this._order.length;if(h){const ue=this._order.indexOf(h);if(ue===-1)return void this.fire(new i.z(new Error(`Layer with id "${h}" does not exist on this map.`)));A.slot===this._layers[h].slot?R=ue:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(R,0,C),this._layerOrderChanged=!0,this._layers[C]=A;const $=this.getOwnLayerSourceCache(A),Z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();$&&A.canCastShadows()&&Z&&($.castsShadows=!0);const se=this._changes.getRemovedLayer(A);if(se&&A.source&&$&&A.type!=="custom"){this._changes.discardLayerRemoval(A);const ue=i.C(A.source,A.scope);se.type!==A.type?this._changes.updateSourceCache(ue,"clear"):(this._changes.updateSourceCache(ue,"reload"),$.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),A.scope=this.scope,this.mergeLayers()}moveLayer(o,h){this._checkLoaded();const y=this._checkLayer(o);if(!y||o===h)return;const C=this._order.indexOf(o);this._order.splice(C,1);let A=this._order.length;if(h){const R=this._order.indexOf(h);if(R===-1)return void this.fire(new i.z(new Error(`Layer with id "${h}" does not exist on this map.`)));y.slot===this._layers[h].slot?A=R:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const h=this._checkLayer(o);if(!h)return;h.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const C=this.getOwnLayerSourceCache(h);if(C&&C.castsShadows){let A=!1;for(const R in this._layers)if(this._layers[R].source===h.source&&this._layers[R].canCastShadows()){A=!0;break}C.castsShadows=A}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,y){this._checkLoaded();const C=this._checkLayer(o);C&&(C.minzoom===h&&C.maxzoom===y||(h!=null&&(C.minzoom=h),y!=null&&(C.maxzoom=y),this._updateLayer(C)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,h){this._checkLoaded();const y=this._checkLayer(o);y&&y.slot!==h&&(y.slot=h,this._updateLayer(y))}setFilter(o,h,y={}){this._checkLoaded();const C=this._checkLayer(o);if(C&&!i.bv(C.filter,h))return h==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(vi,`layers.${C.id}.filter`,h,{layerType:C.type},y)||(C.filter=i.d6(h),this._updateLayer(C)))}getFilter(o){const h=this._checkLayer(o);if(h)return i.d6(h.filter)}setLayoutProperty(o,h,y,C={}){this._checkLoaded();const A=this._checkLayer(o);if(A&&!i.bv(A.getLayoutProperty(h),y)){if(y!=null&&(!C||C.validate!==!1)&&Kn(A,Fe.call(Aa,{key:`layers.${o}.layout.${h}`,layerType:A.type,objectKey:h,value:y,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;A.setLayoutProperty(h,y),A.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),this._updateLayer(A)}}getLayoutProperty(o,h){const y=this._checkLayer(o);if(y)return y.getLayoutProperty(h)}setPaintProperty(o,h,y,C={}){this._checkLoaded();const A=this._checkLayer(o);if(!A||i.bv(A.getPaintProperty(h),y)||y!=null&&(!C||C.validate!==!1)&&Kn(A,Ge.call(Aa,{key:`layers.${o}.paint.${h}`,layerType:A.type,objectKey:h,value:y,styleSpec:i.a5})))return;const R=A.setPaintProperty(h,y);A.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),R&&this._updateLayer(A),this._changes.updatePaintProperties(A)}getPaintProperty(o,h){const y=this._checkLayer(o);if(y)return y.getPaintProperty(h)}setFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:Z,importId:se}=o.target,ue=this.getFragmentStyle(se),be=ue.getFeaturesetLayers(Z);for(const{source:ge,sourceLayer:Ce}of be)ue.setFeatureState({id:o.id,source:ge,sourceLayer:Ce},h)}else if("layerId"in o.target){const{layerId:Z}=o.target,se=this.getLayer(Z);this.setFeatureState({id:o.id,source:se.source,sourceLayer:se.sourceLayer},h)}return}const y=o.source,C=o.sourceLayer,A=this._checkSource(y);if(!A)return;const R=A.type;if(R==="geojson"&&C)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(R==="vector"&&!C)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const $=this.getOwnSourceCaches(y);for(const Z of $)Z.setFeatureState(C,o.id,h)}removeFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:Z,importId:se}=o.target,ue=this.getFragmentStyle(se),be=ue.getFeaturesetLayers(Z);for(const{source:ge,sourceLayer:Ce}of be)ue.removeFeatureState({id:o.id,source:ge,sourceLayer:Ce},h)}else if("layerId"in o.target){const{layerId:Z}=o.target,se=this.getLayer(Z);this.removeFeatureState({id:o.id,source:se.source,sourceLayer:se.sourceLayer},h)}return}const y=o.source,C=this._checkSource(y);if(!C)return;const A=C.type,R=A==="vector"?o.sourceLayer:void 0;if(A==="vector"&&!R)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const $=this.getOwnSourceCaches(y);for(const Z of $)Z.removeFeatureState(R,o.id,h)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let A;if("featuresetId"in o.target){const{featuresetId:R,importId:$}=o.target,Z=this.getFragmentStyle($),se=Z.getFeaturesetLayers(R);for(const{source:ue,sourceLayer:be}of se){const ge=Z.getFeatureState({id:o.id,source:ue,sourceLayer:be});if(ge&&!A)A=ge;else if(!i.bv(A,ge))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:R}=o.target,$=this.getLayer(R);A=this.getFeatureState({id:o.id,source:$.source,sourceLayer:$.sourceLayer})}return A}const h=o.source,y=o.sourceLayer,C=this._checkSource(h);if(C){if(C.type!=="vector"||y)return o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(y,o.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=i.h({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return i.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),h=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateFilteredLayers(o){for(const h of Object.values(this._mergedLayers))o(h)&&this._updateLayer(h)}_updateLayer(o){this._changes.updateLayer(o);const h=this.getLayerSourceCache(o),y=i.C(o.source,o.scope),C=this._changes.getUpdatedSourceCaches();o.source&&!C[y]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),h.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const h=$=>this._mergedLayers[$].is3D(!!this.terrain),y=this.order,C={},A=[];for(let $=y.length-1;$>=0;$--){const Z=y[$];if(h(Z)){C[Z]=$;for(const se of o){const ue=se[Z];if(ue)for(const be of ue)A.push(be)}}}A.sort(($,Z)=>Z.intersectionZ-$.intersectionZ);const R=[];for(let $=y.length-1;$>=0;$--){const Z=y[$];if(h(Z))for(let se=A.length-1;se>=0;se--){const ue=A[se].feature;if(ue.layer&&C[ue.layer.id]<$)break;R.push(ue),A.pop()}else for(const se of o){const ue=se[Z];if(ue)for(const be of ue)R.push(be.feature)}}return R}queryRenderedFeatures(o,h,y){let C;h&&!Array.isArray(h)&&h.filter&&(this._validate(vi,"queryRenderedFeatures.filter",h.filter,null,h),C=i.b3(h.filter));const A={},R=ue=>{if(pl.has(ue.type))return;const be=this.getOwnLayerSourceCache(ue),ge=A[be.id]=A[be.id]||{sourceCache:be,layers:{},has3DLayers:!1};ue.is3D(!!this.terrain)&&(ge.has3DLayers=!0),ge.layers[ue.fqid]=ge.layers[ue.fqid]||{styleLayer:ue,targets:[]},ge.layers[ue.fqid].targets.push({filter:C})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const ue of h.layers){const be=this._layers[ue];if(!be)return this.fire(new i.z(new Error(`The layer '${ue}' does not exist in the map's style and cannot be queried for features.`))),[];R(be)}}else for(const ue in this._layers)R(this._layers[ue]);const $=this._queryRenderedFeatures(o,A,y),Z=this._flattenAndSortRenderedFeatures($),se=[];for(const ue of Z)i.dd(ue.layer.id)===this.scope&&se.push(ue);return se}queryRenderedFeatureset(o,h,y){let C;h&&!Array.isArray(h)&&h.filter&&(this._validate(vi,"queryRenderedFeatures.filter",h.filter,null,h),C=i.b3(h.filter));const A="mock",R=[];if(h&&h.target)R.push(Object.assign({},h,{targetId:A,filter:C}));else{const ue=this.getFeaturesetDescriptors();for(const be of ue)R.push({targetId:A,filter:C,target:be});for(const{style:be}of this.fragments){const ge=be.getFeaturesetDescriptors();for(const Ce of ge)R.push({targetId:A,filter:C,target:Ce})}}const $=this.queryRenderedTargets(o,R,y),Z=[],se=new Set;for(const ue of $)for(const be of ue.variants[A])lh(be,ue,se)||Z.push(new i.de(ue,be));return Z}queryRenderedTargets(o,h,y){const C={},A=($,Z,se,ue)=>{const be=C[Z.id]=C[Z.id]||{sourceCache:Z,layers:{},has3DLayers:!1};if(be.layers[$.fqid]=be.layers[$.fqid]||{styleLayer:$,targets:[]},$.is3D(!!this.terrain)&&(be.has3DLayers=!0),!ue)return se.uniqueFeatureID=!1,void be.layers[$.fqid].targets.push(se);be.layers[$.fqid].targets.push(Object.assign({},se,{namespace:ue.namespace,properties:ue.properties,uniqueFeatureID:ue.uniqueFeatureID}))};for(const $ of h)if("featuresetId"in $.target){const{featuresetId:Z,importId:se}=$.target,ue=this.getFragmentStyle(se);if(!ue||!ue._featuresetSelectors)continue;const be=ue._featuresetSelectors[Z];if(!be){this.fire(new i.z(new Error(`The featureset '${Z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const ge of be){const Ce=ue.getOwnLayer(ge.layerId);Ce&&!pl.has(Ce.type)&&A(Ce,ue.getOwnLayerSourceCache(Ce),$,ge)}}else if("layerId"in $.target){const{layerId:Z}=$.target,se=this.getLayer(Z);if(!se||pl.has(se.type))continue;A(se,this.getLayerSourceCache(se),$)}const R=this._queryRenderedFeatures(o,C,y);return this._flattenAndSortRenderedFeatures(R)}_queryRenderedFeatures(o,h,y){const C=[],A=!!this.map._showQueryGeometry,R=zi.createFromScreenPoints(o,y);for(const $ in h){const Z=ps(R,h[$],this._availableImages,y,A);Object.keys(Z).length&&C.push(Z)}if(this.placement)for(const $ in h){if(!h[$].sourceCache._onlySymbols)continue;const Z=la(R.screenGeometry,h[$],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(Z).length&&C.push(Z)}return C}querySourceFeatures(o,h){const y=h&&h.filter;y&&this._validate(vi,"querySourceFeatures.filter",y,null,h);let C=[];const A=this.getOwnSourceCaches(o);for(const R of A)C=C.concat($u(R,h));return C}addSourceType(o,h,y){return In.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(In.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,h,y={}){this._checkLoaded();const C=this.light.getLight();let A=!1;for(const $ in o)if(!i.bv(o[$],C[$])){A=!0;break}if(!A)return;const R=this._getTransitionParameters();this.light.setLight(o,h,y),this.light.updateTransitions(R)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,h=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=o;const C=o.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const $="terrain-dem-src";this.addSource($,y.source),y=i.d6(y),y=i.h(y,{source:$})}const A=i.h({},y),R={};if(this.terrain&&C){A.source=this.terrain.get().source;const $=this.terrain?this.getFragmentStyle(this.terrain.scope):null;$&&(R.style=$.serialize())}if(this._validate(fr,"terrain",A,R))return}if(!this.terrain||this.terrain.scope!==this.scope&&!C||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h),this.fire(new i.A("data",{dataType:"style"}))}else{const A=this.terrain,R=A.get();for(const $ of Object.keys(i.a5.terrain))!y.hasOwnProperty($)&&i.a5.terrain[$].default&&(y[$]=i.a5.terrain[$].default);for(const $ in o)if(!i.bv(o[$],R[$])){A.set(o,this.options),this.stylesheet.terrain=o;const Z=this._getTransitionParameters({duration:0});A.updateTransitions(Z),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const h=this.fog=new ii(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_createSnow(o){const h=this.snow=new ds(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_createRain(o){const h=this.rain=new mi(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.snow=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.rain=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const C in this._layers)this._layers[C].lut=this._styleColorTheme.lut;for(const C in this._sourceCaches)this._sourceCaches[C].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void o();const y=this._evaluateColorThemeData(h);this._loadColorTheme(y).then(()=>{this.fire(new i.A("colorthemeset")),o()}).catch(C=>{i.w(`Couldn't set color theme: ${C}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,h){const y=this.getFragmentStyle(o);y&&(y._styleColorTheme.colorThemeOverride=h,y._reloadColorTheme())}_getTransitionParameters(o){return{now:i.q.now(),transition:i.h(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],h=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?o.push(y):h.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){const y=this.terrain=new ti(o,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const C=this._getTransitionParameters({duration:0});y.updateTransitions(C)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,y,C,A={}){if(A&&A.validate===!1)return!1;const R=i.h({},this.serialize());return Kn(this,o.call(Aa,i.h({key:h,style:R,value:y,styleSpec:i.a5},C)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const h=this.getSourceCaches(o);for(const y of h)y.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){const h=this.getSourceCaches(o);for(const y of h)y.resume(),y.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let h;this.directionalLight&&(h=$a(this.directionalLight));const y=new Set;for(const C in this._mergedLayers){const A=this._mergedLayers[C];A.hasElevation()&&!y.has(A.source)&&y.add(A.source)}for(const C in this._mergedSourceCaches){const A=this._mergedSourceCaches[C],R=y.has(A._source.id);A.update(o,void 0,void 0,h,R)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,y,C,A,R,$=!1){let Z=!1,se=!1;const ue={},be={};for(const ge of this._mergedOrder){const Ce=this._mergedLayers[ge];if(Ce.type!=="symbol")continue;const $e=i.C(Ce.source,Ce.scope);let Ne=ue[$e];if(!Ne){const Xe=this.getLayerSourceCache(Ce);if(!Xe)continue;const et=Xe.getRenderableIds(!0).map(_t=>Xe.getTileByID(_t));be[$e]=et.slice(),Ne=ue[$e]=et.sort((_t,Ct)=>Ct.tileID.overscaledZ-_t.tileID.overscaledZ||(_t.tileID.isLessThan(Ct.tileID)?-1:1))}const We=this.crossTileSymbolIndex.addLayer(Ce,Ne,h.center.lng,h.projection);Z=Z||We}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),$=$||this._layerOrderChanged||C===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),($||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),h.zoom))&&(this.pauseablePlacement=new vt(h,this._mergedOrder,$,y,C,A,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,ue,be,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),se=!0),Z&&this.pauseablePlacement.placement.setStale()),se||Z){this._buildingIndex.onNewFrame(h.zoom);for(let ge=0;ge<this._mergedOrder.length;ge++){const Ce=this._mergedLayers[this._mergedOrder[ge]];if(Ce.type!=="symbol")continue;const $e=this.isLayerClipped(Ce);this.placement.updateLayerOpacities(Ce,ue[i.C(Ce.source,Ce.scope)],ge,$e?R:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,h){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:A})=>A===o.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!h)return y.push(o),this._loadImports([o],!0);const C=y.findIndex(({id:A})=>A===h);return C===-1&&this.fire(new i.z(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,C).concat(o).concat(y.slice(C)),this._loadImports([o],!0,h)}updateImport(o,h){this._checkLoaded();const y=this.stylesheet.imports||[],C=this.getImportIndex(o);return C===-1?this:typeof h=="string"?(this.setImportUrl(o,h),this):(h.url&&h.url!==y[C].url&&this.setImportUrl(o,h.url),i.bv(h.config,y[C].config)||this.setImportConfig(o,h.config,h.data.schema),i.bv(h.data,y[C].data)||this.setImportData(o,h.data),this)}moveImport(o,h){this._checkLoaded();let y=this.stylesheet.imports||[];const C=this.getImportIndex(o);if(C===-1)return this;const A=this.getImportIndex(h);if(A===-1)return this;const R=y[C],$=this.fragments[C];return y=y.filter(({id:Z})=>Z!==o),this.fragments=this.fragments.filter(({id:Z})=>Z!==o),this.stylesheet.imports=y.slice(0,A).concat(R).concat(y.slice(A)),this.fragments=this.fragments.slice(0,A).concat($).concat(this.fragments.slice(A)),this.mergeLayers(),this}setImportUrl(o,h){this._checkLoaded();const y=this.stylesheet.imports||[],C=this.getImportIndex(o);if(C===-1)return this;y[C].url=h;const A=this.fragments[C];return A.style=this._createFragmentStyle(y[C]),A.style.on("style.import.load",()=>this.mergeAll()),A.style.loadURL(h),this}setImportData(o,h){this._checkLoaded();const y=this.getImportIndex(o),C=this.stylesheet.imports||[];return y===-1?this:h?(this.fragments[y].style.setState(h),this._reloadImports(),this):(delete C[y].data,this.setImportUrl(o,C[y].url))}setImportConfig(o,h,y){this._checkLoaded();const C=this.getImportIndex(o),A=this.stylesheet.imports||[];if(C===-1)return this;h?A[C].config=h:delete A[C].config;const R=this.fragments[C];y&&R.style.stylesheet&&(R.style.stylesheet.schema=y);const $=R.style.stylesheet&&R.style.stylesheet.schema;return R.config=h,R.style.updateConfig(h,$),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const h=this.stylesheet.imports||[],y=this.getImportIndex(o);y!==-1&&(h.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(o){const h=(this.stylesheet.imports||[]).findIndex(y=>y.id===o);return h===-1&&this.fire(new i.z(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),h}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const h in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[h];y&&o.push(y.getSource())}return o}getSource(o,h){const y=this.getSourceCache(o,h);return y&&y.getSource()}getLayerSource(o){const h=this.getLayerSourceCache(o);return h&&h.getSource()}getSourceCache(o,h){const y=i.C(o,h);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(o){const h=i.C(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[o]&&h.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&h.push(this._mergedSymbolSourceCaches[o]),h}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const h in o){const y=o[h];y==="reload"?this.reloadSource(h):y==="clear"&&this.clearSource(h)}}updateLayers(o){const h=this._changes.getUpdatedPaintProperties();for(const y of h){const C=this.getLayer(y);C&&C.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o,this.scope)}getImages(o,h,y){this.imageManager.getImages(h.images,h.scope,y),this._updateTilesForChangedImages();const C=R=>{if(R){const $=h.images.map(Z=>i.I.toString(Z));R.setDependencies(h.tileID.key,h.type,$)}},A=i.C(h.source,h.scope);C(this._mergedOtherSourceCaches[A]),C(this._mergedSymbolSourceCaches[A])}rasterizeImages(o,h,y){this.imageManager.rasterizeImages(h,y)}getGlyphs(o,h,y){this.glyphManager.getGlyphs(h.stacks,h.scope,y)}getResource(o,h,y){return i.dg(h,y)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){const h=this.getOwnSourceCaches(o);return h.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${o}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,h){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const y=o.type==="fill-extrusion"&&o.sourceLayer==="building",C=o.type==="building";if(o.is3D(!!this.terrain)){if(y||C||h&&h.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}In.getSourceType=function(g){return Po[g]},In.setSourceType=function(g,o){Po[g]=o},In.registerForPluginStateChange=i.dh;var Ms=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ho=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,na=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ta="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Oo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Io=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,To=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,fl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,rl=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,mr=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Tl=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Vo=[];Jc(Ms,Vo),Jc(na,Vo),Jc(ho,Vo);const Kc={"_prelude_fog.vertex.glsl":Io,"_prelude_terrain.vertex.glsl":Oo,"_prelude_shadow.vertex.glsl":mr,"_prelude_fog.fragment.glsl":To,"_prelude_shadow.fragment.glsl":Tl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":fl,"_prelude_raster_particle.glsl":rl},uc={};ws("",Oo),ws(To,Io),ws(Tl,mr),ws(fl,""),ws(rl,"");const dc=ws(ho,na),Qc=Ms;var bd={background:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ws(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ws("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ws(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ws(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ws("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ws("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ws("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ws(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ws(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ws(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ws(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ws(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ws(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ws("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ws("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ws(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ws(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ws("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ws(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ta),skyboxGradient:ws(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ta),skyboxCapture:ws(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ws(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ws(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ws(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ws(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ws("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ws("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ws("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ws("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Jc(g,o){const h=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of h)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const C=y.split(" ");for(const A of C)o.includes(A)||o.push(A)}}function ws(g,o){const h=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let C=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);C&&(C=C.map(se=>{const ue=se.split(" ");return ue[ue.length-1]}),C=[...new Set(C)]);const A={},R=[],$=[];if(g=g.replace(h,(se,ue)=>($.push(ue),"")),(o=o.replace(h,(se,ue)=>(R.push(ue),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let Z=[...Vo];Jc(g,Z),Jc(o,Z);for(const se of[...R,...$])Kc[se]||console.error(`Undefined include: ${se}`),uc[se]||(uc[se]=[],Jc(Kc[se],uc[se])),Z=[...Z,...uc[se]];return{fragmentSource:g=g.replace(y,(se,ue,be,ge,Ce)=>(A[Ce]=!0,ue==="define"?`
#ifndef HAS_UNIFORM_u_${Ce}
in ${be} ${ge} ${Ce};
#else
uniform ${be} ${ge} u_${Ce};
#endif
`:ue==="initialize"?`
#ifdef HAS_UNIFORM_u_${Ce}
    ${be} ${ge} ${Ce} = u_${Ce};
#endif
`:ue==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ce}
    in ${be} ${ge} ${Ce};
#endif
`:ue==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(y,(se,ue,be,ge,Ce)=>{const $e=ge==="float"?"vec2":ge,Ne=Ce.match(/color/)?"color":$e;return ue==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Ce}
in ${be} ${ge} a_${Ce};
#endif
`:A[Ce]?ue==="define"?`
#ifndef HAS_UNIFORM_u_${Ce}
uniform lowp float u_${Ce}_t;
in ${be} ${$e} a_${Ce};
out ${be} ${ge} ${Ce};
#else
uniform ${be} ${ge} u_${Ce};
#endif
`:ue==="initialize"?Ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ce}
    ${Ce} = a_${Ce};
#else
    ${be} ${ge} ${Ce} = u_${Ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ce}
    ${Ce} = unpack_mix_${Ne}(a_${Ce}, u_${Ce}_t);
#else
    ${be} ${ge} ${Ce} = u_${Ce};
#endif
`:ue==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ce}
    in ${be} ${ge} a_${Ce};
    out ${be} ${ge} ${Ce};
#endif
`:ue==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ce}
    ${Ce} = a_${Ce};
#endif
`:void 0:ue==="define"?`
#ifndef HAS_UNIFORM_u_${Ce}
uniform lowp float u_${Ce}_t;
in ${be} ${$e} a_${Ce};
#else
uniform ${be} ${ge} u_${Ce};
#endif
`:ue==="define-instanced"?Ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Ce}0;
in vec4 a_${Ce}1;
in vec4 a_${Ce}2;
in vec4 a_${Ce}3;
#else
uniform ${be} ${ge} u_${Ce};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${be} ${$e} a_${Ce};
#else
uniform ${be} ${ge} u_${Ce};
#endif
`:ue==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Ce}
    ${be} ${ge} ${Ce} = a_${Ce};
#endif
`:Ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ce}
    ${be} ${ge} ${Ce} = a_${Ce};
#else
    ${be} ${ge} ${Ce} = u_${Ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ce}
    ${be} ${ge} ${Ce} = unpack_mix_${Ne}(a_${Ce}, u_${Ce}_t);
#else
    ${be} ${ge} ${Ce} = u_${Ce};
#endif
`}),staticAttributes:C,usedDefines:Z,vertexIncludes:R,fragmentIncludes:$}}class qu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,y,C,A,R,$,Z){this.context=o;let se=this.boundPaintVertexBuffers.length!==C.length;for(let be=0;!se&&be<C.length;be++)this.boundPaintVertexBuffers[be]!==C[be]&&(se=!0);let ue=this.boundDynamicVertexBuffers.length!==$.length;for(let be=0;!ue&&be<$.length;be++)this.boundDynamicVertexBuffers[be]!==$[be]&&(ue=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||se||ue||this.boundIndexBuffer!==A||this.boundVertexOffset!==R)this.freshBind(h,y,C,A,R,$,Z);else{o.bindVertexArrayOES.set(this.vao);for(const be of $)be&&(be.bind(),Z&&be.instanceCount&&be.setVertexAttribDivisor(o.gl,h,Z));A&&A.dynamicDraw&&A.bind()}}freshBind(o,h,y,C,A,R,$){const Z=o.numAttributes,se=this.context,ue=se.gl;this.vao&&this.destroy(),this.vao=se.gl.createVertexArray(),se.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=C,this.boundVertexOffset=A,this.boundDynamicVertexBuffers=R,h.enableAttributes(ue,o),h.bind(),h.setVertexAttribPointers(ue,o,A);for(const be of y)be.enableAttributes(ue,o),be.bind(),be.setVertexAttribPointers(ue,o,A);for(const be of R)be&&(be.enableAttributes(ue,o),be.bind(),be.setVertexAttribPointers(ue,o,A),$&&be.instanceCount&&be.setVertexAttribDivisor(ue,o,$));C&&C.bind(),se.currentNumAttributes=Z}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Pp(g,o){const h=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new i.ac(0,y/h).toLngLat().lat,new i.ac(0,(y+1)/h).toLngLat().lat]}function ga(g,o,h,y,C,A,R){const $=g.context,Z=$.gl,se=h.hillshadeFBO;if(!se)return;g.prepareDrawTile();const ue=g.isTileAffectedByFog(o),be=g.getOrCreateProgram("hillshade",{overrideFog:ue});$.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,se.colorAttachment.get());const ge=((We,Xe,et,_t)=>{const Ct=et.paint.get("hillshade-shadow-color"),jt=et.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ft=et.paint.get("hillshade-highlight-color"),Rt=et.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Et=et.paint.get("hillshade-accent-color"),Wt=et.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",qt=et.paint.get("hillshade-emissive-strength");let Ei=i.al(et.paint.get("hillshade-illumination-direction"));if(et.paint.get("hillshade-illumination-anchor")==="viewport")Ei-=We.transform.angle;else if(We.style&&We.style.enable3dLights()&&We.style.directionalLight){const Ki=We.style.directionalLight.properties.get("direction"),Ji=i.cR(Ki.x,Ki.y,Ki.z);Ei=i.al(Ji[1])}const Mi=!We.options.moving;return{u_matrix:_t||We.transform.calculateProjMatrix(Xe.tileID.toUnwrapped(),Mi),u_image:0,u_latrange:Pp(0,Xe.tileID),u_light:[et.paint.get("hillshade-exaggeration"),Ei],u_shadow:Ct.toPremultipliedRenderColor(jt?null:et.lut),u_highlight:Ft.toPremultipliedRenderColor(Rt?null:et.lut),u_emissive_strength:qt,u_accent:Et.toPremultipliedRenderColor(Wt?null:et.lut)}})(g,h,y,g.terrain?o.projMatrix:null);g.uploadCommonUniforms($,be,o.toUnwrapped());const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:$e,tileBoundsSegments:Ne}=g.getTileBoundsBuffers(h);be.draw(g,Z.TRIANGLES,C,A,R,hi.disabled,ge,y.id,Ce,$e,Ne)}function cf(g,o,h){if(!o.needsDEMTextureUpload)return;const y=g.context,C=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(h.stride);const A=h.getPixels();o.demTexture?o.demTexture.update(A,{premultiply:!1}):o.demTexture=new i.T(y,A,C.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Eh(g,o,h){const y=g.context,C=y.gl;if(!o.dem)return;const A=o.dem;if(y.activeTexture.set(C.TEXTURE1),cf(g,o,A),!o.demTexture)return;o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const R=A.dim;y.activeTexture.set(C.TEXTURE0);let $=o.hillshadeFBO;if(!$){const ge=new i.T(y,{width:R,height:R,data:null},C.RGBA8);ge.bind(C.LINEAR,C.CLAMP_TO_EDGE),$=o.hillshadeFBO=y.createFramebuffer(R,R,!0,"renderbuffer"),$.colorAttachment.set(ge.texture)}y.bindFramebuffer.set($.framebuffer),y.viewport.set([0,0,R,R]);const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:se,tileBoundsSegments:ue}=g.getMercatorTileBoundsBuffers(),be=[];g.linearFloatFilteringSupported()&&be.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:be}).draw(g,C.TRIANGLES,Gt.disabled,sr.disabled,Bi.unblended,hi.disabled,((ge,Ce)=>{const $e=Ce.stride,Ne=i.bz();return i.c5(Ne,0,i.aj,-8192,0,0,1),i.bo(Ne,Ne,[0,-8192,0]),{u_matrix:Ne,u_image:1,u_dimension:[$e,$e],u_zoom:ge.overscaledZ}})(o.tileID,A),h.id,Z,se,ue),o.needsHillshadePrepare=!1}class uo{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wl extends uo{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Kg extends uo{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class k0 extends uo{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class hf extends uo{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Wf extends uo{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class pc extends uo{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Qg extends uo{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class A0 extends uo{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class jf extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Es extends uo{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ro extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class eh extends uo{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class gg extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class uf extends uo{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fo extends uo{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ml extends uo{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Hf extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class df extends uo{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Op extends uo{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let zs=class extends uo{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Yu extends uo{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Rp extends uo{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Np extends uo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class wd extends uo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class No extends uo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Cm extends uo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class yg extends uo{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _g extends uo{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class M0 extends uo{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Em extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class wu extends uo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Bp extends uo{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class zt extends Bp{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Gf extends Bp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class qf extends Bp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Su extends Gf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wa=(g,o,h)=>({u_matrix:g,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:h}),Xu=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:C,u_merc_center:A,u_image0:0,u_frustum_tl:R,u_frustum_tr:$,u_frustum_br:Z,u_frustum_bl:se,u_globe_pos:ue,u_globe_radius:be,u_viewport:ge,u_grid_matrix:Ne?Float32Array.from(Ne):new Float32Array(9),u_skirt_height:Ce,u_far_z_cutoff:$e});function Jg(g,o){return g!=null&&o!=null&&!(!g.hasData()||!o.hasData())&&g.demTexture!=null&&o.demTexture!=null&&g.tileID.key!==o.tileID.key}const pf=new class{constructor(){this.operations={}}newMorphing(g,o,h,y,C){if(g in this.operations){const A=this.operations[g];A.to.tileID.key!==h.tileID.key&&(A.queued=h)}else this.operations[g]={startTime:y,phase:0,duration:C,from:o,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const o=this.operations[g];return{from:o.from,to:o.to,phase:o.phase}}update(g){for(const o in this.operations){const h=this.operations[o];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[o];break}}}_nextOp(g,o){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=o,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Fp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ey(g,o,h){if(o===0)return 0;const y=o<1&&h===514?.25/o:1;return 6*Math.pow(1.5,22-g)*Math.max(o,1)*y}function I0(g,o){const h=1<<g.z;return!o&&(g.x===0||g.x===h-1)||g.y===0||g.y===h-1}const Yf=g=>({u_matrix:g});function dp(g,o,h,y,C){if(C>0){const A=i.q.now(),R=(A-g.timeAdded)/C,$=o?(A-o.timeAdded)/C:-1,Z=h.getSource(),se=y.coveringZoomLevel({tileSize:Z.tileSize,roundZoom:Z.roundZoom}),ue=!o||Math.abs(o.tileID.overscaledZ-se)>Math.abs(g.tileID.overscaledZ-se),be=ue&&g.refreshedUponExpiration?1:i.ay(ue?R:1-$,0,1);return g.refreshedUponExpiration&&R>=1&&(g.refreshedUponExpiration=!1),o?{opacity:1,mix:1-be}:{opacity:be,mix:0}}return{opacity:1,mix:0}}class zy extends Bs{constructor(o){const h={type:"raster-dem",maxzoom:o.transform.maxZoom},y=new i.D(i.c$(),null),C=Sc("mock-dem",h,y,o.style);super("mock-dem",C,!1),C.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class Oc extends Bs{constructor(o){const h=Sc("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new i.D(i.c$(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,y){if(o.freezeTileCoverage)return;this.transform=o;const C=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,R)=>{if(A[R.key]="",!this._tiles[R.key]){const $=new Ys(R,this._source.tileSize*R.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);$.state="loaded",this._tiles[R.key]=$}return A},{});for(const A in this._tiles)A in C||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(o){const h=this.proxyCachedFBO[o];if(h!==void 0){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zu extends i.aM{constructor(o,h,y){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class vg extends i.dt{constructor(o,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,C,A]=function(Z){const se=new i.ba,ue=new i.a_,be=131;se.reserve(17161),ue.reserve(33800);const ge=i.aj/128,Ce=i.aj+ge/2,$e=Ce+ge;for(let We=-64;We<$e;We+=ge)for(let Xe=-64;Xe<$e;Xe+=ge){const et=Xe<0||Xe>Ce||We<0||We>Ce?24575:0,_t=i.ay(Math.round(Xe),0,i.aj),Ct=i.ay(Math.round(We),0,i.aj);se.emplaceBack(_t+et,Ct)}const Ne=(We,Xe)=>{const et=Xe*be+We;ue.emplaceBack(et+1,et,et+be),ue.emplaceBack(et+be,et+be+1,et+1)};for(let We=1;We<129;We++)for(let Xe=1;Xe<129;Xe++)Ne(Xe,We);return[0,129].forEach(We=>{for(let Xe=0;Xe<130;Xe++)Ne(Xe,We),Ne(We,Xe)}),[se,ue,32768]}(),R=o.context;this.gridBuffer=R.createVertexBuffer(y,i.bc.members),this.gridIndexBuffer=R.createIndexBuffer(C),this.gridSegments=i.bd.simpleSegment(0,0,y.length,C.length),this.gridNoSkirtSegments=i.bd.simpleSegment(0,0,y.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Oc(h.map),this.orthoMatrix=i.bz(),i.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.aj,0,i.aj,0,1);const $=R.gl;this._overlapStencilMode=new sr({func:$.GEQUAL,mask:255},0,255,$.KEEP,$.KEEP,$.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new zy(h.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,h,y){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const C=o.terrain.properties,A=o.terrain.drapeRenderMode===0,R=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const $=o.terrain&&o.terrain.scope,Z=C.get("source"),se=A?this._mockSourceCache:o.getSourceCache(Z,$);if(!se)return void i.w(`Couldn't find terrain source "${Z}".`);if(this.sourceCache=se,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=R?this.calculateExaggeration(h):C.get("exaggeration"),!h.projection.requiresDraping&&R&&this._exaggeration===0)return void this._disable();this.enabled=!0;const ue=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const be=this.getScaledDemTileSize();this.sourceCache.update(h,be,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ue(),this._initializing=!0),ue(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const h=this._previousCameraAltitude,y=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=y;const C=h!=null?y-h:Number.MAX_VALUE;if(Math.abs(C)<2)return this._exaggeration;const A=o.zoom,R=this._style.terrain;if(!this._previousUpdateTimestamp)return R.getExaggeration(A);let $=A-this._previousZoom;const Z=this._previousUpdateTimestamp;let se=A;this._evaluationZoom!=null&&(se=this._evaluationZoom,Math.abs(A-se)>.5&&($=.5*(A-se+$)),$*C<0&&(se+=$)),this._evaluationZoom=se;const ue=R.getExaggeration(se),be=ue===R.getExaggeration(Math.max(0,se-.1));if(be&&Math.abs(ue-this._exaggeration)<.01)return ue;let ge=Math.min(.1,.00375*(this._updateTimestamp-Z));return(be||ue<.1||Math.abs($)<1e-4)&&(ge=Math.min(.2,4*ge)),i.ai(this._exaggeration,ue,ge)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const C=this.proxyCoords=h.getIds().map(Z=>{const se=h.getTileByID(Z).tileID;return se.projMatrix=y.calculateProjMatrix(se.toUnwrapped()),se});(function(Z,se){const ue=se.transform.pointCoordinate(se.transform.getCameraPoint()),be=new i.P(ue.x,ue.y);Z.sort((ge,Ce)=>{if(Ce.overscaledZ-ge.overscaledZ)return Ce.overscaledZ-ge.overscaledZ;const $e=new i.P(ge.canonical.x+(1<<ge.canonical.z)*ge.wrap,ge.canonical.y),Ne=new i.P(Ce.canonical.x+(1<<Ce.canonical.z)*Ce.wrap,Ce.canonical.y),We=be.mult(1<<ge.canonical.z);return We.x-=.5,We.y-=.5,We.distSqr($e)-We.distSqr(Ne)})})(C,this.painter);const A=this.proxyToSource||{};this.proxyToSource={},C.forEach(Z=>{this.proxyToSource[Z.key]={}}),this.terrainTileForTile={};const R=this._style._mergedSourceCaches;for(const Z in R){const se=R[Z];if(!se.used||(se!==this.sourceCache&&this.resetTileLookupCache(se.id),this._setupProxiedCoordsForOrtho(se,o[Z],A),se.usedForTerrain))continue;const ue=o[Z];se.getSource().reparseOverscaled&&this._assignTerrainTiles(ue)}this.proxiedCoords[h.id]=C.map(Z=>new Zu(Z,Z.key,this.orthoMatrix)),this._assignTerrainTiles(C),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1;const $={};this._visibleDemTiles=[];for(const Z of this.proxyCoords){const se=this.terrainTileForTile[Z.key];if(!se)continue;const ue=se.tileID.key;ue in $||(this._visibleDemTiles.push(se),$[ue]=ue)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const y in this.terrainTileForTile){const C=this.terrainTileForTile[y],A=C.dem;!A||C.demTexture&&!C.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),cf(this.painter,C,A))}}_prepareDemTileUniforms(o,h,y,C){if(!h||h.demTexture==null)return!1;const A=o.tileID.canonical,R=Math.pow(2,h.tileID.canonical.z-A.z),$=C||"";return y[`u_dem_tl${$}`]=[A.x*R%1,A.y*R%1],y[`u_dem_scale${$}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const h=this._visibleDemTiles.reduce((y,C)=>{if(!C.dem)return y;const A=C.dem.tree.minimums[0];return A>0&&o++,y+A},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),C=new i.du({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(C,{premultiply:!1}):A=this._emptyDEMTexture=new i.T(o,C,h.R32F,{premultiply:!1}),A}setupElevationDraw(o,h,y){const C=this.painter.context,A=C.gl,R={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};R.u_exaggeration=this.exaggeration();let $=null,Z=null,se=1;if(y&&y.morphing&&this._useVertexMorphing){const Ce=y.morphing.srcDemTile,$e=y.morphing.dstDemTile;se=y.morphing.phase,Ce&&$e&&(this._prepareDemTileUniforms(o,Ce,R,"_prev")&&(Z=Ce),this._prepareDemTileUniforms(o,$e,R)&&($=$e))}const ue=Ce=>Ce&&Ce.demTexture&&this.painter.linearFloatFilteringSupported()?A.LINEAR:A.NEAREST;let be=null;var ge;if(this.enabled?Z&&$?(be=$.demTexture,C.activeTexture.set(A.TEXTURE4),Z.demTexture.bind(ue(Z),A.CLAMP_TO_EDGE),R.u_dem_lerp=se):($=this.terrainTileForTile[o.tileID.key],be=this._prepareDemTileUniforms(o,$,R)?$.demTexture:this.emptyDEMTexture):be=this.emptyDEMTexture,C.activeTexture.set(A.TEXTURE2),be&&(R.u_dem_size=(ge=be).size[0]===1?1:ge.size[0]-2,be.bind(ue($),A.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,h,R),y&&y.useMeterToDem&&$){const Ce=(1<<$.tileID.canonical.z)*i.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=Ce}if(y&&y.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(C,R),this.painter.transform.projection.name==="globe"){const Ce=this.globeUniformValues(this.painter.transform,o.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(C,Ce)}}globeUniformValues(o,h,y){const C=o.projection;return{u_tile_tl_up:C.upVector(h,0,0),u_tile_tr_up:C.upVector(h,i.aj,0),u_tile_br_up:C.upVector(h,i.aj,i.aj),u_tile_bl_up:C.upVector(h,0,i.aj),u_tile_up_scale:y?i.dv(1):C.upVectorScale(h,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const h=this.painter,y=this.painter.context;o.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(C,A,R,$,Z){if(C.transform.projection.name==="globe")(function(se,ue,be,ge,Ce){const $e=se.context,Ne=$e.gl;let We,Xe;const et=se.transform,_t=i.dl(se,$e,et),Ct=(Ki,Ji)=>{if(Xe===Ji)return;const Er=[Fp[Ji],"PROJECTION_GLOBE_VIEW"];_t&&Er.push("CUSTOM_ANTIALIASING");const Ti=se.isTileAffectedByFog(Ki);We=se.getOrCreateProgram("globeRaster",{defines:Er,overrideFog:Ti}),Xe=Ji},jt=se.colorModeForRenderPass(),Ft=new Gt(Ne.LEQUAL,Gt.ReadWrite,se.depthRangeFor3D);pf.update(Ce);const Rt=i.dm(et),Et=[i.aD(et.center.lng),i.aH(et.center.lat)],Wt=se.globeSharedBuffers,qt=[et.width*i.q.devicePixelRatio,et.height*i.q.devicePixelRatio],Ei=Float32Array.from(et.globeMatrix),Mi={useDenormalizedUpVectorScale:!0};{const Ki=se.transform,Ji=ey(Ki.zoom,ue.exaggeration(),ue.sourceCache._source.tileSize);Xe=-1;const Er=Ne.TRIANGLES;for(const Ti of ge){const $i=be.getTile(Ti),li=sr.disabled,dr=ue.prevTerrainTileForTile[Ti.key],Ni=ue.terrainTileForTile[Ti.key];Jg(dr,Ni)&&pf.newMorphing(Ti.key,dr,Ni,Ce,250),$e.activeTexture.set(Ne.TEXTURE0),$i.texture&&$i.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);const vr=pf.getMorphValuesForProxy(Ti.key),Nr=vr?1:0;vr&&i.L(Mi,{morphing:{srcDemTile:vr.from,dstDemTile:vr.to,phase:i.dk(vr.phase)}});const ar=i.dn(Ti.canonical),Br=i.dp(ar.getCenter().lat),dn=i.dq(Ti.canonical,ar,Br,Ki.worldSize/Ki._pixelsPerMercatorPixel),pn=i.bh(i.dr(Ti.canonical)),on=Xu(Ki.expandedFarZProjMatrix,Ei,Rt,pn,i.ah(Ki.zoom),Et,Ki.frustumCorners.TL,Ki.frustumCorners.TR,Ki.frustumCorners.BR,Ki.frustumCorners.BL,Ki.globeCenterInViewSpace,Ki.globeRadius,qt,Ji,Ki._farZ,dn);if(Ct(Ti,Nr),We&&(ue.setupElevationDraw($i,We,Mi),se.uploadCommonUniforms($e,We,Ti.toUnwrapped()),Wt)){const[bn,An,Vn]=Wt.getGridBuffers(Br,Ji!==0);We.draw(se,Er,Ft,li,jt,hi.backCCW,on,"globe_raster",bn,An,Vn)}}}if(Wt&&(se.renderDefaultNorthPole||se.renderDefaultSouthPole)){const Ki=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_t&&Ki.push("CUSTOM_ANTIALIASING"),We=se.getOrCreateProgram("globeRaster",{defines:Ki});for(const Ji of ge){const{x:Er,y:Ti,z:$i}=Ji.canonical,li=Ti===0,dr=Ti===(1<<$i)-1,[Ni,vr,Nr,ar]=Wt.getPoleBuffers($i,!1);if(ar&&(li||dr)){const Br=be.getTile(Ji);$e.activeTexture.set(Ne.TEXTURE0),Br.texture&&Br.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);let dn=i.ds($i,Er,et);const pn=i.bh(i.dr(Ji.canonical)),on=(bn,An)=>bn.draw(se,Ne.TRIANGLES,Ft,sr.disabled,jt,hi.disabled,Xu(et.expandedFarZProjMatrix,dn,dn,pn,0,Et,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,qt,0,et._farZ),"globe_pole_raster",An,Nr,ar);ue.setupElevationDraw(Br,We,Mi),se.uploadCommonUniforms($e,We,Ji.toUnwrapped()),li&&se.renderDefaultNorthPole&&on(We,Ni),dr&&se.renderDefaultSouthPole&&(dn=i.cE(i.bz(),dn,[1,-1,1]),on(We,vr))}}}})(C,A,R,$,Z);else{const se=C.context,ue=se.gl;let be,ge;const Ce=C.shadowRenderer,$e=Jo(C,C.longestCutoffRange),Ne=jt=>{if(ge===jt)return;const Ft=[];Ft.push(Fp[jt]),$e.shouldRenderCutoff&&Ft.push("RENDER_CUTOFF"),Ce&&(Ft.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ce.useNormalOffset&&Ft.push("NORMAL_OFFSET")),be=C.getOrCreateProgram("terrainRaster",{defines:Ft}),ge=jt},We=C.colorModeForRenderPass(),Xe=new Gt(ue.LEQUAL,Gt.ReadWrite,C.depthRangeFor3D);pf.update(Z);const et=C.transform,_t=ey(et.zoom,A.exaggeration(),A.sourceCache._source.tileSize);let Ct=[0,0,0];if(Ce){const jt=C.style.directionalLight,Ft=C.style.ambientLight;jt&&Ft&&(Ct=Vl(C.style,jt,Ft))}{ge=-1;const jt=ue.TRIANGLES,[Ft,Rt]=[A.gridIndexBuffer,A.gridSegments];for(const Et of $){const Wt=R.getTile(Et),qt=sr.disabled,Ei=A.prevTerrainTileForTile[Et.key],Mi=A.terrainTileForTile[Et.key];Jg(Ei,Mi)&&pf.newMorphing(Et.key,Ei,Mi,Z,250),se.activeTexture.set(ue.TEXTURE0),Wt.texture&&Wt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ki=pf.getMorphValuesForProxy(Et.key),Ji=Ki?1:0;let Er;Ki&&(Er={morphing:{srcDemTile:Ki.from,dstDemTile:Ki.to,phase:i.dk(Ki.phase)}});const Ti=wa(Et.projMatrix,I0(Et.canonical,et.renderWorldCopies)?_t/10:_t,Ct);if(Ne(Ji),!be)continue;A.setupElevationDraw(Wt,be,Er);const $i=Et.toUnwrapped();Ce&&Ce.setupShadows($i,be),C.uploadCommonUniforms(se,be,$i,null,$e),be.draw(C,jt,Xe,qt,We,hi.backCCW,Ti,"terrain_raster",A.gridBuffer,Ft,Rt)}}}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,C=this.proxySourceCache,A=this.proxiedCoords[C.id],R=this._drapedRenderBatches.shift(),$=h.style.order,Z=[];let se=0;for(const ue of A){const be=C.getTileByID(ue.proxyTileKey),ge=C.proxyCachedFBO[ue.key]?C.proxyCachedFBO[ue.key][o]:void 0,Ce=ge!==void 0?C.renderCache[ge]:this.pool[se++],$e=ge!==void 0;if(be.texture=Ce.tex,$e&&!Ce.dirty){Z.push(be.tileID);continue}let Ne;y.bindFramebuffer.set(Ce.fb.framebuffer),this.renderedToTile=!1,Ce.dirty&&(y.clear({color:i.am.transparent,stencil:0}),Ce.dirty=!1);for(let We=R.start;We<=R.end;++We){const Xe=h.style._mergedLayers[$[We]];if(Xe.isHidden(h.transform.zoom))continue;const et=h.style.getLayerSourceCache(Xe),_t=et?this.proxyToSource[ue.key][et.id]:[ue];if(!_t)continue;const Ct=_t;y.viewport.set([0,0,Ce.fb.width,Ce.fb.height]),Ne!==(et?et.id:null)&&(this._setupStencil(Ce,_t,Xe,et),Ne=et?et.id:null),h.renderLayer(h,et,Xe,Ct)}if(this._drapedRenderBatches.length===0)for(const We of this._pendingGroundEffectLayers){const Xe=h.style._mergedLayers[$[We]];if(Xe.isHidden(h.transform.zoom))continue;const et=h.style.getLayerSourceCache(Xe),_t=et?this.proxyToSource[ue.key][et.id]:[ue];if(!_t)continue;const Ct=_t;y.viewport.set([0,0,Ce.fb.width,Ce.fb.height]),Ne!==(et?et.id:null)&&(this._setupStencil(Ce,_t,Xe,et),Ne=et?et.id:null),h.renderLayer(h,et,Xe,Ct)}this.renderedToTile?(Ce.dirty=!0,Z.push(be.tileID)):$e||--se,se===5&&(se=0,this.renderToBackBuffer(Z))}return this.renderToBackBuffer(Z),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),R.end+1}postRender(){}isLayerOrderingCorrect(o){const h=o.order.length;let y=-1,C=h;for(let A=0;A<h;++A)this._style.isLayerDraped(o._mergedLayers[o.order[A]])?y=Math.max(y,A):C=Math.min(C,A);return C>y}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,y){if(!this._visibleDemTiles)return null;const C=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const R=A.tileID,$=1<<R.overscaledZ,{x:Z,y:se}=R.canonical,ue=Z/$,be=(Z+1)/$,ge=se/$,Ce=(se+1)/$;return{minx:ue,miny:ge,maxx:be,maxy:Ce,t:A.dem.tree.raycastRoot(ue,ge,be,Ce,o,h,y),tile:A}});C.sort((A,R)=>(A.t!==null?A.t:Number.MAX_VALUE)-(R.t!==null?R.t:Number.MAX_VALUE));for(const A of C){if(A.t==null)return null;const R=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,o,h,y);if(R!=null)return R}return null}_createFBO(){const o=this.painter.context,h=o.gl,y=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const C=new i.T(o,{width:y[0],height:y[1],data:null},h.RGBA8);C.bind(h.LINEAR,h.CLAMP_TO_EDGE);const A=o.createFramebuffer(y[0],y[1],!0,null);return A.colorAttachment.set(C.texture),A.depthAttachment=new Su(o,A.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:A,tex:C,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._mergedLayers[o],y=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const y of this._style.getSources())if(y instanceof Ps){o=!0;break}if(!o)return;const h={};for(let y=0;y<this._style.order.length;++y){const C=this._style._mergedLayers[this._style.order[y]],A=this._style.getLayerSourceCache(C);if(A&&!h[A.id]&&!C.isHidden(this.painter.transform.zoom)&&C.type==="line"&&C.widthExpression()instanceof i.ab){h[A.id]=!0;for(const R of this.proxyCoords){const $=this.proxyToSource[R.key][A.id];if($)for(const Z of $)this._clearRenderCacheForTile(A.id,Z)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof vs){o=!0;break}if(!o)return;const h={};for(let y=0;y<this._style.order.length;++y){const C=this._style._mergedLayers[this._style.order[y]],A=this._style.getLayerSourceCache(C);if(!A||h[A.id]||C.isHidden(this.painter.transform.zoom)||C.type!=="raster")continue;const R=C.paint.get("raster-fade-duration");for(const $ of this.proxyCoords){const Z=this.proxyToSource[$.key][A.id];if(Z)for(const se of Z){const ue=dp(A.getTile(se),A.findLoadedParent(se,0),A,this.painter.transform,R);(ue.opacity!==1||ue.mix!==0)&&this._clearRenderCacheForTile(A.id,se)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,h=o.length;if(h===0)return;const y=[];this._pendingGroundEffectLayers=[];let C,A=0,R=this._style._mergedLayers[o[A]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++A<h;)R=this._style._mergedLayers[o[A]];for(;A<h;++A){const $=this._style._mergedLayers[o[A]];$.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped($)?C===void 0&&(C=A):($.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(A),C!==void 0&&(y.push({start:C,end:A-1}),C=void 0)))}if(C!==void 0&&y.push({start:C,end:A-1}),y.length!==0){const $=y[y.length-1];this._pendingGroundEffectLayers.every(Z=>Z>$.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const R=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let $=0;$<R.length;++$){const Z=Object.values(R[$]);h.renderCachePool.push(...Z)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,C=this._tilesDirty;for(let R=y.length-1;R>=0;R--){const $=y[R];if(h.getTileByID($.key),h.proxyCachedFBO[$.key]!==void 0){const Z=o[$.key],se=this.proxyToSource[$.key];let ue=0;for(const be in se){const ge=se[be],Ce=Z[be];if(!Ce||Ce.length!==ge.length||ge.some(($e,Ne)=>$e!==Ce[Ne]||C[be]&&C[be].hasOwnProperty($e.key))){ue=-1;break}++ue}for(const be in h.proxyCachedFBO[$.key])h.renderCache[h.proxyCachedFBO[$.key][be]].dirty=ue<0||ue!==Object.values(Z).length}}const A=[...this._drapedRenderBatches];A.sort((R,$)=>$.end-$.start-(R.end-R.start));for(const R of A)for(const $ of y){if(h.proxyCachedFBO[$.key])continue;let Z=h.renderCachePool.pop();Z===void 0&&h.renderCache.length<50&&(Z=h.renderCache.length,h.renderCache.push(this._createFBO())),Z!==void 0&&(h.proxyCachedFBO[$.key]={},h.proxyCachedFBO[$.key][R.start]=Z,h.renderCache[Z].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,y,C){if(!C||!this._sourceTilesOverlap[C.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,R=A.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let $;if(y.isTileClipped())$=h.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);$=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+$>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=$,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):sr.disabled}_renderTileClippingMasks(o,h){const y=this.painter,C=this.painter.context,A=C.gl;y._tileClippingMaskIDs={},C.setColorMode(Bi.disabled),C.setDepthMode(Gt.disabled);const R=y.getOrCreateProgram("clippingMask");for(const $ of o){const Z=y._tileClippingMaskIDs[$.key]=--h;R.draw(y,A.TRIANGLES,Gt.disabled,new sr({func:A.ALWAYS,mask:0},Z,255,A.KEEP,A.KEEP,A.REPLACE),Bi.disabled,hi.disabled,Yf($.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const y=[o.x,o.y,1,1];i.aA(y,y,h.pixelMatrixInverse),i.cw(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const C=h._camera.position,A=i.c6(1,h.center.lat),R=[C[0],C[1],C[2]/A,0],$=i.cX([],y.slice(0,3),R);i.au($,$);const Z=this.raycast(R,$,this._exaggeration);return Z!==null&&Z?(i.bE(R,R,$,Z),R[3]=R[2],R[2]*=A,R):null}_setupProxiedCoordsForOrtho(o,h,y){if(o.getSource()instanceof i.aP)return this._setupProxiedCoordsForImageSource(o,h,y);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const C=this.proxiedCoords[o.id]=[],A=this.proxyCoords;for(let Z=0;Z<A.length;Z++){const se=A[Z],ue=this._findTileCoveringTileID(se,o);if(ue){const be=this._createProxiedId(se,ue,y[se.key]&&y[se.key][o.id]);C.push(be),this.proxyToSource[se.key][o.id]=[be]}}let R=!1;const $=new Set;for(let Z=0;Z<h.length;Z++){const se=o.getTile(h[Z]);if(!se||!se.hasData())continue;const ue=this._findTileCoveringTileID(se.tileID,this.proxySourceCache);if(ue&&ue.tileID.canonical.z!==se.tileID.canonical.z){const be=this.proxyToSource[ue.tileID.key][o.id],ge=this._createProxiedId(ue.tileID,se,y[ue.tileID.key]&&y[ue.tileID.key][o.id]);be?be.splice(be.length-1,0,ge):this.proxyToSource[ue.tileID.key][o.id]=[ge];const Ce=this.proxyToSource[ue.tileID.key][o.id];$.has(Ce)||$.add(Ce),C.push(ge),R=!0}}if(this._sourceTilesOverlap[o.id]=R,R&&this._debugParams.sortTilesHiZFirst)for(const Z of $)Z.sort((se,ue)=>ue.overscaledZ-se.overscaledZ)}_setupProxiedCoordsForImageSource(o,h,y){if(!o.getSource().loaded())return;const C=this.proxiedCoords[o.id]=[],A=this.proxyCoords,R=o.getSource(),$=R.tileID;if(!$)return;const Z=new i.P($.x,$.y)._div(1<<$.z),se=R.coordinates.map(i.ac.fromLngLat).reduce((be,ge)=>(be.min.x=Math.min(be.min.x,ge.x-Z.x),be.min.y=Math.min(be.min.y,ge.y-Z.y),be.max.x=Math.max(be.max.x,ge.x-Z.x),be.max.y=Math.max(be.max.y,ge.y-Z.y),be),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ue=(be,ge)=>{const Ce=be.wrap+be.canonical.x/(1<<be.canonical.z),$e=be.canonical.y/(1<<be.canonical.z),Ne=i.aj/(1<<be.canonical.z),We=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Xe=ge.canonical.y/(1<<ge.canonical.z);return Ce+Ne<We+se.min.x||Ce>We+se.max.x||$e+Ne<Xe+se.min.y||$e>Xe+se.max.y};for(let be=0;be<A.length;be++){const ge=A[be];for(let Ce=0;Ce<h.length;Ce++){const $e=o.getTile(h[Ce]);if(!$e||!$e.hasData()||ue(ge,$e.tileID))continue;const Ne=this._createProxiedId(ge,$e,y[ge.key]&&y[ge.key][o.id]),We=this.proxyToSource[ge.key][o.id];We?We.push(Ne):this.proxyToSource[ge.key][o.id]=[Ne],C.push(Ne)}}}_createProxiedId(o,h,y){let C=this.orthoMatrix;if(y){const A=y.find(R=>R.key===h.tileID.key);if(A)return A}if(h.tileID.key!==o.key){const A=o.canonical.z-h.tileID.canonical.z;let R,$,Z;C=i.bz();const se=h.tileID.wrap-o.wrap<<o.overscaledZ;A>0?(R=i.aj>>A,$=R*((h.tileID.canonical.x<<A)-o.canonical.x+se),Z=R*((h.tileID.canonical.y<<A)-o.canonical.y)):(R=i.aj<<-A,$=i.aj*(h.tileID.canonical.x-(o.canonical.x+se<<-A)),Z=i.aj*(h.tileID.canonical.y-(o.canonical.y<<-A))),i.c5(C,0,R,0,R,0,1),i.bo(C,C,[$,Z,0])}return new Zu(h.tileID,o.key,C)}_findTileCoveringTileID(o,h){let y=h.getTile(o);if(y&&y.hasData())return y;const C=this._findCoveringTileCache[h.id],A=C[o.key];if(y=A?h.getTileByID(A):null,y&&y.hasData()||A===null)return y;let R=y?y.tileID:o,$=R.overscaledZ;const Z=h.getSource().minzoom,se=[];if(!A){const be=h.getSource().maxzoom;if(o.canonical.z>=be){const ge=o.canonical.z-be;h.getSource().reparseOverscaled?($=Math.max(o.canonical.z+2,h.transform.tileZoom),R=new i.aM($,o.wrap,be,o.canonical.x>>ge,o.canonical.y>>ge)):ge!==0&&($=be,R=new i.aM($,o.wrap,be,o.canonical.x>>ge,o.canonical.y>>ge))}R.key!==o.key&&(se.push(R.key),y=h.getTile(R))}const ue=be=>{se.forEach(ge=>{C[ge]=be}),se.length=0};for($-=1;$>=Z&&(!y||!y.hasData());$--){y&&ue(y.tileID.key);const be=R.calculateScaledKey($);if(y=h.getTileByID(be),y&&y.hasData())break;const ge=C[be];if(ge===null)break;ge===void 0?se.push(be):y=h.getTileByID(ge)}return ue(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let y=this._tilesDirty[o];y||(y=this._tilesDirty[o]={}),y[h.key]=!0}}function xg(g,o,h){const y=function($,Z,se){const ue=i.bG(Z,$),be=i.bG(se,[.2126,.7152,.0722]),ge=($e,Ne,We)=>(1-We)*$e+We*Ne,Ce=ge(1-.3*Math.min(be,1),1,Math.min(ue+1,1));return ge(.92,1,Math.asin(i.ay(Z[2],-1,1))/Math.PI+.5)*Ce}(g,[0,0,1],o),C=[0,0,0];i.bY(C,h.slice(0,3),y);const A=[0,0,0];i.bY(A,o.slice(0,3),g[2]);const R=[0,0,0];return i.cV(R,C,A),i.cY(R)}const Uy=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ty=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Sd{static cacheKey(o,h,y,C){let A=`${h}${C?C.cacheKey:""}`;for(const R of y)o.usedDefines.includes(R)&&(A+=`/${R}`);return A}constructor(o,h,y,C,A,R){const $=o.gl;this.program=$.createProgram(),this.configuration=C,this.name=h,this.fixedDefines=[...R];const Z=C?C.getBinderAttributes():[],se=(y.staticAttributes||[]).concat(Z);let ue=C?C.defines():[];ue=ue.concat(R.map(We=>`#define ${We}`));const be=`#version 300 es
`;let ge=be+ue.concat("precision mediump float;",Qc,dc.fragmentSource).join(`
`);for(const We of y.fragmentIncludes)ge+=`
${Kc[We]}`;ge+=`
${y.fragmentSource}`;let Ce=be+ue.concat("precision highp float;",Qc,dc.vertexSource).join(`
`);for(const We of y.vertexIncludes)Ce+=`
${Kc[We]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&y.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Ce+=`
uniform int u_instanceID;
`),Ce+=`
${y.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Ce=Ce.replaceAll("gl_InstanceID","u_instanceID"));const $e=$.createShader($.FRAGMENT_SHADER);if($.isContextLost())return void(this.failedToCreate=!0);$.shaderSource($e,ge),$.compileShader($e),$.attachShader(this.program,$e);const Ne=$.createShader($.VERTEX_SHADER);if($.isContextLost())this.failedToCreate=!0;else{$.shaderSource(Ne,Ce),$.compileShader(Ne),$.attachShader(this.program,Ne),this.attributes={},this.numAttributes=se.length;for(let We=0;We<this.numAttributes;We++)if(se[We]){const Xe=se[We].startsWith("a_")?se[We]:`a_${se[We]}`;$.bindAttribLocation(this.program,We,Xe),this.attributes[Xe]=We}$.linkProgram(this.program),$.deleteShader(Ne),$.deleteShader($e),this.fixedUniforms=A(o),this.binderUniforms=C?C.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(We=>({u_instanceID:new i.c8(We)}))(o)),(R.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(We=>({u_dem:new i.c8(We),u_dem_prev:new i.c8(We),u_dem_tl:new i.cb(We),u_dem_scale:new i.ca(We),u_dem_tl_prev:new i.cb(We),u_dem_scale_prev:new i.ca(We),u_dem_size:new i.ca(We),u_dem_lerp:new i.ca(We),u_exaggeration:new i.ca(We),u_depth:new i.c8(We),u_depth_size_inv:new i.cb(We),u_depth_range_unpack:new i.cb(We),u_occluder_half_size:new i.ca(We),u_occlusion_depth_offset:new i.ca(We),u_meter_to_dem:new i.ca(We),u_label_plane_matrix_inv:new i.cc(We)}))(o)),R.includes("GLOBE")&&(this.globeUniforms=(We=>({u_tile_tl_up:new i.c9(We),u_tile_tr_up:new i.c9(We),u_tile_br_up:new i.c9(We),u_tile_bl_up:new i.c9(We),u_tile_up_scale:new i.ca(We)}))(o)),R.includes("FOG")&&(this.fogUniforms=(We=>({u_fog_matrix:new i.cc(We),u_fog_range:new i.cb(We),u_fog_color:new i.cQ(We),u_fog_horizon_blend:new i.ca(We),u_fog_vertical_limit:new i.cb(We),u_fog_temporal_offset:new i.ca(We),u_frustum_tl:new i.c9(We),u_frustum_tr:new i.c9(We),u_frustum_br:new i.c9(We),u_frustum_bl:new i.c9(We),u_globe_pos:new i.c9(We),u_globe_radius:new i.ca(We),u_globe_transition:new i.ca(We),u_is_globe:new i.c8(We),u_viewport:new i.cb(We)}))(o)),R.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(We=>({u_cutoff_params:new i.cQ(We)}))(o)),R.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(We=>({u_lighting_ambient_color:new i.c9(We),u_lighting_directional_dir:new i.c9(We),u_lighting_directional_color:new i.c9(We),u_ground_radiance:new i.c9(We)}))(o)),R.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(We=>({u_light_matrix_0:new i.cc(We),u_light_matrix_1:new i.cc(We),u_fade_range:new i.cb(We),u_shadow_normal_offset:new i.c9(We),u_shadow_intensity:new i.ca(We),u_shadow_texel_size:new i.ca(We),u_shadow_map_resolution:new i.ca(We),u_shadow_direction:new i.c9(We),u_shadow_bias:new i.c9(We),u_shadowmap_0:new i.c8(We),u_shadowmap_1:new i.c8(We)}))(o))}}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const C in h)y[C]&&y[C].set(this.program,C,h[C])}}setGlobeUniformValues(o,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const C in h)y[C]&&y[C].set(this.program,C,h[C])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const C in h)y[C].set(this.program,C,h[C])}}setCutoffUniformValues(o,h){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const C in h)y[C].set(this.program,C,h[C])}}setLightsUniformValues(o,h){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const C in h)y[C].set(this.program,C,h[C])}}setShadowUniformValues(o,h){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;o.program.set(this.program);for(const C in h)y[C].set(this.program,C,h[C])}_drawDebugWireframe(o,h,y,C,A,R,$,Z,se,ue){const be=o.options.wireframe;if(be.terrain===!1&&be.layers2D===!1&&be.layers3D===!1)return;const ge=o.context;if(!(()=>!(!be.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!be.layers2D||o._terrain&&o._terrain.renderingToTexture||!Uy.includes(this.name))||!(!be.layers3D||!ty.includes(this.name)))())return;const Ce=ge.gl,$e=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,A,ge);if(!$e)return;const Ne=[...this.fixedDefines];Ne.push("DEBUG_WIREFRAME");const We=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Ne});ge.program.set(We.program);const Xe=(Ct,jt,Ft)=>{if(jt[Ct]&&Ft[Ct])for(const Rt in jt[Ct])Ft[Ct][Rt]&&Ft[Ct][Rt].set(Ft.program,Rt,jt[Ct][Rt].current)};se&&se.setUniforms(We.program,ge,We.binderUniforms,$,{zoom:Z}),Xe("fixedUniforms",this,We),Xe("terrainUniforms",this,We),Xe("globeUniforms",this,We),Xe("fogUniforms",this,We),Xe("lightsUniforms",this,We),Xe("shadowUniforms",this,We),$e.bind(),ge.setColorMode(new Bi([Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ZERO,Ce.ONE],i.am.transparent,[!0,!0,!0,!1])),ge.setDepthMode(new Gt(h.func===Ce.LESS?Ce.LEQUAL:h.func,Gt.ReadOnly,h.range)),ge.setStencilMode(sr.disabled);const et=3*R.primitiveLength*2,_t=3*R.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ct=ue||1;for(let jt=0;jt<Ct;++jt)We.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",jt),Ce.drawElements(Ce.LINES,et,Ce.UNSIGNED_SHORT,_t)}else ue&&ue>1?Ce.drawElementsInstanced(Ce.LINES,et,Ce.UNSIGNED_SHORT,_t,ue):Ce.drawElements(Ce.LINES,et,Ce.UNSIGNED_SHORT,_t);A.bind(),ge.program.set(this.program),ge.setDepthMode(h),ge.setStencilMode(y),ge.setColorMode(C)}checkUniforms(o,h,y){if(this.fixedDefines.includes(h)){for(const C of Object.keys(y))if(!y[C].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${C} not set but required by ${h} being defined`)}}draw(o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We){const Xe=o.context,et=Xe.gl;if(this.failedToCreate)return;Xe.program.set(this.program),Xe.setDepthMode(y),Xe.setStencilMode(C),Xe.setColorMode(A),Xe.setCullFace(R);for(const jt of Object.keys(this.fixedUniforms))this.fixedUniforms[jt].set(this.program,jt,$[jt]);$e&&$e.setUniforms(this.program,Xe,this.binderUniforms,ge,{zoom:Ce});const _t={[et.POINTS]:1,[et.LINES]:2,[et.TRIANGLES]:3,[et.LINE_STRIP]:1}[h];this.checkUniforms(Z,"RENDER_SHADOWS",this.shadowUniforms);const Ct=We&&We>0?1:void 0;for(const jt of be.get()){const Ft=jt.vaos||(jt.vaos={});if((Ft[Z]||(Ft[Z]=new qu)).bind(Xe,this,se,$e?$e.getPaintVertexBuffers():[],ue,jt.vertexOffset,Ne||[],Ct),this.forceManualRenderingForInstanceIDShaders){const Rt=We||1;for(let Et=0;Et<Rt;++Et)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Et),ue?et.drawElements(h,jt.primitiveLength*_t,et.UNSIGNED_SHORT,jt.primitiveOffset*_t*2):et.drawArrays(h,jt.vertexOffset,jt.vertexLength)}else We&&We>1?et.drawElementsInstanced(h,jt.primitiveLength*_t,et.UNSIGNED_SHORT,jt.primitiveOffset*_t*2,We):ue?et.drawElements(h,jt.primitiveLength*_t,et.UNSIGNED_SHORT,jt.primitiveOffset*_t*2):et.drawArrays(h,jt.vertexOffset,jt.vertexLength);h===et.TRIANGLES&&ue&&this._drawDebugWireframe(o,y,C,A,ue,jt,ge,Ce,$e,We)}}}function pp(g,o,h=0){const y=Math.pow(2,o.tileID.overscaledZ),C=o.tileSize*Math.pow(2,g.transform.tileZoom)/y,A=C*(o.tileID.canonical.x+o.tileID.wrap*y),R=C*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.aw(o,1,g.transform.tileZoom),u_pixel_coord_upper:[A>>16,R>>16],u_pixel_coord_lower:[65535&A,65535&R],u_pattern_transition:h}}const fp={terrain:0,flat:1},$y=i.bz(),km=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe)=>{const et=o.style.light,_t=et.properties.get("position"),Ct=[_t.x,_t.y,_t.z],jt=i.dx();et.properties.get("anchor")==="viewport"&&(i.dy(jt,-o.transform.angle),i.dz(Ct,Ct,jt));const Ft=et.properties.get("color").toPremultipliedRenderColor(null),Rt=o.transform,Et={u_matrix:g,u_lightpos:Ct,u_lightintensity:et.properties.get("intensity"),u_lightcolor:[Ft.r,Ft.g,Ft.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$y,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:fp[se],u_base_type:fp[ue],u_ao:C,u_edge_radius:A,u_width_scale:R,u_flood_light_color:$e,u_vertical_scale:Ne,u_flood_light_intensity:We,u_ground_shadow_factor:Xe};return Rt.projection.name==="globe"&&(Et.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],Et.u_zoom_transition=be,Et.u_inv_rot_matrix=Ce,Et.u_merc_center=ge,Et.u_up_dir=Rt.projection.upVector(new i.cp(0,0,0),ge[0]*i.aj,ge[1]*i.aj),Et.u_height_lift=Z),Et},iy=(g,o,h,y,C,A)=>({u_matrix:g,u_edge_radius:o,u_width_scale:h,u_vertical_scale:y,u_height_type:fp[C],u_base_type:fp[A]}),zp=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe)=>{const et=km(g,o,h,y,C,A,R,$,se,ue,be,ge,Ce,$e,Ne,We,1,[0,0,0]),_t={u_height_factor:-Math.pow(2,$.overscaledZ)/Z.tileSize/8};return i.h(et,pp(o,Z,Xe),_t)},ff=(g,o,h)=>({u_matrix:g,u_emissive_strength:o,u_ground_shadow_factor:h}),L0=(g,o,h,y,C,A=0)=>i.h(ff(g,o,C),pp(h,y,A)),$d=(g,o,h,y)=>({u_matrix:g,u_world:h,u_emissive_strength:o,u_ground_shadow_factor:y}),Vy=(g,o,h,y,C,A,R=0)=>i.h(L0(g,o,h,y,A,R),{u_world:C}),Am=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o}),mp=(g,o,h,y,C)=>({u_matrix:g,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:h,u_height_scale:y,u_reset_depth:C}),C_=(g,o,h,y)=>{const C=i.aj/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:o.getCameraToCenterDistance(y),u_extrude_scale:[o.pixelsToGLUnits[0]/C,o.pixelsToGLUnits[1]/C]}},Mm=(g,o,h=1)=>({u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:h}),Im=i.bz(),Lm=(g,o,h,y,C,A,R)=>{const $=g.transform,Z=$.projection.name==="globe",se=Z?i.dA($.zoom,o.canonical)*$._pixelsPerMercatorPixel:i.aw(h,1,A),ue={u_matrix:o.projMatrix,u_extrude_scale:se,u_intensity:R,u_inv_rot_matrix:Im,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Z){ue.u_inv_rot_matrix=y,ue.u_merc_center=C,ue.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],ue.u_zoom_transition=i.ah($.zoom);const be=C[0]*i.aj,ge=C[1]*i.aj;ue.u_up_dir=$.projection.upVector(new i.cp(0,0,0),be,ge)}return ue};function mf(g,[o,h,y,C],[A,R]){if(A===R)return[0,0,0,0];const $=255*(g-1)/(g*(R-A));return[o*$,h*$,y*$,C*$]}function Wy(g,o,[h,y]){return h===y?0:.5/g+(o-h)*(g-1)/(g*(y-h))}const bg=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et,_t,Ct)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:C,u_tl_parent:A,u_scale_parent:se,u_fade_t:ue.mix,u_opacity:ue.opacity*be.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:be.paint.get("raster-brightness-min"),u_brightness_high:be.paint.get("raster-brightness-max"),u_saturation_factor:i.dC(be.paint.get("raster-saturation")),u_contrast_factor:i.dB(be.paint.get("raster-contrast")),u_spin_weights:gf(be.paint.get("raster-hue-rotate")),u_perspective_transform:ge,u_raster_elevation:Ce,u_zoom_transition:R,u_merc_center:$,u_cutoff_params:Z,u_colorization_mix:mf(i.dD,Ne,Xe),u_colorization_offset:Wy(i.dD,We,Xe),u_color_ramp:$e,u_texture_offset:[_t/(et+2*_t),et/(et+2*_t)],u_texture_res:[et+2*_t,et+2*_t],u_emissive_strength:Ct});function gf(g){g*=Math.PI/180;const o=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Vd=.05,Td=(g,o,h,y,C,A,R,$,Z,se,ue,be)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:C,u_tl_parent:A,u_scale_parent:se,u_fade_t:ue.mix,u_opacity:ue.opacity,u_image0:0,u_image1:1,u_raster_elevation:be,u_zoom_transition:R,u_merc_center:$,u_cutoff_params:Z}),jy=(g,o,h,y,C,A,R,$,Z,se)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_tile_offset:h,u_velocity:y,u_color_ramp:A,u_velocity_res:C,u_max_speed:R,u_uv_offset:$,u_data_scale:[255*Z[0],255*Z[1]],u_data_offset:se,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vd,Vd]}),Ku=(g,o,h,y,C,A,R,$,Z,se)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_velocity:h,u_velocity_res:y,u_max_speed:C,u_speed_factor:A,u_reset_rate:R,u_rand_seed:Math.random(),u_uv_offset:$,u_data_scale:[255*Z[0],255*Z[1]],u_data_offset:se,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vd,Vd]}),Tu=i.bz(),Up=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et,_t,Ct,jt,Ft,Rt)=>{const Et=C.transform,Wt={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Et.getCameraToCenterDistance(et),u_rotate_symbol:+h,u_aspect_ratio:Et.width/Et.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:R,u_coord_matrix:$,u_is_text:+se,u_elevation_from_sea:Z?1:0,u_pitch_with_map:+y,u_texsize:ue,u_texsize_icon:be,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Tu,u_up_vector:[0,-1,0],u_color_adj_mat:jt,u_icon_transition:Ft||0,u_gamma_scale:y?C.transform.getCameraToCenterDistance(et)*Math.cos(C.terrain?0:C.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Rt||1,u_ground_shadow_factor:_t,u_inv_matrix:i.bi(i.bz(),R),u_normal_scale:Ct};return et.name==="globe"&&(Wt.u_tile_id=[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z],Wt.u_zoom_transition=$e,Wt.u_inv_rot_matrix=We,Wt.u_merc_center=Ne,Wt.u_camera_forward=Et._camera.forward(),Wt.u_ecef_origin=i.dE(Et.globeMatrix,Ce.toUnwrapped()),Wt.u_tile_matrix=Float32Array.from(Et.globeMatrix),Wt.u_up_vector=Xe),Wt},gp=(g,o,h,y)=>({u_matrix:g,u_emissive_strength:o,u_opacity:h,u_color:y}),Cu=(g,o,h,y,C,A,R,$,Z)=>i.h(function(se,ue,be,ge,Ce,$e){const{width:Ne,height:We}=ge.imageManager.getPixelSize(ue),Xe=Math.pow(2,$e.tileID.overscaledZ),et=$e.tileSize*Math.pow(2,ge.transform.tileZoom)/Xe,_t=et*($e.tileID.canonical.x+$e.tileID.wrap*Xe),Ct=et*$e.tileID.canonical.y;return{u_image:0,u_pattern_tl:be.tl,u_pattern_br:be.br,u_texsize:[Ne,We],u_pattern_size:be.displaySize,u_pattern_units_to_pixels:Ce?[ge.transform.width,-1*ge.transform.height]:[1/i.aw($e,1,ge.transform.tileZoom),1/i.aw($e,1,ge.transform.tileZoom)],u_pixel_coord_upper:[_t>>16,Ct>>16],u_pixel_coord_lower:[65535&_t,65535&Ct]}}(0,A,R,y,$,Z),{u_matrix:g,u_emissive_strength:o,u_opacity:h}),Cd=new Float32Array(i.bx([])),$p=(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce=[0,0,0],$e)=>{const Ne=C.style.light,We=Ne.properties.get("position"),Xe=[-We.x,-We.y,We.z],et=i.dx();Ne.properties.get("anchor")==="viewport"&&(i.dy(et,-C.transform.angle),i.dz(Xe,Xe,et));const _t=ue.alphaMode==="MASK",Ct=Ne.properties.get("color").toNonPremultipliedRenderColor(null),jt=ge.paint.get("model-ambient-occlusion-intensity"),Ft=ge.paint.get("model-color").constantOr(i.am.white).toNonPremultipliedRenderColor(null);return Ft.a=ge.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:g,u_lighting_matrix:o,u_normal_matrix:h,u_node_matrix:y||Cd,u_lightpos:Xe,u_lightintensity:Ne.properties.get("intensity"),u_lightcolor:[Ct.r,Ct.g,Ct.b],u_camera_pos:Ce,u_opacity:A,u_baseTextureIsAlpha:0,u_alphaMask:+_t,u_alphaCutoff:ue.alphaCutoff,u_baseColorFactor:R.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:$.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:Z,u_roughnessFactor:se,u_baseColorTexture:Ao.BaseColor,u_metallicRoughnessTexture:Ao.MetallicRoughness,u_normalTexture:Ao.Normal,u_occlusionTexture:Ao.Occlusion,u_emissionTexture:Ao.Emission,u_lutTexture:Ao.LUT,u_color_mix:Ft.toArray01(),u_aoIntensity:jt,u_emissive_strength:be,u_occlusionTextureTransform:$e||[0,0,0,0]}},ry=(g,o=Cd,h=Cd)=>({u_matrix:g,u_instance:o,u_node_matrix:h}),Qu={fillExtrusion:g=>({u_matrix:new i.cc(g),u_lightpos:new i.c9(g),u_lightintensity:new i.ca(g),u_lightcolor:new i.c9(g),u_vertical_gradient:new i.ca(g),u_opacity:new i.ca(g),u_edge_radius:new i.ca(g),u_width_scale:new i.ca(g),u_ao:new i.cb(g),u_height_type:new i.c8(g),u_base_type:new i.c8(g),u_tile_id:new i.c9(g),u_zoom_transition:new i.ca(g),u_inv_rot_matrix:new i.cc(g),u_merc_center:new i.cb(g),u_up_dir:new i.c9(g),u_height_lift:new i.ca(g),u_flood_light_color:new i.c9(g),u_vertical_scale:new i.ca(g),u_flood_light_intensity:new i.ca(g),u_ground_shadow_factor:new i.c9(g)}),fillExtrusionDepth:g=>({u_matrix:new i.cc(g),u_edge_radius:new i.ca(g),u_width_scale:new i.ca(g),u_vertical_scale:new i.ca(g),u_height_type:new i.c8(g),u_base_type:new i.c8(g)}),fillExtrusionPattern:g=>({u_matrix:new i.cc(g),u_lightpos:new i.c9(g),u_lightintensity:new i.ca(g),u_lightcolor:new i.c9(g),u_vertical_gradient:new i.ca(g),u_height_factor:new i.ca(g),u_edge_radius:new i.ca(g),u_width_scale:new i.ca(g),u_ao:new i.cb(g),u_height_type:new i.c8(g),u_base_type:new i.c8(g),u_tile_id:new i.c9(g),u_zoom_transition:new i.ca(g),u_inv_rot_matrix:new i.cc(g),u_merc_center:new i.cb(g),u_up_dir:new i.c9(g),u_height_lift:new i.ca(g),u_image:new i.c8(g),u_texsize:new i.cb(g),u_pixel_coord_upper:new i.cb(g),u_pixel_coord_lower:new i.cb(g),u_tile_units_to_pixels:new i.ca(g),u_opacity:new i.ca(g),u_pattern_transition:new i.ca(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new i.cc(g),u_opacity:new i.ca(g),u_ao_pass:new i.ca(g),u_meter_to_tile:new i.ca(g),u_ao:new i.cb(g),u_flood_light_intensity:new i.ca(g),u_flood_light_color:new i.c9(g),u_attenuation:new i.ca(g),u_edge_radius:new i.ca(g),u_fb:new i.c8(g),u_fb_size:new i.ca(g),u_dynamic_offset:new i.ca(g)}),fill:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_ground_shadow_factor:new i.c9(g)}),fillPattern:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_image:new i.c8(g),u_texsize:new i.cb(g),u_pixel_coord_upper:new i.cb(g),u_pixel_coord_lower:new i.cb(g),u_tile_units_to_pixels:new i.ca(g),u_ground_shadow_factor:new i.c9(g),u_pattern_transition:new i.ca(g)}),fillOutline:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_world:new i.cb(g),u_ground_shadow_factor:new i.c9(g)}),fillOutlinePattern:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_world:new i.cb(g),u_image:new i.c8(g),u_texsize:new i.cb(g),u_pixel_coord_upper:new i.cb(g),u_pixel_coord_lower:new i.cb(g),u_tile_units_to_pixels:new i.ca(g),u_ground_shadow_factor:new i.c9(g),u_pattern_transition:new i.ca(g)}),building:g=>({u_matrix:new i.cc(g),u_normal_matrix:new i.cc(g),u_opacity:new i.ca(g)}),buildingDepth:g=>({u_matrix:new i.cc(g)}),elevatedStructuresDepth:g=>({u_matrix:new i.cc(g),u_depth_bias:new i.ca(g)}),elevatedStructures:g=>({u_matrix:new i.cc(g),u_ground_shadow_factor:new i.c9(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new i.cc(g),u_camera_pos:new i.c9(g),u_depth_bias:new i.ca(g),u_height_scale:new i.ca(g),u_reset_depth:new i.ca(g)}),circle:i.dH,collisionBox:g=>({u_matrix:new i.cc(g),u_camera_to_center_distance:new i.ca(g),u_extrude_scale:new i.cb(g)}),collisionCircle:g=>({u_matrix:new i.cc(g),u_inv_matrix:new i.cc(g),u_camera_to_center_distance:new i.ca(g),u_viewport_size:new i.cb(g)}),debug:g=>({u_color:new i.di(g),u_matrix:new i.cc(g),u_overlay:new i.c8(g),u_overlay_scale:new i.ca(g)}),clippingMask:g=>({u_matrix:new i.cc(g)}),heatmap:g=>({u_extrude_scale:new i.ca(g),u_intensity:new i.ca(g),u_matrix:new i.cc(g),u_inv_rot_matrix:new i.cc(g),u_merc_center:new i.cb(g),u_tile_id:new i.c9(g),u_zoom_transition:new i.ca(g),u_up_dir:new i.c9(g)}),heatmapTexture:g=>({u_image:new i.c8(g),u_color_ramp:new i.c8(g),u_opacity:new i.ca(g)}),hillshade:g=>({u_matrix:new i.cc(g),u_image:new i.c8(g),u_latrange:new i.cb(g),u_light:new i.cb(g),u_shadow:new i.di(g),u_highlight:new i.di(g),u_emissive_strength:new i.ca(g),u_accent:new i.di(g)}),hillshadePrepare:g=>({u_matrix:new i.cc(g),u_image:new i.c8(g),u_dimension:new i.cb(g),u_zoom:new i.ca(g)}),line:i.dG,linePattern:i.dF,raster:g=>({u_matrix:new i.cc(g),u_normalize_matrix:new i.cc(g),u_globe_matrix:new i.cc(g),u_merc_matrix:new i.cc(g),u_grid_matrix:new i.dj(g),u_tl_parent:new i.cb(g),u_scale_parent:new i.ca(g),u_fade_t:new i.ca(g),u_opacity:new i.ca(g),u_image0:new i.c8(g),u_image1:new i.c8(g),u_brightness_low:new i.ca(g),u_brightness_high:new i.ca(g),u_saturation_factor:new i.ca(g),u_contrast_factor:new i.ca(g),u_spin_weights:new i.c9(g),u_perspective_transform:new i.cb(g),u_raster_elevation:new i.ca(g),u_zoom_transition:new i.ca(g),u_merc_center:new i.cb(g),u_cutoff_params:new i.cQ(g),u_colorization_mix:new i.cQ(g),u_colorization_offset:new i.ca(g),u_color_ramp:new i.c8(g),u_texture_offset:new i.cb(g),u_texture_res:new i.cb(g),u_emissive_strength:new i.ca(g)}),rasterParticle:g=>({u_matrix:new i.cc(g),u_normalize_matrix:new i.cc(g),u_globe_matrix:new i.cc(g),u_merc_matrix:new i.cc(g),u_grid_matrix:new i.dj(g),u_tl_parent:new i.cb(g),u_scale_parent:new i.ca(g),u_fade_t:new i.ca(g),u_opacity:new i.ca(g),u_image0:new i.c8(g),u_image1:new i.c8(g),u_raster_elevation:new i.ca(g),u_zoom_transition:new i.ca(g),u_merc_center:new i.cb(g),u_cutoff_params:new i.cQ(g)}),rasterParticleTexture:g=>({u_texture:new i.c8(g),u_opacity:new i.ca(g)}),rasterParticleDraw:g=>({u_particle_texture:new i.c8(g),u_particle_texture_side_len:new i.ca(g),u_tile_offset:new i.cb(g),u_velocity:new i.c8(g),u_color_ramp:new i.c8(g),u_velocity_res:new i.cb(g),u_max_speed:new i.ca(g),u_uv_offset:new i.cb(g),u_data_scale:new i.cb(g),u_data_offset:new i.ca(g),u_particle_pos_scale:new i.ca(g),u_particle_pos_offset:new i.cb(g)}),rasterParticleUpdate:g=>({u_particle_texture:new i.c8(g),u_particle_texture_side_len:new i.ca(g),u_velocity:new i.c8(g),u_velocity_res:new i.cb(g),u_max_speed:new i.ca(g),u_speed_factor:new i.ca(g),u_reset_rate:new i.ca(g),u_rand_seed:new i.ca(g),u_uv_offset:new i.cb(g),u_data_scale:new i.cb(g),u_data_offset:new i.ca(g),u_particle_pos_scale:new i.ca(g),u_particle_pos_offset:new i.cb(g)}),symbol:g=>({u_is_size_zoom_constant:new i.c8(g),u_is_size_feature_constant:new i.c8(g),u_size_t:new i.ca(g),u_size:new i.ca(g),u_camera_to_center_distance:new i.ca(g),u_rotate_symbol:new i.c8(g),u_aspect_ratio:new i.ca(g),u_fade_change:new i.ca(g),u_matrix:new i.cc(g),u_label_plane_matrix:new i.cc(g),u_coord_matrix:new i.cc(g),u_is_text:new i.c8(g),u_elevation_from_sea:new i.c8(g),u_pitch_with_map:new i.c8(g),u_texsize:new i.cb(g),u_texsize_icon:new i.cb(g),u_texture:new i.c8(g),u_texture_icon:new i.c8(g),u_gamma_scale:new i.ca(g),u_device_pixel_ratio:new i.ca(g),u_tile_id:new i.c9(g),u_zoom_transition:new i.ca(g),u_inv_rot_matrix:new i.cc(g),u_merc_center:new i.cb(g),u_camera_forward:new i.c9(g),u_tile_matrix:new i.cc(g),u_up_vector:new i.c9(g),u_ecef_origin:new i.c9(g),u_is_halo:new i.c8(g),u_icon_transition:new i.ca(g),u_color_adj_mat:new i.cc(g),u_scale_factor:new i.ca(g),u_ground_shadow_factor:new i.c9(g),u_inv_matrix:new i.cc(g),u_normal_scale:new i.ca(g)}),background:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_opacity:new i.ca(g),u_color:new i.di(g)}),backgroundPattern:g=>({u_matrix:new i.cc(g),u_emissive_strength:new i.ca(g),u_opacity:new i.ca(g),u_image:new i.c8(g),u_pattern_tl:new i.cb(g),u_pattern_br:new i.cb(g),u_texsize:new i.cb(g),u_pattern_size:new i.cb(g),u_pixel_coord_upper:new i.cb(g),u_pixel_coord_lower:new i.cb(g),u_pattern_units_to_pixels:new i.cb(g)}),terrainRaster:g=>({u_matrix:new i.cc(g),u_image0:new i.c8(g),u_skirt_height:new i.ca(g),u_ground_shadow_factor:new i.c9(g)}),skybox:g=>({u_matrix:new i.cc(g),u_sun_direction:new i.c9(g),u_cubemap:new i.c8(g),u_opacity:new i.ca(g),u_temporal_offset:new i.ca(g)}),skyboxGradient:g=>({u_matrix:new i.cc(g),u_color_ramp:new i.c8(g),u_center_direction:new i.c9(g),u_radius:new i.ca(g),u_opacity:new i.ca(g),u_temporal_offset:new i.ca(g)}),skyboxCapture:g=>({u_matrix_3f:new i.dj(g),u_sun_direction:new i.c9(g),u_sun_intensity:new i.ca(g),u_color_tint_r:new i.cQ(g),u_color_tint_m:new i.cQ(g),u_luminance:new i.ca(g)}),globeRaster:g=>({u_proj_matrix:new i.cc(g),u_globe_matrix:new i.cc(g),u_normalize_matrix:new i.cc(g),u_merc_matrix:new i.cc(g),u_zoom_transition:new i.ca(g),u_merc_center:new i.cb(g),u_image0:new i.c8(g),u_grid_matrix:new i.dj(g),u_skirt_height:new i.ca(g),u_far_z_cutoff:new i.ca(g),u_frustum_tl:new i.c9(g),u_frustum_tr:new i.c9(g),u_frustum_br:new i.c9(g),u_frustum_bl:new i.c9(g),u_globe_pos:new i.c9(g),u_globe_radius:new i.ca(g),u_viewport:new i.cb(g)}),globeAtmosphere:g=>({u_frustum_tl:new i.c9(g),u_frustum_tr:new i.c9(g),u_frustum_br:new i.c9(g),u_frustum_bl:new i.c9(g),u_horizon:new i.ca(g),u_transition:new i.ca(g),u_fadeout_range:new i.ca(g),u_color:new i.cQ(g),u_high_color:new i.cQ(g),u_space_color:new i.cQ(g),u_temporal_offset:new i.ca(g),u_horizon_angle:new i.ca(g)}),model:g=>({u_matrix:new i.cc(g),u_lighting_matrix:new i.cc(g),u_normal_matrix:new i.cc(g),u_node_matrix:new i.cc(g),u_lightpos:new i.c9(g),u_lightintensity:new i.ca(g),u_lightcolor:new i.c9(g),u_camera_pos:new i.c9(g),u_opacity:new i.ca(g),u_baseColorFactor:new i.cQ(g),u_emissiveFactor:new i.cQ(g),u_metallicFactor:new i.ca(g),u_roughnessFactor:new i.ca(g),u_baseTextureIsAlpha:new i.c8(g),u_alphaMask:new i.c8(g),u_alphaCutoff:new i.ca(g),u_baseColorTexture:new i.c8(g),u_metallicRoughnessTexture:new i.c8(g),u_normalTexture:new i.c8(g),u_occlusionTexture:new i.c8(g),u_emissionTexture:new i.c8(g),u_lutTexture:new i.c8(g),u_color_mix:new i.cQ(g),u_aoIntensity:new i.ca(g),u_emissive_strength:new i.ca(g),u_occlusionTextureTransform:new i.cQ(g)}),modelDepth:g=>({u_matrix:new i.cc(g),u_instance:new i.cc(g),u_node_matrix:new i.cc(g)}),groundShadow:g=>({u_matrix:new i.cc(g),u_ground_shadow_factor:new i.c9(g)}),stars:g=>({u_matrix:new i.cc(g),u_up:new i.c9(g),u_right:new i.c9(g),u_intensity_multiplier:new i.ca(g)}),snowParticle:g=>({u_modelview:new i.cc(g),u_projection:new i.cc(g),u_time:new i.ca(g),u_cam_pos:new i.c9(g),u_velocityConeAperture:new i.ca(g),u_velocity:new i.ca(g),u_horizontalOscillationRadius:new i.ca(g),u_horizontalOscillationRate:new i.ca(g),u_boxSize:new i.ca(g),u_billboardSize:new i.ca(g),u_simpleShapeParameters:new i.cb(g),u_screenSize:new i.cb(g),u_thinningCenterPos:new i.cb(g),u_thinningShape:new i.c9(g),u_thinningAffectedRatio:new i.ca(g),u_thinningParticleOffset:new i.ca(g),u_particleColor:new i.cQ(g),u_direction:new i.c9(g)}),rainParticle:g=>({u_modelview:new i.cc(g),u_projection:new i.cc(g),u_time:new i.ca(g),u_cam_pos:new i.c9(g),u_texScreen:new i.c8(g),u_velocityConeAperture:new i.ca(g),u_velocity:new i.ca(g),u_boxSize:new i.ca(g),u_rainDropletSize:new i.cb(g),u_distortionStrength:new i.ca(g),u_rainDirection:new i.c9(g),u_color:new i.cQ(g),u_screenSize:new i.cb(g),u_thinningCenterPos:new i.cb(g),u_thinningShape:new i.c9(g),u_thinningAffectedRatio:new i.ca(g),u_thinningParticleOffset:new i.ca(g),u_shapeDirectionalPower:new i.ca(g),u_shapeNormalPower:new i.ca(g),u_mode:new i.ca(g)}),vignette:g=>({u_vignetteShape:new i.c9(g),u_vignetteColor:new i.cQ(g)}),occlusion:g=>({u_matrix:new i.cc(g),u_anchorPos:new i.c9(g),u_screenSizePx:new i.cb(g),u_occluderSizePx:new i.cb(g),u_color:new i.cQ(g)})};class gh{constructor(o,h,y,C){this.id=gh.uniqueIdxCounter,gh.uniqueIdxCounter++,this.context=o;const A=o.gl;this.buffer=A.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||C||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=gh.uniqueIdxCounter,gh.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}gh.uniqueIdxCounter=0;const Dm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hy{constructor(o,h,y,C,A,R){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=C,this.instanceCount=R,this.context=o;const $=o.gl;this.buffer=$.createBuffer(),o.bindVertexBuffer.set(this.buffer),$.bufferData($.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?$.DYNAMIC_DRAW:$.STATIC_DRAW),this.dynamicDraw||A||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let y=0;y<this.attributes.length;y++){const C=h.attributes[this.attributes[y].name];C!==void 0&&o.enableVertexAttribArray(C)}}setVertexAttribPointers(o,h,y){for(let C=0;C<this.attributes.length;C++){const A=this.attributes[C],R=h.attributes[A.name];R!==void 0&&o.vertexAttribPointer(R,A.components,o[Dm[A.type]],!1,this.itemSize,A.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(o,h,y){for(let C=0;C<this.attributes.length;C++){const A=h.attributes[this.attributes[C].name];A!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(A,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yp{constructor(o,h,y,C,A){this.context=o,this.width=h,this.height=y;const R=this.framebuffer=o.gl.createFramebuffer();C&&(this.colorAttachment=new zt(o,R)),A&&(this.depthAttachmentType=A,this.depthAttachment=A==="renderbuffer"?new Gf(o,R):new qf(o,R))}destroy(){const o=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&o.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&o.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&o.deleteTexture(h)}o.deleteFramebuffer(this.framebuffer)}}class yf{constructor(o,h){this.gl=o,this.clearColor=new Wl(this),this.clearDepth=new Kg(this),this.clearStencil=new k0(this),this.colorMask=new hf(this),this.depthMask=new Wf(this),this.stencilMask=new pc(this),this.stencilFunc=new Qg(this),this.stencilOp=new A0(this),this.stencilTest=new jf(this),this.depthRange=new Es(this),this.depthTest=new Ro(this),this.depthFunc=new eh(this),this.blend=new gg(this),this.blendFunc=new uf(this),this.blendColor=new fo(this),this.blendEquation=new ml(this),this.cullFace=new Hf(this),this.cullFaceSide=new df(this),this.frontFace=new Op(this),this.program=new zs(this),this.activeTexture=new Yu(this),this.viewport=new Rp(this),this.bindFramebuffer=new Np(this),this.bindRenderbuffer=new wd(this),this.bindTexture=new No(this),this.bindVertexBuffer=new Cm(this),this.bindElementBuffer=new yg(this),this.bindVertexArrayOES=new _g(this),this.pixelStoreUnpack=new M0(this),this.pixelStoreUnpackPremultiplyAlpha=new Em(this),this.pixelStoreUnpackFlipY=new wu(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h,y){return new gh(this,o,h,y)}createVertexBuffer(o,h,y,C,A){return new Hy(this,o,h,y,C,A)}createRenderbuffer(o,h,y){const C=this.gl,A=C.createRenderbuffer();return this.bindRenderbuffer.set(A),C.renderbufferStorage(C.RENDERBUFFER,o,h,y),this.bindRenderbuffer.set(null),A}createFramebuffer(o,h,y,C){return new yp(this,o,h,y,C)}clear({color:o,depth:h,stencil:y,colorMask:C}){const A=this.gl;let R=0;o&&(R|=A.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(C||[!0,!0,!0,!0])),h!==void 0&&(R|=A.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(R|=A.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),A.clear(R)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.bv(o.blendFunction,Bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Xf;function jl(g,o,h,y,C,A,R){const $=g.context,Z=$.gl,se=g.transform,ue=g.getOrCreateProgram("collisionBox"),be=[];let ge=0,Ce=0;for(let Ct=0;Ct<y.length;Ct++){const jt=y[Ct],Ft=o.getTile(jt),Rt=Ft.getBucket(h);if(!Rt)continue;const Et=kn(jt,Rt,se);let Wt=Et;C[0]===0&&C[1]===0||(Wt=g.translatePosMatrix(Et,Ft,C,A));const qt=R?Rt.textCollisionBox:Rt.iconCollisionBox,Ei=Rt.collisionCircleArray;if(Ei.length>0){const Mi=i.bz(),Ki=Wt;i.cB(Mi,Rt.placementInvProjMatrix,se.glCoordMatrix),i.cB(Mi,Mi,Rt.placementViewportMatrix),be.push({circleArray:Ei,circleOffset:Ce,transform:Ki,invTransform:Mi,projection:Rt.getProjection()}),ge+=Ei.length/4,Ce=ge}qt&&(g.terrain&&g.terrain.setupElevationDraw(Ft,ue),ue.draw(g,Z.LINES,Gt.disabled,sr.disabled,g.colorModeForRenderPass(),hi.disabled,C_(Wt,se,Ft,Rt.getProjection()),h.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,null,se.zoom,null,[qt.collisionVertexBuffer,qt.collisionVertexBufferExt]))}if(!R||!be.length)return;const $e=g.getOrCreateProgram("collisionCircle"),Ne=new i.dI;Ne.resize(4*ge),Ne._trim();let We=0;for(const Ct of be)for(let jt=0;jt<Ct.circleArray.length/4;jt++){const Ft=4*jt,Rt=Ct.circleArray[Ft+0],Et=Ct.circleArray[Ft+1],Wt=Ct.circleArray[Ft+2],qt=Ct.circleArray[Ft+3];Ne.emplace(We++,Rt,Et,Wt,qt,0),Ne.emplace(We++,Rt,Et,Wt,qt,1),Ne.emplace(We++,Rt,Et,Wt,qt,2),Ne.emplace(We++,Rt,Et,Wt,qt,3)}(!Xf||Xf.length<2*ge)&&(Xf=function(Ct){const jt=2*Ct,Ft=new i.a_;Ft.resize(jt),Ft._trim();for(let Rt=0;Rt<jt;Rt++){const Et=6*Rt;Ft.uint16[Et+0]=4*Rt+0,Ft.uint16[Et+1]=4*Rt+1,Ft.uint16[Et+2]=4*Rt+2,Ft.uint16[Et+3]=4*Rt+2,Ft.uint16[Et+4]=4*Rt+3,Ft.uint16[Et+5]=4*Rt+0}return Ft}(ge));const Xe=$.createIndexBuffer(Xf,!0),et=$.createVertexBuffer(Ne,i.dJ.members,!0);for(const Ct of be){const jt={u_matrix:Ct.transform,u_inv_matrix:Ct.invTransform,u_camera_to_center_distance:(_t=se).getCameraToCenterDistance(Ct.projection),u_viewport_size:[_t.width,_t.height]};$e.draw(g,Z.TRIANGLES,Gt.disabled,sr.disabled,g.colorModeForRenderPass(),hi.disabled,jt,h.id,et,Xe,i.bd.simpleSegment(0,2*Ct.circleOffset,Ct.circleArray.length,Ct.circleArray.length/2),null,se.zoom)}var _t;et.destroy(),Xe.destroy()}const Eu=i.bz();function Zf(g){const o=g._camera.getWorldToCamera(g.worldSize,1),h=i.az([],o,g.globeMatrix);i.bi(h,h);const y=[0,0,0],C=[0,1,0,0];return i.aA(C,C,h),y[0]=C[0],y[1]=C[1],y[2]=C[2],i.au(y,y),y}function gl({width:g,height:o,anchor:h,textOffset:y,textScale:C},A){const{horizontalAlign:R,verticalAlign:$}=i.bT(h),Z=-(R-.5)*g,se=-($-.5)*o,ue=i.bU(h,y);return new i.P((Z/C+ue[0])*A,(se/C+ue[1])*A)}function ny(g,o,h,y,C,A,R,$,Z,se){const ue=g.text.placedSymbolArray,be=g.text.dynamicLayoutVertexArray,ge=g.icon.dynamicLayoutVertexArray,Ce={},$e=g.getProjection(),Ne=lf(R,$e,C),We=C.elevation,Xe=$e.upVectorScale(R.canonical,C.center.lat,C.worldSize).metersToTile;be.clear();for(let et=0;et<ue.length;et++){const _t=ue.get(et),{tileAnchorX:Ct,tileAnchorY:jt,numGlyphs:Ft}=_t,Rt=_t.hidden||!_t.crossTileID||g.allowVerticalPlacement&&!_t.placedOrientation?null:y[_t.crossTileID];if(Rt){let Et=0,Wt=0,qt=0;if(We){const dr=We?We.getAtTileOffset(R,Ct,jt):0,[Ni,vr,Nr]=$e.upVector(R.canonical,Ct,jt);Et=dr*Ni*Xe,Wt=dr*vr*Xe,qt=dr*Nr*Xe}let[Ei,Mi,Ki,Ji]=hc(_t.projectedAnchorX+Et,_t.projectedAnchorY+Wt,_t.projectedAnchorZ+qt,h?Ne:A);const Er=fu(C.getCameraToCenterDistance($e),Ji);let Ti=i.bJ(g.textSizeData,Z,_t)*Er/i.bO;h&&(Ti*=g.tilePixelRatio/$);const $i=gl(Rt,Ti);h?({x:Ei,y:Mi,z:Ki}=$e.projectTilePoint(Ct+$i.x,jt+$i.y,R.canonical),[Ei,Mi,Ki]=hc(Ei+Et,Mi+Wt,Ki+qt,A)):(o&&$i._rotate(-C.angle),Ei+=$i.x,Mi+=$i.y,Ki=0);const li=g.allowVerticalPlacement&&_t.placedOrientation===i.bI.vertical?Math.PI/2:0;for(let dr=0;dr<Ft;dr++)i.bL(be,Ei,Mi,Ki,li);se&&_t.associatedIconIndex>=0&&(Ce[_t.associatedIconIndex]={x:Ei,y:Mi,z:Ki,angle:li})}else Fh(Ft,be)}if(se){ge.clear();const et=g.icon.placedSymbolArray;for(let _t=0;_t<et.length;_t++){const Ct=et.get(_t),{numGlyphs:jt}=Ct,Ft=Ce[_t];if(Ct.hidden||!Ft)Fh(jt,ge);else{const{x:Rt,y:Et,z:Wt,angle:qt}=Ft;for(let Ei=0;Ei<jt;Ei++)i.bL(ge,Rt,Et,Wt,qt)}}g.icon.dynamicLayoutVertexBuffer.updateData(ge)}g.text.dynamicLayoutVertexBuffer.updateData(be)}function Ed(g,o,h,y,C,A,R={}){const $=h.paint.get("icon-translate"),Z=h.paint.get("text-translate"),se=h.paint.get("icon-translate-anchor"),ue=h.paint.get("text-translate-anchor"),be=h.layout.get("icon-rotation-alignment"),ge=h.layout.get("text-rotation-alignment"),Ce=h.layout.get("icon-pitch-alignment"),$e=h.layout.get("text-pitch-alignment"),Ne=h.layout.get("icon-keep-upright"),We=h.layout.get("text-keep-upright"),Xe=h.paint.get("icon-color-saturation"),et=h.paint.get("icon-color-contrast"),_t=h.paint.get("icon-color-brightness-min"),Ct=h.paint.get("icon-color-brightness-max"),jt=h.layout.get("symbol-elevation-reference")==="sea",Ft=g.context,Rt=Ft.gl,Et=g.transform,Wt=be==="map",qt=ge==="map",Ei=Ce==="map",Mi=$e==="map",Ki=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ji=!1;const Er=g.depthModeForSublayer(0,Gt.ReadOnly),Ti=new Gt(g.context.gl.LEQUAL,Gt.ReadOnly,g.depthRangeFor3D),$i=[i.aD(Et.center.lng),i.aH(Et.center.lat)],li=h.layout.get("text-variable-anchor"),dr=Et.projection.name==="globe",Ni=[],vr=[0,-1,0];for(const Nr of y){const ar=o.getTile(Nr),Br=ar.getBucket(h);if(!Br||Br.projection.name==="mercator"&&dr||Br.fullyClipped)continue;const dn=Br.projection.name==="globe",pn=dn?i.ah(Et.zoom):0,on=lf(Nr,Br.getProjection(),Et),bn=Et.calculatePixelsToTileUnitsMatrix(ar),An=li&&Br.hasTextData(),Vn=Br.hasIconTextFit()&&An&&Br.hasIconData(),Zn=Br.getProjection().createInversionMatrix(Et,Nr.canonical),ys=(1<<ar.tileID.canonical.z)*i.aj/g.transform.worldSize,Bo=Zo=>{let Wo=[0,0,0];if(Zo){const ol=g.style.directionalLight,Ws=g.style.ambientLight;ol&&Ws&&(Wo=Vl(g.style,ol,Ws))}return Wo},Da=Zo=>{Et.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||g.terrain)&&(Zo.push("DEPTH_D24"),Zo.push("DEPTH_OCCLUSION"))},xo=()=>{const Zo=Wt&&h.layout.get("symbol-placement")!=="point",Wo=[];Da(Wo);const ol=Zo||Vn,Ws=Br.elevationType==="road"&&Ei,ec=g.shadowRenderer,Ta=Ws&&!!ec&&ec.enabled,Ca=Bo(Ta),Ko=Ws?Ti:Er,bo=h.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&Ei&&Wo.push("PITCH_WITH_MAP_TERRAIN"),dn&&(Wo.push("PROJECTION_GLOBE_VIEW"),ol&&Wo.push("PROJECTED_POS_ON_VIEWPORT")),bo>0&&Wo.push("ICON_TRANSITION"),Br.icon.zOffsetVertexBuffer&&Wo.push("Z_OFFSET"),Xe===0&&et===0&&_t===0&&Ct===1||Wo.push("COLOR_ADJUSTMENT"),Br.sdfIcons&&Wo.push("RENDER_SDF"),Ta&&Wo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ws&&Br.icon.orientationVertexBuffer&&Wo.push("ELEVATED_ROADS");const Ya=Br.icon.programConfigurations.get(h.id),_h=g.getOrCreateProgram("symbol",{config:Ya,defines:Wo}),ua=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],Fo=Br.iconSizeData,ru=i.bH(Fo,Et.zoom),Ah=Ei||!Et.isOrthographic,od=Nh(on,ar.tileID.canonical,Ei,Wt,Et,Br.getProjection(),bn),Od=up(on,ar.tileID.canonical,Ei,Wt,Et,Br.getProjection(),bn),nu=g.translatePosMatrix(Od,ar,$,se,!0),su=g.translatePosMatrix(on,ar,$,se),Qd=ol?Eu:od,ad=Wt&&!Ei&&!Zo;let Jd=vr;!dr&&!Et.mercatorFromTransition||Wt||(Jd=Zf(Et));const cm=dn?Jd:vr,hy=h.getColorAdjustmentMatrix(Xe,et,_t,Ct),hm=Up(Fo.kind,ru,ad,Ei,g,su,Qd,nu,jt,!1,ua,[0,0],0,Nr,pn,$i,Zn,cm,Br.getProjection(),Ca,ys,hy,bo,null),uy=ar.imageAtlasTexture?ar.imageAtlasTexture:null,Pg=h.layout.get("icon-size").constantOr(0)!==1||Br.iconsNeedLinear,dy=Br.sdfIcons||g.options.rotating||g.options.zooming||Pg||Ah?Rt.LINEAR:Rt.NEAREST,um=Br.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,ep=g.terrain&&Ei&&Zo?i.bi(i.bz(),od):Eu;if(Zo&&Br.icon){const jm=Et.elevation,Sp=jm?jm.getAtTileOffsetFunc(Nr,Et.center.lat,Et.worldSize,Br.getProjection()):null,tp=Ud(on,ar.tileID.canonical,Ei,Wt,Et,Br.getProjection(),bn);Ll(Br,on,g,!1,tp,Od,Ei,Ne,Sp,Nr)}return{program:_h,buffers:Br.icon,uniformValues:hm,atlasTexture:uy,atlasTextureIcon:null,atlasInterpolation:dy,atlasInterpolationIcon:null,isSDF:Br.sdfIcons,hasHalo:um,depthMode:Ko,tile:ar,renderWithShadows:Ta,labelPlaneMatrixInv:ep}},ia=()=>{const Zo=qt&&h.layout.get("symbol-placement")!=="point",Wo=[],ol=Zo||li||Vn,Ws=Br.elevationType==="road"&&Mi,ec=g.shadowRenderer,Ta=Ws&&!!ec&&ec.enabled,Ca=Bo(Ta),Ko=Ws?Ti:Er;g.terrainRenderModeElevated()&&Mi&&Wo.push("PITCH_WITH_MAP_TERRAIN"),dn&&(Wo.push("PROJECTION_GLOBE_VIEW"),ol&&Wo.push("PROJECTED_POS_ON_VIEWPORT")),Br.text.zOffsetVertexBuffer&&Wo.push("Z_OFFSET"),Br.iconsInText&&Wo.push("RENDER_TEXT_AND_SYMBOL"),Wo.push("RENDER_SDF"),Ta&&Wo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ws&&Br.text.orientationVertexBuffer&&Wo.push("ELEVATED_ROADS"),Da(Wo);const bo=Br.text.programConfigurations.get(h.id),Ya=g.getOrCreateProgram("symbol",{config:bo,defines:Wo});let _h,ua=[0,0],Fo=null;const ru=Br.textSizeData;Br.iconsInText&&(ua=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],Fo=ar.imageAtlasTexture?ar.imageAtlasTexture:null,_h=Mi||!Et.isOrthographic||g.options.rotating||g.options.zooming||ru.kind==="composite"||ru.kind==="camera"?Rt.LINEAR:Rt.NEAREST);const Ah=ar.glyphAtlasTexture?ar.glyphAtlasTexture.size:[0,0],od=h.layout.get("text-size-scale-range"),Od=i.ay(g.scaleFactor,od[0],od[1]),nu=i.bH(ru,Et.zoom,Od),su=Nh(on,ar.tileID.canonical,Mi,qt,Et,Br.getProjection(),bn),Qd=up(on,ar.tileID.canonical,Mi,qt,Et,Br.getProjection(),bn),ad=g.translatePosMatrix(Qd,ar,Z,ue,!0),Jd=g.translatePosMatrix(on,ar,Z,ue),cm=ol?Eu:su,hy=qt&&!Mi&&!Zo;let hm=vr;!dr&&!Et.mercatorFromTransition||qt||(hm=Zf(Et));const uy=Up(ru.kind,nu,hy,Mi,g,Jd,cm,ad,jt,!0,Ah,ua,0,Nr,pn,$i,Zn,dn?hm:vr,Br.getProjection(),Ca,ys,null,null,Od),Pg=ar.glyphAtlasTexture?ar.glyphAtlasTexture:null,dy=Rt.LINEAR,um=h.paint.get("text-halo-width").constantOr(1)!==0,ep=g.terrain&&Mi&&Zo?i.bi(i.bz(),su):Eu;if(Zo&&Br.text){const jm=Et.elevation,Sp=jm?jm.getAtTileOffsetFunc(Nr,Et.center.lat,Et.worldSize,Br.getProjection()):null,tp=Ud(on,ar.tileID.canonical,Mi,qt,Et,Br.getProjection(),bn);Ll(Br,on,g,!0,tp,Qd,Mi,We,Sp,Nr)}return{program:Ya,buffers:Br.text,uniformValues:uy,atlasTexture:Pg,atlasTextureIcon:Fo,atlasInterpolation:dy,atlasInterpolationIcon:_h,isSDF:!0,hasHalo:um,depthMode:Ko,tile:ar,renderWithShadows:Ta,labelPlaneMatrixInv:ep}},sl=Br.icon.segments.get().length,ls=Br.text.segments.get().length,cs=sl&&!R.onlyText?xo():null,Ts=ls&&!R.onlyIcons?ia():null,_a=h.paint.get("icon-opacity").constantOr(1),Jl=h.paint.get("text-opacity").constantOr(1);if(Ki&&Br.canOverlap){Ji=!0;const Zo=_a&&!R.onlyText?Br.icon.segments.get():[],Wo=Jl&&!R.onlyIcons?Br.text.segments.get():[];for(const ol of Zo)Ni.push({segments:new i.bd([ol]),sortKey:ol.sortKey,state:cs});for(const ol of Wo)Ni.push({segments:new i.bd([ol]),sortKey:ol.sortKey,state:Ts})}else R.onlyText||Ni.push({segments:_a?Br.icon.segments:new i.bd([]),sortKey:0,state:cs}),R.onlyIcons||Ni.push({segments:Jl?Br.text.segments:new i.bd([]),sortKey:0,state:Ts})}Ji&&Ni.sort((Nr,ar)=>Nr.sortKey-ar.sortKey);for(const Nr of Ni){const ar=Nr.state;if(ar)if(g.terrain?g.terrain.setupElevationDraw(ar.tile,ar.program,{useDepthForOcclusion:Et.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ar.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Et.depthOcclusionForSymbolsAndCircles,ar.program),Ft.activeTexture.set(Rt.TEXTURE0),ar.atlasTexture&&ar.atlasTexture.bind(ar.atlasInterpolation,Rt.CLAMP_TO_EDGE,!0),ar.atlasTextureIcon&&(Ft.activeTexture.set(Rt.TEXTURE1),ar.atlasTextureIcon&&ar.atlasTextureIcon.bind(ar.atlasInterpolationIcon,Rt.CLAMP_TO_EDGE,!0)),ar.renderWithShadows&&g.shadowRenderer.setupShadows(ar.tile.tileID.toUnwrapped(),ar.program,"vector-tile",ar.tile.tileID.overscaledZ),g.uploadCommonLightUniforms(g.context,ar.program),ar.hasHalo){const Br=ar.uniformValues;Br.u_is_halo=1,ku(ar.buffers,Nr.segments,h,g,ar.program,ar.depthMode,C,A,Br,2),Br.u_is_halo=0}else{if(ar.isSDF){const Br=ar.uniformValues;ar.hasHalo&&(Br.u_is_halo=1,ku(ar.buffers,Nr.segments,h,g,ar.program,ar.depthMode,C,A,Br,1)),Br.u_is_halo=0}ku(ar.buffers,Nr.segments,h,g,ar.program,ar.depthMode,C,A,ar.uniformValues,1)}}}function ku(g,o,h,y,C,A,R,$,Z,se){const ue=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];C.draw(y,y.context.gl.TRIANGLES,A,R,$,hi.disabled,Z,h.id,g.layoutVertexBuffer,g.indexBuffer,o,h.paint,y.transform.zoom,g.programConfigurations.get(h.id),ue,se)}function _p(g,o){const h=1<<g.canonical.z,y=(o.x*h-g.canonical.x-g.wrap*h)*i.aj,C=(o.y*h-g.canonical.y)*i.aj,A=i.dS(o.z,o.y);return i.cS(y,C,A)}function yl(g,o,h,y,C){if(!h.layout||h.layout.get("fill-elevation-reference")==="none")return;const A=g.context.gl,R=new Gt(g.context.gl.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D),$=new Gt(g.context.gl.GREATER,Gt.ReadWrite,g.depthRangeFor3D),Z=function(Ce){const $e=i.cJ(Ce.pitch);let Ne=.01;return Ce.isOrthographic&&(Ne=i.ai(1e-4,Ne,i.cN($e>=Mo?1:$e/Mo))),2*Ne}(g.transform),se=g.transform.getFreeCameraOptions().position,ue="elevatedStructuresDepthReconstruct",be=g.getOrCreateProgram(ue,{defines:["DEPTH_RECONSTRUCTION"]}),ge=g.getOrCreateProgram(ue);for(const Ce of y){const $e=o.getTile(Ce),Ne=$e.getBucket(h);if(!Ne)continue;const We=Ne.elevatedStructures;if(!We)continue;const Xe=Ne.elevationBufferData.heightRange,et=_p(Ce.toUnwrapped(),se),_t=g.translatePosMatrix(Ce.projMatrix,$e,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let Ct,jt,Ft,Rt;if(C==="initialize"){if(!Xe||Xe.min>=1||We.depthSegments.segments[0].primitiveLength===0)continue;Ct=mp(_t,et,Z,1,0),jt=R,Ft=We.depthSegments,Rt=be}else if(C==="reset"){if(!Xe||Xe.min>=0||We.maskSegments.segments[0].primitiveLength===0)continue;Ct=mp(_t,et,0,0,1),jt=$,Ft=We.maskSegments,Rt=be}else if(C==="geometry"){if(We.depthSegments.segments[0].primitiveLength===0)continue;Ct=mp(_t,et,Z,1,0),jt=R,Ft=We.depthSegments,Rt=ge}Rt.draw(g,A.TRIANGLES,jt,sr.disabled,Bi.disabled,hi.disabled,Ct,h.id,We.vertexBuffer,We.indexBuffer,Ft,h.paint,g.transform.zoom)}}function _f(g,o,h){const{painter:y,sourceCache:C,layer:A,coords:R,colorMode:$,elevationType:Z,terrainEnabled:se,pass:ue}=g,be=y.context.gl,ge=A.paint.get("fill-pattern"),Ce=A.paint.get("fill-pattern-cross-fade"),$e=ge.constantOr(null);let Ne=Z;Z!=="road"||o&&!se||(Ne="none");const We=Ne==="road",Xe=g.painter.shadowRenderer,et=We&&!!Xe&&Xe.enabled,_t=new Gt(y.context.gl.LEQUAL,Gt.ReadOnly,y.depthRangeFor3D);let Ct=[0,0,0];if(et){const Rt=y.style.directionalLight,Et=y.style.ambientLight;Rt&&Et&&(Ct=Vl(y.style,Rt,Et))}const jt=ge&&ge.constantOr(1),Ft=(Rt,Et)=>{let Wt,qt,Ei,Mi,Ki;Et?(Wt=jt&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ei=be.LINES):(Wt=jt?"fillPattern":"fill",Ei=be.TRIANGLES);for(const Ji of R){const Er=C.getTile(Ji);if(jt&&!Er.patternsLoaded())continue;const Ti=Er.getBucket(A);if(!Ti)continue;const $i=o?Ti.elevationBufferData:Ti.bufferData;if($i.isEmpty())continue;y.prepareDrawTile();const li=$i.programConfigurations.get(A.id),dr=y.isTileAffectedByFog(Ji),Ni=[],vr=[];We&&(Ni.push("ELEVATED_ROADS"),vr.push($i.elevatedLayoutVertexBuffer)),et&&Ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),jt&&(y.context.activeTexture.set(be.TEXTURE0),Er.imageAtlasTexture&&Er.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),li.updatePaintBuffers());let Nr=!1;if($e&&Er.imageAtlas){const on=Er.imageAtlas,bn=i.dN.from($e),An=bn.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),Vn=bn.getSecondary(),Zn=on.patternPositions.get(An),ys=Vn?on.patternPositions.get(Vn.scaleSelf(i.q.devicePixelRatio).toString()):null;Nr=!!Zn&&!!ys,Zn&&li.setConstantPatternPositions(Zn,ys)}Ce>0&&(Nr||li.getPatternTransitionVertexBuffer("fill-pattern"))&&Ni.push("FILL_PATTERN_TRANSITION");const ar=y.getOrCreateProgram(Wt,{config:li,overrideFog:dr,defines:Ni}),Br=y.translatePosMatrix(Ji.projMatrix,Er,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));et&&Xe.setupShadows(Er.tileID.toUnwrapped(),ar,"vector-tile",Er.tileID.overscaledZ);const dn=A.paint.get("fill-emissive-strength");if(Et){Mi=$i.lineIndexBuffer,Ki=$i.lineSegments;const on=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[be.drawingBufferWidth,be.drawingBufferHeight];qt=Wt==="fillOutlinePattern"&&jt?Vy(Br,dn,y,Er,on,Ct,Ce):$d(Br,dn,on,Ct)}else Mi=$i.indexBuffer,Ki=$i.triangleSegments,qt=jt?L0(Br,dn,y,Er,Ct,Ce):ff(Br,dn,Ct);y.uploadCommonUniforms(y.context,ar,Ji.toUnwrapped());let pn=Rt;(Z==="road"&&!se||Z==="offset")&&(pn=_t),ar.draw(y,Ei,pn,h||y.stencilModeForClipping(Ji),$,hi.disabled,qt,A.id,$i.layoutVertexBuffer,Mi,Ki,A.paint,y.transform.zoom,li,vr)}};y.renderPass===ue&&Ft(y.depthModeForSublayer(1,y.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),Ne==="none"&&y.renderPass==="translucent"&&A.paint.get("fill-antialias")&&Ft(y.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function Au(g,o,h,y,C,A,R,$){h.resetLayerRenderingStats(g);const Z=g.context,se=Z.gl,ue=g.transform,be=h.paint.get("fill-extrusion-pattern"),ge=h.paint.get("fill-extrusion-pattern-cross-fade"),Ce=be.constantOr(null),$e=be.constantOr(1),Ne=h.paint.get("fill-extrusion-opacity"),We=g.style.enable3dLights(),Xe=h.paint.get(We&&!$e?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),et=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Xe],_t=h.layout.get("fill-extrusion-edge-radius"),Ct=_t>0&&!h.paint.get("fill-extrusion-rounded-roof"),jt=Ct?0:_t,Ft=ue.projection.name==="globe"?i.dV():0,Rt=ue.projection.name==="globe",Et=Rt?i.ah(ue.zoom):0,Wt=[i.aD(ue.center.lng),i.aH(ue.center.lat)],qt=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ei=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(qt?null:h.lut).toArray01().slice(0,3),Mi=h.paint.get("fill-extrusion-flood-light-intensity"),Ki=h.paint.get("fill-extrusion-vertical-scale"),Ji=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Er=h.paint.get("fill-extrusion-height-alignment"),Ti=h.paint.get("fill-extrusion-base-alignment"),$i=Jo(g,h.paint.get("fill-extrusion-cutoff-fade-range")),li=[];let dr;Rt&&li.push("PROJECTION_GLOBE_VIEW"),et[0]>0&&li.push("FAUX_AO"),Ct&&li.push("ZERO_ROOF_RADIUS"),$&&li.push("HAS_CENTROID"),Mi>0&&li.push("FLOOD_LIGHT"),$i.shouldRenderCutoff&&li.push("RENDER_CUTOFF"),Ji&&li.push("RENDER_WALL_MODE");const Ni=g.renderPass==="shadow",vr=g.shadowRenderer,Nr=Ni&&!!vr,ar=Ni?hi.disabled:hi.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Br=[0,0,0];if(vr){const on=g.style.directionalLight,bn=g.style.ambientLight;on&&bn&&(Br=Vl(g.style,on,bn)),Ni||(li.push("RENDER_SHADOWS","DEPTH_TEXTURE"),vr.useNormalOffset&&li.push("NORMAL_OFFSET")),dr=li.concat(["SHADOWS_SINGLE_CASCADE"])}const dn=Nr?"fillExtrusionDepth":$e?"fillExtrusionPattern":"fillExtrusion",pn=h.getLayerRenderingStats();for(const on of y){const bn=o.getTile(on),An=bn.getBucket(h);if(!An||An.projection.name!==ue.projection.name)continue;let Vn=!1;vr&&(Vn=vr.getMaxCascadeForTile(on.toUnwrapped())===0);const Zn=g.isTileAffectedByFog(on),ys=An.programConfigurations.get(h.id);let Bo=!1;if(Ce&&bn.imageAtlas){const Ts=bn.imageAtlas,_a=i.dN.from(Ce),Jl=_a.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),Zo=_a.getSecondary(),Wo=Ts.patternPositions.get(Jl),ol=Zo?Ts.patternPositions.get(Zo.scaleSelf(i.q.devicePixelRatio).toString()):null;Bo=!!Wo&&!!ol,Wo&&ys.setConstantPatternPositions(Wo,ol)}ge>0&&(Bo||ys.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&li.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Da=g.getOrCreateProgram(dn,{config:ys,defines:Vn?dr:li,overrideFog:Zn});if(g.terrain&&g.terrain.setupElevationDraw(bn,Da,{useMeterToDem:!0}),!An.centroidVertexBuffer){const Ts=Da.attributes.a_centroid_pos;Ts!==void 0&&se.vertexAttrib2f(Ts,0,0)}!Ni&&vr&&vr.setupShadows(bn.tileID.toUnwrapped(),Da,"vector-tile",bn.tileID.overscaledZ),$e&&(g.context.activeTexture.set(se.TEXTURE0),bn.imageAtlasTexture&&bn.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ys.updatePaintBuffers());const xo=h.paint.get("fill-extrusion-vertical-gradient"),ia=1/An.tileToMeter;let sl;if(Ni&&vr){if(Hl(bn.tileID,An,g))continue;const Ts=vr.calculateShadowPassMatrixFromTile(bn.tileID.toUnwrapped());sl=iy(Ts,jt,ia,Ki,Er,Ti)}else{const Ts=g.translatePosMatrix(on.expandedProjMatrix,bn,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),_a=ue.projection.createInversionMatrix(ue,on.canonical);sl=$e?zp(Ts,g,xo,Ne,et,jt,ia,on,bn,Ft,Er,Ti,Et,Wt,_a,Ei,Ki,ge):km(Ts,g,xo,Ne,et,jt,ia,on,Ft,Er,Ti,Et,Wt,_a,Ei,Ki,Mi,Br)}g.uploadCommonUniforms(Z,Da,on.toUnwrapped(),null,$i);let ls=An.segments;if(ue.projection.name==="mercator"&&!Ni&&(ls=An.getVisibleSegments(bn.tileID,g.terrain,g.transform.getFrustum(0)),!ls.get().length))continue;if(pn)if(Ni)for(const Ts of ls.get())pn.numRenderedVerticesInShadowPass+=Ts.primitiveLength;else for(const Ts of ls.get())pn.numRenderedVerticesInTransparentPass+=Ts.primitiveLength;const cs=[];(g.terrain||$)&&cs.push(An.centroidVertexBuffer),Rt&&cs.push(An.layoutVertexExtBuffer),Ji&&cs.push(An.wallVertexBuffer),Da.draw(g,Z.gl.TRIANGLES,C,A,R,ar,sl,h.id,An.layoutVertexBuffer,An.indexBuffer,ls,h.paint,g.transform.zoom,ys,cs)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Vp(g,o,h,y,C,A,R,$,Z,se,ue,be,ge,Ce,$e,Ne,We,Xe,et){const _t=g.context,Ct=_t.gl,jt=g.transform,Ft=g.transform.zoom,Rt=[],Et=Jo(g,h.paint.get("fill-extrusion-cutoff-fade-range"));se==="clear"?(Rt.push("CLEAR_SUBPASS"),et&&(Rt.push("CLEAR_FROM_TEXTURE"),_t.activeTexture.set(Ct.TEXTURE0),et.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE))):se==="sdf"&&Rt.push("SDF_SUBPASS"),We&&Rt.push("HAS_CENTROID"),Et.shouldRenderCutoff&&Rt.push("RENDER_CUTOFF");const Wt=h.layout.get("fill-extrusion-edge-radius"),qt=(Ei,Mi,Ki,Ji,Er)=>{const Ti=Mi.programConfigurations.get(h.id),$i=g.isTileAffectedByFog(Ei),li=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ti,defines:Rt,overrideFog:$i}),dr=((vr,Nr,ar,Br,dn,pn,on,bn,An,Vn,Zn)=>({u_matrix:Nr,u_opacity:ar,u_ao_pass:Br?1:0,u_meter_to_tile:dn,u_ao:pn,u_flood_light_intensity:on,u_flood_light_color:bn,u_attenuation:An,u_edge_radius:Vn,u_fb:0,u_fb_size:Zn,u_dynamic_offset:1}))(0,Ji,ue,Z,Er,[be,ge*Er],Ce,$e,Ne,Ft>=17?0:Wt*Er,et?et.size[0]:0),Ni=[];We&&Ni.push(Mi.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(_t,li,Ei.toUnwrapped(),null,Et),li.draw(g,_t.gl.TRIANGLES,C,A,R,$,dr,h.id,Mi.vertexBuffer,Mi.indexBuffer,Ki,h.paint,Ft,Ti,Ni)};for(const Ei of y){const Mi=o.getTile(Ei),Ki=Mi.getBucket(h);if(!Ki||Ki.projection.name!==jt.projection.name||!Ki.groundEffect||Ki.groundEffect&&!Ki.groundEffect.hasData())continue;const Ji=Ki.groundEffect,Er=1/Ki.tileToMeter;{const Ti=g.translatePosMatrix(Ei.projMatrix,Mi,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$i=Ji.getDefaultSegment();qt(Ei,Ji,$i,Ti,Er)}if(Xe)for(let Ti=0;Ti<4;Ti++){const $i=i.dT[Ti](Ei),li=o.getTile($i);if(!li)continue;const dr=li.getBucket(h);if(!dr||dr.projection.name!==jt.projection.name||!dr.groundEffect||dr.groundEffect&&!dr.groundEffect.hasData())continue;const Ni=dr.groundEffect;let vr,Nr;Ti===0?(vr=[-8192,0,0],Nr=1):Ti===1?(vr=[i.aj,0,0],Nr=0):Ti===2?(vr=[0,-8192,0],Nr=3):(vr=[0,i.aj,0],Nr=2);const ar=Ni.regionSegments[Nr];if(!ar)continue;const Br=new Float32Array(16);i.bo(Br,Ei.projMatrix,vr),qt(Ei,Ni,ar,g.translatePosMatrix(Br,Mi,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Er)}}}function mn(g,o,h,y,C,A,R){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const $=A?A.findDEMTileFor(h):null;if(!($&&$.dem||R))return;A&&$&&$.dem&&y.selfDEMTileTimestamp!==$.dem._timestamp&&(y.borderDoneWithNeighborZ=[-1,-1,-1,-1],y.selfDEMTileTimestamp=$.dem._timestamp);const Z=Xe=>new i.P(Math.ceil((Xe+i.dX)*i.dY),0),se=Xe=>{const et=o.getSource().minzoom,_t=jt=>{const Ft=o.getTileByID(jt);if(Ft&&Ft.hasData())return Ft.getBucket(C)},Ct=[0,-1,1];for(const jt of Ct){if(Xe.overscaledZ+jt<et)continue;const Ft=_t(Xe.calculateScaledKey(Xe.overscaledZ+jt));if(Ft)return Ft}},ue=[0,0,0],be=(Xe,et)=>(ue[0]=Math.min(Xe.min.y,et.min.y),ue[1]=Math.max(Xe.max.y,et.max.y),ue[2]=i.aj-et.min.x>Xe.max.x?et.min.x-i.aj:Xe.max.x,ue),ge=(Xe,et)=>(ue[0]=Math.min(Xe.min.x,et.min.x),ue[1]=Math.max(Xe.max.x,et.max.x),ue[2]=i.aj-et.min.y>Xe.max.y?et.min.y-i.aj:Xe.max.y,ue),Ce=[(Xe,et)=>be(Xe,et),(Xe,et)=>be(et,Xe),(Xe,et)=>ge(Xe,et),(Xe,et)=>ge(et,Xe)],$e=(Xe,et,_t,Ct,jt,Ft,Rt)=>{if(!A)return 0;const Et=[[Ft?_t:Xe,Ft?Xe:_t,0],[Ft?_t:et,Ft?et:_t,0]],Wt=Rt<0?i.aj+Rt:Rt,qt=[Ft?Wt:(Xe+et)/2,Ft?(Xe+et)/2:Wt,0];return _t===0&&Rt<0||_t!==0&&Rt>0?A.getForTilePoints(jt,[qt],!0,Ct):Et.push(qt),A.getForTilePoints(h,Et,!0,$),Math.max(Et[0][2],Et[1][2],qt[2])/A.exaggeration()};for(let Xe=0;Xe<4;Xe++){const et=y.borderFeatureIndices[Xe];if(et.length===0)continue;const _t=i.dT[Xe](h),Ct=se(_t);if(!(Ct&&Ct instanceof i.dU))continue;const jt=A?A.findDEMTileFor(_t):null;if(!(jt&&jt.dem||R)||(A&&jt&&jt.dem&&y.borderDEMTileTimestamp[Xe]!==jt.dem._timestamp&&(y.borderDoneWithNeighborZ[Xe]=-1,y.borderDEMTileTimestamp[Xe]=jt.dem._timestamp),y.borderDoneWithNeighborZ[Xe]===Ct.canonical.z))continue;Ct.centroidVertexArray.length===0&&Ct.createCentroidsBuffer();const Ft=(Xe<2?1:5)-Xe,Rt=Ct.borderDoneWithNeighborZ[Ft]!==y.canonical.z,Et=Ct.borderFeatureIndices[Ft];let Wt=0;if(y.canonical.z!==Ct.canonical.z){for(const qt of et)y.showCentroid(y.featuresOnBorder[qt]);if(Rt)for(const qt of Et)Ct.showCentroid(Ct.featuresOnBorder[qt]);y.borderDoneWithNeighborZ[Xe]=Ct.canonical.z,Ct.borderDoneWithNeighborZ[Ft]=y.canonical.z}for(const qt of et){const Ei=y.featuresOnBorder[qt],Mi=y.centroidData[Ei.centroidDataIndex],Ki=Ei.borders[Xe];let Ji;for(;Wt<Et.length;){Ji=Ct.featuresOnBorder[Et[Wt]];const Er=Ji.borders[Ft];if(Er[1]>Ki[0]+3||Er[0]>Ki[0]-3)break;Ct.showCentroid(Ji),Wt++}if(Ji&&Wt<Et.length){const Er=Wt;let Ti=0;for(;!(Ji.borders[Ft][0]>Ki[1]-3)&&(Ti++,++Wt!==Et.length);)Ji=Ct.featuresOnBorder[Et[Wt]];Ji=Ct.featuresOnBorder[Et[Er]];let $i=!1;if(Ti>=1){const Ni=Ji.borders[Ft];Math.abs(Ki[0]-Ni[0])<3&&Math.abs(Ki[1]-Ni[1])<3&&(Ti=1,$i=!0,Wt=Er+1)}else if(Ti===0){y.showCentroid(Ei);continue}const li=Ct.centroidData[Ji.centroidDataIndex];R&&$i&&(((Ne=Mi).flags|(We=li).flags)&i.dW?(Ne.flags|=i.dW,We.flags|=i.dW):(Ne.flags&=2147483647,We.flags&=2147483647));const dr=Ei.intersectsCount()>1||Ji.intersectsCount()>1;if(Ti>1)Wt=Er,Mi.centroidXY=li.centroidXY=new i.P(0,0);else if(jt&&jt.dem&&!dr){const Ni=Ce[Xe](Mi,li),vr=Xe%2?i.aj-1:0,Nr=$e(Ni[0],Math.min(i.aj-1,Ni[1]),vr,jt,_t,Xe<2,Ni[2]);Mi.centroidXY=li.centroidXY=Z(Nr)}else dr?Mi.centroidXY=li.centroidXY=new i.P(0,0):(Mi.centroidXY=y.encodeBorderCentroid(Ei),li.centroidXY=Ct.encodeBorderCentroid(Ji));y.writeCentroidToBuffer(Mi),Ct.writeCentroidToBuffer(li)}else y.showCentroid(Ei)}y.borderDoneWithNeighborZ[Xe]=Ct.canonical.z,Ct.borderDoneWithNeighborZ[Ft]=y.canonical.z}var Ne,We;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const Ec=[1,0,0],D0=[0,1,0],mu=[0,0,1];function Hl(g,o,h){const y=h.transform,C=h.shadowRenderer;if(!C)return!0;const A=g.toUnwrapped(),R=y.tileSize*C._cascades[h.currentShadowCascade].scale;let $=o.maxHeight;if(y.elevation){const Ne=y.elevation.getMinMaxForTile(g);Ne&&($+=Ne.max)}const Z=[...C.shadowDirection];Z[2]=-Z[2];const se=C.computeSimplifiedTileShadowVolume(A,$,R,Z);if(!se)return!1;const ue=[Ec,D0,mu,Z,[Z[0],0,Z[2]],[0,Z[1],Z[2]]],be=y.projection.name==="globe",ge=y.scaleZoom(R),Ce=i.cn.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,ge,!be),$e=C.getCurrentCascadeFrustum();return Ce.intersectsPrecise(se.vertices,se.planes,ue)===0||$e.intersectsPrecise(se.vertices,se.planes,ue)===0}function $n(g){return[g[0]*i.dZ,g[1]*i.dZ,g[2]*i.dZ,0]}function kd(g,o,h,y,C,A,R,$,Z){const se=y.getSource(),ue=h.globeSharedBuffers;if(!ue)return;let be,ge,Ce;if(o&&(be=y.getTile(o)),se instanceof i.aP?(ge=se.texture,Ce=i.ds(0,0,h.transform)):be&&o&&(ge=be.texture,Ce=i.ds(o.canonical.z,o.canonical.x,h.transform)),!ge||!Ce)return;g||(Ce=i.cE(i.bz(),Ce,[1,-1,1]));const $e=h.context,Ne=$e.gl,We=C.paint.get("raster-resampling")==="nearest"?Ne.NEAREST:Ne.LINEAR,Xe=h.colorModeForDrapableLayerRenderPass(A),et=R.defines;et.push("GLOBE_POLES");const _t=new Gt(Ne.LEQUAL,Gt.ReadWrite,h.depthRangeFor3D),Ct=Float32Array.from(h.transform.expandedFarZProjMatrix),jt=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),$e.activeTexture.set(Ne.TEXTURE0),ge.bind(We,Ne.CLAMP_TO_EDGE),$e.activeTexture.set(Ne.TEXTURE1),ge.bind(We,Ne.CLAMP_TO_EDGE),"useMipmap"in ge&&$e.extTextureFilterAnisotropic&&h.transform.pitch>20&&Ne.texParameterf(Ne.TEXTURE_2D,$e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$e.extTextureFilterAnisotropicMax);const[Ft,Rt,Et,Wt]=o?ue.getPoleBuffers(o.canonical.z,!1):ue.getPoleBuffers(0,!0),qt=C.paint.get("raster-elevation");let Ei;g?(Ei=Ft,h.renderDefaultNorthPole=qt!==0):(Ei=Rt,h.renderDefaultSouthPole=qt!==0);const Mi=$n(R.mix),Ki=((Er,Ti,$i,li,dr,Ni,vr,Nr,ar,Br,dn,pn,on)=>bg(Er,Ti,$i,new Float32Array(16),new Float32Array(9),[0,0],li,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ni,[0,0],Nr,2,Br,dn,pn,1,0,on))(Ct,jt,Ce,i.ah(h.transform.zoom),0,C,0,qt,0,Mi,R.offset,R.range,A),Ji=h.getOrCreateProgram("raster",{defines:et});h.uploadCommonUniforms($e,Ji,null),Ji.draw(h,Ne.TRIANGLES,_t,Z,Xe,$,Ki,C.id,Ei,Et,Wt)}function Wp(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-o,C=.2*g.height,A=o+C;return[o,h,(A-C-o)/y,(A-o)/y]}function Pm(g,o,h,y){if(g)return o instanceof ra&&g instanceof Cs?o.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:$n(y.mix),offset:y.offset,buffer:0,tileSize:1}}var Kf=i.d_([{name:"a_index",type:"Int16",components:1}]);class vf{constructor(o,h,y,C){const A={width:y[0],height:y[1],data:null},R=o.gl;this.targetColorTexture=new i.T(o,A,R.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,A,R.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(h,C),this.lastInvalidatedAt=0}updateParticleTexture(o,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,C=h.width*h.height;this.particleTexture0=new i.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1});const A=new i.d$;A.reserve(C);for(let R=0;R<C;R++)A.emplaceBack(R);this.particleIndexBuffer=this.context.createVertexBuffer(A,Kf.members,!0),this.particleSegment=i.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mu(g,o,h){if(!g)return null;const y=o.getTextureDescriptor(g,h,!0);if(!y)return null;let{texture:C,mix:A,offset:R,tileSize:$,buffer:Z,format:se}=y;if(!C||!se)return null;let ue=!1;return se==="uint32"&&(ue=!0,A[3]=0,A=mf(i.e0,A,[0,h.paint.get("raster-particle-max-speed")]),R=Wy(i.e0,R,[0,h.paint.get("raster-particle-max-speed")])),{texture:C,textureOffset:[Z/($+2*Z),$/($+2*Z)],tileSize:$,scalarData:ue,scale:A,offset:R,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[se]]}}function P0(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-o,C=.2*g.height,A=o+C;return[o,h,(A-C-o)/y,(A-o)/y]}const O0=new i.am(1,0,0,1),dh=new i.am(0,1,0,1),Uh=new i.am(0,0,1,1),Om=new i.am(1,0,1,1),$h=new i.am(0,1,1,1);function Ju(g,o,h,y,C,A){for(let R=0;R<h.length;R++)if(C){const se=new i.am(y.r*.8,y.g*.8,y.b*.8,1);Ad(g,o,h[R],y,-1,-1,A),Ad(g,o,h[R],y,-1,1,A),Ad(g,o,h[R],y,1,1,A),Ad(g,o,h[R],y,1,-1,A),Ad(g,o,h[R],se,0,0,A)}else Ad(g,o,h[R],y,0,0,A)}function Ad(g,o,h,y,C,A,R){const $=g.context,Z=g.transform,se=$.gl,ue=Z.projection.name==="globe",be=ue?["PROJECTION_GLOBE_VIEW"]:[];let ge=i.bw(h.projMatrix);if(ue&&i.ah(Z.zoom)>0){const Mi=i.bg(h.canonical,Z),Ki=i.e1(Mi);ge=i.az(new Float32Array(16),Z.globeMatrix,Ki),i.az(ge,Z.projMatrix,ge)}const Ce=i.bz();Ce[12]+=2*C/(i.q.devicePixelRatio*Z.width),Ce[13]+=2*A/(i.q.devicePixelRatio*Z.height),i.az(ge,Ce,ge);const $e=g.getOrCreateProgram("debug",{defines:be}),Ne=o.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(Ne,$e);const We=Gt.disabled,Xe=sr.disabled,et=g.colorModeForRenderPass(),_t="$debug";$.activeTexture.set(se.TEXTURE0),g.emptyTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ue?Ne._makeGlobeTileDebugBuffers(g.context,Z):Ne._makeDebugTileBoundsBuffers(g.context,Z.projection);const Ct=Ne._tileDebugBuffer||g.debugBuffer,jt=Ne._tileDebugIndexBuffer||g.debugIndexBuffer,Ft=Ne._tileDebugSegments||g.debugSegments;if($e.draw(g,se.LINE_STRIP,We,Xe,et,hi.disabled,Mm(ge,y.toPremultipliedRenderColor(null)),_t,Ct,jt,Ft,null,null,null,[Ne._globeTileDebugBorderBuffer]),R){const Mi=Ne.latestRawTileData,Ki=Math.floor((Mi&&Mi.byteLength||0)/1024);let Ji=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ji+=` => ${h.overscaledZ}`),Ji+=` ${Ne.state}`,Ji+=` ${Ki}kb`,function(Er,Ti){Er.initDebugOverlayCanvas();const $i=Er.debugOverlayCanvas,li=Er.context.gl,dr=Er.debugOverlayCanvas.getContext("2d");dr.clearRect(0,0,$i.width,$i.height),dr.shadowColor="white",dr.shadowBlur=2,dr.lineWidth=1.5,dr.strokeStyle="white",dr.textBaseline="top",dr.font="bold 36px Open Sans, sans-serif",dr.fillText(Ti,5,5),dr.strokeText(Ti,5,5),Er.debugOverlayTexture.update($i),Er.debugOverlayTexture.bind(li.LINEAR,li.CLAMP_TO_EDGE)}(g,Ji)}const Rt=o.getTile(h).tileSize,Et=512/Math.min(Rt,512)*(h.overscaledZ/Z.zoom)*.5,Wt=Ne._tileDebugTextBuffer||g.debugBuffer,qt=Ne._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Ei=Ne._tileDebugTextSegments||g.debugSegments;$e.draw(g,se.TRIANGLES,We,Xe,Bi.alphaBlended,hi.disabled,Mm(ge,i.am.transparent.toPremultipliedRenderColor(null),Et),_t,Wt,qt,Ei,null,null,null,[Ne._globeTileDebugTextBuffer])}function Cl(g,o,h,y){jp(g,0,o+h/2,g.transform.width,h,y)}function Wd(g,o,h,y){jp(g,o-h/2,0,h,g.transform.height,y)}function jp(g,o,h,y,C,A){const R=g.context,$=R.gl;$.enable($.SCISSOR_TEST),$.scissor(o*i.q.devicePixelRatio,h*i.q.devicePixelRatio,y*i.q.devicePixelRatio,C*i.q.devicePixelRatio),R.clear({color:A}),$.disable($.SCISSOR_TEST)}const wg=i.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jd}=wg;function sa(g,o,h,y){g.emplaceBack(o,h,y)}class Rm{constructor(o){this.vertexArray=new i.e2,this.indices=new i.a_,sa(this.vertexArray,-1,-1,1),sa(this.vertexArray,1,-1,1),sa(this.vertexArray,-1,1,1),sa(this.vertexArray,1,1,1),sa(this.vertexArray,-1,-1,-1),sa(this.vertexArray,1,-1,-1),sa(this.vertexArray,-1,1,-1),sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,jd),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bd.simpleSegment(0,0,36,12)}}function Iu(g,o,h,y,C,A){const R=g.context.gl,$=o.paint.get("sky-atmosphere-color"),Z=o.paint.get("sky-atmosphere-halo-color"),se=o.paint.get("sky-atmosphere-sun-intensity"),ue=((be,ge,Ce,$e,Ne)=>({u_matrix_3f:be,u_sun_direction:ge,u_sun_intensity:Ce,u_color_tint_r:[$e.r,$e.g,$e.b,$e.a],u_color_tint_m:[Ne.r,Ne.g,Ne.b,Ne.a],u_luminance:5e-5}))(i.e4(i.dx(),y),C,se,$.toPremultipliedRenderColor(null),Z.toPremultipliedRenderColor(null));R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+A,o.skyboxTexture,0),h.draw(g,R.TRIANGLES,Gt.disabled,sr.disabled,Bi.unblended,hi.frontCW,ue,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const R0=i.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Nm{constructor(o){const h=new i.e5;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new i.a_;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,R0.members),this.indexBuffer=o.createIndexBuffer(y),this.segments=i.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ia=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Sg{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Qf{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Bi([1,Tr,1,Tr],i.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Bi([1,0,1,0],i.am.transparent,[!1,!1,!1,!0]),this.params=new Sg,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const h=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Nm(h);const y=this.params.sizeRange,C=this.params.intensityRange,A=function(ue){const be=i.e7(30),ge=[];for(let Ce=0;Ce<ue;++Ce){const $e=2*Math.PI*be(),Ne=Math.acos(1-2*be())-.5*Math.PI;ge.push(i.cS(Math.cos(Ne)*Math.cos($e),Math.cos(Ne)*Math.sin($e),Math.sin(Ne)))}return ge}(this.params.starsCount),R=i.e7(300),$=new i.e6,Z=new i.a_;let se=0;for(let ue=0;ue<A.length;++ue){const be=i.bY([],A[ue],200),ge=Math.max(0,1+.01*y*(1*R()-.5)),Ce=Math.max(0,1+.01*C*(1*R()-.5));$.emplaceBack(be[0],be[1],be[2],-1,-1,ge,Ce),$.emplaceBack(be[0],be[1],be[2],1,-1,ge,Ce),$.emplaceBack(be[0],be[1],be[2],1,1,ge,Ce),$.emplaceBack(be[0],be[1],be[2],-1,1,ge,Ce),Z.emplaceBack(se+0,se+1,se+2),Z.emplaceBack(se+0,se+2,se+3),se+=4}this.starsVx=h.createVertexBuffer($,Ia.members),this.starsIdx=h.createIndexBuffer(Z),this.starsSegments=i.bd.simpleSegment(0,0,$.length,Z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,h){const y=o.context,C=y.gl,A=o.transform,R=new Gt(C.LEQUAL,Gt.ReadOnly,[0,1]),$=i.ah(A.zoom),Z=o.style.getLut(h.scope),se=h.properties.get("color-use-theme")==="none",ue=h.properties.get("color").toNonPremultipliedRenderColor(se?null:Z).toArray01(),be=h.properties.get("high-color-use-theme")==="none",ge=h.properties.get("high-color").toNonPremultipliedRenderColor(be?null:Z).toArray01(),Ce=h.properties.get("space-color-use-theme")==="none",$e=h.properties.get("space-color").toNonPremultipliedRenderColor(Ce?null:Z).toArray01(),Ne=5e-4,We=i.e8(h.properties.get("horizon-blend"),0,1,Ne,.25),Xe=i.dl(o,y,A)&&We===Ne?A.worldSize/(2*Math.PI*1.025)-1:A.globeRadius,et=o.frameCounter/1e3%1,_t=i.ae(A.globeCenterInViewSpace),Ct=Math.sqrt(Math.pow(_t,2)-Math.pow(Xe,2)),jt=Math.acos(Ct/_t),Ft=Rt=>{const Et=A.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Rt&&Et.push("ALPHA_PASS");const Wt=o.getOrCreateProgram("globeAtmosphere",{defines:Et}),qt=((Mi,Ki,Ji,Er,Ti,$i,li,dr,Ni,vr,Nr,ar)=>({u_frustum_tl:Mi,u_frustum_tr:Ki,u_frustum_br:Ji,u_frustum_bl:Er,u_horizon:Ti,u_transition:$i,u_fadeout_range:li,u_color:dr,u_high_color:Ni,u_space_color:vr,u_temporal_offset:Nr,u_horizon_angle:ar}))(A.frustumCorners.TL,A.frustumCorners.TR,A.frustumCorners.BR,A.frustumCorners.BL,A.frustumCorners.horizon,$,We,ue,ge,$e,et,jt);o.uploadCommonUniforms(y,Wt);const Ei=this.atmosphereBuffer;Ei&&Wt.draw(o,C.TRIANGLES,R,sr.disabled,Rt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,hi.backCW,qt,Rt?"atmosphere_glow_alpha":"atmosphere_glow",Ei.vertexBuffer,Ei.indexBuffer,Ei.segments)};Ft(!1),Ft(!0)}drawStars(o,h){const y=i.ay(h.properties.get("star-intensity"),0,1);if(y===0)return;const C=o.context,A=C.gl,R=o.transform,$=o.getOrCreateProgram("stars"),Z=i.b_([]);i.c0(Z,Z,-R._pitch),i.b$(Z,Z,-R.angle),i.c0(Z,Z,i.al(R._center.lat)),i.e9(Z,Z,-i.al(R._center.lng));const se=i.c3(new Float32Array(16),Z),ue=i.az([],R.starsProjMatrix,se),be=i.e4([],se),ge=i.ea([],be),Ce=[0,1,0];i.dz(Ce,Ce,ge),i.bY(Ce,Ce,this.params.sizeMultiplier);const $e=[1,0,0];i.dz($e,$e,ge),i.bY($e,$e,this.params.sizeMultiplier);const Ne=(We=Ce,Xe=$e,et=y,{u_matrix:Float32Array.from(ue),u_up:We,u_right:Xe,u_intensity_multiplier:et});var We,Xe,et;o.uploadCommonUniforms(C,$),this.starsVx&&this.starsIdx&&$.draw(o,A.TRIANGLES,Gt.disabled,sr.disabled,this.colorModeAlphaBlendedWriteRGB,hi.disabled,Ne,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Md(g,o){const h=[...g],y=o.cameraWorldSizeForFog/o.worldSize,C=i.bx([]);return i.cE(C,C,[y,y,1]),i.az(h,C,h),i.az(h,o.worldToFogMatrix,h),h}function Wi(g,o,h,y,C){const A=h.material,R=y.context,{baseColorTexture:$,metallicRoughnessTexture:Z}=A.pbrMetallicRoughness,{normalTexture:se,occlusionTexture:ue,emissionTexture:be}=A;function ge($e,Ne,We){if($e&&(g.push(Ne),R.activeTexture.set(R.gl.TEXTURE0+We),$e.gfxTexture)){const{minFilter:Xe,magFilter:et,wrapS:_t,wrapT:Ct}=$e.sampler;$e.gfxTexture.bindExtraParam(Xe,et,_t,Ct)}}ge($,"HAS_TEXTURE_u_baseColorTexture",Ao.BaseColor),ge(Z,"HAS_TEXTURE_u_metallicRoughnessTexture",Ao.MetallicRoughness),ge(se,"HAS_TEXTURE_u_normalTexture",Ao.Normal),ge(ue,"HAS_TEXTURE_u_occlusionTexture",Ao.Occlusion),ge(be,"HAS_TEXTURE_u_emissionTexture",Ao.Emission),C&&(C.texture||(C.texture=new i.eh(y.context,C.image,[C.image.height,C.image.height,C.image.height],R.gl.RGBA8)),R.activeTexture.set(R.gl.TEXTURE0+Ao.LUT),C.texture&&C.texture.bind(R.gl.LINEAR,R.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(h.pbrBuffer)),A.alphaMode!=="OPAQUE"&&A.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),A.defined||g.push("DIFFUSE_SHADED");const Ce=y.shadowRenderer;Ce&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ce.useNormalOffset&&g.push("NORMAL_OFFSET"))}function cn(g,o,h,y,C,A){const R=h.paint.get("model-opacity").constantOr(1),$=o.context,Z=new Gt(o.context.gl.LEQUAL,Gt.ReadWrite,o.depthRangeFor3D),se=o.transform,ue=g.mesh,be=ue.material,ge=be.pbrMetallicRoughness,Ce=o.style.fog;let $e;$e=o.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:i.az([],y.zScaleMatrix,g.nodeModelMatrix),i.az($e,y.negCameraPosMatrix,$e);const Ne=i.bi([],$e);i.ee(Ne,Ne);const We=h.paint.get("model-color-use-theme").constantOr("default")==="none",Xe=h.paint.get("model-emissive-strength").constantOr(0),et=$p(new Float32Array(g.worldViewProjection),new Float32Array($e),new Float32Array(Ne),null,o,R,ge.baseColorFactor,be.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,be,Xe,h),_t={defines:[]},Ct=[],jt=o.shadowRenderer;jt&&(jt.useNormalOffset=!1),Wi(_t.defines,Ct,ue,o,We?null:h.lut);let Ft=null;if(Ce){const Wt=Md(g.nodeModelMatrix,o.transform);if(Ft=new Float32Array(Wt),se.projection.name!=="globe"){const qt=ue.aabb.min,Ei=ue.aabb.max,[Mi,Ki]=Ce.getOpacityForBounds(Wt,qt[0],qt[1],Ei[0],Ei[1]);_t.overrideFog=Mi>=Fi||Ki>=Fi}}const Rt=Jo(o,h.paint.get("model-cutoff-fade-range"));Rt.shouldRenderCutoff&&_t.defines.push("RENDER_CUTOFF");const Et=o.getOrCreateProgram("model",_t);o.uploadCommonUniforms($,Et,null,Ft,Rt),o.renderPass!=="shadow"&&jt&&jt.setupShadowsFromMatrix(g.nodeModelMatrix,Et),Et.draw(o,$.gl.TRIANGLES,Z,C,A,ue.material.doubleSided?hi.disabled:hi.backCCW,et,h.id,ue.vertexBuffer,ue.indexBuffer,ue.segments,h.paint,o.transform.zoom,void 0,Ct)}function Jf(g,o,h,y,C,A,R){let $;$=g.projection.name==="globe"?i.ed(h,g):[...h],i.az($,$,o.matrix);const Z=i.az([],y,$);if(o.meshes)for(const se of o.meshes){if(se.material.alphaMode!=="BLEND"){R.push({mesh:se,depth:0,modelIndex:C,worldViewProjection:Z,nodeModelMatrix:$});continue}const ue=i.ad([],se.centroid,Z);!g.isOrthographic&&ue[2]<=0||A.push({mesh:se,depth:ue[2],modelIndex:C,worldViewProjection:Z,nodeModelMatrix:$})}if(o.children)for(const se of o.children)Jf(g,se,h,y,C,A,R)}function ha(g,o,h,y){const C=h.shadowRenderer;if(!C)return;const A=C.getShadowPassDepthMode(),R=C.getShadowPassColorMode(),$=C.calculateShadowPassMatrixFromMatrix(o),Z=ry($);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,A,sr.disabled,R,hi.backCCW,Z,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,h.transform.zoom,void 0,void 0)}function wi(g,o,h){const y=o.updateZoomBasedPaintProperties(),C=function(A,R,$){let Z,se,ue,be=A.terrain?A.terrain.exaggeration():0;if(A.terrain&&be>0){const ge=A.terrain,Ce=ge.findDEMTileFor($);Ce&&Ce.dem?Z=i.ei.create(ge,$,Ce):be=0}if(be===0&&(R.terrainElevationMin=0,R.terrainElevationMax=0),be===R.validForExaggeration&&(be===0||Z&&Z._demTile&&Z._demTile.tileID===R.validForDEMTile.id&&Z._dem._timestamp===R.validForDEMTile.timestamp))return!1;for(const ge in R.instancesPerModel){const Ce=R.instancesPerModel[ge];for(let $e=0;$e<Ce.instancedDataArray.length;++$e){const Ne=(Z?be*Z.getElevationAt(0|Ce.instancedDataArray.float32[16*$e],0|Ce.instancedDataArray.float32[16*$e+1],!0,!0):0)+Ce.instancesEvaluatedElevation[$e];Ce.instancedDataArray.float32[16*$e+6]=Ne,se=se?Math.min(R.terrainElevationMin,Ne):Ne,ue=ue?Math.max(R.terrainElevationMax,Ne):Ne}}return R.terrainElevationMin=se||0,R.terrainElevationMax=ue||0,R.validForExaggeration=be,R.validForDEMTile=Z&&Z._demTile?{id:Z._demTile.tileID,timestamp:Z._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,o,h);(y||C)&&(o.uploaded=!1,o.upload(g.context))}const kh={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cW([0,0,0],[i.aj,i.aj,0])};function Tg(g,o){const h=1<<g.canonical.z,y=o.getFreeCameraOptions().position,C=o.elevation,A=g.canonical.x/h,R=(g.canonical.x+1)/h,$=g.canonical.y/h,Z=(g.canonical.y+1)/h;let se=o._centerAltitude;if(C){const Ce=C.getMinMaxForTile(g);Ce&&Ce.max>se&&(se=Ce.max)}const ue=i.ay(y.x,A,R)-y.x,be=i.ay(y.y,$,Z)-y.y,ge=i.c6(se,o.center.lat)-y.z;return o._zoomFromMercatorZ(Math.sqrt(ue*ue+be*be+ge*ge))}function La(g,o,h,y,C,A,R){const $=g.context,Z=g.renderPass==="shadow",se=g.shadowRenderer,ue=Z&&se?se.getShadowPassDepthMode():new Gt($.gl.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D),be=g.isTileAffectedByFog(A);if(h.meshes)for(const ge of h.meshes){const Ce=["MODEL_POSITION_ON_GPU"],$e=[];let Ne,We,Xe;y.instancedDataArray.length>20&&Ce.push("INSTANCED_ARRAYS");const et=Jo(g,o.paint.get("model-cutoff-fade-range"));if(et.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Z&&se)Ne=g.getOrCreateProgram("modelDepth",{defines:Ce}),We=ry(R.shadowTileMatrix,R.shadowTileMatrix,Float32Array.from(h.matrix)),Xe=se.getShadowPassColorMode();else{Wi(Ce,$e,ge,g,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),Ne=g.getOrCreateProgram("model",{defines:Ce,overrideFog:be});const Ct=ge.material,jt=Ct.pbrMetallicRoughness,Ft=o.paint.get("model-opacity").constantOr(1),Rt=o.paint.get("model-emissive-strength").constantOr(0);We=$p(A.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,g,Ft,jt.baseColorFactor,Ct.emissiveFactor,jt.metallicFactor,jt.roughnessFactor,Ct,Rt,o,C),se&&(R.shadowUniformsInitialized?Ne.setShadowUniformValues($,se.getShadowUniformValues()):(se.setupShadows(A.toUnwrapped(),Ne,"model-tile",A.overscaledZ),R.shadowUniformsInitialized=!0)),Xe=et.shouldRenderCutoff||Ft<1||Ct.alphaMode!=="OPAQUE"?Bi.alphaBlended:Bi.unblended}g.uploadCommonUniforms($,Ne,A.toUnwrapped(),null,et);const _t=ge.material.doubleSided?hi.disabled:hi.backCCW;if(y.instancedDataArray.length>20)$e.push(y.instancedDataBuffer),Ne.draw(g,$.gl.TRIANGLES,ue,sr.disabled,Xe,_t,We,o.id,ge.vertexBuffer,ge.indexBuffer,ge.segments,o.paint,g.transform.zoom,void 0,$e,y.instancedDataArray.length);else{const Ct=Z?"u_instance":"u_normal_matrix";for(let jt=0;jt<y.instancedDataArray.length;++jt)We[Ct]=new Float32Array(y.instancedDataArray.arrayBuffer,64*jt,16),Ne.draw(g,$.gl.TRIANGLES,ue,sr.disabled,Xe,_t,We,o.id,ge.vertexBuffer,ge.indexBuffer,ge.segments,o.paint,g.transform.zoom,void 0,$e)}}if(h.children)for(const ge of h.children)La(g,o,ge,y,C,A,R)}const sy=[1,-1,1];function Bm(g,o,h,y){if(!h.modelManager)return!0;const C=h.modelManager;if(!h.shadowRenderer)return!0;const A=h.shadowRenderer,R=o.aabb;let $=!0,Z=g.maxHeight;if(Z===0){let ue=0;for(const be in g.instancesPerModel){const ge=C.getModel(be,y);ge?ue=Math.max(ue,Math.max(Math.max(ge.aabb.max[0],ge.aabb.max[1]),ge.aabb.max[2])):$=!1}Z=g.maxScale*ue*1.41+g.maxVerticalOffset,$&&(g.maxHeight=Z)}R.max[2]=Z,R.min[2]+=g.terrainElevationMin,R.max[2]+=g.terrainElevationMax,i.ad(R.min,R.min,o.tileMatrix),i.ad(R.max,R.max,o.tileMatrix);const se=R.intersects(A.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=se===2),se===0}function kc(g,o){const h=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],C=g.uniformValues.u_cutoff_params[2],A=g.uniformValues.u_cutoff_params[3];return y===h||A===C?1:i.ay(((o-h)/(y-h)-C)/(A-C),0,1)}function xf(g,o,h,y){if(o.pitch<20)return 1;const C=o.getWorldToCameraMatrix();i.az(C,C,g);const A=i.ej(h.min[0],h.min[1],h.min[2],1);let R=i.aA(i.ek(),A,C),$=R,Z=R;A[1]=h.max[1],R=i.aA(i.ek(),A,C),$=R[1]<$[1]?R:$,Z=R[1]>Z[1]?R:Z,A[0]=h.max[0],R=i.aA(i.ek(),A,C),$=R[1]<$[1]?R:$,Z=R[1]>Z[1]?R:Z,A[1]=h.min[1],R=i.aA(i.ek(),A,C),$=R[1]<$[1]?R:$,Z=R[1]>Z[1]?R:Z;const se=i.ay(y[0],0,1),ue=100*o.pixelsPerMeter*i.ay(y[1],0,1),be=i.ay(y[2],0,1),ge=i.el(i.ek(),$,Z,se),Ce=Math.tan(.5*o.fovX),$e=-ge[2]*Ce;if(ue===0)return ge[1]<-Math.abs($e)?be:1;const Ne=(-Math.abs($e)-ge[1])/ue,We=(et,_t,Ct)=>(1-Ct)*et+Ct*_t,Xe=i.ay(We(1,be,Ne),be,1);return We(1,Xe,i.ay((o.pitch-20)/20,0,1))}class ph{}class Lu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,h,y){{const be=this._storage.get(h.id);if(be)return be.lastUsedFrameIdx=o,be.buf}const C=y.gl,A=C.getBufferParameter(C.ELEMENT_ARRAY_BUFFER,C.BUFFER_SIZE),R=new ArrayBuffer(A),$=new Int16Array(R);C.getBufferSubData(C.ELEMENT_ARRAY_BUFFER,0,new Int16Array(R));const Z=new i.en;for(let be=0;be<A/2;be+=3){const ge=$[be],Ce=$[be+1],$e=$[be+2];Z.emplaceBack(ge,Ce),Z.emplaceBack(Ce,$e),Z.emplaceBack($e,ge)}const se=y.bindVertexArrayOES.current,ue=new ph;return ue.buf=new gh(y,Z),ue.lastUsedFrameIdx=o,this._storage.set(h.id,ue),y.bindVertexArrayOES.set(se),ue.buf}update(o){for(const[h,y]of this._storage)o-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(h))}destroy(){for(const[o,h]of this._storage)h.buf.destroy(),this._storage.delete(o)}}class Jh{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ed=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class nc{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Gl{constructor(o,h){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const oy=i.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Vh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,h){const y=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const R=new i.eo,$=new i.a_;R.emplaceBack(-1,-1),R.emplaceBack(1,-1),R.emplaceBack(1,1),R.emplaceBack(-1,1),$.emplaceBack(0,1,2),$.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(R,oy.members),this.vignetteIdx=o.context.createIndexBuffer($)}const C=i.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,y);const R={u_vignetteShape:(A={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:A.vignetteColor};y.draw(o,o.context.gl.TRIANGLES,Gt.disabled,sr.disabled,Bi.alphaBlended,hi.disabled,R,"vignette",this.vignetteVx,this.vignetteIdx,C)}var A}}class yh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,h){const y=o.getFreeCameraOptions().position,C=y.toAltitude(),A=y.toLngLat(),R=i.al(A.lng),$=i.al(A.lat),Z=o.pixelsPerMeter/h,se=R*i.eq,ue=i.eq*Math.log(Math.tan(Math.PI/4+$/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const be=-this._offsetYPrev+ue,ge=-this._elevationPrev+C;this._accumulatedOffsetX+=(-this._offsetXPrev+se)*Z,this._accumulatedOffsetY+=be*Z,this._accumulatedElevation+=ge*Z,this._offsetXPrev=se,this._offsetYPrev=ue,this._elevationPrev=C}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function vp(g,o){return[-(g[0]-Math.floor(g[0]/o)*o),-(g[1]-Math.floor(g[1]/o)*o),-(g[2]-Math.floor(g[2]/o)*o)]}function Rc(g){const o=i.e7(1323123451230),h=[];for(let y=0;y<g;++y){const C=2*o()-1,A=2*o()-1,R=2*o()-1;h.push(i.cS(C,A,R))}return h}function eu(g,o,h,y,C){const A=i.ay((C-h)/(y-h),0,1);return(1-A)*g+A*o}class th{constructor(o){this._movement=new yh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Vh,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,h){const y=o.transform;this._movement.update(y,this._ppmScaleFactor);const C=y.starsProjMatrix,A=i.b_([]);i.c0(A,A,i.al(90)-y._pitch),i.b$(A,A,-y.angle);const R=i.c3(new Float32Array(16),A),$=i.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),Z=i.ee([],$),se=i.az([],Z,R),ue=Date.now()/1e3;return this._accumulatedTimeFromStart+=(ue-this._prevTime)*h,this._prevTime=ue,{projectionMatrix:C,modelviewMatrix:se}}}class Hd extends th{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Gl(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const y=Rc(this.particlesCount),C=new i.er,A=new i.a_;let R=0;const $=i.e7(1323123451230);for(let Z=0;Z<y.length;++Z){const se=y[Z],ue=[2*$()-1,$(),$(),$()];C.emplaceBack(se[0],se[1],se[2],-1,-1,...ue),C.emplaceBack(se[0],se[1],se[2],1,-1,...ue),C.emplaceBack(se[0],se[1],se[2],1,1,...ue),C.emplaceBack(se[0],se[1],se[2],-1,1,...ue),A.emplaceBack(R+0,R+1,R+2),A.emplaceBack(R+0,R+2,R+3),R+=4}this.particlesVx=h.createVertexBuffer(C,ed.members),this.particlesIdx=h.createIndexBuffer(A)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=o.transform.zoom;if(h.revealStart>y)return;const C=eu(0,1,h.revealStart,h.revealStart+h.revealRange,y);if(!this.particlesVx||!this.particlesIdx)return;const A=structuredClone(this._params);let R=[-A.direction.x,A.direction.y,-100];i.au(R,R);const $=structuredClone(this._vignetteParams);$.strength*=C,A.overrideStyleParameters||(A.intensity=o.style.rain.state.density,A.timeFactor=o.style.rain.state.intensity,A.color=structuredClone(o.style.rain.state.color),R=structuredClone(o.style.rain.state.direction),A.screenThinning.intensity=o.style.rain.state.centerThinning,A.dropletSizeX=o.style.rain.state.dropletSize[0],A.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],A.distortionStrength=100*o.style.rain.state.distortionStrength,$.strength=1,$.color=structuredClone(o.style.rain.state.vignetteColor));const Z=this.updateOnRender(o,A.timeFactor),se=o.context,ue=se.gl,be=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(se,{width:o.width,height:o.height,data:null},ue.RGBA8)),A.distortionStrength>0&&(se.activeTexture.set(ue.TEXTURE0),this.screenTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ue.copyTexSubImage2D(ue.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const ge=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(se,ge),se.activeTexture.set(ue.TEXTURE0),this.screenTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ce=[A.color.r,A.color.g,A.color.b,A.color.a],$e=(Ne,We)=>{const Xe=vp(this._movement.getPosition(),Ne),et=A.dropletSizeX,_t=A.dropletSizeX*A.dropletSizeYScale,Ct=o.width/2,jt=o.height/2,Ft=eu(0,A.screenThinning.start,0,1,A.screenThinning.intensity),Rt=eu(.001,A.screenThinning.range,0,1,A.screenThinning.intensity),Et=eu(0,A.screenThinning.particleOffset,0,1,A.screenThinning.intensity),Wt=(qt={modelview:Z.modelviewMatrix,projection:Z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Xe,velocityConeAperture:A.velocityConeAperture,velocity:A.velocity,boxSize:Ne,rainDropletSize:[et,_t],distortionStrength:A.distortionStrength,rainDirection:R,color:Ce,screenSize:[be.width,be.height],thinningCenterPos:[Ct,jt],thinningShape:[Ft,Rt,Math.pow(10,A.screenThinning.fadePower)],thinningAffectedRatio:A.screenThinning.affectedRatio,thinningParticleOffset:Et,shapeDirectionalPower:A.shapeDirPower,shapeNormalPower:A.shapeNormalPower,mode:We?0:1},{u_modelview:Float32Array.from(qt.modelview),u_projection:Float32Array.from(qt.projection),u_time:qt.time,u_cam_pos:qt.camPos,u_texScreen:0,u_velocityConeAperture:qt.velocityConeAperture,u_velocity:qt.velocity,u_boxSize:qt.boxSize,u_rainDropletSize:qt.rainDropletSize,u_distortionStrength:qt.distortionStrength,u_rainDirection:qt.rainDirection,u_color:qt.color,u_screenSize:qt.screenSize,u_thinningCenterPos:qt.thinningCenterPos,u_thinningShape:qt.thinningShape,u_thinningAffectedRatio:qt.thinningAffectedRatio,u_thinningParticleOffset:qt.thinningParticleOffset,u_shapeDirectionalPower:qt.shapeDirectionalPower,u_shapeNormalPower:qt.shapeNormalPower,u_mode:qt.mode});var qt;const Ei=Math.round(A.intensity*this.particlesCount),Mi=i.bd.simpleSegment(0,0,4*Ei,2*Ei);ge.draw(o,ue.TRIANGLES,Gt.disabled,sr.disabled,Bi.alphaBlended,hi.disabled,Wt,"rain_particles",this.particlesVx,this.particlesIdx,Mi)};A.distortionStrength>0&&$e(A.boxSize,!0),$e(A.boxSize,!1),this._vignette.draw(o,$)}}const ql=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Va extends th{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Gl(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const y=Rc(this.particlesCount),C=new i.es,A=new i.a_;let R=0;const $=i.e7(1323123451230);for(let Z=0;Z<y.length;++Z){const se=y[Z],ue=$(),be=$(),ge=$(),Ce=[Z/y.length,ue,be,ge],$e=[$(),$()];C.emplaceBack(se[0],se[1],se[2],-1,-1,...Ce,...$e),C.emplaceBack(se[0],se[1],se[2],1,-1,...Ce,...$e),C.emplaceBack(se[0],se[1],se[2],1,1,...Ce,...$e),C.emplaceBack(se[0],se[1],se[2],-1,1,...Ce,...$e),A.emplaceBack(R+0,R+1,R+2),A.emplaceBack(R+0,R+2,R+3),R+=4}this.particlesVx=h.createVertexBuffer(C,ql.members),this.particlesIdx=h.createIndexBuffer(A)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const h=structuredClone(this._params);let y=[-h.direction.x,h.direction.y,-100];i.au(y,y);const C=structuredClone(this._vignetteParams),A=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},R=o.transform.zoom;if(A.revealStart>R)return;const $=eu(0,1,A.revealStart,A.revealStart+A.revealRange,R);C.strength*=$,h.overrideStyleParameters||(h.intensity=o.style.snow.state.density,h.timeFactor=o.style.snow.state.intensity,h.color=structuredClone(o.style.snow.state.color),y=structuredClone(o.style.snow.state.direction),h.screenThinning.intensity=o.style.snow.state.centerThinning,h.billboardSize=2.79*o.style.snow.state.flakeSize,C.strength=1,C.color=structuredClone(o.style.snow.state.vignetteColor));const Z=this.updateOnRender(o,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const se=o.context,ue=se.gl,be=o.transform,ge=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(se,ge),((Ce,$e,Ne)=>{const We=vp(this._movement.getPosition(),Ce),Xe=be.width/2,et=be.height/2,_t=eu(0,Ne.screenThinning.start,0,1,Ne.screenThinning.intensity),Ct=eu(.001,Ne.screenThinning.range,0,1,Ne.screenThinning.intensity),jt=eu(0,Ne.screenThinning.particleOffset,0,1,Ne.screenThinning.intensity),Ft=(Rt={modelview:Z.modelviewMatrix,projection:Z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:We,velocityConeAperture:Ne.velocityConeAperture,velocity:Ne.velocity,horizontalOscillationRadius:Ne.horizontalOscillationRadius,horizontalOscillationRate:Ne.horizontalOscillationRate,boxSize:Ce,billboardSize:1*Ne.billboardSize,simpleShapeParameters:[Ne.shapeFadeStart,Ne.shapeFadePower],screenSize:[be.width,be.height],thinningCenterPos:[Xe,et],thinningShape:[_t,Ct,Math.pow(10,Ne.screenThinning.fadePower)],thinningAffectedRatio:Ne.screenThinning.affectedRatio,thinningParticleOffset:jt,color:[Ne.color.r,Ne.color.g,Ne.color.b,Ne.color.a],direction:y},{u_modelview:Float32Array.from(Rt.modelview),u_projection:Float32Array.from(Rt.projection),u_time:Rt.time,u_cam_pos:Rt.camPos,u_velocityConeAperture:Rt.velocityConeAperture,u_velocity:Rt.velocity,u_horizontalOscillationRadius:Rt.horizontalOscillationRadius,u_horizontalOscillationRate:Rt.horizontalOscillationRate,u_boxSize:Rt.boxSize,u_billboardSize:Rt.billboardSize,u_simpleShapeParameters:Rt.simpleShapeParameters,u_screenSize:Rt.screenSize,u_thinningCenterPos:Rt.thinningCenterPos,u_thinningShape:Rt.thinningShape,u_thinningAffectedRatio:Rt.thinningAffectedRatio,u_thinningParticleOffset:Rt.thinningParticleOffset,u_particleColor:Rt.color,u_direction:Rt.direction});var Rt;const Et=Math.round(Ne.intensity*this.particlesCount),Wt=i.bd.simpleSegment(0,0,4*Et,2*Et);this.particlesVx&&this.particlesIdx&&ge.draw(o,ue.TRIANGLES,Gt.disabled,sr.disabled,Bi.alphaBlended,hi.disabled,Ft,"snow_particles",this.particlesVx,this.particlesIdx,Wt)})(h.boxSize,0,h),this._vignette.draw(o,C)}}const lo={symbol:function(g,o,h,y,C){if(g.renderPass!=="translucent")return;const A=sr.disabled,R=g.colorModeForRenderPass(),$=h.layout.get("text-variable-anchor"),Z=h.layout.get("text-size-scale-range"),se=i.ay(g.scaleFactor,Z[0],Z[1]);$&&function(ge,Ce,$e,Ne,We,Xe,et,_t){const Ct=Ce.transform,jt=We==="map",Ft=Xe==="map";for(const Rt of ge){const Et=Ne.getTile(Rt),Wt=Et.getBucket($e);if(!Wt||!Wt.text||!Wt.text.segments.get().length)continue;const qt=i.bH(Wt.textSizeData,Ct.zoom,_t),Ei=lf(Rt,Wt.getProjection(),Ct),Mi=Ct.calculatePixelsToTileUnitsMatrix(Et),Ki=Nh(Ei,Et.tileID.canonical,Ft,jt,Ct,Wt.getProjection(),Mi),Ji=Wt.hasIconTextFit()&&Wt.hasIconData();qt&&ny(Wt,jt,Ft,et,Ct,Ki,Rt,Math.pow(2,Ct.zoom-Et.tileID.overscaledZ),qt,Ji)}}(y,g,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),C,se);const ue=h.paint.get("icon-opacity").constantOr(1)!==0,be=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(ue||be)?Ed(g,o,h,y,A,R):(ue&&Ed(g,o,h,y,A,R,{onlyIcons:!0}),be&&Ed(g,o,h,y,A,R,{onlyText:!0})),o.map.showCollisionBoxes&&(jl(g,o,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),jl(g,o,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,h,y){if(g.renderPass!=="translucent")return;const C=h.paint.get("circle-opacity"),A=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),$=h.layout.get("circle-sort-key").constantOr(1)!==void 0,Z=h.paint.get("circle-emissive-strength");if(C.constantOr(1)===0&&(A.constantOr(1)===0||R.constantOr(1)===0))return;const se=g.context,ue=se.gl,be=g.transform,ge=!(!g.terrain||!g.terrain.enabled),Ce=h.layout.get("circle-elevation-reference"),$e=g.depthModeForSublayer(0,Gt.ReadOnly),Ne=new Gt(g.context.gl.LEQUAL,Gt.ReadOnly,g.depthRangeFor3D),We=Ce==="none"||ge?$e:Ne,Xe=sr.disabled,et=g.colorModeForDrapableLayerRenderPass(Z),_t=be.projection.name==="globe",Ct=[i.aD(be.center.lng),i.aH(be.center.lat)],jt=[];for(let Rt=0;Rt<y.length;Rt++){const Et=y[Rt],Wt=o.getTile(Et),qt=Wt.getBucket(h);if(!qt||qt.projection.name!==be.projection.name)continue;const Ei=qt.programConfigurations.get(h.id),Mi=qt.layoutVertexBuffer,Ki=qt.globeExtVertexBuffer,Ji=qt.indexBuffer,Er=i.dK(h),Ti=[Ki],$i=g.isTileAffectedByFog(Et);_t&&Er.push("PROJECTION_GLOBE_VIEW"),Er.push("DEPTH_D24"),g.terrain&&be.depthOcclusionForSymbolsAndCircles&&Er.push("DEPTH_OCCLUSION"),qt.hasElevation&&(Er.push("ELEVATED_ROADS"),Ti.push(qt.elevatedLayoutVertexBuffer));const li=g.getOrCreateProgram("circle",{config:Ei,defines:Er,overrideFog:$i}),dr=be.projection.createInversionMatrix(be,Et.canonical),Ni={programConfiguration:Ei,program:li,layoutVertexBuffer:Mi,dynamicBuffers:Ti,indexBuffer:Ji,uniformValues:i.dL(g,Et,Wt,dr,Ct,h),tile:Wt};if($){const vr=qt.segments.get();for(const Nr of vr)jt.push({segments:new i.bd([Nr]),sortKey:Nr.sortKey,state:Ni})}else jt.push({segments:qt.segments,sortKey:0,state:Ni})}$&&jt.sort((Rt,Et)=>Rt.sortKey-Et.sortKey);const Ft={useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles};for(const Rt of jt){const{programConfiguration:Et,program:Wt,layoutVertexBuffer:qt,dynamicBuffers:Ei,indexBuffer:Mi,uniformValues:Ki,tile:Ji}=Rt.state,Er=Rt.segments;g.terrain&&g.terrain.setupElevationDraw(Ji,Wt,Ft),g.uploadCommonUniforms(se,Wt,Ji.tileID.toUnwrapped()),Wt.draw(g,ue.TRIANGLES,We,Xe,et,hi.disabled,Ki,h.id,qt,Mi,Er,h.paint,be.zoom,Et,Ei)}},heatmap:function(g,o,h,y){if(h.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const C=g.context,A=C.gl,R=sr.disabled,$=new Bi([A.ONE,A.ONE,A.ONE,A.ONE],i.am.transparent,[!0,!0,!0,!0]);(function(Ce,$e,Ne,We){const Xe=Ce.gl,et=$e.width*We,_t=$e.height*We;Ce.activeTexture.set(Xe.TEXTURE1),Ce.viewport.set([0,0,et,_t]);let Ct=Ne.heatmapFbo;if(!Ct||Ct&&(Ct.width!==et||Ct.height!==_t)){Ct&&Ct.destroy();const jt=Xe.createTexture();Xe.bindTexture(Xe.TEXTURE_2D,jt),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_S,Xe.CLAMP_TO_EDGE),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_T,Xe.CLAMP_TO_EDGE),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MIN_FILTER,Xe.LINEAR),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MAG_FILTER,Xe.LINEAR),Ct=Ne.heatmapFbo=Ce.createFramebuffer(et,_t,!0,null),function(Ft,Rt,Et,Wt,qt,Ei){const Mi=Ft.gl;Mi.texImage2D(Mi.TEXTURE_2D,0,Ft.extRenderToTextureHalfFloat?Mi.RGBA16F:Mi.RGBA,qt,Ei,0,Mi.RGBA,Ft.extRenderToTextureHalfFloat?Mi.HALF_FLOAT:Mi.UNSIGNED_BYTE,null),Wt.colorAttachment.set(Et)}(Ce,0,jt,Ct,et,_t)}else Xe.bindTexture(Xe.TEXTURE_2D,Ct.colorAttachment.get()),Ce.bindFramebuffer.set(Ct.framebuffer)})(C,g,h,g.transform.projection.name==="globe"?.5:.25),C.clear({color:i.am.transparent});const Z=g.transform,se=Z.projection.name==="globe",ue=se?["PROJECTION_GLOBE_VIEW"]:[],be=se?hi.frontCCW:hi.disabled,ge=[i.aD(Z.center.lng),i.aH(Z.center.lat)];for(let Ce=0;Ce<y.length;Ce++){const $e=y[Ce];if(o.hasRenderableParent($e))continue;const Ne=o.getTile($e),We=Ne.getBucket(h);if(!We||We.projection.name!==Z.projection.name)continue;const Xe=g.isTileAffectedByFog($e),et=We.programConfigurations.get(h.id),_t=g.getOrCreateProgram("heatmap",{config:et,defines:ue,overrideFog:Xe}),{zoom:Ct}=g.transform;g.terrain&&g.terrain.setupElevationDraw(Ne,_t),g.uploadCommonUniforms(C,_t,$e.toUnwrapped());const jt=Z.projection.createInversionMatrix(Z,$e.canonical);_t.draw(g,A.TRIANGLES,Gt.disabled,R,$,be,Lm(g,$e,Ne,jt,ge,Ct,h.paint.get("heatmap-intensity")),h.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,h.paint,g.transform.zoom,et,se?[We.globeExtVertexBuffer]:null)}C.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(C,A){const R=C.context,$=R.gl,Z=A.heatmapFbo;if(!Z)return;R.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Z.colorAttachment.get()),R.activeTexture.set($.TEXTURE1);let se=A.colorRampTexture;se||(se=A.colorRampTexture=new i.T(R,A.colorRamp,$.RGBA8)),se.bind($.LINEAR,$.CLAMP_TO_EDGE),C.getOrCreateProgram("heatmapTexture").draw(C,$.TRIANGLES,Gt.disabled,sr.disabled,C.colorModeForRenderPass(),hi.disabled,((ue,be,ge,Ce)=>({u_image:0,u_color_ramp:1,u_opacity:be.paint.get("heatmap-opacity")}))(0,A),A.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,A.paint,C.transform.zoom)}(g,h))},line:function(g,o,h,y){if(g.renderPass!=="translucent")return;const C=h.paint.get("line-opacity"),A=h.paint.get("line-width");if(C.constantOr(1)===0||A.constantOr(1)===0)return;const R=h.paint.get("line-emissive-strength"),$=h.paint.get("line-occlusion-opacity"),Z=h.layout.get("line-elevation-reference"),se=h.layout.get("line-width-unit")==="meters",ue=Z==="sea",be=!(!g.terrain||!g.terrain.enabled),ge=g.context,Ce=ge.gl;if(h.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const $e=h.layout.get("line-cross-slope"),Ne=$e!==void 0,We=$e<1,Xe=g.colorModeForDrapableLayerRenderPass(R),et=g.terrain&&g.terrain.renderingToTexture,_t=et?1:i.q.devicePixelRatio,Ct=h.paint.get("line-dasharray"),jt=Ct.constantOr(1),Ft=h.layout.get("line-cap"),Rt=Ct.constantOr(null),Et=Ft.constantOr(null),Wt=h.paint.get("line-pattern"),qt=Wt.constantOr(1),Ei=h.paint.get("line-pattern-cross-fade"),Mi=Wt.constantOr(null),Ki=h.paint.get("line-opacity").constantOr(1);let Ji=!qt&&Ki!==1||g.depthOcclusion&&$>0&&$<1;const Er=h.paint.get("line-gradient"),Ti=qt?"linePattern":"line",$i=i.dM(h);let li;if(et&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Ji=!1),$!==0&&g.depthOcclusion){const Nr=h.paint._values["line-opacity"];Nr&&Nr.value&&Nr.value.kind==="constant"?li=Nr.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}A.value.kind!=="constant"&&A.value.isLineProgressConstant===!1&&$i.push("VARIABLE_LINE_WIDTH");const dr=(Nr,ar,Br,dn,pn,on)=>{for(const bn of Nr){const An=o.getTile(bn);if(qt&&!An.patternsLoaded())continue;const Vn=An.getBucket(h);if(!Vn||Vn.elevationType!=="none"&&!pn||Vn.elevationType==="none"&&pn)continue;g.prepareDrawTile();const Zn=[...ar],ys=g.shadowRenderer,Bo=Vn.elevationType==="road"&&!!ys&&ys.enabled;let Da=[0,0,0];if(Bo){const Ws=g.style.directionalLight,ec=g.style.ambientLight;Ws&&ec&&(Da=Vl(g.style,Ws,ec)),Zn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const xo=Vn.programConfigurations.get(h.id);let ia=!1;if(Mi&&An.imageAtlas){const Ws=i.dN.from(Mi),ec=Ws.getPrimary().scaleSelf(_t).toString(),Ta=An.imageAtlas.patternPositions.get(ec),Ca=Ws.getSecondary(),Ko=Ca?An.imageAtlas.patternPositions.get(Ca.scaleSelf(_t).toString()):null;ia=!!Ta&&!!Ko,Ta&&xo.setConstantPatternPositions(Ta,Ko)}Ei>0&&(ia||xo.getPatternTransitionVertexBuffer("line-pattern"))&&Zn.push("LINE_PATTERN_TRANSITION");const sl=g.isTileAffectedByFog(bn),ls=g.getOrCreateProgram(Ti,{config:xo,defines:Zn,overrideFog:sl,overrideRtt:!pn&&void 0});if(!qt&&Rt&&Et&&An.lineAtlas){const Ws=An.lineAtlas.getDash(Rt,Et);Ws&&xo.setConstantPatternPositions(Ws)}Bo&&ys.setupShadows(An.tileID.toUnwrapped(),ls,"vector-tile",An.tileID.overscaledZ);let[cs,Ts]=h.paint.get("line-trim-offset");(Et==="round"||Et==="square")&&cs!==Ts&&(cs===0&&(cs-=1),Ts===1&&(Ts+=1));const _a=et?bn.projMatrix:null,Jl=se?1/Vn.tileToMeter/i.aw(An,1,g.transform.zoom):1,Zo=se?1/Vn.tileToMeter/i.aw(An,1,Math.floor(g.transform.zoom)):1,Wo=qt?i.dO(g,An,h,_a,_t,Jl,Zo,[cs,Ts],Da,Ei):i.dP(g,An,h,_a,Vn.lineClipsArray.length,_t,Jl,Zo,[cs,Ts],Da);if(Er){const Ws=Vn.gradients[h.id];let ec=Ws.texture;if(h.gradientVersion!==Ws.version){let Ta=256;if(h.stepInterpolant){const Ca=o.getSource().maxzoom,Ko=bn.canonical.z===Ca?Math.ceil(1<<g.transform.maxZoom-bn.canonical.z):1;Ta=i.ay(i.dQ(Vn.maxLineLength/i.aj*1024*Ko),256,ge.maxTextureSize)}Ws.gradient=i.dR({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ta,image:Ws.gradient||void 0,clips:Vn.lineClipsArray}),Ws.texture?Ws.texture.update(Ws.gradient):Ws.texture=new i.T(ge,Ws.gradient,Ce.RGBA8),Ws.version=h.gradientVersion,ec=Ws.texture}ge.activeTexture.set(Ce.TEXTURE1),ec.bind(h.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}jt&&(ge.activeTexture.set(Ce.TEXTURE0),An.lineAtlasTexture&&An.lineAtlasTexture.bind(Ce.LINEAR,Ce.REPEAT),xo.updatePaintBuffers()),qt&&(ge.activeTexture.set(Ce.TEXTURE0),An.imageAtlasTexture&&An.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),xo.updatePaintBuffers()),pn&&!ue&&g.terrain.setupElevationDraw(An,ls),g.uploadCommonUniforms(ge,ls,bn.toUnwrapped());const ol=Ws=>{li!=null&&(li.value=Ki*$),ls.draw(g,Ce.TRIANGLES,Br,Ws,Xe,hi.disabled,Wo,h.id,Vn.layoutVertexBuffer,Vn.indexBuffer,Vn.segments,h.paint,g.transform.zoom,xo,[Vn.layoutVertexBuffer2,Vn.patternVertexBuffer,Vn.zOffsetVertexBuffer]),li!=null&&(li.value=Ki)};if(Ji&&!pn){const Ws=g.stencilModeForClipping(bn).ref;Ws===0&&et&&ge.clear({stencil:0});const ec={func:Ce.EQUAL,mask:255};Wo.u_alpha_discard_threshold=.8,ol(new sr(ec,Ws,255,Ce.KEEP,Ce.KEEP,Ce.INVERT)),Wo.u_alpha_discard_threshold=0,ol(new sr(ec,Ws,255,Ce.KEEP,Ce.KEEP,Ce.KEEP))}else Wo.u_alpha_discard_threshold=Ji&&pn&&on?.8:0,ol(pn?dn:g.stencilModeForClipping(bn))}};let Ni=g.depthModeForSublayer(0,Gt.ReadOnly);const vr=new Gt(g.depthOcclusion?Ce.GREATER:Ce.LEQUAL,Gt.ReadOnly,g.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Nr=!et&&g.terrain;$!==0&&Nr?i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Nr?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):dr(y,$i,Ni,sr.disabled,!1,!0)}if(h.hasElevatedBuckets){Z==="hd-road-markup"?be||(Ni=vr,$i.push("ELEVATED_ROADS")):($i.push("ELEVATED"),Ni=vr,Ne&&$i.push(We?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ue&&$i.push("ELEVATION_REFERENCE_SEA"));const Nr=Ji?g.stencilModeFor3D():sr.disabled;g.forceTerrainMode=!0,dr(y,$i,Ni,Nr,!0,!0),Ji&&dr(y,$i,Ni,Nr,!0,!1),g.forceTerrainMode=!1}Ji&&(g.resetStencilClippingMasks(),et&&ge.clear({stencil:0})),$===0||g.depthOcclusion||et||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,o,h,y){const C=h.paint.get("fill-color"),A=h.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const R=h.paint.get("fill-emissive-strength"),$=g.colorModeForDrapableLayerRenderPass(R),Z=h.paint.get("fill-pattern"),se=g.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&C.constantOr(i.am.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";let ue="none";h.layout.get("fill-elevation-reference")!=="none"?ue="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(ue="offset");const be=!(!g.terrain||!g.terrain.enabled),ge={painter:g,sourceCache:o,layer:h,coords:y,colorMode:$,elevationType:ue,terrainEnabled:be,pass:se};if(g.renderPass!=="shadow")if(ue!=="offset"){if(_f(ge,!1),ue==="road"){const Ce=!be&&g.renderPass==="translucent";Ce&&yl(g,o,h,y,"geometry"),_f(ge,!0,sr.disabled),Ce&&function($e){const{painter:Ne,sourceCache:We,layer:Xe,coords:et,colorMode:_t}=$e,Ct=Ne.context.gl,jt=$e.painter.shadowRenderer,Ft=!!jt&&jt.enabled,Rt=new Gt(Ne.context.gl.LEQUAL,Gt.ReadOnly,Ne.depthRangeFor3D);let Et=[0,0,0];if(Ft){const qt=Ne.style.directionalLight,Ei=Ne.style.ambientLight;qt&&Ei&&(Et=Vl(Ne.style,qt,Ei))}const Wt=qt=>{for(const Ei of et){const Mi=We.getTile(Ei),Ki=Mi.getBucket(Xe);if(!Ki)continue;const Ji=Ki.elevatedStructures;if(!Ji)continue;let Er,Ti;if(qt?(Er=Ji.renderableBridgeSegments,Ti=Ji.bridgeProgramConfigurations.get(Xe.id)):(Er=Ji.renderableTunnelSegments,Ti=Ji.tunnelProgramConfigurations.get(Xe.id)),!Er||Er.segments[0].primitiveLength===0)continue;Ti.updatePaintBuffers(),Ne.prepareDrawTile();const $i=Ne.isTileAffectedByFog(Ei),li=[];Ft&&li.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const dr=Ne.getOrCreateProgram("elevatedStructures",{config:Ti,overrideFog:$i,defines:li}),Ni=Ne.translatePosMatrix(Ei.projMatrix,Mi,Xe.paint.get("fill-translate"),Xe.paint.get("fill-translate-anchor"));Ft&&jt.setupShadows(Mi.tileID.toUnwrapped(),dr,"vector-tile",Mi.tileID.overscaledZ);const vr=Am(Ni,Et);Ne.uploadCommonUniforms(Ne.context,dr,Ei.toUnwrapped()),dr.draw(Ne,Ct.TRIANGLES,Rt,sr.disabled,_t,hi.backCCW,vr,Xe.id,Ji.vertexBuffer,Ji.indexBuffer,Er,Xe.paint,Ne.transform.zoom,Ti,[Ji.vertexBufferNormal])}};Wt(!0),Wt(!1)}(ge)}}else _f(ge,!1,g.stencilModeFor3D());else g.shadowRenderer&&ue==="road"&&!be&&function(Ce){const{painter:$e,sourceCache:Ne,layer:We,coords:Xe}=Ce,et=$e.context.gl,_t=Ce.painter.shadowRenderer;for(const Ct of Xe){const jt=Ne.getTile(Ct),Ft=jt.getBucket(We);if(!Ft)continue;const Rt=Ft.elevatedStructures;if(!Rt||!Rt.shadowCasterSegments||Rt.shadowCasterSegments.segments[0].primitiveLength===0)continue;$e.prepareDrawTile();const Et=Ft.bufferData.programConfigurations.get(We.id),Wt=$e.isTileAffectedByFog(Ct),qt=$e.getOrCreateProgram("elevatedStructuresDepth",{config:Et,overrideFog:Wt}),Ei=_t.calculateShadowPassMatrixFromTile(jt.tileID.toUnwrapped());$e.uploadCommonUniforms($e.context,qt,Ct.toUnwrapped());const Mi={u_matrix:Ei,u_depth_bias:.001};qt.draw($e,et.TRIANGLES,_t.getShadowPassDepthMode(),sr.disabled,_t.getShadowPassColorMode(),hi.disabled,Mi,We.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.shadowCasterSegments,We.paint,$e.transform.zoom,Et)}}(ge)},"fill-extrusion":function(g,o,h,y){const C=h.paint.get("fill-extrusion-opacity"),A=g.context,R=A.gl,$=g.terrain,Z=$&&$.renderingToTexture;if(C===0)return;const se=g.conflationActive&&g.style.isLayerClipped(h,o.getSource()),ue=g.style.order.indexOf(h.fqid);if(se&&function(be,ge,Ce,$e,Ne){for(const We of $e){const Xe=ge.getTile(We).getBucket(Ce);Xe&&(Xe.updateReplacement(We,be.replacementSource,Ne),Xe.uploadCentroid(be.context))}}(g,o,h,y,ue),$||se)for(const be of y){const ge=o.getTile(be).getBucket(h);ge&&mn(g.context,o,be,ge,h,$,se)}if(g.renderPass==="shadow"&&g.shadowRenderer){const be=g.shadowRenderer;if($&&C<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const ge=be.getShadowPassDepthMode(),Ce=be.getShadowPassColorMode();Au(g,o,h,y,ge,sr.disabled,Ce,se)}else if(g.renderPass==="translucent"){const be=!h.paint.get("fill-extrusion-pattern").constantOr(1),ge=h.paint.get("fill-extrusion-color").constantOr(i.am.white);if(!Z&&ge.a!==0){const Ce=new Gt(g.context.gl.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D);C===1&&be?Au(g,o,h,y,Ce,sr.disabled,Bi.unblended,se):(Au(g,o,h,y,Ce,sr.disabled,Bi.disabled,se),Au(g,o,h,y,Ce,g.stencilModeFor3D(),g.colorModeForRenderPass(),se),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&be&&(!$&&g.transform.projection.name!=="globe"||Z)){const Ce=h.paint.get("fill-extrusion-opacity"),$e=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Ne=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),We=h.paint.get("fill-extrusion-flood-light-intensity"),Xe=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",et=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Xe?null:h.lut).toArray01().slice(0,3),_t=$e>0&&Ne>0,Ct=We>0,jt=(Rt,Et,Wt)=>(1-Wt)*Rt+Wt*Et,Ft=Rt=>{const Et=g.depthModeForSublayer(1,Gt.ReadOnly,R.LEQUAL,!0),Wt=h.paint.get(Rt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qt=jt(.1,3,Wt),Ei=g._showOverdrawInspector;if(!Ei){const Mi=new sr({func:R.ALWAYS,mask:255},255,255,R.KEEP,R.KEEP,R.REPLACE),Ki=new Bi([R.ONE,R.ONE,R.ONE,R.ONE],i.am.transparent,[!1,!1,!1,!0],R.MIN);Vp(g,o,h,y,Et,Mi,Ki,hi.disabled,Rt,"sdf",Ce,$e,Ne,We,et,qt,se,!1)}{const Mi=Ei?sr.disabled:new sr({func:R.EQUAL,mask:255},255,255,R.KEEP,R.DECR,R.DECR),Ki=Ei?g.colorModeForRenderPass():new Bi([R.ONE_MINUS_DST_ALPHA,R.DST_ALPHA,R.ONE,R.ONE],i.am.transparent,[!0,!0,!0,!0]);Vp(g,o,h,y,Et,Mi,Ki,hi.disabled,Rt,"color",Ce,$e,Ne,We,et,qt,se,!1)}};if(Z){const Rt=(Et,Wt,qt)=>{const Ei=g.depthModeForSublayer(1,Gt.ReadOnly,R.LEQUAL,!1),Mi=h.paint.get(Et?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ki=jt(.1,3,Mi);{const Ji=new Bi([R.ONE,R.ONE,R.ONE,R.ONE],i.am.transparent,[!1,!1,!1,!0]);Vp(g,o,h,y,Ei,sr.disabled,Ji,hi.disabled,Et,"clear",Ce,$e,Ne,We,et,Ki,se,Wt)}{const Ji=new sr({func:R.ALWAYS,mask:255},255,255,R.KEEP,R.KEEP,R.REPLACE),Er=new Bi([R.ONE,R.ONE,R.ONE,R.ONE],i.am.transparent,[!1,!1,!1,!0],R.MIN);Vp(g,o,h,y,Ei,Ji,Er,hi.disabled,Et,"sdf",Ce,$e,Ne,We,et,Ki,se,Wt)}{const Ji=Et?R.ZERO:R.ONE_MINUS_DST_ALPHA,Er=new sr({func:R.EQUAL,mask:255},255,255,R.KEEP,R.DECR,R.DECR),Ti=new Bi([Ji,R.DST_ALPHA,R.ONE_MINUS_DST_ALPHA,R.ZERO],i.am.transparent,[!0,!0,!0,!0]);Vp(g,o,h,y,Ei,Er,Ti,hi.disabled,Et,"color",Ce,$e,Ne,We,et,Ki,se,Wt)}{const Ji=new Bi([R.ONE,R.ONE,R.ONE,Et?R.ZERO:R.ONE],i.am.transparent,[!1,!1,!1,!0],Et?R.FUNC_ADD:R.MAX);Vp(g,o,h,y,Ei,sr.disabled,Ji,hi.disabled,Et,"clear",Ce,$e,Ne,We,et,Ki,se,Wt,qt)}};if(_t||Ct){let Et;if(g.prepareDrawTile(),$){const Wt=$.drapeBufferSize[0],qt=$.drapeBufferSize[1];Et=$.framebufferCopyTexture,Et&&(!Et||Et.size[0]===Wt&&Et.size[1]===qt)||(Et&&Et.destroy(),Et=$.framebufferCopyTexture=new i.T(A,new i.r({width:Wt,height:qt}),R.RGBA8)),Et.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexSubImage2D(R.TEXTURE_2D,0,0,0,0,0,Wt,qt)}_t&&Rt(!0,!1,Et),Ct&&Rt(!1,!0,Et)}}else _t&&Ft(!0),Ct&&Ft(!1),(_t||Ct)&&g.resetStencilClippingMasks()}}},building:function(g,o,h,y){},hillshade:function(g,o,h,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const C=g.context,A=g.terrain&&g.terrain.renderingToTexture,[R,$]=g.renderPass!=="translucent"||A?[{},y]:g.stencilConfigForOverlap(y);for(const Z of $){const se=o.getTile(Z);if(se.needsHillshadePrepare&&g.renderPass==="offscreen")Eh(g,se,h);else if(g.renderPass==="translucent"){const ue=g.depthModeForSublayer(0,Gt.ReadOnly),be=h.paint.get("hillshade-emissive-strength"),ge=g.colorModeForDrapableLayerRenderPass(be),Ce=A&&g.terrain?g.terrain.stencilModeForRTTOverlap(Z):R[Z.overscaledZ];ga(g,Z,se,h,ue,Ce,ge)}}C.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,o,h,y,C,A){if(g.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const R=g.transform.projection.name==="globe",$=h.paint.get("raster-elevation")!==0,Z=$&&R;if(g.renderElevatedRasterBackface&&!Z)return;const se=g.context,ue=se.gl,be=o.getSource(),ge=function(Ft,Rt,Et,Wt){const qt=Rt.paint.get("raster-color"),Ei=Ft.type==="raster-array",Mi=[],Ki=Rt.paint.get("raster-resampling"),Ji=Rt.paint.get("raster-color-mix");let Er=Rt.paint.get("raster-color-range");const Ti=[Ji[0],Ji[1],Ji[2],0],$i=Ji[3];let li=Ki==="nearest"?Wt.NEAREST:Wt.LINEAR;if(Ei&&(Mi.push("RASTER_ARRAY"),qt||Mi.push("RASTER_COLOR"),Ki==="linear"&&Mi.push("RASTER_ARRAY_LINEAR"),li=Wt.NEAREST,!Er&&Ft.rasterLayers)){const dr=Ft.rasterLayers.find(({id:Ni})=>Ni===Rt.sourceLayer);dr&&dr.fields&&dr.fields.range&&(Er=dr.fields.range)}if(Er=Er||[0,1],qt){Mi.push("RASTER_COLOR"),Et.activeTexture.set(Wt.TEXTURE2),Rt.updateColorRamp(Er);let dr=Rt.colorRampTexture;dr||(dr=Rt.colorRampTexture=new i.T(Et,Rt.colorRamp,Wt.RGBA8)),dr.bind(Wt.LINEAR,Wt.CLAMP_TO_EDGE)}return{mix:Ti,range:Er,offset:$i,defines:Mi,resampling:li}}(be,h,se,ue);if(be instanceof i.aP&&!y.length&&!R)return;const Ce=h.paint.get("raster-emissive-strength"),$e=g.colorModeForDrapableLayerRenderPass(Ce),Ne=g.terrain&&g.terrain.renderingToTexture,We=!g.options.moving,Xe=h.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR;if(be instanceof i.aP&&!y.length&&(be.onNorthPole||be.onSouthPole)){const Ft=$?g.stencilModeFor3D():sr.disabled;return void kd(!!be.onNorthPole,null,g,o,h,Ce,ge,hi.disabled,Ft)}if(!y.length)return;const[et,_t]=be instanceof i.aP||Ne?[{},y]:g.stencilConfigForOverlap(y),Ct=_t[_t.length-1].overscaledZ;Z&&ge.defines.push("PROJECTION_GLOBE_VIEW"),$&&ge.defines.push("RENDER_CUTOFF");const jt=(Ft,Rt,Et)=>{for(const Wt of Ft){const qt=Wt.toUnwrapped(),Ei=o.getTile(Wt);if(Ne&&(!Ei||!Ei.hasData()))continue;se.activeTexture.set(ue.TEXTURE0);const Mi=Pm(Ei,be,h,ge);if(!Mi||!Mi.texture)continue;const{texture:Ki,mix:Ji,offset:Er,tileSize:Ti,buffer:$i}=Mi;let li,dr;Ne?(li=Gt.disabled,dr=Wt.projMatrix):$?(li=new Gt(ue.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D),dr=R?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(qt,We)):(li=g.depthModeForSublayer(Wt.overscaledZ-Ct,h.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,ue.LESS),dr=g.transform.calculateProjMatrix(qt,We));const Ni=g.terrain&&Ne?g.terrain.stencilModeForRTTOverlap(Wt):et[Wt.overscaledZ],vr=A?0:h.paint.get("raster-fade-duration");Ei.registerFadeDuration(vr);const Nr=o.findLoadedParent(Wt,0),ar=dp(Ei,Nr,o,g.transform,vr);let Br,dn;g.terrain&&g.terrain.prepareDrawTile(),se.activeTexture.set(ue.TEXTURE0),Ki.bind(Xe,ue.CLAMP_TO_EDGE),se.activeTexture.set(ue.TEXTURE1),Nr?(Nr.texture&&Nr.texture.bind(Xe,ue.CLAMP_TO_EDGE),Br=Math.pow(2,Nr.tileID.overscaledZ-Ei.tileID.overscaledZ),dn=[Ei.tileID.canonical.x*Br%1,Ei.tileID.canonical.y*Br%1]):Ki.bind(Xe,ue.CLAMP_TO_EDGE),"useMipmap"in Ki&&se.extTextureFilterAnisotropic&&g.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const pn=g.transform;let on;const bn=$?Wp(pn):[0,0,0,0];let An,Vn,Zn,ys,Bo,Da=0;if(Z&&be instanceof i.aP&&be.coordinates.length>3)An=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0)))),Vn=Float32Array.from(pn.globeMatrix),Zn=Float32Array.from(i.dm(pn)),ys=[i.aD(pn.center.lng),i.aH(pn.center.lat)],on=be.elevatedGlobePerspectiveTransform,Bo=be.elevatedGlobeGridMatrix||new Float32Array(9);else if(Z){const ls=i.dn(Wt.canonical);Da=i.dp(ls.getCenter().lat),An=Float32Array.from(i.bh(i.dr(Wt.canonical))),Vn=Float32Array.from(pn.globeMatrix),Zn=Float32Array.from(i.dm(pn)),ys=[i.aD(pn.center.lng),i.aH(pn.center.lat)],on=[0,0],Bo=Float32Array.from(i.dq(Wt.canonical,ls,Da,pn.worldSize/pn._pixelsPerMercatorPixel))}else on=be instanceof i.aP?be.perspectiveTransform:[0,0],An=new Float32Array(16),Vn=new Float32Array(9),Zn=new Float32Array(16),ys=[0,0],Bo=new Float32Array(9);const xo=bg(dr,An,Vn,Zn,Bo,dn||[0,0],i.ah(g.transform.zoom),ys,bn,Br||1,ar,h,on,$?h.paint.get("raster-elevation"):0,2,Ji,Er,ge.range,Ti,$i,Ce),ia=g.isTileAffectedByFog(Wt),sl=g.getOrCreateProgram("raster",{defines:ge.defines,overrideFog:ia});if(g.uploadCommonUniforms(se,sl,qt),be instanceof i.aP){const ls=be.elevatedGlobeVertexBuffer,cs=be.elevatedGlobeIndexBuffer;if(Ne||!R)be.boundsBuffer&&be.boundsSegments&&sl.draw(g,ue.TRIANGLES,li,sr.disabled,$e,hi.disabled,xo,h.id,be.boundsBuffer,g.quadTriangleIndexBuffer,be.boundsSegments);else if(ls&&cs){const Ts=pn.zoom<=i.cL?be.elevatedGlobeSegments:be.getSegmentsForLongitude(pn.center.lng);Ts&&sl.draw(g,ue.TRIANGLES,li,sr.disabled,$e,Rt,xo,h.id,ls,cs,Ts)}}else if(Z){li=new Gt(ue.LEQUAL,Gt.ReadOnly,g.depthRangeFor3D);const ls=g.globeSharedBuffers;if(ls){const[cs,Ts,_a]=ls.getGridBuffers(Da,!1);sl.draw(g,ue.TRIANGLES,li,Et||Ni,g.colorModeForRenderPass(),Rt,xo,h.id,cs,Ts,_a)}}else{const{tileBoundsBuffer:ls,tileBoundsIndexBuffer:cs,tileBoundsSegments:Ts}=g.getTileBoundsBuffers(Ei);sl.draw(g,ue.TRIANGLES,li,Ni,$e,hi.disabled,xo,h.id,ls,cs,Ts)}}if(!(be instanceof i.aP)&&Z)for(const Wt of Ft){const qt=Wt.canonical.y===(1<<Wt.canonical.z)-1;Wt.canonical.y===0&&kd(!0,Wt,g,o,h,Ce,ge,Rt,Et||sr.disabled),qt&&kd(!1,Wt,g,o,h,Ce,ge,Rt===hi.frontCW?hi.backCW:hi.frontCW,Et||sr.disabled)}};Z?jt(_t,g.renderElevatedRasterBackface?hi.backCW:hi.frontCW,g.stencilModeFor3D()):jt(_t,hi.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,o,h,y,C,A){g.renderPass==="offscreen"&&function(R,$,Z,se){if(!se.length)return;const ue=R.context,be=ue.gl,ge=$.getSource();if(!(ge instanceof ra))return;const Ce=Math.ceil(Math.sqrt(Z.paint.get("raster-particle-count")));let $e=Z.particlePositionRGBAImage;if(!$e||$e.width!==Ce){const _t=function(Ct){const jt=Ct*Ct,Ft=new Uint8Array(4*jt),Rt=function(Wt){return Wt|=0,Wt=Math.imul(2747636419^Wt,2654435769),Wt=Math.imul(Wt^Wt>>>16,2654435769),((Wt=Math.imul(Wt^Wt>>>16,2654435769))>>>0)/4294967296},Et=1/1.1;for(let Wt=0;Wt<jt;Wt++){const qt=Et*(Rt(2*Wt+0)+Vd),Ei=Et*(Rt(2*Wt+1)+Vd),Mi=255*qt%1,Ki=255*Ei%1,Ji=Mi,Er=Ei-Ki/255,Ti=Ki;Ft[4*Wt+0]=255*(qt-Mi/255),Ft[4*Wt+1]=255*Ji,Ft[4*Wt+2]=255*Er,Ft[4*Wt+3]=255*Ti}return Ft}(Ce);$e=Z.particlePositionRGBAImage=new i.r({width:Ce,height:Ce},_t)}let Ne=Z.particleFramebuffer;Ne?Ne.width!==Ce&&(Ne.destroy(),Ne=Z.particleFramebuffer=ue.createFramebuffer(Ce,Ce,!0,null)):Ne=Z.particleFramebuffer=ue.createFramebuffer(Ce,Ce,!0,null);const We=[];for(const _t of se){const Ct=$.getTile(_t);if(!(Ct instanceof Cs))continue;const jt=Mu(Ct,ge,Z);if(!jt)continue;const Ft=[Ct.tileSize,Ct.tileSize];let Rt=Z.tileFramebuffer;Rt||(Rt=Z.tileFramebuffer=ue.createFramebuffer(Ft[0],Ft[1],!0,null));let Et=Ct.rasterParticleState;Et||(Et=Ct.rasterParticleState=new vf(ue,_t,Ft,$e));const Wt=Et.update(Z.lastInvalidatedAt);Et.particleTextureDimension!==Ce&&Et.updateParticleTexture(_t,$e);const qt=Et.targetColorTexture;Et.targetColorTexture=Et.backgroundColorTexture,Et.backgroundColorTexture=qt;const Ei=Et.particleTexture0;Et.particleTexture0=Et.particleTexture1,Et.particleTexture1=Ei,We.push([_t,jt,Et,Wt])}if(We.length===0)return;const Xe=i.q.now(),et=Z.previousDrawTimestamp?.001*(Xe-Z.previousDrawTimestamp):.0167;if(Z.previousDrawTimestamp=Xe,Z.hasColorMap()){ue.activeTexture.set(be.TEXTURE0+2);let _t=Z.colorRampTexture;_t||(_t=Z.colorRampTexture=new i.T(ue,Z.colorRamp,be.RGBA8)),_t.bind(be.LINEAR,be.CLAMP_TO_EDGE)}ue.bindFramebuffer.set(Z.tileFramebuffer.framebuffer),function(_t,Ct,jt){const Ft=_t.context,Rt=Ft.gl,Et=Ct.tileFramebuffer;Ft.activeTexture.set(Rt.TEXTURE0);const Wt={u_texture:0,u_opacity:1.05*(Ei=Ct.paint.get("raster-particle-fade-opacity-factor"))/(Ei+.05)},qt=_t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ei;for(const Mi of jt){const[,,Ki,Ji]=Mi;Et.colorAttachment.set(Ki.targetColorTexture.texture),Ft.viewport.set([0,0,Et.width,Et.height]),Ft.clear({color:i.am.transparent}),Ji&&(Ki.backgroundColorTexture.bind(Rt.NEAREST,Rt.CLAMP_TO_EDGE),qt.draw(_t,Rt.TRIANGLES,Gt.disabled,sr.disabled,Bi.alphaBlended,hi.disabled,Wt,Ct.id,_t.viewportBuffer,_t.quadTriangleIndexBuffer,_t.viewportSegments))}}(R,Z,We),function(_t,Ct,jt,Ft){const Rt=_t.context,Et=Rt.gl,Wt=jt.tileFramebuffer,qt=_t.transform.projection.name==="globe",Ei=jt.paint.get("raster-particle-max-speed");for(const Mi of Ft){const[Ki,Ji,Er]=Mi;Rt.activeTexture.set(Et.TEXTURE0+0),Ji.texture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE),Wt.colorAttachment.set(Er.targetColorTexture.texture);const Ti=_t.getOrCreateProgram("rasterParticleDraw",{defines:Ji.defines,overrideFog:!1});Rt.activeTexture.set(Et.TEXTURE0+1);const $i=Ji.scalarData?[]:[0,1,2,3].map(Ni=>i.dT[Ni](Ki));$i.push(Ki);const li=Ki.canonical.x,dr=Ki.canonical.y;for(const Ni of $i){const vr=Ct.getTile(qt?Ni.wrapped():Ni);if(!vr)continue;const Nr=vr.rasterParticleState;if(!Nr)continue;const ar=Ni.canonical.x+(1<<Ni.canonical.z)*(Ni.wrap-Ki.wrap),Br=Ni.canonical.y;Nr.particleTexture0.bind(Et.NEAREST,Et.CLAMP_TO_EDGE);const dn=jy(1,Nr.particleTexture0.size[0],[ar-li,Br-dr],0,Ji.texture.size,2,Ei,Ji.textureOffset,Ji.scale,Ji.offset);Ti.draw(_t,Et.POINTS,Gt.disabled,sr.disabled,Bi.alphaBlended,hi.disabled,dn,jt.id,Nr.particleIndexBuffer,void 0,Nr.particleSegment)}}}(R,$,Z,We),ue.bindFramebuffer.set(Z.particleFramebuffer.framebuffer),function(_t,Ct,jt,Ft){const Rt=_t.context,Et=Rt.gl,Wt=Ct.paint.get("raster-particle-max-speed"),qt=Ft*Ct.paint.get("raster-particle-speed-factor")*.15,Ei=function(Ki){return Math.pow(Ki,6)}(.01+1*Ct.paint.get("raster-particle-reset-rate-factor")),Mi=Ct.particleFramebuffer;Rt.viewport.set([0,0,Mi.width,Mi.height]);for(const Ki of jt){const[,Ji,Er]=Ki;Rt.activeTexture.set(Et.TEXTURE0+0),Ji.texture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE),Rt.activeTexture.set(Et.TEXTURE0+1);const Ti=Er.particleTexture0;Ti.bind(Et.NEAREST,Et.CLAMP_TO_EDGE);const $i=Ku(1,Ti.size[0],0,Ji.texture.size,Wt,qt,Ei,Ji.textureOffset,Ji.scale,Ji.offset);Mi.colorAttachment.set(Er.particleTexture1.texture),Rt.clear({color:i.am.transparent}),_t.getOrCreateProgram("rasterParticleUpdate",{defines:Ji.defines}).draw(_t,Et.TRIANGLES,Gt.disabled,sr.disabled,Bi.unblended,hi.disabled,$i,Ct.id,_t.viewportBuffer,_t.quadTriangleIndexBuffer,_t.viewportSegments)}}(R,Z,We,et)}(g,o,h,y),g.renderPass==="translucent"&&(function(R,$,Z,se,ue){const be=R.context,ge=be.gl,Ce=$.getSource().tileSize,$e=5*(1-i.af(i.cx,i.cx+1,R.transform.zoom))*Ce+Z.paint.get("raster-particle-elevation"),Ne=!R.options.moving,We=R.transform.projection.name==="globe";if(!se.length)return;const[Xe,et]=R.stencilConfigForOverlap(se),_t=[];We&&_t.push("PROJECTION_GLOBE_VIEW");const Ct=R.stencilModeFor3D();for(const jt of et){const Ft=jt.toUnwrapped(),Rt=$.getTile(jt);if(!Rt.rasterParticleState)continue;const Et=Rt.rasterParticleState,Wt=100;Rt.registerFadeDuration(Wt);const qt=$.findLoadedParent(jt,0),Ei=dp(Rt,qt,$,R.transform,Wt);let Mi,Ki;R.terrain&&R.terrain.prepareDrawTile(),be.activeTexture.set(ge.TEXTURE0),Et.targetColorTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),be.activeTexture.set(ge.TEXTURE1),qt&&qt.rasterParticleState?(qt.rasterParticleState.targetColorTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Mi=Math.pow(2,qt.tileID.overscaledZ-Rt.tileID.overscaledZ),Ki=[Rt.tileID.canonical.x*Mi%1,Rt.tileID.canonical.y*Mi%1]):Et.targetColorTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const Ji=We?Float32Array.from(R.transform.expandedFarZProjMatrix):R.transform.calculateProjMatrix(Ft,Ne),Er=R.transform,Ti=P0(Er),$i=i.dn(jt.canonical),li=i.dp($i.getCenter().lat);let dr,Ni,vr,Nr,ar;We?(dr=Float32Array.from(i.bh(i.dr(jt.canonical))),Ni=Float32Array.from(Er.globeMatrix),vr=Float32Array.from(i.dm(Er)),Nr=[i.aD(Er.center.lng),i.aH(Er.center.lat)],ar=Float32Array.from(i.dq(jt.canonical,$i,li,Er.worldSize/Er._pixelsPerMercatorPixel))):(dr=new Float32Array(16),Ni=new Float32Array(9),vr=new Float32Array(16),Nr=[0,0],ar=new Float32Array(9));const Br=Td(Ji,dr,Ni,vr,ar,Ki||[0,0],i.ah(R.transform.zoom),Nr,Ti,Mi||1,Ei,$e),dn=R.isTileAffectedByFog(jt),pn=R.getOrCreateProgram("rasterParticle",{defines:_t,overrideFog:dn});if(R.uploadCommonUniforms(be,pn,Ft),We){const on=new Gt(ge.LEQUAL,Gt.ReadOnly,R.depthRangeFor3D),bn=0,An=R.globeSharedBuffers;if(An){const[Vn,Zn,ys]=An.getGridBuffers(li,bn!==0);pn.draw(R,ge.TRIANGLES,on,Ct,Bi.alphaBlended,R.renderElevatedRasterBackface?hi.frontCCW:hi.backCCW,Br,Z.id,Vn,Zn,ys)}}else{const on=R.depthModeForSublayer(0,Gt.ReadOnly),bn=Xe[jt.overscaledZ],{tileBoundsBuffer:An,tileBoundsIndexBuffer:Vn,tileBoundsSegments:Zn}=R.getTileBoundsBuffers(Rt);pn.draw(R,ge.TRIANGLES,on,bn,Bi.alphaBlended,hi.disabled,Br,Z.id,An,Vn,Zn)}}R.resetStencilClippingMasks()}(g,o,h,y),g.style.map.triggerRepaint())},background:function(g,o,h,y){const C=h.paint.get("background-color"),A=h.paint.get("background-color-use-theme").constantOr("default")==="none",R=h.paint.get("background-opacity"),$=h.paint.get("background-emissive-strength"),Z=h.paint.get("background-pitch-alignment")==="viewport";if(R===0)return;const se=g.context,ue=se.gl,be=g.transform,ge=be.tileSize,Ce=h.paint.get("background-pattern");let $e;if(Ce!==void 0&&(Ce===null||($e=g.imageManager.getPattern(i.I.from(Ce.toString()),h.scope,g.style.getLut(h.scope)),!$e)))return;const Ne=!Ce&&C.a===1&&R===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==Ne)return;const We=sr.disabled,Xe=g.depthModeForSublayer(0,Ne==="opaque"?Gt.ReadWrite:Gt.ReadOnly),et=g.colorModeForDrapableLayerRenderPass($),_t=Ce?"backgroundPattern":"background";let Ct,jt=y;if(jt||(Ct=g.getBackgroundTiles(),jt=Object.values(Ct).map(Ft=>Ft.tileID)),Ce&&(se.activeTexture.set(ue.TEXTURE0),g.imageManager.bind(g.context,h.scope)),Z){const Ft=g.getOrCreateProgram(_t,{overrideFog:!1,overrideRtt:!0}),Rt=new Float32Array(i.bx([])),Et=new i.aM(0,0,0,0,0),Wt=Ce?Cu(Rt,$,R,g,0,h.scope,$e,Z,{tileID:Et,tileSize:ge}):gp(Rt,$,R,C.toPremultipliedRenderColor(A?null:h.lut));Ft.draw(g,ue.TRIANGLES,Xe,We,et,hi.disabled,Wt,h.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Ft of jt){const Rt=g.isTileAffectedByFog(Ft),Et=g.getOrCreateProgram(_t,{overrideFog:Rt}),Wt=Ft.toUnwrapped(),qt=y?Ft.projMatrix:g.transform.calculateProjMatrix(Wt);g.prepareDrawTile();const Ei=o?o.getTile(Ft):Ct?Ct[Ft.key]:new Ys(Ft,ge,be.zoom,g),Mi=Ce?Cu(qt,$,R,g,0,h.scope,$e,Z,{tileID:Ft,tileSize:ge}):gp(qt,$,R,C.toPremultipliedRenderColor(A?null:h.lut));g.uploadCommonUniforms(se,Et,Wt);const{tileBoundsBuffer:Ki,tileBoundsIndexBuffer:Ji,tileBoundsSegments:Er}=g.getTileBoundsBuffers(Ei);Et.draw(g,ue.TRIANGLES,Xe,We,et,hi.disabled,Mi,h.id,Ki,Ji,Er)}},sky:function(g,o,h){const y=g._atmosphere?i.ah(g.transform.zoom):1,C=h.paint.get("sky-opacity")*y;if(C===0)return;const A=g.context,R=h.paint.get("sky-type"),$=new Gt(A.gl.LEQUAL,Gt.ReadOnly,[0,1]),Z=g.frameCounter/1e3%1;R==="atmosphere"?g.renderPass==="offscreen"?h.needsSkyboxCapture(g)&&(function(se,ue,be,ge){const Ce=se.context,$e=Ce.gl;let Ne=ue.skyboxFbo;if(!Ne){Ne=ue.skyboxFbo=Ce.createFramebuffer(32,32,!0,null),ue.skyboxGeometry=new Rm(Ce),ue.skyboxTexture=Ce.gl.createTexture(),$e.bindTexture($e.TEXTURE_CUBE_MAP,ue.skyboxTexture),$e.texParameteri($e.TEXTURE_CUBE_MAP,$e.TEXTURE_WRAP_S,$e.CLAMP_TO_EDGE),$e.texParameteri($e.TEXTURE_CUBE_MAP,$e.TEXTURE_WRAP_T,$e.CLAMP_TO_EDGE),$e.texParameteri($e.TEXTURE_CUBE_MAP,$e.TEXTURE_MIN_FILTER,$e.LINEAR),$e.texParameteri($e.TEXTURE_CUBE_MAP,$e.TEXTURE_MAG_FILTER,$e.LINEAR);for(let _t=0;_t<6;++_t)$e.texImage2D($e.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,$e.RGBA,32,32,0,$e.RGBA,$e.UNSIGNED_BYTE,null)}Ce.bindFramebuffer.set(Ne.framebuffer),Ce.viewport.set([0,0,32,32]);const We=ue.getCenter(se,!0),Xe=se.getOrCreateProgram("skyboxCapture"),et=new Float64Array(16);i.bx(et),i.e3(et,et,.5*-Math.PI),Iu(se,ue,Xe,et,We,0),i.bx(et),i.e3(et,et,.5*Math.PI),Iu(se,ue,Xe,et,We,1),i.bx(et),i.cG(et,et,.5*-Math.PI),Iu(se,ue,Xe,et,We,2),i.bx(et),i.cG(et,et,.5*Math.PI),Iu(se,ue,Xe,et,We,3),i.bx(et),Iu(se,ue,Xe,et,We,4),i.bx(et),i.e3(et,et,Math.PI),Iu(se,ue,Xe,et,We,5),Ce.viewport.set([0,0,se.width,se.height])}(g,h),h.markSkyboxValid(g)):g.renderPass==="sky"&&function(se,ue,be,ge,Ce){const $e=se.context,Ne=$e.gl,We=se.transform,Xe=se.getOrCreateProgram("skybox");$e.activeTexture.set(Ne.TEXTURE0),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,ue.skyboxTexture);const et=((_t,Ct,jt,Ft,Rt)=>({u_matrix:_t,u_sun_direction:Ct,u_cubemap:0,u_opacity:Ft,u_temporal_offset:Rt}))(We.skyboxMatrix,ue.getCenter(se,!1),0,ge,Ce);se.uploadCommonUniforms($e,Xe),Xe.draw(se,Ne.TRIANGLES,be,sr.disabled,se.colorModeForRenderPass(),hi.backCW,et,"skybox",ue.skyboxGeometry.vertexBuffer,ue.skyboxGeometry.indexBuffer,ue.skyboxGeometry.segment)}(g,h,$,C,Z):R==="gradient"&&g.renderPass==="sky"&&function(se,ue,be,ge,Ce){const $e=se.context,Ne=$e.gl,We=se.transform,Xe=se.getOrCreateProgram("skyboxGradient");ue.skyboxGeometry||(ue.skyboxGeometry=new Rm($e)),$e.activeTexture.set(Ne.TEXTURE0);let et=ue.colorRampTexture;et||(et=ue.colorRampTexture=new i.T($e,ue.colorRamp,Ne.RGBA8)),et.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);const _t=((Ct,jt,Ft,Rt,Et)=>({u_matrix:Ct,u_color_ramp:0,u_center_direction:jt,u_radius:i.al(Ft),u_opacity:Rt,u_temporal_offset:Et}))(We.skyboxMatrix,ue.getCenter(se,!1),ue.paint.get("sky-gradient-radius"),ge,Ce);se.uploadCommonUniforms($e,Xe),Xe.draw(se,Ne.TRIANGLES,be,sr.disabled,se.colorModeForRenderPass(),hi.backCW,_t,"skyboxGradient",ue.skyboxGeometry.vertexBuffer,ue.skyboxGeometry.indexBuffer,ue.skyboxGeometry.segment)}(g,h,$,C,Z)},custom:function(g,o,h,y){const C=g.context,A=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&h.isDraped(o)){if(g.renderPass==="offscreen"){const R=A.prerender;if(R){if(g.setCustomLayerDefaults(),C.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const $=g.transform.pointMerc;R.call(A,C.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.ah(g.transform.zoom),[$.x,$.y],g.transform.pixelsPerMeterRatio)}else R.call(A,C.gl,g.transform.customLayerMatrix());C.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const $=A.renderToTile;if($){const Z=y[0].canonical,se={x:Z.x+y[0].wrap*(A.wrapTileId?0:1<<Z.z),y:Z.y,z:Z.z};C.setDepthMode(Gt.disabled),C.setStencilMode(sr.disabled),C.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),$.call(A,C.gl,se),C.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),C.setColorMode(g.colorModeForRenderPass()),C.setStencilMode(sr.disabled);const R=A.renderingMode==="3d"?new Gt(g.context.gl.LEQUAL,Gt.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Gt.ReadOnly);if(C.setDepthMode(R),g.transform.projection.name==="globe"){const $=g.transform.pointMerc;A.render(C.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.ah(g.transform.zoom),[$.x,$.y],g.transform.pixelsPerMeterRatio)}else A.render(C.gl,g.transform.customLayerMatrix());C.setDirty(),g.setBaseState(),C.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,o,h,y){if(g.renderPass==="opaque")return;const C=h.paint.get("model-opacity").constantOr(1);if(C===0)return;const A=h.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!A||g.terrain&&C<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const R=g.shadowRenderer,$=h.paint.get("model-receive-shadows");R&&(R.useNormalOffset=!0,$||(R.enabled=!1));const Z=()=>{R&&(R.useNormalOffset=!0,$||(R.enabled=!0))},se=o.getSource();if(g.renderPass==="light-beam"&&se.type!=="batched-model")return;if(se.type==="vector"||se.type==="geojson")return function(Xe,et,_t,Ct,jt){const Ft=Xe.transform;if(Ft.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Ft.projection.name} projection is not yet implemented`);const Rt=Ft.getFreeCameraOptions().position;if(!Xe.modelManager)return;const Et=Xe.modelManager;_t.modelManager=Et;const Wt=Xe.shadowRenderer;if(!_t._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const qt=_t._unevaluatedLayout._values["model-id"],Ei=Object.assign({},_t.layout.get("model-id").parameters),Mi=Xe.style.order.indexOf(_t.fqid);for(const Ki of Ct){const Ji=et.getTile(Ki).getBucket(_t);if(!Ji||Ji.projection.name!==Ft.projection.name)continue;const Er=Ji.getModelUris();Er&&!Ji.modelsRequested&&(Et.addModelsFromBucket(Er,jt),Ji.modelsRequested=!0);const Ti=Tg(Ki,Ft);Ei.zoom=Ti;const $i=qt.possiblyEvaluate(Ei);if(wi(Xe,Ji,Ki),kh.shadowUniformsInitialized=!1,kh.useSingleShadowCascade=!!Wt&&Wt.getMaxCascadeForTile(Ki.toUnwrapped())===0,Xe.renderPass==="shadow"&&Wt){if(Xe.currentShadowCascade===1&&Ji.isInsideFirstShadowMapFrustum)continue;const Ni=Ft.calculatePosMatrix(Ki.toUnwrapped(),Ft.worldSize);if(kh.tileMatrix.set(Ni),kh.shadowTileMatrix=Float32Array.from(Wt.calculateShadowPassMatrixFromMatrix(Ni)),kh.aabb.min.fill(0),kh.aabb.max[0]=kh.aabb.max[1]=i.aj,kh.aabb.max[2]=0,Bm(Ji,kh,Xe,_t.scope))continue}const li=1<<Ki.canonical.z,dr=[((Rt.x-Ki.wrap)*li-Ki.canonical.x)*i.aj,(Rt.y*li-Ki.canonical.y)*i.aj,Rt.z*li*i.aj];Xe.conflationActive&&Object.keys(Ji.instancesPerModel).length>0&&Xe.style.isLayerClipped(_t,et.getSource())&&Ji.updateReplacement(Ki,Xe.replacementSource,Mi,jt)&&(Ji.uploaded=!1,Ji.upload(Xe.context));for(let Ni in Ji.instancesPerModel){const vr=Ji.instancesPerModel[Ni];vr.features.length>0&&(Ni=$i.evaluate(vr.features[0].feature,{}));const Nr=Et.getModel(Ni,jt);if(Nr||Et.hasURLBeenRequested(Ni)||Ji.modelUris.includes(Ni)||(Ji.modelUris.push(Ni),Ji.modelsRequested=!1),Nr&&Nr.uploaded)for(const ar of Nr.nodes)La(Xe,_t,ar,vr,dr,Ki,kh)}}}(g,o,h,y,se.type==="vector"?h.scope:""),void Z();if(!se.loaded())return;if(se.type==="batched-model")return function(Xe,et,_t,Ct){_t.resetLayerRenderingStats(Xe);const jt=Xe.context,Ft=Xe.transform,Rt=Xe.style.fog,Et=Xe.shadowRenderer;if(Ft.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Ft.projection.name} projection is not yet implemented`);const Wt=Xe.transform.getFreeCameraOptions().position,qt=i.bY([],[Wt.x,Wt.y,Wt.z],Xe.transform.worldSize),Ei=i.eb([],qt),Mi=i.bx([]),Ki=i.ec(Ft.center.lat,Ft.zoom),Ji=i.bn([],[1,1,1/Ki]);i.bo(Mi,Mi,Ei);const Er=_t.paint.get("model-opacity").constantOr(1),Ti=new Gt(jt.gl.LEQUAL,Gt.ReadWrite,Xe.depthRangeFor3D),$i=new Gt(jt.gl.LEQUAL,Gt.ReadOnly,Xe.depthRangeFor3D),li=new i.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),dr=Xe.renderPass==="shadow",Ni=dr&&Et?Et.getCurrentCascadeFrustum():Ft.getFrustum(Ft.scaleZoom(Ft.worldSize)),vr=_t.paint.get("model-front-cutoff"),Nr=vr[2]<1,ar=Jo(Xe,_t.paint.get("model-cutoff-fade-range")),Br=_t.getLayerRenderingStats();(function(dn,pn,on,bn){const An=dn.terrain?dn.terrain.exaggeration():0,Vn=dn.transform.zoom;for(const Zn of bn){const ys=pn.getTile(Zn).getBucket(on);ys&&(ys.setFilter(on.filter),dn.conflationActive&&ys.updateReplacement(Zn,dn.replacementSource),ys.evaluateTransform(dn,on),dn.terrain&&An>0&&ys.elevationUpdate(dn.terrain,An,Zn,on.source),ys.needsReEvaluation(dn,Vn,on)&&ys.evaluate(on))}})(Xe,et,_t,Ct),function(){let dn,pn,on;Nr?(dn=Ct.length-1,pn=-1,on=-1):(dn=0,pn=Ct.length,on=1);const bn=new Float64Array(16),An=i.ef(),Vn=new i.P(0,0);for(let Zn=dn;Zn!==pn;Zn+=on){const ys=Ct[Zn],Bo=et.getTile(ys).getBucket(_t);if(!Bo||!Bo.uploaded)continue;let Da=!1;Et&&(Da=Et.getMaxCascadeForTile(ys.toUnwrapped())===0);const xo=Ft.calculatePosMatrix(ys.toUnwrapped(),Ft.worldSize),ia=Bo.modelTraits;!dr&&Nr&&(i.bi(bn,xo),i.ad(An,qt,bn),Vn.x=An[0],Vn.y=An[1]);const sl=[];Bo.setFilter(_t.filter);for(const ls of Bo.getNodesInfo()){if(ls.hiddenByReplacement||!ls.node.meshes)continue;const cs=ls.node;let Ts=0;Xe.terrain&&cs.elevation&&(Ts=cs.elevation*Xe.terrain.exaggeration());const _a=(()=>{const Ya=ls.aabb;return li.min=[...Ya.min],li.max=[...Ya.max],li.min[2]+=Ts,li.max[2]+=Ts,i.ad(li.min,li.min,xo),i.ad(li.max,li.max,xo),li})(),Jl=ls.evaluatedScale;if(Jl[0]<=1&&Jl[1]<=1&&Jl[2]<=1&&_a.intersects(Ni)===0)continue;if(!dr&&Nr){const Ya=.16666666666666666;ls.cameraCollisionOpacity=qt[0]>_a.min[0]&&qt[0]<_a.max[0]&&qt[1]>_a.min[1]&&qt[1]<_a.max[1]&&qt[2]*Ki<_a.max[2]&&cs.footprint&&i.bS(Vn,cs.footprint)?Math.max(ls.cameraCollisionOpacity-Ya,0):Math.min(1,ls.cameraCollisionOpacity+Ya)}const Zo=[...xo],Wo=1/i.cU(ys.canonical),ol=cs.anchor?cs.anchor[0]:0,Ws=cs.anchor?cs.anchor[1]:0;i.bo(Zo,Zo,[ol*(Jl[0]-1)+ls.evaluatedTranslation[0]*Wo,Ws*(Jl[1]-1)+ls.evaluatedTranslation[1]*Wo,Ts+ls.evaluatedTranslation[2]]),i.ci(Jl,i.eg)||i.cE(Zo,Zo,Jl);const ec=i.az([],Zo,cs.matrix),Ta=i.az([],Ft.expandedFarZProjMatrix,ec),Ca=i.az([],Ft.expandedFarZProjMatrix,Zo),Ko=i.aA([],[ol,Ws,Ts,1],Ta)[2];cs.hidden=!1;let bo=Er;dr||(Nr&&(bo*=ls.cameraCollisionOpacity,bo*=xf(Zo,Ft,ls.aabb,vr)),bo*=kc(ar,Ko)),bo!==0?sl.push({nodeInfo:ls,depth:Ko,opacity:bo,wvpForNode:Ta,wvpForTile:Ca,nodeModelMatrix:ec,tileModelMatrix:Zo}):cs.hidden=!0}dr||sl.sort((ls,cs)=>!Nr||ls.opacity===1&&cs.opacity===1?ls.depth<cs.depth?-1:1:ls.opacity===1?-1:cs.opacity===1?1:ls.depth>cs.depth?-1:1);for(const ls of sl){const cs=ls.nodeInfo,Ts=cs.node;let _a=i.az([],Ji,ls.tileModelMatrix);i.az(_a,Mi,_a);const Jl=i.bi([],_a);i.ee(Jl,Jl),i.cE(Jl,Jl,sy),_a=i.az(_a,_a,Ts.matrix);const Zo=Xe.renderPass==="light-beam",Wo=_t.paint.get("model-color-use-theme").constantOr("default")==="none",ol=ia&i.em.HasMapboxMeshFeatures,Ws=ol?0:cs.evaluatedRMEA[0][2];for(let ec=0;ec<Ts.meshes.length;++ec){const Ta=Ts.meshes[ec],Ca=ec===Ts.lightMeshIndex;let Ko=ls.wvpForNode;if(Ca){if(!Zo&&!Xe.terrain&&Xe.shadowRenderer){Xe.currentLayer<Xe.firstLightBeamLayer&&(Xe.firstLightBeamLayer=Xe.currentLayer);continue}Ko=ls.wvpForTile}else if(Zo)continue;const bo={defines:[]},Ya=[];if(!dr&&Et&&(Et.useNormalOffset=!!Ta.normalBuffer),Wi(bo.defines,Ya,Ta,Xe,Wo?null:_t.lut),ol||bo.defines.push("DIFFUSE_SHADED"),Da&&bo.defines.push("SHADOWS_SINGLE_CASCADE"),Br&&(dr?Br.numRenderedVerticesInShadowPass+=Ta.vertexArray.length:Br.numRenderedVerticesInTransparentPass+=Ta.vertexArray.length),dr){ha(Ta,ls.nodeModelMatrix,Xe,_t);continue}let _h=null;if(Rt){const Od=Md(ls.nodeModelMatrix,Xe.transform);if(_h=new Float32Array(Od),Ft.projection.name!=="globe"){const nu=Ta.aabb.min,su=Ta.aabb.max,[Qd,ad]=Rt.getOpacityForBounds(Od,nu[0],nu[1],su[0],su[1]);bo.overrideFog=Qd>=Fi||ad>=Fi}}const ua=Ta.material;let Fo;ua.occlusionTexture&&ua.occlusionTexture.offsetScale&&(Fo=ua.occlusionTexture.offsetScale,bo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ru=Xe.getOrCreateProgram("model",bo);!dr&&Et&&Et.setupShadowsFromMatrix(ls.tileModelMatrix,ru,Et.useNormalOffset),Xe.uploadCommonUniforms(jt,ru,null,_h);const Ah=ua.pbrMetallicRoughness;Ah.metallicFactor=.9,Ah.roughnessFactor=.5;const od=$p(new Float32Array(Ko),new Float32Array(_a),new Float32Array(Jl),new Float32Array(Ts.matrix),Xe,ls.opacity,Ah.baseColorFactor,ua.emissiveFactor,Ah.metallicFactor,Ah.roughnessFactor,ua,Ws,_t,[0,0,0],Fo);!Ca&&(cs.hasTranslucentParts||ls.opacity<1)&&ru.draw(Xe,jt.gl.TRIANGLES,Ti,sr.disabled,Bi.disabled,hi.backCCW,od,_t.id,Ta.vertexBuffer,Ta.indexBuffer,Ta.segments,_t.paint,Xe.transform.zoom,void 0,Ya),ru.draw(Xe,jt.gl.TRIANGLES,Ca?$i:Ti,sr.disabled,Ca||ls.opacity<1||cs.hasTranslucentParts?Bi.alphaBlended:Bi.unblended,hi.backCCW,od,_t.id,Ta.vertexBuffer,Ta.indexBuffer,Ta.segments,_t.paint,Xe.transform.zoom,void 0,Ya)}}}}()}(g,o,h,y),void Z();if(se.type!=="model")return;const ue=se.getModels(),be=[],ge=g.transform.getFreeCameraOptions().position,Ce=i.bY([],[ge.x,ge.y,ge.z],g.transform.worldSize);i.eb(Ce,Ce);const $e=[],Ne=[];let We=0;for(const Xe of ue){const et=h.paint.get("model-rotation").constantOr(null),_t=h.paint.get("model-scale").constantOr(null),Ct=h.paint.get("model-translation").constantOr(null);Xe.computeModelMatrix(g,et,_t,Ct,!0,!0,!1);const jt=i.bx([]),Ft=i.ec(Xe.position.lat,g.transform.zoom),Rt=i.bn([],[1,1,1/Ft]);i.bo(jt,jt,Ce),be.push({zScaleMatrix:Rt,negCameraPosMatrix:jt});for(const Et of Xe.nodes)Jf(g.transform,Et,Xe.matrix,g.transform.expandedFarZProjMatrix,We,$e,Ne);We++}if($e.sort((Xe,et)=>et.depth-Xe.depth),g.renderPass!=="shadow"){if(C===1)for(const Xe of Ne)cn(Xe,g,h,be[Xe.modelIndex],sr.disabled,g.colorModeForRenderPass());else{for(const Xe of Ne)cn(Xe,g,h,be[Xe.modelIndex],sr.disabled,Bi.disabled);for(const Xe of Ne)cn(Xe,g,h,be[Xe.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const Xe of $e)cn(Xe,g,h,be[Xe.modelIndex],sr.disabled,g.colorModeForRenderPass());Z()}else{for(const Xe of Ne)ha(Xe.mesh,Xe.nodeModelMatrix,g,h);for(const Xe of $e)ha(Xe.mesh,Xe.nodeModelMatrix,g,h);Z()}}},td={line:function(g,o,h){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const y=o.getVisibleCoordinates();for(const C of y){const A=o.getTile(C).getBucket(g);if(A&&(A.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,o,h){const y=o.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const C=y.getModels();for(const A of C)A.upload(h.context)},raster:function(g,o,h){const y=o.getSource();if(!(y instanceof ra&&y.loaded()))return;const C=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!C)return;const A=g.paint.get("raster-array-band")||y.getInitialBand(C);if(A==null)return;const R=o.getIds().map($=>o.getTileByID($));for(const $ of R)$.updateNeeded(C,A)&&y.prepareTile($,C,A)},"raster-particle":function(g,o,h){const y=o.getSource();if(!(y instanceof ra&&y.loaded()))return;const C=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!C)return;const A=g.paint.get("raster-particle-array-band")||y.getInitialBand(C);if(A==null)return;const R=o.getIds().map($=>o.getTileByID($));for(const $ of R)$.updateNeeded(C,A)&&y.prepareTile($,C,A)}},Vc={fill:yl},em={fill:function(g,o,h,y){if(!h.layout||h.layout.get("fill-elevation-reference")==="none")return;const C=g.context.gl,A=new Gt(C.LEQUAL,Gt.ReadOnly,g.depthRangeFor3D),R=new sr({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),$=g.transform.getFreeCameraOptions().position,Z=g.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const se of y){const ue=o.getTile(se),be=ue.getBucket(h);if(!be)continue;const ge=be.elevatedStructures;if(!ge||ge.maskSegments.segments[0].primitiveLength===0)continue;const Ce=_p(se.toUnwrapped(),$),$e=g.translatePosMatrix(se.projMatrix,ue,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),Ne=mp($e,Ce,0,0,0);Z.draw(g,C.TRIANGLES,A,R,Bi.disabled,hi.disabled,Ne,h.id,ge.vertexBuffer,ge.indexBuffer,ge.maskSegments,h.paint,g.transform.zoom)}}};class tm{constructor(o,h,y,C,A,R){this.context=new yf(o,h),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=A,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const $=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const se of $)this._debugParams.enabledLayers[se]=!0;A.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),A.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),A.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),A.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),A.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),A.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const se of $)A.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],se);this.occlusionParams=new Jh(A),this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ul(this),this._wireframeDebugCache=new Lu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const Z=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,Z,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=C,this.worldview=R}updateTerrain(o,h){const y=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vg(this,o));const C=this._terrain;this.transform.elevation=y?C:null,C.update(o,this.transform,h),this.transform.elevation&&!C.enabled&&(this.transform.elevation=null)}_updateFog(o){const h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,C]=h.getFovAdjustedRange(this.transform._fov);if(y>C)return void(this.transform.fogCullDistSq=null);const A=y+.78*(C-y);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new vg(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,h){if(this.width=o*i.q.devicePixelRatio,this.height=h*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const o=this.context,h=new i.ba;h.emplaceBack(0,0),h.emplaceBack(i.aj,0),h.emplaceBack(0,i.aj),h.emplaceBack(i.aj,i.aj),this.tileExtentBuffer=o.createVertexBuffer(h,i.bc.members),this.tileExtentSegments=i.bd.simpleSegment(0,0,4,2);const y=new i.ba;y.emplaceBack(0,0),y.emplaceBack(i.aj,0),y.emplaceBack(0,i.aj),y.emplaceBack(i.aj,i.aj),this.debugBuffer=o.createVertexBuffer(y,i.bc.members),this.debugSegments=i.bd.simpleSegment(0,0,4,5);const C=new i.ba;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(-1,1),C.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(C,i.bc.members),this.viewportSegments=i.bd.simpleSegment(0,0,4,2);const A=new i.aZ;A.emplaceBack(0,0,0,0),A.emplaceBack(i.aj,0,i.aj,0),A.emplaceBack(0,i.aj,0,i.aj),A.emplaceBack(i.aj,i.aj,i.aj,i.aj),this.mercatorBoundsBuffer=o.createVertexBuffer(A,i.bf.members),this.mercatorBoundsSegments=i.bd.simpleSegment(0,0,4,2);const R=new i.a_;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(R);const $=new i.bb;for(const se of[0,1,3,2,0])$.emplaceBack(se);this.debugIndexBuffer=o.createIndexBuffer($),this.emptyTexture=new i.T(o,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bz();const Z=this.context.gl;this.stencilClearMode=new sr({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Gt.disabled,this.stencilClearMode,Bi.disabled,hi.disabled,Yf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,y){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let $=!1;for(const Z of y)if(this._tileClippingMaskIDs[Z.key]===void 0){$=!0;break}if(!$)return}this.currentStencilSource=h.id;const C=this.context,A=C.gl;this.nextStencilID+y.length>256&&this.clearStencil(),C.setColorMode(Bi.disabled),C.setDepthMode(Gt.disabled);const R=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const $ of y){const Z=h.getTile($),se=this._tileClippingMaskIDs[$.key]=this.nextStencilID++,{tileBoundsBuffer:ue,tileBoundsIndexBuffer:be,tileBoundsSegments:ge}=this.getTileBoundsBuffers(Z);R.draw(this,A.TRIANGLES,Gt.disabled,new sr({func:A.ALWAYS,mask:0},se,255,A.KEEP,A.KEEP,A.REPLACE),Bi.disabled,hi.disabled,Yf($.projMatrix),"$clipping",ue,be,ge)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new sr({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new sr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,y=o.sort((R,$)=>$.overscaledZ-R.overscaledZ),C=y[y.length-1].overscaledZ,A=y[0].overscaledZ-C+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const R={};for(let $=0;$<A;$++)R[$+C]=new sr({func:h.GEQUAL,mask:255},$+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[R,y]}return[{[C]:sr.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Bi([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bi.unblended:Bi.alphaBlended}colorModeForDrapableLayerRenderPass(o){const h=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new Bi([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.am(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,h,y,C=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!C)return Gt.disabled;const A=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Gt(y||this.context.gl.LEQUAL,h,[A,A])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,h=Math.ceil(this.width),y=Math.ceil(this.height),C=this.context.bindFramebuffer.get(),A=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&y!==0&&(this.depthFBO=new yp(this.context,h,y,!1,"texture"),this.depthTexture=new i.T(this.context,{width:h,height:y,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(C),o.bindTexture(o.TEXTURE_2D,A),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,h,y,0,0,h,y,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,h)=>o+h/this._fpsHistory.length,0))}render(o,h){const y=i.q.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=h;const C=this.style._mergedLayers,A=!(!this.terrain||!this.terrain.enabled),R=()=>this.style._getOrder(A).filter(Ti=>{const $i=C[Ti];return!($i.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[$i.type]});let $=R(),Z=!1,se=!1;for(const Ti of $){const $i=C[Ti];$i.type==="circle"&&(Z=!0),$i.type==="symbol"&&($i.hasInitialOcclusionOpacityProperties?se=!0:Z=!0)}let ue=$.map(Ti=>C[Ti]);const be=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let ge=0,Ce=!1;for(const Ti in be){const $i=be[Ti];$i.used&&($i.prepare(this.context),$i.getSource().usedInConflation&&++ge)}let $e=!1;for(const Ti of ue)Ti.isHidden(this.transform.zoom)||(Ti.type==="clip"&&($e=!0),this.prepareLayer(Ti));const Ne={},We={},Xe={},et={},_t={};for(const Ti in be){const $i=be[Ti];Ne[Ti]=$i.getVisibleCoordinates(),We[Ti]=Ne[Ti].slice().reverse(),Xe[Ti]=$i.getVisibleCoordinates(!0).reverse(),et[Ti]=$i.getShadowCasterCoordinates(),_t[Ti]=$i.sortCoordinatesByDistance(Ne[Ti])}const Ct=Ti=>{const $i=this.style.getLayerSourceCache(Ti);return $i&&$i.used?$i.getSource():null};if(ge||$e||this._clippingActiveLastFrame){const Ti=[],$i=[];let li=0;for(const dr of ue)this.isSourceForClippingOrConflation(dr,Ct(dr))&&(Ti.push(dr),$i.push(li)),li++;if(Ti&&($e||Ti.length>1)||this._clippingActiveLastFrame){$e=!1;const dr=[];for(let Ni=0;Ni<Ti.length;Ni++){const vr=Ti[Ni],Nr=$i[Ni],ar=this.style.getLayerSourceCache(vr);if(!ar||!ar.used||!ar.getSource().usedInConflation&&vr.type!=="clip")continue;let Br=i.eu,dn=i.bQ.None;const pn=[];let on=!0;if(vr.type==="clip"){Br=Nr;for(const bn of vr.layout.get("clip-layer-types"))dn|=bn==="model"?i.bQ.Model:bn==="symbol"?i.bQ.Symbol:i.bQ.FillExtrusion;for(const bn of vr.layout.get("clip-layer-scope"))pn.push(bn);vr.isHidden(this.transform.zoom)?on=!1:$e=!0}on&&dr.push({layer:vr.fqid,cache:ar,order:Br,clipMask:dn,clipScope:pn})}this.replacementSource.setSources(dr),Ce=!0}}this._clippingActiveLastFrame=$e,Ce||this.replacementSource.clear(),this.conflationActive=Ce,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ti=0;Ti<ue.length;Ti++){const $i=ue[Ti],li=$i.cutoffRange();if(this.longestCutoffRange=Math.max(li,this.longestCutoffRange),li>0){const dr=Ct($i);dr&&(this.minCutoffZoom=Math.max(dr.minzoom,this.minCutoffZoom)),$i.minzoom&&(this.minCutoffZoom=Math.max($i.minzoom,this.minCutoffZoom))}$i.is3D(A)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ti),this._lastOcclusionLayer=Ti)}const jt=this.style&&this.style.fog;jt?(this._fogVisible=jt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=jt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Xe),this.opaquePassCutoff=0,$=R(),ue=$.map(Ti=>C[Ti]));const Ft=this._shadowRenderer;if(Ft){Ft.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ti in be)for(const $i of Ne[Ti]){let li={min:0,max:0};this.terrain&&(li=this.terrain.getMinMaxForTile($i)||li),Ft.addShadowReceiver($i.toUnwrapped(),li.min,li.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Qf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Rt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Et=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Rt&&!this._snow&&(this._snow=new Va(this)),!Rt&&this._snow&&(this._snow.destroy(),delete this._snow),Et&&!this._rain&&(this._rain=new Hd(this)),!Et&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!ji.has(this.context.gl))return;this.renderPass="offscreen";for(const Ti of ue){const $i=o.getLayerSourceCache(Ti);if(!Ti.hasOffscreenPass()||Ti.isHidden(this.transform.zoom))continue;const li=$i?We[$i.id]:void 0;(Ti.type==="custom"||Ti.type==="raster"||Ti.type==="raster-particle"||Ti.isSky()||li&&li.length)&&this.renderLayer(this,$i,Ti,li)}this.depthRangeFor3D=[0,1-(ue.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,et)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Wt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),qt=(()=>{if(h.showOverdrawInspector)return i.am.black;const Ti=this.style.fog;if(Ti&&this.transform.projection.supportsFog){const $i=this.style.getLut(Ti.scope);if(!Wt){const li=Ti.properties.get("color-use-theme")==="none",dr=Ti.properties.get("color").toNonPremultipliedRenderColor(li?null:$i).toArray01();return new i.am(...dr)}if(Wt){const li=Ti.properties.get("space-color-use-theme")==="none",dr=Ti.properties.get("space-color").toNonPremultipliedRenderColor(li?null:$i).toArray01();return new i.am(...dr)}}return i.am.transparent})();if(this.context.clear({color:qt,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Wt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=$.length-1;this.currentLayer>=0;this.currentLayer--){const Ti=ue[this.currentLayer],$i=o.getLayerSourceCache(Ti);if(Ti.isSky())continue;const li=$i?(Ti.is3D(A)?_t:We)[$i.id]:void 0;this._renderTileClippingMasks(Ti,$i,li),this.renderLayer(this,$i,Ti,li)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Wt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const Ti=ue[this.currentLayer],$i=o.getLayerSourceCache(Ti);Ti.isSky()&&this.renderLayer(this,$i,Ti,$i?We[$i.id]:void 0)}function Ei(Ti,$i){let li;return $i&&(li=(Ti.type==="symbol"?Xe:Ti.is3D(A)?_t:We)[$i.id]),li}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<$.length;){const Ti=ue[this.currentLayer];if(Ti.type==="raster"||Ti.type==="raster-particle"){const $i=o.getLayerSourceCache(Ti);this.renderLayer(this,$i,Ti,Ei(Ti,$i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Mi=0;Ft&&(Mi=Ft.getShadowCastingLayerCount());let Ki=!1,Ji=-1;for(let Ti=0;Ti<$.length;++Ti){const $i=ue[Ti];$i.isHidden(this.transform.zoom)||$i.is3D(A)&&(Ji=Ti)}se&&Ji===-1&&(Z=!0);let Er=!1;for(;this.currentLayer<$.length;){const Ti=ue[this.currentLayer],$i=o.getLayerSourceCache(Ti);if(Ti.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ti)){if(Ti.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Er&&Ti.is3D(A)&&!A){const li=this.currentLayer,dr=Ni=>{for(this.currentLayer=0;this.currentLayer<ue.length;this.currentLayer++){const vr=ue[this.currentLayer];if(Vc[vr.type]){const Nr=this.style.getLayerSourceCache(vr);Vc[vr.type](this,Nr,vr,Ei(vr,Nr),Ni)}}};dr("initialize"),dr("reset"),this.currentLayer=li,Er=!0}if(Z&&!Ki&&this.terrain&&!this.transform.isOrthographic&&(Ki=!0,this.blitDepth()),se&&Ji!==-1&&this.currentLayer===Ji+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ti,$i,$i?Ne[$i.id]:void 0),this.renderLayer(this,$i,Ti,Ei(Ti,$i)),!this.terrain&&Ft&&Mi>0&&Ti.hasShadowPass()&&--Mi==0){{this.clearStencil();const li=this.currentLayer;for(this.currentLayer=0;this.currentLayer<ue.length;this.currentLayer++){const dr=ue[this.currentLayer];if(em[dr.type]){const Ni=this.style.getLayerSourceCache(dr);em[dr.type](this,Ni,dr,Ei(dr,Ni))}}this.currentLayer=li}if(Ft.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const li=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=li;this.currentLayer++){const dr=ue[this.currentLayer];if(!dr.hasLightBeamPass())continue;const Ni=o.getLayerSourceCache(dr);this.renderLayer(this,Ni,dr,Ni?We[Ni.id]:void 0)}this.currentLayer=li,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const li=this.currentLayer;this.depthOcclusion=!0;for(const dr of this.layersWithOcclusionOpacity){this.currentLayer=dr;const Ni=ue[this.currentLayer],vr=o.getLayerSourceCache(Ni),Nr=vr?We[vr.id]:void 0;this.terrain||this._renderTileClippingMasks(Ni,vr,vr?Ne[vr.id]:void 0),this.renderLayer(this,vr,Ni,Nr)}this.depthOcclusion=!1,this.currentLayer=li,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ti=null;ue.forEach($i=>{const li=o.getLayerSourceCache($i);li&&!$i.isHidden(this.transform.zoom)&&li.getVisibleCoordinates().length&&(!Ti||Ti.getSource().maxzoom<li.getSource().maxzoom)&&(Ti=li)}),Ti&&this.options.showTileBoundaries&&Ju(this,Ti,Ti.getVisibleCoordinates(),i.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ju(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ti){const $i=Ti.transform.padding;Cl(Ti,Ti.transform.height-($i.top||0),3,O0),Cl(Ti,$i.bottom||0,3,dh),Wd(Ti,$i.left||0,3,Uh),Wd(Ti,Ti.transform.width-($i.right||0),3,Om);const li=Ti.transform.centerPoint;(function(dr,Ni,vr,Nr){jp(dr,Ni-1,vr-10,2,20,Nr),jp(dr,Ni-10,vr-1,20,2,Nr)})(Ti,li.x,Ti.transform.height-li.y,$h)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Ce||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:h}=this.transform.projection,y=!h||!h.includes(o.type);if(td[o.type]&&(y||this.terrain&&o.type==="custom")){const C=this.style.getLayerSourceCache(o);td[o.type](o,C,this)}this.gpuTimingEnd()}renderLayer(o,h,y,C){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||C&&C.length)&&(this.id=y.id,this.gpuTimingStart(y),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(y.type)&&(!o.terrain||y.type!=="custom")||y.type==="clip"||lo[y.type](o,h,y,C,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,y=this.context.gl;let C=this.gpuTimers[o.id];C||(C=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:y.createQuery()}),C.calls++,y.beginQuery(h.TIME_ELAPSED_EXT,C.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,h=this.context.gl,y=h.createQuery();this.deferredRenderGpuTimeQueries.push(y),h.beginQuery(o.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const h={};for(const y in o){const C=o[y],A=this.context.extTimerQuery,R=A.getQueryParameter(C.query,this.context.gl.QUERY_RESULT)/1e6;A.deleteQueryEXT(C.query),h[y]=R}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let y=0;for(const C of o)y+=h.getQueryParameter(C,h.QUERY_RESULT)/1e6,h.deleteQuery(C);return y}translatePosMatrix(o,h,y,C,A){if(!y[0]&&!y[1])return o;const R=A?C==="map"?this.transform.angle:0:C==="viewport"?-this.transform.angle:0;if(R){const se=Math.sin(R),ue=Math.cos(R);y=[y[0]*ue-y[1]*se,y[0]*se+y[1]*ue]}const $=[A?y[0]:i.aw(h,y[0],this.transform.zoom),A?y[1]:i.aw(h,y[1],this.transform.zoom),0],Z=new Float32Array(16);return i.bo(Z,o,$),Z}saveTileTexture(o){const h=o.size[0],y=this._tileTextures[h];y?y.push(o):this._tileTextures[h]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,h,y){const C=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,A=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):C||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||A.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||C||h!==void 0&&!h||A.push("FOG","FOG_DITHERING"),C&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(o,h){this.cache=this.cache||{};const y=h&&h.defines||[],C=h&&h.config,A=this.currentGlobalDefines(o,h&&h.overrideFog,h&&h.overrideRtt).concat(y),R=Sd.cacheKey(bd[o],o,A,C);return this.cache[R]||(this.cache[R]=new Sd(this.context,o,bd[o],C,Qu[o],A)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,h){if(this.style.enable3dLights()){const y=this.style.directionalLight,C=this.style.ambientLight;if(y&&C){const A=((R,$,Z)=>{const se=R.properties.get("direction"),ue=R.properties.get("color-use-theme")==="none",be=R.properties.get("color").toNonPremultipliedRenderColor(ue?null:Z.getLut(R.scope)).toArray01(),ge=R.properties.get("intensity"),Ce=$.properties.get("color-use-theme")==="none",$e=$.properties.get("color").toNonPremultipliedRenderColor(Ce?null:Z.getLut($.scope)).toArray01(),Ne=$.properties.get("intensity"),We=[se.x,se.y,se.z],Xe=i.dw($e,Ne),et=i.dw(be,ge);return{u_lighting_ambient_color:Xe,u_lighting_directional_dir:We,u_lighting_directional_color:et,u_ground_radiance:xg(We,et,Xe)}})(y,C,this.style);h.setLightsUniformValues(o,A)}}}uploadCommonUniforms(o,h,y,C,A){if(this.uploadCommonLightUniforms(o,h),this.terrain&&this.terrain.renderingToTexture)return;const R=this.style.fog;if(R){const $=R.getOpacity(this.transform.pitch),Z=((se,ue,be,ge,Ce,$e,Ne,We,Xe,et,_t,Ct)=>{const jt=se.transform,Ft=ue.properties.get("color-use-theme")==="none",Rt=ue.properties.get("color").toNonPremultipliedRenderColor(Ft?null:se.style.getLut(ue.scope)).toArray01();Rt[3]=ge;const Et=se.frameCounter/1e3%1,[Wt,qt]=ue.properties.get("vertical-range");return{u_fog_matrix:be?jt.calculateFogTileMatrix(be):Ct||se.identityMat,u_fog_range:ue.getFovAdjustedRange(jt._fov),u_fog_color:Rt,u_fog_horizon_blend:ue.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Wt,qt),qt],u_fog_temporal_offset:Et,u_frustum_tl:Ce,u_frustum_tr:$e,u_frustum_br:Ne,u_frustum_bl:We,u_globe_pos:Xe,u_globe_radius:et,u_viewport:_t,u_globe_transition:i.ah(jt.zoom),u_is_globe:+(jt.projection.name==="globe")}})(this,R,y,$,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],C);h.setFogUniformValues(o,Z)}A&&h.setCutoffUniformValues(o,A.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const C of y)h[C.key]=o[C.key]||new Ys(C,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,h){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[o.key];return h||(this._cachedTileFogOpacities[o.key]=h=this.style.fog.getOpacityForTile(o)),h[0]>=Fi||h[1]>=Fi}setupDepthForOcclusion(o,h,y){const C=this.context,A=C.gl,R=!!y;var $;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),C.activeTexture.set(A.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/(($=this.depthRangeFor3D)[1]-$[0]),-1-2*$[0]/($[1]-$[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),C.activeTexture.set(A.TEXTURE0),R||h.setTerrainUniformValues(C,y)}}function xp(g,o){let h=!1,y=null;const C=()=>{y=null,h&&(g(),y=setTimeout(C,o),h=!1)};return()=>(h=!0,y||C(),y)}class Gd{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xp(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const h=im(o);if(this._hashName){const y=this._hashName;let C=!1;const A=location.hash.slice(1).split("&").map(R=>{const $=R.split("=")[0];return $===y?(C=!0,`${$}=${h}`):R}).filter(R=>R);return C||A.push(`${y}=${h}`),`#${A.join("&")}`}return`#${h}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(Number(y)))){const y=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function im(g,o){const h=g.getCenter(),y=Math.round(100*g.getZoom())/100,C=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,C),R=Math.round(h.lng*A)/A,$=Math.round(h.lat*A)/A,Z=g.getBearing(),se=g.getPitch();let ue=o?`/${R}/${$}/${y}`:`${y}/${$}/${R}`;return(Z||se)&&(ue+="/"+Math.round(10*Z)/10),se&&(ue+=`/${Math.round(se)}`),ue}const id={linearity:.3,easing:i.ew(0,0,.3,1)},sc=i.h({deceleration:2500,maxSpeed:1400},id),Wc=i.h({deceleration:20,maxSpeed:1400},id),bf=i.h({deceleration:1e3,maxSpeed:360},id),Cg=i.h({deceleration:1e3,maxSpeed:90},id);class Hp{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=i.q.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(h.pan.mag()){const A=wf(h.pan.mag(),y,i.h({},sc,o||{}));C.offset=h.pan.mult(A.amount/h.pan.mag()),C.center=this._map.transform.center,rd(C,A)}if(h.zoom){const A=wf(h.zoom,y,Wc);C.zoom=this._map.transform.zoom+A.amount,rd(C,A)}if(h.bearing){const A=wf(h.bearing,y,bf);C.bearing=this._map.transform.bearing+i.ay(A.amount,-179,179),rd(C,A)}if(h.pitch){const A=wf(h.pitch,y,Cg);C.pitch=this._map.transform.pitch+A.amount,rd(C,A)}if(C.zoom||C.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;C.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),C.noMoveStart=!0,C}}function rd(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function wf(g,o,h){const{maxSpeed:y,linearity:C,deceleration:A}=h,R=i.ay(g*C/(o/1e3),-y,y),$=Math.abs(R)/(A*C);return{easing:h.easing,duration:1e3*$,amount:R*($/2)}}class Pl extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,y,C={}){const A=Ye(h.getCanvasContainer(),y),R=h.unproject(A);super(o,i.h({point:A,lngLat:R,originalEvent:y},C)),this._defaultPrevented=!1,this.target=h}}class rm extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,y){const C=o==="touchend"?y.changedTouches:y.touches,A=lt(h.getCanvasContainer(),C),R=A.map(Z=>h.unproject(Z)),$=A.reduce((Z,se,ue,be)=>Z.add(se.div(be.length)),new i.P(0,0));super(o,{points:A,point:$,lngLats:R,lngLat:h.unproject($),originalEvent:y}),this._defaultPrevented=!1}}class Wh extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class ih{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Wh(this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Pl(o.type,this._map,o))}mouseup(o){this._map.fire(new Pl(o.type,this._map,o))}preclick(o){const h=i.h({},o);h.type="preclick",this._map.fire(new Pl(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Pl(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Pl(o.type,this._map,o))}mouseover(o){this._map.fire(new Pl(o.type,this._map,o))}mouseout(o){this._map.fire(new Pl(o.type,this._map,o))}touchstart(o){return this._firePreventable(new rm(o.type,this._map,o))}touchmove(o){this._map.fire(new rm(o.type,this._map,o))}touchend(o){this._map.fire(new rm(o.type,this._map,o))}touchcancel(o){this._map.fire(new rm(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sf{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Pl(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Pl(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ay{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(ke(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const y=h,C=this._startPos,A=this._lastPos;if(!C||!A||A.equals(y)||!this._box&&y.dist(C)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const R=Math.min(C.x,y.x),$=Math.max(C.x,y.x),Z=Math.min(C.y,y.y),se=Math.max(C.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${R}px,${Z}px)`,this._box.style.width=$-R+"px",this._box.style.height=se-Z+"px")})}mouseupWindow(o,h){if(!this._active)return;const y=this._startPos,C=h;if(y&&o.button===0){if(this.reset(),He(),y.x!==C.x||y.y!==C.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:o})),{cameraAnimation:A=>A.fitScreenCoordinates(y,C,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ee(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new i.A(o,{originalEvent:h}))}}function Id(g,o){const h={};for(let y=0;y<g.length;y++)h[g[y].identifier]=o[y];return h}class Ac{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(C){const A=new i.P(0,0);for(const R of C)A._add(R);return A.div(C.length)}(h),this.touches=Id(y,h)))}touchmove(o,h,y){if(this.aborted||!this.centroid)return;const C=Id(y,h);for(const A in this.touches){const R=C[A];(!R||R.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(o,h,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class qd{constructor(o){this.singleTap=new Ac(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,y){this.singleTap.touchstart(o,h,y)}touchmove(o,h,y){this.singleTap.touchmove(o,h,y)}touchend(o,h,y){const C=this.singleTap.touchend(o,h,y);if(C){const A=o.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(C)<30;if(A&&R||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class Eg{constructor(){this._zoomIn=new qd({numTouches:1,numTaps:2}),this._zoomOut=new qd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,y){this._zoomIn.touchstart(o,h,y),this._zoomOut.touchstart(o,h,y)}touchmove(o,h,y){this._zoomIn.touchmove(o,h,y),this._zoomOut.touchmove(o,h,y)}touchend(o,h,y){const C=this._zoomIn.touchend(o,h,y),A=this._zoomOut.touchend(o,h,y);return C?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(C)},{originalEvent:o})}):A?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(A)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gp={0:1,2:2},Ld={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Dd{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const y=Pt(o);this._correctButton(o,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(o,h){const y=this._lastPoint;if(y){if(o.preventDefault(),this._eventButton!=null&&function(C,A){const R=Gp[A];return C.buttons===void 0||(C.buttons&R)!==R}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}}mouseupWindow(o){this._lastPoint&&Pt(o)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fm extends Dd{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class nm extends Dd{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Ld[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const y=.8*(h.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class rh extends Dd{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Ld[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const y=-.5*(h.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class jh{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,h,y){return this._calculateTransform(o,h,y)}touchmove(o,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!i.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,y)}}touchend(o,h,y){this._calculateTransform(o,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,y){y.length>0&&(this._active=!0);const C=Id(y,h),A=new i.P(0,0),R=new i.P(0,0);let $=0;for(const se in C){const ue=C[se],be=this._touches[se];be&&(A._add(ue),R._add(ue.sub(be)),$++,C[se]=ue)}if(this._touches=C,$<this._minTouches||!R.mag())return;const Z=R.div($);return this._sum._add(Z),this._sum.mag()<this._clickTolerance?void 0:{around:A.div($),panDelta:Z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Pd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,y){return{}}touchstart(o,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,y){const C=this._firstTwoTouches;if(!C)return;o.preventDefault();const[A,R]=C,$=sm(y,h,A),Z=sm(y,h,R);if(!$||!Z)return;const se=this._aroundCenter?null:$.add(Z).div(2);return this._move([$,Z],se,o)}touchend(o,h,y){if(!this._firstTwoTouches)return;const[C,A]=this._firstTwoTouches,R=sm(y,h,C),$=sm(y,h,A);R&&$||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function sm(g,o,h){for(let y=0;y<g.length;y++)if(g[y].identifier===h)return o[y]}function zm(g,o){return Math.log(g/o)/Math.LN2}class Du extends Pd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(zm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zm(this._distance,y),pinchAround:h}}}function Pu(g,o){return 180*g.angleWith(o)/Math.PI}class om extends Pd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const y=this._vector;if(this._vector=o[0].sub(o[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pu(this._vector,y),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const C=Pu(o,y);return Math.abs(C)<h}}function Sa(g){return Math.abs(g.y)>Math.abs(g.x)}class kg extends Pd{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Sa(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,y){const C=this._lastPoints;if(!C)return;const A=o[0].sub(C[0]),R=o[1].sub(C[1]);return this._map._cooperativeGestures&&!i.ex()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(A,R,y.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(A.y+R.y)/2*-.5})}gestureBeginsVertically(o,h,y){if(this._valid!==void 0)return this._valid;const C=o.mag()>=2,A=h.mag()>=2;if(!C&&!A)return;if(!C||!A)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const R=o.y>0==h.y>0;return Sa(o)&&Sa(h)&&R}}const Ou={panStep:100,bearingStep:15,pitchStep:10};class qp{constructor(){const o=Ou;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,y=0,C=0,A=0,R=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),A=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),A=1);break;case 38:o.shiftKey?C=1:(o.preventDefault(),R=-1);break;case 40:o.shiftKey?C=-1:(o.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(y=0,C=0),{cameraAnimation:$=>{const Z=$.getZoom();$.easeTo({duration:300,easeId:"keyboardHandler",easing:tu,zoom:h?Math.round(Z)+h*(o.shiftKey?2:1):Z,bearing:$.getBearing()+y*this._bearingStep,pitch:$.getPitch()+C*this._pitchStep,offset:[-A*this._panStep,-R*this._panStep],center:$.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tu(g){return g*(2-g)}const Ag=4.000244140625,am=1/450;class gu{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=am,i.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=i.q.now(),C=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%Ag==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(C*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Ye(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const se=this._type==="wheel"&&Math.abs(this._delta)>Ag?this._wheelZoomRate:this._defaultZoomRate;let ue=2/(1+Math.exp(-Math.abs(this._delta*se)));this._delta<0&&ue!==0&&(ue=1/ue);const be=h(),ge=Math.pow(2,be),Ce=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):ge;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Ce*ue))),this._type==="wheel"&&(this._startZoom=be,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:h(),C=this._startZoom,A=this._easing;let R,$=!1;if(this._type==="wheel"&&C&&A){const se=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),ue=A(se);R=i.ai(C,y,ue),se<1?this._frameId||(this._frameId=!0):$=!0}else R=y,$=!0;this._active=!0,$&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let Z=R-h();return Z*this._lastDelta<0&&(Z=0),{noInertia:!0,needsRenderFrame:!$,zoomDelta:Z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=i.ey;if(this._prevEase){const y=this._prevEase,C=(i.q.now()-y.start)/y.duration,A=y.easing(C+.01)-y.easing(C),R=.27/Math.sqrt(A*A+1e-4)*.01,$=Math.sqrt(.0729-R*R);h=i.ew(R,$,.25,1)}return this._prevEase={start:i.q.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ru{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gn{constructor(){this._tap=new qd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,h,y))}touchmove(o,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const C=h[0],A=C.y-this._swipePoint.y;return this._swipePoint=C,o.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(o,h,y)}touchend(o,h,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,h,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Um{constructor(o,h,y){this._el=o,this._mousePan=h,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $m{constructor(o,h,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bp{constructor(o,h,y,C){this._el=o,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Yp=g=>g.zoom||g.drag||g.pitch||g.rotate;class nl extends i.A{}class nd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const y=i.at([],h,o);this.radius=i.ae(y[2]<0?i.eA([],y,this.constants):[y[0],y[1],0])}projectRay(o){i.eA(o,o,this.constants),i.au(o,o),i.eB(o,o,this.constants);const h=i.bY([],o,this.radius);if(h[2]>0){const y=i.bY([],[0,0,1],i.bG(h,[0,0,1])),C=i.bY([],i.au([],[h[0],h[1],0]),this.radius),A=i.cV([],h,i.bY([],i.at([],i.cV([],C,y),h),2));h[0]=A[0],h[1]=A[1]}return h}}function Kl(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Mg{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hp(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new nd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.aV(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[C,A,R]of this._listeners){const $=C===document?this.handleWindowEvent:this.handleEvent;C.addEventListener(A,$,R)}}destroy(){for(const[o,h,y]of this._listeners){const C=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(h,C,y)}}_addDefaultHandlers(o){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new ih(h,o));const C=h.boxZoom=new ay(h,o);this._add("boxZoom",C);const A=new Eg,R=new yc;h.doubleClickZoom=new Ru(R,A),this._add("tapZoom",A),this._add("clickZoom",R);const $=new Gn;this._add("tapDragZoom",$);const Z=h.touchPitch=new kg(h);this._add("touchPitch",Z);const se=new nm(o),ue=new rh(o);h.dragRotate=new $m(o,se,ue),this._add("mouseRotate",se,["mousePitch"]),this._add("mousePitch",ue,["mouseRotate"]);const be=new Fm(o),ge=new jh(h,o);h.dragPan=new Um(y,be,ge),this._add("mousePan",be),this._add("touchPan",ge,["touchZoom","touchRotate"]);const Ce=new om,$e=new Du;h.touchZoomRotate=new bp(y,$e,Ce,$),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",$e,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sf(h));const Ne=h.scrollZoom=new gu(h,this);this._add("scrollZoom",Ne,["mousePan"]);const We=h.keyboard=new qp;this._add("keyboard",We);for(const Xe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Xe]&&h[Xe].enable(o[Xe])}_add(o,h,y){this._handlers.push({handlerName:o,handler:h,allowed:y}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,h,y){for(const C in o)if(C!==y&&(!h||h.indexOf(C)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const y of o)this._el.contains(y.target)&&h.push(y);return h}handleEvent(o,h){this._updatingCamera=!0;const y=o.type==="renderFrame",C=y?void 0:o,A={needsRenderFrame:!1},R={},$={},Z=o.touches?this._getMapTouches(o.touches):void 0,se=Z?lt(this._el,Z):y?void 0:Ye(this._el,o);for(const{handlerName:ge,handler:Ce,allowed:$e}of this._handlers){if(!Ce.isEnabled())continue;let Ne;this._blockedByActive($,$e,ge)?Ce.reset():Ce[h||o.type]&&(Ne=Ce[h||o.type](o,se,Z),this.mergeHandlerResult(A,R,Ne,ge,C),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Ce.isActive())&&($[ge]=Ce)}const ue={};for(const ge in this._previousActiveHandlers)$[ge]||(ue[ge]=C);this._previousActiveHandlers=$,(Object.keys(ue).length||Kl(A))&&(this._changes.push([A,R,ue]),this._triggerRenderFrame()),(Object.keys($).length||Kl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:be}=A;be&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],be(this._map))}mergeHandlerResult(o,h,y,C,A){if(!y)return;i.h(o,y);const R={handlerName:C,originalEvent:y.originalEvent||A};y.zoomDelta!==void 0&&(h.zoom=R),y.panDelta!==void 0&&(h.drag=R),y.pitchDelta!==void 0&&(h.pitch=R),y.bearingDelta!==void 0&&(h.rotate=R)}_applyChanges(){const o={},h={},y={};for(const[C,A,R]of this._changes)C.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(C.panDelta)),C.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(o.around=C.around),C.aroundCoord!==void 0&&(o.aroundCoord=C.aroundCoord),C.pinchAround!==void 0&&(o.pinchAround=C.pinchAround),C.noInertia&&(o.noInertia=C.noInertia),i.h(h,A),i.h(y,R);this._updateMapTransform(o,h,y),this._changes=[]}_updateMapTransform(o,h,y){const C=this._map,A=C.transform,R=et=>[et.x,et.y,et.z];if((et=>{const _t=this._eventsInProgress.drag;return _t&&!this._handlersById[_t.handlerName].isActive()})()&&!Kl(o)){const et=A.zoom;A.cameraElevationReference="sea",this._originalZoom!=null&&A._orthographicProjectionAtLowPitch&&A.projection.name!=="globe"&&A.pitch===0?(A.cameraElevationReference="ground",A.zoom=this._originalZoom):(A.recenterOnTerrain(),A.cameraElevationReference="ground"),et!==A.zoom&&this._map._update(!0)}if(A._isCameraConstrained&&C._stop(!0),!Kl(o))return void this._fireEvents(h,y,!0);let{panDelta:$,zoomDelta:Z,bearingDelta:se,pitchDelta:ue,around:be,aroundCoord:ge,pinchAround:Ce}=o;A._isCameraConstrained&&(Z>0&&(Z=0),A._isCameraConstrained=!1),Ce!==void 0&&(be=Ce),(Z||(et=>h[et]&&!this._eventsInProgress[et])("drag"))&&be&&(this._dragOrigin=R(A.pointCoordinate3D(be)),this._originalZoom=A.zoom,this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",C._stop(!0),be=be||C.transform.centerPoint,se&&(A.bearing+=se),ue&&(A.pitch+=ue),A._updateCameraState();const $e=[0,0,0];if($)if(A.projection.name==="mercator"){const et=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(be).dir),_t=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(be.sub($)).dir);$e[0]=_t[0]-et[0],$e[1]=_t[1]-et[1]}else{const et=A.pointCoordinate(be);if(A.projection.name==="globe"){$=$.rotate(-A.angle);const _t=A._pixelsPerMercatorPixel/A.worldSize;$e[0]=-$.x*i.ez(i.aY(et.y))*_t,$e[1]=-$.y*i.ez(A.center.lat)*_t}else{const _t=A.pointCoordinate(be.sub($));et&&_t&&($e[0]=_t.x-et.x,$e[1]=_t.y-et.y)}}const Ne=A.zoom,We=[0,0,0];if(Z){const et=R(ge||A.pointCoordinate3D(be)),_t={dir:i.au([],i.at([],et,A._camera.position))};if(_t.dir[2]<0){const Ct=A.zoomDeltaToMovement(et,Z);i.bY(We,_t.dir,Ct)}}const Xe=i.cV($e,$e,We);A._translateCameraConstrained(Xe),Z&&Math.abs(A.zoom-Ne)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,y,!0)}_fireEvents(o,h,y){const C=Yp(this._eventsInProgress),A=Yp(o),R={};for(const ue in o){const{originalEvent:be}=o[ue];this._eventsInProgress[ue]||(R[`${ue}start`]=be),this._eventsInProgress[ue]=o[ue]}!C&&A&&this._fireEvent("movestart",A.originalEvent);for(const ue in R)this._fireEvent(ue,R[ue]);A&&this._fireEvent("move",A.originalEvent);for(const ue in o){const{originalEvent:be}=o[ue];this._fireEvent(ue,be)}const $={};let Z;for(const ue in this._eventsInProgress){const{handlerName:be,originalEvent:ge}=this._eventsInProgress[ue];this._handlersById[be].isActive()||(delete this._eventsInProgress[ue],Z=h[be]||ge,$[`${ue}end`]=Z)}for(const ue in $)this._fireEvent(ue,$[ue]);const se=Yp(this._eventsInProgress);if(y&&(C||A)&&!se){this._updatingCamera=!0;const ue=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),be=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;ue?(be(ue.bearing||this._map.getBearing())&&(ue.bearing=0),this._map.easeTo(ue,{originalEvent:Z})):(this._map.fire(new i.A("moveend",{originalEvent:Z})),be(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new i.A(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new nl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const _c="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xp extends i.E{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.aV(["_renderFrameCallback"],this)}getCenter(){return new i.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,y){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,i.h({offset:o},h),y)}panTo(o,h,y){return this.easeTo(i.h({center:o},h),y)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,y){return this.easeTo(i.h({zoom:o},h),y)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,y){return this.easeTo(i.h({bearing:o},h),y)}resetNorth(o,h){return this.rotateTo(0,i.h({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(i.h({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=i.aG.convert(o);const y=h&&h.bearing||0,C=h&&h.pitch||0,A=o.getNorthWest(),R=o.getSouthEast();return this._cameraForBounds(this.transform,A,R,y,C,h)}_extendPadding(o){const h={top:0,right:0,bottom:0,left:0};return o==null?i.h({},h,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:i.h({},h,o)}_extendCameraOptions(o){return(o=i.h({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,h){const y=h.max[0]-h.min[0],C=h.max[1]-h.min[1];return y/C>o.aspect?y/(2*Math.tan(.5*o.fovX)*o.aspect):C/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,h,y,C,A,R){const $=o.clone(),Z=this._extendCameraOptions(R);$.bearing=C,$.pitch=A;const se=i.cd.convert(h),ue=i.cd.convert(y),be=.5*(se.lat+ue.lat),ge=.5*(se.lng+ue.lng),Ce=i.eC(be,ge),$e=i.au([],Ce),Ne=i.au([],i.bF([],$e,[0,1,0])),We=i.bF([],Ne,$e),Xe=[Ne[0],Ne[1],Ne[2],0,We[0],We[1],We[2],0,$e[0],$e[1],$e[2],0,0,0,0,1],et=[Ce,i.eC(se.lat,se.lng),i.eC(ue.lat,se.lng),i.eC(ue.lat,ue.lng),i.eC(se.lat,ue.lng),i.eC(be,se.lng),i.eC(be,ue.lng),i.eC(se.lat,ge),i.eC(ue.lat,ge)];let _t=i.cW.fromPoints(et.map(Ni=>[i.bG(Ne,Ni),i.bG(We,Ni),i.bG($e,Ni)]));const Ct=i.ad([],_t.center,Xe);i.eD(Ct)===0&&i.eE(Ct,0,0,1),i.au(Ct,Ct),i.bY(Ct,Ct,i.aB),$.center=i.eF(Ct);const jt=$.getWorldToCameraMatrix(),Ft=i.bi(new Float64Array(16),jt);_t=i.cW.applyTransform(_t,i.az([],jt,Xe));const Rt=this._extendAABB(_t,$,Z,C);if(!Rt)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_t=Rt,i.ad(Ct,Ct,jt);const Et=.5*(_t.max[2]-_t.min[2]),Wt=this._minimumAABBFrustumDistance($,_t),qt=i.bY([],[0,0,1],Et),Ei=i.cV(qt,Ct,qt),Mi=Wt+($.pitch===0?0:i.bD(Ct,Ei)),Ki=$.globeCenterInViewSpace,Ji=i.at([],Ct,[Ki[0],Ki[1],Ki[2]]);i.au(Ji,Ji),i.bY(Ji,Ji,Mi);const Er=i.cV([],Ct,Ji);i.ad(Er,Er,Ft);const Ti=i.eq/i.aB,$i=i.ae(Er),li=i.c6(Math.max($i*Ti-i.eq,Number.EPSILON),0),dr=Math.min($.zoomFromMercatorZAdjusted(li),Z.maxZoom);return dr>.5*(i.cL+i.cx)?($.setProjection({name:"mercator"}),$.zoom=dr,this._cameraForBounds($,h,y,C,A,R)):{center:$.center,zoom:dr,bearing:C,pitch:A}}_extendAABB(o,h,y,C){const A=.5*((y.padding.left||0)+(y.padding.right||0)),R=.5*((y.padding.top||0)+(y.padding.bottom||0)),$=R,Z=A,se=A,ue=R,be=h.width-(Z+se),ge=h.height-($+ue),Ce=i.at([],o.max,o.min),$e=Math.min(be/Ce[0],ge/Ce[1]),Ne=Math.min(h.scaleZoom(h.scale*$e),y.maxZoom);if(isNaN(Ne))return null;const We=h.scale/h.zoomScale(Ne),Xe=new i.cW([o.min[0]-Z*We,o.min[1]-ue*We,o.min[2]],[o.max[0]+se*We,o.max[1]+$*We,o.max[2]]),et=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new i.P(y.offset.x,y.offset.y):i.P.convert(y.offset)).rotate(-i.al(C));return Xe.center[0]-=et.x*We,Xe.center[1]+=et.y*We,Xe}queryTerrainElevation(o,h){const y=this.transform.elevation;return y?(h=i.h({},{exaggerated:!0},h),y.getAtPoint(i.ac.fromLngLat(o),null,h.exaggerated)):null}_cameraForBounds(o,h,y,C,A,R){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,h,y,C,A,R);const $=o.clone(),Z=this._extendCameraOptions(R);$.bearing=C,$.pitch=A;const se=i.cd.convert(h),ue=i.cd.convert(y),be=new i.cd(se.lng,ue.lat),ge=new i.cd(ue.lng,se.lat),Ce=$.project(se),$e=$.project(ue),Ne=this.queryTerrainElevation(se),We=this.queryTerrainElevation(ue),Xe=this.queryTerrainElevation(be),et=this.queryTerrainElevation(ge),_t=[[Ce.x,Ce.y,Math.min(Ne||0,We||0,Xe||0,et||0)],[$e.x,$e.y,Math.max(Ne||0,We||0,Xe||0,et||0)]];let Ct=i.cW.fromPoints(_t);const jt=$.getWorldToCameraMatrix(),Ft=i.bi(new Float64Array(16),jt);Ct=i.cW.applyTransform(Ct,jt);const Rt=this._extendAABB(Ct,$,Z,C);if(!Rt)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ct=Rt;const Et=.5*i.at([],Ct.max,Ct.min)[2],Wt=this._minimumAABBFrustumDistance($,Ct),qt=[0,0,1,0];i.aA(qt,qt,jt),i.eG(qt,qt);const Ei=i.bY([],qt,Wt+Et),Mi=i.cV([],Ct.center,Ei);i.ad(Ct.center,Ct.center,Ft),i.ad(Mi,Mi,Ft);const Ki=$.unproject(new i.P(Ct.center[0],Ct.center[1])),Ji=i.eH($.projection,Ki),Er=Math.pow(2,Ji),Ti=Math.min($._zoomFromMercatorZ(Mi[2]*$.pixelsPerMeter*Er/$.worldSize),Z.maxZoom);return $.mercatorFromTransition&&Ti<.5*(i.cL+i.cx)?($.setProjection({name:"globe"}),$.zoom=Ti,this._cameraForBounds($,h,y,C,A,R)):{center:Ki,zoom:Ti,bearing:C,pitch:A}}fitBounds(o,h,y){const C=this.cameraForBounds(o,h);return this._fitInternal(C,h,y)}fitScreenCoordinates(o,h,y,C,A){const R=i.P.convert(o),$=i.P.convert(h),Z=new i.P(Math.min(R.x,$.x),Math.min(R.y,$.y)),se=new i.P(Math.max(R.x,$.x),Math.max(R.y,$.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(R,$))return this;const ue=this.transform.pointLocation3D(Z),be=this.transform.pointLocation3D(se),ge=this.transform.pointLocation3D(new i.P(Z.x,se.y)),Ce=this.transform.pointLocation3D(new i.P(se.x,Z.y)),$e=[Math.min(ue.lng,be.lng,ge.lng,Ce.lng),Math.min(ue.lat,be.lat,ge.lat,Ce.lat)],Ne=[Math.max(ue.lng,be.lng,ge.lng,Ce.lng),Math.max(ue.lat,be.lat,ge.lat,Ce.lat)],We=C&&C.pitch?C.pitch:this.getPitch(),Xe=this._cameraForBounds(this.transform,$e,Ne,y,We,C);return this._fitInternal(Xe,C,A)}_fitInternal(o,h,y){return o?(h=i.h(o,h)).linear?this.easeTo(h,y):this.flyTo(h,y):this}jumpTo(o,h){this.stop();const y=o.preloadOnly?this.transform.clone():this.transform;let C=!1,A=!1,R=!1;"zoom"in o&&y.zoom!==+o.zoom&&(C=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=i.cd.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(A=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(R=!0,y.pitch=+o.pitch);const $=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!y.isPaddingEqual($))if(o.retainPadding===!1){const Z=y.clone();Z.padding=$,y.setLocationAtPoint(y.center,Z.centerPoint)}else y.padding=$;return o.preloadOnly?(this._preloadTiles(y),this):(this.fire(new i.A("movestart",h)).fire(new i.A("move",h)),C&&this.fire(new i.A("zoomstart",h)).fire(new i.A("zoom",h)).fire(new i.A("zoomend",h)),A&&this.fire(new i.A("rotatestart",h)).fire(new i.A("rotate",h)).fire(new i.A("rotateend",h)),R&&this.fire(new i.A("pitchstart",h)).fire(new i.A("pitch",h)).fire(new i.A("pitchend",h)),this.fire(new i.A("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(_c),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return i.w(_c),this;this.stop();const C=y.zoom,A=y.pitch,R=y.bearing;y.setFreeCameraOptions(o);const $=C!==y.zoom,Z=A!==y.pitch,se=R!==y.bearing;return this.fire(new i.A("movestart",h)).fire(new i.A("move",h)),$&&this.fire(new i.A("zoomstart",h)).fire(new i.A("zoom",h)).fire(new i.A("zoomend",h)),se&&this.fire(new i.A("rotatestart",h)).fire(new i.A("rotate",h)).fire(new i.A("rotateend",h)),Z&&this.fire(new i.A("pitchstart",h)).fire(new i.A("pitch",h)).fire(new i.A("pitchend",h)),this.fire(new i.A("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=i.h({offset:[0,0],duration:500,easing:i.ey},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const y=this.transform,C=this.getZoom(),A=this.getBearing(),R=this.getPitch(),$=this.getPadding(),Z="zoom"in o?+o.zoom:C,se="bearing"in o?this._normalizeBearing(o.bearing,A):A,ue="pitch"in o?+o.pitch:R,be=this._extendPadding(o.padding),ge=i.P.convert(o.offset);let Ce,$e,Ne;if(y.projection.name==="globe"){const qt=i.ac.fromLngLat(y.center),Ei=ge.rotate(-y.angle);qt.x+=Ei.x/y.worldSize,qt.y+=Ei.y/y.worldSize;const Mi=qt.toLngLat(),Ki=i.cd.convert(o.center||Mi);this._normalizeCenter(Ki),Ce=y.centerPoint.add(Ei),$e=new i.P(qt.x,qt.y).mult(y.worldSize),Ne=new i.P(i.aD(Ki.lng),i.aH(Ki.lat)).mult(y.worldSize).sub($e)}else{Ce=y.centerPoint.add(ge);const qt=y.pointLocation(Ce),Ei=i.cd.convert(o.center||qt);this._normalizeCenter(Ei),$e=y.project(qt),Ne=y.project(Ei).sub($e)}const We=y.zoomScale(Z-C);let Xe,et;o.around&&(Xe=i.cd.convert(o.around),et=y.locationPoint(Xe));const _t=this._zooming||Z!==C,Ct=this._rotating||A!==se,jt=this._pitching||ue!==R,Ft=!y.isPaddingEqual(be),Rt=o.retainPadding===!1?y.clone():y,Et=qt=>Ei=>{if(_t&&(qt.zoom=i.ai(C,Z,Ei)),Ct&&(qt.bearing=i.ai(A,se,Ei)),jt&&(qt.pitch=i.ai(R,ue,Ei)),Ft&&(Rt.interpolatePadding($,be,Ei),Ce=Rt.centerPoint.add(ge)),Xe)qt.setLocationAtPoint(Xe,et);else{const Mi=qt.zoomScale(qt.zoom-C),Ki=Z>C?Math.min(2,We):Math.max(.5,We),Ji=Math.pow(Ki,1-Ei),Er=qt.unproject($e.add(Ne.mult(Ei*Ji)).mult(Mi));qt.setLocationAtPoint(qt.renderWorldCopies?Er.wrap():Er,Ce)}return o.preloadOnly||this._fireMoveEvents(h),qt};if(o.preloadOnly){const qt=this._emulate(Et,o.duration,y);return this._preloadTiles(qt),this}const Wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_t,this._rotating=Ct,this._pitching=jt,this._padding=Ft,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Wt),this._ease(Et(y),qt=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(h,qt)},o),this}_prepareEase(o,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||y.moving||this.fire(new i.A("movestart",o)),this._zooming&&!y.zooming&&this.fire(new i.A("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new i.A("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new i.A("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.A("move",o)),this._zooming&&this.fire(new i.A("zoom",o)),this._rotating&&this.fire(new i.A("rotate",o)),this._pitching&&this.fire(new i.A("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,C=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new i.A("zoomend",o)),C&&this.fire(new i.A("rotateend",o)),A&&this.fire(new i.A("pitchend",o)),this.fire(new i.A("moveend",o))}flyTo(o,h){if(this._prefersReducedMotion(o)){const Ni=i.aF(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ni,h)}this.stop(),o=i.h({offset:[0,0],speed:1.2,curve:1.42,easing:i.ey},o);const y=this.transform,C=this.getZoom(),A=this.getBearing(),R=this.getPitch(),$=this.getPadding(),Z="zoom"in o?i.ay(+o.zoom,y.minZoom,y.maxZoom):C,se="bearing"in o?this._normalizeBearing(o.bearing,A):A,ue="pitch"in o?+o.pitch:R,be=this._extendPadding(o.padding),ge=y.zoomScale(Z-C),Ce=i.P.convert(o.offset);let $e=y.centerPoint.add(Ce);const Ne=y.pointLocation($e),We=i.cd.convert(o.center||Ne);this._normalizeCenter(We);const Xe=y.project(Ne),et=y.project(We).sub(Xe);let _t=o.curve;const Ct=Math.max(y.width,y.height),jt=Ct/ge,Ft=et.mag();if("minZoom"in o){const Ni=i.ay(Math.min(o.minZoom,C,Z),y.minZoom,y.maxZoom),vr=Ct/y.zoomScale(Ni-C);_t=Math.sqrt(vr/Ft*2)}const Rt=_t*_t;function Et(Ni){const vr=(jt*jt-Ct*Ct+(Ni?-1:1)*Rt*Rt*Ft*Ft)/(2*(Ni?jt:Ct)*Rt*Ft);return Math.log(Math.sqrt(vr*vr+1)-vr)}function Wt(Ni){return(Math.exp(Ni)-Math.exp(-Ni))/2}function qt(Ni){return(Math.exp(Ni)+Math.exp(-Ni))/2}const Ei=Et(0);let Mi=function(Ni){return qt(Ei)/qt(Ei+_t*Ni)},Ki=function(Ni){return Ct*((qt(Ei)*(Wt(vr=Ei+_t*Ni)/qt(vr))-Wt(Ei))/Rt)/Ft;var vr},Ji=(Et(1)-Ei)/_t;if(Math.abs(Ft)<1e-6||!isFinite(Ji)){if(Math.abs(Ct-jt)<1e-6)return this.easeTo(o,h);const Ni=jt<Ct?-1:1;Ji=Math.abs(Math.log(jt/Ct))/_t,Ki=function(){return 0},Mi=function(vr){return Math.exp(Ni*_t*vr)}}o.duration="duration"in o?+o.duration:1e3*Ji/("screenSpeed"in o?+o.screenSpeed/_t:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Er=A!==se,Ti=ue!==R,$i=!y.isPaddingEqual(be),li=o.retainPadding===!1?y.clone():y,dr=Ni=>vr=>{const Nr=vr*Ji,ar=1/Mi(Nr);Ni.zoom=vr===1?Z:C+Ni.scaleZoom(ar),Er&&(Ni.bearing=i.ai(A,se,vr)),Ti&&(Ni.pitch=i.ai(R,ue,vr)),$i&&(li.interpolatePadding($,be,vr),$e=li.centerPoint.add(Ce));const Br=vr===1?We:Ni.unproject(Xe.add(et.mult(Ki(Nr))).mult(ar));return Ni.setLocationAtPoint(Ni.renderWorldCopies?Br.wrap():Br,$e),Ni._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),Ni};if(o.preloadOnly){const Ni=this._emulate(dr,o.duration,y);return this._preloadTiles(Ni),this}return this._zooming=!0,this._rotating=Er,this._pitching=Ti,this._padding=$i,this._prepareEase(h,!1),this._ease(dr(y),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,h,y){y.animate===!1||y.duration===0?(o(1),h()):(this._easeStart=i.q.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=i.bX(o,-180,180);const y=Math.abs(o-h);return Math.abs(o-360-h)<y&&(o-=360),Math.abs(o+360-h)<y&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const y=o.lng-h.center.lng;o.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,h,y){const C=Math.ceil(15*h/1e3),A=[],R=o(y.clone());for(let $=0;$<=C;$++){const Z=R($/C);A.push(Z.clone())}return A}_preloadTiles(o,h){}}class Vm{constructor(o={}){this.options=o,i.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact,y=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const C=te("span","mapboxgl-ctrl-icon",this._compactButton);return C.setAttribute("aria-hidden","true"),C.setAttribute("title",y),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const y=h.reduce((C,A,R)=>(A.value&&(C+=`${A.key}=${A.value}${R<h.length-1?"&":""}`),C),"?");o.href=`${i.e.FEEDBACK_URL}/${y}#${im(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const h=this._map.style._mergedSourceCaches;for(const C in h){const A=h[C];if(A.used){const R=A.getSource();R.attribution&&o.indexOf(R.attribution)<0&&o.push(R.attribution)}}o.sort((C,A)=>C.length-A.length),o=o.filter((C,A)=>{for(let R=A+1;R<o.length;R++)if(o[R].indexOf(C)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Tf{constructor(){i.aV(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=te("div","mapboxgl-ctrl");const h=te("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const h in o){const y=o[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Cf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const C of y)if(C.id===o)return void(C.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class wp{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=i.dk((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,y){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+y}}const Ig={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ya extends i.A{constructor(o,h,y,C){const{point:A,lngLat:R,originalEvent:$,target:Z}=o;super(o.type,{point:A,lngLat:R,originalEvent:$,target:Z}),this.preventDefault=()=>{o.preventDefault()},this.id=h,this.interaction=y,this.feature=C}}class Ql{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,h){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const y=h.filter;let C=h.type;y&&this.filters.set(o,i.b3(y)),C==="mouseover"&&(C="mouseenter"),C==="mouseout"&&(C="mouseleave");const A=this.interactionsByType.get(C)||new Map;C==="mouseenter"||C==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,h)):A.size===0&&this.map.on(C,this.handleType),A.size===0&&this.interactionsByType.set(C,A),A.set(o,h),this.typeById.set(o,C)}get(o){const h=this.typeById.get(o);if(!h)return;const y=this.interactionsByType.get(h);return y?y.get(o):void 0}remove(o){const h=this.typeById.get(o);if(!h)return;this.typeById.delete(o),this.filters.delete(o);const y=this.interactionsByType.get(h);y&&(y.delete(o),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):y.size===0&&this.map.off(h,this.handleType))}queryTargets(o,h){const y=[];for(const[C,A]of h)A.target&&y.push({targetId:C,target:A.target,filter:this.filters.get(C)});return this.map.style.queryRenderedTargets(o,y,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());h.length&&(o.type="mouseenter",this.handleType(o,h));const y=new Map;for(const[C,{feature:A}]of this.prevHoveredFeatures)this.hoveredFeatures.has(C)||y.set(A.id,A);y.size&&(o.type="mouseleave",this.handleType(o,Array.from(y.values())))}handleOut(o){const h=Array.from(this.hoveredFeatures.values()).map(({feature:y})=>y);h.length&&(o.type="mouseleave",this.handleType(o,h)),this.hoveredFeatures.clear()}handleType(o,h){const y=o.type==="mouseenter";if(y&&!this.interactionsByType.has(o.type))return void i.w("mouseenter interaction required for mouseleave to work.");const C=Array.from(this.interactionsByType.get(o.type)).reverse(),A=!!h;h=h||this.queryTargets(o.point,C);let R=!1;const $=new Set;for(const Z of h){for(const[se,ue]of C){if(!ue.target)continue;const be=Z.variants?Z.variants[se]:null;if(be){for(const ge of be){if(lh(ge,Z,$,se))continue;const Ce=new i.de(Z,ge),$e=Xl(ge,Z,se);A&&(Ce.state=this.map.getFeatureState(Ce));const Ne=y?this.prevHoveredFeatures.get($e):null,We=new ya(o,se,ue,Ce),Xe=Ne?Ne.stop:ue.handler(We);if(y&&this.hoveredFeatures.set($e,{feature:Z,stop:Xe}),Xe!==!1){R=!0;break}}if(R)break}}if(R)break}if(!R)for(const[Z,se]of C){const{handler:ue,target:be}=se;if(!be&&ue(new ya(o,Z,se,null))!==!1)break}}}function Yd(g,o){if(Array.isArray(g)&&Array.isArray(o)){const h=new Set(g),y=new Set(o);return h.size===y.size&&g.every(C=>y.has(C))}return i.bv(g,o)}const ly={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Xd={showCompass:!0,showZoom:!0,visualizePitch:!1};class cy{constructor(o,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new nm({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new rh({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),ke()}move(o,h){const y=this.map,C=this.mouseRotate.mousemoveWindow(o,h),A=C&&C.bearingDelta;if(A&&y.setBearing(y.getBearing()+A),this.mousePitch){const R=this.mousePitch.mousemoveWindow(o,h),$=R&&R.pitchDelta;$&&y.setPitch(y.getPitch()+$)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ee(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.h({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ye(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ye(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zp(g,o,h){if(g=new i.cd(g.lng,g.lat),o){const y=new i.cd(g.lng-360,g.lat),C=new i.cd(g.lng+360,g.lat),A=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),R=h.locationPoint3D(g).distSqr(o),$=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint3D(y).distSqr(o)<R&&($||Math.abs(y.lng-h.center.lng)<A)?g=y:h.locationPoint3D(C).distSqr(o)<R&&($||Math.abs(C.lng-h.center.lng)<A)&&(g=C)}for(;Math.abs(g.lng-h.center.lng)>180;){const y=h.locationPoint3D(g);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Zd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},sd={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Kd extends i.E{constructor(o,h){super(),(o instanceof HTMLElement||h)&&(o=i.h({element:o},h)),i.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:y="center",color:C="#3FB1CE",scale:A=1,draggable:R=!1,clickTolerance:$=0,rotation:Z=sd.rotation,rotationAlignment:se=sd.rotationAlignment,pitchAlignment:ue=sd.pitchAlignment,occludedOpacity:be=sd.occludedOpacity,altitude:ge=sd.altitude}=o||{};this._anchor=y,this._color=C,this._scale=A,this._draggable=R,this._clickTolerance=$,this._rotation=Z,this._rotationAlignment=se,this._pitchAlignment=ue,this._occludedOpacity=be,this._altitude=ge,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Ne=>{Ne.preventDefault()}),this._element.addEventListener("mousedown",Ne=>{Ne.preventDefault()});const Ce=this._element.classList;for(const Ne in Zd)Ce.remove(`mapboxgl-marker-anchor-${Ne}`);Ce.add(`mapboxgl-marker-anchor-${this._anchor}`);const $e=o&&o.className?o.className.trim().split(/\s+/):[];Ce.add(...$e),this._popup=null}_createDefaultMarker(){const o=te("div"),h=he("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const y=he("radialGradient",{id:"shadowGradient"},he("defs",{},h));he("stop",{offset:"10%","stop-opacity":.4},y),he("stop",{offset:"100%","stop-opacity":.05},y),he("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return he("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),he("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),he("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.cd.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||sd.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const C=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(38.1-13.5+C)],"bottom-right":[-C,-1*(38.1-13.5+C)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const h=o.code,y=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,h=this._pos;if(!o||!h)return!1;const y=o.unproject(h,this._altitude),C=o.getFreeCameraOptions();if(!C.position)return!1;const A=C.position.toLngLat();return A.distanceTo(y)<.9*A.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();const y=o.unproject(h,this._altitude);let C;o._showingGlobe()&&i.eK(o.transform,this._lngLat)?C=0:(C=1-o._queryFogOpacity(y),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(C*=this._occludedOpacity)),this._element.style.opacity=`${C}`,this._element.style.pointerEvents=C>0?"auto":"none",this._popup&&this._popup._setOpacity(C),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Zd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const o=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!o||y!=="map")return"";if(!h._showingGlobe()){const Z=h.getPitch();return Z?`rotateX(${Z}deg)`:""}const C=i.cJ(i.eL(h.transform,this._lngLat)),A=o.sub(i.eM(h.transform)),R=Math.abs(A.x)+Math.abs(A.y);if(R===0)return"";const $=C/R;return`rotateX(${-A.y*$}deg) rotateY(${A.x*$}deg)`}_calculateZTransform(){const o=this._pos,h=this._map;if(!h||!o)return"";let y=0;const C=this.getRotationAlignment();if(C==="map")if(h._showingGlobe()){const A=h.project(new i.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),R=h.project(new i.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(A);y=i.cJ(Math.atan2(R.y,R.x))-90}else y=-h.getBearing();else if(C==="horizon"){const A=i.af(4,6,h.getZoom()),R=i.eM(h.transform);R.y+=A*h.transform.height;const $=o.sub(R),Z=i.cJ(Math.atan2($.y,$.x));y=(Z>90?Z-270:Z+90)*(1-A)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zp(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const h=this._map;if(!h)return;const y=this._pointerdownPos,C=this._positionDelta;if(y&&C){if(!this._isDragging){const A=this._clickTolerance||h._clickTolerance;if(o.point.dist(y)<A)return;this._isDragging=!0}this._pos=o.point.sub(C),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(o){const h=this._map,y=this._pos;h&&y&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(y),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||sd.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||sd.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||sd.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||sd.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Lg={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Dg={maxWidth:100,unit:"metric"},lm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Nu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},iu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bu(g=new i.P(0,0),o="bottom"){if(typeof g=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(o){case"top":return new i.P(0,g);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-g);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(g,0);case"right":return new i.P(-g,0)}return new i.P(0,0)}return g instanceof i.P||Array.isArray(g)?i.P.convert(g):i.P.convert(g[o]||[0,0])}return{version:S,supported:Q.supported,setRTLTextPlugin:i.eQ,getRTLTextPluginStatus:i.eP,Map:class extends Xp{constructor(g){L.mark(E.create);const o=g;if((g=i.h({},ly,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&i.eI(window)&&(g.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fs(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Cf,this._domRenderTaskQueue=new Cf,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.a$(),this._locale=i.h({},Ig,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new wp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new Ae(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,i.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new nc),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Mg(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||i.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this.indoor=new Zc(this),g.hash&&(this._hash=new Gd(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,i.h({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Vm({customAttribution:g.customAttribution})),this._logoControl=new Tf,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.A(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.A(`${h.dataType}dataloading`,h))}),this._interactions=new Ql(this)}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.A("movestart",g)).fire(new i.A("move",g)),this.fire(new i.A("resize",g)),o&&this.fire(new i.A("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(i.aG.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(o=>o==="auto"?navigator.language:o):g}setLanguage(g){const o=this._parseLanguage(g);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,o=g.projection.name;let h;o==="globe"&&g.zoom>=i.cx?(g.setMercatorFromTransition(),h=!0):o==="mercator"&&g.zoom<i.cx&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,o){return this._updateProjection(g||o||{name:"mercator"})}_updateProjection(g){let o;return o=g.name==="globe"&&this.transform.zoom>=i.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,o){return this.transform.locationPoint3D(i.cd.convert(g),o)}unproject(g,o){return this.transform.pointLocation3D(i.P.convert(g),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,o,h){const y=C=>{let A=[];if(Array.isArray(o)){const R=o.filter($=>this.getLayer($));A=R.length?this.queryRenderedFeatures(C,{layers:R}):[]}else A=this.queryRenderedFeatures(C,{target:o});return A};if(g==="mouseenter"||g==="mouseover"){let C=!1;return{listener:h,targets:o,delegates:{mousemove:R=>{const $=y(R.point);$.length?C||(C=!0,h.call(this,new Pl(g,this,R.originalEvent,{features:$}))):C=!1},mouseout:()=>{C=!1}}}}if(g==="mouseleave"||g==="mouseout"){let C=!1;return{listener:h,targets:o,delegates:{mousemove:$=>{y($.point).length?C=!0:C&&(C=!1,h.call(this,new Pl(g,this,$.originalEvent)))},mouseout:$=>{C&&(C=!1,h.call(this,new Pl(g,this,$.originalEvent)))}}}}{const C=A=>{const R=y(A.point);R.length&&(A.features=R,h.call(this,A),delete A.features)};return{listener:h,targets:o,delegates:{[g]:C}}}}on(g,o,h){if(typeof o=="function"||h===void 0)return super.on(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const C in y.delegates)this.on(C,y.delegates[C]);return this}once(g,o,h){if(typeof o=="function"||h===void 0)return super.once(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,h);for(const C in y.delegates)this.once(C,y.delegates[C]);return this}off(g,o,h){if(typeof o=="function"||h===void 0)return super.off(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._delegatedListeners?this._delegatedListeners[g]:void 0;return y&&(C=>{for(let A=0;A<C.length;A++){const R=C[A];if(R.listener===h&&Yd(R.targets,o)){for(const $ in R.delegates)this.off($,R.delegates[$]);return C.splice(A,1),this}}})(y),this}queryRenderedFeatures(g,o){if(!this.style)return[];if(g===void 0||g instanceof i.P||Array.isArray(g)||o!==void 0||(o=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!o){const A=this.style.queryRenderedFeatures(g,void 0,this.transform),R=this.style.queryRenderedFeatureset(g,void 0,this.transform);return A.concat(R)}let h=!0;if(o.target&&(h=this._isTargetValid(o.target),h&&!o.layers))return this.style.queryRenderedFeatureset(g,o,this.transform);let y=!0;if(o.layers&&Array.isArray(o.layers)){for(const A of o.layers)if(!this._isValidId(A)){y=!1;break}if(y&&!o.target)return this.style.queryRenderedFeatures(g,o,this.transform)}let C=[];return y&&(C=C.concat(this.style.queryRenderedFeatures(g,o,this.transform))),h&&(C=C.concat(this.style.queryRenderedFeatureset(g,o,this.transform))),C}querySourceFeatures(g,o){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,o)}isPointOnSurface(g){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(g))}addInteraction(g,o){return this._interactions.add(g,o),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,o){return o=i.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&g&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(g,(h,y)=>{if(h){const C=typeof h=="string"?h:h instanceof Error?h.message:h.error;i.w(`Unable to perform style diff: ${C}. Rebuilding the style from scratch.`),this._updateStyle(g,o)}else y&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(g,o))}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=i.h({},o);o&&o.config&&(h.initialConfig=o.config,delete h.config),this.style=new In(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new In(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.d8(g)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const o of g)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(g)}addSource(g,o){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,o,{pixelRatio:h=1,sdf:y=!1,stretchX:C,stretchY:A,content:R}={}){this._lazyInitEmptyStyle();const $=i.I.from(g);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:Z,height:se,data:ue}=i.q.getImageData(o);this.style.addImage($,{data:new i.r({width:Z,height:se},ue),pixelRatio:h,stretchX:C,stretchY:A,content:R,sdf:y,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:Z,height:se}=o,ue=o;this.style.addImage($,{data:new i.r({width:Z,height:se},new Uint8Array(ue.data)),pixelRatio:h,stretchX:C,stretchY:A,content:R,sdf:y,usvg:!1,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,g)}}updateImage(g,o){this._lazyInitEmptyStyle();const h=i.I.from(g),y=this.style.getImage(h);if(!y)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const C=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.q.getImageData(o):o,{width:A,height:R,data:$}=C;if(A===void 0||R===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(A!==(y.usvg?y.icon.usvg_tree.width:y.data.width)||R!==(y.usvg?y.icon.usvg_tree.height:y.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${A}, ${R})
                must be that same as the previous version of the image
                (${y.data.width}, ${y.data.height})`)));const Z=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let se=!1;y.usvg?(y.data=new i.r({width:A,height:R},new Uint8Array($)),y.usvg=!1,y.icon=void 0,se=!0):y.data.replace($,Z),this.style.updateImage(h,y,se)}hasImage(g){return g?!!this.style&&!!this.style.getImage(i.I.from(g)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(i.I.from(g))}loadImage(g,o){i.o(this._requestManager.transformRequest(g,i.R.Image),(h,y)=>{o(h,y instanceof HTMLImageElement?i.q.getImageData(y):y)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,o){this._lazyInitEmptyStyle(),this.style.addModel(g,o)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,o){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)):this}getSlot(g){const o=this.getLayer(g);return o&&o.slot||null}setSlot(g,o){return this.style.setSlot(g,o),this.style.mergeLayers(),this._update(!0)}addImport(g,o){return this.style.addImport(g,o).catch(h=>this.fire(new i.z(new Error("Failed to add import",h)))),this}updateImport(g,o){return typeof o!="string"&&o.id!==g?(this.removeImport(g),this.addImport(o)):(this.style.updateImport(g,o),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,o){return this.style.moveImport(g,o),this._update(!0)}moveLayer(g,o){return this._isValidId(g)?(this.style.moveLayer(g,o),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const o=this.style.getOwnLayer(g);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,o,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,o,h),this._update(!0)):this}setFilter(g,o,h={}){return this._isValidId(g)?(this.style.setFilter(g,o,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,o,h,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,o,h,y),this._update(!0)):this}getPaintProperty(g,o){return this._isValidId(g)?this.style.getPaintProperty(g,o):null}setLayoutProperty(g,o,h,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,o,h,y),this._update(!0)):this}getLayoutProperty(g,o){return this._isValidId(g)?this.style.getLayoutProperty(g,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,o){return this.style.setSchema(g,o),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,o){return this.style.setConfig(g,o),this._update(!0)}getConfigProperty(g,o){return this.style.getConfigProperty(g,o)}setConfigProperty(g,o,h){return this.style.setConfigProperty(g,o,h),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const o=g[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,o),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.cd.convert(g),this.transform):0}setFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,o),this._update())}removeFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,o),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let h,y,C,A=this._container;for(;A&&(!y||!C);){const R=window.getComputedStyle(A).transform;R&&R!=="none"&&(h=R.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(y=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(C=h[3])),A=A.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=C?Math.abs(o/C):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=te("div","mapboxgl-canvas-container",g);this._canvas=te("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=te("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(C=>{y[C]=te("div",`mapboxgl-ctrl-${C}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o){const h=i.q.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const o=this._markers.indexOf(g);o!==-1&&this._markers.splice(o,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const o=this._popups.indexOf(g);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const g=i.h({},Q.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",g);o?(nn(o,!0),this.painter=new tm(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.l.testSupport(o)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let o;this.fire(new i.A("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,y=i.q.now(),C=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=C.createQuery(),C.beginQuery(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const A=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const se=this.transform.zoom,ue=this.transform.pitch,be=i.q.now(),ge=new i.aa(se,{now:be,fadeDuration:A,pitch:ue,transition:this.style.transition,worldview:this._worldview});this.style.update(ge)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let R=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),R=this._updateAverageElevation(y),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):R=this._updateAverageElevation(y);const $=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),$&&(this._placementDirty=$.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,L.mark(E.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const se=i.q.now()-y;C.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const ue=C.getQueryParameter(o,C.QUERY_RESULT)/1e6;C.deleteQuery(o),this.fire(new i.A("gpu-timing-frame",{cpuTime:se,gpuTime:ue}))},50)}if(this.listens("gpu-timing-layer")){const se=this.painter.collectGpuTimers();setTimeout(()=>{const ue=this.painter.queryGpuTimers(se);this.fire(new i.A("gpu-timing-layer",{layerTimes:ue}))},50)}if(this.listens("gpu-timing-deferred-render")){const se=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ue=this.painter.queryGpuTimeDeferredRender(se);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:ue}))},50)}const Z=this._sourcesDirty||this._styleDirty||this._placementDirty||R;if(Z||this._repaint)this.triggerRepaint();else{const se=this.idle();if(se&&(R=this._updateAverageElevation(y,!0)),R)this.triggerRepaint();else if(this._triggerFrame(!1),se&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ue=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:ue})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||Z||(this._fullyLoaded=!0,L.mark(E.fullLoad),this._performanceMetricsCollection&&gi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const o of this._markers)g&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!g||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(g,o=!1){const h=C=>(this.transform.averageElevation=C,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(o||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const C=this.transform.averageElevation;let A=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(A)?A=0:this._averageElevationLastSampledAt=g;const R=Math.abs(C-A);if(R>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(A),h(A);this._averageElevation.easeTo(A,g,300)}else if(R>1e-4)return this._averageElevation.jumpTo(A),h(A)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){cr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===Ot||g.status===401)){const o=this.painter.context.gl;nn(o,!1),this._logoControl instanceof Tf&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Zt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ui(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function C(A){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,A,0);const R=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,R),R}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(C(g),o.canvasCopies.map(C),o.timeStamps)}_canvasPixelComparison(g,o,h){let y=h[1]-h[0];const C=g.length/4;for(let A=0;A<o.length;A++){const R=o[A];let $=0;for(let Z=0;Z<R.length;Z+=4)R[Z]===g[Z]&&R[Z+1]===g[Z+1]&&R[Z+2]===g[Z+2]&&R[Z+3]===g[Z+3]&&($+=1);y+=(h[A+2]-h[A+1])*(1-$/C)}return y}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ji.delete(this.painter.context.gl),Oi.remove(),ur.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=i.q.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(g){const o=this.style?this.style.getSourceCaches():[];return i.bt(o,(h,y)=>h._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,o){i.eJ(g,o)}get version(){return S}},NavigationControl:class{constructor(g={}){this.options=i.h({},Xd,g),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const o=g.getZoom(),h=o===g.getMaxZoom(),y=o===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cy(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,o){const h=te("button",g,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(g,o){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${o}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(g={}){super();const o=navigator.geolocation;this.options=i.h({geolocation:o},Lg,g),i.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const o=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>o(h.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),h=g.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",g)),this._finish()}}_updateCamera(g){const o=new i.cd(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,y=this._map.getBearing(),C=i.h({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),C,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new i.cd(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,o=i.c6(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vm,ScaleControl:class{constructor(g={}){this.options=i.h({},Dg,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,y=o._containerWidth/2-g/2,C=o.unproject([y,h]),A=o.unproject([y+g,h]),R=C.distanceTo(A);if(this.options.unit==="imperial"){const $=3.2808*R;$>5280?this._setScale(g,$/5280,"mile"):this._setScale(g,$,"foot")}else this.options.unit==="nautical"?this._setScale(g,R/1852,"nautical-mile"):R>=1e3?this._setScale(g,R/1e3,"kilometer"):this._setScale(g,R,"meter")}_setScale(g,o,h){this._map._requestDomTask(()=>{const y=function(A){const R=Math.pow(10,`${Math.floor(A)}`.length-1);let $=A/R;return $=$>=10?10:$>=5?5:$>=3?3:$>=2?2:$>=1?1:function(Z){const se=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*se)/se}($),R*$}(o),C=y/o;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${lm[h]}`,this._container.style.width=g*C+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:i.w("Full screen control 'container' must be a DOM element.")),i.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(g){super(),this.options=i.h(Object.create(Nu),g),this._altitude=this.options.altitude,i.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=i.cd.convert(g),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=g;y=h.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(g),this.options.closeButton){const h=this._closeButton=te("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let o;return this._classList.delete(g)?o=!1:(this._classList.add(g),o=!0),this._updateClassList(),o}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const o=this._map,h=this._container,y=this._pos;if(!o||!h||!y)return"bottom";const C=h.offsetWidth,A=h.offsetHeight,R=y.x<C/2,$=y.x>o.transform.width-C/2;if(y.y+g<A)return R?"top-left":$?"top-right":"top";if(y.y>o.transform.height-A){if(R)return"bottom-left";if($)return"bottom-right"}return R?"left":$?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),g.className=o.join(" ")}_update(g){const o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=te("div","mapboxgl-popup",o.getContainer()),this._tip=te("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zp(this._lngLat,this._pos,o.transform)),!this._trackPointer||g){const C=this._pos=this._trackPointer&&g instanceof i.P?g:o.project(this._lngLat,this._altitude),A=Bu(this.options.offset),R=this._anchor=this._getAnchor(A.y),$=Bu(this.options.offset,R),Z=C.add($).round();o._requestDomTask(()=>{this._container&&R&&(this._container.style.transform=`${Zd[R]} translate(${Z.x}px,${Z.y}px)`)})}if(!this._marker&&o._showingGlobe()){const C=i.eK(o.transform,this._lngLat)?0:1;this._setOpacity(C)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(iu);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Kd,Style:In,LngLat:i.cd,LngLatBounds:i.aG,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Qn,Evented:i.E,config:i.e,prewarm:i.eO,clearPrewarmedResources:i.eN,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(g){i.e.ACCESS_TOKEN=g},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(g){i.e.API_URL=g},get workerCount(){return i.eX.workerCount},set workerCount(g){i.eX.workerCount=g},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){i.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){i.eW(g)},get workerUrl(){return i.eV.workerUrl},set workerUrl(g){i.eV.workerUrl=g},get workerClass(){return i.eV.workerClass},set workerClass(g){i.eV.workerClass=g},get workerParams(){return i.eV.workerParams},set workerParams(g){i.eV.workerParams=g},get dracoUrl(){return i.eU()},set dracoUrl(g){i.eT(g)},get meshoptUrl(){return i.eS()},set meshoptUrl(g){i.eR(g)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var f=a;return f})})(f$);var poe=f$.exports;const f0=w_(poe);const foe=({onChartTabChange:e,activeChartTab:t,productName:n,isNetworkService:s=!0})=>B.createElement("div",{className:"capsule-tab"},B.createElement("ul",{className:`capsule-tab-nav ${s?"":"disabled"}`},B.createElement("li",{className:"capsule-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("uptime"),className:`${t==="uptime"?"active":""}`,title:"Uptime"},"Uptime")),B.createElement("li",{className:"capsule-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("ttr"),className:`${t==="ttr"?"active":""}`,title:"TTR"},"TTR")),B.createElement("li",{className:"capsule-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("mttr"),className:`${t==="mttr"?"active":""}`,title:"MTTR"},"MTTR")),n=="privateLine"&&B.createElement("li",{className:"capsule-item"},B.createElement("a",{href:"javascript:void(0)",onClick:()=>e("latency"),className:`${t==="latency"?"active":""}`,title:"Latency"},"Latency"))));var g$={exports:{}};(function(e,t){(function(n,s){n._Highcharts=s(),e.exports=n._Highcharts})(typeof window>"u"?og:window,()=>(()=>{var ld;let n,s;var a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee,Ie={};Ie.d=(ve,v)=>{for(var k in v)Ie.o(v,k)&&!Ie.o(ve,k)&&Object.defineProperty(ve,k,{enumerable:!0,get:v[k]})},Ie.o=(ve,v)=>Object.prototype.hasOwnProperty.call(ve,v);var He={};Ie.d(He,{default:()=>wv}),function(ve){var v,k,D,V,H,Y,J;ve.SVG_NS="http://www.w3.org/2000/svg",ve.product="Highcharts",ve.version="12.3.0",ve.win=typeof window<"u"?window:{},ve.doc=ve.win.document,ve.svg=!!((D=(k=(v=ve.doc)==null?void 0:v.createElementNS)==null?void 0:k.call(v,ve.SVG_NS,"svg"))!=null&&D.createSVGRect),ve.pageLang=(Y=(H=(V=ve.doc)==null?void 0:V.documentElement)==null?void 0:H.closest("[lang]"))==null?void 0:Y.lang,ve.userAgent=((J=ve.win.navigator)==null?void 0:J.userAgent)||"",ve.isChrome=ve.win.chrome,ve.isFirefox=ve.userAgent.indexOf("Firefox")!==-1,ve.isMS=/(edge|msie|trident)/i.test(ve.userAgent)&&!ve.win.opera,ve.isSafari=!ve.isChrome&&ve.userAgent.indexOf("Safari")!==-1,ve.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(ve.userAgent),ve.isWebKit=ve.userAgent.indexOf("AppleWebKit")!==-1,ve.deg2rad=2*Math.PI/360,ve.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],ve.noop=function(){},ve.supportsPassiveEvents=function(){let ae=!1;if(!ve.isMS){let _e=Object.defineProperty({},"passive",{get:function(){ae=!0}});ve.win.addEventListener&&ve.win.removeEventListener&&(ve.win.addEventListener("testPassive",ve.noop,_e),ve.win.removeEventListener("testPassive",ve.noop,_e))}return ae}(),ve.charts=[],ve.composed=[],ve.dateFormats={},ve.seriesTypes={},ve.symbolSizes={},ve.chartCount=0}(a||(a={}));let Ye=a,{charts:lt,doc:Pt,win:At}=Ye;function ht(ve,v,k,D){let V=v?"Highcharts error":"Highcharts warning";ve===32&&(ve=`${V}: Deprecated member`);let H=dt(ve),Y=H?`${V} #${ve}: www.highcharts.com/errors/${ve}/`:ve.toString();if(D!==void 0){let J="";H&&(Y+="?"),Oi(D,function(ae,_e){J+=`
 - ${_e}: ${ae}`,H&&(Y+=encodeURI(_e)+"="+encodeURI(ae))}),Y+=J}ji(Ye,"displayError",{chart:k,code:ve,message:Y,params:D},function(){if(v)throw Error(Y);At.console&&ht.messages.indexOf(Y)===-1&&console.warn(Y)}),ht.messages.push(Y)}function Ot(ve,v){return parseInt(ve,v||10)}function Ae(ve){return typeof ve=="string"}function mt(ve){let v=Object.prototype.toString.call(ve);return v==="[object Array]"||v==="[object Array Iterator]"}function bt(ve,v){return!!ve&&typeof ve=="object"&&(!v||!mt(ve))}function Dt(ve){return bt(ve)&&typeof ve.nodeType=="number"}function Je(ve){let v=ve==null?void 0:ve.constructor;return!!(bt(ve,!0)&&!Dt(ve)&&(v!=null&&v.name)&&v.name!=="Object")}function dt(ve){return typeof ve=="number"&&!isNaN(ve)&&ve<1/0&&ve>-1/0}function ui(ve){return ve!=null}function Vt(ve,v,k){let D,V=Ae(v)&&!ui(k),H=(Y,J)=>{ui(Y)?ve.setAttribute(J,Y):V?(D=ve.getAttribute(J))||J!=="class"||(D=ve.getAttribute(J+"Name")):ve.removeAttribute(J)};return Ae(v)?H(k,v):Oi(v,H),D}function ei(ve){return mt(ve)?ve:[ve]}function ur(ve,v){let k;for(k in ve||(ve={}),v)ve[k]=v[k];return ve}function Zt(){let ve=arguments,v=ve.length;for(let k=0;k<v;k++){let D=ve[k];if(D!=null)return D}}function Kt(ve,v){ur(ve.style,v)}function Ui(ve){return Math.pow(10,Math.floor(Math.log(ve)/Math.LN10))}function rr(ve,v){return ve>1e14?ve:parseFloat(ve.toPrecision(v||14))}(ht||(ht={})).messages=[],Math.easeInOutSine=function(ve){return-.5*(Math.cos(Math.PI*ve)-1)};let gi=Array.prototype.find?function(ve,v){return ve.find(v)}:function(ve,v){let k,D=ve.length;for(k=0;k<D;k++)if(v(ve[k],k))return ve[k]};function Oi(ve,v,k){for(let D in ve)Object.hasOwnProperty.call(ve,D)&&v.call(k||ve[D],ve[D],D,ve)}function cr(ve,v,k){function D(Y,J){let ae=ve.removeEventListener;ae&&ae.call(ve,Y,J,!1)}function V(Y){let J,ae;ve.nodeName&&(v?(J={})[v]=!0:J=Y,Oi(J,function(_e,Me){if(Y[Me])for(ae=Y[Me].length;ae--;)D(Me,Y[Me][ae].fn)}))}let H=typeof ve=="function"&&ve.prototype||ve;if(Object.hasOwnProperty.call(H,"hcEvents")){let Y=H.hcEvents;if(v){let J=Y[v]||[];k?(Y[v]=J.filter(function(ae){return k!==ae.fn}),D(v,k)):(V(Y),Y[v]=[])}else V(Y),delete H.hcEvents}}function ji(ve,v,k,D){if(k=k||{},(Pt==null?void 0:Pt.createEvent)&&(ve.dispatchEvent||ve.fireEvent&&ve!==Ye)){let V=Pt.createEvent("Events");V.initEvent(v,!0,!0),k=ur(V,k),ve.dispatchEvent?ve.dispatchEvent(k):ve.fireEvent(v,k)}else if(ve.hcEvents){k.target||ur(k,{preventDefault:function(){k.defaultPrevented=!0},target:ve,type:v});let V=[],H=ve,Y=!1;for(;H.hcEvents;)Object.hasOwnProperty.call(H,"hcEvents")&&H.hcEvents[v]&&(V.length&&(Y=!0),V.unshift.apply(V,H.hcEvents[v])),H=Object.getPrototypeOf(H);Y&&V.sort((J,ae)=>J.order-ae.order),V.forEach(J=>{J.fn.call(ve,k)===!1&&k.preventDefault()})}D&&!k.defaultPrevented&&D.call(ve,k)}let nn=function(){let ve=Math.random().toString(36).substring(2,9)+"-",v=0;return function(){return"highcharts-"+(n?"":ve)+v++}}();At.jQuery&&(At.jQuery.fn.highcharts=function(){let ve=[].slice.call(arguments);if(this[0])return ve[0]?(new Ye[Ae(ve[0])?ve.shift():"Chart"](this[0],ve[0],ve[1]),this):lt[Vt(this[0],"data-highcharts-chart")]});let pr={addEvent:function(ve,v,k,D={}){let V=typeof ve=="function"&&ve.prototype||ve;Object.hasOwnProperty.call(V,"hcEvents")||(V.hcEvents={});let H=V.hcEvents;Ye.Point&&ve instanceof Ye.Point&&ve.series&&ve.series.chart&&(ve.series.chart.runTrackerClick=!0);let Y=ve.addEventListener;Y&&Y.call(ve,v,k,!!Ye.supportsPassiveEvents&&{passive:D.passive===void 0?v.indexOf("touch")!==-1:D.passive,capture:!1}),H[v]||(H[v]=[]);let J={fn:k,order:typeof D.order=="number"?D.order:1/0};return H[v].push(J),H[v].sort((ae,_e)=>ae.order-_e.order),function(){cr(ve,v,k)}},arrayMax:function(ve){let v=ve.length,k=ve[0];for(;v--;)ve[v]>k&&(k=ve[v]);return k},arrayMin:function(ve){let v=ve.length,k=ve[0];for(;v--;)ve[v]<k&&(k=ve[v]);return k},attr:Vt,clamp:function(ve,v,k){return ve>v?ve<k?ve:k:v},clearTimeout:function(ve){ui(ve)&&clearTimeout(ve)},correctFloat:rr,createElement:function(ve,v,k,D,V){let H=Pt.createElement(ve);return v&&ur(H,v),V&&Kt(H,{padding:"0",border:"none",margin:"0"}),k&&Kt(H,k),D&&D.appendChild(H),H},crisp:function(ve,v=0,k){let D=v%2/2,V=k?-1:1;return(Math.round(ve*V-D)+D)*V},css:Kt,defined:ui,destroyObjectProperties:function(ve,v,k){Oi(ve,function(D,V){D!==v&&(D!=null&&D.destroy)&&D.destroy(),(D!=null&&D.destroy||!k)&&delete ve[V]})},diffObjects:function(ve,v,k,D){let V={};return function H(Y,J,ae,_e){let Me=k?J:Y;Oi(Y,function(xe,Pe){if(!_e&&D&&D.indexOf(Pe)>-1&&J[Pe]){xe=ei(xe),ae[Pe]=[];for(let je=0;je<Math.max(xe.length,J[Pe].length);je++)J[Pe][je]&&(xe[je]===void 0?ae[Pe][je]=J[Pe][je]:(ae[Pe][je]={},H(xe[je],J[Pe][je],ae[Pe][je],_e+1)))}else bt(xe,!0)&&!xe.nodeType?(ae[Pe]=mt(xe)?[]:{},H(xe,J[Pe]||{},ae[Pe],_e+1),Object.keys(ae[Pe]).length===0&&(Pe!=="colorAxis"||_e!==0)&&delete ae[Pe]):(Y[Pe]!==J[Pe]||Pe in Y&&!(Pe in J))&&Pe!=="__proto__"&&Pe!=="constructor"&&(ae[Pe]=Me[Pe])})}(ve,v,V,0),V},discardElement:function(ve){var v;(v=ve==null?void 0:ve.parentElement)==null||v.removeChild(ve)},erase:function(ve,v){let k=ve.length;for(;k--;)if(ve[k]===v){ve.splice(k,1);break}},error:ht,extend:ur,extendClass:function(ve,v){let k=function(){};return k.prototype=new ve,ur(k.prototype,v),k},find:gi,fireEvent:ji,getAlignFactor:(ve="")=>({center:.5,right:1,middle:.5,bottom:1})[ve]||0,getClosestDistance:function(ve,v){let k,D,V,H=!v;return ve.forEach(Y=>{if(Y.length>1)for(V=Y.length-1;V>0;V--)(D=Y[V]-Y[V-1])<0&&!H?(v==null||v(),v=void 0):D&&(k===void 0||D<k)&&(k=D)}),k},getMagnitude:Ui,getNestedProperty:function(ve,v){let k=ve.split(".");for(;k.length&&ui(v);){let D=k.shift();if(D===void 0||D==="__proto__")return;if(D==="this"){let H;return bt(v)&&(H=v["@this"]),H??v}let V=v[D.replace(/[\\'"]/g,"")];if(!ui(V)||typeof V=="function"||typeof V.nodeType=="number"||V===At)return;v=V}return v},getStyle:function ve(v,k,D){var Y;let V;if(k==="width"){let J=Math.min(v.offsetWidth,v.scrollWidth),ae=(Y=v.getBoundingClientRect)==null?void 0:Y.call(v).width;return ae<J&&ae>=J-1&&(J=Math.floor(ae)),Math.max(0,J-(ve(v,"padding-left",!0)||0)-(ve(v,"padding-right",!0)||0))}if(k==="height")return Math.max(0,Math.min(v.offsetHeight,v.scrollHeight)-(ve(v,"padding-top",!0)||0)-(ve(v,"padding-bottom",!0)||0));let H=At.getComputedStyle(v,void 0);return H&&(V=H.getPropertyValue(k),Zt(D,k!=="opacity")&&(V=Ot(V))),V},insertItem:function(ve,v){let k,D=ve.options.index,V=v.length;for(k=ve.options.isInternal?V:0;k<V+1;k++)if(!v[k]||dt(D)&&D<Zt(v[k].options.index,v[k]._i)||v[k].options.isInternal){v.splice(k,0,ve);break}return k},isArray:mt,isClass:Je,isDOMElement:Dt,isFunction:function(ve){return typeof ve=="function"},isNumber:dt,isObject:bt,isString:Ae,merge:function(ve,...v){let k,D=[ve,...v],V={},H=function(J,ae){return typeof J!="object"&&(J={}),Oi(ae,function(_e,Me){Me!=="__proto__"&&Me!=="constructor"&&(!bt(_e,!0)||Je(_e)||Dt(_e)?J[Me]=ae[Me]:J[Me]=H(J[Me]||{},_e))}),J};ve===!0&&(V=D[1],D=Array.prototype.slice.call(D,2));let Y=D.length;for(k=0;k<Y;k++)V=H(V,D[k]);return V},normalizeTickInterval:function(ve,v,k,D,V){let H,Y=ve;k=Zt(k,Ui(ve));let J=ve/k;for(!v&&(v=V?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],D===!1&&(k===1?v=v.filter(function(ae){return ae%1==0}):k<=.1&&(v=[1/k]))),H=0;H<v.length&&(Y=v[H],(!V||!(Y*k>=ve))&&(V||!(J<=(v[H]+(v[H+1]||v[H]))/2)));H++);return rr(Y*k,-Math.round(Math.log(.001)/Math.LN10))},objectEach:Oi,offset:function(ve){let v=Pt.documentElement,k=ve.parentElement||ve.parentNode?ve.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:k.top+(At.pageYOffset||v.scrollTop)-(v.clientTop||0),left:k.left+(At.pageXOffset||v.scrollLeft)-(v.clientLeft||0),width:k.width,height:k.height}},pad:function(ve,v,k){return Array((v||2)+1-String(ve).replace("-","").length).join(k||"0")+ve},pick:Zt,pInt:Ot,pushUnique:function(ve,v){return 0>ve.indexOf(v)&&!!ve.push(v)},relativeLength:function(ve,v,k){return/%$/.test(ve)?v*parseFloat(ve)/100+(k||0):parseFloat(ve)},removeEvent:cr,replaceNested:function(ve,...v){let k,D;do for(D of(k=ve,v))ve=ve.replace(D[0],D[1]);while(ve!==k);return ve},splat:ei,stableSort:function(ve,v){let k,D,V=ve.length;for(D=0;D<V;D++)ve[D].safeI=D;for(ve.sort(function(H,Y){return(k=v(H,Y))===0?H.safeI-Y.safeI:k}),D=0;D<V;D++)delete ve[D].safeI},syncTimeout:function(ve,v,k){return v>0?setTimeout(ve,v,k):(ve.call(0,k),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(ve){return Ae(ve)?ve.substring(0,1).toUpperCase()+ve.substring(1):String(ve)},uniqueKey:nn,useSerialIds:function(ve){return n=Zt(ve,n)},wrap:function(ve,v,k){let D=ve[v];ve[v]=function(){let V=arguments,H=this;return k.apply(this,[function(){return D.apply(H,arguments.length?arguments:V)}].concat([].slice.call(arguments)))}}},{pageLang:Ue,win:ni}=Ye,{defined:fi,error:Lt,extend:pt,isNumber:Nt,isObject:Si,isString:pi,merge:St,objectEach:Ht,pad:nr,splat:tr,timeUnits:kr,ucfirst:Mr}=pr,Cr=Ye.isSafari&&ni.Intl&&!ni.Intl.DateTimeFormat.prototype.formatRange,Tn=ve=>ve.main===void 0,gs=class{constructor(ve,v){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=ni.Date,this.update(ve),this.lang=v}update(ve={}){this.dTLCache={},this.options=ve=St(!0,this.options,ve);let{timezoneOffset:v,useUTC:k,locale:D}=ve;this.Date=ve.Date||ni.Date||Date;let V=ve.timezone;fi(k)&&(V=k?"UTC":void 0),v&&v%60==0&&(V="Etc/GMT"+(v>0?"+":"")+v/60),this.variableTimezone=V!=="UTC"&&(V==null?void 0:V.indexOf("Etc/GMT"))!==0,this.timezone=V,this.lang&&D&&(this.lang.locale=D),["months","shortMonths","weekdays","shortWeekdays"].forEach(H=>{let Y=/months/i.test(H),J=/short/.test(H),ae={timeZone:"UTC"};ae[Y?"month":"weekday"]=J?"short":"long",this[H]=(Y?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(_e=>this.dateFormat(ae,(Y?31:1)*24*36e5*_e))})}toParts(ve){let[v,k,D,V,H,Y,J]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},ve,"es").split(/(?:, | |\/|:)/g);return[V,D-1,k,H,Y,J,Math.floor(Number(ve)||0)%1e3,"DLMXJVS".indexOf(v)].map(Number)}dateTimeFormat(ve,v,k=this.options.locale||Ue){let D=JSON.stringify(ve)+k;pi(ve)&&(ve=this.str2dtf(ve));let V=this.dTLCache[D];if(!V){ve.timeZone??(ve.timeZone=this.timezone);try{V=new Intl.DateTimeFormat(k,ve)}catch(H){/Invalid time zone/i.test(H.message)?(Lt(34),ve.timeZone="UTC",V=new Intl.DateTimeFormat(k,ve)):Lt(H.message,!1)}}return this.dTLCache[D]=V,(V==null?void 0:V.format(v))||""}str2dtf(ve,v={}){let k={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(k).forEach(D=>{ve.indexOf(D)!==-1&&pt(v,k[D])}),v}makeTime(ve,v,k=1,D=0,V,H,Y){let J=this.Date.UTC(ve,v,k,D,V||0,H||0,Y||0);if(this.timezone!=="UTC"){let ae=this.getTimezoneOffset(J);if(J+=ae,[2,3,8,9,10,11].indexOf(v)!==-1&&(D<5||D>20)){let _e=this.getTimezoneOffset(J);ae!==_e?J+=_e-ae:ae-36e5!==this.getTimezoneOffset(J-36e5)||Cr||(J-=36e5)}}return J}parse(ve){if(!pi(ve))return ve??void 0;let v=(ve=ve.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(ve),k=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(ve);v||k||(ve+="Z");let D=Date.parse(ve);if(Nt(D))return D+(!v||k?this.getTimezoneOffset(D):0)}getTimezoneOffset(ve){if(this.timezone!=="UTC"){let[v,k,D,V,H=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},ve,"en").split(/(GMT|:)/).map(Number),Y=-(60*(D+H/60)*6e4);if(Nt(Y))return Y}return 0}dateFormat(ve,v,k){let D=this.lang;if(!fi(v)||isNaN(v))return(D==null?void 0:D.invalidDate)||"";if(pi(ve=ve??"%Y-%m-%d %H:%M:%S")){let V,H=/%\[([a-zA-Z]+)\]/g;for(;V=H.exec(ve);)ve=ve.replace(V[0],this.dateTimeFormat(V[1],v,D==null?void 0:D.locale))}if(pi(ve)&&ve.indexOf("%")!==-1){let V=this,[H,Y,J,ae,_e,Me,xe,Pe]=this.toParts(v),je=(D==null?void 0:D.weekdays)||this.weekdays,Qe=(D==null?void 0:D.shortWeekdays)||this.shortWeekdays,at=(D==null?void 0:D.months)||this.months,nt=(D==null?void 0:D.shortMonths)||this.shortMonths;Ht(pt({a:Qe?Qe[Pe]:je[Pe].substr(0,3),A:je[Pe],d:nr(J),e:nr(J,2," "),w:Pe,v:(D==null?void 0:D.weekFrom)??"",b:nt[Y],B:at[Y],m:nr(Y+1),o:Y+1,y:H.toString().substr(2,2),Y:H,H:nr(ae),k:ae,I:nr(ae%12||12),l:ae%12||12,M:nr(_e),p:ae<12?"AM":"PM",P:ae<12?"am":"pm",S:nr(Me),L:nr(xe,3)},Ye.dateFormats),function(it,wt){if(pi(ve))for(;ve.indexOf("%"+wt)!==-1;)ve=ve.replace("%"+wt,typeof it=="function"?it.call(V,v):it)})}else if(Si(ve)){let V=(this.getTimezoneOffset(v)||0)/36e5,H=this.timezone||"Etc/GMT"+(V>=0?"+":"")+V,{prefix:Y="",suffix:J=""}=ve;ve=Y+this.dateTimeFormat(pt({timeZone:H},ve),v)+J}return k?Mr(ve):ve}resolveDTLFormat(ve){return Si(ve,!0)?Si(ve,!0)&&Tn(ve)?{main:ve}:ve:{main:(ve=tr(ve))[0],from:ve[1],to:ve[2]}}getDateFormat(ve,v,k,D){let V=this.dateFormat("%m-%d %H:%M:%S.%L",v),H="01-01 00:00:00.000",Y={millisecond:15,second:12,minute:9,hour:6,day:3},J="millisecond",ae=J;for(J in kr){if(ve&&ve===kr.week&&+this.dateFormat("%w",v)===k&&V.substr(6)===H.substr(6)){J="week";break}if(ve&&kr[J]>ve){J=ae;break}if(Y[J]&&V.substr(Y[J])!==H.substr(Y[J]))break;J!=="week"&&(ae=J)}return this.resolveDTLFormat(D[J]).main}},{defined:wn,extend:bs,timeUnits:qn}=pr,Ls=class extends gs{getTimeTicks(ve,v,k,D){let V=this,H=[],Y={},{count:J=1,unitRange:ae}=ve,[_e,Me,xe,Pe,je,Qe]=V.toParts(v),at=(v||0)%1e3,nt;if(D??(D=1),wn(v)){if(at=ae>=qn.second?0:J*Math.floor(at/J),ae>=qn.second&&(Qe=ae>=qn.minute?0:J*Math.floor(Qe/J)),ae>=qn.minute&&(je=ae>=qn.hour?0:J*Math.floor(je/J)),ae>=qn.hour&&(Pe=ae>=qn.day?0:J*Math.floor(Pe/J)),ae>=qn.day&&(xe=ae>=qn.month?1:Math.max(1,J*Math.floor(xe/J))),ae>=qn.month&&(Me=ae>=qn.year?0:J*Math.floor(Me/J)),ae>=qn.year&&(_e-=_e%J),ae===qn.week){J&&(v=V.makeTime(_e,Me,xe,Pe,je,Qe,at));let kt=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},v,"es"),Ai="DLMXJVS".indexOf(kt);xe+=-Ai+D+(Ai<D?-7:0)}v=V.makeTime(_e,Me,xe,Pe,je,Qe,at),V.variableTimezone&&wn(k)&&(nt=k-v>4*qn.month||V.getTimezoneOffset(v)!==V.getTimezoneOffset(k));let it=v,wt=1;for(;it<k;)H.push(it),ae===qn.year?it=V.makeTime(_e+wt*J,0):ae===qn.month?it=V.makeTime(_e,Me+wt*J):nt&&(ae===qn.day||ae===qn.week)?it=V.makeTime(_e,Me,xe+wt*J*(ae===qn.day?1:7)):nt&&ae===qn.hour&&J>1?it=V.makeTime(_e,Me,xe,Pe+wt*J):it+=ae*J,wt++;H.push(it),ae<=qn.hour&&H.length<1e4&&H.forEach(kt=>{kt%18e5==0&&V.dateFormat("%H%M%S%L",kt)==="000000000"&&(Y[kt]="day")})}return H.info=bs(ve,{higherRanks:Y,totalRange:ae*J}),H}},{isTouchDevice:ma}=Ye,{fireEvent:Ln,merge:qo}=pr,zn={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{color:"#333333",fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:ve=>Math.sqrt(1-Math.pow(ve-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:ma?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}"></span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},za=new Ls(zn.time,zn.lang),$o={defaultOptions:zn,defaultTime:za,getOptions:function(){return zn},setOptions:function(ve){var v;return Ln(Ye,"setOptions",{options:ve}),qo(!0,zn,ve),ve.time&&za.update(zn.time),ve.lang&&"locale"in ve.lang&&za.update({locale:ve.lang.locale}),(v=ve.lang)!=null&&v.chartTitle&&(zn.title={...zn.title,text:ve.lang.chartTitle}),zn}},{win:Aa}=Ye,{isNumber:ja,isString:Yn,merge:hl,pInt:fr,defined:tc}=pr,Sh=(ve,v,k)=>`color-mix(in srgb,${ve},${v} ${100*k}%)`,bl=ve=>Yn(ve)&&!!ve&&ve!=="none";class Un{static parse(v){return v?new Un(v):Un.None}constructor(v){let k,D,V,H;this.rgba=[NaN,NaN,NaN,NaN],this.input=v;let Y=Ye.Color;if(Y&&Y!==Un)return new Y(v);if(typeof v=="object"&&v.stops!==void 0)this.stops=v.stops.map(J=>new Un(J[1]));else if(typeof v=="string")for(this.input=v=Un.names[v.toLowerCase()]||v,V=Un.parsers.length;V--&&!D;)(k=(H=Un.parsers[V]).regex.exec(v))&&(D=H.parse(k));D&&(this.rgba=D)}get(v){let k=this.input,D=this.rgba;if(this.output)return this.output;if(typeof k=="object"&&this.stops!==void 0){let V=hl(k);return V.stops=[].slice.call(V.stops),this.stops.forEach((H,Y)=>{V.stops[Y]=[V.stops[Y][0],H.get(v)]}),V}return D&&ja(D[0])?v!=="rgb"&&(v||D[3]!==1)?v==="a"?`${D[3]}`:"rgba("+D.join(",")+")":"rgb("+D[0]+","+D[1]+","+D[2]+")":k}brighten(v){let k=this.rgba;if(this.stops)this.stops.forEach(function(D){D.brighten(v)});else if(ja(v)&&v!==0)if(ja(k[0]))for(let D=0;D<3;D++)k[D]+=fr(255*v),k[D]<0&&(k[D]=0),k[D]>255&&(k[D]=255);else Un.useColorMix&&bl(this.input)&&(this.output=Sh(this.input,v>0?"white":"black",Math.abs(v)));return this}setOpacity(v){return this.rgba[3]=v,this}tweenTo(v,k){let D=this.rgba,V=v.rgba;if(!ja(D[0])||!ja(V[0]))return Un.useColorMix&&bl(this.input)&&bl(v.input)&&k<.99?Sh(this.input,v.input,k):v.input||"none";let H=V[3]!==1||D[3]!==1,Y=(ae,_e)=>ae+(D[_e]-ae)*(1-k),J=V.slice(0,3).map(Y).map(Math.round);return H&&J.push(Y(V[3],3)),(H?"rgba(":"rgb(")+J.join(",")+")"}}Un.names={white:"#ffffff",black:"#000000"},Un.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(ve){return[fr(ve[1]),fr(ve[2]),fr(ve[3]),parseFloat(ve[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(ve){return[fr(ve[1]),fr(ve[2]),fr(ve[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(ve){return[fr(ve[1]+ve[1],16),fr(ve[2]+ve[2],16),fr(ve[3]+ve[3],16),tc(ve[4])?fr(ve[4]+ve[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(ve){return[fr(ve[1],16),fr(ve[2],16),fr(ve[3],16),tc(ve[4])?fr(ve[4],16)/255:1]}}],Un.useColorMix=(ld=Aa.CSS)==null?void 0:ld.supports("color","color-mix(in srgb,red,blue 9%)"),Un.None=new Un("");let{parse:vi}=Un,{win:Ge}=Ye,{isNumber:Fe,objectEach:rt}=pr;class xt{constructor(v,k,D){this.pos=NaN,this.options=k,this.elem=v,this.prop=D}dSetter(){let v=this.paths,k=v==null?void 0:v[0],D=v==null?void 0:v[1],V=this.now||0,H=[];if(V!==1&&k&&D)if(k.length===D.length&&V<1)for(let Y=0;Y<D.length;Y++){let J=k[Y],ae=D[Y],_e=[];for(let Me=0;Me<ae.length;Me++){let xe=J[Me],Pe=ae[Me];Fe(xe)&&Fe(Pe)&&(ae[0]!=="A"||Me!==4&&Me!==5)?_e[Me]=xe+V*(Pe-xe):_e[Me]=Pe}H.push(_e)}else H=D;else H=this.toD||[];this.elem.attr("d",H,void 0,!0)}update(){let v=this.elem,k=this.prop,D=this.now,V=this.options.step;this[k+"Setter"]?this[k+"Setter"]():v.attr?v.element&&v.attr(k,D,null,!0):v.style[k]=D+this.unit,V&&V.call(v,D,this)}run(v,k,D){let V=this,H=V.options,Y=function(_e){return!Y.stopped&&V.step(_e)},J=Ge.requestAnimationFrame||function(_e){setTimeout(_e,13)},ae=function(){for(let _e=0;_e<xt.timers.length;_e++)xt.timers[_e]()||xt.timers.splice(_e--,1);xt.timers.length&&J(ae)};v!==k||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=v,this.end=k,this.unit=D,this.now=this.start,this.pos=0,Y.elem=this.elem,Y.prop=this.prop,Y()&&xt.timers.push(Y)===1&&J(ae)):(delete H.curAnim[this.prop],H.complete&&Object.keys(H.curAnim).length===0&&H.complete.call(this.elem))}step(v){let k,D,V=+new Date,H=this.options,Y=this.elem,J=H.complete,ae=H.duration,_e=H.curAnim;return Y.attr&&!Y.element?k=!1:v||V>=ae+this.startTime?(this.now=this.end,this.pos=1,this.update(),_e[this.prop]=!0,D=!0,rt(_e,function(Me){Me!==!0&&(D=!1)}),D&&J&&J.call(Y),k=!1):(this.pos=H.easing((V-this.startTime)/ae),this.now=this.start+(this.end-this.start)*this.pos,this.update(),k=!0),k}initPath(v,k,D){let V=v.startX,H=v.endX,Y=D.slice(),J=v.isArea,ae=J?2:1,_e=k&&D.length>k.length&&D.hasStackedCliffs,Me,xe,Pe,je,Qe=k==null?void 0:k.slice();if(!Qe||_e)return[Y,Y];function at(it,wt){for(;it.length<xe;){let kt=it[0],Ai=wt[xe-it.length];if(Ai&&kt[0]==="M"&&(Ai[0]==="C"?it[0]=["C",kt[1],kt[2],kt[1],kt[2],kt[1],kt[2]]:it[0]=["L",kt[1],kt[2]]),it.unshift(kt),J){let ki=it.pop();it.push(it[it.length-1],ki)}}}function nt(it){for(;it.length<xe;){let wt=it[Math.floor(it.length/ae)-1].slice();if(wt[0]==="C"&&(wt[1]=wt[5],wt[2]=wt[6]),J){let kt=it[Math.floor(it.length/ae)].slice();it.splice(it.length/2,0,wt,kt)}else it.push(wt)}}if(V&&H&&H.length){for(Pe=0;Pe<V.length;Pe++)if(V[Pe]===H[0]){Me=Pe;break}else if(V[0]===H[H.length-V.length+Pe]){Me=Pe,je=!0;break}else if(V[V.length-1]===H[H.length-V.length+Pe]){Me=V.length-Pe;break}Me===void 0&&(Qe=[])}return Qe.length&&Fe(Me)&&(xe=Y.length+Me*ae,je?(at(Qe,Y),nt(Y)):(at(Y,Qe),nt(Qe))),[Qe,Y]}fillSetter(){xt.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,vi(this.start).tweenTo(vi(this.end),this.pos),void 0,!0)}}xt.timers=[];let{defined:ft,getStyle:Jt,isArray:xi,isNumber:ti,isObject:ai,merge:Yi,objectEach:Fi,pick:Pr}=pr;function ln(ve){return ai(ve)?Yi({duration:500,defer:0},ve):{duration:500*!!ve,defer:0}}function Qr(ve,v){let k=xt.timers.length;for(;k--;)xt.timers[k].elem!==ve||v&&v!==xt.timers[k].prop||(xt.timers[k].stopped=!0)}let Or={animate:function(ve,v,k){let D,V="",H,Y,J;ai(k)||(J=arguments,k={duration:J[2],easing:J[3],complete:J[4]}),ti(k.duration)||(k.duration=400),k.easing=typeof k.easing=="function"?k.easing:Math[k.easing]||Math.easeInOutSine,k.curAnim=Yi(v),Fi(v,function(ae,_e){Qr(ve,_e),Y=new xt(ve,k,_e),H=void 0,_e==="d"&&xi(v.d)?(Y.paths=Y.initPath(ve,ve.pathArray,v.d),Y.toD=v.d,D=0,H=1):ve.attr?D=ve.attr(_e):(D=parseFloat(Jt(ve,_e))||0,_e!=="opacity"&&(V="px")),H||(H=ae),typeof H=="string"&&H.match("px")&&(H=H.replace(/px/g,"")),Y.run(D,H,V)})},animObject:ln,getDeferredAnimation:function(ve,v,k){let D=ln(v),V=k?[k]:ve.series,H=0,Y=0;return V.forEach(J=>{let ae=ln(J.options.animation);H=ai(v)&&ft(v.defer)?D.defer:Math.max(H,ae.duration+ae.defer),Y=Math.min(D.duration,ae.duration)}),ve.renderer.forExport&&(H=0),{defer:Math.max(0,H-Y),duration:Math.min(H,Y)}},setAnimation:function(ve,v){v.renderer.globalAnimation=Pr(ve,v.options.chart.animation,!0)},stop:Qr},{SVG_NS:ii,win:xr}=Ye,{attr:Xr,createElement:tn,css:Jn,error:ds,isFunction:mi,isString:_r,objectEach:zi,splat:zr}=pr,{trustedTypes:Yr}=xr,yr=Yr&&mi(Yr.createPolicy)&&Yr.createPolicy("highcharts",{createHTML:ve=>ve}),Hr=yr?yr.createHTML(""):"";class rn{static filterUserAttributes(v){return zi(v,(k,D)=>{let V=!0;rn.allowedAttributes.indexOf(D)===-1&&(V=!1),["background","dynsrc","href","lowsrc","src"].indexOf(D)!==-1&&(V=_r(k)&&rn.allowedReferences.some(H=>k.indexOf(H)===0)),V||(ds(33,!1,void 0,{"Invalid attribute in config":`${D}`}),delete v[D]),_r(k)&&v[D]&&(v[D]=k.replace(/</g,"&lt;"))}),v}static parseStyle(v){return v.split(";").reduce((k,D)=>{let V=D.split(":").map(Y=>Y.trim()),H=V.shift();return H&&V.length&&(k[H.replace(/-([a-z])/g,Y=>Y[1].toUpperCase())]=V.join(":")),k},{})}static setElementHTML(v,k){v.innerHTML=rn.emptyHTML,k&&new rn(k).addToDOM(v)}constructor(v){this.nodes=typeof v=="string"?this.parseMarkup(v):v}addToDOM(v){return function k(D,V){let H;return zr(D).forEach(function(Y){let J,ae=Y.tagName,_e=Y.textContent?Ye.doc.createTextNode(Y.textContent):void 0,Me=rn.bypassHTMLFiltering;if(ae)if(ae==="#text")J=_e;else if(rn.allowedTags.indexOf(ae)!==-1||Me){let xe=ae==="svg"?ii:V.namespaceURI||ii,Pe=Ye.doc.createElementNS(xe,ae),je=Y.attributes||{};zi(Y,function(Qe,at){at!=="tagName"&&at!=="attributes"&&at!=="children"&&at!=="style"&&at!=="textContent"&&(je[at]=Qe)}),Xr(Pe,Me?je:rn.filterUserAttributes(je)),Y.style&&Jn(Pe,Y.style),_e&&Pe.appendChild(_e),k(Y.children||[],Pe),J=Pe}else ds(33,!1,void 0,{"Invalid tagName in config":ae});J&&V.appendChild(J),H=J}),H}(this.nodes,v)}parseMarkup(v){let k,D=[];v=v.trim().replace(/ style=(["'])/g," data-style=$1");try{k=new DOMParser().parseFromString(yr?yr.createHTML(v):v,"text/html")}catch{}if(!k){let H=tn("div");H.innerHTML=v,k={body:H}}let V=(H,Y)=>{let J=H.nodeName.toLowerCase(),ae={tagName:J};J==="#text"&&(ae.textContent=H.textContent||"");let _e=H.attributes;if(_e){let Me={};[].forEach.call(_e,xe=>{xe.name==="data-style"?ae.style=rn.parseStyle(xe.value):Me[xe.name]=xe.value}),ae.attributes=Me}if(H.childNodes.length){let Me=[];[].forEach.call(H.childNodes,xe=>{V(xe,Me)}),Me.length&&(ae.children=Me)}Y.push(ae)};return[].forEach.call(k.body.childNodes,H=>V(H,D)),D}}rn.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","disabled","dx","dy","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","result","role","rowspan","scope","slope","src","startOffset","stdDeviation","stroke-linecap","stroke-width","stroke","style","summary","tabindex","tableValues","target","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],rn.allowedReferences=["https://","http://","mailto:","/","../","./","#"],rn.allowedTags=["#text","a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","tbody","td","text","textPath","th","thead","title","tr","tspan","u","ul"],rn.emptyHTML=Hr,rn.bypassHTMLFiltering=!1;let{defaultOptions:is,defaultTime:Ps}=$o,{pageLang:vs}=Ye,{extend:ra,getNestedProperty:Po,isArray:Sc,isNumber:Xl,isObject:lh,isString:ps,pick:la,ucfirst:$u}=pr,_u={add:(ve,v)=>ve+v,divide:(ve,v)=>v!==0?ve/v:"",eq:(ve,v)=>ve==v,each:function(ve){let v=arguments[arguments.length-1];return!!Sc(ve)&&ve.map((k,D)=>zc(v.body,ra(lh(k)?k:{"@this":k},{"@index":D,"@first":D===0,"@last":D===ve.length-1}))).join("")},ge:(ve,v)=>ve>=v,gt:(ve,v)=>ve>v,if:ve=>!!ve,le:(ve,v)=>ve<=v,lt:(ve,v)=>ve<v,multiply:(ve,v)=>ve*v,ne:(ve,v)=>ve!=v,subtract:(ve,v)=>ve-v,ucfirst:$u,unless:ve=>!ve},ch={},Lc=ve=>/^["'].+["']$/.test(ve);function zc(ve="",v,k){var nt;let D=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= #\(\)]+)\}/g,V=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,H=[],Y=/f$/,J=/\.(\d)/,ae=((nt=k==null?void 0:k.options)==null?void 0:nt.lang)||is.lang,_e=(k==null?void 0:k.time)||Ps,Me=(k==null?void 0:k.numberFormatter)||Kh.bind(k),xe=(it="")=>{let wt;return it==="true"||it!=="false"&&((wt=Number(it)).toString()===it?wt:Lc(it)?it.slice(1,-1):Po(it,v))},Pe,je,Qe=0,at;for(;(Pe=D.exec(ve))!==null;){let it=Pe,wt=V.exec(Pe[1]);wt&&(Pe=wt,at=!0),je!=null&&je.isBlock||(je={ctx:v,expression:Pe[1],find:Pe[0],isBlock:Pe[1].charAt(0)==="#",start:Pe.index,startInner:Pe.index+Pe[0].length,length:Pe[0].length});let kt=(je.isBlock?it:Pe)[1].split(" ")[0].replace("#","");_u[kt]&&(je.isBlock&&kt===je.fn&&Qe++,je.fn||(je.fn=kt));let Ai=Pe[1]==="else";if(je.isBlock&&je.fn&&(Pe[1]===`/${je.fn}`||Ai))if(Qe)!Ai&&Qe--;else{let ki=je.startInner,Ri=ve.substr(ki,Pe.index-ki);je.body===void 0?(je.body=Ri,je.startInner=Pe.index+Pe[0].length):je.elseBody=Ri,je.find+=Ri+Pe[0],Ai||(H.push(je),je=void 0)}else je.isBlock||H.push(je);if(wt&&!(je!=null&&je.isBlock))break}return H.forEach(it=>{let wt,kt,{body:Ai,elseBody:ki,expression:Ri,fn:Sr}=it;if(Sr){let hr=[it],wr=[],Jr=Ri.length,yn=0,Rn;for(kt=0;kt<=Jr;kt++){let fn=Ri.charAt(kt);Rn||fn!=='"'&&fn!=="'"?Rn===fn&&(Rn=""):Rn=fn,Rn||fn!==" "&&kt!==Jr||(wr.push(Ri.substr(yn,kt-yn)),yn=kt+1)}for(kt=_u[Sr].length;kt--;)hr.unshift(xe(wr[kt+1]));wt=_u[Sr].apply(v,hr),it.isBlock&&typeof wt=="boolean"&&(wt=zc(wt?Ai:ki,v,k))}else{let hr=Lc(Ri)?[Ri]:Ri.split(":"),wr=(wt=xe(hr.shift()||""))%1!=0;if(typeof wt=="number"&&(hr.length||wr)){let Jr=hr.join(":");if(Y.test(Jr)||wr){let yn=parseInt((Jr.match(J)||["","-1"])[1],10);wt!==null&&(wt=Me(wt,yn,ae.decimalPoint,Jr.indexOf(",")>-1?ae.thousandsSep:""))}else wt=_e.dateFormat(Jr,wt)}V.lastIndex=0,V.test(it.find)&&ps(wt)&&(wt=`"${wt}"`)}ve=ve.replace(it.find,la(wt,""))}),at?zc(ve,v,k):ve}function Kh(ve,v,k,D){var at;v*=1;let V,H,[Y,J]=(ve=+ve||0).toString().split("e").map(Number),ae=((at=this==null?void 0:this.options)==null?void 0:at.lang)||is.lang,_e=(ve.toString().split(".")[1]||"").split("e")[0].length,Me=v,xe={};k??(k=ae.decimalPoint),D??(D=ae.thousandsSep),v===-1?v=Math.min(_e,20):Xl(v)?v&&J<0&&((H=v+J)>=0?(Y=+Y.toExponential(H).split("e")[0],v=H):(Y=Math.floor(Y),ve=v<20?+(Y*Math.pow(10,J)).toFixed(v):0,J=0)):v=2,J&&(v??(v=2),ve=Y),Xl(v)&&v>=0&&(xe.minimumFractionDigits=v,xe.maximumFractionDigits=v),D===""&&(xe.useGrouping=!1);let Pe=D||k,je=Pe?"en":(this==null?void 0:this.locale)||ae.locale||vs,Qe=JSON.stringify(xe)+je;return V=(ch[Qe]??(ch[Qe]=new Intl.NumberFormat(je,xe))).format(ve),Pe&&(V=V.replace(/([,\.])/g,"_$1").replace(/_\,/g,D??",").replace("_.",k??".")),(v||+V!=0)&&(!(J<0)||Me)||(V="0"),J&&+V!=0&&(V+="e"+(J<0?"":"+")+J),V}let ul={dateFormat:function(ve,v,k){return Ps.dateFormat(ve,v,k)},format:zc,helpers:_u,numberFormat:Kh};(function(ve){let v;ve.rendererTypes={},ve.getRendererType=function(k=v){return ve.rendererTypes[k]||ve.rendererTypes[v]},ve.registerRendererType=function(k,D,V){ve.rendererTypes[k]=D,(!v||V)&&(v=k,Ye.Renderer=D)}})(d||(d={}));let Uc=d,{clamp:du,pick:Yc,pushUnique:Ds,stableSort:Ys}=pr;(f||(f={})).distribute=function ve(v,k,D){let V=v,H=V.reducedLen||k,Y=(kt,Ai)=>kt.target-Ai.target,J=[],ae=v.length,_e=[],Me=J.push,xe,Pe,je,Qe=!0,at,nt,it=0,wt;for(xe=ae;xe--;)it+=v[xe].size;if(it>H){for(Ys(v,(kt,Ai)=>(Ai.rank||0)-(kt.rank||0)),je=(wt=v[0].rank===v[v.length-1].rank)?ae/2:-1,Pe=wt?je:ae-1;je&&it>H;)at=v[xe=Math.floor(Pe)],Ds(_e,xe)&&(it-=at.size),Pe+=je,wt&&Pe>=v.length&&(je/=2,Pe=je);_e.sort((kt,Ai)=>Ai-kt).forEach(kt=>Me.apply(J,v.splice(kt,1)))}for(Ys(v,Y),v=v.map(kt=>({size:kt.size,targets:[kt.target],align:Yc(kt.align,.5)}));Qe;){for(xe=v.length;xe--;)at=v[xe],nt=(Math.min.apply(0,at.targets)+Math.max.apply(0,at.targets))/2,at.pos=du(nt-at.size*at.align,0,k-at.size);for(xe=v.length,Qe=!1;xe--;)xe>0&&v[xe-1].pos+v[xe-1].size>v[xe].pos&&(v[xe-1].size+=v[xe].size,v[xe-1].targets=v[xe-1].targets.concat(v[xe].targets),v[xe-1].align=.5,v[xe-1].pos+v[xe-1].size>k&&(v[xe-1].pos=k-v[xe-1].size),v.splice(xe,1),Qe=!0)}return Me.apply(V,J),xe=0,v.some(kt=>{let Ai=0;return(kt.targets||[]).some(()=>(V[xe].pos=kt.pos+Ai,D!==void 0&&Math.abs(V[xe].pos-V[xe].target)>D?(V.slice(0,xe+1).forEach(ki=>delete ki.pos),V.reducedLen=(V.reducedLen||k)-.1*k,V.reducedLen>.1*k&&ve(V,k,D),!0):(Ai+=V[xe].size,xe++,!1)))}),Ys(V,Y),V};let Cs=f,{animate:to,animObject:Xs,stop:Bs}=Or,{deg2rad:ba,doc:ca,svg:fh,SVG_NS:Il,win:Dp,isFirefox:Th}=Ye,{addEvent:Vs,attr:pu,createElement:vu,crisp:Qh,css:Vf,defined:Tc,erase:hp,extend:mh,fireEvent:qa,getAlignFactor:Ka,isArray:zd,isFunction:Vu,isNumber:Nh,isObject:Ud,isString:up,merge:hc,objectEach:fu,pick:Ha,pInt:Ll,pushUnique:vd,replaceNested:Bh,syncTimeout:Wu,uniqueKey:Xc}=pr;class Ma{_defaultGetter(v){let k=Ha(this[v+"Value"],this[v],this.element?this.element.getAttribute(v):null,0);return/^-?[\d\.]+$/.test(k)&&(k=parseFloat(k)),k}_defaultSetter(v,k,D){D.setAttribute(k,v)}add(v){let k,D=this.renderer,V=this.element;return v&&(this.parentGroup=v),this.textStr!==void 0&&this.element.nodeName==="text"&&D.buildText(this),this.added=!0,(!v||v.handleZ||this.zIndex)&&(k=this.zIndexSetter()),k||(v?v.element:D.box).appendChild(V),this.onAdd&&this.onAdd(),this}addClass(v,k){let D=k?"":this.attr("class")||"";return(v=(v||"").split(/ /g).reduce(function(V,H){return D.indexOf(H)===-1&&V.push(H),V},D?[D]:[]).join(" "))!==D&&this.attr("class",v),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(v,k,D,V=!0){let H=this.renderer,Y=H.alignedObjects,J=!!v;v?(this.alignOptions=v,this.alignByTranslate=k,this.alignTo=D):(v=this.alignOptions||{},k=this.alignByTranslate,D=this.alignTo);let ae=!D||up(D)?D||"renderer":void 0;ae&&(J&&vd(Y,this),D=void 0);let _e=Ha(D,H[ae],H),Me=(_e.x||0)+(v.x||0)+((_e.width||0)-(v.width||0))*Ka(v.align),xe=(_e.y||0)+(v.y||0)+((_e.height||0)-(v.height||0))*Ka(v.verticalAlign),Pe={"text-align":v==null?void 0:v.align};return Pe[k?"translateX":"x"]=Math.round(Me),Pe[k?"translateY":"y"]=Math.round(xe),V&&(this[this.placed?"animate":"attr"](Pe),this.placed=!0),this.alignAttr=Pe,this}alignSetter(v){let k={left:"start",center:"middle",right:"end"};k[v]&&(this.alignValue=v,this.element.setAttribute("text-anchor",k[v]))}animate(v,k,D){let V=Xs(Ha(k,this.renderer.globalAnimation,!0)),H=V.defer;return ca.hidden&&(V.duration=0),V.duration!==0?(D&&(V.complete=D),Wu(()=>{this.element&&to(this,v,V)},H)):(this.attr(v,void 0,D||V.complete),fu(v,function(Y,J){V.step&&V.step.call(this,Y,{prop:J,pos:1,elem:this})},this)),this}applyTextOutline(v){let k=this.element;v.indexOf("contrast")!==-1&&(v=v.replace(/contrast/g,this.renderer.getContrast(k.style.fill)));let D=v.indexOf(" "),V=v.substring(D+1),H=v.substring(0,D);if(H&&H!=="none"&&Ye.svg){this.fakeTS=!0,H=H.replace(/(^[\d\.]+)(.*?)$/g,function(Me,xe,Pe){return 2*Number(xe)+Pe}),this.removeTextOutline();let Y=ca.createElementNS(Il,"tspan");pu(Y,{class:"highcharts-text-outline",fill:V,stroke:V,"stroke-width":H,"stroke-linejoin":"round"});let J=k.querySelector("textPath")||k;[].forEach.call(J.childNodes,Me=>{let xe=Me.cloneNode(!0);xe.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(Pe=>xe.removeAttribute(Pe)),Y.appendChild(xe)});let ae=0;[].forEach.call(J.querySelectorAll("text tspan"),Me=>{ae+=Number(Me.getAttribute("dy"))});let _e=ca.createElementNS(Il,"tspan");_e.textContent="",pu(_e,{x:Number(k.getAttribute("x")),dy:-ae}),Y.appendChild(_e),J.insertBefore(Y,J.firstChild)}}attr(v,k,D,V){let{element:H}=this,Y=Ma.symbolCustomAttribs,J,ae,_e=this,Me;return typeof v=="string"&&k!==void 0&&(J=v,(v={})[J]=k),typeof v=="string"?_e=(this[v+"Getter"]||this._defaultGetter).call(this,v,H):(fu(v,function(xe,Pe){Me=!1,V||Bs(this,Pe),this.symbolName&&Y.indexOf(Pe)!==-1&&(ae||(this.symbolAttr(v),ae=!0),Me=!0),this.rotation&&(Pe==="x"||Pe==="y")&&(this.doTransform=!0),Me||(this[Pe+"Setter"]||this._defaultSetter).call(this,xe,Pe,H)},this),this.afterSetters()),D&&D.call(this),_e}clip(v){if(v&&!v.clipPath){let k=Xc()+"-",D=this.renderer.createElement("clipPath").attr({id:k}).add(this.renderer.defs);mh(v,{clipPath:D,id:k,count:0}),v.add(D)}return this.attr("clip-path",v?`url(${this.renderer.url}#${v.id})`:"none")}crisp(v,k){k=Math.round(k||v.strokeWidth||0);let D=v.x||this.x||0,V=v.y||this.y||0,H=(v.width||this.width||0)+D,Y=(v.height||this.height||0)+V,J=Qh(D,k),ae=Qh(V,k);return mh(v,{x:J,y:ae,width:Qh(H,k)-J,height:Qh(Y,k)-ae}),Tc(v.strokeWidth)&&(v.strokeWidth=k),v}complexColor(v,k,D){let V=this.renderer,H,Y,J,ae,_e,Me,xe,Pe,je,Qe,at=[],nt;qa(this.renderer,"complexColor",{args:arguments},function(){if(v.radialGradient?Y="radialGradient":v.linearGradient&&(Y="linearGradient"),Y){if(J=v[Y],_e=V.gradients,Me=v.stops,je=D.radialReference,zd(J)&&(v[Y]=J={x1:J[0],y1:J[1],x2:J[2],y2:J[3],gradientUnits:"userSpaceOnUse"}),Y==="radialGradient"&&je&&!Tc(J.gradientUnits)&&(ae=J,J=hc(J,V.getRadialAttr(je,ae),{gradientUnits:"userSpaceOnUse"})),fu(J,function(it,wt){wt!=="id"&&at.push(wt,it)}),fu(Me,function(it){at.push(it)}),_e[at=at.join(",")])Qe=_e[at].attr("id");else{J.id=Qe=Xc();let it=_e[at]=V.createElement(Y).attr(J).add(V.defs);it.radAttr=ae,it.stops=[],Me.forEach(function(wt){wt[1].indexOf("rgba")===0?(xe=(H=Un.parse(wt[1])).get("rgb"),Pe=H.get("a")):(xe=wt[1],Pe=1);let kt=V.createElement("stop").attr({offset:wt[0],"stop-color":xe,"stop-opacity":Pe}).add(it);it.stops.push(kt)})}nt="url("+V.url+"#"+Qe+")",D.setAttribute(k,nt),D.gradient=at,v.toString=function(){return nt}}})}css(v){let k=this.styles,D={},V=this.element,H,Y=!k;if(k&&fu(v,function(J,ae){k&&k[ae]!==J&&(D[ae]=J,Y=!0)}),Y){k&&(v=mh(k,D)),v.width===null||v.width==="auto"?delete this.textWidth:V.nodeName.toLowerCase()==="text"&&v.width&&(H=this.textWidth=Ll(v.width)),mh(this.styles,v),H&&!fh&&this.renderer.forExport&&delete v.width;let J=Th&&v.fontSize||null;J&&(Nh(J)||/^\d+$/.test(J))&&(v.fontSize+="px");let ae=hc(v);V.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(_e=>ae&&delete ae[_e]),ae.color&&(ae.fill=ae.color,delete ae.color)),Vf(V,ae)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),v.textOutline&&this.applyTextOutline(v.textOutline)),this}dashstyleSetter(v){let k,D=this["stroke-width"];if(D==="inherit"&&(D=1),v){let V=(v=v.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(k=V.length;k--;)V[k]=""+Ll(V[k])*Ha(D,NaN);v=V.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",v)}}destroy(){let v=this,k=v.element||{},D=v.renderer,V=k.ownerSVGElement,H=k.nodeName==="SPAN"&&v.parentGroup||void 0,Y,J;if(k.onclick=k.onmouseout=k.onmouseover=k.onmousemove=k.point=null,Bs(v),v.clipPath&&V){let ae=v.clipPath;[].forEach.call(V.querySelectorAll("[clip-path],[CLIP-PATH]"),function(_e){_e.getAttribute("clip-path").indexOf(ae.element.id)>-1&&_e.removeAttribute("clip-path")}),v.clipPath=ae.destroy()}if(v.stops){for(J=0;J<v.stops.length;J++)v.stops[J].destroy();v.stops.length=0,v.stops=void 0}for(v.safeRemoveChild(k);H!=null&&H.div&&H.div.childNodes.length===0;)Y=H.parentGroup,v.safeRemoveChild(H.div),delete H.div,H=Y;v.alignOptions&&hp(D.alignedObjects,v),fu(v,(ae,_e)=>{var Me,xe,Pe;(((Me=v[_e])==null?void 0:Me.parentGroup)===v||["connector","foreignObject"].indexOf(_e)!==-1)&&((Pe=(xe=v[_e])==null?void 0:xe.destroy)==null||Pe.call(xe)),delete v[_e]})}dSetter(v,k,D){zd(v)&&(typeof v[0]=="string"&&(v=this.renderer.pathToSegments(v)),this.pathArray=v,v=v.reduce((V,H,Y)=>H!=null&&H.join?(Y?V+" ":"")+H.join(" "):(H||"").toString(),"")),/(NaN| {2}|^$)/.test(v)&&(v="M 0 0"),this[k]!==v&&(D.setAttribute(k,v),this[k]=v)}fillSetter(v,k,D){typeof v=="string"?D.setAttribute(k,v):v&&this.complexColor(v,k,D)}hrefSetter(v,k,D){D.setAttributeNS("http://www.w3.org/1999/xlink",k,v)}getBBox(v,k){let D,V,H,Y,{alignValue:J,element:ae,renderer:_e,styles:Me,textStr:xe}=this,{cache:Pe,cacheKeys:je}=_e,Qe=ae.namespaceURI===this.SVG_NS,at=Ha(k,this.rotation,0),nt=_e.styledMode?ae&&Ma.prototype.getStyle.call(ae,"font-size"):Me.fontSize;if(Tc(xe)&&((Y=xe.toString()).indexOf("<")===-1&&(Y=Y.replace(/\d/g,"0")),Y+=["",_e.rootFontSize,nt,at,this.textWidth,J,Me.lineClamp,Me.textOverflow,Me.fontWeight].join(",")),Y&&!v&&(D=Pe[Y]),!D||D.polygon){if(Qe||_e.forExport){try{H=this.fakeTS&&function(wt){let kt=ae.querySelector(".highcharts-text-outline");kt&&Vf(kt,{display:wt})},Vu(H)&&H("none"),D=ae.getBBox?mh({},ae.getBBox()):{width:ae.offsetWidth,height:ae.offsetHeight,x:0,y:0},Vu(H)&&H("")}catch{}(!D||D.width<0)&&(D={x:0,y:0,width:0,height:0})}else D=this.htmlGetBBox();V=D.height,Qe&&(D.height=V={"11px,17":14,"13px,20":16}[`${nt||""},${Math.round(V)}`]||V),at&&(D=this.getRotatedBox(D,at));let it={bBox:D};qa(this,"afterGetBBox",it),D=it.bBox}if(Y&&(xe===""||D.height>0)){for(;je.length>250;)delete Pe[je.shift()];Pe[Y]||je.push(Y),Pe[Y]=D}return D}getRotatedBox(v,k){let{x:D,y:V,width:H,height:Y}=v,{alignValue:J,translateY:ae,rotationOriginX:_e=0,rotationOriginY:Me=0}=this,xe=Ka(J),Pe=Number(this.element.getAttribute("y")||0)-(ae?0:V),je=k*ba,Qe=(k-90)*ba,at=Math.cos(je),nt=Math.sin(je),it=H*at,wt=H*nt,kt=Math.cos(Qe),Ai=Math.sin(Qe),[[ki,Ri],[Sr,hr]]=[_e,Me].map(ka=>[ka-ka*at,ka*nt]),wr=D+xe*(H-it)+ki+hr+Pe*kt,Jr=wr+it,yn=Jr-Y*kt,Rn=yn-it,fn=V+Pe-xe*wt-Ri+Sr+Pe*Ai,ms=fn+wt,hs=ms-Y*Ai,Is=hs-wt,jn=Math.min(wr,Jr,yn,Rn),us=Math.min(fn,ms,hs,Is),oa=Math.max(wr,Jr,yn,Rn)-jn,Ea=Math.max(fn,ms,hs,Is)-us;return{x:jn,y:us,width:oa,height:Ea,polygon:[[wr,fn],[Jr,ms],[yn,hs],[Rn,Is]]}}getStyle(v){return Dp.getComputedStyle(this.element||this,"").getPropertyValue(v)}hasClass(v){return(""+this.attr("class")).split(" ").indexOf(v)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(v,k){this.onEvents={},this.opacity=1,this.SVG_NS=Il,this.element=k==="span"||k==="body"?vu(k):ca.createElementNS(this.SVG_NS,k),this.renderer=v,this.styles={},qa(this,"afterInit")}on(v,k){let{onEvents:D}=this;return D[v]&&D[v](),D[v]=Vs(this.element,v,k),this}opacitySetter(v,k,D){let V=Number(Number(v).toFixed(3));this.opacity=V,D.setAttribute(k,V)}reAlign(){var v;(v=this.alignOptions)!=null&&v.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(v){return this.attr("class",(""+this.attr("class")).replace(up(v)?RegExp(`(^| )${v}( |$)`):v," ").replace(/ +/g," ").trim())}removeTextOutline(){let v=this.element.querySelector("tspan.highcharts-text-outline");v&&this.safeRemoveChild(v)}safeRemoveChild(v){let k=v.parentNode;k&&k.removeChild(v)}setRadialReference(v){let k=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=v,k!=null&&k.radAttr&&k.animate(this.renderer.getRadialAttr(v,k.radAttr)),this}shadow(v){var H;let{renderer:k}=this,D=hc(((H=this.parentGroup)==null?void 0:H.rotation)===90?{offsetX:-1,offsetY:-1}:{},Ud(v)?v:{}),V=k.shadowDefinition(D);return this.attr({filter:v?`url(${k.url}#${V})`:"none"})}show(v=!0){return this.attr({visibility:v?"inherit":"visible"})}"stroke-widthSetter"(v,k,D){this[k]=v,D.setAttribute(k,v)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let v=this.getStyle("stroke-width"),k=0,D;return/px$/.test(v)?k=Ll(v):v!==""&&(pu(D=ca.createElementNS(Il,"rect"),{width:v,"stroke-width":0}),this.element.parentNode.appendChild(D),k=D.getBBox().width,D.parentNode.removeChild(D)),k}symbolAttr(v){let k=this;Ma.symbolCustomAttribs.forEach(function(D){k[D]=Ha(v[D],k[D])}),k.attr({d:k.renderer.symbols[k.symbolName](k.x,k.y,k.width,k.height,k)})}textSetter(v){v!==this.textStr&&(delete this.textPxLength,this.textStr=v,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(v){let k=this.element,D=k.getElementsByTagName("title")[0]||ca.createElementNS(this.SVG_NS,"title");k.insertBefore?k.insertBefore(D,k.firstChild):k.appendChild(D),D.textContent=Bh(Ha(v,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let v=this.element;return v.parentNode.appendChild(v),this}translate(v,k){return this.attr({translateX:v,translateY:k})}updateTransform(v="transform"){let{element:k,foreignObject:D,matrix:V,padding:H,rotation:Y=0,rotationOriginX:J,rotationOriginY:ae,scaleX:_e,scaleY:Me,text:xe,translateX:Pe=0,translateY:je=0}=this,Qe=["translate("+Pe+","+je+")"];Tc(V)&&Qe.push("matrix("+V.join(",")+")"),Y&&(Qe.push("rotate("+Y+" "+(J??k.getAttribute("x")??this.x??0)+" "+(ae??k.getAttribute("y")??this.y??0)+")"),(xe==null?void 0:xe.element.tagName)!=="SPAN"||xe!=null&&xe.foreignObject||xe.attr({rotation:Y,rotationOriginX:(J||0)-H,rotationOriginY:(ae||0)-H})),(Tc(_e)||Tc(Me))&&Qe.push("scale("+Ha(_e,1)+" "+Ha(Me,1)+")"),Qe.length&&!(xe||this).textPath&&((D==null?void 0:D.element)||k).setAttribute(v,Qe.join(" "))}visibilitySetter(v,k,D){v==="inherit"?D.removeAttribute(k):this[k]!==v&&D.setAttribute(k,v),this[k]=v}xGetter(v){return this.element.nodeName==="circle"&&(v==="x"?v="cx":v==="y"&&(v="cy")),this._defaultGetter(v)}zIndexSetter(v,k){let D=this.renderer,V=this.parentGroup,H=(V||D).element||D.box,Y=this.element,J=H===D.box,ae,_e,Me,xe=!1,Pe,je=this.added,Qe;if(Tc(v)?(Y.setAttribute("data-z-index",v),v*=1,this[k]===v&&(je=!1)):Tc(this[k])&&Y.removeAttribute("data-z-index"),this[k]=v,je){for((v=this.zIndex)&&V&&(V.handleZ=!0),Qe=(ae=H.childNodes).length-1;Qe>=0&&!xe;Qe--)Pe=!Tc(Me=(_e=ae[Qe]).getAttribute("data-z-index")),_e!==Y&&(v<0&&Pe&&!J&&!Qe?(H.insertBefore(Y,ae[Qe]),xe=!0):(Ll(Me)<=v||Pe&&(!Tc(v)||v>=0))&&(H.insertBefore(Y,ae[Qe+1]),xe=!0));xe||(H.insertBefore(Y,ae[3*!!J]),xe=!0)}return xe}}Ma.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],Ma.prototype.strokeSetter=Ma.prototype.fillSetter,Ma.prototype.yGetter=Ma.prototype.xGetter,Ma.prototype.matrixSetter=Ma.prototype.rotationOriginXSetter=Ma.prototype.rotationOriginYSetter=Ma.prototype.rotationSetter=Ma.prototype.scaleXSetter=Ma.prototype.scaleYSetter=Ma.prototype.translateXSetter=Ma.prototype.translateYSetter=Ma.prototype.verticalAlignSetter=function(ve,v){this[v]=ve,this.doTransform=!0};let Cc=Ma,{defined:Fh,extend:ao,getAlignFactor:Dl,isNumber:xu,merge:af,pick:kn,removeEvent:lf}=pr;class ic extends Cc{constructor(v,k,D,V,H,Y,J,ae,_e,Me){let xe;super(v,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=k,this.x=D,this.y=V,this.anchorX=Y,this.anchorY=J,this.baseline=_e,this.className=Me,this.addClass(Me==="button"?"highcharts-no-tooltip":"highcharts-label"),Me&&this.addClass("highcharts-"+Me),this.text=v.text(void 0,0,0,ae).attr({zIndex:1}),typeof H=="string"&&((xe=/^url\((.*?)\)$/.test(H))||this.renderer.symbols[H])&&(this.symbolKey=H),this.bBox=ic.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=v.styledMode||xe,this.deferredAttr={},this.alignFactor=0}alignSetter(v){let k=Dl(v);this.textAlign=v,k!==this.alignFactor&&(this.alignFactor=k,this.bBox&&xu(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(v,k){this.anchorX=v,this.boxAttr(k,Math.round(v)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(v,k){this.anchorY=v,this.boxAttr(k,v-this.ySetting)}boxAttr(v,k){this.box?this.box.attr(v,k):this.deferredAttr[v]=k}css(v){if(v){let k={};v=af(v),ic.textProps.forEach(D=>{v[D]!==void 0&&(k[D]=v[D],delete v[D])}),this.text.css(k),"fontSize"in k||"fontWeight"in k?this.updateTextPadding():("width"in k||"textOverflow"in k)&&this.updateBoxSize()}return Cc.prototype.css.call(this,v)}destroy(){lf(this.element,"mouseenter"),lf(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),Cc.prototype.destroy.call(this)}fillSetter(v,k){v&&(this.needsBox=!0),this.fill=v,this.boxAttr(k,v)}getBBox(v,k){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:D,height:V=0,translateX:H=0,translateY:Y=0,width:J=0}=this,ae=kn(this.paddingLeft,D),_e=k??(this.rotation||0),Me={width:J,height:V,x:H+this.bBox.x-ae,y:Y+this.bBox.y-D+this.baselineOffset};return _e&&(Me=this.getRotatedBox(Me,_e)),Me}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(v){this.heightSetting=v,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:kn(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&Fh(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(v,k){xu(v)?v!==this[k]&&(this[k]=v,this.updateTextPadding()):this[k]=void 0}rSetter(v,k){this.boxAttr(k,v)}strokeSetter(v,k){this.stroke=v,this.boxAttr(k,v)}"stroke-widthSetter"(v,k){v&&(this.needsBox=!0),this["stroke-width"]=v,this.boxAttr(k,v)}"text-alignSetter"(v){this.textAlign=this["text-align"]=v,this.updateTextPadding()}textSetter(v){v!==void 0&&this.text.attr({text:v}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let v,k=this.text,D={},V=this.padding,H=this.bBox=(!xu(this.widthSetting)||!xu(this.heightSetting)||this.textAlign)&&Fh(k.textStr)?k.getBBox(void 0,0):ic.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||H.height||0)+2*V;let Y=this.renderer.fontMetrics(k);if(this.baselineOffset=V+Math.min((this.text.firstLineMetrics||Y).b,H.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-Y.h)/2),this.needsBox&&!k.textPath){if(!this.box){let J=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();J.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),J.add(this)}D.x=v=this.getCrispAdjust(),D.y=(this.baseline?-this.baselineOffset:0)+v,D.width=Math.round(this.width),D.height=Math.round(this.height),this.box.attr(ao(D,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let v=this.text,k=v.styles.textAlign||this.textAlign;if(!v.textPath){this.updateBoxSize();let D=this.baseline?0:this.baselineOffset,V=(this.paddingLeft??this.padding)+Dl(k)*(this.widthSetting??this.bBox.width);(V!==v.x||D!==v.y)&&(v.attr({align:k,x:V}),D!==void 0&&v.attr("y",D)),v.x=V,v.y=D}}widthSetter(v){this.widthSetting=xu(v)?v:void 0,this.doUpdate=!0}getPaddedWidth(){let v=this.padding,k=kn(this.paddingLeft,v),D=kn(this.paddingRight,v);return(this.widthSetting||this.bBox.width||0)+k+D}xSetter(v){this.x=v,this.alignFactor&&(v-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(v),this.attr("translateX",this.xSetting)}ySetter(v){this.ySetting=this.y=Math.round(v),this.attr("translateY",this.ySetting)}}ic.emptyBBox={width:0,height:0,x:0,y:0},ic.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:wl,isNumber:Qa,pick:Zl}=pr;function $c(ve,v,k,D,V){let H=[];if(V){let Y=V.start||0,J=V.end||0,ae=Zl(V.r,k),_e=Zl(V.r,D||k),Me=2e-4/(V.borderRadius?1:Math.max(ae,1)),xe=Math.abs(J-Y-2*Math.PI)<Me;xe&&(Y=Math.PI/2,J=2.5*Math.PI-Me);let Pe=V.innerR,je=Zl(V.open,xe),Qe=Math.cos(Y),at=Math.sin(Y),nt=Math.cos(J),it=Math.sin(J),wt=Zl(V.longArc,J-Y-Math.PI<Me?0:1),kt=["A",ae,_e,0,wt,Zl(V.clockwise,1),ve+ae*nt,v+_e*it];kt.params={start:Y,end:J,cx:ve,cy:v},H.push(["M",ve+ae*Qe,v+_e*at],kt),wl(Pe)&&((kt=["A",Pe,Pe,0,wt,wl(V.clockwise)?1-V.clockwise:0,ve+Pe*Qe,v+Pe*at]).params={start:J,end:Y,cx:ve,cy:v},H.push(je?["M",ve+Pe*nt,v+Pe*it]:["L",ve+Pe*nt,v+Pe*it],kt)),je||H.push(["Z"])}return H}function vn(ve,v,k,D,V){return V!=null&&V.r?os(ve,v,k,D,V):[["M",ve,v],["L",ve+k,v],["L",ve+k,v+D],["L",ve,v+D],["Z"]]}function os(ve,v,k,D,V){let H=(V==null?void 0:V.r)||0;return[["M",ve+H,v],["L",ve+k-H,v],["A",H,H,0,0,1,ve+k,v+H],["L",ve+k,v+D-H],["A",H,H,0,0,1,ve+k-H,v+D],["L",ve+H,v+D],["A",H,H,0,0,1,ve,v+D-H],["L",ve,v+H],["A",H,H,0,0,1,ve+H,v],["Z"]]}let Zs={arc:$c,callout:function(ve,v,k,D,V){let H=Math.min((V==null?void 0:V.r)||0,k,D),Y=H+6,J=V==null?void 0:V.anchorX,ae=(V==null?void 0:V.anchorY)||0,_e=os(ve,v,k,D,{r:H});if(!Qa(J)||J<k&&J>0&&ae<D&&ae>0)return _e;if(ve+J>k-Y)if(ae>v+Y&&ae<v+D-Y)_e.splice(3,1,["L",ve+k,ae-6],["L",ve+k+6,ae],["L",ve+k,ae+6],["L",ve+k,v+D-H]);else if(J<k){let Me=ae<v+Y,xe=Me?v:v+D;_e.splice(Me?2:5,0,["L",J,ae],["L",ve+k-H,xe])}else _e.splice(3,1,["L",ve+k,D/2],["L",J,ae],["L",ve+k,D/2],["L",ve+k,v+D-H]);else if(ve+J<Y)if(ae>v+Y&&ae<v+D-Y)_e.splice(7,1,["L",ve,ae+6],["L",ve-6,ae],["L",ve,ae-6],["L",ve,v+H]);else if(J>0){let Me=ae<v+Y,xe=Me?v:v+D;_e.splice(Me?1:6,0,["L",J,ae],["L",ve+H,xe])}else _e.splice(7,1,["L",ve,D/2],["L",J,ae],["L",ve,D/2],["L",ve,v+H]);else ae>D&&J<k-Y?_e.splice(5,1,["L",J+6,v+D],["L",J,v+D+6],["L",J-6,v+D],["L",ve+H,v+D]):ae<0&&J>Y&&_e.splice(1,1,["L",J-6,v],["L",J,v-6],["L",J+6,v],["L",k-H,v]);return _e},circle:function(ve,v,k,D){return $c(ve+k/2,v+D/2,k/2,D/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(ve,v,k,D){return[["M",ve+k/2,v],["L",ve+k,v+D/2],["L",ve+k/2,v+D],["L",ve,v+D/2],["Z"]]},rect:vn,roundedRect:os,square:vn,triangle:function(ve,v,k,D){return[["M",ve+k/2,v],["L",ve+k,v+D],["L",ve,v+D],["Z"]]},"triangle-down":function(ve,v,k,D){return[["M",ve,v],["L",ve+k,v],["L",ve+k/2,v+D],["Z"]]}},{doc:zl,SVG_NS:bu,win:Ks}=Ye,{attr:xd,extend:ju,fireEvent:Hu,isString:Sl,objectEach:Ja,pick:Gu}=pr,zh=(ve,v)=>ve.substring(0,v)+"",Ch=class{constructor(ve){let v=ve.styles;this.renderer=ve.renderer,this.svgElement=ve,this.width=ve.textWidth,this.textLineHeight=v==null?void 0:v.lineHeight,this.textOutline=v==null?void 0:v.textOutline,this.ellipsis=(v==null?void 0:v.textOverflow)==="ellipsis",this.lineClamp=v==null?void 0:v.lineClamp,this.noWrap=(v==null?void 0:v.whiteSpace)==="nowrap"}buildSVG(){let ve=this.svgElement,v=ve.element,k=ve.renderer,D=Gu(ve.textStr,"").toString(),V=D.indexOf("<")!==-1,H=v.childNodes,Y=!ve.added&&k.box,J=[D,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,ve.getStyle("font-size"),ve.styles.lineClamp,this.width].join(",");if(J!==ve.textCache){ve.textCache=J,delete ve.actualWidth;for(let ae=H.length;ae--;)v.removeChild(H[ae]);if(V||this.ellipsis||this.width||ve.textPath||D.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(D))){if(D!==""){Y&&Y.appendChild(v);let ae=new rn(D);this.modifyTree(ae.nodes),ae.addToDOM(v),this.modifyDOM(),this.ellipsis&&(v.textContent||"").indexOf("")!==-1&&ve.attr("title",this.unescapeEntities(ve.textStr||"",["&lt;","&gt;"])),Y&&Y.removeChild(v)}}else v.appendChild(zl.createTextNode(this.unescapeEntities(D)));Sl(this.textOutline)&&ve.applyTextOutline&&ve.applyTextOutline(this.textOutline)}}modifyDOM(){let ve,v=this.svgElement,k=xd(v.element,"x");for(v.firstLineMetrics=void 0;(ve=v.element.firstChild)&&/^[\s\u200B]*$/.test(ve.textContent||" ");)v.element.removeChild(ve);[].forEach.call(v.element.querySelectorAll("tspan.highcharts-br"),(Y,J)=>{Y.nextSibling&&Y.previousSibling&&(J===0&&Y.previousSibling.nodeType===1&&(v.firstLineMetrics=v.renderer.fontMetrics(Y.previousSibling)),xd(Y,{dy:this.getLineHeight(Y.nextSibling),x:k}))});let D=this.width||0;if(!D)return;let V=(Y,J)=>{var at;let ae=Y.textContent||"",_e=ae.replace(/([^\^])-/g,"$1- ").split(" "),Me=!this.noWrap&&(_e.length>1||v.element.childNodes.length>1),xe=this.getLineHeight(J),Pe=Math.max(0,D-.8*xe),je=0,Qe=v.actualWidth;if(Me){let nt=[],it=[];for(;J.firstChild&&J.firstChild!==Y;)it.push(J.firstChild),J.removeChild(J.firstChild);for(;_e.length;)if(_e.length&&!this.noWrap&&je>0&&(nt.push(Y.textContent||""),Y.textContent=_e.join(" ").replace(/- /g,"-")),this.truncate(Y,void 0,_e,je===0&&Qe||0,D,Pe,(wt,kt)=>_e.slice(0,kt).join(" ").replace(/- /g,"-")),Qe=v.actualWidth,je++,this.lineClamp&&je>=this.lineClamp){_e.length&&(this.truncate(Y,Y.textContent||"",void 0,0,D,Pe,zh),Y.textContent=((at=Y.textContent)==null?void 0:at.replace("",""))+"");break}it.forEach(wt=>{J.insertBefore(wt,Y)}),nt.forEach(wt=>{J.insertBefore(zl.createTextNode(wt),Y);let kt=zl.createElementNS(bu,"tspan");kt.textContent="",xd(kt,{dy:xe,x:k}),J.insertBefore(kt,Y)})}else this.ellipsis&&ae&&this.truncate(Y,ae,void 0,0,D,Pe,zh)},H=Y=>{[].slice.call(Y.childNodes).forEach(J=>{J.nodeType===Ks.Node.TEXT_NODE?V(J,Y):(J.className.baseVal.indexOf("highcharts-br")!==-1&&(v.actualWidth=0),H(J))})};H(v.element)}getLineHeight(ve){let v=ve.nodeType===Ks.Node.TEXT_NODE?ve.parentElement:ve;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(v||this.svgElement.element).h}modifyTree(ve){let v=(k,D)=>{let{attributes:V={},children:H,style:Y={},tagName:J}=k,ae=this.renderer.styledMode;if(J==="b"||J==="strong"?ae?V.class="highcharts-strong":Y.fontWeight="bold":(J==="i"||J==="em")&&(ae?V.class="highcharts-emphasized":Y.fontStyle="italic"),Y!=null&&Y.color&&(Y.fill=Y.color),J==="br"){V.class="highcharts-br",k.textContent="";let _e=ve[D+1];_e!=null&&_e.textContent&&(_e.textContent=_e.textContent.replace(/^ +/gm,""))}else J==="a"&&H&&H.some(_e=>_e.tagName==="#text")&&(k.children=[{children:H,tagName:"tspan"}]);J!=="#text"&&J!=="a"&&(k.tagName="tspan"),ju(k,{attributes:V,style:Y}),H&&H.filter(_e=>_e.tagName!=="#text").forEach(v)};ve.forEach(v),Hu(this.svgElement,"afterModifyTree",{nodes:ve})}truncate(ve,v,k,D,V,H,Y){let J,ae,_e=this.svgElement,{rotation:Me}=_e,xe=[],Pe=k&&!D?1:0,je=(v||k||"").length,Qe=je;k||(V=H);let at=function(nt,it){let wt=it||nt,kt=ve.parentNode;if(kt&&xe[wt]===void 0&&kt.getSubStringLength)try{xe[wt]=D+kt.getSubStringLength(0,k?wt+1:wt)}catch{}return xe[wt]};if(_e.rotation=0,D+(ae=at(ve.textContent.length))>V){for(;Pe<=je;)Qe=Math.ceil((Pe+je)/2),k&&(J=Y(k,Qe)),ae=at(Qe,J&&J.length-1),Pe===je?Pe=je+1:ae>V?je=Qe-1:Pe=Qe;je===0?ve.textContent="":v&&je===v.length-1||(ve.textContent=J||Y(v||k,Qe)),this.ellipsis&&ae>V&&this.truncate(ve,ve.textContent||"",void 0,0,V,H,zh)}k&&k.splice(0,Qe),_e.actualWidth=ae,_e.rotation=Me}unescapeEntities(ve,v){return Ja(this.renderer.escapes,function(k,D){v&&v.indexOf(k)!==-1||(ve=ve.toString().replace(RegExp(k,"g"),D))}),ve}},{defaultOptions:hh}=$o,{charts:vt,deg2rad:Yt,doc:Di,isFirefox:yi,isMS:bi,isWebKit:Li,noop:Tr,SVG_NS:Bi,symbolSizes:Gt,win:qr}=Ye,{addEvent:sr,attr:Qi,createElement:sn,crisp:hi,css:Pn,defined:as,destroyObjectProperties:Yo,extend:Qn,isArray:ro,isNumber:Ao,isObject:el,isString:Mo,merge:Fs,pick:Jo,pInt:ea,replaceNested:So,uniqueKey:Ua}=pr;class Ul{constructor(v,k,D,V,H,Y,J){let ae,_e;this.x=0,this.y=0;let Me=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),xe=Me.element;J||Me.css(this.getStyle(V||{})),v.appendChild(xe),Qi(v,"dir","ltr"),v.innerHTML.indexOf("xmlns")===-1&&Qi(xe,"xmlns",this.SVG_NS),this.box=xe,this.boxWrapper=Me,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Di.createTextNode("Created with Highcharts 12.3.0")),this.defs=this.createElement("defs").add(),this.allowHTML=Y,this.forExport=H,this.styledMode=J,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=Me.getStyle("font-size"),this.setSize(k,D,!1),yi&&v.getBoundingClientRect&&((ae=function(){Pn(v,{left:0,top:0}),_e=v.getBoundingClientRect(),Pn(v,{left:Math.ceil(_e.left)-_e.left+"px",top:Math.ceil(_e.top)-_e.top+"px"})})(),this.unSubPixelFix=sr(qr,"resize",ae))}definition(v){return new rn([v]).addToDOM(this.defs.element)}getReferenceURL(){if((yi||Li)&&Di.getElementsByTagName("base").length){if(!as(s)){let v=Ua(),k=new rn([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:v},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${v})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Di.body);Pn(k,{position:"fixed",top:0,left:0,zIndex:9e5});let D=Di.elementFromPoint(6,6);s=(D==null?void 0:D.id)==="hitme",Di.body.removeChild(k)}if(s)return So(qr.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(v){return this.style=Qn({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},v),this.style}setStyle(v){this.boxWrapper.css(this.getStyle(v))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let v=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),Yo(this.gradients||{}),this.gradients=null,this.defs=v.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(v){return new this.Element(this,v)}getRadialAttr(v,k){return{cx:v[0]-v[2]/2+(k.cx||0)*v[2],cy:v[1]-v[2]/2+(k.cy||0)*v[2],r:(k.r||0)*v[2]}}shadowDefinition(v){let k=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(v).map(V=>`${V}-${v[V]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),D=Fs({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},v);return this.defs.element.querySelector(`#${k}`)||this.definition({tagName:"filter",attributes:{id:k,filterUnits:D.filterUnits},children:this.getShadowFilterContent(D)}),k}getShadowFilterContent(v){return[{tagName:"feDropShadow",attributes:{dx:v.offsetX,dy:v.offsetY,"flood-color":v.color,"flood-opacity":Math.min(5*v.opacity,1),stdDeviation:v.width/2}}]}buildText(v){new Ch(v).buildSVG()}getContrast(v){if(v==="transparent")return"#000000";let k=Un.parse(v).rgba,D=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(Ao(k[0])||!Un.useColorMix){let V=k.map(Y=>{let J=Y/255;return J<=.04?J/12.92:Math.pow((J+.055)/1.055,2.4)}),H=.2126*V[0]+.7152*V[1]+.0722*V[2];return 1.05/(H+.05)>(H+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+v+" srgb"+D+D+D+")"}button(v,k,D,V,H={},Y,J,ae,_e,Me){let xe=this.label(v,k,D,_e,void 0,void 0,Me,void 0,"button"),Pe=this.styledMode,je=arguments,Qe=0;H=Fs(hh.global.buttonTheme,H),Pe&&(delete H.fill,delete H.stroke,delete H["stroke-width"]);let at=H.states||{},nt=H.style||{};delete H.states,delete H.style;let it=[rn.filterUserAttributes(H)],wt=[nt];return Pe||["hover","select","disabled"].forEach((kt,Ai)=>{it.push(Fs(it[0],rn.filterUserAttributes(je[Ai+5]||at[kt]||{}))),wt.push(it[Ai+1].style),delete it[Ai+1].style}),sr(xe.element,bi?"mouseover":"mouseenter",function(){Qe!==3&&xe.setState(1)}),sr(xe.element,bi?"mouseout":"mouseleave",function(){Qe!==3&&xe.setState(Qe)}),xe.setState=(kt=0)=>{if(kt!==1&&(xe.state=Qe=kt),xe.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][kt]),!Pe){xe.attr(it[kt]);let Ai=wt[kt];el(Ai)&&xe.css(Ai)}},xe.attr(it[0]),!Pe&&(xe.css(Qn({cursor:"default"},nt)),Me&&xe.text.css({pointerEvents:"none"})),xe.on("touchstart",kt=>kt.stopPropagation()).on("click",function(kt){Qe!==3&&(V==null||V.call(xe,kt))})}crispLine(v,k){let[D,V]=v;return as(D[1])&&D[1]===V[1]&&(D[1]=V[1]=hi(D[1],k)),as(D[2])&&D[2]===V[2]&&(D[2]=V[2]=hi(D[2],k)),v}path(v){let k=this.styledMode?{}:{fill:"none"};return ro(v)?k.d=v:el(v)&&Qn(k,v),this.createElement("path").attr(k)}circle(v,k,D){let V=el(v)?v:v===void 0?{}:{x:v,y:k,r:D},H=this.createElement("circle");return H.xSetter=H.ySetter=function(Y,J,ae){ae.setAttribute("c"+J,Y)},H.attr(V)}arc(v,k,D,V,H,Y){let J;el(v)?(k=(J=v).y,D=J.r,V=J.innerR,H=J.start,Y=J.end,v=J.x):J={innerR:V,start:H,end:Y};let ae=this.symbol("arc",v,k,D,D,J);return ae.r=D,ae}rect(v,k,D,V,H,Y){let J=el(v)?v:v===void 0?{}:{x:v,y:k,r:H,width:Math.max(D||0,0),height:Math.max(V||0,0)},ae=this.createElement("rect");return this.styledMode||(Y!==void 0&&(J["stroke-width"]=Y,Qn(J,ae.crisp(J))),J.fill="none"),ae.rSetter=function(_e,Me,xe){ae.r=_e,Qi(xe,{rx:_e,ry:_e})},ae.rGetter=function(){return ae.r||0},ae.attr(J)}roundedRect(v){return this.symbol("roundedRect").attr(v)}setSize(v,k,D){this.width=v,this.height=k,this.boxWrapper.animate({width:v,height:k},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Jo(D,!0)?void 0:0}),this.alignElements()}g(v){let k=this.createElement("g");return v?k.attr({class:"highcharts-"+v}):k}image(v,k,D,V,H,Y){let J={preserveAspectRatio:"none"};Ao(k)&&(J.x=k),Ao(D)&&(J.y=D),Ao(V)&&(J.width=V),Ao(H)&&(J.height=H);let ae=this.createElement("image").attr(J),_e=function(Me){ae.attr({href:v}),Y.call(ae,Me)};if(Y){ae.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let Me=new qr.Image;sr(Me,"load",_e),Me.src=v,Me.complete&&_e({})}else ae.attr({href:v});return ae}symbol(v,k,D,V,H,Y){var nt,it;let J,ae,_e,Me,xe=this,Pe=/^url\((.*?)\)$/,je=Pe.test(v),Qe=!je&&(this.symbols[v]?v:"circle"),at=Qe&&this.symbols[Qe];if(at)typeof k=="number"&&(ae=at.call(this.symbols,k||0,D||0,V||0,H||0,Y)),J=this.path(ae),xe.styledMode||J.attr("fill","none"),Qn(J,{symbolName:Qe||void 0,x:k,y:D,width:V,height:H}),Y&&Qn(J,Y);else if(je){_e=v.match(Pe)[1];let wt=J=this.image(_e);wt.imgwidth=Jo(Y==null?void 0:Y.width,(nt=Gt[_e])==null?void 0:nt.width),wt.imgheight=Jo(Y==null?void 0:Y.height,(it=Gt[_e])==null?void 0:it.height),Me=kt=>kt.attr({width:kt.width,height:kt.height}),["width","height"].forEach(kt=>{wt[`${kt}Setter`]=function(Ai,ki){this[ki]=Ai;let{alignByTranslate:Ri,element:Sr,width:hr,height:wr,imgwidth:Jr,imgheight:yn}=this,Rn=ki==="width"?Jr:yn,fn=1;Y&&Y.backgroundSize==="within"&&hr&&wr&&Jr&&yn?(fn=Math.min(hr/Jr,wr/yn),Qi(Sr,{width:Math.round(Jr*fn),height:Math.round(yn*fn)})):Sr&&Rn&&Sr.setAttribute(ki,Rn),!Ri&&Jr&&yn&&this.translate(((hr||0)-Jr*fn)/2,((wr||0)-yn*fn)/2)}}),as(k)&&wt.attr({x:k,y:D}),wt.isImg=!0,wt.symbolUrl=v,as(wt.imgwidth)&&as(wt.imgheight)?Me(wt):(wt.attr({width:0,height:0}),sn("img",{onload:function(){let kt=vt[xe.chartIndex];this.width===0&&(Pn(this,{position:"absolute",top:"-999em"}),Di.body.appendChild(this)),Gt[_e]={width:this.width,height:this.height},wt.imgwidth=this.width,wt.imgheight=this.height,wt.element&&Me(wt),this.parentNode&&this.parentNode.removeChild(this),xe.imgCount--,xe.imgCount||!kt||kt.hasLoaded||kt.onload()},src:_e}),this.imgCount++)}return J}clipRect(v,k,D,V){return this.rect(v,k,D,V,0)}text(v,k,D,V){let H={};if(V&&(this.allowHTML||!this.forExport))return this.html(v,k,D);H.x=Math.round(k||0),D&&(H.y=Math.round(D)),as(v)&&(H.text=v);let Y=this.createElement("text").attr(H);return V&&(!this.forExport||this.allowHTML)||(Y.xSetter=function(J,ae,_e){let Me=_e.getElementsByTagName("tspan"),xe=_e.getAttribute(ae);for(let Pe=0,je;Pe<Me.length;Pe++)(je=Me[Pe]).getAttribute(ae)===xe&&je.setAttribute(ae,J);_e.setAttribute(ae,J)}),Y}fontMetrics(v){let k=ea(Cc.prototype.getStyle.call(v,"font-size")||0),D=k<24?k+3:Math.round(1.2*k),V=Math.round(.8*D);return{h:D,b:V,f:k}}rotCorr(v,k,D){let V=v;return k&&D&&(V=Math.max(V*Math.cos(k*Yt),4)),{x:-v/3*Math.sin(k*Yt),y:V}}pathToSegments(v){let k=[],D=[],V={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let H=0;H<v.length;H++)Mo(D[0])&&Ao(v[H])&&D.length===V[D[0].toUpperCase()]&&v.splice(H,0,D[0].replace("M","L").replace("m","l")),typeof v[H]=="string"&&(D.length&&k.push(D.slice(0)),D.length=0),D.push(v[H]);return k.push(D.slice(0)),k}label(v,k,D,V,H,Y,J,ae,_e){return new ic(this,v,k,D,V,H,Y,J,ae,_e)}alignElements(){this.alignedObjects.forEach(v=>v.align())}}Qn(Ul.prototype,{Element:Cc,SVG_NS:Bi,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Zs,draw:Tr}),Uc.registerRendererType("svg",Ul,!0);let{composed:$l,isFirefox:$a}=Ye,{attr:Vl,css:dl,createElement:uh,defined:rc,extend:Dc,getAlignFactor:Pc,isNumber:Zc,pInt:or,pushUnique:Kr}=pr;function Ur(ve,v,k){var V;let D=(V=this.div)==null?void 0:V.style;Cc.prototype[`${v}Setter`].call(this,ve,v,k),D&&(k.style[v]=D[v]=ve)}let Kn=(ve,v)=>{var k;if(!ve.div){let D=Vl(ve.element,"class"),V=ve.css,H=uh("div",D?{className:D}:void 0,{position:"absolute",left:`${ve.translateX||0}px`,top:`${ve.translateY||0}px`,...ve.styles,display:ve.display,opacity:ve.opacity,visibility:ve.visibility},((k=ve.parentGroup)==null?void 0:k.div)||v);ve.classSetter=(Y,J,ae)=>{ae.setAttribute("class",Y),H.className=Y},ve.translateXSetter=ve.translateYSetter=(Y,J)=>{ve[J]=Y,H.style[J==="translateX"?"left":"top"]=`${Y}px`,ve.doTransform=!0},ve.scaleXSetter=ve.scaleYSetter=(Y,J)=>{ve[J]=Y,ve.doTransform=!0},ve.opacitySetter=ve.visibilitySetter=Ur,ve.css=Y=>(V.call(ve,Y),Y.cursor&&(H.style.cursor=Y.cursor),Y.pointerEvents&&(H.style.pointerEvents=Y.pointerEvents),ve),ve.on=function(){return Cc.prototype.on.apply({element:H,onEvents:ve.onEvents},arguments),ve},ve.div=H}return ve.div};class As extends Cc{static compose(v){Kr($l,this.compose)&&(v.prototype.html=function(k,D,V){return new As(this,"span").attr({text:k,x:Math.round(D),y:Math.round(V)})})}constructor(v,k){super(v,k),As.useForeignObject?this.foreignObject=v.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...v.styledMode?{}:{fontFamily:v.style.fontFamily,fontSize:v.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(v,k,D){this.xCorr=-v*D,this.yCorr=-k}css(v){let k,{element:D}=this,V=D.tagName==="SPAN"&&v&&"width"in v,H=V&&v.width;return V&&(delete v.width,this.textWidth=or(H)||void 0,k=!0),(v==null?void 0:v.textOverflow)==="ellipsis"&&(v.overflow="hidden",v.whiteSpace="nowrap"),v!=null&&v.lineClamp&&(v.display="-webkit-box",v.WebkitLineClamp=v.lineClamp,v.WebkitBoxOrient="vertical",v.overflow="hidden"),Zc(Number(v==null?void 0:v.fontSize))&&(v.fontSize+="px"),Dc(this.styles,v),dl(D,v),k&&this.updateTransform(),this}htmlGetBBox(){let{element:v}=this;return{x:v.offsetLeft,y:v.offsetTop,width:v.offsetWidth,height:v.offsetHeight}}updateTransform(){var wt;if(!this.added){this.alignOnAdd=!0;return}let{element:v,foreignObject:k,oldTextWidth:D,renderer:V,rotation:H,rotationOriginX:Y,rotationOriginY:J,scaleX:ae,scaleY:_e,styles:{display:Me="inline-block",whiteSpace:xe},textAlign:Pe="left",textWidth:je,translateX:Qe=0,translateY:at=0,x:nt=0,y:it=0}=this;if(k||dl(v,{marginLeft:`${Qe}px`,marginTop:`${at}px`}),v.tagName==="SPAN"){let kt,Ai=[H,Pe,v.innerHTML,je,this.textAlign].join(","),ki=-(((wt=this.parentGroup)==null?void 0:wt.padding)*1)||0;if(je!==D){let wr=this.textPxLength?this.textPxLength:(dl(v,{width:"",whiteSpace:xe||"nowrap"}),v.offsetWidth),Jr=je||0,yn=v.style.textOverflow===""&&v.style.webkitLineClamp;(Jr>D||wr>Jr||yn)&&(/[\-\s\u00AD]/.test(v.textContent||v.innerText)||v.style.textOverflow==="ellipsis")&&(dl(v,{width:(H||ae||wr>Jr||yn)&&Zc(je)?je+"px":"auto",display:Me,whiteSpace:xe||"normal"}),this.oldTextWidth=je)}k&&(dl(v,{display:"inline-block",verticalAlign:"top"}),k.attr({width:V.width,height:V.height})),Ai!==this.cTT&&(kt=V.fontMetrics(v).b,rc(H)&&!k&&(H!==(this.oldRotation||0)||Pe!==this.oldAlign)&&dl(v,{transform:`rotate(${H}deg)`,transformOrigin:`${ki}% ${ki}px`}),this.getSpanCorrection(!rc(H)&&!this.textWidth&&this.textPxLength||v.offsetWidth,kt,Pc(Pe)));let{xCorr:Ri=0,yCorr:Sr=0}=this,hr={left:`${nt+Ri}px`,top:`${it+Sr}px`,textAlign:Pe,transformOrigin:`${(Y??nt)-Ri-nt-ki}px ${(J??it)-Sr-it-ki}px`};(ae||_e)&&(hr.transform=`scale(${ae??1},${_e??1})`),k?(super.updateTransform(),Zc(nt)&&Zc(it)?(k.attr({x:nt+Ri,y:it+Sr,width:v.offsetWidth+3,height:v.offsetHeight,"transform-origin":v.getAttribute("transform-origin")||"0 0"}),dl(v,{display:Me,textAlign:Pe})):$a&&k.attr({width:0,height:0})):dl(v,hr),this.cTT=Ai,this.oldRotation=H,this.oldAlign=Pe}}add(v){let{foreignObject:k,renderer:D}=this,V=D.box.parentNode,H=[];if(k)k.add(v),super.add(D.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(k));else{let Y;if(this.parentGroup=v,v&&!(Y=v.div)){let J=v;for(;J;)H.push(J),J=J.parentGroup;for(let ae of H.reverse())Y=Kn(ae,V)}(Y||V).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(v){v!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,rn.setElementHTML(this.element,v??""),this.textStr=v,this.doTransform=!0)}alignSetter(v){this.alignValue=this.textAlign=v,this.doTransform=!0}xSetter(v,k){this[k]=v,this.doTransform=!0}}let Xo=As.prototype;Xo.visibilitySetter=Xo.opacitySetter=Ur,Xo.ySetter=Xo.rotationSetter=Xo.rotationOriginXSetter=Xo.rotationOriginYSetter=Xo.xSetter,function(ve){ve.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},ve.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:v}=this.axis.chart;return v(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(i||(i={}));let pl=i,{addEvent:Fn,isFunction:fs,objectEach:In,removeEvent:Ms}=pr;(S||(S={})).registerEventOptions=function(ve,v){ve.eventOptions=ve.eventOptions||{},In(v.events,function(k,D){ve.eventOptions[D]!==k&&(ve.eventOptions[D]&&(Ms(ve,D,ve.eventOptions[D]),delete ve.eventOptions[D]),fs(k)&&(ve.eventOptions[D]=k,Fn(ve,D,k,{order:0})))})};let ho=S,{deg2rad:na}=Ye,{clamp:ta,correctFloat:Oo,defined:Io,destroyObjectProperties:To,extend:fl,fireEvent:rl,getAlignFactor:mr,isNumber:Tl,merge:Vo,objectEach:Kc,pick:uc}=pr,dc=class{constructor(ve,v,k,D,V){this.isNew=!0,this.isNewLabel=!0,this.axis=ve,this.pos=v,this.type=k||"",this.parameters=V||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,rl(this,"init"),k||D||this.addLabel()}addLabel(){var Sr,hr;let ve=this,v=ve.axis,k=v.options,D=v.chart,V=v.categories,H=v.logarithmic,Y=v.names,J=ve.pos,ae=uc((Sr=ve.options)==null?void 0:Sr.labels,k.labels),_e=v.tickPositions,Me=J===_e[0],xe=J===_e[_e.length-1],Pe=(!ae.step||ae.step===1)&&v.tickInterval===1,je=_e.info,Qe=ve.label,at,nt,it,wt=this.parameters.category||(V?uc(V[J],Y[J],J):J);H&&Tl(wt)&&(wt=Oo(H.lin2log(wt))),v.dateTime&&(je?at=(nt=D.time.resolveDTLFormat(k.dateTimeLabelFormats[!((hr=k.grid)!=null&&hr.enabled)&&je.higherRanks[J]||je.unitName])).main:Tl(wt)&&(at=v.dateTime.getXDateFormat(wt,k.dateTimeLabelFormats||{}))),ve.isFirst=Me,ve.isLast=xe;let kt={axis:v,chart:D,dateTimeLabelFormat:at,isFirst:Me,isLast:xe,pos:J,tick:ve,tickPositionInfo:je,value:wt};rl(this,"labelFormat",kt);let Ai=wr=>ae.formatter?ae.formatter.call(wr,wr):ae.format?(wr.text=v.defaultLabelFormatter.call(wr),ul.format(ae.format,wr,D)):v.defaultLabelFormatter.call(wr),ki=Ai.call(kt,kt),Ri=nt==null?void 0:nt.list;Ri?ve.shortenLabel=function(){for(it=0;it<Ri.length;it++)if(fl(kt,{dateTimeLabelFormat:Ri[it]}),Qe.attr({text:Ai.call(kt,kt)}),Qe.getBBox().width<v.getSlotWidth(ve)-2*(ae.padding||0))return;Qe.attr({text:""})}:ve.shortenLabel=void 0,Pe&&v._addedPlotLB&&ve.moveLabel(ki,ae),Io(Qe)||ve.movedLabel?Qe&&Qe.textStr!==ki&&!Pe&&(!Qe.textWidth||ae.style.width||Qe.styles.width||Qe.css({width:null}),Qe.attr({text:ki}),Qe.textPxLength=Qe.getBBox().width):(ve.label=Qe=ve.createLabel(ki,ae),ve.rotation=0)}createLabel(ve,v,k){let D=this.axis,{renderer:V,styledMode:H}=D.chart,Y=v.style.whiteSpace,J=Io(ve)&&v.enabled?V.text(ve,k==null?void 0:k.x,k==null?void 0:k.y,v.useHTML).add(D.labelGroup):void 0;return J&&(H||J.css(Vo(v.style)),J.textPxLength=J.getBBox().width,!H&&Y&&J.css({whiteSpace:Y})),J}destroy(){To(this,this.axis)}getPosition(ve,v,k,D){let V=this.axis,H=V.chart,Y=D&&H.oldChartHeight||H.chartHeight,J={x:ve?Oo(V.translate(v+k,void 0,void 0,D)+V.transB):V.left+V.offset+(V.opposite?(D&&H.oldChartWidth||H.chartWidth)-V.right-V.left:0),y:ve?Y-V.bottom+V.offset-(V.opposite?V.height:0):Oo(Y-V.translate(v+k,void 0,void 0,D)-V.transB)};return J.y=ta(J.y,-1e9,1e9),rl(this,"afterGetPosition",{pos:J}),J}getLabelPosition(ve,v,k,D,V,H,Y,J){let ae,_e,Me=this.axis,xe=Me.transA,Pe=Me.isLinked&&Me.linkedParent?Me.linkedParent.reversed:Me.reversed,je=Me.staggerLines,Qe=Me.tickRotCorr||{x:0,y:0},at=D||Me.reserveSpaceDefault?0:-Me.labelOffset*(Me.labelAlign==="center"?.5:1),nt=V.distance,it={};return ae=Me.side===0?k.rotation?-nt:-k.getBBox().height:Me.side===2?Qe.y+nt:Math.cos(k.rotation*na)*(Qe.y-k.getBBox(!1,0).height/2),Io(V.y)&&(ae=Me.side===0&&Me.horiz?V.y+ae:V.y),ve=ve+uc(V.x,[0,1,0,-1][Me.side]*nt)+at+Qe.x-(H&&D?H*xe*(Pe?-1:1):0),v=v+ae-(H&&!D?H*xe*(Pe?1:-1):0),je&&(_e=Y/(J||1)%je,Me.opposite&&(_e=je-_e-1),v+=_e*(Me.labelOffset/je)),it.x=ve,it.y=Math.round(v),rl(this,"afterGetLabelPosition",{pos:it,tickmarkOffset:H,index:Y}),it}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(ve,v,k,D,V=!1,H){return H.crispLine([["M",ve,v],["L",ve+(V?0:-k),v+(V?k:0)]],D)}handleOverflow(ve){var nt;let v=this.axis,k=v.options.labels,D=ve.x,V=v.chart.chartWidth,H=v.chart.spacing,Y=uc(v.labelLeft,Math.min(v.pos,H[3])),J=uc(v.labelRight,Math.max(v.isRadial?0:v.pos+v.len,V-H[1])),ae=this.label,_e=this.rotation,Me=mr(v.labelAlign||ae.attr("align")),xe=ae.getBBox().width,Pe=v.getSlotWidth(this),je=Pe,Qe=1,at;_e||k.overflow!=="justify"?_e<0&&D-Me*xe<Y?at=Math.round(D/Math.cos(_e*na)-Y):_e>0&&D+Me*xe>J&&(at=Math.round((V-D)/Math.cos(_e*na))):(D-Me*xe<Y?je=ve.x+je*(1-Me)-Y:D+(1-Me)*xe>J&&(je=J-ve.x+je*Me,Qe=-1),(je=Math.min(Pe,je))<Pe&&v.labelAlign==="center"&&(ve.x+=Qe*(Pe-je-Me*(Pe-Math.min(xe,je)))),(xe>je||v.autoRotation&&((nt=ae==null?void 0:ae.styles)!=null&&nt.width))&&(at=je)),at&&ae&&(this.shortenLabel?this.shortenLabel():ae.css(fl({},{width:Math.floor(at)+"px",lineClamp:+!v.isRadial})))}moveLabel(ve,v){let k=this,D=k.label,V=k.axis,H=!1,Y;D&&D.textStr===ve?(k.movedLabel=D,H=!0,delete k.label):Kc(V.ticks,function(J){H||J.isNew||J===k||!J.label||J.label.textStr!==ve||(k.movedLabel=J.label,H=!0,J.labelPos=k.movedLabel.xy,delete J.label)}),!H&&(k.labelPos||D)&&(Y=k.labelPos||D.xy,k.movedLabel=k.createLabel(ve,v,Y),k.movedLabel&&k.movedLabel.attr({opacity:0}))}render(ve,v,k){var Qe;let D=this.axis,V=D.horiz,H=this.pos,Y=uc(this.tickmarkOffset,D.tickmarkOffset),J=this.getPosition(V,H,Y,v),ae=J.x,_e=J.y,Me=D.pos,xe=Me+D.len,Pe=V?ae:_e,je=uc(k,(Qe=this.label)==null?void 0:Qe.newOpacity,1);!D.chart.polar&&(Oo(Pe)<Me||Pe>xe)&&(k=0),k??(k=1),this.isActive=!0,this.renderGridLine(v,k),this.renderMark(J,k),this.renderLabel(J,v,je,ve),this.isNew=!1,rl(this,"afterRender")}renderGridLine(ve,v){let k=this.axis,D=k.options,V={},H=this.pos,Y=this.type,J=uc(this.tickmarkOffset,k.tickmarkOffset),ae=k.chart.renderer,_e=this.gridLine,Me,xe=D.gridLineWidth,Pe=D.gridLineColor,je=D.gridLineDashStyle;this.type==="minor"&&(xe=D.minorGridLineWidth,Pe=D.minorGridLineColor,je=D.minorGridLineDashStyle),_e||(k.chart.styledMode||(V.stroke=Pe,V["stroke-width"]=xe||0,V.dashstyle=je),Y||(V.zIndex=1),ve&&(v=0),this.gridLine=_e=ae.path().attr(V).addClass("highcharts-"+(Y?Y+"-":"")+"grid-line").add(k.gridGroup)),_e&&(Me=k.getPlotLinePath({value:H+J,lineWidth:_e.strokeWidth(),force:"pass",old:ve,acrossPanes:!1}))&&_e[ve||this.isNew?"attr":"animate"]({d:Me,opacity:v})}renderMark(ve,v){let k=this.axis,D=k.options,V=k.chart.renderer,H=this.type,Y=k.tickSize(H?H+"Tick":"tick"),J=ve.x,ae=ve.y,_e=uc(D[H!=="minor"?"tickWidth":"minorTickWidth"],!H&&k.isXAxis?1:0),Me=D[H!=="minor"?"tickColor":"minorTickColor"],xe=this.mark,Pe=!xe;Y&&(k.opposite&&(Y[0]=-Y[0]),!xe&&(this.mark=xe=V.path().addClass("highcharts-"+(H?H+"-":"")+"tick").add(k.axisGroup),k.chart.styledMode||xe.attr({stroke:Me,"stroke-width":_e})),xe[Pe?"attr":"animate"]({d:this.getMarkPath(J,ae,Y[0],xe.strokeWidth(),k.horiz,V),opacity:v}))}renderLabel(ve,v,k,D){let V=this.axis,H=V.horiz,Y=V.options,J=this.label,ae=Y.labels,_e=ae.step,Me=uc(this.tickmarkOffset,V.tickmarkOffset),xe=ve.x,Pe=ve.y,je=!0;J&&Tl(xe)&&(J.xy=ve=this.getLabelPosition(xe,Pe,J,H,ae,Me,D,_e),(!this.isFirst||this.isLast||Y.showFirstLabel)&&(!this.isLast||this.isFirst||Y.showLastLabel)?!H||ae.step||ae.rotation||v||k===0||this.handleOverflow(ve):je=!1,_e&&D%_e&&(je=!1),je&&Tl(ve.y)?(ve.opacity=k,J[this.isNewLabel?"attr":"animate"](ve).show(!0),this.isNewLabel=!1):(J.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let ve=this.label,v=this.axis;ve&&!this.isNew&&(ve.animate({opacity:0},void 0,ve.destroy),delete this.label),v.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:Qc}=Or,{xAxis:bd,yAxis:Jc}=pl,{defaultOptions:ws}=$o,{registerEventOptions:qu}=ho,{deg2rad:Pp}=Ye,{arrayMax:ga,arrayMin:cf,clamp:Eh,correctFloat:uo,defined:Wl,destroyObjectProperties:Kg,erase:k0,error:hf,extend:Wf,fireEvent:pc,getClosestDistance:Qg,insertItem:A0,isArray:jf,isNumber:Es,isString:Ro,merge:eh,normalizeTickInterval:gg,objectEach:uf,pick:fo,relativeLength:ml,removeEvent:Hf,splat:df,syncTimeout:Op}=pr,zs=(ve,v)=>gg(v,void 0,void 0,fo(ve.options.allowDecimals,v<.5||ve.tickAmount!==void 0),!!ve.tickAmount);Wf(ws,{xAxis:bd,yAxis:eh(bd,Jc)});class Yu{constructor(v,k,D){this.init(v,k,D)}init(v,k,D=this.coll){let V=D==="xAxis",H=this.isZAxis||(v.inverted?!V:V);this.chart=v,this.horiz=H,this.isXAxis=V,this.coll=D,pc(this,"init",{userOptions:k}),this.opposite=fo(k.opposite,this.opposite),this.side=fo(k.side,this.side,H?2*!this.opposite:this.opposite?1:3),this.setOptions(k);let Y=this.options,J=Y.labels;this.type??(this.type=Y.type||"linear"),this.uniqueNames??(this.uniqueNames=Y.uniqueNames??!0),pc(this,"afterSetType"),this.userOptions=k,this.minPixelPadding=0,this.reversed=fo(Y.reversed,this.reversed),this.visible=Y.visible,this.zoomEnabled=Y.zoomEnabled,this.hasNames=this.type==="category"||Y.categories===!0,this.categories=jf(Y.categories)&&Y.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=Wl(Y.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=Y.minRange||Y.maxZoom,this.range=Y.range,this.offset=Y.offset||0,this.max=void 0,this.min=void 0;let ae=fo(Y.crosshair,df(v.options.tooltip.crosshairs)[+!V]);this.crosshair=ae===!0?{}:ae,v.axes.indexOf(this)===-1&&(V?v.axes.splice(v.xAxis.length,0,this):v.axes.push(this),A0(this,v[this.coll])),v.orderItems(this.coll),this.series=this.series||[],v.inverted&&!this.isZAxis&&V&&!Wl(this.reversed)&&(this.reversed=!0),this.labelRotation=Es(J.rotation)?J.rotation:void 0,qu(this,Y),pc(this,"afterInit")}setOptions(v){let k=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=eh(k,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},ws[this.coll],v),pc(this,"afterSetOptions",{userOptions:v})}defaultLabelFormatter(){let v=this.axis,{numberFormatter:k}=this.chart,D=Es(this.value)?this.value:NaN,V=v.chart.time,H=v.categories,Y=this.dateTimeLabelFormat,J=ws.lang,ae=J.numericSymbols,_e=J.numericSymbolMagnitude||1e3,Me=v.logarithmic?Math.abs(D):v.tickInterval,xe=ae==null?void 0:ae.length,Pe,je;if(H)je=`${this.value}`;else if(Y)je=V.dateFormat(Y,D,!0);else if(xe&&ae&&Me>=1e3)for(;xe--&&je===void 0;)Me>=(Pe=Math.pow(_e,xe+1))&&10*D%Pe==0&&ae[xe]!==null&&D!==0&&(je=k(D/Pe,-1)+ae[xe]);return je===void 0&&(je=Math.abs(D)>=1e4?k(D,-1):k(D,-1,void 0,"")),je}getSeriesExtremes(){let v,k=this;pc(this,"getSeriesExtremes",null,function(){k.hasVisibleSeries=!1,k.dataMin=k.dataMax=k.threshold=void 0,k.softThreshold=!k.isXAxis,k.series.forEach(D=>{if(D.reserveSpace()){let V=D.options,H,Y=V.threshold,J,ae;if(k.hasVisibleSeries=!0,k.positiveValuesOnly&&0>=(Y||0)&&(Y=void 0),k.isXAxis)(H=D.getColumn("x")).length&&(H=k.logarithmic?H.filter(_e=>_e>0):H,J=(v=D.getXExtremes(H)).min,ae=v.max,Es(J)||J instanceof Date||(H=H.filter(Es),J=(v=D.getXExtremes(H)).min,ae=v.max),H.length&&(k.dataMin=Math.min(fo(k.dataMin,J),J),k.dataMax=Math.max(fo(k.dataMax,ae),ae)));else{let _e=D.applyExtremes();Es(_e.dataMin)&&(J=_e.dataMin,k.dataMin=Math.min(fo(k.dataMin,J),J)),Es(_e.dataMax)&&(ae=_e.dataMax,k.dataMax=Math.max(fo(k.dataMax,ae),ae)),Wl(Y)&&(k.threshold=Y),(!V.softThreshold||k.positiveValuesOnly)&&(k.softThreshold=!1)}}})}),pc(this,"afterGetSeriesExtremes")}translate(v,k,D,V,H,Y){var at;let J=this.linkedParent||this,ae=V&&J.old?J.old.min:J.min;if(!Es(ae))return NaN;let _e=J.minPixelPadding,Me=(J.isOrdinal||((at=J.brokenAxis)==null?void 0:at.hasBreaks)||J.logarithmic&&H)&&J.lin2val,xe=1,Pe=0,je=V&&J.old?J.old.transA:J.transA,Qe=0;return je||(je=J.transA),D&&(xe*=-1,Pe=J.len),J.reversed&&(xe*=-1,Pe-=xe*(J.sector||J.len)),k?(Qe=(v=v*xe+Pe-_e)/je+ae,Me&&(Qe=J.lin2val(Qe))):(Me&&(v=J.val2lin(v)),Qe=xe*(v-ae)*je+Pe+xe*_e+(Es(Y)?je*Y:0),J.isRadial||(Qe=uo(Qe))),Qe}toPixels(v,k){var D;return this.translate(((D=this.chart)==null?void 0:D.time.parse(v))??NaN,!1,!this.horiz,void 0,!0)+(k?0:this.pos)}toValue(v,k){return this.translate(v-(k?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(v){let k=this,D=k.chart,V=k.left,H=k.top,Y=v.old,J=v.value,ae=v.lineWidth,_e=Y&&D.oldChartHeight||D.chartHeight,Me=Y&&D.oldChartWidth||D.chartWidth,xe=k.transB,Pe=v.translatedValue,je=v.force,Qe,at,nt,it,wt;function kt(ki,Ri,Sr){return je!=="pass"&&(ki<Ri||ki>Sr)&&(je?ki=Eh(ki,Ri,Sr):wt=!0),ki}let Ai={value:J,lineWidth:ae,old:Y,force:je,acrossPanes:v.acrossPanes,translatedValue:Pe};return pc(this,"getPlotLinePath",Ai,function(ki){Qe=nt=(Pe=Eh(Pe=fo(Pe,k.translate(J,void 0,void 0,Y)),-1e9,1e9))+xe,at=it=_e-Pe-xe,Es(Pe)?k.horiz?(at=H,it=_e-k.bottom+(k.options.isInternal?0:D.scrollablePixelsY||0),Qe=nt=kt(Qe,V,V+k.width)):(Qe=V,nt=Me-k.right+(D.scrollablePixelsX||0),at=it=kt(at,H,H+k.height)):(wt=!0,je=!1),ki.path=wt&&!je?void 0:D.renderer.crispLine([["M",Qe,at],["L",nt,it]],ae||1)}),Ai.path}getLinearTickPositions(v,k,D){let V,H,Y,J=uo(Math.floor(k/v)*v),ae=uo(Math.ceil(D/v)*v),_e=[];if(uo(J+v)===J&&(Y=20),this.single)return[k];for(V=J;V<=ae&&(_e.push(V),(V=uo(V+v,Y))!==H);)H=V;return _e}getMinorTickInterval(){let{minorTicks:v,minorTickInterval:k}=this.options;return v===!0?fo(k,"auto"):v!==!1?k:void 0}getMinorTickPositions(){var Me;let v=this.options,k=this.tickPositions,D=this.minorTickInterval,V=this.pointRangePadding||0,H=(this.min||0)-V,Y=(this.max||0)+V,J=(Me=this.brokenAxis)!=null&&Me.hasBreaks?this.brokenAxis.unitLength:Y-H,ae=[],_e;if(J&&J/D<this.len/3){let xe=this.logarithmic;if(xe)this.paddedTicks.forEach(function(Pe,je,Qe){je&&ae.push.apply(ae,xe.getLogTickPositions(D,Qe[je-1],Qe[je],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")ae=ae.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(D),H,Y,v.startOfWeek));else for(_e=H+(k[0]-H)%D;_e<=Y&&_e!==ae[0];_e+=D)ae.push(_e)}return ae.length!==0&&this.trimTicks(ae),ae}adjustForMinRange(){let v=this.options,k=this.logarithmic,D=this.chart.time,{max:V,min:H,minRange:Y}=this,J,ae,_e,Me;this.isXAxis&&Y===void 0&&!k&&(Y=Wl(v.min)||Wl(v.max)||Wl(v.floor)||Wl(v.ceiling)?null:Math.min(5*(Qg(this.series.map(xe=>{let Pe=xe.getColumn("x");return xe.xIncrement?Pe.slice(0,2):Pe}))||0),this.dataMax-this.dataMin)),Es(V)&&Es(H)&&Es(Y)&&V-H<Y&&(ae=this.dataMax-this.dataMin>=Y,J=(Y-V+H)/2,_e=[H-J,D.parse(v.min)??H-J],ae&&(_e[2]=k?k.log2lin(this.dataMin):this.dataMin),Me=[(H=ga(_e))+Y,D.parse(v.max)??H+Y],ae&&(Me[2]=k?k.log2lin(this.dataMax):this.dataMax),(V=cf(Me))-H<Y&&(_e[0]=V-Y,_e[1]=D.parse(v.min)??V-Y,H=ga(_e))),this.minRange=Y,this.min=H,this.max=V}getClosest(){let v,k;if(this.categories)k=1;else{let D=[];this.series.forEach(function(V){let H=V.closestPointRange,Y=V.getColumn("x");Y.length===1?D.push(Y[0]):V.sorted&&Wl(H)&&V.reserveSpace()&&(k=Wl(k)?Math.min(k,H):H)}),D.length&&(D.sort((V,H)=>V-H),v=Qg([D]))}return v&&k?Math.min(v,k):v||k}nameToX(v){let k=jf(this.options.categories),D=k?this.categories:this.names,V=v.options.x,H;return v.series.requireSorting=!1,Wl(V)||(V=this.uniqueNames&&D?k?D.indexOf(v.name):fo(D.keys[v.name],-1):v.series.autoIncrement()),V===-1?!k&&D&&(H=D.length):Es(V)&&(H=V),H!==void 0?(this.names[H]=v.name,this.names.keys[v.name]=H):v.x&&(H=v.x),H}updateNames(){let v=this,k=this.names;k.length>0&&(Object.keys(k.keys).forEach(function(D){delete k.keys[D]}),k.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(D=>{D.xIncrement=null,(!D.points||D.isDirtyData)&&(v.max=Math.max(v.max||0,D.dataTable.rowCount-1),D.processData(),D.generatePoints());let V=D.getColumn("x").slice();D.data.forEach((H,Y)=>{let J=V[Y];H!=null&&H.options&&H.name!==void 0&&(J=v.nameToX(H))!==void 0&&J!==H.x&&(V[Y]=H.x=J)}),D.dataTable.setColumn("x",V)}))}setAxisTranslation(){var Pe;let v=this,k=v.max-v.min,D=v.linkedParent,V=!!v.categories,H=v.isXAxis,Y=v.axisPointRange||0,J,ae=0,_e=0,Me,xe=v.transA;(H||V||Y)&&(J=v.getClosest(),D?(ae=D.minPointOffset,_e=D.pointRangePadding):v.series.forEach(function(je){let Qe=V?1:H?fo(je.options.pointRange,J,0):v.axisPointRange||0,at=je.options.pointPlacement;if(Y=Math.max(Y,Qe),!v.single||V){let nt=je.is("xrange")?!H:H;ae=Math.max(ae,nt&&Ro(at)?0:Qe/2),_e=Math.max(_e,nt&&at==="on"?0:Qe)}}),Me=(Pe=v.ordinal)!=null&&Pe.slope&&J?v.ordinal.slope/J:1,v.minPointOffset=ae*=Me,v.pointRangePadding=_e*=Me,v.pointRange=Math.min(Y,v.single&&V?1:k),H&&(v.closestPointRange=J)),v.translationSlope=v.transA=xe=v.staticScale||v.len/(k+_e||1),v.transB=v.horiz?v.left:v.bottom,v.minPixelPadding=xe*ae,pc(this,"afterSetAxisTranslation")}minFromRange(){let{max:v,min:k}=this;return Es(v)&&Es(k)&&v-k||void 0}setTickInterval(v){var hs,Is,jn,us;let{categories:k,chart:D,dataMax:V,dataMin:H,dateTime:Y,isXAxis:J,logarithmic:ae,options:_e,softThreshold:Me}=this,xe=D.time,Pe=Es(this.threshold)?this.threshold:void 0,je=this.minRange||0,{ceiling:Qe,floor:at,linkedTo:nt,softMax:it,softMin:wt}=_e,kt=Es(nt)&&((hs=D[this.coll])==null?void 0:hs[nt]),Ai=_e.tickPixelInterval,ki=_e.maxPadding,Ri=_e.minPadding,Sr=0,hr,wr=Es(_e.tickInterval)&&_e.tickInterval>=0?_e.tickInterval:void 0,Jr,yn,Rn,fn;if(Y||k||kt||this.getTickAmount(),Rn=fo(this.userMin,xe.parse(_e.min)),fn=fo(this.userMax,xe.parse(_e.max)),kt?(this.linkedParent=kt,hr=kt.getExtremes(),this.min=fo(hr.min,hr.dataMin),this.max=fo(hr.max,hr.dataMax),this.type!==kt.type&&hf(11,!0,D)):(Me&&Wl(Pe)&&Es(V)&&Es(H)&&(H>=Pe?(Jr=Pe,Ri=0):V<=Pe&&(yn=Pe,ki=0)),this.min=fo(Rn,Jr,H),this.max=fo(fn,yn,V)),Es(this.max)&&Es(this.min)&&(ae&&(this.positiveValuesOnly&&!v&&0>=Math.min(this.min,fo(H,this.min))&&hf(10,!0,D),this.min=uo(ae.log2lin(this.min),16),this.max=uo(ae.log2lin(this.max),16)),this.range&&Es(H)&&(this.userMin=this.min=Rn=Math.max(H,this.minFromRange()||0),this.userMax=fn=this.max,this.range=void 0)),pc(this,"foundExtremes"),this.adjustForMinRange(),Es(this.min)&&Es(this.max)){if(!Es(this.userMin)&&Es(wt)&&wt<this.min&&(this.min=Rn=wt),!Es(this.userMax)&&Es(it)&&it>this.max&&(this.max=fn=it),k||this.axisPointRange||(Is=this.stacking)!=null&&Is.usePercentage||kt||(Sr=this.max-this.min)&&(!Wl(Rn)&&Ri&&(this.min-=Sr*Ri),!Wl(fn)&&ki&&(this.max+=Sr*ki)),!Es(this.userMin)&&Es(at)&&(this.min=Math.max(this.min,at)),!Es(this.userMax)&&Es(Qe)&&(this.max=Math.min(this.max,Qe)),Me&&Es(H)&&Es(V)){let oa=Pe||0;!Wl(Rn)&&this.min<oa&&H>=oa?this.min=_e.minRange?Math.min(oa,this.max-je):oa:!Wl(fn)&&this.max>oa&&V<=oa&&(this.max=_e.minRange?Math.max(oa,this.min+je):oa)}!D.polar&&this.min>this.max&&(Wl(_e.min)?this.max=this.min:Wl(_e.max)&&(this.min=this.max)),Sr=this.max-this.min}if(this.min!==this.max&&Es(this.min)&&Es(this.max)?kt&&!wr&&Ai===kt.options.tickPixelInterval?this.tickInterval=wr=kt.tickInterval:this.tickInterval=fo(wr,this.tickAmount?Sr/Math.max(this.tickAmount-1,1):void 0,k?1:Sr*Ai/Math.max(this.len,Ai)):this.tickInterval=1,J&&!v){let oa=this.min!==((jn=this.old)==null?void 0:jn.min)||this.max!==((us=this.old)==null?void 0:us.max);this.series.forEach(function(Ea){var ka;Ea.forceCrop=(ka=Ea.forceCropping)==null?void 0:ka.call(Ea),Ea.processData(oa)}),pc(this,"postProcessData",{hasExtremesChanged:oa})}this.setAxisTranslation(),pc(this,"initialAxisTranslation"),this.pointRange&&!wr&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let ms=fo(_e.minTickInterval,Y&&!this.series.some(oa=>!oa.sorted)?this.closestPointRange:0);!wr&&ms&&this.tickInterval<ms&&(this.tickInterval=ms),Y||ae||wr||(this.tickInterval=zs(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var Me,xe;let v=this.options,k=v.tickPositions,D=v.tickPositioner,V=this.getMinorTickInterval(),H=!this.isPanning,Y=H&&v.startOnTick,J=H&&v.endOnTick,ae=[],_e;if(this.tickmarkOffset=this.categories&&v.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&Wl(this.min)&&!this.tickAmount&&(this.min%1==0||v.allowDecimals!==!1),k)ae=k.slice();else if(Es(this.min)&&Es(this.max)){if(!((Me=this.ordinal)!=null&&Me.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))ae=[this.min,this.max],hf(19,!1,this.chart);else if(this.dateTime)ae=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,v.units),this.min,this.max,v.startOfWeek,(xe=this.ordinal)==null?void 0:xe.positions,this.closestPointRange,!0);else if(this.logarithmic)ae=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let Pe=this.tickInterval,je=Pe;for(;je<=2*Pe&&(ae=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&ae.length>this.tickAmount);)this.tickInterval=zs(this,je*=1.1)}ae.length>this.len&&(ae=[ae[0],ae[ae.length-1]])[0]===ae[1]&&(ae.length=1),D&&(this.tickPositions=ae,(_e=D.apply(this,[this.min,this.max]))&&(ae=_e))}this.tickPositions=ae,this.minorTickInterval=V==="auto"&&this.tickInterval?this.tickInterval/v.minorTicksPerMajor:V,this.paddedTicks=ae.slice(0),this.trimTicks(ae,Y,J),!this.isLinked&&Es(this.min)&&Es(this.max)&&(this.single&&ae.length<2&&!this.categories&&!this.series.some(Pe=>Pe.is("heatmap")&&Pe.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),k||_e||this.adjustTickAmount()),pc(this,"afterSetTickPositions")}trimTicks(v,k,D){let V=v[0],H=v[v.length-1],Y=!this.isOrdinal&&this.minPointOffset||0;if(pc(this,"trimTicks"),!this.isLinked||!this.grid){if(k&&V!==-1/0)this.min=V;else for(;this.min-Y>v[0];)v.shift();if(D)this.max=H;else for(;this.max+Y<v[v.length-1];)v.pop();v.length===0&&Wl(V)&&!this.options.tickPositions&&v.push((H+V)/2)}}alignToOthers(){let v,k=this,D=k.chart,V=[this],H=k.options,Y=D.options.chart,J=this.coll==="yAxis"&&Y.alignThresholds,ae=[];if(k.thresholdAlignment=void 0,(Y.alignTicks!==!1&&H.alignTicks||J)&&H.startOnTick!==!1&&H.endOnTick!==!1&&!k.logarithmic){let _e=xe=>{let{horiz:Pe,options:je}=xe;return[Pe?je.left:je.top,je.width,je.height,je.pane].join(",")},Me=_e(this);D[this.coll].forEach(function(xe){let{series:Pe}=xe;Pe.length&&Pe.some(je=>je.visible)&&xe!==k&&_e(xe)===Me&&(v=!0,V.push(xe))})}if(v&&J){V.forEach(Me=>{let xe=Me.getThresholdAlignment(k);Es(xe)&&ae.push(xe)});let _e=ae.length>1?ae.reduce((Me,xe)=>Me+=xe,0)/ae.length:void 0;V.forEach(Me=>{Me.thresholdAlignment=_e})}return v}getThresholdAlignment(v){if((!Es(this.dataMin)||this!==v&&this.series.some(k=>k.isDirty||k.isDirtyData))&&this.getSeriesExtremes(),Es(this.threshold)){let k=Eh((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(k=1-k),k}}getTickAmount(){let v=this.options,k=v.tickPixelInterval,D=v.tickAmount;Wl(v.tickInterval)||D||!(this.len<k)||this.isRadial||this.logarithmic||!v.startOnTick||!v.endOnTick||(D=2),!D&&this.alignToOthers()&&(D=Math.ceil(this.len/k)+1),D<4&&(this.finalTickAmt=D,D=5),this.tickAmount=D}adjustTickAmount(){let v=this,{finalTickAmt:k,max:D,min:V,options:H,tickPositions:Y,tickAmount:J,thresholdAlignment:ae}=v,_e=Y==null?void 0:Y.length,Me=fo(v.threshold,v.softThreshold?0:null),xe,Pe,je=v.tickInterval,Qe,at=()=>Y.push(uo(Y[Y.length-1]+je)),nt=()=>Y.unshift(uo(Y[0]-je));if(Es(ae)&&(Qe=ae<.5?Math.ceil(ae*(J-1)):Math.floor(ae*(J-1)),H.reversed&&(Qe=J-1-Qe)),v.hasData()&&Es(V)&&Es(D)){let it=()=>{v.transA*=(_e-1)/(J-1),v.min=H.startOnTick?Y[0]:Math.min(V,Y[0]),v.max=H.endOnTick?Y[Y.length-1]:Math.max(D,Y[Y.length-1])};if(Es(Qe)&&Es(v.threshold)){for(;Y[Qe]!==Me||Y.length!==J||Y[0]>V||Y[Y.length-1]<D;){for(Y.length=0,Y.push(v.threshold);Y.length<J;)Y[Qe]===void 0||Y[Qe]>v.threshold?nt():at();if(je>8*v.tickInterval)break;je*=2}it()}else if(_e<J){for(;Y.length<J;)Y.length%2||V===Me?at():nt();it()}if(Wl(k)){for(Pe=xe=Y.length;Pe--;)(k===3&&Pe%2==1||k<=2&&Pe>0&&Pe<xe-1)&&Y.splice(Pe,1);v.finalTickAmt=void 0}}}setScale(){var Y,J,ae,_e,Me;let{coll:v,stacking:k}=this,D=!1,V=!1;this.series.forEach(xe=>{var Pe;D=D||xe.isDirtyData||xe.isDirty,V=V||((Pe=xe.xAxis)==null?void 0:Pe.isDirty)||!1}),this.setAxisSize();let H=this.len!==((Y=this.old)==null?void 0:Y.len);H||D||V||this.isLinked||this.forceRedraw||this.userMin!==((J=this.old)==null?void 0:J.userMin)||this.userMax!==((ae=this.old)==null?void 0:ae.userMax)||this.alignToOthers()?(k&&v==="yAxis"&&k.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),k&&v==="xAxis"&&k.buildStacks(),this.isDirty||(this.isDirty=H||this.min!==((_e=this.old)==null?void 0:_e.min)||this.max!==((Me=this.old)==null?void 0:Me.max))):k&&k.cleanStacks(),D&&delete this.allExtremes,pc(this,"afterSetScale")}setExtremes(v,k,D=!0,V,H){let Y=this.chart;this.series.forEach(J=>{delete J.kdTree}),v=Y.time.parse(v),k=Y.time.parse(k),pc(this,"setExtremes",H=Wf(H,{min:v,max:k}),J=>{this.userMin=J.min,this.userMax=J.max,this.eventArgs=J,D&&Y.redraw(V)})}setAxisSize(){let v=this.chart,k=this.options,D=k.offsets||[0,0,0,0],V=this.horiz,H=this.width=Math.round(ml(fo(k.width,v.plotWidth-D[3]+D[1]),v.plotWidth)),Y=this.height=Math.round(ml(fo(k.height,v.plotHeight-D[0]+D[2]),v.plotHeight)),J=this.top=Math.round(ml(fo(k.top,v.plotTop+D[0]),v.plotHeight,v.plotTop)),ae=this.left=Math.round(ml(fo(k.left,v.plotLeft+D[3]),v.plotWidth,v.plotLeft));this.bottom=v.chartHeight-Y-J,this.right=v.chartWidth-H-ae,this.len=Math.max(V?H:Y,0),this.pos=V?ae:J}getExtremes(){let v=this.logarithmic;return{min:v?uo(v.lin2log(this.min)):this.min,max:v?uo(v.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(v){let k=this.logarithmic,D=k?k.lin2log(this.min):this.min,V=k?k.lin2log(this.max):this.max;return v===null||v===-1/0?v=D:v===1/0?v=V:D>v?v=D:V<v&&(v=V),this.translate(v,0,1,0,1)}autoLabelAlign(v){let k=(fo(v,0)-90*this.side+720)%360,D={align:"center"};return pc(this,"autoLabelAlign",D,function(V){k>15&&k<165?V.align="right":k>195&&k<345&&(V.align="left")}),D.align}tickSize(v){let k=this.options,D=fo(k[v==="tick"?"tickWidth":"minorTickWidth"],v==="tick"&&this.isXAxis&&!this.categories?1:0),V=k[v==="tick"?"tickLength":"minorTickLength"],H;D&&V&&(k[v+"Position"]==="inside"&&(V=-V),H=[V,D]);let Y={tickSize:H};return pc(this,"afterTickSize",Y),Y.tickSize}labelMetrics(){let v=this.chart.renderer,k=this.ticks,D=k[Object.keys(k)[0]]||{};return this.chart.renderer.fontMetrics(D.label||D.movedLabel||v.box)}unsquish(){let v=this.options.labels,k=v.padding||0,D=this.horiz,V=this.tickInterval,H=this.len/((+!!this.categories+this.max-this.min)/V),Y=v.rotation,J=uo(.8*this.labelMetrics().h),ae=Math.max(this.max-this.min,0),_e=function(Qe){let at=(Qe+2*k)/(H||1);return(at=at>1?Math.ceil(at):1)*V>ae&&Qe!==1/0&&H!==1/0&&ae&&(at=Math.ceil(ae/V)),uo(at*V)},Me=V,xe,Pe=Number.MAX_VALUE,je;if(D){if(!v.staggerLines&&(Es(Y)?je=[Y]:H<v.autoRotationLimit&&(je=v.autoRotation)),je){let Qe,at;for(let nt of je)(nt===Y||nt&&nt>=-90&&nt<=90)&&(at=(Qe=_e(Math.abs(J/Math.sin(Pp*nt))))+Math.abs(nt/360))<Pe&&(Pe=at,xe=nt,Me=Qe)}}else Me=_e(.75*J);return this.autoRotation=je,this.labelRotation=fo(xe,Es(Y)?Y:0),v.step?V:Me}getSlotWidth(v){let k=this.chart,D=this.horiz,V=this.options.labels,H=Math.max(this.tickPositions.length-!this.categories,1),Y=k.margin[3];if(v&&Es(v.slotWidth))return v.slotWidth;if(D&&V.step<2&&!this.isRadial)return V.rotation?0:(this.staggerLines||1)*this.len/H;if(!D){let J=V.style.width;if(J!==void 0)return parseInt(String(J),10);if(Y)return Y-k.spacing[3]}return .33*k.chartWidth}renderUnsquish(){let v=this.chart,k=v.renderer,D=this.tickPositions,V=this.ticks,H=this.options.labels,Y=H.style,J=this.horiz,ae=this.getSlotWidth(),_e=Math.max(1,Math.round(ae-(J?2*(H.padding||0):H.distance||0))),Me={},xe=this.labelMetrics(),Pe=Y.lineClamp,je,Qe=Pe??(Math.floor(this.len/(D.length*xe.h))||1),at=0;Ro(H.rotation)||(Me.rotation=H.rotation||0),D.forEach(function(nt){var kt;let it=V[nt];it.movedLabel&&it.replaceMovedLabel();let wt=((kt=it.label)==null?void 0:kt.textPxLength)||0;wt>at&&(at=wt)}),this.maxLabelLength=at,this.autoRotation?at>_e&&at>xe.h?Me.rotation=this.labelRotation:this.labelRotation=0:ae&&(je=_e),Me.rotation&&(je=at>.5*v.chartHeight?.33*v.chartHeight:at,Pe||(Qe=1)),this.labelAlign=H.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(Me.align=this.labelAlign),D.forEach(function(nt){let it=V[nt],wt=it==null?void 0:it.label,kt=Y.width,Ai={};wt&&(wt.attr(Me),it.shortenLabel?it.shortenLabel():je&&!kt&&Y.whiteSpace!=="nowrap"&&(je<(wt.textPxLength||0)||wt.element.tagName==="SPAN")?wt.css(Wf(Ai,{width:`${je}px`,lineClamp:Qe})):!wt.styles.width||Ai.width||kt||wt.css({width:"auto"}),it.rotation=Me.rotation)},this),this.tickRotCorr=k.rotCorr(xe.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(v){return v.hasData()})||this.options.showEmpty&&Wl(this.min)&&Wl(this.max)}addTitle(v){let k,D=this.chart.renderer,V=this.horiz,H=this.opposite,Y=this.options.title,J=this.chart.styledMode;this.axisTitle||((k=Y.textAlign)||(k=(V?{low:"left",middle:"center",high:"right"}:{low:H?"right":"left",middle:"center",high:H?"left":"right"})[Y.align]),this.axisTitle=D.text(Y.text||"",0,0,Y.useHTML).attr({zIndex:7,rotation:Y.rotation||0,align:k}).addClass("highcharts-axis-title"),J||this.axisTitle.css(eh(Y.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),J||Y.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[v?"show":"hide"](v)}generateTick(v){let k=this.ticks;k[v]?k[v].addLabel():k[v]=new dc(this,v)}createGroups(){let{axisParent:v,chart:k,coll:D,options:V}=this,H=k.renderer,Y=(J,ae,_e)=>H.g(J).attr({zIndex:_e}).addClass(`highcharts-${D.toLowerCase()}${ae} `+(this.isRadial?`highcharts-radial-axis${ae} `:"")+(V.className||"")).add(v);this.axisGroup||(this.gridGroup=Y("grid","-grid",V.gridZIndex),this.axisGroup=Y("axis","",V.zIndex),this.labelGroup=Y("axis-labels","-labels",V.labels.zIndex))}getOffset(){let v=this,{chart:k,horiz:D,options:V,side:H,ticks:Y,tickPositions:J,coll:ae}=v,_e=k.inverted&&!v.isZAxis?[1,0,3,2][H]:H,Me=v.hasData(),xe=V.title,Pe=V.labels,je=Es(V.crossing),Qe=k.axisOffset,at=k.clipOffset,nt=[-1,1,1,-1][H],it,wt=0,kt,Ai=0,ki=0,Ri,Sr;if(v.showAxis=it=Me||V.showEmpty,v.staggerLines=v.horiz&&Pe.staggerLines||void 0,v.createGroups(),Me||v.isLinked?(J.forEach(function(hr){v.generateTick(hr)}),v.renderUnsquish(),v.reserveSpaceDefault=H===0||H===2||{1:"left",3:"right"}[H]===v.labelAlign,fo(Pe.reserveSpace,!je&&null,v.labelAlign==="center"||null,v.reserveSpaceDefault)&&J.forEach(function(hr){ki=Math.max(Y[hr].getLabelSize(),ki)}),v.staggerLines&&(ki*=v.staggerLines),v.labelOffset=ki*(v.opposite?-1:1)):uf(Y,function(hr,wr){hr.destroy(),delete Y[wr]}),xe!=null&&xe.text&&xe.enabled!==!1&&(v.addTitle(it),it&&!je&&xe.reserveSpace!==!1&&(v.titleOffset=wt=v.axisTitle.getBBox()[D?"height":"width"],Ai=Wl(kt=xe.offset)?0:fo(xe.margin,D?5:10))),v.renderLine(),v.offset=nt*fo(V.offset,Qe[H]?Qe[H]+(V.margin||0):0),v.tickRotCorr=v.tickRotCorr||{x:0,y:0},Sr=H===0?-v.labelMetrics().h:H===2?v.tickRotCorr.y:0,Ri=Math.abs(ki)+Ai,ki&&(Ri-=Sr,Ri+=nt*(D?fo(Pe.y,v.tickRotCorr.y+nt*Pe.distance):fo(Pe.x,nt*Pe.distance))),v.axisTitleMargin=fo(kt,Ri),v.getMaxLabelDimensions&&(v.maxLabelDimensions=v.getMaxLabelDimensions(Y,J)),ae!=="colorAxis"&&at){let hr=this.tickSize("tick");Qe[H]=Math.max(Qe[H],(v.axisTitleMargin||0)+wt+nt*v.offset,Ri,J!=null&&J.length&&hr?hr[0]+nt*v.offset:0);let wr=!v.axisLine||V.offset?0:v.axisLine.strokeWidth()/2;at[_e]=Math.max(at[_e],wr)}pc(this,"afterGetOffset")}getLinePath(v){let k=this.chart,D=this.opposite,V=this.offset,H=this.horiz,Y=this.left+(D?this.width:0)+V,J=k.chartHeight-this.bottom-(D?this.height:0)+V;return D&&(v*=-1),k.renderer.crispLine([["M",H?this.left:Y,H?J:this.top],["L",H?k.chartWidth-this.right:Y,H?J:k.chartHeight-this.bottom]],v)}renderLine(){!this.axisLine&&(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(v){let k=this.horiz,D=this.left,V=this.top,H=this.len,Y=this.options.title,J=k?D:V,ae=this.opposite,_e=this.offset,Me=Y.x,xe=Y.y,Pe=this.chart.renderer.fontMetrics(v),je=v?Math.max(v.getBBox(!1,0).height-Pe.h-1,0):0,Qe={low:J+(k?0:H),middle:J+H/2,high:J+(k?H:0)}[Y.align],at=(k?V+this.height:D)+(k?1:-1)*(ae?-1:1)*(this.axisTitleMargin||0)+[-je,je,Pe.f,-je][this.side],nt={x:k?Qe+Me:at+(ae?this.width:0)+_e+Me,y:k?at+xe-(ae?this.height:0)+_e:Qe+xe};return pc(this,"afterGetTitlePosition",{titlePosition:nt}),nt}renderMinorTick(v,k){let D=this.minorTicks;D[v]||(D[v]=new dc(this,v,"minor")),k&&D[v].isNew&&D[v].render(null,!0),D[v].render(null,!1,1)}renderTick(v,k,D){var Y;let V=this.isLinked,H=this.ticks;(!V||v>=this.min&&v<=this.max||(Y=this.grid)!=null&&Y.isColumn)&&(H[v]||(H[v]=new dc(this,v)),D&&H[v].isNew&&H[v].render(k,!0,-1),H[v].render(k))}render(){let v,k,D=this,V=D.chart,H=D.logarithmic,Y=V.renderer,J=D.options,ae=D.isLinked,_e=D.tickPositions,Me=D.axisTitle,xe=D.ticks,Pe=D.minorTicks,je=D.alternateBands,Qe=J.stackLabels,at=J.alternateGridColor,nt=J.crossing,it=D.tickmarkOffset,wt=D.axisLine,kt=D.showAxis,Ai=Qc(Y.globalAnimation);if(D.labelEdge.length=0,D.overlap=!1,[xe,Pe,je].forEach(function(ki){uf(ki,function(Ri){Ri.isActive=!1})}),Es(nt)){let ki=this.isXAxis?V.yAxis[0]:V.xAxis[0],Ri=[1,-1,-1,1][this.side];if(ki){let Sr=ki.toPixels(nt,!0);D.horiz&&(Sr=ki.len-Sr),D.offset=Ri*Sr}}if(D.hasData()||ae){let ki=D.chart.hasRendered&&D.old&&Es(D.old.min);D.minorTickInterval&&!D.categories&&D.getMinorTickPositions().forEach(function(Ri){D.renderMinorTick(Ri,ki)}),_e.length&&(_e.forEach(function(Ri,Sr){D.renderTick(Ri,Sr,ki)}),it&&(D.min===0||D.single)&&(xe[-1]||(xe[-1]=new dc(D,-1,null,!0)),xe[-1].render(-1))),at&&_e.forEach(function(Ri,Sr){k=_e[Sr+1]!==void 0?_e[Sr+1]+it:D.max-it,Sr%2==0&&Ri<D.max&&k<=D.max+(V.polar?-it:it)&&(je[Ri]||(je[Ri]=new Ye.PlotLineOrBand(D,{})),v=Ri+it,je[Ri].options={from:H?H.lin2log(v):v,to:H?H.lin2log(k):k,color:at,className:"highcharts-alternate-grid"},je[Ri].render(),je[Ri].isActive=!0)}),D._addedPlotLB||(D._addedPlotLB=!0,(J.plotLines||[]).concat(J.plotBands||[]).forEach(function(Ri){D.addPlotBandOrLine(Ri)}))}[xe,Pe,je].forEach(function(ki){let Ri=[],Sr=Ai.duration;uf(ki,function(hr,wr){hr.isActive||(hr.render(wr,!1,0),hr.isActive=!1,Ri.push(wr))}),Op(function(){let hr=Ri.length;for(;hr--;)ki[Ri[hr]]&&!ki[Ri[hr]].isActive&&(ki[Ri[hr]].destroy(),delete ki[Ri[hr]])},ki!==je&&V.hasRendered&&Sr?Sr:0)}),wt&&(wt[wt.isPlaced?"animate":"attr"]({d:this.getLinePath(wt.strokeWidth())}),wt.isPlaced=!0,wt[kt?"show":"hide"](kt)),Me&&kt&&(Me[Me.isNew?"attr":"animate"](D.getTitlePosition(Me)),Me.isNew=!1),Qe!=null&&Qe.enabled&&D.stacking&&D.stacking.renderStackTotals(),D.old={len:D.len,max:D.max,min:D.min,transA:D.transA,userMax:D.userMax,userMin:D.userMin},D.isDirty=!1,pc(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(v){v.render()})),this.series.forEach(function(v){v.isDirty=!0})}getKeepProps(){return this.keepProps||Yu.keepProps}destroy(v){let k=this,D=k.plotLinesAndBands,V=this.eventOptions;if(pc(this,"destroy",{keepEvents:v}),v||Hf(k),[k.ticks,k.minorTicks,k.alternateBands].forEach(function(H){Kg(H)}),D){let H=D.length;for(;H--;)D[H].destroy()}for(let H in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(Y){k[Y]&&(k[Y]=k[Y].destroy())}),k.plotLinesAndBandsGroups)k.plotLinesAndBandsGroups[H]=k.plotLinesAndBandsGroups[H].destroy();uf(k,function(H,Y){k.getKeepProps().indexOf(Y)===-1&&delete k[Y]}),this.eventOptions=V}drawCrosshair(v,k){var xe;let D=this.crosshair,V=(D==null?void 0:D.snap)??!0,H=this.chart,Y,J,ae,_e=this.cross,Me;if(pc(this,"drawCrosshair",{e:v,point:k}),v||(v=(xe=this.cross)==null?void 0:xe.e),D&&(Wl(k)||!V)!==!1){if(V?Wl(k)&&(J=fo(this.coll!=="colorAxis"?k.crosshairPos:null,this.isXAxis?k.plotX:this.len-k.plotY)):J=v&&(this.horiz?v.chartX-this.pos:this.len-v.chartY+this.pos),Wl(J)&&(Me={value:k&&(this.isXAxis?k.x:fo(k.stackY,k.y)),translatedValue:J},H.polar&&Wf(Me,{isCrosshair:!0,chartX:v==null?void 0:v.chartX,chartY:v==null?void 0:v.chartY,point:k}),Y=this.getPlotLinePath(Me)||null),!Wl(Y))return void this.hideCrosshair();ae=this.categories&&!this.isRadial,_e||(this.cross=_e=H.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(ae?"category ":"thin ")+(D.className||"")).attr({zIndex:fo(D.zIndex,2)}).add(),!H.styledMode&&(_e.attr({stroke:D.color||(ae?Un.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":fo(D.width,1)}).css({"pointer-events":"none"}),D.dashStyle&&_e.attr({dashstyle:D.dashStyle}))),_e.show().attr({d:Y}),ae&&!D.width&&_e.attr({"stroke-width":this.transA}),this.cross.e=v}else this.hideCrosshair();pc(this,"afterDrawCrosshair",{e:v,point:k})}hideCrosshair(){this.cross&&this.cross.hide(),pc(this,"afterHideCrosshair")}update(v,k){let D=this.chart;v=eh(this.userOptions,v),this.destroy(!0),this.init(D,v),D.isDirtyBox=!0,fo(k,!0)&&D.redraw()}remove(v){let k=this.chart,D=this.coll,V=this.series,H=V.length;for(;H--;)V[H]&&V[H].remove(!1);k0(k.axes,this),k0(k[D]||[],this),k.orderItems(D),this.destroy(),k.isDirtyBox=!0,fo(v,!0)&&k.redraw()}setTitle(v,k){this.update({title:v},k)}setCategories(v,k){this.update({categories:v},k)}}Yu.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:Rp,getMagnitude:Np,normalizeTickInterval:wd,timeUnits:No}=pr;(function(ve){function v(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function k(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new D(this))}ve.compose=function(V){return V.keepProps.includes("dateTime")||(V.keepProps.push("dateTime"),V.prototype.getTimeTicks=v,Rp(V,"afterSetType",k)),V};class D{constructor(H){this.axis=H}normalizeTimeTickInterval(H,Y){let J=Y||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],ae=J[J.length-1],_e=No[ae[0]],Me=ae[1],xe;for(xe=0;xe<J.length&&(_e=No[(ae=J[xe])[0]],Me=ae[1],!J[xe+1]||!(H<=(_e*Me[Me.length-1]+No[J[xe+1][0]])/2));xe++);_e===No.year&&H<5*_e&&(Me=[1,2,5]);let Pe=wd(H/_e,Me,ae[0]==="year"?Math.max(Np(H/_e),1):1);return{unitRange:_e,count:Pe,unitName:ae[0]}}getXDateFormat(H,Y){let{axis:J}=this,ae=J.chart.time;return J.closestPointRange?ae.getDateFormat(J.closestPointRange,H,J.options.startOfWeek,Y)||ae.resolveDTLFormat(Y.year).main:ae.resolveDTLFormat(Y.day).main}}ve.Additions=D})(E||(E={}));let Cm=E,{addEvent:yg,normalizeTickInterval:_g,pick:M0}=pr;(function(ve){function v(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new D(this))}function k(){let V=this.logarithmic;V&&(this.lin2val=function(H){return V.lin2log(H)},this.val2lin=function(H){return V.log2lin(H)})}ve.compose=function(V){return V.keepProps.includes("logarithmic")||(V.keepProps.push("logarithmic"),yg(V,"afterSetType",v),yg(V,"afterInit",k)),V};class D{constructor(H){this.axis=H}getLogTickPositions(H,Y,J,ae){let _e=this.axis,Me=_e.len,xe=_e.options,Pe=[];if(ae||(this.minorAutoInterval=void 0),H>=.5)H=Math.round(H),Pe=_e.getLinearTickPositions(H,Y,J);else if(H>=.08){let je,Qe,at,nt,it,wt,kt,Ai=Math.floor(Y);for(je=H>.3?[1,2,4]:H>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Qe=Ai;Qe<J+1&&!kt;Qe++)for(at=0,nt=je.length;at<nt&&!kt;at++)(it=this.log2lin(this.lin2log(Qe)*je[at]))>Y&&(!ae||wt<=J)&&wt!==void 0&&Pe.push(wt),wt>J&&(kt=!0),wt=it}else{let je=this.lin2log(Y),Qe=this.lin2log(J),at=ae?_e.getMinorTickInterval():xe.tickInterval,nt=xe.tickPixelInterval/(ae?5:1),it=ae?Me/_e.tickPositions.length:Me;H=_g(H=M0(at==="auto"?null:at,this.minorAutoInterval,(Qe-je)*nt/(it||1))),Pe=_e.getLinearTickPositions(H,je,Qe).map(this.log2lin),ae||(this.minorAutoInterval=H/5)}return ae||(_e.tickInterval=H),Pe}lin2log(H){return Math.pow(10,H)}log2lin(H){return Math.log(H)/Math.LN10}}ve.Additions=D})(L||(L={}));let Em=L,{erase:wu,extend:Bp,isNumber:zt}=pr;(function(ve){let v;function k(_e){return this.addPlotBandOrLine(_e,"plotBands")}function D(_e,Me){let xe=this.userOptions,Pe=new v(this,_e);if(this.visible&&(Pe=Pe.render()),Pe){if(this._addedPlotLB||(this._addedPlotLB=!0,(xe.plotLines||[]).concat(xe.plotBands||[]).forEach(je=>{this.addPlotBandOrLine(je)})),Me){let je=xe[Me]||[];je.push(_e),xe[Me]=je}this.plotLinesAndBands.push(Pe)}return Pe}function V(_e){return this.addPlotBandOrLine(_e,"plotLines")}function H(_e,Me,xe){xe=xe||this.options;let Pe=this.getPlotLinePath({value:Me,force:!0,acrossPanes:xe.acrossPanes}),je=[],Qe=this.horiz,at=!zt(this.min)||!zt(this.max)||_e<this.min&&Me<this.min||_e>this.max&&Me>this.max,nt=this.getPlotLinePath({value:_e,force:!0,acrossPanes:xe.acrossPanes}),it,wt=1,kt;if(nt&&Pe)for(at&&(kt=nt.toString()===Pe.toString(),wt=0),it=0;it<nt.length;it+=2){let Ai=nt[it],ki=nt[it+1],Ri=Pe[it],Sr=Pe[it+1];(Ai[0]==="M"||Ai[0]==="L")&&(ki[0]==="M"||ki[0]==="L")&&(Ri[0]==="M"||Ri[0]==="L")&&(Sr[0]==="M"||Sr[0]==="L")&&(Qe&&Ri[1]===Ai[1]?(Ri[1]+=wt,Sr[1]+=wt):Qe||Ri[2]!==Ai[2]||(Ri[2]+=wt,Sr[2]+=wt),je.push(["M",Ai[1],Ai[2]],["L",ki[1],ki[2]],["L",Sr[1],Sr[2]],["L",Ri[1],Ri[2]],["Z"])),je.isFlat=kt}return je}function Y(_e){this.removePlotBandOrLine(_e)}function J(_e){let Me=this.plotLinesAndBands,xe=this.options,Pe=this.userOptions;if(Me){let je=Me.length;for(;je--;)Me[je].id===_e&&Me[je].destroy();[xe.plotLines||[],Pe.plotLines||[],xe.plotBands||[],Pe.plotBands||[]].forEach(function(Qe){var at;for(je=Qe.length;je--;)((at=Qe[je])==null?void 0:at.id)===_e&&wu(Qe,Qe[je])})}}function ae(_e){this.removePlotBandOrLine(_e)}ve.compose=function(_e,Me){let xe=Me.prototype;return xe.addPlotBand||(v=_e,Bp(xe,{addPlotBand:k,addPlotLine:V,addPlotBandOrLine:D,getPlotBandPath:H,removePlotBand:Y,removePlotLine:ae,removePlotBandOrLine:J})),Me}})(F||(F={}));let Gf=F,{addEvent:qf,arrayMax:Su,arrayMin:wa,defined:Xu,destroyObjectProperties:Jg,erase:pf,fireEvent:Fp,merge:ey,objectEach:I0,pick:Yf}=pr;class dp{static compose(v,k){return qf(v,"afterInit",function(){this.labelCollectors.push(()=>{var V;let D=[];for(let H of this.axes)for(let{label:Y,options:J}of H.plotLinesAndBands)Y&&!((V=J==null?void 0:J.label)!=null&&V.allowOverlap)&&D.push(Y);return D})}),Gf.compose(dp,k)}constructor(v,k){this.axis=v,this.options=k,this.id=k.id}render(){Fp(this,"render");let{axis:v,options:k}=this,{horiz:D,logarithmic:V}=v,{color:H,events:Y,zIndex:J=0}=k,{renderer:ae,time:_e}=v.chart,Me={},xe=_e.parse(k.to),Pe=_e.parse(k.from),je=_e.parse(k.value),Qe=k.borderWidth,at=k.label,{label:nt,svgElem:it}=this,wt=[],kt,Ai=Xu(Pe)&&Xu(xe),ki=Xu(je),Ri=!it,Sr={class:"highcharts-plot-"+(Ai?"band ":"line ")+(k.className||"")},hr=Ai?"bands":"lines";if(!v.chart.styledMode&&(ki?(Sr.stroke=H||"#999999",Sr["stroke-width"]=Yf(k.width,1),k.dashStyle&&(Sr.dashstyle=k.dashStyle)):Ai&&(Sr.fill=H||"#e6e9ff",Qe&&(Sr.stroke=k.borderColor,Sr["stroke-width"]=Qe))),Me.zIndex=J,hr+="-"+J,(kt=v.plotLinesAndBandsGroups[hr])||(v.plotLinesAndBandsGroups[hr]=kt=ae.g("plot-"+hr).attr(Me).add()),it||(this.svgElem=it=ae.path().attr(Sr).add(kt)),Xu(je))wt=v.getPlotLinePath({value:(V==null?void 0:V.log2lin(je))??je,lineWidth:it.strokeWidth(),acrossPanes:k.acrossPanes});else{if(!(Xu(Pe)&&Xu(xe)))return;wt=v.getPlotBandPath((V==null?void 0:V.log2lin(Pe))??Pe,(V==null?void 0:V.log2lin(xe))??xe,k)}return!this.eventsAdded&&Y&&(I0(Y,(wr,Jr)=>{it==null||it.on(Jr,yn=>{Y[Jr].apply(this,[yn])})}),this.eventsAdded=!0),(Ri||!it.d)&&(wt!=null&&wt.length)?it.attr({d:wt}):it&&(wt?(it.show(),it.animate({d:wt})):it.d&&(it.hide(),nt&&(this.label=nt=nt.destroy()))),at&&(Xu(at.text)||Xu(at.formatter))&&(wt!=null&&wt.length)&&v.width>0&&v.height>0&&!wt.isFlat?(at=ey({align:D&&Ai?"center":void 0,x:D?!Ai&&4:10,verticalAlign:!D&&Ai?"middle":void 0,y:D?Ai?16:10:Ai?6:-4,rotation:D&&!Ai?90:0,...Ai?{inside:!0}:{}},at),this.renderLabel(at,wt,Ai,J)):nt&&nt.hide(),this}renderLabel(v,k,D,V){var Qe,at;let H=this.axis,Y=H.chart.renderer,J=v.inside,ae=this.label;ae||(this.label=ae=Y.text(this.getLabelText(v),0,0,v.useHTML).attr({align:v.textAlign||v.align,rotation:v.rotation,class:"highcharts-plot-"+(D?"band":"line")+"-label "+(v.className||""),zIndex:V}),H.chart.styledMode||ae.css(ey({color:(Qe=H.chart.options.title)==null?void 0:Qe.style.color,fontSize:"0.8em",textOverflow:D&&!J?"":"ellipsis"},v.style)),ae.add());let _e=k.xBounds||[k[0][1],k[1][1],D?k[2][1]:k[0][1]],Me=k.yBounds||[k[0][2],k[1][2],D?k[2][2]:k[0][2]],xe=wa(_e),Pe=wa(Me),je=Su(_e)-xe;ae.align(v,!1,{x:xe,y:Pe,width:je,height:Su(Me)-Pe}),ae.alignAttr.y-=Y.fontMetrics(ae).b,(!ae.alignValue||ae.alignValue==="left"||Xu(J))&&ae.css({width:(((at=v.style)==null?void 0:at.width)||(D&&J?je:ae.rotation===90?H.height-(ae.alignAttr.y-H.top):(v.clip?H.width:H.chart.chartWidth)-(ae.alignAttr.x-H.left)))+"px"}),ae.show(!0)}getLabelText(v){return Xu(v.formatter)?v.formatter.call(this):v.text}destroy(){pf(this.axis.plotLinesAndBands,this),delete this.axis,Jg(this)}}let{animObject:zy}=Or,{format:Oc}=ul,{composed:Zu,dateFormats:vg,doc:xg,isSafari:Uy}=Ye,{distribute:ty}=Cs,{addEvent:Sd,clamp:pp,css:fp,discardElement:$y,extend:km,fireEvent:iy,getAlignFactor:zp,isArray:ff,isNumber:L0,isObject:$d,isString:Vy,merge:Am,pick:mp,pushUnique:C_,splat:Mm,syncTimeout:Im}=pr;class Lm{constructor(v,k,D){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=v,this.init(v,k),this.pointer=D}bodyFormatter(v){return v.map(k=>{let D=k.series.tooltipOptions,V=k.formatPrefix||"point";return(D[V+"Formatter"]||k.tooltipFormatter).call(k,D[V+"Format"]||"")})}cleanSplit(v){this.chart.series.forEach(function(k){let D=k==null?void 0:k.tt;D&&(!D.isActive||v?k.tt=D.destroy():D.isActive=!1)})}defaultFormatter(v){let k,D=this.points||Mm(this);return(k=(k=[v.headerFooterFormatter(D[0])]).concat(v.bodyFormatter(D))).push(v.headerFooterFormatter(D[0],!0)),k}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),$y(this.container)),pr.clearTimeout(this.hideTimer)}getAnchor(v,k){var Me;let D,{chart:V,pointer:H}=this,Y=V.inverted,J=V.plotTop,ae=V.plotLeft;if(v=Mm(v),(Me=v[0].series)!=null&&Me.yAxis&&!v[0].series.yAxis.options.reversedStacks&&(v=v.slice().reverse()),this.followPointer&&k)k.chartX===void 0&&(k=H.normalize(k)),D=[k.chartX-ae,k.chartY-J];else if(v[0].tooltipPos)D=v[0].tooltipPos;else{let xe=0,Pe=0;v.forEach(function(je){let Qe=je.pos(!0);Qe&&(xe+=Qe[0],Pe+=Qe[1])}),xe/=v.length,Pe/=v.length,this.shared&&v.length>1&&k&&(Y?xe=k.chartX:Pe=k.chartY),D=[xe-ae,Pe-J]}let _e={point:v[0],ret:D};return iy(this,"getAnchor",_e),_e.ret.map(Math.round)}getClassName(v,k,D){let V=this.options,H=v.series,Y=H.options;return[V.className,"highcharts-label",D&&"highcharts-tooltip-header",k?"highcharts-tooltip-box":"highcharts-tooltip",!D&&"highcharts-color-"+mp(v.colorIndex,H.colorIndex),Y==null?void 0:Y.className].filter(Vy).join(" ")}getLabel({anchorX:v,anchorY:k}={anchorX:0,anchorY:0}){let D=this,V=this.chart.styledMode,H=this.options,Y=this.split&&this.allowShared,J=this.container,ae=this.chart.renderer;if(this.label){let _e=!this.label.hasClass("highcharts-label");(!Y&&_e||Y&&!_e)&&this.destroy()}if(!this.label){if(this.outside){let _e=this.chart,Me=_e.options.chart.style,xe=Uc.getRendererType();this.container=J=Ye.doc.createElement("div"),J.className="highcharts-tooltip-container "+(_e.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),fp(J,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((Me==null?void 0:Me.zIndex)||0)+3)}),this.renderer=ae=new xe(J,0,0,Me,void 0,void 0,ae.styledMode)}if(Y?this.label=ae.g("tooltip"):(this.label=ae.label("",v,k,H.shape||"callout",void 0,void 0,H.useHTML,void 0,"tooltip").attr({padding:H.padding,r:H.borderRadius}),V||this.label.attr({fill:H.backgroundColor,"stroke-width":H.borderWidth||0}).css(H.style).css({pointerEvents:H.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),D.outside){let _e=this.label;[_e.xSetter,_e.ySetter].forEach((Me,xe)=>{_e[xe?"ySetter":"xSetter"]=Pe=>{Me.call(_e,D.distance),_e[xe?"y":"x"]=Pe,J&&(J.style[xe?"top":"left"]=`${Pe}px`)}})}this.label.attr({zIndex:8}).shadow(H.shadow??!H.fixed).add()}return J&&!J.parentElement&&Ye.doc.body.appendChild(J),this.label}getPlayingField(){let{body:v,documentElement:k}=xg,{chart:D,distance:V,outside:H}=this;return{width:H?Math.max(v.scrollWidth,k.scrollWidth,v.offsetWidth,k.offsetWidth,k.clientWidth)-2*V-2:D.chartWidth,height:H?Math.max(v.scrollHeight,k.scrollHeight,v.offsetHeight,k.offsetHeight,k.clientHeight):D.chartHeight}}getPosition(v,k,D){var hs,Is;let{distance:V,chart:H,outside:Y,pointer:J}=this,{inverted:ae,plotLeft:_e,plotTop:Me,polar:xe}=H,{plotX:Pe=0,plotY:je=0}=D,Qe={},at=ae&&D.h||0,{height:nt,width:it}=this.getPlayingField(),wt=J.getChartPosition(),kt=jn=>jn*wt.scaleX,Ai=jn=>jn*wt.scaleY,ki=jn=>{let us=jn==="x";return[jn,us?it:nt,us?v:k].concat(Y?[us?kt(v):Ai(k),us?wt.left-V+kt(Pe+_e):wt.top-V+Ai(je+Me),0,us?it:nt]:[us?v:k,us?Pe+_e:je+Me,us?_e:Me,us?_e+H.plotWidth:Me+H.plotHeight])},Ri=ki("y"),Sr=ki("x"),hr,wr=!!D.negative;!xe&&((Is=(hs=H.hoverSeries)==null?void 0:hs.yAxis)!=null&&Is.reversed)&&(wr=!wr);let Jr=!this.followPointer&&mp(D.ttBelow,!xe&&!ae===wr),yn=function(jn,us,oa,Ea,ka,Mh,da){let Ol=Y?jn==="y"?Ai(V):kt(V):V,Co=(oa-Ea)/2,Os=Ea<ka-V,Us=ka+V+Ea<us,tl=ka-Ol-oa+Co,pa=ka+Ol-Co;if(Jr&&Us)Qe[jn]=pa;else if(!Jr&&Os)Qe[jn]=tl;else if(Os)Qe[jn]=Math.min(da-Ea,tl-at<0?tl:tl-at);else{if(!Us)return Qe[jn]=0,!1;Qe[jn]=Math.max(Mh,pa+at+oa>us?pa:pa+at)}},Rn=function(jn,us,oa,Ea,ka){if(ka<V||ka>us-V)return!1;ka<oa/2?Qe[jn]=1:ka>us-Ea/2?Qe[jn]=us-Ea-2:Qe[jn]=ka-oa/2},fn=function(jn){[Ri,Sr]=[Sr,Ri],hr=jn},ms=()=>{yn.apply(0,Ri)!==!1?Rn.apply(0,Sr)!==!1||hr||(fn(!0),ms()):hr?Qe.x=Qe.y=0:(fn(!0),ms())};return(ae&&!xe||this.len>1)&&fn(),ms(),Qe}getFixedPosition(v,k,D){var Pe;let V=D.series,{chart:H,options:Y,split:J}=this,ae=Y.position,_e=ae.relativeTo,Me=Y.shared||(Pe=V==null?void 0:V.yAxis)!=null&&Pe.isRadial&&(_e==="pane"||!_e)?"plotBox":_e,xe=Me==="chart"?H.renderer:H[Me]||H.getClipBox(V,!0);return{x:xe.x+(xe.width-v)*zp(ae.align)+ae.x,y:xe.y+(xe.height-k)*zp(ae.verticalAlign)+(!J&&ae.y||0)}}hide(v){let k=this;pr.clearTimeout(this.hideTimer),v=mp(v,this.options.hideDelay),this.isHidden||(this.hideTimer=Im(function(){let D=k.getLabel();k.getLabel().animate({opacity:0},{duration:v&&150,complete:()=>{D.hide(),k.container&&k.container.remove()}}),k.isHidden=!0},v))}init(v,k){this.chart=v,this.options=k,this.crosshairs=[],this.isHidden=!0,this.split=k.split&&!v.inverted&&!v.polar,this.shared=k.shared||this.split,this.outside=mp(k.outside,!!(v.scrollablePixelsX||v.scrollablePixelsY))}shouldStickOnContact(v){return!!(!this.followPointer&&this.options.stickOnContact&&(!v||this.pointer.inClass(v.target,"highcharts-tooltip")))}move(v,k,D,V){let{followPointer:H,options:Y}=this,J=zy(!H&&!this.isHidden&&!Y.fixed&&Y.animation),ae=H||(this.len||0)>1,_e={x:v,y:k};ae?_e.anchorX=_e.anchorY=NaN:(_e.anchorX=D,_e.anchorY=V),J.step=()=>this.drawTracker(),this.getLabel().animate(_e,J)}refresh(v,k){let{chart:D,options:V,pointer:H,shared:Y}=this,J=Mm(v),ae=J[0],_e=V.format,Me=V.formatter||this.defaultFormatter,xe=D.styledMode,Pe=this.allowShared;if(!V.enabled||!ae.series)return;pr.clearTimeout(this.hideTimer),this.allowShared=!(!ff(v)&&v.series&&v.series.noSharedTooltip),Pe=Pe&&!this.allowShared,this.followPointer=!this.split&&ae.series.tooltipOptions.followPointer;let je=this.getAnchor(v,k),Qe=je[0],at=je[1];Y&&this.allowShared&&(H.applyInactiveState(J),J.forEach(wt=>wt.setState("hover")),ae.points=J),this.len=J.length;let nt=Vy(_e)?Oc(_e,ae,D):Me.call(ae,this);ae.points=void 0;let it=ae.series;if(this.distance=mp(it.tooltipOptions.distance,16),nt===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(nt,J);else{let wt=Qe,kt=at;if(k&&H.isDirectTouch&&(wt=k.chartX-D.plotLeft,kt=k.chartY-D.plotTop),!(D.polar||it.options.clip===!1||J.some(Ai=>H.isDirectTouch||Ai.series.shouldShowTooltip(wt,kt))))return void this.hide();{let Ai=this.getLabel(Pe&&this.tt||{});(!V.style.width||xe)&&Ai.css({width:(this.outside?this.getPlayingField():D.spacingBox).width+"px"}),Ai.attr({class:this.getClassName(ae),text:nt&&nt.join?nt.join(""):nt}),this.outside&&Ai.attr({x:pp(Ai.x||0,0,this.getPlayingField().width-(Ai.width||0)-1)}),xe||Ai.attr({stroke:V.borderColor||ae.color||it.color||"#666666"}),this.updatePosition({plotX:Qe,plotY:at,negative:ae.negative,ttBelow:ae.ttBelow,series:it,h:je[2]||0})}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}iy(this,"refresh")}renderSplit(v,k){var ka,Mh;let D=this,{chart:V,chart:{chartWidth:H,chartHeight:Y,plotHeight:J,plotLeft:ae,plotTop:_e,scrollablePixelsY:Me=0,scrollablePixelsX:xe,styledMode:Pe},distance:je,options:Qe,options:{fixed:at,position:nt,positioner:it},pointer:wt}=D,{scrollLeft:kt=0,scrollTop:Ai=0}=((ka=V.scrollablePlotArea)==null?void 0:ka.scrollingContainer)||{},ki=D.outside&&typeof xe!="number"?xg.documentElement.getBoundingClientRect():{left:kt,right:kt+H,top:Ai,bottom:Ai+Y},Ri=D.getLabel(),Sr=this.renderer||V.renderer,hr=!!((Mh=V.xAxis[0])!=null&&Mh.opposite),{left:wr,top:Jr}=wt.getChartPosition(),yn=it||at,Rn=_e+Ai,fn=0,ms=J-Me,hs=function(da,Ol,Co,Os=[0,0],Us=!0){let tl,pa;if(Co.isHeader)pa=hr?0:ms,tl=pp(Os[0]-da/2,ki.left,ki.right-da-(D.outside?wr:0));else if(at&&Co){let Ih=D.getFixedPosition(da,Ol,Co);tl=Ih.x,pa=Ih.y-Rn}else pa=Os[1]-Rn,tl=pp(tl=Us?Os[0]-da-je:Os[0]+je,Us?tl:ki.left,ki.right);return{x:tl,y:pa}};Vy(v)&&(v=[!1,v]);let Is=v.slice(0,k.length+1).reduce(function(da,Ol,Co){if(Ol!==!1&&Ol!==""){let Os=k[Co-1]||{isHeader:!0,plotX:k[0].plotX,plotY:J,series:{}},Us=Os.isHeader,tl=Us?D:Os.series,pa=tl.tt=function(Lh,Rl,t0){let Gm=Lh,{isHeader:kf,series:_y}=Rl,ip=_y.tooltipOptions||Qe;if(!Gm){let qm={padding:ip.padding,r:ip.borderRadius};Pe||(qm.fill=ip.backgroundColor,qm["stroke-width"]=ip.borderWidth??(at&&!kf?0:1)),Gm=Sr.label("",0,0,ip[kf?"headerShape":"shape"]||(at&&!kf?"rect":"callout"),void 0,void 0,ip.useHTML).addClass(D.getClassName(Rl,!0,kf)).attr(qm).add(Ri)}return Gm.isActive=!0,Gm.attr({text:t0}),Pe||Gm.css(ip.style).attr({stroke:ip.borderColor||Rl.color||_y.color||"#333333"}),Gm}(tl.tt,Os,Ol.toString()),Ih=pa.getBBox(),nh=Ih.width+pa.strokeWidth();Us&&(fn=Ih.height,ms+=fn,hr&&(Rn-=fn));let{anchorX:va,anchorY:ou}=function(Lh){let Rl,t0,{isHeader:Gm,plotX:kf=0,plotY:_y=0,series:ip}=Lh;if(Gm)Rl=Math.max(ae+kf,ae),t0=_e+J/2;else{let{xAxis:qm,yAxis:L_}=ip;Rl=qm.pos+pp(kf,-je,qm.len+je),ip.shouldShowTooltip(0,L_.pos-_e+_y,{ignoreX:!0})&&(t0=L_.pos+_y)}return{anchorX:Rl=pp(Rl,ki.left-je,ki.right+je),anchorY:t0}}(Os);if(typeof ou=="number"){let Lh=Ih.height+1,Rl=(it||hs).call(D,nh,Lh,Os,[va,ou]);da.push({align:yn?0:void 0,anchorX:va,anchorY:ou,boxWidth:nh,point:Os,rank:mp(Rl.rank,+!!Us),size:Lh,target:Rl.y,tt:pa,x:Rl.x})}else pa.isActive=!1}return da},[]);!yn&&Is.some(da=>{let{outside:Ol}=D,Co=(Ol?wr:0)+da.anchorX;return Co<ki.left&&Co+da.boxWidth<ki.right||Co<wr-ki.left+da.boxWidth&&ki.right-Co>Co})&&(Is=Is.map(da=>{let{x:Ol,y:Co}=hs.call(this,da.boxWidth,da.size,da.point,[da.anchorX,da.anchorY],!1);return km(da,{target:Co,x:Ol})})),D.cleanSplit(),ty(Is,ms);let jn={left:wr,right:wr};Is.forEach(function(da){let{x:Ol,boxWidth:Co,isHeader:Os}=da;!Os&&(D.outside&&wr+Ol<jn.left&&(jn.left=wr+Ol),!Os&&D.outside&&jn.left+Co>jn.right&&(jn.right=wr+Ol))}),Is.forEach(function(da){let{x:Ol,anchorX:Co,anchorY:Os,pos:Us,point:{isHeader:tl}}=da,pa={visibility:Us===void 0?"hidden":"inherit",x:Ol,y:(Us||0)+Rn+(at&&nt.y||0),anchorX:Co,anchorY:Os};if(D.outside&&Ol<Co){let Ih=wr-jn.left;Ih>0&&(tl||(pa.x=Ol+Ih,pa.anchorX=Co+Ih),tl&&(pa.x=(jn.right-jn.left)/2,pa.anchorX=Co+Ih))}da.tt.attr(pa)});let{container:us,outside:oa,renderer:Ea}=D;if(oa&&us&&Ea){let{width:da,height:Ol,x:Co,y:Os}=Ri.getBBox();Ea.setSize(da+Co,Ol+Os,!1),us.style.left=jn.left+"px",us.style.top=Jr+"px"}Uy&&Ri.attr({opacity:Ri.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let v=this.chart,k=this.label,D=this.shared?v.hoverPoints:v.hoverPoint;if(!k||!D)return;let V={x:0,y:0,width:0,height:0},H=this.getAnchor(D),Y=k.getBBox();H[0]+=v.plotLeft-(k.translateX||0),H[1]+=v.plotTop-(k.translateY||0),V.x=Math.min(0,H[0]),V.y=Math.min(0,H[1]),V.width=H[0]<0?Math.max(Math.abs(H[0]),Y.width-H[0]):Math.max(Math.abs(H[0]),Y.width),V.height=H[1]<0?Math.max(Math.abs(H[1]),Y.height-Math.abs(H[1])):Math.max(Math.abs(H[1]),Y.height),this.tracker?this.tracker.attr(V):(this.tracker=k.renderer.rect(V).addClass("highcharts-tracker").add(k),v.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(v){return v.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(v,k){let D=v.series,V=D.tooltipOptions,H=D.xAxis,Y=H==null?void 0:H.dateTime,J={isFooter:k,point:v},ae=V.xDateFormat||"",_e=V[k?"footerFormat":"headerFormat"];return iy(this,"headerFormatter",J,function(Me){if(Y&&!ae&&L0(v.key)&&(ae=Y.getXDateFormat(v.key,V.dateTimeLabelFormats)),Y&&ae){if($d(ae)){let xe=ae;vg[0]=Pe=>D.chart.time.dateFormat(xe,Pe),ae="%0"}(v.tooltipDateKeys||["key"]).forEach(xe=>{_e=_e.replace(RegExp("point\\."+xe+"([ \\)}])"),`(point.${xe}:${ae})$1`)})}D.chart.styledMode&&(_e=this.styledModeFormat(_e)),Me.text=Oc(_e,v,this.chart)}),J.text||""}update(v){this.destroy(),this.init(this.chart,Am(!0,this.options,v))}updatePosition(v){var ki;let{chart:k,container:D,distance:V,options:H,pointer:Y,renderer:J}=this,{height:ae=0,width:_e=0}=this.getLabel(),{fixed:Me,positioner:xe}=H,{left:Pe,top:je,scaleX:Qe,scaleY:at}=Y.getChartPosition(),nt=(xe||Me&&this.getFixedPosition||this.getPosition).call(this,_e,ae,v),it=Ye.doc,wt=(v.plotX||0)+k.plotLeft,kt=(v.plotY||0)+k.plotTop,Ai;if(J&&D){if(xe||Me){let{scrollLeft:Ri=0,scrollTop:Sr=0}=((ki=k.scrollablePlotArea)==null?void 0:ki.scrollingContainer)||{};nt.x+=Ri+Pe-V,nt.y+=Sr+je-V}Ai=(H.borderWidth||0)+2*V+2,J.setSize(pp(_e+Ai,0,it.documentElement.clientWidth)-1,ae+Ai,!1),(Qe!==1||at!==1)&&(fp(D,{transform:`scale(${Qe}, ${at})`}),wt*=Qe,kt*=at),wt+=Pe-nt.x,kt+=je-nt.y}this.move(Math.round(nt.x),Math.round(nt.y||0),wt,kt)}}(function(ve){ve.compose=function(v){C_(Zu,"Core.Tooltip")&&Sd(v,"afterInit",function(){let k=this.chart;k.options.tooltip&&(k.tooltip=new ve(k,k.options.tooltip,this))})}})(Lm||(Lm={}));let mf=Lm,{animObject:Wy}=Or,{defaultOptions:bg}=$o,{format:gf}=ul,{addEvent:Vd,crisp:Td,erase:jy,extend:Ku,fireEvent:Tu,getNestedProperty:Up,isArray:gp,isFunction:Cu,isNumber:Cd,isObject:$p,merge:ry,pick:Qu,syncTimeout:gh,removeEvent:Dm,uniqueKey:Hy}=pr;class yp{animateBeforeDestroy(){let v=this,k={x:v.startXPos,opacity:0},D=v.getGraphicalProps();D.singular.forEach(function(V){v[V]=v[V].animate(V==="dataLabel"?{x:v[V].startXPos,y:v[V].startYPos,opacity:0}:k)}),D.plural.forEach(function(V){v[V].forEach(function(H){H.element&&H.animate(Ku({x:v.startXPos},H.startYPos?{x:H.startXPos,y:H.startYPos}:{}))})})}applyOptions(v,k){let D=this.series,V=D.options.pointValKey||D.pointValKey;return Ku(this,v=yp.prototype.optionsToObject.call(this,v)),this.options=this.options?Ku(this.options,v):v,v.group&&delete this.group,v.dataLabels&&delete this.dataLabels,V&&(this.y=yp.prototype.getNestedProperty.call(this,V)),this.selected&&(this.state="select"),"name"in this&&k===void 0&&D.xAxis&&D.xAxis.hasNames&&(this.x=D.xAxis.nameToX(this)),this.x===void 0&&D?this.x=k??D.autoIncrement():Cd(v.x)&&D.options.relativeXValue?this.x=D.autoIncrement(v.x):typeof this.x=="string"&&(k??(k=D.chart.time.parse(this.x)),Cd(k)&&(this.x=k)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let v=this,k=v.series,D=k.chart,V=k.options.dataSorting,H=D.hoverPoints,Y=Wy(v.series.chart.renderer.globalAnimation),J=()=>{for(let ae in(v.graphic||v.graphics||v.dataLabel||v.dataLabels)&&(Dm(v),v.destroyElements()),v)delete v[ae]};v.legendItem&&D.legend.destroyItem(v),H&&(v.setState(),jy(H,v),H.length||(D.hoverPoints=null)),v===D.hoverPoint&&v.onMouseOut(),V!=null&&V.enabled?(this.animateBeforeDestroy(),gh(J,Y.duration)):J(),D.pointCount--}this.destroyed=!0}destroyElements(v){let k=this,D=k.getGraphicalProps(v);D.singular.forEach(function(V){k[V]=k[V].destroy()}),D.plural.forEach(function(V){k[V].forEach(function(H){H!=null&&H.element&&H.destroy()}),delete k[V]})}firePointEvent(v,k,D){let V=this,H=this.series.options;V.manageEvent(v),v==="click"&&H.allowPointSelect&&(D=function(Y){!V.destroyed&&V.select&&V.select(null,Y.ctrlKey||Y.metaKey||Y.shiftKey)}),Tu(V,v,k,D)}getClassName(){var v;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((v=this.zone)!=null&&v.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(v){let k,D,V=this,H=[],Y={singular:[],plural:[]};for((v=v||{graphic:1,dataLabel:1}).graphic&&H.push("graphic","connector"),v.dataLabel&&H.push("dataLabel","dataLabelPath","dataLabelUpper"),D=H.length;D--;)V[k=H[D]]&&Y.singular.push(k);return["graphic","dataLabel"].forEach(function(J){let ae=J+"s";v[J]&&V[ae]&&Y.plural.push(ae)}),Y}getNestedProperty(v){if(v)return v.indexOf("custom.")===0?Up(v,this.options):this[v]}getZone(){let v=this.series,k=v.zones,D=v.zoneAxis||"y",V,H=0;for(V=k[0];this[D]>=V.value;)V=k[++H];return this.nonZonedColor||(this.nonZonedColor=this.color),V!=null&&V.color&&!this.options.color?this.color=V.color:this.color=this.nonZonedColor,V}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(v,k,D){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=v,this.applyOptions(k,D),this.id??(this.id=Hy()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=v.options.nullInteraction),v.chart.pointCount++,Tu(this,"afterInit")}isValid(){return(Cd(this.x)||this.x instanceof Date)&&Cd(this.y)}optionsToObject(v){var Me;let k=this.series,D=k.options.keys,V=D||k.pointArrayMap||["y"],H=V.length,Y={},J,ae=0,_e=0;if(Cd(v)||v===null)Y[V[0]]=v;else if(gp(v))for(!D&&v.length>H&&((J=typeof v[0])=="string"?(Me=k.xAxis)!=null&&Me.dateTime?Y.x=k.chart.time.parse(v[0]):Y.name=v[0]:J==="number"&&(Y.x=v[0]),ae++);_e<H;)D&&v[ae]===void 0||(V[_e].indexOf(".")>0?yp.prototype.setNestedProperty(Y,v[ae],V[_e]):Y[V[_e]]=v[ae]),ae++,_e++;else typeof v=="object"&&(Y=v,v.dataLabels&&(k.hasDataLabels=()=>!0),v.marker&&(k._hasPointMarkers=!0));return Y}pos(v,k=this.plotY){if(!this.destroyed){let{plotX:D,series:V}=this,{chart:H,xAxis:Y,yAxis:J}=V,ae=0,_e=0;if(Cd(D)&&Cd(k))return v&&(ae=Y?Y.pos:H.plotLeft,_e=J?J.pos:H.plotTop),H.inverted&&Y&&J?[J.len-k+_e,Y.len-D+ae]:[D+ae,k+_e]}}resolveColor(){let v=this.series,k=v.chart.options.chart,D=v.chart.styledMode,V,H,Y=k.colorCount,J;delete this.nonZonedColor,v.options.colorByPoint?(D||(V=(H=v.options.colors||v.chart.options.colors)[v.colorCounter],Y=H.length),J=v.colorCounter,v.colorCounter++,v.colorCounter===Y&&(v.colorCounter=0)):(D||(V=v.color),J=v.colorIndex),this.colorIndex=Qu(this.options.colorIndex,J),this.color=Qu(this.options.color,V)}setNestedProperty(v,k,D){return D.split(".").reduce(function(V,H,Y,J){let ae=J.length-1===Y;return V[H]=ae?k:$p(V[H],!0)?V[H]:{},V[H]},v),v}shouldDraw(){return!this.isNull}tooltipFormatter(v){var ae;let{chart:k,pointArrayMap:D=["y"],tooltipOptions:V}=this.series,{valueDecimals:H="",valuePrefix:Y="",valueSuffix:J=""}=V;return k.styledMode&&(v=((ae=k.tooltip)==null?void 0:ae.styledModeFormat(v))||v),D.forEach(_e=>{_e="{point."+_e,(Y||J)&&(v=v.replace(RegExp(_e+"}","g"),Y+_e+"}"+J)),v=v.replace(RegExp(_e+"}","g"),_e+":,."+H+"f}")}),gf(v,this,k)}update(v,k,D,V){let H,Y=this,J=Y.series,ae=Y.graphic,_e=J.chart,Me=J.options;function xe(){Y.applyOptions(v);let Pe=ae&&Y.hasMockGraphic,je=Y.y===null?!Pe:Pe;ae&&je&&(Y.graphic=ae.destroy(),delete Y.hasMockGraphic),$p(v,!0)&&(ae!=null&&ae.element&&v&&v.marker&&v.marker.symbol!==void 0&&(Y.graphic=ae.destroy()),v!=null&&v.dataLabels&&Y.dataLabel&&(Y.dataLabel=Y.dataLabel.destroy())),H=Y.index;let Qe={};for(let at of J.dataColumnKeys())Qe[at]=Y[at];J.dataTable.setRow(Qe,H),Me.data[H]=$p(Me.data[H],!0)||$p(v,!0)?Y.options:Qu(v,Me.data[H]),J.isDirty=J.isDirtyData=!0,!J.fixedBox&&J.hasCartesianSeries&&(_e.isDirtyBox=!0),Me.legendType==="point"&&(_e.isDirtyLegend=!0),k&&_e.redraw(D)}k=Qu(k,!0),V===!1?xe():Y.firePointEvent("update",{options:v},xe)}remove(v,k){this.series.removePoint(this.series.data.indexOf(this),v,k)}select(v,k){let D=this,V=D.series,H=V.chart;v=Qu(v,!D.selected),this.selectedStaging=v,D.firePointEvent(v?"select":"unselect",{accumulate:k},function(){D.selected=D.options.selected=v,V.options.data[V.data.indexOf(D)]=D.options,D.setState(v&&"select"),k||H.getSelectedPoints().forEach(function(Y){let J=Y.series;Y.selected&&Y!==D&&(Y.selected=Y.options.selected=!1,J.options.data[J.data.indexOf(Y)]=Y.options,Y.setState(H.hoverPoints&&J.options.inactiveOtherPoints?"inactive":""),Y.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(v){let{inverted:k,pointer:D}=this.series.chart;D&&(v=v?D.normalize(v):D.getChartCoordinatesFromPoint(this,k),D.runPointActions(v,this))}onMouseOut(){let v=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(v.hoverPoints||[]).forEach(function(k){k.setState()}),v.hoverPoints=v.hoverPoint=null}manageEvent(v){var V,H,Y,J,ae,_e,Me;let k=ry(this.series.options.point,this.options),D=(V=k.events)==null?void 0:V[v];Cu(D)&&(!((H=this.hcEvents)!=null&&H[v])||((J=(Y=this.hcEvents)==null?void 0:Y[v])==null?void 0:J.map(xe=>xe.fn).indexOf(D))===-1)?((ae=this.importedUserEvent)==null||ae.call(this),this.importedUserEvent=Vd(this,v,D),this.hcEvents&&(this.hcEvents[v].userEvent=!0)):this.importedUserEvent&&!D&&((_e=this.hcEvents)!=null&&_e[v])&&((Me=this.hcEvents)!=null&&Me[v].userEvent)&&(Dm(this,v),delete this.hcEvents[v],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(v,k){var Ri,Sr;let D=this.series,V=this.state,H=D.options.states[v||"normal"]||{},Y=bg.plotOptions[D.type].marker&&D.options.marker,J=Y&&Y.enabled===!1,ae=((Ri=Y==null?void 0:Y.states)==null?void 0:Ri[v||"normal"])||{},_e=ae.enabled===!1,Me=this.marker||{},xe=D.chart,Pe=Y&&D.markerAttribs,je=D.halo,Qe,at,nt,it=D.stateMarkerGraphic,wt;if((v=v||"")===this.state&&!k||this.selected&&v!=="select"||H.enabled===!1||v&&(_e||J&&ae.enabled===!1)||v&&Me.states&&Me.states[v]&&Me.states[v].enabled===!1)return;if(this.state=v,Pe&&(Qe=D.markerAttribs(this,v)),this.graphic&&!this.hasMockGraphic){if(V&&this.graphic.removeClass("highcharts-point-"+V),v&&this.graphic.addClass("highcharts-point-"+v),!xe.styledMode){at=D.pointAttribs(this,v),nt=Qu(xe.options.chart.animation,H.animation);let hr=at.opacity;D.options.inactiveOtherPoints&&Cd(hr)&&(this.dataLabels||[]).forEach(function(wr){wr&&!wr.hasClass("highcharts-data-label-hidden")&&(wr.animate({opacity:hr},nt),wr.connector&&wr.connector.animate({opacity:hr},nt))}),this.graphic.animate(at,nt)}Qe&&this.graphic.animate(Qe,Qu(xe.options.chart.animation,ae.animation,Y.animation)),it&&it.hide()}else v&&ae&&(wt=Me.symbol||D.symbol,it&&it.currentSymbol!==wt&&(it=it.destroy()),Qe&&(it?it[k?"animate":"attr"]({x:Qe.x,y:Qe.y}):wt&&(D.stateMarkerGraphic=it=xe.renderer.symbol(wt,Qe.x,Qe.y,Qe.width,Qe.height,ry(Y,ae)).add(D.markerGroup),it.currentSymbol=wt)),!xe.styledMode&&it&&this.state!=="inactive"&&it.attr(D.pointAttribs(this,v))),it&&(it[v&&this.isInside?"show":"hide"](),it.element.point=this,it.addClass(this.getClassName(),!0));let kt=H.halo,Ai=this.graphic||it,ki=(Ai==null?void 0:Ai.visibility)||"inherit";kt!=null&&kt.size&&Ai&&ki!=="hidden"&&!this.isCluster?(je||(D.halo=je=xe.renderer.path().add(Ai.parentGroup)),je.show()[k?"animate":"attr"]({d:this.haloPath(kt.size)}),je.attr({class:"highcharts-halo highcharts-color-"+Qu(this.colorIndex,D.colorIndex)+(this.className?" "+this.className:""),visibility:ki,zIndex:-1}),je.point=this,xe.styledMode||je.attr(Ku({fill:this.color||D.color,"fill-opacity":kt.opacity},rn.filterUserAttributes(kt.attributes||{})))):(Sr=je==null?void 0:je.point)!=null&&Sr.haloPath&&!je.point.destroyed&&je.animate({d:je.point.haloPath(0)},null,je.hide),Tu(this,"afterSetState",{state:v})}haloPath(v){let k=this.pos();return k?this.series.chart.renderer.symbols.circle(Td(k[0],1)-v,k[1]-v,2*v,2*v):[]}}let yf=yp,{parse:Xf}=Un,{charts:jl,composed:Eu,isTouchDevice:Zf}=Ye,{addEvent:gl,attr:ny,css:Ed,extend:ku,find:_p,fireEvent:yl,isNumber:_f,isObject:Au,objectEach:Vp,offset:mn,pick:Ec,pushUnique:D0,splat:mu}=pr;class Hl{applyInactiveState(v=[]){let k=[];v.forEach(D=>{let V=D.series;k.push(V),V.linkedParent&&k.push(V.linkedParent),V.linkedSeries&&k.push.apply(k,V.linkedSeries),V.navigatorSeries&&k.push(V.navigatorSeries),V.boosted&&V.markerGroup&&k.push.apply(k,this.chart.series.filter(H=>H.markerGroup===V.markerGroup))}),this.chart.series.forEach(D=>{k.indexOf(D)===-1?D.setState("inactive",!0):D.options.inactiveOtherPoints&&D.setAllPointsToState("inactive")})}destroy(){let v=this;this.eventsToUnbind.forEach(k=>k()),this.eventsToUnbind=[],!Ye.chartCount&&(Hl.unbindDocumentMouseUp.forEach(k=>k.unbind()),Hl.unbindDocumentMouseUp.length=0,Hl.unbindDocumentTouchEnd&&(Hl.unbindDocumentTouchEnd=Hl.unbindDocumentTouchEnd())),clearInterval(v.tooltipTimeout),Vp(v,function(k,D){v[D]=void 0})}getSelectionMarkerAttrs(v,k){let D={args:{chartX:v,chartY:k},attrs:{},shapeType:"rect"};return yl(this,"getSelectionMarkerAttrs",D,V=>{let H,{chart:Y,zoomHor:J,zoomVert:ae}=this,{mouseDownX:_e=0,mouseDownY:Me=0}=Y,xe=V.attrs;xe.x=Y.plotLeft,xe.y=Y.plotTop,xe.width=J?1:Y.plotWidth,xe.height=ae?1:Y.plotHeight,J&&(xe.width=Math.max(1,Math.abs(H=v-_e)),xe.x=(H>0?0:H)+_e),ae&&(xe.height=Math.max(1,Math.abs(H=k-Me)),xe.y=(H>0?0:H)+Me)}),D}drag(v){let{chart:k}=this,{mouseDownX:D=0,mouseDownY:V=0}=k,{panning:H,panKey:Y,selectionMarkerFill:J}=k.options.chart,ae=k.plotLeft,_e=k.plotTop,Me=k.plotWidth,xe=k.plotHeight,Pe=Au(H)?H.enabled:H,je=Y&&v[`${Y}Key`],Qe=v.chartX,at=v.chartY,nt,it=this.selectionMarker;if((!it||!it.touch)&&(Qe<ae?Qe=ae:Qe>ae+Me&&(Qe=ae+Me),at<_e?at=_e:at>_e+xe&&(at=_e+xe),this.hasDragged=Math.sqrt(Math.pow(D-Qe,2)+Math.pow(V-at,2)),this.hasDragged>10)){nt=k.isInsidePlot(D-ae,V-_e,{visiblePlotOnly:!0});let{shapeType:wt,attrs:kt}=this.getSelectionMarkerAttrs(Qe,at);this.hasZoom&&nt&&!je&&!it&&(this.selectionMarker=it=k.renderer[wt](),it.attr({class:"highcharts-selection-marker",zIndex:7}).add(),k.styledMode||it.attr({fill:J||Xf("#334eff").setOpacity(.25).get()})),it&&it.attr(kt),nt&&!it&&Pe&&k.pan(v,H)}}dragStart(v){let k=this.chart;k.mouseIsDown=v.type,k.cancelClick=!1,k.mouseDownX=v.chartX,k.mouseDownY=v.chartY}getSelectionBox(v){let k={args:{marker:v},result:v.getBBox()};return yl(this,"getSelectionBox",k),k.result}drop(v){let k,{chart:D,selectionMarker:V}=this;for(let H of D.axes)H.isPanning&&(H.isPanning=!1,(H.options.startOnTick||H.options.endOnTick||H.series.some(Y=>Y.boosted))&&(H.forceRedraw=!0,H.setExtremes(H.userMin,H.userMax,!1),k=!0));if(k&&D.redraw(),V&&v){if(this.hasDragged){let H=this.getSelectionBox(V);D.transform({axes:D.axes.filter(Y=>Y.zoomEnabled&&(Y.coll==="xAxis"&&this.zoomX||Y.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:v,xAxis:[],yAxis:[],...H},from:H})}_f(D.index)&&(this.selectionMarker=V.destroy())}D&&_f(D.index)&&(Ed(D.container,{cursor:D._cursor}),D.cancelClick=this.hasDragged>10,D.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(v,k,D){let V;return v.forEach(function(H){let Y=!(H.noSharedTooltip&&k)&&0>H.options.findNearestPointBy.indexOf("y"),J=H.searchPoint(D,Y);Au(J,!0)&&J.series&&(!Au(V,!0)||function(ae,_e){var je,Qe;let Me=ae.distX-_e.distX,xe=ae.dist-_e.dist,Pe=((je=_e.series.group)==null?void 0:je.zIndex)-((Qe=ae.series.group)==null?void 0:Qe.zIndex);return Me!==0&&k?Me:xe!==0?xe:Pe!==0?Pe:ae.series.index>_e.series.index?-1:1}(V,J)>0)&&(V=J)}),V}getChartCoordinatesFromPoint(v,k){let{xAxis:D,yAxis:V}=v.series,H=v.shapeArgs;if(D&&V){let Y=v.clientX??v.plotX??0,J=v.plotY||0;return v.isNode&&H&&_f(H.x)&&_f(H.y)&&(Y=H.x,J=H.y),k?{chartX:V.len+V.pos-J,chartY:D.len+D.pos-Y}:{chartX:Y+D.pos,chartY:J+V.pos}}if(H!=null&&H.x&&H.y)return{chartX:H.x,chartY:H.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:v}=this.chart,k=mn(v);this.chartPosition={left:k.left,top:k.top,scaleX:1,scaleY:1};let{offsetHeight:D,offsetWidth:V}=v;return V>2&&D>2&&(this.chartPosition.scaleX=k.width/V,this.chartPosition.scaleY=k.height/D),this.chartPosition}getCoordinates(v){let k={xAxis:[],yAxis:[]};for(let D of this.chart.axes)k[D.isXAxis?"xAxis":"yAxis"].push({axis:D,value:D.toValue(v[D.horiz?"chartX":"chartY"])});return k}getHoverData(v,k,D,V,H,Y){let J=[],ae=function(je){return je.visible&&!(!H&&je.directTouch)&&Ec(je.options.enableMouseTracking,!0)},_e=k,Me,xe={chartX:Y?Y.chartX:void 0,chartY:Y?Y.chartY:void 0,shared:H};yl(this,"beforeGetHoverData",xe),Me=_e&&!_e.stickyTracking?[_e]:D.filter(je=>je.stickyTracking&&(xe.filter||ae)(je));let Pe=V&&v||!Y?v:this.findNearestKDPoint(Me,H,Y);return _e=Pe==null?void 0:Pe.series,Pe&&(H&&!_e.noSharedTooltip?(Me=D.filter(function(je){return xe.filter?xe.filter(je):ae(je)&&!je.noSharedTooltip})).forEach(function(je){var nt;let Qe=(nt=je.options)==null?void 0:nt.nullInteraction,at=_p(je.points,function(it){return it.x===Pe.x&&(!it.isNull||!!Qe)});Au(at)&&(je.boosted&&je.boost&&(at=je.boost.getPoint(at)),J.push(at))}):J.push(Pe)),yl(this,"afterGetHoverData",xe={hoverPoint:Pe}),{hoverPoint:xe.hoverPoint,hoverSeries:_e,hoverPoints:J}}getPointFromEvent(v){let k=v.target,D;for(;k&&!D;)D=k.point,k=k.parentNode;return D}onTrackerMouseOut(v){let k=this.chart,D=v.relatedTarget,V=k.hoverSeries;this.isDirectTouch=!1,!V||!D||V.stickyTracking||this.inClass(D,"highcharts-tooltip")||this.inClass(D,"highcharts-series-"+V.index)&&this.inClass(D,"highcharts-tracker")||V.onMouseOut()}inClass(v,k){let D=v,V;for(;D;){if(V=ny(D,"class")){if(V.indexOf(k)!==-1)return!0;if(V.indexOf("highcharts-container")!==-1)return!1}D=D.parentElement}}constructor(v,k){var D;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=k,this.chart=v,this.runChartClick=!!((D=k.chart.events)!=null&&D.click),this.pinchDown=[],this.setDOMEvents(),yl(this,"afterInit")}normalize(v,k){let D=v.touches,V=D?D.length?D.item(0):Ec(D.changedTouches,v.changedTouches)[0]:v;k||(k=this.getChartPosition());let H=V.pageX-k.left,Y=V.pageY-k.top;return ku(v,{chartX:Math.round(H/=k.scaleX),chartY:Math.round(Y/=k.scaleY)})}onContainerClick(v){let k=this.chart,D=k.hoverPoint,V=this.normalize(v),H=k.plotLeft,Y=k.plotTop;!k.cancelClick&&(D&&this.inClass(V.target,"highcharts-tracker")?(yl(D.series,"click",ku(V,{point:D})),k.hoverPoint&&D.firePointEvent("click",V)):(ku(V,this.getCoordinates(V)),k.isInsidePlot(V.chartX-H,V.chartY-Y,{visiblePlotOnly:!0})&&yl(k,"click",V)))}onContainerMouseDown(v){var D;let k=(1&(v.buttons||v.button))==1;v=this.normalize(v),Ye.isFirefox&&v.button!==0&&this.onContainerMouseMove(v),(v.button===void 0||k)&&(this.zoomOption(v),k&&((D=v.preventDefault)==null||D.call(v)),this.dragStart(v))}onContainerMouseLeave(v){let{pointer:k}=jl[Ec(Hl.hoverChartIndex,-1)]||{};v=this.normalize(v),this.onContainerMouseMove(v),k&&!this.inClass(v.relatedTarget,"highcharts-tooltip")&&(k.reset(),k.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(v){var H;let k=this.chart,D=k.tooltip,V=this.normalize(v);this.setHoverChartIndex(v),(k.mouseIsDown==="mousedown"||this.touchSelect(V))&&this.drag(V),!((H=k.exporting)!=null&&H.openMenu)&&(this.inClass(V.target,"highcharts-tracker")||k.isInsidePlot(V.chartX-k.plotLeft,V.chartY-k.plotTop,{visiblePlotOnly:!0}))&&!(D!=null&&D.shouldStickOnContact(V))&&(this.inClass(V.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(V))}onDocumentTouchEnd(v){this.onDocumentMouseUp(v)}onContainerTouchMove(v){this.touchSelect(v)?this.onContainerMouseMove(v):this.touch(v)}onContainerTouchStart(v){this.touchSelect(v)?this.onContainerMouseDown(v):(this.zoomOption(v),this.touch(v,!0))}onDocumentMouseMove(v){let k=this.chart,D=k.tooltip,V=this.chartPosition,H=this.normalize(v,V);!V||k.isInsidePlot(H.chartX-k.plotLeft,H.chartY-k.plotTop,{visiblePlotOnly:!0})||D!=null&&D.shouldStickOnContact(H)||H.target!==k.container.ownerDocument&&this.inClass(H.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(v){var k,D;(D=(k=jl[Ec(Hl.hoverChartIndex,-1)])==null?void 0:k.pointer)==null||D.drop(v)}pinch(v){let k=this,{chart:D,hasZoom:V,lastTouches:H}=k,Y=[].map.call(v.touches||[],xe=>k.normalize(xe)),J=Y.length,ae=J===1&&(k.inClass(v.target,"highcharts-tracker")&&D.runTrackerClick||k.runChartClick),_e=D.tooltip,Me=J===1&&Ec(_e==null?void 0:_e.options.followTouchMove,!0);J>1?k.initiated=!0:Me&&(k.initiated=!1),V&&k.initiated&&!ae&&v.cancelable!==!1&&v.preventDefault(),v.type==="touchstart"?(k.pinchDown=Y,k.res=!0,D.mouseDownX=v.chartX):Me?this.runPointActions(k.normalize(v)):H&&(yl(D,"touchpan",{originalEvent:v,touches:Y},()=>{let xe=Pe=>{let je=Pe[0],Qe=Pe[1]||je;return{x:je.chartX,y:je.chartY,width:Qe.chartX-je.chartX,height:Qe.chartY-je.chartY}};D.transform({axes:D.axes.filter(Pe=>Pe.zoomEnabled&&(this.zoomHor&&Pe.horiz||this.zoomVert&&!Pe.horiz)),to:xe(Y),from:xe(H),trigger:v.type})}),k.res&&(k.res=!1,this.reset(!1,0))),k.lastTouches=Y}reset(v,k){let D=this.chart,V=D.hoverSeries,H=D.hoverPoint,Y=D.hoverPoints,J=D.tooltip,ae=J!=null&&J.shared?Y:H;v&&ae&&mu(ae).forEach(function(_e){_e.series.isCartesian&&_e.plotX===void 0&&(v=!1)}),v?J&&ae&&mu(ae).length&&(J.refresh(ae),J.shared&&Y?Y.forEach(function(_e){_e.setState(_e.state,!0),_e.series.isCartesian&&(_e.series.xAxis.crosshair&&_e.series.xAxis.drawCrosshair(null,_e),_e.series.yAxis.crosshair&&_e.series.yAxis.drawCrosshair(null,_e))}):H&&(H.setState(H.state,!0),D.axes.forEach(function(_e){_e.crosshair&&H.series[_e.coll]===_e&&_e.drawCrosshair(null,H)}))):(H&&H.onMouseOut(),Y&&Y.forEach(function(_e){_e.setState()}),V&&V.onMouseOut(),J&&J.hide(k),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),D.axes.forEach(function(_e){_e.hideCrosshair()}),D.hoverPoints=D.hoverPoint=void 0)}runPointActions(v,k,D){var at;let V=this.chart,H=V.series,Y=(at=V.tooltip)!=null&&at.options.enabled?V.tooltip:void 0,J=!!Y&&Y.shared,ae=k||V.hoverPoint,_e=(ae==null?void 0:ae.series)||V.hoverSeries,Me=(!v||v.type!=="touchmove")&&(!!k||(_e==null?void 0:_e.directTouch)&&this.isDirectTouch),xe=this.getHoverData(ae,_e,H,Me,J,v);ae=xe.hoverPoint,_e=xe.hoverSeries;let Pe=xe.hoverPoints,je=(_e==null?void 0:_e.tooltipOptions.followPointer)&&!_e.tooltipOptions.split,Qe=J&&_e&&!_e.noSharedTooltip;if(ae&&(D||ae!==V.hoverPoint||Y!=null&&Y.isHidden)){if((V.hoverPoints||[]).forEach(function(nt){Pe.indexOf(nt)===-1&&nt.setState()}),V.hoverSeries!==_e&&_e.onMouseOver(),this.applyInactiveState(Pe),(Pe||[]).forEach(function(nt){nt.setState("hover")}),V.hoverPoint&&V.hoverPoint.firePointEvent("mouseOut"),!ae.series)return;V.hoverPoints=Pe,V.hoverPoint=ae,ae.firePointEvent("mouseOver",void 0,()=>{Y&&ae&&Y.refresh(Qe?Pe:ae,v)})}else if(je&&Y&&!Y.isHidden){let nt=Y.getAnchor([{}],v);V.isInsidePlot(nt[0],nt[1],{visiblePlotOnly:!0})&&Y.updatePosition({plotX:nt[0],plotY:nt[1]})}this.unDocMouseMove||(this.unDocMouseMove=gl(V.container.ownerDocument,"mousemove",nt=>{var it,wt;return(wt=(it=jl[Hl.hoverChartIndex??-1])==null?void 0:it.pointer)==null?void 0:wt.onDocumentMouseMove(nt)}),this.eventsToUnbind.push(this.unDocMouseMove)),V.axes.forEach(function(nt){var kt;let it,wt=((kt=nt.crosshair)==null?void 0:kt.snap)??!0;wt&&((it=V.hoverPoint)&&it.series[nt.coll]===nt||(it=_p(Pe,Ai=>{var ki;return((ki=Ai.series)==null?void 0:ki[nt.coll])===nt}))),it||!wt?nt.drawCrosshair(v,it):nt.hideCrosshair()})}setDOMEvents(){let v=this.chart.container,k=v.ownerDocument;v.onmousedown=this.onContainerMouseDown.bind(this),v.onmousemove=this.onContainerMouseMove.bind(this),v.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(gl(v,"mouseenter",this.onContainerMouseEnter.bind(this)),gl(v,"mouseleave",this.onContainerMouseLeave.bind(this))),Hl.unbindDocumentMouseUp.some(V=>V.doc===k)||Hl.unbindDocumentMouseUp.push({doc:k,unbind:gl(k,"mouseup",this.onDocumentMouseUp.bind(this))});let D=this.chart.renderTo.parentElement;for(;D&&D.tagName!=="BODY";)this.eventsToUnbind.push(gl(D,"scroll",()=>{delete this.chartPosition})),D=D.parentElement;this.eventsToUnbind.push(gl(v,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),gl(v,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Hl.unbindDocumentTouchEnd||(Hl.unbindDocumentTouchEnd=gl(k,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),gl(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var H,Y;if(!Zf)return;let v=this.pointerCaptureEventsToUnbind,k=this.chart,D=k.container,V=Ec((H=k.options.tooltip)==null?void 0:H.followTouchMove,!0)&&k.series.some(J=>J.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&V?(v.push(gl(D,"pointerdown",J=>{var ae,_e;(ae=J.target)!=null&&ae.hasPointerCapture(J.pointerId)&&((_e=J.target)==null||_e.releasePointerCapture(J.pointerId))}),gl(D,"pointermove",J=>{var ae,_e;(_e=(ae=k.pointer)==null?void 0:ae.getPointFromEvent(J))==null||_e.onMouseOver(J)})),k.styledMode||Ed(D,{"touch-action":"none"}),D.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!V&&(v.forEach(J=>J()),v.length=0,k.styledMode||Ed(D,{"touch-action":Ec((Y=k.options.chart.style)==null?void 0:Y["touch-action"],"manipulation")}),D.className=D.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(v){var V;let k=this.chart,D=Ye.charts[Ec(Hl.hoverChartIndex,-1)];if(D&&D!==k){let H={relatedTarget:k.container};v&&!(v!=null&&v.relatedTarget)&&Object.assign({},v,H),(V=D.pointer)==null||V.onContainerMouseLeave(v||H)}D!=null&&D.mouseIsDown||(Hl.hoverChartIndex=k.index)}touch(v,k){var Y;let D,{chart:V,pinchDown:H=[]}=this;this.setHoverChartIndex(),(v=this.normalize(v)).touches.length===1?V.isInsidePlot(v.chartX-V.plotLeft,v.chartY-V.plotTop,{visiblePlotOnly:!0})&&!((Y=V.exporting)!=null&&Y.openMenu)?(k&&this.runPointActions(v),v.type==="touchmove"&&(D=!!H[0]&&Math.pow(H[0].chartX-v.chartX,2)+Math.pow(H[0].chartY-v.chartY,2)>=16),Ec(D,!0)&&this.pinch(v)):k&&this.reset():v.touches.length===2&&this.pinch(v)}touchSelect(v){return!!(this.chart.zooming.singleTouch&&v.touches&&v.touches.length===1)}zoomOption(v){let k=this.chart,D=k.inverted,V=k.zooming.type||"",H,Y;/touch/.test(v.type)&&(V=Ec(k.zooming.pinchType,V)),this.zoomX=H=/x/.test(V),this.zoomY=Y=/y/.test(V),this.zoomHor=H&&!D||Y&&D,this.zoomVert=Y&&!D||H&&D,this.hasZoom=H||Y}}Hl.unbindDocumentMouseUp=[],function(ve){ve.compose=function(v){D0(Eu,"Core.Pointer")&&gl(v,"beforeRender",function(){this.pointer=new ve(this,this.options)})}}(Hl||(Hl={}));let $n=Hl;(function(ve){ve.setLength=function(v,k,D){return Array.isArray(v)?(v.length=k,v):v[D?"subarray":"slice"](0,k)},ve.splice=function(v,k,D,V,H=[]){if(Array.isArray(v))return Array.isArray(H)||(H=Array.from(H)),{removed:v.splice(k,D,...H),array:v};let Y=Object.getPrototypeOf(v).constructor,J=v[V?"subarray":"slice"](k,k+D),ae=new Y(v.length-D+H.length);return ae.set(v.subarray(0,k),0),ae.set(H,k),ae.set(v.subarray(k+D),k+H.length),{removed:J,array:ae}}})(G||(G={}));let{setLength:kd,splice:Wp}=G,{fireEvent:Pm,objectEach:Kf,uniqueKey:vf}=pr,Mu=class{constructor(ve={}){this.autoId=!ve.id,this.columns={},this.id=ve.id||vf(),this.modified=this,this.rowCount=0,this.versionTag=vf();let v=0;Kf(ve.columns||{},(k,D)=>{this.columns[D]=k.slice(),v=Math.max(v,k.length)}),this.applyRowCount(v)}applyRowCount(ve){this.rowCount=ve,Kf(this.columns,(v,k)=>{v.length!==ve&&(this.columns[k]=kd(v,ve))})}deleteRows(ve,v=1){if(v>0&&ve<this.rowCount){let k=0;Kf(this.columns,(D,V)=>{this.columns[V]=Wp(D,ve,v).array,k=D.length}),this.rowCount=k}Pm(this,"afterDeleteRows",{rowIndex:ve,rowCount:v}),this.versionTag=vf()}getColumn(ve,v){return this.columns[ve]}getColumns(ve,v){return(ve||Object.keys(this.columns)).reduce((k,D)=>(k[D]=this.columns[D],k),{})}getRow(ve,v){return(v||Object.keys(this.columns)).map(k=>{var D;return(D=this.columns[k])==null?void 0:D[ve]})}setColumn(ve,v=[],k=0,D){this.setColumns({[ve]:v},k,D)}setColumns(ve,v,k){let D=this.rowCount;Kf(ve,(V,H)=>{this.columns[H]=V.slice(),D=V.length}),this.applyRowCount(D),k!=null&&k.silent||(Pm(this,"afterSetColumns"),this.versionTag=vf())}setRow(ve,v=this.rowCount,k,D){let{columns:V}=this,H=k?this.rowCount+1:v+1;Kf(ve,(Y,J)=>{let ae=V[J]||(D==null?void 0:D.addColumns)!==!1&&Array(H);ae&&(k?ae=Wp(ae,v,0,!0,[Y]).array:ae[v]=Y,V[J]=ae)}),H>this.rowCount&&this.applyRowCount(H),D!=null&&D.silent||(Pm(this,"afterSetRows"),this.versionTag=vf())}},{extend:P0,merge:O0,pick:dh}=pr;(function(ve){function v(k,D,V){var Ai,ki;let H=this.legendItem=this.legendItem||{},{chart:Y,options:J}=this,{baseline:ae=0,symbolWidth:_e,symbolHeight:Me}=k,xe=this.symbol||"circle",Pe=Me/2,je=Y.renderer,Qe=H.group,at=ae-Math.round((((Ai=k.fontMetrics)==null?void 0:Ai.b)||Me)*(V?.4:.3)),nt={},it,wt=J.marker,kt=0;if(Y.styledMode||(nt["stroke-width"]=Math.min(J.lineWidth||0,24),J.dashStyle?nt.dashstyle=J.dashStyle:J.linecap!=="square"&&(nt["stroke-linecap"]="round")),H.line=je.path().addClass("highcharts-graph").attr(nt).add(Qe),V&&(H.area=je.path().addClass("highcharts-area").add(Qe)),nt["stroke-linecap"]&&(kt=Math.min(H.line.strokeWidth(),_e)/2),_e){let Ri=[["M",kt,at],["L",_e-kt,at]];H.line.attr({d:Ri}),(ki=H.area)==null||ki.attr({d:[...Ri,["L",_e-kt,ae],["L",kt,ae]]})}if(wt&&wt.enabled!==!1&&_e){let Ri=Math.min(dh(wt.radius,Pe),Pe);xe.indexOf("url")===0&&(wt=O0(wt,{width:Me,height:Me}),Ri=0),H.symbol=it=je.symbol(xe,_e/2-Ri,at-Ri,2*Ri,2*Ri,P0({context:"legend"},wt)).addClass("highcharts-point").add(Qe),it.isMarker=!0}}ve.areaMarker=function(k,D){v.call(this,k,D,!0)},ve.lineMarker=v,ve.rectangle=function(k,D){let V=D.legendItem||{},H=k.options,Y=k.symbolHeight,J=H.squareSymbol,ae=J?Y:k.symbolWidth;V.symbol=this.chart.renderer.rect(J?(k.symbolWidth-Y)/2:0,k.baseline-Y+1,ae,Y,dh(k.options.symbolRadius,Y/2)).addClass("highcharts-point").attr({zIndex:3}).add(V.group)}})(q||(q={}));let Uh=q,{defaultOptions:Om}=$o,{extend:$h,extendClass:Ju,merge:Ad}=pr;(function(ve){function v(k,D){let V=Om.plotOptions||{},H=D.defaultOptions,Y=D.prototype;return Y.type=k,Y.pointClass||(Y.pointClass=yf),!ve.seriesTypes[k]&&(H&&(V[k]=H),ve.seriesTypes[k]=D,!0)}ve.seriesTypes=Ye.seriesTypes,ve.registerSeriesType=v,ve.seriesType=function(k,D,V,H,Y){let J=Om.plotOptions||{};if(D=D||"",J[k]=Ad(J[D],V),delete ve.seriesTypes[k],v(k,Ju(ve.seriesTypes[D]||function(){},H)),ve.seriesTypes[k].prototype.type=k,Y){class ae extends yf{}$h(ae.prototype,Y),ve.seriesTypes[k].prototype.pointClass=ae}return ve.seriesTypes[k]}})(Q||(Q={}));let Cl=Q,{animObject:Wd,setAnimation:jp}=Or,{defaultOptions:wg}=$o,{registerEventOptions:jd}=ho,{svg:sa,win:Rm}=Ye,{seriesTypes:Iu}=Cl,{format:R0}=ul,{arrayMax:Nm,arrayMin:Ia,clamp:Sg,correctFloat:Qf,crisp:Md,defined:Wi,destroyObjectProperties:cn,diffObjects:Jf,erase:ha,error:wi,extend:kh,find:Tg,fireEvent:La,getClosestDistance:sy,getNestedProperty:Bm,insertItem:kc,isArray:xf,isNumber:ph,isString:Lu,merge:Jh,objectEach:ed,pick:nc,removeEvent:Gl,syncTimeout:oy}=pr;class Vh{constructor(){this.zoneAxis="y"}init(v,k){var ae,_e,Me;let D;La(this,"init",{options:k}),this.dataTable??(this.dataTable=new Mu);let V=v.series;this.eventsToUnbind=[],this.chart=v,this.options=this.setOptions(k);let H=this.options,Y=H.visible!==!1;this.linkedSeries=[],this.bindAxes(),kh(this,{name:H.name,state:"",visible:Y,selected:H.selected===!0}),jd(this,H);let J=H.events;(J!=null&&J.click||(_e=(ae=H.point)==null?void 0:ae.events)!=null&&_e.click||H.allowPointSelect)&&(v.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(v.hasCartesianSeries=!0),V.length&&(D=V[V.length-1]),this._i=nc(D==null?void 0:D._i,-1)+1,this.opacity=this.options.opacity,v.orderItems("series",kc(this,V)),(Me=H.dataSorting)!=null&&Me.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(H.data,!1),La(this,"afterInit")}is(v){return Iu[v]&&this instanceof Iu[v]}bindAxes(){let v,k=this,D=k.options,V=k.chart;La(this,"bindAxes",null,function(){(k.axisTypes||[]).forEach(function(H){(V[H]||[]).forEach(function(Y){v=Y.options,(nc(D[H],0)===Y.index||D[H]!==void 0&&D[H]===v.id)&&(kc(k,Y.series),k[H]=Y,Y.isDirty=!0)}),k[H]||k.optionalAxis===H||wi(18,!0,V)})}),La(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(v,k){let D=v.marker,V=k.marker||{};return D&&(V.enabled&&!D.enabled||V.symbol!==D.symbol||V.height!==D.height||V.width!==D.width)}autoIncrement(v){let k,D=this.options,{pointIntervalUnit:V,relativeXValue:H}=this.options,Y=this.chart.time,J=this.xIncrement??Y.parse(D.pointStart)??0;if(this.pointInterval=k=nc(this.pointInterval,D.pointInterval,1),H&&ph(v)&&(k*=v),V){let ae=Y.toParts(J);V==="day"?ae[2]+=k:V==="month"?ae[1]+=k:V==="year"&&(ae[0]+=k),k=Y.makeTime.apply(Y,ae)-J}return H&&ph(v)?J+k:(this.xIncrement=J+k,J)}setDataSortingOptions(){let v=this.options;kh(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Wi(v.pointRange)||(v.pointRange=1)}setOptions(v){var nt,it;let k,D=this.chart,V=D.options.plotOptions,H=D.userOptions||{},Y=Jh(v),J=D.styledMode,ae={plotOptions:V,userOptions:Y};La(this,"setOptions",ae);let _e=ae.plotOptions[this.type],Me=H.plotOptions||{},xe=Me.series||{},Pe=wg.plotOptions[this.type]||{},je=Me[this.type]||{};_e.dataLabels=this.mergeArrays(Pe.dataLabels,_e.dataLabels),this.userOptions=ae.userOptions;let Qe=Jh(_e,V.series,je,Y);this.tooltipOptions=Jh(wg.tooltip,(nt=wg.plotOptions.series)==null?void 0:nt.tooltip,Pe==null?void 0:Pe.tooltip,D.userOptions.tooltip,(it=Me.series)==null?void 0:it.tooltip,je.tooltip,Y.tooltip),this.stickyTracking=nc(Y.stickyTracking,je.stickyTracking,xe.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Qe.stickyTracking),_e.marker===null&&delete Qe.marker,this.zoneAxis=Qe.zoneAxis||"y";let at=this.zones=(Qe.zones||[]).map(wt=>({...wt}));return(Qe.negativeColor||Qe.negativeFillColor)&&!Qe.zones&&(k={value:Qe[this.zoneAxis+"Threshold"]||Qe.threshold||0,className:"highcharts-negative"},J||(k.color=Qe.negativeColor,k.fillColor=Qe.negativeFillColor),at.push(k)),at.length&&Wi(at[at.length-1].value)&&at.push(J?{}:{color:this.color,fillColor:this.fillColor}),La(this,"afterSetOptions",{options:Qe}),Qe}getName(){return this.options.name??R0(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(v,k,D){let V,H,Y=this.chart,J=`${v}Index`,ae=`${v}Counter`,_e=(D==null?void 0:D.length)||Y.options.chart.colorCount;!k&&(Wi(H=nc(v==="color"?this.options.colorIndex:void 0,this[J]))?V=H:(Y.series.length||(Y[ae]=0),V=Y[ae]%_e,Y[ae]+=1),D&&(k=D[V])),V!==void 0&&(this[J]=V),this[v]=k}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||wg.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let v=this.options.marker;this.getCyclic("symbol",v.symbol,this.chart.options.symbols)}getColumn(v,k){return(k?this.dataTable.modified:this.dataTable).getColumn(v,!0)||[]}findPointIndex(v,k){var xe;let D,V,H,{id:Y,x:J}=v,ae=this.points,_e=this.options.dataSorting,Me=this.cropStart||0;if(Y){let Pe=this.chart.get(Y);Pe instanceof yf&&(D=Pe)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let Pe=je=>!je.touched&&je.index===v.index;if(_e!=null&&_e.matchByName?Pe=je=>!je.touched&&je.name===v.name:this.options.relativeXValue&&(Pe=je=>!je.touched&&je.options.x===v.x),!(D=Tg(ae,Pe)))return}return D&&(H=D==null?void 0:D.index)!==void 0&&(V=!0),H===void 0&&ph(J)&&(H=this.getColumn("x").indexOf(J,k)),H!==-1&&H!==void 0&&this.cropped&&(H=H>=Me?H-Me:H),!V&&ph(H)&&((xe=ae[H])!=null&&xe.touched)&&(H=void 0),H}updateData(v,k){var at;let{options:D,requireSorting:V}=this,H=D.dataSorting,Y=this.points,J=[],ae=v.length===Y.length,_e,Me,xe,Pe,je=!0;if(this.xIncrement=null,v.forEach((nt,it)=>{var Ri;let wt,kt=Wi(nt)&&this.pointClass.prototype.optionsToObject.call({series:this},nt)||{},{id:Ai,x:ki}=kt;Ai||ph(ki)?((wt=this.findPointIndex(kt,Pe))===-1||wt===void 0?J.push(nt):Y[wt]&&nt!==((Ri=D.data)==null?void 0:Ri[wt])?(Y[wt].update(nt,!1,void 0,!1),Y[wt].touched=!0,V&&(Pe=wt+1)):Y[wt]&&(Y[wt].touched=!0),(!ae||it!==wt||H!=null&&H.enabled||this.hasDerivedData)&&(_e=!0)):J.push(nt)},this),_e)for(Me=Y.length;Me--;)(xe=Y[Me])&&!xe.touched&&((at=xe.remove)==null||at.call(xe,!1,k));else ae&&!(H!=null&&H.enabled)?(v.forEach((nt,it)=>{nt===Y[it].y||Y[it].destroyed||Y[it].update(nt,!1,void 0,!1)}),J.length=0):je=!1;if(Y.forEach(nt=>{nt&&(nt.touched=!1)}),!je)return!1;J.forEach(nt=>{this.addPoint(nt,!1,void 0,void 0,!1)},this);let Qe=this.getColumn("x");return this.xIncrement===null&&Qe.length&&(this.xIncrement=Nm(Qe),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(v,k=!0,D,V){var Sr,hr;let H=this.points,Y=(H==null?void 0:H.length)||0,J=this.options,ae=this.chart,_e=J.dataSorting,Me=this.xAxis,xe=J.turboThreshold,Pe=this.dataTable,je=this.dataColumnKeys(),Qe=this.pointValKey||"y",at=(this.pointArrayMap||[]).length,nt=J.keys,it,wt,kt=0,Ai=1,ki;ae.options.chart.allowMutatingData||(J.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,ki=Jh(!0,v));let Ri=(v=ki||v||[]).length;if(_e!=null&&_e.enabled&&(v=this.sortData(v)),ae.options.chart.allowMutatingData&&V!==!1&&Ri&&Y&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(wt=this.updateData(v,D)),!wt){this.xIncrement=null,this.colorCounter=0;let wr=xe&&!J.relativeXValue&&Ri>xe;if(wr){let Jr=this.getFirstValidPoint(v),yn=this.getFirstValidPoint(v,Ri-1,-1),Rn=fn=>!!(xf(fn)&&(nt||ph(fn[0])));if(ph(Jr)&&ph(yn)){let fn=[],ms=[];for(let hs of v)fn.push(this.autoIncrement()),ms.push(hs);Pe.setColumns({x:fn,[Qe]:ms})}else if(Rn(Jr)&&Rn(yn))if(at){let fn=+(Jr.length===at),ms=Array(je.length).fill(0).map(()=>[]);for(let hs of v){fn&&ms[0].push(this.autoIncrement());for(let Is=fn;Is<=at;Is++)(Sr=ms[Is])==null||Sr.push(hs[Is-fn])}Pe.setColumns(je.reduce((hs,Is,jn)=>(hs[Is]=ms[jn],hs),{}))}else{nt&&(kt=nt.indexOf("x"),Ai=nt.indexOf("y"),kt=kt>=0?kt:0,Ai=Ai>=0?Ai:1),Jr.length===1&&(Ai=0);let fn=[],ms=[];if(kt===Ai)for(let hs of v)fn.push(this.autoIncrement()),ms.push(hs[Ai]);else for(let hs of v)fn.push(hs[kt]),ms.push(hs[Ai]);Pe.setColumns({x:fn,[Qe]:ms})}else wr=!1}if(!wr){let Jr=je.reduce((yn,Rn)=>(yn[Rn]=[],yn),{});for(it=0;it<Ri;it++){let yn=this.pointClass.prototype.applyOptions.apply({series:this},[v[it]]);for(let Rn of je)Jr[Rn][it]=yn[Rn]}Pe.setColumns(Jr)}for(Lu(this.getColumn("y")[0])&&wi(14,!0,ae),this.data=[],this.options.data=this.userOptions.data=v,it=Y;it--;)(hr=H[it])==null||hr.destroy();Me&&(Me.minRange=Me.userMinRange),this.isDirty=ae.isDirtyBox=!0,this.isDirtyData=!!H,D=!1}J.legendType==="point"&&(this.processData(),this.generatePoints()),k&&ae.redraw(D)}sortData(v){let k=this,D=k.options.dataSorting.sortKey||"y",V=function(H,Y){return Wi(Y)&&H.pointClass.prototype.optionsToObject.call({series:H},Y)||{}};return v.forEach(function(H,Y){v[Y]=V(k,H),v[Y].index=Y},this),v.concat().sort((H,Y)=>{let J=Bm(D,H),ae=Bm(D,Y);return ae<J?-1:+(ae>J)}).forEach(function(H,Y){H.x=Y},this),k.linkedSeries&&k.linkedSeries.forEach(function(H){var ae;let Y=H.options,J=Y.data;!((ae=Y.dataSorting)!=null&&ae.enabled)&&J&&(J.forEach(function(_e,Me){J[Me]=V(H,_e),v[Me]&&(J[Me].x=v[Me].x,J[Me].index=Me)}),H.setData(J,!1))}),v}getProcessedData(v){let k=this,{dataTable:D,isCartesian:V,options:H,xAxis:Y}=k,J=H.cropThreshold,ae=v||k.getExtremesFromAll,_e=Y==null?void 0:Y.logarithmic,Me=D.rowCount,xe,Pe,je=0,Qe,at,nt,it=k.getColumn("x"),wt=D,kt=!1;return Y&&(at=(Qe=Y.getExtremes()).min,nt=Qe.max,kt=!!(Y.categories&&!Y.names.length),V&&k.sorted&&!ae&&(!J||Me>J||k.forceCrop)&&(it[Me-1]<at||it[0]>nt?wt=new Mu:k.getColumn(k.pointValKey||"y").length&&(it[0]<at||it[Me-1]>nt)&&(wt=(xe=this.cropData(D,at,nt)).modified,je=xe.start,Pe=!0))),it=wt.getColumn("x")||[],{modified:wt,cropped:Pe,cropStart:je,closestPointRange:sy([_e?it.map(_e.log2lin):it],()=>k.requireSorting&&!kt&&wi(15,!1,k.chart))}}processData(v){let k=this.xAxis,D=this.dataTable;if(this.isCartesian&&!this.isDirty&&!k.isDirty&&!this.yAxis.isDirty&&!v)return!1;let V=this.getProcessedData();D.modified=V.modified,this.cropped=V.cropped,this.cropStart=V.cropStart,this.closestPointRange=this.basePointRange=V.closestPointRange,La(this,"afterProcessData")}cropData(v,k,D){let V=v.getColumn("x",!0)||[],H=V.length,Y={},J,ae,_e=0,Me=H;for(J=0;J<H;J++)if(V[J]>=k){_e=Math.max(0,J-1);break}for(ae=J;ae<H;ae++)if(V[ae]>D){Me=ae+1;break}for(let xe of this.dataColumnKeys()){let Pe=v.getColumn(xe,!0);Pe&&(Y[xe]=Pe.slice(_e,Me))}return{modified:new Mu({columns:Y}),start:_e,end:Me}}generatePoints(){var ki,Ri,Sr;let v=this.options,k=this.processedData||v.data,D=this.dataTable.modified,V=this.getColumn("x",!0),H=this.pointClass,Y=D.rowCount,J=this.cropStart||0,ae=this.hasGroupedData,_e=v.keys,Me=[],xe=(ki=v.dataGrouping)!=null&&ki.groupAll?J:0,Pe=(Ri=this.xAxis)==null?void 0:Ri.categories,je=this.pointArrayMap||["y"],Qe=this.dataColumnKeys(),at,nt,it,wt,kt=this.data,Ai;if(!kt&&!ae){let hr=[];hr.length=(k==null?void 0:k.length)||0,kt=this.data=hr}for(_e&&ae&&(this.options.keys=!1),wt=0;wt<Y;wt++)nt=J+wt,ae?((it=new H(this,D.getRow(wt,Qe)||[])).dataGroup=this.groupMap[xe+wt],(Sr=it.dataGroup)!=null&&Sr.options&&(it.options=it.dataGroup.options,kh(it,it.dataGroup.options),delete it.dataLabels)):(it=kt[nt],Ai=k?k[nt]:D.getRow(wt,je),it||Ai===void 0||(kt[nt]=it=new H(this,Ai,V[wt]))),it&&(it.index=ae?xe+wt:nt,Me[wt]=it,it.category=(Pe==null?void 0:Pe[it.x])??it.x,it.key=it.name??it.category);if(this.options.keys=_e,kt&&(Y!==(at=kt.length)||ae))for(wt=0;wt<at;wt++)wt!==J||ae||(wt+=Y),kt[wt]&&(kt[wt].destroyElements(),kt[wt].plotX=void 0);this.data=kt,this.points=Me,La(this,"afterGeneratePoints")}getXExtremes(v){return{min:Ia(v),max:Nm(v)}}getExtremes(v,k){var ki;let{xAxis:D,yAxis:V}=this,H=k||this.getExtremesFromAll||this.options.getExtremesFromAll,Y=H&&this.cropped?this.dataTable:this.dataTable.modified,J=Y.rowCount,ae=v||this.stackedYData,_e=ae?[ae]:((ki=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:ki.map(Ri=>Y.getColumn(Ri,!0)||[]))||[],Me=this.getColumn("x",!0),xe=[],Pe=this.requireSorting&&!this.is("column")?1:0,je=!!V&&V.positiveValuesOnly,Qe=H||this.cropped||!D,at,nt,it,wt=0,kt=0;for(D&&(wt=(at=D.getExtremes()).min,kt=at.max),it=0;it<J;it++)if(nt=Me[it],Qe||(Me[it+Pe]||nt)>=wt&&(Me[it-Pe]||nt)<=kt)for(let Ri of _e){let Sr=Ri[it];ph(Sr)&&(Sr>0||!je)&&xe.push(Sr)}let Ai={activeYData:xe,dataMin:Ia(xe),dataMax:Nm(xe)};return La(this,"afterGetExtremes",{dataExtremes:Ai}),Ai}applyExtremes(){let v=this.getExtremes();return this.dataMin=v.dataMin,this.dataMax=v.dataMax,v}getFirstValidPoint(v,k=0,D=1){let V=v.length,H=k;for(;H>=0&&H<V;){if(Wi(v[H]))return v[H];H+=D}}translate(){var kt;this.generatePoints();let v=this.options,k=v.stacking,D=this.xAxis,V=this.enabledDataSorting,H=this.yAxis,Y=this.points,J=Y.length,ae=this.pointPlacementToXValue(),_e=!!ae,Me=v.threshold,xe=v.startFromThreshold?Me:0,Pe=(v==null?void 0:v.nullInteraction)&&H.len,je,Qe,at,nt,it=Number.MAX_VALUE;function wt(Ai){return Sg(Ai,-1e9,1e9)}for(je=0;je<J;je++){let Ai,ki=Y[je],Ri=ki.x,Sr,hr,wr=ki.y,Jr=ki.low,yn=k&&((kt=H.stacking)==null?void 0:kt.stacks[(this.negStacks&&wr<(xe?0:Me)?"-":"")+this.stackKey]);ki.plotX=ph(Qe=D.translate(Ri,!1,!1,!1,!0,ae))?Qf(wt(Qe)):void 0,k&&this.visible&&yn&&yn[Ri]&&(nt=this.getStackIndicator(nt,Ri,this.index),!ki.isNull&&nt.key&&(hr=(Sr=yn[Ri]).points[nt.key]),Sr&&xf(hr)&&(Jr=hr[0],wr=hr[1],Jr===xe&&nt.key===yn[Ri].base&&(Jr=nc(ph(Me)?Me:H.min)),H.positiveValuesOnly&&Wi(Jr)&&Jr<=0&&(Jr=void 0),ki.total=ki.stackTotal=nc(Sr.total),ki.percentage=Wi(ki.y)&&Sr.total?ki.y/Sr.total*100:void 0,ki.stackY=wr,this.irregularWidths||Sr.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),ki.yBottom=Wi(Jr)?wt(H.translate(Jr,!1,!0,!1,!0)):void 0,this.dataModify&&(wr=this.dataModify.modifyValue(wr,je)),ph(wr)&&ki.plotX!==void 0?Ai=ph(Ai=H.translate(wr,!1,!0,!1,!0))?wt(Ai):void 0:!ph(wr)&&Pe&&(Ai=Pe),ki.plotY=Ai,ki.isInside=this.isPointInside(ki),ki.clientX=_e?Qf(D.translate(Ri,!1,!1,!1,!0,ae)):Qe,ki.negative=(ki.y||0)<(Me||0),ki.isNull||ki.visible===!1||(at!==void 0&&(it=Math.min(it,Math.abs(Qe-at))),at=Qe),ki.zone=this.zones.length?ki.getZone():void 0,!ki.graphic&&this.group&&V&&(ki.isNew=!0)}this.closestPointRangePx=it,La(this,"afterTranslate")}getValidPoints(v,k,D){let V=this.chart;return(v||this.points||[]).filter(function(H){let{plotX:Y,plotY:J}=H;return(!!D||!H.isNull&&!!ph(J))&&(!k||!!V.isInsidePlot(Y,J,{inverted:V.inverted}))&&H.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:v,group:k,markerGroup:D}=this,V=v.sharedClips,H=v.renderer,Y=v.getClipBox(this),J=this.getSharedClipKey(),ae=V[J];ae?ae.animate(Y):V[J]=ae=H.clipRect(Y),k&&k.clip(this.options.clip===!1?void 0:ae),D&&D.clip()}animate(v){let{chart:k,group:D,markerGroup:V}=this,H=k.inverted,Y=Wd(this.options.animation),J=[this.getSharedClipKey(),Y.duration,Y.easing,Y.defer].join(","),ae=k.sharedClips[J],_e=k.sharedClips[J+"m"];if(v&&D){let Me=k.getClipBox(this);if(ae)ae.attr("height",Me.height);else{Me.width=0,H&&(Me.x=k.plotHeight),ae=k.renderer.clipRect(Me),k.sharedClips[J]=ae;let xe={x:-99,y:-99,width:H?k.plotWidth+199:99,height:H?99:k.plotHeight+199};_e=k.renderer.clipRect(xe),k.sharedClips[J+"m"]=_e}D.clip(ae),V==null||V.clip(_e)}else if(ae&&!ae.hasClass("highcharts-animating")){let Me=k.getClipBox(this),xe=Y.step;(V!=null&&V.element.childNodes.length||k.series.length>1)&&(Y.step=function(Pe,je){xe&&xe.apply(je,arguments),je.prop==="width"&&(_e!=null&&_e.element)&&_e.attr(H?"height":"width",Pe+99)}),ae.addClass("highcharts-animating").animate(Me,Y)}}afterAnimate(){this.setClip(),ed(this.chart.sharedClips,(v,k,D)=>{v&&!this.chart.container.querySelector(`[clip-path="url(#${v.id})"]`)&&(v.destroy(),delete D[k])}),this.finishedAnimating=!0,La(this,"afterAnimate")}drawPoints(v=this.points){let k,D,V,H,Y,J,ae,_e=this.chart,Me=_e.styledMode,{colorAxis:xe,options:Pe}=this,je=Pe.marker,Qe=Pe.nullInteraction,at=this[this.specialGroup||"markerGroup"],nt=this.xAxis,it=nc(je.enabled,!nt||!!nt.isRadial||null,this.closestPointRangePx>=je.enabledThreshold*je.radius);if(je.enabled!==!1||this._hasPointMarkers)for(k=0;k<v.length;k++){H=(V=(D=v[k]).graphic)?"animate":"attr",Y=D.marker||{},J=!!D.marker;let wt=D.isNull;if((it&&!Wi(Y.enabled)||Y.enabled)&&(!wt||Qe)&&D.visible!==!1){let kt=nc(Y.symbol,this.symbol,"rect");ae=this.markerAttribs(D,D.selected&&"select"),this.enabledDataSorting&&(D.startXPos=nt.reversed?-(ae.width||0):nt.width);let Ai=D.isInside!==!1;if(!V&&Ai&&((ae.width||0)>0||D.hasImage)&&(D.graphic=V=_e.renderer.symbol(kt,ae.x,ae.y,ae.width,ae.height,J?Y:je).add(at),this.enabledDataSorting&&_e.hasRendered&&(V.attr({x:D.startXPos}),H="animate")),V&&H==="animate"&&V[Ai?"show":"hide"](Ai).animate(ae),V){let ki=this.pointAttribs(D,Me||!D.selected?void 0:"select");Me?xe&&V.css({fill:ki.fill}):V[H](ki)}V&&V.addClass(D.getClassName(),!0)}else V&&(D.graphic=V.destroy())}}markerAttribs(v,k){let D=this.options,V=D.marker,H=v.marker||{},Y=H.symbol||V.symbol,J={},ae,_e,Me=nc(H.radius,V==null?void 0:V.radius);k&&(ae=V.states[k],_e=H.states&&H.states[k],Me=nc(_e==null?void 0:_e.radius,ae==null?void 0:ae.radius,Me&&Me+((ae==null?void 0:ae.radiusPlus)||0))),v.hasImage=Y&&Y.indexOf("url")===0,v.hasImage&&(Me=0);let xe=v.pos();return ph(Me)&&xe&&(D.crisp&&(xe[0]=Md(xe[0],v.hasImage?0:Y==="rect"?(V==null?void 0:V.lineWidth)||0:1)),J.x=xe[0]-Me,J.y=xe[1]-Me),Me&&(J.width=J.height=2*Me),J}pointAttribs(v,k){var it;let D=this.options,V=D.marker,H=v==null?void 0:v.options,Y=(H==null?void 0:H.marker)||{},J=H==null?void 0:H.color,ae=v==null?void 0:v.color,_e=(it=v==null?void 0:v.zone)==null?void 0:it.color,Me,xe,Pe=this.color,je,Qe,at=nc(Y.lineWidth,V.lineWidth),nt=v!=null&&v.isNull&&D.nullInteraction?0:1;return Pe=J||_e||ae||Pe,je=Y.fillColor||V.fillColor||Pe,Qe=Y.lineColor||V.lineColor||Pe,k=k||"normal",Me=V.states[k]||{},at=nc((xe=Y.states&&Y.states[k]||{}).lineWidth,Me.lineWidth,at+nc(xe.lineWidthPlus,Me.lineWidthPlus,0)),je=xe.fillColor||Me.fillColor||je,Qe=xe.lineColor||Me.lineColor||Qe,{stroke:Qe,"stroke-width":at,fill:je,opacity:nt=nc(xe.opacity,Me.opacity,nt)}}destroy(v){var ae,_e;let k,D,V=this,H=V.chart,Y=/AppleWebKit\/533/.test(Rm.navigator.userAgent),J=V.data||[];for(La(V,"destroy",{keepEventsForUpdate:v}),this.removeEvents(v),(V.axisTypes||[]).forEach(function(Me){D=V[Me],D!=null&&D.series&&(ha(D.series,V),D.isDirty=D.forceRedraw=!0)}),V.legendItem&&V.chart.legend.destroyItem(V),k=J.length;k--;)(_e=(ae=J[k])==null?void 0:ae.destroy)==null||_e.call(ae);for(let Me of V.zones)cn(Me,void 0,!0);pr.clearTimeout(V.animationTimeout),ed(V,function(Me,xe){Me instanceof Cc&&!Me.survive&&Me[Y&&xe==="group"?"hide":"destroy"]()}),H.hoverSeries===V&&(H.hoverSeries=void 0),ha(H.series,V),H.orderItems("series"),ed(V,function(Me,xe){v&&xe==="hcEvents"||delete V[xe]})}applyZones(){let{area:v,chart:k,graph:D,zones:V,points:H,xAxis:Y,yAxis:J,zoneAxis:ae}=this,{inverted:_e,renderer:Me}=k,xe=this[`${ae}Axis`],{isXAxis:Pe,len:je=0,minPointOffset:Qe=0}=xe||{},at=((D==null?void 0:D.strokeWidth())||0)/2+1,nt=(it,wt=0,kt=0)=>{_e&&(kt=je-kt);let{translated:Ai=0,lineClip:ki}=it,Ri=kt-Ai;ki==null||ki.push(["L",wt,Math.abs(Ri)<at?kt-at*(Ri<=0?-1:1):Ai])};if(V.length&&(D||v)&&xe&&ph(xe.min)){let it=xe.getExtremes().max+Qe,wt=ki=>{ki.forEach((Ri,Sr)=>{(Ri[0]==="M"||Ri[0]==="L")&&(ki[Sr]=[Ri[0],Pe?je-Ri[1]:Ri[1],Pe?Ri[2]:je-Ri[2]])})};if(V.forEach(ki=>{ki.lineClip=[],ki.translated=Sg(xe.toPixels(nc(ki.value,it),!0)||0,0,je)}),D&&!this.showLine&&D.hide(),v&&v.hide(),ae==="y"&&H.length<Y.len)for(let ki of H){let{plotX:Ri,plotY:Sr,zone:hr}=ki,wr=hr&&V[V.indexOf(hr)-1];hr&&nt(hr,Ri,Sr),wr&&nt(wr,Ri,Sr)}let kt=[],Ai=xe.toPixels(xe.getExtremes().min-Qe,!0);V.forEach(ki=>{var Is,jn;let Ri=ki.lineClip||[],Sr=Math.round(ki.translated||0);Y.reversed&&Ri.reverse();let{clip:hr,simpleClip:wr}=ki,Jr=0,yn=0,Rn=Y.len,fn=J.len;Pe?(Jr=Sr,Rn=Ai):(yn=Sr,fn=Ai);let ms=[["M",Jr,yn],["L",Rn,yn],["L",Rn,fn],["L",Jr,fn],["Z"]],hs=[ms[0],...Ri,ms[1],ms[2],...kt,ms[3],ms[4]];kt=Ri.reverse(),Ai=Sr,_e&&(wt(hs),v&&wt(ms)),hr?(hr.animate({d:hs}),wr==null||wr.animate({d:ms})):(hr=ki.clip=Me.path(hs),v&&(wr=ki.simpleClip=Me.path(ms))),D&&((Is=ki.graph)==null||Is.clip(hr)),v&&((jn=ki.area)==null||jn.clip(wr))})}else this.visible&&(D&&D.show(),v&&v.show())}plotGroup(v,k,D,V,H){let Y=this[v],J=!Y,ae={visibility:D,zIndex:V||.1};return Wi(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(ae.opacity=this.opacity),Y||(this[v]=Y=this.chart.renderer.g().add(H)),Y.addClass("highcharts-"+k+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Wi(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(Y.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),Y.attr(ae)[J?"attr":"animate"](this.getPlotBox(k)),Y}getPlotBox(v){let k=this.xAxis,D=this.yAxis,V=this.chart,H=V.inverted&&!V.polar&&k&&this.invertible&&v==="series";V.inverted&&(k=D,D=this.xAxis);let Y={scale:1,translateX:k?k.left:V.plotLeft,translateY:D?D.top:V.plotTop,name:v};La(this,"getPlotBox",Y);let{scale:J,translateX:ae,translateY:_e}=Y;return{translateX:ae,translateY:_e,rotation:90*!!H,rotationOriginX:H?J*(k.len-D.len)/2:0,rotationOriginY:H?J*(k.len+D.len)/2:0,scaleX:H?-J:J,scaleY:J}}removeEvents(v){let{eventsToUnbind:k}=this;v||Gl(this),k.length&&(k.forEach(D=>{D()}),k.length=0)}render(){var Me,xe,Pe,je,Qe;let v=this,{chart:k,options:D,hasRendered:V}=v,H=Wd(D.animation),Y=v.visible?"inherit":"hidden",J=D.zIndex,ae=k.seriesGroup,_e=v.finishedAnimating?0:H.duration;La(this,"render"),v.plotGroup("group","series",Y,J,ae),v.markerGroup=v.plotGroup("markerGroup","markers",Y,J,ae),D.clip!==!1&&v.setClip(),_e&&((Me=v.animate)==null||Me.call(v,!0)),v.drawGraph&&(v.drawGraph(),v.applyZones()),v.visible&&v.drawPoints(),(xe=v.drawDataLabels)==null||xe.call(v),(Pe=v.redrawPoints)==null||Pe.call(v),D.enableMouseTracking&&((je=v.drawTracker)==null||je.call(v)),_e&&((Qe=v.animate)==null||Qe.call(v)),V||(_e&&H.defer&&(_e+=H.defer),v.animationTimeout=oy(()=>{v.afterAnimate()},_e||0)),v.isDirty=!1,v.hasRendered=!0,La(v,"afterRender")}redraw(){let v=this.isDirty||this.isDirtyData;this.translate(),this.render(),v&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(v,k){let{xAxis:D,yAxis:V}=this,H=this.chart.inverted;return this.searchKDTree({clientX:H?D.len-v.chartY+D.pos:v.chartX-D.pos,plotY:H?V.len-v.chartX+V.pos:v.chartY-V.pos},k,v)}buildKDTree(v){this.buildingKdTree=!0;let k=this,D=k.options,V=D.findNearestPointBy.indexOf("y")>-1?2:1;delete k.kdTree,oy(function(){k.kdTree=function H(Y,J,ae){let _e,Me,xe=Y==null?void 0:Y.length;if(xe)return _e=k.kdAxisArray[J%ae],Y.sort((Pe,je)=>(Pe[_e]||0)-(je[_e]||0)),{point:Y[Me=Math.floor(xe/2)],left:H(Y.slice(0,Me),J+1,ae),right:H(Y.slice(Me+1),J+1,ae)}}(k.getValidPoints(void 0,!k.directTouch,D==null?void 0:D.nullInteraction),V,V),k.buildingKdTree=!1},D.kdNow||(v==null?void 0:v.type)==="touchstart"?0:1)}searchKDTree(v,k,D,V,H){let Y=this,[J,ae]=this.kdAxisArray,_e=k?"distX":"dist",Me=(Y.options.findNearestPointBy||"").indexOf("y")>-1?2:1,xe=!!Y.isBubble,Pe=V||((Qe,at,nt)=>{let it=Qe[nt]||0,wt=at[nt]||0;return[it===wt&&Qe.index>at.index||it<wt?Qe:at,!1]}),je=H||((Qe,at)=>Qe<at);if(this.kdTree||this.buildingKdTree||this.buildKDTree(D),this.kdTree)return function Qe(at,nt,it,wt){var Jr;let kt=nt.point,Ai=Y.kdAxisArray[it%wt],ki=kt,Ri=!1;(function(yn,Rn){var Ea;let fn=yn[J],ms=Rn[J],hs=Wi(fn)&&Wi(ms)?fn-ms:null,Is=yn[ae],jn=Rn[ae],us=Wi(Is)&&Wi(jn)?Is-jn:0,oa=xe&&((Ea=Rn.marker)==null?void 0:Ea.radius)||0;Rn.dist=Math.sqrt((hs&&hs*hs||0)+us*us)-oa,Rn.distX=Wi(hs)?Math.abs(hs)-oa:Number.MAX_VALUE})(at,kt);let Sr=(at[Ai]||0)-(kt[Ai]||0)+(xe&&((Jr=kt.marker)==null?void 0:Jr.radius)||0),hr=Sr<0?"left":"right",wr=Sr<0?"right":"left";return nt[hr]&&([ki,Ri]=Pe(kt,Qe(at,nt[hr],it+1,wt),_e)),nt[wr]&&je(Math.sqrt(Sr*Sr),ki[_e],Ri)&&(ki=Pe(ki,Qe(at,nt[wr],it+1,wt),_e)[0]),ki}(v,this.kdTree,Me,Me)}pointPlacementToXValue(){let{options:v,xAxis:k}=this,D=v.pointPlacement;return D==="between"&&(D=k.reversed?-.5:.5),ph(D)?D*(v.pointRange||k.pointRange):0}isPointInside(v){let{chart:k,xAxis:D,yAxis:V}=this,{plotX:H=-1,plotY:Y=-1}=v;return Y>=0&&Y<=(V?V.len:k.plotHeight)&&H>=0&&H<=(D?D.len:k.plotWidth)}drawTracker(){var Pe;let v=this,k=v.options,D=k.trackByArea,V=[].concat((D?v.areaPath:v.graphPath)||[]),H=v.chart,Y=H.pointer,J=H.renderer,ae=((Pe=H.options.tooltip)==null?void 0:Pe.snap)||0,_e=()=>{k.enableMouseTracking&&H.hoverSeries!==v&&v.onMouseOver()},Me="rgba(192,192,192,"+(sa?1e-4:.002)+")",xe=v.tracker;xe?xe.attr({d:V}):v.graph&&(v.tracker=xe=J.path(V).attr({visibility:v.visible?"inherit":"hidden",zIndex:2}).addClass(D?"highcharts-tracker-area":"highcharts-tracker-line").add(v.group),H.styledMode||xe.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:Me,fill:D?Me:"none","stroke-width":v.graph.strokeWidth()+(D?0:2*ae)}),[v.tracker,v.markerGroup,v.dataLabelsGroup].forEach(je=>{je&&(je.addClass("highcharts-tracker").on("mouseover",_e).on("mouseout",Qe=>{Y==null||Y.onTrackerMouseOut(Qe)}),k.cursor&&!H.styledMode&&je.css({cursor:k.cursor}),je.on("touchstart",_e))})),La(this,"afterDrawTracker")}addPoint(v,k,D,V,H){let Y,J,ae=this.options,{chart:_e,data:Me,dataTable:xe,xAxis:Pe}=this,je=(Pe==null?void 0:Pe.hasNames)&&Pe.names,Qe=ae.data,at=this.getColumn("x");k=nc(k,!0);let nt={series:this};this.pointClass.prototype.applyOptions.apply(nt,[v]);let it=nt.x;if(J=at.length,this.requireSorting&&it<at[J-1])for(Y=!0;J&&at[J-1]>it;)J--;xe.setRow(nt,J,!0,{addColumns:!1}),je&&nt.name&&(je[it]=nt.name),Qe==null||Qe.splice(J,0,v),(Y||this.processedData)&&(this.data.splice(J,0,null),this.processData()),ae.legendType==="point"&&this.generatePoints(),D&&(Me[0]&&Me[0].remove?Me[0].remove(!1):([Me,Qe].filter(Wi).forEach(wt=>{wt.shift()}),xe.deleteRows(0))),H!==!1&&La(this,"addPoint",{point:nt}),this.isDirty=!0,this.isDirtyData=!0,k&&_e.redraw(V)}removePoint(v,k,D){let V=this,{chart:H,data:Y,points:J,dataTable:ae}=V,_e=Y[v],Me=function(){[(J==null?void 0:J.length)===Y.length?J:void 0,Y,V.options.data].filter(Wi).forEach(xe=>{xe.splice(v,1)}),ae.deleteRows(v),_e==null||_e.destroy(),V.isDirty=!0,V.isDirtyData=!0,k&&H.redraw()};jp(D,H),k=nc(k,!0),_e?_e.firePointEvent("remove",null,Me):Me()}remove(v,k,D,V){let H=this,Y=H.chart;function J(){H.destroy(V),Y.isDirtyLegend=Y.isDirtyBox=!0,Y.linkSeries(V),nc(v,!0)&&Y.redraw(k)}D!==!1?La(H,"remove",null,J):J()}update(v,k){var it,wt;La(this,"update",{options:v=Jf(v,this.userOptions)});let D=this,V=D.chart,H=D.userOptions,Y=D.initialType||D.type,J=V.options.plotOptions,ae=Iu[Y].prototype,_e=D.finishedAnimating&&{animation:!1},Me={},xe,Pe,je=Vh.keepProps.slice(),Qe=v.type||H.type||V.options.chart.type,at=!(this.hasDerivedData||Qe&&Qe!==this.type||v.keys!==void 0||v.pointStart!==void 0||v.pointInterval!==void 0||v.relativeXValue!==void 0||v.joinBy||v.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(kt=>D.hasOptionChanged(kt)));Qe=Qe||Y,at?(je.push.apply(je,Vh.keepPropsForPoints),v.visible!==!1&&je.push("area","graph"),D.parallelArrays.forEach(function(kt){je.push(kt+"Data")}),v.data&&(v.dataSorting&&kh(D.options.dataSorting,v.dataSorting),this.setData(v.data,!1))):this.dataTable.modified=this.dataTable,v=Jh(H,{index:H.index===void 0?D.index:H.index,pointStart:((it=J==null?void 0:J.series)==null?void 0:it.pointStart)??H.pointStart??D.getColumn("x")[0]},!at&&{data:D.options.data},v,_e),at&&v.data&&(v.data=D.options.data),(je=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(je)).forEach(function(kt){je[kt]=D[kt],delete D[kt]});let nt=!1;if(Iu[Qe]){if(nt=Qe!==D.type,D.remove(!1,!1,!1,!0),nt)if(V.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(D,Iu[Qe].prototype);else{let kt=Object.hasOwnProperty.call(D,"hcEvents")&&D.hcEvents;for(Pe in ae)D[Pe]=void 0;kh(D,Iu[Qe].prototype),kt?D.hcEvents=kt:delete D.hcEvents}}else wi(17,!0,V,{missingModuleFor:Qe});if(je.forEach(function(kt){D[kt]=je[kt]}),D.init(V,v),at&&this.points)for(let kt of((xe=D.options).visible===!1?(Me.graphic=1,Me.dataLabel=1):(this.hasMarkerChanged(xe,H)&&(Me.graphic=1),(wt=D.hasDataLabels)!=null&&wt.call(D)||(Me.dataLabel=1)),this.points))kt!=null&&kt.series&&(kt.resolveColor(),Object.keys(Me).length&&kt.destroyElements(Me),xe.showInLegend===!1&&kt.legendItem&&V.legend.destroyItem(kt));D.initialType=Y,V.linkSeries(),V.setSortedData(),nt&&D.linkedSeries.length&&(D.isDirtyData=!0),La(this,"afterUpdate"),nc(k,!0)&&V.redraw(!!at&&void 0)}setName(v){this.name=this.options.name=this.userOptions.name=v,this.chart.isDirtyLegend=!0}hasOptionChanged(v){var J,ae;let k=this.chart,D=this.options[v],V=k.options.plotOptions,H=this.userOptions[v],Y=nc((J=V==null?void 0:V[this.type])==null?void 0:J[v],(ae=V==null?void 0:V.series)==null?void 0:ae[v]);return H&&!Wi(Y)?D!==H:D!==nc(Y,D)}onMouseOver(){let v=this.chart,k=v.hoverSeries,D=v.pointer;D==null||D.setHoverChartIndex(),k&&k!==this&&k.onMouseOut(),this.options.events.mouseOver&&La(this,"mouseOver"),this.setState("hover"),v.hoverSeries=this}onMouseOut(){let v=this.options,k=this.chart,D=k.tooltip,V=k.hoverPoint;k.hoverSeries=null,V&&V.onMouseOut(),this&&v.events.mouseOut&&La(this,"mouseOut"),D&&!this.stickyTracking&&(!D.shared||this.noSharedTooltip)&&D.hide(),k.series.forEach(function(H){H.setState("",!0)})}setState(v,k){let D=this,V=D.options,H=D.graph,Y=V.inactiveOtherPoints,J=V.states,ae=nc(J[v||"normal"]&&J[v||"normal"].animation,D.chart.options.chart.animation),_e=V.lineWidth,Me=V.opacity;if(v=v||"",D.state!==v&&([D.group,D.markerGroup,D.dataLabelsGroup].forEach(function(xe){xe&&(D.state&&xe.removeClass("highcharts-series-"+D.state),v&&xe.addClass("highcharts-series-"+v))}),D.state=v,!D.chart.styledMode)){if(J[v]&&J[v].enabled===!1)return;if(v&&(_e=J[v].lineWidth||_e+(J[v].lineWidthPlus||0),Me=nc(J[v].opacity,Me)),H&&!H.dashstyle&&ph(_e))for(let xe of[H,...this.zones.map(Pe=>Pe.graph)])xe==null||xe.animate({"stroke-width":_e},ae);Y||[D.group,D.markerGroup,D.dataLabelsGroup,D.labelBySeries].forEach(function(xe){xe&&xe.animate({opacity:Me},ae)})}k&&Y&&D.points&&D.setAllPointsToState(v||void 0)}setAllPointsToState(v){this.points.forEach(function(k){k.setState&&k.setState(v)})}setVisible(v,k){var ae;let D=this,V=D.chart,H=V.options.chart.ignoreHiddenSeries,Y=D.visible;D.visible=v=D.options.visible=D.userOptions.visible=v===void 0?!Y:v;let J=v?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(_e=>{var Me;(Me=D[_e])==null||Me[J]()}),(V.hoverSeries===D||((ae=V.hoverPoint)==null?void 0:ae.series)===D)&&D.onMouseOut(),D.legendItem&&V.legend.colorizeItem(D,v),D.isDirty=!0,D.options.stacking&&V.series.forEach(_e=>{_e.options.stacking&&_e.visible&&(_e.isDirty=!0)}),D.linkedSeries.forEach(_e=>{_e.setVisible(v,!1)}),H&&(V.isDirtyBox=!0),La(D,J),k!==!1&&V.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(v){this.selected=v=this.options.selected=v===void 0?!this.selected:v,this.checkbox&&(this.checkbox.checked=v),La(this,v?"select":"unselect")}shouldShowTooltip(v,k,D={}){return D.series=this,D.visiblePlotOnly=!0,this.chart.isInsidePlot(v,k,D)}drawLegendSymbol(v,k){var D;(D=Uh[this.options.legendSymbol||"rectangle"])==null||D.call(this,v,k)}}Vh.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:ve}=this.series.chart;return typeof this.y!="number"?"":ve(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},Vh.types=Cl.seriesTypes,Vh.registerType=Cl.registerSeriesType,Vh.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Vh.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],kh(Vh.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:yf,requireSorting:!0,sorted:!0}),Cl.series=Vh;let yh=Vh,{animObject:vp,setAnimation:Rc}=Or,{registerEventOptions:eu}=ho,{composed:th,marginNames:Hd}=Ye,{distribute:ql}=Cs,{format:Va}=ul,{addEvent:lo,createElement:td,css:Vc,defined:em,discardElement:tm,find:xp,fireEvent:Gd,isNumber:im,merge:id,pick:sc,pushUnique:Wc,relativeLength:bf,stableSort:Cg,syncTimeout:Hp}=pr;class rd{constructor(v,k){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=v,this.setOptions(k),k.enabled&&(this.render(),eu(this,k),lo(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),lo(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(v){let k=sc(v.padding,8);this.options=v,this.chart.styledMode||(this.itemStyle=v.itemStyle,this.itemHiddenStyle=id(this.itemStyle,v.itemHiddenStyle)),this.itemMarginTop=v.itemMarginTop,this.itemMarginBottom=v.itemMarginBottom,this.padding=k,this.initialItemY=k-5,this.symbolWidth=sc(v.symbolWidth,16),this.pages=[],this.proximate=v.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(v,k){let D=this.chart;this.setOptions(id(!0,this.options,v)),"events"in this.options&&eu(this,this.options),this.destroy(),D.isDirtyLegend=D.isDirtyBox=!0,sc(k,!0)&&D.redraw(),Gd(this,"afterUpdate",{redraw:k})}colorizeItem(v,k){var _e;let D=v.color,{area:V,group:H,label:Y,line:J,symbol:ae}=v.legendItem||{};if((v instanceof yh||v instanceof yf)&&(v.color=((_e=v.options)==null?void 0:_e.legendSymbolColor)||D),H==null||H[k?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:Me={}}=this,xe=Me.color,{fillColor:Pe,fillOpacity:je,lineColor:Qe,marker:at}=v.options,nt=it=>(!k&&(it.fill&&(it.fill=xe),it.stroke&&(it.stroke=xe)),it);Y==null||Y.css(id(k?this.itemStyle:Me)),J==null||J.attr(nt({stroke:Qe||v.color})),ae&&ae.attr(nt(at&&ae.isMarker?v.pointAttribs():{fill:v.color})),V==null||V.attr(nt({fill:Pe||v.color,"fill-opacity":Pe?1:je??.75}))}v.color=D,Gd(this,"afterColorizeItem",{item:v,visible:k})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(v){let{group:k,x:D=0,y:V=0}=v.legendItem||{},H=this.options,Y=H.symbolPadding,J=!H.rtl,ae=v.checkbox;if(k!=null&&k.element){let _e={translateX:J?D:this.legendWidth-D-2*Y-4,translateY:V};k[em(k.translateY)?"animate":"attr"](_e,void 0,()=>{Gd(this,"afterPositionItem",{item:v})})}ae&&(ae.x=D,ae.y=V)}destroyItem(v){let k=v.checkbox,D=v.legendItem||{};for(let V of["group","label","line","symbol"])D[V]&&(D[V]=D[V].destroy());k&&tm(k),v.legendItem=void 0}destroy(){for(let v of this.getAllItems())this.destroyItem(v);for(let v of["clipRect","up","down","pager","nav","box","title","group"])this[v]&&(this[v]=this[v].destroy());this.display=null}positionCheckboxes(){var H;let v,k=(H=this.group)==null?void 0:H.alignAttr,D=this.clipHeight||this.legendHeight,V=this.titleHeight;k&&(v=k.translateY,this.allItems.forEach(function(Y){let J,ae=Y.checkbox;ae&&(J=v+V+ae.y+(this.scrollOffset||0)+3,Vc(ae,{left:k.translateX+Y.checkboxOffset+ae.x-20+"px",top:J+"px",display:this.proximate||J>v-6&&J<v+D-6?"":"none"}))},this))}renderTitle(){let v=this.options,k=this.padding,D=v.title,V,H=0;D.text&&(this.title||(this.title=this.chart.renderer.label(D.text,k-3,k-4,void 0,void 0,void 0,v.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(D.style),this.title.add(this.group)),D.width||this.title.css({width:this.maxLegendWidth+"px"}),H=(V=this.title.getBBox()).height,this.offsetWidth=V.width,this.contentGroup.attr({translateY:H})),this.titleHeight=H}setText(v){let k=this.options;v.legendItem.label.attr({text:k.labelFormat?Va(k.labelFormat,v,this.chart):k.labelFormatter.call(v)})}renderItem(v){var Sr;let k=v.legendItem=v.legendItem||{},D=this.chart,V=D.renderer,H=this.options,Y=H.layout==="horizontal",J=this.symbolWidth,ae=H.symbolPadding||0,_e=this.itemStyle,Me=this.itemHiddenStyle,xe=Y?sc(H.itemDistance,20):0,Pe=!H.rtl,je=!v.series,Qe=!je&&v.series.drawLegendSymbol?v.series:v,at=Qe.options,nt=!!this.createCheckboxForItem&&at&&at.showCheckbox,it=H.useHTML,wt=v.options.className,kt=k.label,Ai=J+ae+xe+20*!!nt;!kt&&(k.group=V.g("legend-item").addClass("highcharts-"+Qe.type+"-series highcharts-color-"+v.colorIndex+(wt?" "+wt:"")+(je?" highcharts-series-"+v.index:"")).attr({zIndex:1}).add(this.scrollGroup),k.label=kt=V.text("",Pe?J+ae:-ae,this.baseline||0,it),D.styledMode||kt.css(id(v.visible?_e:Me)),kt.attr({align:Pe?"left":"right",zIndex:2}).add(k.group),!this.baseline&&(this.fontMetrics=V.fontMetrics(kt),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,kt.attr("y",this.baseline),this.symbolHeight=sc(H.symbolHeight,this.fontMetrics.f),H.squareSymbol&&(this.symbolWidth=sc(H.symbolWidth,Math.max(this.symbolHeight,16)),Ai=this.symbolWidth+ae+xe+20*!!nt,Pe&&kt.attr("x",this.symbolWidth+ae))),Qe.drawLegendSymbol(this,v),this.setItemEvents&&this.setItemEvents(v,kt,it)),nt&&!v.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(v),this.colorizeItem(v,v.visible),(D.styledMode||!_e.width)&&kt.css({width:(H.itemWidth||this.widthOption||D.spacingBox.width)-Ai+"px"}),this.setText(v);let ki=kt.getBBox(),Ri=((Sr=this.fontMetrics)==null?void 0:Sr.h)||0;v.itemWidth=v.checkboxOffset=H.itemWidth||k.labelWidth||ki.width+Ai,this.maxItemWidth=Math.max(this.maxItemWidth,v.itemWidth),this.totalItemWidth+=v.itemWidth,this.itemHeight=v.itemHeight=Math.round(k.labelHeight||(ki.height>1.5*Ri?ki.height:Ri))}layoutItem(v){let k=this.options,D=this.padding,V=k.layout==="horizontal",H=v.itemHeight,Y=this.itemMarginBottom,J=this.itemMarginTop,ae=V?sc(k.itemDistance,20):0,_e=this.maxLegendWidth,Me=k.alignColumns&&this.totalItemWidth>_e?this.maxItemWidth:v.itemWidth,xe=v.legendItem||{};V&&this.itemX-D+Me>_e&&(this.itemX=D,this.lastLineHeight&&(this.itemY+=J+this.lastLineHeight+Y),this.lastLineHeight=0),this.lastItemY=J+this.itemY+Y,this.lastLineHeight=Math.max(H,this.lastLineHeight),xe.x=this.itemX,xe.y=this.itemY,V?this.itemX+=Me:(this.itemY+=J+H+Y,this.lastLineHeight=H),this.offsetWidth=this.widthOption||Math.max((V?this.itemX-D-(v.checkbox?0:ae):Me)+D,this.offsetWidth)}getAllItems(){let v=[];return this.chart.series.forEach(function(k){var V;let D=k==null?void 0:k.options;k&&sc(D.showInLegend,!em(D.linkedTo)&&void 0,!0)&&(v=v.concat(((V=k.legendItem)==null?void 0:V.labels)||(D.legendType==="point"?k.data:k)))}),Gd(this,"afterGetAllItems",{allItems:v}),v}getAlignment(){let v=this.options;return this.proximate?v.align.charAt(0)+"tv":v.floating?"":v.align.charAt(0)+v.verticalAlign.charAt(0)+v.layout.charAt(0)}adjustMargins(v,k){let D=this.chart,V=this.options,H=this.getAlignment();H&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(Y,J){Y.test(H)&&!em(v[J])&&(D[Hd[J]]=Math.max(D[Hd[J]],D.legend[(J+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][J]*V[J%2?"x":"y"]+sc(V.margin,12)+k[J]+(D.titleOffset[J]||0)))})}proximatePositions(){let v,k=this.chart,D=[],V=this.options.align==="left";for(let H of(this.allItems.forEach(function(Y){let J,ae,_e=V,Me,xe;Y.yAxis&&(Y.xAxis.options.reversed&&(_e=!_e),Y.points&&(J=xp(_e?Y.points:Y.points.slice(0).reverse(),function(Pe){return im(Pe.plotY)})),ae=this.itemMarginTop+Y.legendItem.label.getBBox().height+this.itemMarginBottom,xe=Y.yAxis.top-k.plotTop,Me=Y.visible?(J?J.plotY:Y.yAxis.height)+(xe-.3*ae):xe+Y.yAxis.height,D.push({target:Me,size:ae,item:Y}))},this),ql(D,k.plotHeight)))v=H.item.legendItem||{},im(H.pos)&&(v.y=k.plotTop-k.spacing[0]+H.pos)}render(){let v=this.chart,k=v.renderer,D=this.options,V=this.padding,H=this.getAllItems(),Y,J,ae,_e=this.group,Me,xe=this.box;this.itemX=V,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=bf(D.width,v.spacingBox.width-V),Me=v.spacingBox.width-2*V-D.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(Me/=2),this.maxLegendWidth=this.widthOption||Me,_e||(this.group=_e=k.g("legend").addClass(D.className||"").attr({zIndex:7}).add(),this.contentGroup=k.g().attr({zIndex:1}).add(_e),this.scrollGroup=k.g().add(this.contentGroup)),this.renderTitle(),Cg(H,(Pe,je)=>{var Qe,at;return(((Qe=Pe.options)==null?void 0:Qe.legendIndex)||0)-(((at=je.options)==null?void 0:at.legendIndex)||0)}),D.reversed&&H.reverse(),this.allItems=H,this.display=Y=!!H.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,H.forEach(this.renderItem,this),H.forEach(this.layoutItem,this),J=(this.widthOption||this.offsetWidth)+V,ae=this.lastItemY+this.lastLineHeight+this.titleHeight,ae=this.handleOverflow(ae)+V,xe||(this.box=xe=k.rect().addClass("highcharts-legend-box").attr({r:D.borderRadius}).add(_e)),v.styledMode||xe.attr({stroke:D.borderColor,"stroke-width":D.borderWidth||0,fill:D.backgroundColor||"none"}).shadow(D.shadow),J>0&&ae>0&&xe[xe.placed?"animate":"attr"](xe.crisp.call({},{x:0,y:0,width:J,height:ae},xe.strokeWidth())),_e[Y?"show":"hide"](),v.styledMode&&_e.getStyle("display")==="none"&&(J=ae=0),this.legendWidth=J,this.legendHeight=ae,Y&&this.align(),this.proximate||this.positionItems(),Gd(this,"afterRender")}align(v=this.chart.spacingBox){let k=this.chart,D=this.options,V=v.y;/(lth|ct|rth)/.test(this.getAlignment())&&k.titleOffset[0]>0?V+=k.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&k.titleOffset[2]>0&&(V-=k.titleOffset[2]),V!==v.y&&(v=id(v,{y:V})),k.hasRendered||(this.group.placed=!1),this.group.align(id(D,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":D.verticalAlign}),!0,v)}handleOverflow(v){let k=this,D=this.chart,V=D.renderer,H=this.options,Y=H.y,J=H.verticalAlign==="top",ae=this.padding,_e=H.maxHeight,Me=H.navigation,xe=sc(Me.animation,!0),Pe=Me.arrowSize||12,je=this.pages,Qe=this.allItems,at=function(hr){typeof hr=="number"?Sr.attr({height:hr}):Sr&&(k.clipRect=Sr.destroy(),k.contentGroup.clip()),k.contentGroup.div&&(k.contentGroup.div.style.clip=hr?"rect("+ae+"px,9999px,"+(ae+hr)+"px,0)":"auto")},nt=function(hr){return k[hr]=V.circle(0,0,1.3*Pe).translate(Pe/2,Pe/2).add(Ri),D.styledMode||k[hr].attr("fill","rgba(0,0,0,0.0001)"),k[hr]},it,wt,kt,Ai,ki=D.spacingBox.height+(J?-Y:Y)-ae,Ri=this.nav,Sr=this.clipRect;return H.layout!=="horizontal"||H.verticalAlign==="middle"||H.floating||(ki/=2),_e&&(ki=Math.min(ki,_e)),je.length=0,v&&ki>0&&v>ki&&Me.enabled!==!1?(this.clipHeight=it=Math.max(ki-20-this.titleHeight-ae,0),this.currentPage=sc(this.currentPage,1),this.fullHeight=v,Qe.forEach((hr,wr)=>{let Jr=(kt=hr.legendItem||{}).y||0,yn=Math.round(kt.label.getBBox().height),Rn=je.length;(!Rn||Jr-je[Rn-1]>it&&(wt||Jr)!==je[Rn-1])&&(je.push(wt||Jr),Rn++),kt.pageIx=Rn-1,wt&&Ai&&(Ai.pageIx=Rn-1),wr===Qe.length-1&&Jr+yn-je[Rn-1]>it&&Jr>je[Rn-1]&&(je.push(Jr),kt.pageIx=Rn),Jr!==wt&&(wt=Jr),Ai=kt}),Sr||(Sr=k.clipRect=V.clipRect(0,ae-2,9999,0),k.contentGroup.clip(Sr)),at(it),Ri||(this.nav=Ri=V.g().attr({zIndex:1}).add(this.group),this.up=V.symbol("triangle",0,0,Pe,Pe).add(Ri),nt("upTracker").on("click",function(){k.scroll(-1,xe)}),this.pager=V.text("",15,10).addClass("highcharts-legend-navigation"),!D.styledMode&&Me.style&&this.pager.css(Me.style),this.pager.add(Ri),this.down=V.symbol("triangle-down",0,0,Pe,Pe).add(Ri),nt("downTracker").on("click",function(){k.scroll(1,xe)})),k.scroll(0),v=ki):Ri&&(at(),this.nav=Ri.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),v}scroll(v,k){let D=this.chart,V=this.pages,H=V.length,Y=this.clipHeight,J=this.options.navigation,ae=this.pager,_e=this.padding,Me=this.currentPage+v;Me>H&&(Me=H),Me>0&&(k!==void 0&&Rc(k,D),this.nav.attr({translateX:_e,translateY:Y+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(xe){xe.attr({class:Me===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),ae.attr({text:Me+"/"+H}),[this.down,this.downTracker].forEach(function(xe){xe.attr({x:18+this.pager.getBBox().width,class:Me===H?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),D.styledMode||(this.up.attr({fill:Me===1?J.inactiveColor:J.activeColor}),this.upTracker.css({cursor:Me===1?"default":"pointer"}),this.down.attr({fill:Me===H?J.inactiveColor:J.activeColor}),this.downTracker.css({cursor:Me===H?"default":"pointer"})),this.scrollOffset=-V[Me-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=Me,this.positionCheckboxes(),Hp(()=>{Gd(this,"afterScroll",{currentPage:Me})},vp(sc(k,D.renderer.globalAnimation,!0)).duration))}setItemEvents(v,k,D){let V=this,H=v.legendItem||{},Y=V.chart.renderer.boxWrapper,J=v instanceof yf,ae=v instanceof yh,_e="highcharts-legend-"+(J?"point":"series")+"-active",Me=V.chart.styledMode,xe=D?[k,H.symbol]:[H.group],Pe=je=>{V.allItems.forEach(Qe=>{v!==Qe&&[Qe].concat(Qe.linkedSeries||[]).forEach(at=>{at.setState(je,!J)})})};for(let je of xe)je&&je.on("mouseover",function(){v.visible&&Pe("inactive"),v.setState("hover"),v.visible&&Y.addClass(_e),Me||k.css(V.options.itemHoverStyle)}).on("mouseout",function(){V.chart.styledMode||k.css(id(v.visible?V.itemStyle:V.itemHiddenStyle)),Pe(""),Y.removeClass(_e),v.setState()}).on("click",function(Qe){let at=function(){v.setVisible&&v.setVisible(),Pe(v.visible?"inactive":"")};Y.removeClass(_e),Gd(V,"itemClick",{browserEvent:Qe,legendItem:v},at),J?v.firePointEvent("legendItemClick",{browserEvent:Qe}):ae&&Gd(v,"legendItemClick",{browserEvent:Qe})})}createCheckboxForItem(v){v.checkbox=td("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:v.selected,defaultChecked:v.selected},this.options.itemCheckboxStyle,this.chart.container),lo(v.checkbox,"click",function(k){let D=k.target;Gd(v.series||v,"checkboxClick",{checked:D.checked,item:v},function(){v.select()})})}}(function(ve){ve.compose=function(v){Wc(th,"Core.Legend")&&lo(v,"beforeMargins",function(){this.legend=new ve(this,this.options.legend)})}})(rd||(rd={}));let wf=rd,{animate:Pl,animObject:rm,setAnimation:Wh}=Or,{defaultOptions:ih}=$o,{numberFormat:Sf}=ul,{registerEventOptions:ay}=ho,{charts:Id,doc:Ac,marginNames:qd,svg:Eg,win:Gp}=Ye,{seriesTypes:Ld}=Cl,{addEvent:Dd,attr:Fm,createElement:nm,css:rh,defined:jh,diffObjects:Pd,discardElement:sm,erase:zm,error:Du,extend:Pu,find:om,fireEvent:Sa,getAlignFactor:kg,getStyle:Ou,isArray:qp,isNumber:tu,isObject:Ag,isString:am,merge:gu,objectEach:Ru,pick:yc,pInt:Gn,relativeLength:Um,removeEvent:$m,splat:bp,syncTimeout:Yp,uniqueKey:nl}=pr;class nd{static chart(v,k,D){return new nd(v,k,D)}constructor(v,k,D){this.sharedClips={};let V=[...arguments];(am(v)||v.nodeName)&&(this.renderTo=V.shift()),this.init(V[0],V[1])}setZoomOptions(){let v=this.options.chart,k=v.zooming;this.zooming={...k,type:yc(v.zoomType,k.type),key:yc(v.zoomKey,k.key),pinchType:yc(v.pinchType,k.pinchType),singleTouch:yc(v.zoomBySingleTouch,k.singleTouch,!1),resetButton:gu(k.resetButton,v.resetZoomButton)}}init(v,k){Sa(this,"init",{args:arguments},function(){var Y;let D=gu(ih,v),V=D.chart,H=this.renderTo||V.renderTo;this.userOptions=Pu({},v),(this.renderTo=am(H)?Ac.getElementById(H):H)||Du(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=k,this.isResizing=0,this.options=D,this.axes=[],this.series=[],this.locale=D.lang.locale??((Y=this.renderTo.closest("[lang]"))==null?void 0:Y.lang),this.time=new Ls(Pu(D.time||{},{locale:this.locale}),D.lang),D.time=this.time.options,this.numberFormatter=(V.numberFormatter||Sf).bind(this),this.styledMode=V.styledMode,this.hasCartesianSeries=V.showAxes,this.index=Id.length,Id.push(this),Ye.chartCount++,ay(this,V),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Sa(this,"afterInit"),this.firstRender()})}initSeries(v){let k=this.options.chart,D=v.type||k.type,V=Ld[D];V||Du(17,!0,this,{missingModuleFor:D});let H=new V;return typeof H.init=="function"&&H.init(this,v),H}setSortedData(){this.getSeriesOrderByLinks().forEach(function(v){v.points||v.data||!v.enabledDataSorting||v.setData(v.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(v,k){return v.linkedSeries.length||k.linkedSeries.length?k.linkedSeries.length-v.linkedSeries.length:0})}orderItems(v,k=0){let D=this[v],V=this.options[v]=bp(this.options[v]).slice(),H=this.userOptions[v]=this.userOptions[v]?bp(this.userOptions[v]).slice():[];if(this.hasRendered&&(V.splice(k),H.splice(k)),D)for(let Y=k,J=D.length;Y<J;++Y){let ae=D[Y];ae&&(ae.index=Y,ae instanceof yh&&(ae.name=ae.getName()),ae.options.isInternal||(V[Y]=ae.options,H[Y]=ae.userOptions))}}getClipBox(v,k){var Me,xe;let D=this.inverted,{xAxis:V,yAxis:H}=v||{},{x:Y,y:J,width:ae,height:_e}=gu(this.clipBox);return v&&(V&&V.len!==this.plotSizeX&&(ae=V.len),H&&H.len!==this.plotSizeY&&(_e=H.len),D&&!v.invertible&&([ae,_e]=[_e,ae])),k&&(Y+=((Me=D?H:V)==null?void 0:Me.pos)??this.plotLeft,J+=((xe=D?V:H)==null?void 0:xe.pos)??this.plotTop),{x:Y,y:J,width:ae,height:_e}}isInsidePlot(v,k,D={}){var nt;let{inverted:V,plotBox:H,plotLeft:Y,plotTop:J,scrollablePlotBox:ae}=this,{scrollLeft:_e=0,scrollTop:Me=0}=D.visiblePlotOnly&&((nt=this.scrollablePlotArea)==null?void 0:nt.scrollingContainer)||{},xe=D.series,Pe=D.visiblePlotOnly&&ae||H,je=D.inverted?k:v,Qe=D.inverted?v:k,at={x:je,y:Qe,isInsidePlot:!0,options:D};if(!D.ignoreX){let it=xe&&(V&&!this.polar?xe.yAxis:xe.xAxis)||{pos:Y,len:1/0},wt=D.paneCoordinates?it.pos+je:Y+je;wt>=Math.max(_e+Y,it.pos)&&wt<=Math.min(_e+Y+Pe.width,it.pos+it.len)||(at.isInsidePlot=!1)}if(!D.ignoreY&&at.isInsidePlot){let it=!V&&D.axis&&!D.axis.isXAxis&&D.axis||xe&&(V?xe.xAxis:xe.yAxis)||{pos:J,len:1/0},wt=D.paneCoordinates?it.pos+Qe:J+Qe;wt>=Math.max(Me+J,it.pos)&&wt<=Math.min(Me+J+Pe.height,it.pos+it.len)||(at.isInsidePlot=!1)}return Sa(this,"afterIsInsidePlot",at),at.isInsidePlot}redraw(v){Sa(this,"beforeRedraw");let k=this.hasCartesianSeries?this.axes:this.colorAxis||[],D=this.series,V=this.pointer,H=this.legend,Y=this.userOptions.legend,J=this.renderer,ae=J.isHidden(),_e=[],Me,xe,Pe,je=this.isDirtyBox,Qe=this.isDirtyLegend,at;for(J.rootFontSize=J.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),Wh(!!this.hasRendered&&v,this),ae&&this.temporaryDisplay(),this.layOutTitles(!1),Pe=D.length;Pe--;)if(((at=D[Pe]).options.stacking||at.options.centerInCategory)&&(xe=!0,at.isDirty)){Me=!0;break}if(Me)for(Pe=D.length;Pe--;)(at=D[Pe]).options.stacking&&(at.isDirty=!0);D.forEach(function(nt){nt.isDirty&&(nt.options.legendType==="point"?(typeof nt.updateTotals=="function"&&nt.updateTotals(),Qe=!0):Y&&(Y.labelFormatter||Y.labelFormat)&&(Qe=!0)),nt.isDirtyData&&Sa(nt,"updatedData")}),Qe&&H&&H.options.enabled&&(H.render(),this.isDirtyLegend=!1),xe&&this.getStacks(),k.forEach(function(nt){nt.updateNames(),nt.setScale()}),this.getMargins(),k.forEach(function(nt){nt.isDirty&&(je=!0)}),k.forEach(function(nt){let it=nt.min+","+nt.max;nt.extKey!==it&&(nt.extKey=it,_e.push(function(){Sa(nt,"afterSetExtremes",Pu(nt.eventArgs,nt.getExtremes())),delete nt.eventArgs})),(je||xe)&&nt.redraw()}),je&&this.drawChartBox(),Sa(this,"predraw"),D.forEach(function(nt){(je||nt.isDirty)&&nt.visible&&nt.redraw(),nt.isDirtyData=!1}),V&&V.reset(!0),J.draw(),Sa(this,"redraw"),Sa(this,"render"),ae&&this.temporaryDisplay(!0),_e.forEach(function(nt){nt.call()})}get(v){let k=this.series;function D(H){return H.id===v||H.options&&H.options.id===v}let V=om(this.axes,D)||om(this.series,D);for(let H=0;!V&&H<k.length;H++)V=om(k[H].points||[],D);return V}createAxes(){let v=this.userOptions;for(let k of(Sa(this,"createAxes"),["xAxis","yAxis"]))for(let D of v[k]=bp(v[k]||{}))new Yu(this,D,k);Sa(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((v,k)=>(k.getPointsCollection().forEach(D=>{yc(D.selectedStaging,D.selected)&&v.push(D)}),v),[])}getSelectedSeries(){return this.series.filter(v=>v.selected)}setTitle(v,k,D){this.applyDescription("title",v),this.applyDescription("subtitle",k),this.applyDescription("caption",void 0),this.layOutTitles(D)}applyDescription(v,k){var Y;let D=this,V=this.options[v]=gu(this.options[v],k),H=this[v];H&&k&&(this[v]=H=H.destroy()),V&&!H&&((H=this.renderer.text(V.text,0,0,V.useHTML).attr({align:V.align,class:"highcharts-"+v,zIndex:V.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(J,ae){D.applyDescription(v,J),D.layOutTitles(ae)},this.styledMode||H.css(Pu(v==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},V.style)),H.textPxLength=H.getBBox().width,H.css({whiteSpace:(Y=V.style)==null?void 0:Y.whiteSpace}),this[v]=H)}layOutTitles(v=!0){var J,ae,_e,Me;let k=[0,0,0],{options:D,renderer:V,spacingBox:H}=this;["title","subtitle","caption"].forEach(xe=>{var nt;let Pe=this[xe],je=this.options[xe],Qe=gu(H),at=(Pe==null?void 0:Pe.textPxLength)||0;if(Pe&&je){Sa(this,"layOutTitle",{alignTo:Qe,key:xe,textPxLength:at});let it=V.fontMetrics(Pe),wt=it.b,kt=it.h,Ai=je.verticalAlign||"top",ki=Ai==="top",Ri=ki&&je.minScale||1,Sr=xe==="title"?ki?-3:0:ki?k[0]+2:0,hr=Math.min(Qe.width/at,1),wr=Math.max(Ri,hr),Jr=gu({y:Ai==="bottom"?wt:Sr+wt},{align:xe==="title"?hr<Ri?"left":"center":(nt=this.title)==null?void 0:nt.alignValue},je),yn=(je.width||(hr>Ri?this.chartWidth:Qe.width)/wr)+"px";Pe.alignValue!==Jr.align&&(Pe.placed=!1);let Rn=Math.round(Pe.css({width:yn}).getBBox(je.useHTML).height);if(Jr.height=Rn,Pe.align(Jr,!1,Qe).attr({align:Jr.align,scaleX:wr,scaleY:wr,"transform-origin":`${Qe.x+at*wr*kg(Jr.align)} ${kt}`}),!je.floating){let fn=Rn*(Rn<1.2*kt?1:wr);Ai==="top"?k[0]=Math.ceil(k[0]+fn):Ai==="bottom"&&(k[2]=Math.ceil(k[2]+fn))}}},this),k[0]&&(((J=D.title)==null?void 0:J.verticalAlign)||"top")==="top"&&(k[0]+=((ae=D.title)==null?void 0:ae.margin)||0),k[2]&&((_e=D.caption)==null?void 0:_e.verticalAlign)==="bottom"&&(k[2]+=((Me=D.caption)==null?void 0:Me.margin)||0);let Y=!this.titleOffset||this.titleOffset.join(",")!==k.join(",");this.titleOffset=k,Sa(this,"afterLayOutTitles"),!this.isDirtyBox&&Y&&(this.isDirtyBox=this.isDirtyLegend=Y,this.hasRendered&&v&&this.isDirtyBox&&this.redraw())}getContainerBox(){let v=[].map.call(this.renderTo.children,D=>{if(D!==this.container){let V=D.style.display;return D.style.display="none",[D,V]}}),k={width:Ou(this.renderTo,"width",!0)||0,height:Ou(this.renderTo,"height",!0)||0};return v.filter(Boolean).forEach(([D,V])=>{D.style.display=V}),k}getChartSize(){var Y;let v=this.options.chart,k=v.width,D=v.height,V=this.getContainerBox(),H=V.height<=1||!((Y=this.renderTo.parentElement)!=null&&Y.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,k||V.width||600),this.chartHeight=Math.max(0,Um(D,this.chartWidth)||(H?400:V.height)),this.containerBox=V}temporaryDisplay(v){let k=this.renderTo,D;if(v)for(;k!=null&&k.style;)k.hcOrigStyle&&(rh(k,k.hcOrigStyle),delete k.hcOrigStyle),k.hcOrigDetached&&(Ac.body.removeChild(k),k.hcOrigDetached=!1),k=k.parentNode;else for(;k!=null&&k.style&&(Ac.body.contains(k)||k.parentNode||(k.hcOrigDetached=!0,Ac.body.appendChild(k)),(Ou(k,"display",!1)==="none"||k.hcOricDetached)&&(k.hcOrigStyle={display:k.style.display,height:k.style.height,overflow:k.style.overflow},D={display:"block",overflow:"hidden"},k!==this.renderTo&&(D.height=0),rh(k,D),k.offsetWidth||k.style.setProperty("display","block","important")),(k=k.parentNode)!==Ac.body););}setClassName(v){this.container.className="highcharts-container "+(v||"")}getContainer(){var Pe,je;let v,k=this.options,D=k.chart,V="data-highcharts-chart",H=nl(),Y=this.renderTo,J=Gn(Fm(Y,V));tu(J)&&Id[J]&&Id[J].hasRendered&&Id[J].destroy(),Fm(Y,V,this.index),Y.innerHTML=rn.emptyHTML,D.skipClone||Y.offsetWidth||this.temporaryDisplay(),this.getChartSize();let ae=this.chartHeight,_e=this.chartWidth;rh(Y,{overflow:"hidden"}),this.styledMode||(v=Pu({position:"relative",overflow:"hidden",width:_e+"px",height:ae+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},D.style||{}));let Me=nm("div",{id:H},v,Y);this.container=Me,this.getChartSize(),_e!==this.chartWidth&&(_e=this.chartWidth,this.styledMode||rh(Me,{width:yc((Pe=D.style)==null?void 0:Pe.width,_e+"px")})),this.containerBox=this.getContainerBox(),this._cursor=Me.style.cursor;let xe=D.renderer||!Eg?Uc.getRendererType(D.renderer):Ul;if(this.renderer=new xe(Me,_e,ae,void 0,D.forExport,(je=k.exporting)==null?void 0:je.allowHTML,this.styledMode),Wh(void 0,this),this.setClassName(D.className),this.styledMode)for(let Qe in k.defs)this.renderer.definition(k.defs[Qe]);else this.renderer.setStyle(D.style);this.renderer.chartIndex=this.index,Sa(this,"afterGetContainer")}getMargins(v){var H;let{spacing:k,margin:D,titleOffset:V}=this;this.resetMargins(),V[0]&&!jh(D[0])&&(this.plotTop=Math.max(this.plotTop,V[0]+k[0])),V[2]&&!jh(D[2])&&(this.marginBottom=Math.max(this.marginBottom,V[2]+k[2])),(H=this.legend)!=null&&H.display&&this.legend.adjustMargins(D,k),Sa(this,"getMargins"),v||this.getAxisMargins()}getAxisMargins(){let v=this,k=v.axisOffset=[0,0,0,0],D=v.colorAxis,V=v.margin,H=function(Y){Y.forEach(function(J){J.visible&&J.getOffset()})};v.hasCartesianSeries?H(v.axes):D!=null&&D.length&&H(D),qd.forEach(function(Y,J){jh(V[J])||(v[Y]+=k[J])}),v.setChartSize()}getOptions(){return Pd(this.userOptions,ih)}reflow(v){var H,Y;let k=this,D=k.containerBox,V=k.getContainerBox();(H=k.pointer)==null||delete H.chartPosition,!((Y=k.exporting)!=null&&Y.isPrinting)&&!k.isResizing&&D&&V.width&&((V.width!==D.width||V.height!==D.height)&&(pr.clearTimeout(k.reflowTimeout),k.reflowTimeout=Yp(function(){k.container&&k.setSize(void 0,void 0,!1)},100*!!v)),k.containerBox=V)}setReflow(){let v=this,k=D=>{var V;(V=v.options)!=null&&V.chart.reflow&&v.hasLoaded&&v.reflow(D)};if(typeof ResizeObserver=="function")new ResizeObserver(k).observe(v.renderTo);else{let D=Dd(Gp,"resize",k);Dd(this,"destroy",D)}}setSize(v,k,D){let V=this,H=V.renderer;V.isResizing+=1,Wh(D,V);let Y=H.globalAnimation;V.oldChartHeight=V.chartHeight,V.oldChartWidth=V.chartWidth,v!==void 0&&(V.options.chart.width=v),k!==void 0&&(V.options.chart.height=k),V.getChartSize();let{chartWidth:J,chartHeight:ae,scrollablePixelsX:_e=0,scrollablePixelsY:Me=0}=V;(V.isDirtyBox||J!==V.oldChartWidth||ae!==V.oldChartHeight)&&(V.styledMode||(Y?Pl:rh)(V.container,{width:`${J+_e}px`,height:`${ae+Me}px`},Y),V.setChartSize(!0),H.setSize(J,ae,Y),V.axes.forEach(function(xe){xe.isDirty=!0,xe.setScale()}),V.isDirtyLegend=!0,V.isDirtyBox=!0,V.layOutTitles(),V.getMargins(),V.redraw(Y),V.oldChartHeight=void 0,Sa(V,"resize"),setTimeout(()=>{V&&Sa(V,"endResize")},rm(Y).duration)),V.isResizing-=1}setChartSize(v){let k,D,V,H,{chartHeight:Y,chartWidth:J,inverted:ae,spacing:_e,renderer:Me}=this,xe=this.clipOffset,Pe=Math[ae?"floor":"round"];this.plotLeft=k=Math.round(this.plotLeft),this.plotTop=D=Math.round(this.plotTop),this.plotWidth=V=Math.max(0,Math.round(J-k-(this.marginRight??0))),this.plotHeight=H=Math.max(0,Math.round(Y-D-(this.marginBottom??0))),this.plotSizeX=ae?H:V,this.plotSizeY=ae?V:H,this.spacingBox=Me.spacingBox={x:_e[3],y:_e[0],width:J-_e[3]-_e[1],height:Y-_e[0]-_e[2]},this.plotBox=Me.plotBox={x:k,y:D,width:V,height:H},xe&&(this.clipBox={x:Pe(xe[3]),y:Pe(xe[0]),width:Pe(this.plotSizeX-xe[1]-xe[3]),height:Pe(this.plotSizeY-xe[0]-xe[2])}),v||(this.axes.forEach(function(je){je.setAxisSize(),je.setAxisTranslation()}),Me.alignElements()),Sa(this,"afterSetChartSize",{skipAxes:v})}resetMargins(){Sa(this,"resetMargins");let v=this,k=v.options.chart,D=k.plotBorderWidth||0,V=Math.round(D)/2;["margin","spacing"].forEach(function(H){let Y=k[H],J=Ag(Y)?Y:[Y,Y,Y,Y];["Top","Right","Bottom","Left"].forEach(function(ae,_e){v[H][_e]=yc(k[H+ae],J[_e])})}),qd.forEach(function(H,Y){v[H]=yc(v.margin[Y],v.spacing[Y])}),v.axisOffset=[0,0,0,0],v.clipOffset=[V,V,V,V],v.plotBorderWidth=D}drawChartBox(){let v=this.options.chart,k=this.renderer,D=this.chartWidth,V=this.chartHeight,H=this.styledMode,Y=this.plotBGImage,J=v.backgroundColor,ae=v.plotBackgroundColor,_e=v.plotBackgroundImage,Me=this.plotLeft,xe=this.plotTop,Pe=this.plotWidth,je=this.plotHeight,Qe=this.plotBox,at=this.clipRect,nt=this.clipBox,it=this.chartBackground,wt=this.plotBackground,kt=this.plotBorder,Ai,ki,Ri,Sr="animate";it||(this.chartBackground=it=k.rect().addClass("highcharts-background").add(),Sr="attr"),H?Ai=ki=it.strokeWidth():(ki=(Ai=v.borderWidth||0)+8*!!v.shadow,Ri={fill:J||"none"},(Ai||it["stroke-width"])&&(Ri.stroke=v.borderColor,Ri["stroke-width"]=Ai),it.attr(Ri).shadow(v.shadow)),it[Sr]({x:ki/2,y:ki/2,width:D-ki-Ai%2,height:V-ki-Ai%2,r:v.borderRadius}),Sr="animate",wt||(Sr="attr",this.plotBackground=wt=k.rect().addClass("highcharts-plot-background").add()),wt[Sr](Qe),!H&&(wt.attr({fill:ae||"none"}).shadow(v.plotShadow),_e&&(Y?(_e!==Y.attr("href")&&Y.attr("href",_e),Y.animate(Qe)):this.plotBGImage=k.image(_e,Me,xe,Pe,je).add())),at?at.animate({width:nt.width,height:nt.height}):this.clipRect=k.clipRect(nt),Sr="animate",kt||(Sr="attr",this.plotBorder=kt=k.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),H||kt.attr({stroke:v.plotBorderColor,"stroke-width":v.plotBorderWidth||0,fill:"none"}),kt[Sr](kt.crisp(Qe,-kt.strokeWidth())),this.isDirtyBox=!1,Sa(this,"afterDrawChartBox")}propFromSeries(){let v,k,D,V=this,H=V.options.chart,Y=V.options.series;["inverted","angular","polar"].forEach(function(J){for(k=Ld[H.type],D=H[J]||k&&k.prototype[J],v=Y==null?void 0:Y.length;!D&&v--;)(k=Ld[Y[v].type])&&k.prototype[J]&&(D=!0);V[J]=D})}linkSeries(v){let k=this,D=k.series;D.forEach(function(V){V.linkedSeries.length=0}),D.forEach(function(V){let{linkedTo:H}=V.options;if(am(H)){let Y;(Y=H===":previous"?k.series[V.index-1]:k.get(H))&&Y.linkedParent!==V&&(Y.linkedSeries.push(V),V.linkedParent=Y,Y.enabledDataSorting&&V.setDataSortingOptions(),V.visible=yc(V.options.visible,Y.options.visible,V.visible))}}),Sa(this,"afterLinkSeries",{isUpdating:v})}renderSeries(){this.series.forEach(function(v){v.translate(),v.render()})}render(){var Me;let v=this.axes,k=this.colorAxis,D=this.renderer,V=this.options.chart.axisLayoutRuns||2,H=xe=>{xe.forEach(Pe=>{Pe.visible&&Pe.render()})},Y=0,J=!0,ae,_e=0;for(let xe of(this.setTitle(),Sa(this,"beforeMargins"),(Me=this.getStacks)==null||Me.call(this),this.getMargins(!0),this.setChartSize(),v)){let{options:Pe}=xe,{labels:je}=Pe;if(this.hasCartesianSeries&&xe.horiz&&xe.visible&&je.enabled&&xe.series.length&&xe.coll!=="colorAxis"&&!this.polar){Y=Pe.tickLength,xe.createGroups();let Qe=new dc(xe,0,"",!0),at=Qe.createLabel("x",je);if(Qe.destroy(),at&&yc(je.reserveSpace,!tu(Pe.crossing))&&(Y=at.getBBox().height+je.distance+Math.max(Pe.offset||0,0)),Y){at==null||at.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-Y,0);(J||ae||V>1)&&_e<V;){let xe=this.plotWidth,Pe=this.plotHeight;for(let je of v)_e===0?je.setScale():(je.horiz&&J||!je.horiz&&ae)&&je.setTickInterval(!0);_e===0?this.getAxisMargins():this.getMargins(),J=xe/this.plotWidth>(_e?1:1.1),ae=Pe/this.plotHeight>(_e?1:1.05),_e++}this.drawChartBox(),this.hasCartesianSeries?H(v):k!=null&&k.length&&H(k),this.seriesGroup||(this.seriesGroup=D.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.dataLabelsGroup||(this.dataLabelsGroup=D.g("datalabels-group").attr({zIndex:6}).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(v){let k=this,D=gu(!0,this.options.credits,v);D.enabled&&!this.credits&&(this.credits=this.renderer.text(D.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){D.href&&(Gp.location.href=D.href)}).attr({align:D.position.align,zIndex:8}),k.styledMode||this.credits.css(D.style),this.credits.add().align(D.position),this.credits.update=function(V){k.credits=k.credits.destroy(),k.addCredits(V)})}destroy(){var J,ae;let v,k=this,D=k.axes,V=k.series,H=k.container,Y=H==null?void 0:H.parentNode;for(Sa(k,"destroy"),k.renderer.forExport?zm(Id,k):Id[k.index]=void 0,Ye.chartCount--,k.renderTo.removeAttribute("data-highcharts-chart"),$m(k),v=D.length;v--;)D[v]=D[v].destroy();for((ae=(J=this.scroller)==null?void 0:J.destroy)==null||ae.call(J),v=V.length;v--;)V[v]=V[v].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(_e=>{var Me,xe;k[_e]=(xe=(Me=k[_e])==null?void 0:Me.destroy)==null?void 0:xe.call(Me)}),H&&(H.innerHTML=rn.emptyHTML,$m(H),Y&&sm(H)),Ru(k,function(_e,Me){delete k[Me]})}firstRender(){var V;let v=this,k=v.options;v.getContainer(),v.resetMargins(),v.setChartSize(),v.propFromSeries(),v.createAxes();let D=qp(k.series)?k.series:[];k.series=[],D.forEach(function(H){v.initSeries(H)}),v.linkSeries(),v.setSortedData(),Sa(v,"beforeRender"),v.render(),(V=v.pointer)==null||V.getChartPosition(),v.renderer.imgCount||v.hasLoaded||v.onload(),v.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(v){v&&this.index!==void 0&&v.apply(this,[this])},this),Sa(this,"load"),Sa(this,"render"),jh(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:v,title:k}=this;v&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":((k==null?void 0:k.element.textContent)||"").replace(/</g,"&lt;")}),v.accessibility&&v.accessibility.enabled===!1||Du('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(v,k,D){let V,H=this;return v&&(k=yc(k,!0),Sa(H,"addSeries",{options:v},function(){V=H.initSeries(v),H.isDirtyLegend=!0,H.linkSeries(),V.enabledDataSorting&&V.setData(v.data,!1),Sa(H,"afterAddSeries",{series:V}),k&&H.redraw(D)})),V}addAxis(v,k,D,V){return this.createAxis(k?"xAxis":"yAxis",{axis:v,redraw:D,animation:V})}addColorAxis(v,k,D){return this.createAxis("colorAxis",{axis:v,redraw:k,animation:D})}createAxis(v,k){let D=new Yu(this,k.axis,v);return yc(k.redraw,!0)&&this.redraw(k.animation),D}showLoading(v){let k=this,D=k.options,V=D.loading,H=function(){Y&&rh(Y,{left:k.plotLeft+"px",top:k.plotTop+"px",width:k.plotWidth+"px",height:k.plotHeight+"px"})},Y=k.loadingDiv,J=k.loadingSpan;Y||(k.loadingDiv=Y=nm("div",{className:"highcharts-loading highcharts-loading-hidden"},null,k.container)),J||(k.loadingSpan=J=nm("span",{className:"highcharts-loading-inner"},null,Y),Dd(k,"redraw",H)),Y.className="highcharts-loading",rn.setElementHTML(J,yc(v,D.lang.loading,"")),!k.styledMode&&(rh(Y,Pu(V.style,{zIndex:10})),rh(J,V.labelStyle),k.loadingShown||(rh(Y,{opacity:0,display:""}),Pl(Y,{opacity:V.style.opacity||.5},{duration:V.showDuration||0}))),k.loadingShown=!0,H()}hideLoading(){let v=this.options,k=this.loadingDiv;k&&(k.className="highcharts-loading highcharts-loading-hidden",this.styledMode||Pl(k,{opacity:0},{duration:v.loading.hideDuration||100,complete:function(){rh(k,{display:"none"})}})),this.loadingShown=!1}update(v,k,D,V){let H,Y,J,ae=this,_e={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},Me=v.isResponsiveOptions,xe=[];Sa(ae,"update",{options:v}),Me||ae.setResponsive(!1,!0),v=Pd(v,ae.options),ae.userOptions=gu(ae.userOptions,v);let Pe=v.chart;Pe&&(gu(!0,ae.options.chart,Pe),this.setZoomOptions(),"className"in Pe&&ae.setClassName(Pe.className),("inverted"in Pe||"polar"in Pe||"type"in Pe)&&(ae.propFromSeries(),H=!0),"alignTicks"in Pe&&(H=!0),"events"in Pe&&ay(this,Pe),Ru(Pe,function(at,nt){ae.propsRequireUpdateSeries.indexOf("chart."+nt)!==-1&&(Y=!0),ae.propsRequireDirtyBox.indexOf(nt)!==-1&&(ae.isDirtyBox=!0),ae.propsRequireReflow.indexOf(nt)!==-1&&(ae.isDirtyBox=!0,Me||(J=!0))}),!ae.styledMode&&Pe.style&&ae.renderer.setStyle(ae.options.chart.style||{})),!ae.styledMode&&v.colors&&(this.options.colors=v.colors),Ru(v,function(at,nt){ae[nt]&&typeof ae[nt].update=="function"?ae[nt].update(at,!1):typeof ae[_e[nt]]=="function"?ae[_e[nt]](at):nt!=="colors"&&ae.collectionsWithUpdate.indexOf(nt)===-1&&gu(!0,ae.options[nt],v[nt]),nt!=="chart"&&ae.propsRequireUpdateSeries.indexOf(nt)!==-1&&(Y=!0)}),this.collectionsWithUpdate.forEach(function(at){v[at]&&(bp(v[at]).forEach(function(nt,it){let wt,kt=jh(nt.id);kt&&(wt=ae.get(nt.id)),!wt&&ae[at]&&(wt=ae[at][yc(nt.index,it)])&&(kt&&jh(wt.options.id)||wt.options.isInternal)&&(wt=void 0),wt&&wt.coll===at&&(wt.update(nt,!1),D&&(wt.touched=!0)),!wt&&D&&ae.collectionsWithInit[at]&&(ae.collectionsWithInit[at][0].apply(ae,[nt].concat(ae.collectionsWithInit[at][1]||[]).concat([!1])).touched=!0)}),D&&ae[at].forEach(function(nt){nt.touched||nt.options.isInternal?delete nt.touched:xe.push(nt)}))}),xe.forEach(function(at){at.chart&&at.remove&&at.remove(!1)}),H&&ae.axes.forEach(function(at){at.update({},!1)}),Y&&ae.getSeriesOrderByLinks().forEach(function(at){at.chart&&at.update({},!1)},this);let je=Pe==null?void 0:Pe.width,Qe=Pe&&(am(Pe.height)?Um(Pe.height,je||ae.chartWidth):Pe.height);J||tu(je)&&je!==ae.chartWidth||tu(Qe)&&Qe!==ae.chartHeight?ae.setSize(je,Qe,V):yc(k,!0)&&ae.redraw(V),Sa(ae,"afterUpdate",{options:v,redraw:k,animation:V})}setSubtitle(v,k){this.applyDescription("subtitle",v),this.layOutTitles(k)}setCaption(v,k){this.applyDescription("caption",v),this.layOutTitles(k)}showResetZoom(){let v=this,k=ih.lang,D=v.zooming.resetButton,V=D.theme,H=D.relativeTo==="chart"||D.relativeTo==="spacingBox"?null:"plotBox";function Y(){v.zoomOut()}Sa(this,"beforeShowResetZoom",null,function(){v.resetZoomButton=v.renderer.button(k.resetZoom,null,null,Y,V).attr({align:D.position.align,title:k.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(D.position,!1,H)}),Sa(this,"afterShowResetZoom")}zoomOut(){Sa(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(v,k){let D=this,V=typeof k=="object"?k:{enabled:k,type:"x"},H=V.type,Y=H&&D[{x:"xAxis",xy:"axes",y:"yAxis"}[H]].filter(ae=>ae.options.panningEnabled&&!ae.options.isInternal),J=D.options.chart;J!=null&&J.panning&&(J.panning=V),Sa(this,"pan",{originalEvent:v},()=>{D.transform({axes:Y,event:v,to:{x:v.chartX-(D.mouseDownX||0),y:v.chartY-(D.mouseDownY||0)},trigger:"pan"}),rh(D.container,{cursor:"move"})})}transform(v){var Qe;let{axes:k=this.axes,event:D,from:V={},reset:H,selection:Y,to:J={},trigger:ae}=v,{inverted:_e,time:Me}=this;(Qe=this.hoverPoints)==null||Qe.forEach(at=>at.setState()),Sa(this,"transform",v);let xe=v.hasZoomed||!1,Pe,je;for(let at of k){let{horiz:nt,len:it,minPointOffset:wt=0,options:kt,reversed:Ai}=at,ki=nt?"width":"height",Ri=nt?"x":"y",Sr=yc(J[ki],at.len),hr=yc(V[ki],at.len),wr=10>Math.abs(Sr)?1:Sr/hr,Jr=(V[Ri]||0)+hr/2-at.pos,yn=Jr-((J[Ri]??at.pos)+Sr/2-at.pos)/wr,Rn=Ai&&!_e||!Ai&&_e?-1:1;if(!H&&(Jr<0||Jr>at.len))continue;let fn=at.chart.polar||at.isOrdinal?0:wt*Rn||0,ms=at.toValue(yn,!0),hs=at.toValue(yn+it/wr,!0),Is=ms+fn,jn=hs-fn,us=at.allExtremes;if(Y&&Y[at.coll].push({axis:at,min:Math.min(ms,hs),max:Math.max(ms,hs)}),Is>jn&&([Is,jn]=[jn,Is]),wr===1&&!H&&at.coll==="yAxis"&&!us){for(let Lh of at.series){let Rl=Lh.getExtremes(Lh.getProcessedData(!0).modified.getColumn("y")||[],!0);us??(us={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),tu(Rl.dataMin)&&tu(Rl.dataMax)&&(us.dataMin=Math.min(Rl.dataMin,us.dataMin),us.dataMax=Math.max(Rl.dataMax,us.dataMax))}at.allExtremes=us}let{dataMin:oa,dataMax:Ea,min:ka,max:Mh}=Pu(at.getExtremes(),us||{}),da=Me.parse(kt.min),Ol=Me.parse(kt.max),Co=oa??da,Os=Ea??Ol,Us=jn-Is,tl=at.categories?0:Math.min(Us,Os-Co),pa=Co-tl*(jh(da)?0:kt.minPadding),Ih=Os+tl*(jh(Ol)?0:kt.maxPadding),nh=at.allowZoomOutside||wr===1||ae!=="zoom"&&wr>1,va=Math.min(da??pa,pa,nh?ka:pa),ou=Math.max(Ol??Ih,Ih,nh?Mh:Ih);(!at.isOrdinal||wr!==1||H)&&(Is<va&&(Is=va,wr>=1&&(jn=Is+Us)),jn>ou&&(jn=ou,wr>=1&&(Is=jn-Us)),(H||at.series.length&&(Is!==ka||jn!==Mh)&&Is>=va&&jn<=ou)&&(Y?Y[at.coll].push({axis:at,min:Is,max:jn}):(at.isPanning=ae!=="zoom",at.isPanning&&(je=!0),at.setExtremes(H?void 0:Is,H?void 0:jn,!1,!1,{move:yn,trigger:ae,scale:wr}),!H&&(Is>va||jn<ou)&&ae!=="mousewheel"&&(Pe=!0)),xe=!0),this.hasCartesianSeries||H||ae==="mousewheel"||(Pe=!0),D&&(this[nt?"mouseDownX":"mouseDownY"]=D[nt?"chartX":"chartY"]))}return xe&&(Y?Sa(this,"selection",Y,()=>{delete v.selection,v.trigger="zoom",this.transform(v)}):(!Pe||je||this.resetZoomButton?!Pe&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(ae==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),xe}}Pu(nd.prototype,{callbacks:[],collectionsWithInit:{xAxis:[nd.prototype.addAxis,[!0]],yAxis:[nd.prototype.addAxis,[!1]],series:[nd.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:Kl}=Or,{composed:Mg}=Ye,{addEvent:_c,createElement:Xp,css:Vm,defined:Tf,erase:Cf,merge:wp,pushUnique:Ig}=pr;function ya(){let ve=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!ve&&(this.scrollablePlotArea=ve=new Yd(this)),ve==null||ve.applyFixed()}function Ql(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class Yd{static compose(v,k,D){Ig(Mg,this.compose)&&(_c(v,"afterInit",Ql),_c(k,"afterSetChartSize",V=>this.afterSetSize(V.target,V)),_c(k,"render",ya),_c(D,"show",Ql))}static afterSetSize(v,k){let D,V,H,{minWidth:Y,minHeight:J}=v.options.chart.scrollablePlotArea||{},{clipBox:ae,plotBox:_e,inverted:Me,renderer:xe}=v;if(!xe.forExport&&(Y?(v.scrollablePixelsX=D=Math.max(0,Y-v.chartWidth),D&&(v.scrollablePlotBox=wp(v.plotBox),_e.width=v.plotWidth+=D,ae[Me?"height":"width"]+=D,H=!0)):J&&(v.scrollablePixelsY=V=Math.max(0,J-v.chartHeight),Tf(V)&&(v.scrollablePlotBox=wp(v.plotBox),_e.height=v.plotHeight+=V,ae[Me?"width":"height"]+=V,H=!1)),Tf(H)&&!k.skipAxes))for(let Pe of v.axes)(Pe.horiz===H||v.hasParallelCoordinates&&Pe.coll==="yAxis")&&(Pe.setAxisSize(),Pe.setAxisTranslation())}constructor(v){var je;let k,D=v.options.chart,V=Uc.getRendererType(),H=D.scrollablePlotArea||{},Y=this.moveFixedElements.bind(this),J={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};v.scrollablePixelsX&&(J.overflowX="auto"),v.scrollablePixelsY&&(J.overflowY="auto"),this.chart=v;let ae=this.parentDiv=Xp("div",{className:"highcharts-scrolling-parent"},{position:"relative"},v.renderTo),_e=this.scrollingContainer=Xp("div",{className:"highcharts-scrolling"},J,ae),Me=this.innerContainer=Xp("div",{className:"highcharts-inner-container"},void 0,_e),xe=this.fixedDiv=Xp("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((je=D.style)==null?void 0:je.zIndex)||0)+2,top:0},void 0,!0),Pe=this.fixedRenderer=new V(xe,v.chartWidth,v.chartHeight,D.style);this.mask=Pe.path().attr({fill:D.backgroundColor||"#fff","fill-opacity":H.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),_e.parentNode.insertBefore(xe,_e),Vm(v.renderTo,{overflow:"visible"}),_c(v,"afterShowResetZoom",Y),_c(v,"afterApplyDrilldown",Y),_c(v,"afterLayOutTitles",Y),_c(_e,"scroll",()=>{let{pointer:Qe,hoverPoint:at}=v;Qe&&(delete Qe.chartPosition,at&&(k=at),Qe.runPointActions(void 0,k,!0))}),Me.appendChild(v.container)}applyFixed(){var Jr;let{chart:v,fixedRenderer:k,isDirty:D,scrollingContainer:V}=this,{axisOffset:H,chartWidth:Y,chartHeight:J,container:ae,plotHeight:_e,plotLeft:Me,plotTop:xe,plotWidth:Pe,scrollablePixelsX:je=0,scrollablePixelsY:Qe=0}=v,{scrollPositionX:at=0,scrollPositionY:nt=0}=v.options.chart.scrollablePlotArea||{},it=Y+je,wt=J+Qe;k.setSize(Y,J),(D??!0)&&(this.isDirty=!1,this.moveFixedElements()),Kl(v.container),Vm(ae,{width:`${it}px`,height:`${wt}px`}),v.renderer.boxWrapper.attr({width:it,height:wt,viewBox:[0,0,it,wt].join(" ")}),(Jr=v.chartBackground)==null||Jr.attr({width:it,height:wt}),Vm(V,{width:`${Y}px`,height:`${J}px`}),Tf(D)||(V.scrollLeft=je*at,V.scrollTop=Qe*nt);let kt=xe-H[0]-1,Ai=Me-H[3]-1,ki=xe+_e+H[2]+1,Ri=Me+Pe+H[1]+1,Sr=Me+Pe-je,hr=xe+_e-Qe,wr=[["M",0,0]];je?wr=[["M",0,kt],["L",Me-1,kt],["L",Me-1,ki],["L",0,ki],["Z"],["M",Sr,kt],["L",Y,kt],["L",Y,ki],["L",Sr,ki],["Z"]]:Qe&&(wr=[["M",Ai,0],["L",Ai,xe-1],["L",Ri,xe-1],["L",Ri,0],["Z"],["M",Ai,hr],["L",Ai,J],["L",Ri,J],["L",Ri,hr],["Z"]]),v.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:wr})}moveFixedElements(){let v,{container:k,inverted:D,scrollablePixelsX:V,scrollablePixelsY:H}=this.chart,Y=this.fixedRenderer,J=Yd.fixedSelectors;if(V&&!D?v=".highcharts-yaxis":V&&D||H&&!D?v=".highcharts-xaxis":H&&D&&(v=".highcharts-yaxis"),v&&!(this.chart.hasParallelCoordinates&&v===".highcharts-yaxis"))for(let ae of[`${v}:not(.highcharts-radial-axis)`,`${v}-labels:not(.highcharts-radial-axis-labels)`])Ig(J,ae);else for(let ae of[".highcharts-xaxis",".highcharts-yaxis"])for(let _e of[`${ae}:not(.highcharts-radial-axis)`,`${ae}-labels:not(.highcharts-radial-axis-labels)`])Cf(J,_e);for(let ae of J)[].forEach.call(k.querySelectorAll(ae),_e=>{(_e.namespaceURI===Y.SVG_NS?Y.box:Y.box.parentNode).appendChild(_e),_e.style.pointerEvents="auto"})}}Yd.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:ly}=ul,{series:Xd}=Cl,{destroyObjectProperties:cy,fireEvent:Zp,getAlignFactor:Zd,isNumber:sd,pick:Kd}=pr,Lg=class{constructor(ve,v,k,D,V){let H=ve.chart.inverted,Y=ve.reversed;this.axis=ve;let J=this.isNegative=!!k!=!!Y;this.options=v=v||{},this.x=D,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=V,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:v.align||(H?J?"left":"right":"center"),verticalAlign:v.verticalAlign||(H?"middle":J?"bottom":"top"),y:v.y,x:v.x},this.textAlign=v.textAlign||(H?J?"right":"left":"center")}destroy(){cy(this,this.axis)}render(ve){let v=this.axis.chart,k=this.options,D=k.format,V=D?ly(D,this,v):k.formatter.call(this);if(this.label)this.label.attr({text:V,visibility:"hidden"});else{this.label=v.renderer.label(V,null,void 0,k.shape,void 0,void 0,k.useHTML,!1,"stack-labels");let H={r:k.borderRadius||0,text:V,padding:Kd(k.padding,5),visibility:"hidden"};v.styledMode||(H.fill=k.backgroundColor,H.stroke=k.borderColor,H["stroke-width"]=k.borderWidth,this.label.css(k.style||{})),this.label.attr(H),this.label.added||this.label.add(ve)}this.label.labelrank=v.plotSizeY,Zp(this,"afterRender")}setOffset(ve,v,k,D,V,H){let{alignOptions:Y,axis:J,label:ae,options:_e,textAlign:Me}=this,xe=J.chart,Pe=this.getStackBox({xOffset:ve,width:v,boxBottom:k,boxTop:D,defaultX:V,xAxis:H}),{verticalAlign:je}=Y;if(ae&&Pe){let Qe=ae.getBBox(void 0,0),at=ae.padding,nt=Kd(_e.overflow,"justify")==="justify",it;Y.x=_e.x||0,Y.y=_e.y||0;let{x:wt,y:kt}=this.adjustStackPosition({labelBox:Qe,verticalAlign:je,textAlign:Me});Pe.x-=wt,Pe.y-=kt,ae.align(Y,!1,Pe),(it=xe.isInsidePlot(ae.alignAttr.x+Y.x+wt,ae.alignAttr.y+Y.y+kt))||(nt=!1),nt&&Xd.prototype.justifyDataLabel.call(J,ae,Y,ae.alignAttr,Qe,Pe),ae.attr({x:ae.alignAttr.x,y:ae.alignAttr.y,rotation:_e.rotation,rotationOriginX:Qe.width*Zd(_e.textAlign||"center"),rotationOriginY:Qe.height/2}),Kd(!nt&&_e.crop,!0)&&(it=sd(ae.x)&&sd(ae.y)&&xe.isInsidePlot(ae.x-at+(ae.width||0),ae.y)&&xe.isInsidePlot(ae.x+at,ae.y)),ae[it?"show":"hide"]()}Zp(this,"afterSetOffset",{xOffset:ve,width:v})}adjustStackPosition({labelBox:ve,verticalAlign:v,textAlign:k}){return{x:ve.width/2+ve.width/2*(2*Zd(k)-1),y:ve.height/2*2*(1-Zd(v))}}getStackBox(ve){let v=this.axis,k=v.chart,{boxTop:D,defaultX:V,xOffset:H,width:Y,boxBottom:J}=ve,ae=v.stacking.usePercentage?100:Kd(D,this.total,0),_e=v.toPixels(ae),Me=ve.xAxis||k.xAxis[0],xe=Kd(V,Me.translate(this.x))+H,Pe=Math.abs(_e-v.toPixels(J||sd(v.min)&&v.logarithmic&&v.logarithmic.lin2log(v.min)||0)),je=k.inverted,Qe=this.isNegative;return je?{x:(Qe?_e:_e-Pe)-k.plotLeft,y:Me.height-xe-Y+Me.top-k.plotTop,width:Pe,height:Y}:{x:xe+Me.transB-k.plotLeft,y:(Qe?_e-Pe:_e)-k.plotTop,width:Y,height:Pe}}},{getDeferredAnimation:Dg}=Or,{series:{prototype:lm}}=Cl,{addEvent:Nu,correctFloat:iu,defined:Bu,destroyObjectProperties:Wm,fireEvent:g,isNumber:o,objectEach:h,pick:y}=pr;function C(){let ve=this.inverted;this.axes.forEach(v=>{var k;(k=v.stacking)!=null&&k.stacks&&v.hasVisibleSeries&&(v.stacking.oldStacks=v.stacking.stacks)}),this.series.forEach(v=>{var D;let k=((D=v.xAxis)==null?void 0:D.options)||{};v.options.stacking&&v.reserveSpace()&&(v.stackKey=[v.type,y(v.options.stack,""),ve?k.top:k.left,ve?k.height:k.width].join(","))})}function A(){var v;let ve=this.stacking;if(ve){let k=ve.stacks;h(k,(D,V)=>{Wm(D),delete k[V]}),(v=ve.stackTotalGroup)==null||v.destroy()}}function R(){this.stacking||(this.stacking=new ge(this))}function $(ve,v,k,D){return!Bu(ve)||ve.x!==v||D&&ve.stackKey!==D?ve={x:v,index:0,key:D,stackKey:D}:ve.index++,ve.key=[k,v,ve.index].join(","),ve}function Z(){let ve,v=this,k=v.yAxis,D=v.stackKey||"",V=k.stacking.stacks,H=v.getColumn("x",!0),Y=v.options.stacking,J=v[Y+"Stacker"];J&&[D,"-"+D].forEach(ae=>{var je;let _e=H.length,Me,xe,Pe;for(;_e--;)Me=H[_e],ve=v.getStackIndicator(ve,Me,v.index,ae),xe=(je=V[ae])==null?void 0:je[Me],(Pe=xe==null?void 0:xe.points[ve.key||""])&&J.call(v,Pe,xe,_e)})}function se(ve,v,k){let D=v.total?100/v.total:0;ve[0]=iu(ve[0]*D),ve[1]=iu(ve[1]*D),this.stackedYData[k]=ve[1]}function ue(ve){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?lm.setStackedPoints.call(this,ve,"group"):ve.stacking.resetStacks())}function be(ve,v){var hr,wr;let k,D,V,H,Y,J,ae,_e=v||this.options.stacking;if(!_e||!this.reserveSpace()||({group:"xAxis"}[_e]||"yAxis")!==ve.coll)return;let Me=this.getColumn("x",!0),xe=this.getColumn(this.pointValKey||"y",!0),Pe=[],je=xe.length,Qe=this.options,at=Qe.threshold||0,nt=Qe.startFromThreshold?at:0,it=Qe.stack,wt=v?`${this.type},${_e}`:this.stackKey||"",kt="-"+wt,Ai=this.negStacks,ki=ve.stacking,Ri=ki.stacks,Sr=ki.oldStacks;for(ki.stacksTouched+=1,ae=0;ae<je;ae++){let Jr=Me[ae]||0,yn=xe[ae],Rn=o(yn)&&yn||0;J=(k=this.getStackIndicator(k,Jr,this.index)).key||"",Ri[Y=(D=Ai&&Rn<(nt?0:at))?kt:wt]||(Ri[Y]={}),Ri[Y][Jr]||((hr=Sr[Y])!=null&&hr[Jr]?(Ri[Y][Jr]=Sr[Y][Jr],Ri[Y][Jr].total=null):Ri[Y][Jr]=new Lg(ve,ve.options.stackLabels,!!D,Jr,it)),V=Ri[Y][Jr],yn!==null?(V.points[J]=V.points[this.index]=[y(V.cumulative,nt)],Bu(V.cumulative)||(V.base=J),V.touched=ki.stacksTouched,k.index>0&&this.singleStacks===!1&&(V.points[J][0]=V.points[this.index+","+Jr+",0"][0])):(delete V.points[J],delete V.points[this.index]);let fn=V.total||0;_e==="percent"?(H=D?wt:kt,fn=Ai&&((wr=Ri[H])!=null&&wr[Jr])?(H=Ri[H][Jr]).total=Math.max(H.total||0,fn)+Math.abs(Rn):iu(fn+Math.abs(Rn))):_e==="group"?o(yn)&&fn++:fn=iu(fn+Rn),_e==="group"?V.cumulative=(fn||1)-1:V.cumulative=iu(y(V.cumulative,nt)+Rn),V.total=fn,yn!==null&&(V.points[J].push(V.cumulative),Pe[ae]=V.cumulative,V.hasValidPoints=!0)}_e==="percent"&&(ki.usePercentage=!0),_e!=="group"&&(this.stackedYData=Pe),ki.oldStacks={}}class ge{constructor(v){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=v}buildStacks(){let v,k,D=this.axis,V=D.series,H=D.coll==="xAxis",Y=D.options.reversedStacks,J=V.length;for(this.resetStacks(),this.usePercentage=!1,k=J;k--;)v=V[Y?k:J-k-1],H&&v.setGroupedPoints(D),v.setStackedPoints(D);if(!H)for(k=0;k<J;k++)V[k].modifyStacks();g(D,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,h(this.stacks,v=>{h(v,k=>{k.cumulative=k.total})}))}resetStacks(){h(this.stacks,v=>{h(v,(k,D)=>{o(k.touched)&&k.touched<this.stacksTouched?(k.destroy(),delete v[D]):(k.total=null,k.cumulative=null)})})}renderStackTotals(){var J;let v=this.axis,k=v.chart,D=k.renderer,V=this.stacks,H=Dg(k,((J=v.options.stackLabels)==null?void 0:J.animation)||!1),Y=this.stackTotalGroup=this.stackTotalGroup||D.g("stack-labels").attr({zIndex:6,opacity:0}).add();Y.translate(k.plotLeft,k.plotTop),h(V,ae=>{h(ae,_e=>{_e.render(Y)})}),Y.animate({opacity:1},H)}}(te||(te={})).compose=function(ve,v,k){let D=v.prototype,V=k.prototype;D.getStacks||(Nu(ve,"init",R),Nu(ve,"destroy",A),D.getStacks=C,V.getStackIndicator=$,V.modifyStacks=Z,V.percentStacker=se,V.setGroupedPoints=ue,V.setStackedPoints=be)};let Ce=te,{defined:$e,merge:Ne,isObject:We}=pr;class Xe extends yh{drawGraph(){let v=this.options,k=(this.gappedPath||this.getGraphPath).call(this),D=this.chart.styledMode;[this,...this.zones].forEach((V,H)=>{let Y,J=V.graph,ae=J?"animate":"attr",_e=V.dashStyle||v.dashStyle;J?(J.endX=this.preventGraphAnimation?null:k.xMap,J.animate({d:k})):k.length&&(V.graph=J=this.chart.renderer.path(k).addClass("highcharts-graph"+(H?` highcharts-zone-graph-${H-1} `:" ")+(H&&V.className||"")).attr({zIndex:1}).add(this.group)),J&&!D&&(Y={stroke:!H&&v.lineColor||V.color||this.color||"#cccccc","stroke-width":v.lineWidth||0,fill:this.fillGraph&&this.color||"none"},_e?Y.dashstyle=_e:v.linecap!=="square"&&(Y["stroke-linecap"]=Y["stroke-linejoin"]="round"),J[ae](Y).shadow(v.shadow&&Ne({filterUnits:"userSpaceOnUse"},We(v.shadow)?v.shadow:{}))),J&&(J.startX=k.xMap,J.isArea=k.isArea)})}getGraphPath(v,k,D){let V=this,H=V.options,Y=[],J=[],ae,_e=H.step,Me=(v=v||V.points).reversed;return Me&&v.reverse(),(_e={right:1,center:2}[_e]||_e&&3)&&Me&&(_e=4-_e),(v=this.getValidPoints(v,!1,H.nullInteraction||!(H.connectNulls&&!k&&!D))).forEach(function(xe,Pe){let je,Qe=xe.plotX,at=xe.plotY,nt=v[Pe-1],it=xe.isNull||typeof at!="number";(xe.leftCliff||nt!=null&&nt.rightCliff)&&!D&&(ae=!0),it&&!$e(k)&&Pe>0?ae=!H.connectNulls:it&&!k?ae=!0:(Pe===0||ae?je=[["M",xe.plotX,xe.plotY]]:V.getPointSpline?je=[V.getPointSpline(v,xe,Pe)]:_e?(je=_e===1?[["L",nt.plotX,at]]:_e===2?[["L",(nt.plotX+Qe)/2,nt.plotY],["L",(nt.plotX+Qe)/2,at]]:[["L",Qe,nt.plotY]]).push(["L",Qe,at]):je=[["L",Qe,at]],J.push(xe.x),_e&&(J.push(xe.x),_e===2&&J.push(xe.x)),Y.push.apply(Y,je),ae=!1)}),Y.xMap=J,V.graphPath=Y,Y}}Xe.defaultOptions=Ne(yh.defaultOptions,{legendSymbol:"lineMarker"}),Cl.registerSeriesType("line",Xe);let{seriesTypes:{line:et}}=Cl,{extend:_t,merge:Ct,objectEach:jt,pick:Ft}=pr;class Rt extends et{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:v,options:k}=this;[this,...this.zones].forEach((D,V)=>{let H={},Y=D.fillColor||k.fillColor,J=D.area,ae=J?"animate":"attr";J?(J.endX=this.preventGraphAnimation?null:v.xMap,J.animate({d:v})):(H.zIndex=0,(J=D.area=this.chart.renderer.path(v).addClass("highcharts-area"+(V?` highcharts-zone-area-${V-1} `:" ")+(V&&D.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(H.fill=Y||D.color||this.color,H["fill-opacity"]=Y?1:k.fillOpacity??.75,J.css({pointerEvents:this.stickyTracking?"none":"auto"})),J[ae](H),J.startX=v.xMap,J.shiftUnit=k.step?2:1})}getGraphPath(v){let k,D,V,H=et.prototype.getGraphPath,Y=this.options,J=Y.stacking,ae=this.yAxis,_e=[],Me=[],xe=this.index,Pe=ae.stacking.stacks[this.stackKey],je=Y.threshold,Qe=Math.round(ae.getThreshold(Y.threshold)),at=Ft(Y.connectNulls,J==="percent"),nt=function(Ri,Sr,hr){let wr=v[Ri],Jr=J&&Pe[wr.x].points[xe],yn=wr[hr+"Null"]||0,Rn=wr[hr+"Cliff"]||0,fn,ms,hs=!0;Rn||yn?(fn=(yn?Jr[0]:Jr[1])+Rn,ms=Jr[0]+Rn,hs=!!yn):!J&&v[Sr]&&v[Sr].isNull&&(fn=ms=je),fn!==void 0&&(Me.push({plotX:k,plotY:fn===null?Qe:ae.getThreshold(fn),isNull:hs,isCliff:!0}),_e.push({plotX:k,plotY:ms===null?Qe:ae.getThreshold(ms),doCurve:!1}))};v=v||this.points,J&&(v=this.getStackPoints(v));for(let Ri=0,Sr=v.length;Ri<Sr;++Ri)J||(v[Ri].leftCliff=v[Ri].rightCliff=v[Ri].leftNull=v[Ri].rightNull=void 0),D=v[Ri].isNull,k=Ft(v[Ri].rectPlotX,v[Ri].plotX),V=J?Ft(v[Ri].yBottom,Qe):Qe,(!D||at)&&(at||nt(Ri,Ri-1,"left"),D&&!J&&at||(Me.push(v[Ri]),_e.push({x:Ri,plotX:k,plotY:V})),at||nt(Ri,Ri+1,"right"));let it=H.call(this,Me,!0,!0);_e.reversed=!0;let wt=H.call(this,_e,!0,!0),kt=wt[0];kt&&kt[0]==="M"&&(wt[0]=["L",kt[1],kt[2]]);let Ai=it.concat(wt);Ai.length&&Ai.push(["Z"]);let ki=H.call(this,Me,!1,at);return this.chart.series.length>1&&J&&Me.some(Ri=>Ri.isCliff)&&(Ai.hasStackedCliffs=ki.hasStackedCliffs=!0),Ai.xMap=it.xMap,this.areaPath=Ai,ki}getStackPoints(v){let k=this,D=[],V=[],H=this.xAxis,Y=this.yAxis,J=Y.stacking.stacks[this.stackKey],ae={},_e=Y.series,Me=_e.length,xe=Y.options.reversedStacks?1:-1,Pe=_e.indexOf(k);if(v=v||this.points,this.options.stacking){for(let Qe=0;Qe<v.length;Qe++)v[Qe].leftNull=v[Qe].rightNull=void 0,ae[v[Qe].x]=v[Qe];jt(J,function(Qe,at){Qe.total!==null&&V.push(at)}),V.sort(function(Qe,at){return Qe-at});let je=_e.map(Qe=>Qe.visible);V.forEach(function(Qe,at){let nt=0,it,wt;if(ae[Qe]&&!ae[Qe].isNull)D.push(ae[Qe]),[-1,1].forEach(function(kt){let Ai=kt===1?"rightNull":"leftNull",ki=J[V[at+kt]],Ri=0;if(ki){let Sr=Pe;for(;Sr>=0&&Sr<Me;){let hr=_e[Sr].index;!(it=ki.points[hr])&&(hr===k.index?ae[Qe][Ai]=!0:je[Sr]&&(wt=J[Qe].points[hr])&&(Ri-=wt[1]-wt[0])),Sr+=xe}}ae[Qe][kt===1?"rightCliff":"leftCliff"]=Ri});else{let kt=Pe;for(;kt>=0&&kt<Me;){let Ai=_e[kt].index;if(it=J[Qe].points[Ai]){nt=it[1];break}kt+=xe}nt=Ft(nt,0),nt=Y.translate(nt,0,1,0,1),D.push({isNull:!0,plotX:H.translate(Qe,0,0,0,1),x:Qe,plotY:nt,yBottom:nt})}})}return D}}Rt.defaultOptions=Ct(et.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),_t(Rt.prototype,{singleStacks:!1}),Cl.registerSeriesType("area",Rt);let{line:Et}=Cl.seriesTypes,{merge:Wt,pick:qt}=pr;class Ei extends Et{getPointSpline(v,k,D){let V,H,Y,J,ae=k.plotX||0,_e=k.plotY||0,Me=v[D-1],xe=v[D+1];function Pe(Qe){return Qe&&!Qe.isNull&&Qe.doCurve!==!1&&!k.isCliff}if(Pe(Me)&&Pe(xe)){let Qe=Me.plotX||0,at=Me.plotY||0,nt=xe.plotX||0,it=xe.plotY||0,wt=0;V=(1.5*ae+Qe)/2.5,H=(1.5*_e+at)/2.5,Y=(1.5*ae+nt)/2.5,J=(1.5*_e+it)/2.5,Y!==V&&(wt=(J-H)*(Y-ae)/(Y-V)+_e-J),H+=wt,J+=wt,H>at&&H>_e?(H=Math.max(at,_e),J=2*_e-H):H<at&&H<_e&&(H=Math.min(at,_e),J=2*_e-H),J>it&&J>_e?(J=Math.max(it,_e),H=2*_e-J):J<it&&J<_e&&(J=Math.min(it,_e),H=2*_e-J),k.rightContX=Y,k.rightContY=J,k.controlPoints={low:[V,H],high:[Y,J]}}let je=["C",qt(Me.rightContX,Me.plotX,0),qt(Me.rightContY,Me.plotY,0),qt(V,ae,0),qt(H,_e,0),ae,_e];return Me.rightContX=Me.rightContY=void 0,je}}Ei.defaultOptions=Wt(Et.defaultOptions),Cl.registerSeriesType("spline",Ei);let Mi=Ei,{area:Ki,area:{prototype:Ji}}=Cl.seriesTypes,{extend:Er,merge:Ti}=pr;class $i extends Mi{}$i.defaultOptions=Ti(Mi.defaultOptions,Ki.defaultOptions),Er($i.prototype,{getGraphPath:Ji.getGraphPath,getStackPoints:Ji.getStackPoints,drawGraph:Ji.drawGraph}),Cl.registerSeriesType("areaspline",$i);let{animObject:li}=Or,{parse:dr}=Un,{noop:Ni}=Ye,{clamp:vr,crisp:Nr,defined:ar,extend:Br,fireEvent:dn,isArray:pn,isNumber:on,merge:bn,pick:An,objectEach:Vn}=pr;class Zn extends yh{animate(v){let k,D,V=this,H=this.yAxis,Y=H.pos,J=H.reversed,ae=V.options,{clipOffset:_e,inverted:Me}=this.chart,xe={},Pe=Me?"translateX":"translateY";v&&_e?(xe.scaleY=.001,D=vr(H.toPixels(ae.threshold||0),Y,Y+H.len),Me?xe.translateX=(D+=J?-Math.floor(_e[0]):Math.ceil(_e[2]))-H.len:xe.translateY=D+=J?Math.ceil(_e[0]):-Math.floor(_e[2]),V.clipBox&&V.setClip(),V.group.attr(xe)):(k=Number(V.group.attr(Pe)),V.group.animate({scaleY:1},Br(li(V.options.animation),{step:function(je,Qe){V.group&&(xe[Pe]=k+Qe.pos*(Y-k),V.group.attr(xe))}})))}init(v,k){super.init.apply(this,arguments);let D=this;(v=D.chart).hasRendered&&v.series.forEach(function(V){V.type===D.type&&(V.isDirty=!0)})}getColumnMetrics(){var at,nt;let v=this,k=v.options,D=v.xAxis,V=v.yAxis,H=D.options.reversedStacks,Y=D.reversed&&!H||!D.reversed&&H,J={},ae,_e=0;k.grouping===!1?_e=1:v.chart.series.forEach(function(it){let wt,kt=it.yAxis,Ai=it.options;it.type===v.type&&it.reserveSpace()&&V.len===kt.len&&V.pos===kt.pos&&(Ai.stacking&&Ai.stacking!=="group"?(J[ae=it.stackKey]===void 0&&(J[ae]=_e++),wt=J[ae]):Ai.grouping!==!1&&(wt=_e++),it.columnIndex=wt)});let Me=Math.min(Math.abs(D.transA)*(!((at=D.brokenAxis)!=null&&at.hasBreaks)&&((nt=D.ordinal)==null?void 0:nt.slope)||k.pointRange||D.closestPointRange||D.tickInterval||1),D.len),xe=Me*k.groupPadding,Pe=(Me-2*xe)/(_e||1),je=Math.min(k.maxPointWidth||D.len,An(k.pointWidth,Pe*(1-2*k.pointPadding))),Qe=(v.columnIndex||0)+ +!!Y;return v.columnMetrics={width:je,offset:(Pe-je)/2+(xe+Qe*Pe-Me/2)*(Y?-1:1),paddedWidth:Pe,columnCount:_e},v.columnMetrics}crispCol(v,k,D,V){let H=this.borderWidth,Y=this.chart.inverted;return V=Nr(k+V,H,Y)-(k=Nr(k,H,Y)),this.options.crisp&&(D=Nr(v+D,H)-(v=Nr(v,H))),{x:v,y:k,width:D,height:V}}adjustForMissingColumns(v,k,D,V){var H;if(!D.isNull&&V.columnCount>1){let Y=this.xAxis.series.filter(Me=>Me.visible).map(Me=>Me.index),J=0,ae=0;Vn((H=this.xAxis.stacking)==null?void 0:H.stacks,Me=>{var Qe;let xe=typeof D.x=="number"?(Qe=Me[D.x.toString()])==null?void 0:Qe.points:void 0,Pe=xe==null?void 0:xe[this.index],je={};if(xe&&pn(Pe)){let at=this.index,nt=Object.keys(xe).filter(it=>!it.match(",")&&xe[it]&&xe[it].length>1).map(parseFloat).filter(it=>Y.indexOf(it)!==-1).filter(it=>{let wt=this.chart.series[it].options,kt=wt.stacking&&wt.stack;if(ar(kt)){if(on(je[kt]))return at===it&&(at=je[kt]),!1;je[kt]=it}return!0}).sort((it,wt)=>wt-it);J=nt.indexOf(at),ae=nt.length}}),J=this.xAxis.reversed?ae-1-J:J;let _e=(ae-1)*V.paddedWidth+k;v=(D.plotX||0)+_e/2-k-J*V.paddedWidth}return v}translate(){let v=this,k=v.chart,D=v.options,V=v.dense=v.closestPointRange*v.xAxis.transA<2,H=v.borderWidth=An(D.borderWidth,+!V),Y=v.xAxis,J=v.yAxis,ae=D.threshold,_e=An(D.minPointLength,5),Me=v.getColumnMetrics(),xe=Me.width,Pe=v.pointXOffset=Me.offset,je=v.dataMin,Qe=v.dataMax,at=v.translatedThreshold=J.getThreshold(ae),nt=v.barW=Math.max(xe,1+2*H);D.pointPadding&&D.crisp&&(nt=Math.ceil(nt)),yh.prototype.translate.apply(v),v.points.forEach(function(it){let wt=An(it.yBottom,at),kt=999+Math.abs(wt),Ai=it.plotX||0,ki=vr(it.plotY,-kt,J.len+kt),Ri,Sr=Math.min(ki,wt),hr=Math.max(ki,wt)-Sr,wr=xe,Jr=Ai+Pe,yn=nt;_e&&Math.abs(hr)<_e&&(hr=_e,Ri=!J.reversed&&!it.negative||J.reversed&&it.negative,on(ae)&&on(Qe)&&it.y===ae&&Qe<=ae&&(J.min||0)<ae&&(je!==Qe||(J.max||0)<=ae)&&(Ri=!Ri,it.negative=!it.negative),Sr=Math.abs(Sr-at)>_e?wt-_e:at-(Ri?_e:0)),ar(it.options.pointWidth)&&(Jr-=Math.round(((wr=yn=Math.ceil(it.options.pointWidth))-xe)/2)),D.centerInCategory&&(Jr=v.adjustForMissingColumns(Jr,wr,it,Me)),it.barX=Jr,it.pointWidth=wr,it.tooltipPos=k.inverted?[vr(J.len+J.pos-k.plotLeft-ki,J.pos-k.plotLeft,J.len+J.pos-k.plotLeft),Y.len+Y.pos-k.plotTop-Jr-yn/2,hr]:[Y.left-k.plotLeft+Jr+yn/2,vr(ki+J.pos-k.plotTop,J.pos-k.plotTop,J.len+J.pos-k.plotTop),hr],it.shapeType=v.pointClass.prototype.shapeType||"roundedRect",it.shapeArgs=v.crispCol(Jr,Sr,yn,it.isNull?0:hr)}),dn(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(v,k){let D=this.options,V=this.pointAttrToOptions||{},H=V.stroke||"borderColor",Y=V["stroke-width"]||"borderWidth",J,ae,_e,Me=v&&v.color||this.color,xe=v&&v[H]||D[H]||Me,Pe=v&&v.options.dashStyle||D.dashStyle,je=v&&v[Y]||D[Y]||this[Y]||0,Qe=v!=null&&v.isNull&&D.nullInteraction?0:(v==null?void 0:v.opacity)??D.opacity??1;v&&this.zones.length&&(ae=v.getZone(),Me=v.options.color||ae&&(ae.color||v.nonZonedColor)||this.color,ae&&(xe=ae.borderColor||xe,Pe=ae.dashStyle||Pe,je=ae.borderWidth||je)),k&&v&&(_e=(J=bn(D.states[k],v.options.states&&v.options.states[k]||{})).brightness,Me=J.color||_e!==void 0&&dr(Me).brighten(J.brightness).get()||Me,xe=J[H]||xe,je=J[Y]||je,Pe=J.dashStyle||Pe,Qe=An(J.opacity,Qe));let at={fill:Me,stroke:xe,"stroke-width":je,opacity:Qe};return Pe&&(at.dashstyle=Pe),at}drawPoints(v=this.points){let k,D=this,V=this.chart,H=D.options,Y=H.nullInteraction,J=V.renderer,ae=H.animationLimit||250;v.forEach(function(_e){let Me=_e.plotY,xe=_e.graphic,Pe=!!xe,je=xe&&V.pointCount<ae?"animate":"attr";on(Me)&&(_e.y!==null||Y)?(k=_e.shapeArgs,xe&&_e.hasNewShapeType()&&(xe=xe.destroy()),D.enabledDataSorting&&(_e.startXPos=D.xAxis.reversed?-(k&&k.width||0):D.xAxis.width),!xe&&(_e.graphic=xe=J[_e.shapeType](k).add(_e.group||D.group),xe&&D.enabledDataSorting&&V.hasRendered&&V.pointCount<ae&&(xe.attr({x:_e.startXPos}),Pe=!0,je="animate")),xe&&Pe&&xe[je](bn(k)),V.styledMode||xe[je](D.pointAttribs(_e,_e.selected&&"select")).shadow(_e.allowShadow!==!1&&H.shadow),xe&&(xe.addClass(_e.getClassName(),!0),xe.attr({visibility:_e.visible?"inherit":"hidden"}))):xe&&(_e.graphic=xe.destroy())})}drawTracker(v=this.points){let k,D=this,V=D.chart,H=V.pointer,Y=function(J){H==null||H.normalize(J);let ae=H==null?void 0:H.getPointFromEvent(J);H&&ae&&D.options.enableMouseTracking&&(V.isInsidePlot(J.chartX-V.plotLeft,J.chartY-V.plotTop,{visiblePlotOnly:!0})||H!=null&&H.inClass(J.target,"highcharts-data-label"))&&(H.isDirectTouch=!0,ae.onMouseOver(J))};v.forEach(function(J){k=pn(J.dataLabels)?J.dataLabels:J.dataLabel?[J.dataLabel]:[],J.graphic&&(J.graphic.element.point=J),k.forEach(function(ae){(ae.div||ae.element).point=J})}),D._hasTracking||(D.trackerGroups.forEach(function(J){D[J]&&(D[J].addClass("highcharts-tracker").on("mouseover",Y).on("mouseout",function(ae){H==null||H.onTrackerMouseOut(ae)}).on("touchstart",Y),!V.styledMode&&D.options.cursor&&D[J].css({cursor:D.options.cursor}))}),D._hasTracking=!0),dn(this,"afterDrawTracker")}remove(){let v=this,k=v.chart;k.hasRendered&&k.series.forEach(function(D){D.type===v.type&&(D.isDirty=!0)}),yh.prototype.remove.apply(v,arguments)}}Zn.defaultOptions=bn(yh.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Br(Zn.prototype,{directTouch:!0,getSymbol:Ni,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),Cl.registerSeriesType("column",Zn);let ys=Zn,{getDeferredAnimation:Bo}=Or,{format:Da}=ul,{defined:xo,extend:ia,fireEvent:sl,getAlignFactor:ls,isArray:cs,isString:Ts,merge:_a,objectEach:Jl,pick:Zo,pInt:Wo,splat:ol}=pr;(function(ve){function v(){return ae(this).some(Me=>Me==null?void 0:Me.enabled)}function k(Me,xe,Pe,je,Qe){var Jr;let{chart:at,enabledDataSorting:nt}=this,it=this.isCartesian&&at.inverted,wt=Me.plotX,kt=Me.plotY,Ai=Pe.rotation||0,ki=xo(wt)&&xo(kt)&&at.isInsidePlot(wt,Math.round(kt),{inverted:it,paneCoordinates:!0,series:this}),Ri=Ai===0&&Zo(Pe.overflow,nt?"none":"justify")==="justify",Sr=this.visible&&Me.visible!==!1&&xo(wt)&&(Me.series.forceDL||nt&&!Ri||ki||Zo(Pe.inside,!!this.options.stacking)&&je&&at.isInsidePlot(wt,it?je.x+1:je.y+je.height-1,{inverted:it,paneCoordinates:!0,series:this})),hr=Me.pos();if(Sr&&hr){var wr;let yn=xe.getBBox(),Rn=xe.getBBox(void 0,0);if(je=ia({x:hr[0],y:Math.round(hr[1]),width:0,height:0},je||{}),Pe.alignTo==="plotEdges"&&this.isCartesian&&(je[it?"x":"y"]=0,je[it?"width":"height"]=((Jr=this.yAxis)==null?void 0:Jr.len)||0),ia(Pe,{width:yn.width,height:yn.height}),wr=je,nt&&this.xAxis&&!Ri&&this.setDataLabelStartPos(Me,xe,Qe,ki,wr),xe.align(_a(Pe,{width:Rn.width,height:Rn.height}),!1,je,!1),xe.alignAttr.x+=ls(Pe.align)*(Rn.width-yn.width),xe.alignAttr.y+=ls(Pe.verticalAlign)*(Rn.height-yn.height),xe[xe.placed?"animate":"attr"]({"text-align":xe.alignAttr["text-align"]||"center",x:xe.alignAttr.x+(yn.width-Rn.width)/2,y:xe.alignAttr.y+(yn.height-Rn.height)/2,rotationOriginX:(xe.width||0)/2,rotationOriginY:(xe.height||0)/2}),Ri&&je.height>=0)this.justifyDataLabel(xe,Pe,xe.alignAttr,yn,je,Qe);else if(Zo(Pe.crop,!0)){let{x:fn,y:ms}=xe.alignAttr;Sr=at.isInsidePlot(fn,ms,{paneCoordinates:!0,series:this})&&at.isInsidePlot(fn+yn.width-1,ms+yn.height-1,{paneCoordinates:!0,series:this})}Pe.shape&&!Ai&&xe[Qe?"attr":"animate"]({anchorX:hr[0],anchorY:hr[1]})}Qe&&nt&&(xe.placed=!1),Sr||nt&&!Ri?(xe.show(),xe.placed=!0):(xe.hide(),xe.placed=!1)}function D(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function V(Me){let xe=this.hasRendered||0,Pe=this.initDataLabelsGroup().attr({opacity:+xe});return!xe&&Pe&&(this.visible&&Pe.show(),this.options.animation?Pe.animate({opacity:1},Me):Pe.attr({opacity:1})),Pe}function H(Me){var Sr;let xe;Me=Me||this.points;let Pe=this,je=Pe.chart,Qe=Pe.options,at=je.renderer,{backgroundColor:nt,plotBackgroundColor:it}=je.options.chart,wt=at.getContrast(Ts(it)&&it||Ts(nt)&&nt||"#000000"),kt=ae(Pe),{animation:Ai,defer:ki}=kt[0],Ri=ki?Bo(je,Ai,Pe):{defer:0,duration:0};sl(this,"drawDataLabels"),(Sr=Pe.hasDataLabels)!=null&&Sr.call(Pe)&&(xe=this.initDataLabels(Ri),Me.forEach(hr=>{var Rn,fn,ms;let wr=hr.dataLabels||[],Jr=hr.color||Pe.color;ol(J(kt,hr.dlOptions||((Rn=hr.options)==null?void 0:Rn.dataLabels))).forEach((hs,Is)=>{var pa;let jn=hs.enabled&&(hr.visible||hr.dataLabelOnHidden)&&(!hr.isNull||hr.dataLabelOnNull)&&function(Ih,nh){let va=nh.filter;if(va){let ou=va.operator,Lh=Ih[va.property],Rl=va.value;return ou===">"&&Lh>Rl||ou==="<"&&Lh<Rl||ou===">="&&Lh>=Rl||ou==="<="&&Lh<=Rl||ou==="=="&&Lh==Rl||ou==="==="&&Lh===Rl||ou==="!="&&Lh!=Rl||ou==="!=="&&Lh!==Rl||!1}return!0}(hr,hs),{backgroundColor:us,borderColor:oa,distance:Ea,style:ka={}}=hs,Mh,da,Ol,Co={},Os=wr[Is],Us=!Os,tl;jn&&(da=xo(Mh=Zo(hs[hr.formatPrefix+"Format"],hs.format))?Da(Mh,hr,je):(hs[hr.formatPrefix+"Formatter"]||hs.formatter).call(hr,hs),Ol=hs.rotation,!je.styledMode&&(ka.color=Zo(hs.color,ka.color,Ts(Pe.color)?Pe.color:void 0,"#000000"),ka.color==="contrast"?(us!=="none"&&(tl=us),hr.contrastColor=at.getContrast(tl!=="auto"&&Ts(tl)&&tl||(Ts(Jr)?Jr:"")),ka.color=tl||!xo(Ea)&&hs.inside||0>Wo(Ea||0)||Qe.stacking?hr.contrastColor:wt):delete hr.contrastColor,Qe.cursor&&(ka.cursor=Qe.cursor)),Co={r:hs.borderRadius||0,rotation:Ol,padding:hs.padding,zIndex:1},je.styledMode||(Co.fill=us==="auto"?hr.color:us,Co.stroke=oa==="auto"?hr.color:oa,Co["stroke-width"]=hs.borderWidth),Jl(Co,(Ih,nh)=>{Ih===void 0&&delete Co[nh]})),!Os||jn&&xo(da)&&!!(Os.div||(pa=Os.text)!=null&&pa.foreignObject)==!!hs.useHTML&&(Os.rotation&&hs.rotation||Os.rotation===hs.rotation)||(Os=void 0,Us=!0),jn&&xo(da)&&da!==""&&(Os?Co.text=da:(Os=at.label(da,0,0,hs.shape,void 0,void 0,hs.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+hr.colorIndex+" "+(hs.className||"")+(hs.useHTML?" highcharts-tracker":"")),Os&&(Os.options=hs,Os.attr(Co),je.styledMode?ka.width&&Os.css({width:ka.width,textOverflow:ka.textOverflow,whiteSpace:ka.whiteSpace}):Os.css(ka).shadow(hs.shadow),sl(Os,"beforeAddingDataLabel",{labelOptions:hs,point:hr}),Os.added||Os.add(xe),Pe.alignDataLabel(hr,Os,hs,void 0,Us),Os.isActive=!0,wr[Is]&&wr[Is]!==Os&&wr[Is].destroy(),wr[Is]=Os))});let yn=wr.length;for(;yn--;)(fn=wr[yn])!=null&&fn.isActive?wr[yn].isActive=!1:((ms=wr[yn])==null||ms.destroy(),wr.splice(yn,1));hr.dataLabel=wr[0],hr.dataLabels=wr})),sl(this,"afterDrawDataLabels")}function Y(Me,xe,Pe,je,Qe,at){let nt=this.chart,it=xe.align,wt=xe.verticalAlign,kt=Me.box?0:Me.padding||0,Ai=nt.inverted?this.yAxis:this.xAxis,ki=Ai?Ai.left-nt.plotLeft:0,Ri=nt.inverted?this.xAxis:this.yAxis,Sr=Ri?Ri.top-nt.plotTop:0,{x:hr=0,y:wr=0}=xe,Jr,yn;return(Jr=(Pe.x||0)+kt+ki)<0&&(it==="right"&&hr>=0?(xe.align="left",xe.inside=!0):hr-=Jr,yn=!0),(Jr=(Pe.x||0)+je.width-kt+ki)>nt.plotWidth&&(it==="left"&&hr<=0?(xe.align="right",xe.inside=!0):hr+=nt.plotWidth-Jr,yn=!0),(Jr=Pe.y+kt+Sr)<0&&(wt==="bottom"&&wr>=0?(xe.verticalAlign="top",xe.inside=!0):wr-=Jr,yn=!0),(Jr=(Pe.y||0)+je.height-kt+Sr)>nt.plotHeight&&(wt==="top"&&wr<=0?(xe.verticalAlign="bottom",xe.inside=!0):wr+=nt.plotHeight-Jr,yn=!0),yn&&(xe.x=hr,xe.y=wr,Me.placed=!at,Me.align(xe,void 0,Qe)),yn}function J(Me,xe){let Pe=[],je;if(cs(Me)&&!cs(xe))Pe=Me.map(function(Qe){return _a(Qe,xe)});else if(cs(xe)&&!cs(Me))Pe=xe.map(function(Qe){return _a(Me,Qe)});else if(cs(Me)||cs(xe)){if(cs(Me)&&cs(xe))for(je=Math.max(Me.length,xe.length);je--;)Pe[je]=_a(Me[je],xe[je])}else Pe=_a(Me,xe);return Pe}function ae(Me){var Pe,je;let xe=Me.chart.options.plotOptions;return ol(J(J((Pe=xe==null?void 0:xe.series)==null?void 0:Pe.dataLabels,(je=xe==null?void 0:xe[Me.type])==null?void 0:je.dataLabels),Me.options.dataLabels))}function _e(Me,xe,Pe,je,Qe){let at=this.chart,nt=at.inverted,it=this.xAxis,wt=it.reversed,kt=((nt?xe.height:xe.width)||0)/2,Ai=Me.pointWidth,ki=Ai?Ai/2:0;xe.startXPos=nt?Qe.x:wt?-kt-ki:it.width-kt+ki,xe.startYPos=nt?wt?this.yAxis.height-kt+ki:-kt-ki:Qe.y,je?xe.visibility==="hidden"&&(xe.show(),xe.attr({opacity:0}).animate({opacity:1})):xe.attr({opacity:1}).animate({opacity:0},void 0,xe.hide),at.hasRendered&&(Pe&&xe.attr({x:xe.startXPos,y:xe.startYPos}),xe.placed=!0)}ve.compose=function(Me){let xe=Me.prototype;xe.initDataLabels||(xe.initDataLabels=V,xe.initDataLabelsGroup=D,xe.alignDataLabel=k,xe.drawDataLabels=H,xe.justifyDataLabel=Y,xe.mergeArrays=J,xe.setDataLabelStartPos=_e,xe.hasDataLabels=v)}})(he||(he={}));let Ws=he,{composed:ec}=Ye,{series:Ta}=Cl,{merge:Ca,pushUnique:Ko}=pr;(function(ve){function v(k,D,V,H,Y){var at,nt;let{chart:J,options:ae}=this,_e=J.inverted,Me=((at=this.xAxis)==null?void 0:at.len)||J.plotSizeX||0,xe=((nt=this.yAxis)==null?void 0:nt.len)||J.plotSizeY||0,Pe=k.dlBox||k.shapeArgs,je=k.below??(k.plotY||0)>(this.translatedThreshold??xe),Qe=V.inside??!!ae.stacking;if(Pe){if(H=Ca(Pe),V.overflow!=="allow"||V.crop!==!1||ae.clip!==!1){H.y<0&&(H.height+=H.y,H.y=0);let it=H.y+H.height-xe;it>0&&it<H.height-1&&(H.height-=it)}_e&&(H={x:xe-H.y-H.height,y:Me-H.x-H.width,width:H.height,height:H.width}),Qe||(_e?(H.x+=je?0:H.width,H.width=0):(H.y+=je?H.height:0,H.height=0))}V.align??(V.align=!_e||Qe?"center":je?"right":"left"),V.verticalAlign??(V.verticalAlign=_e||Qe?"middle":je?"top":"bottom"),Ta.prototype.alignDataLabel.call(this,k,D,V,H,Y),V.inside&&k.contrastColor&&D.css({color:k.contrastColor})}ve.compose=function(k){Ws.compose(Ta),Ko(ec,"ColumnDataLabel")&&(k.prototype.alignDataLabel=v)}})(fe||(fe={}));let bo=fe,{extend:Ya,merge:_h}=pr;class ua extends ys{}ua.defaultOptions=_h(ys.defaultOptions,{}),Ya(ua.prototype,{inverted:!0}),Cl.registerSeriesType("bar",ua);let{column:Fo,line:ru}=Cl.seriesTypes,{addEvent:Ah,extend:od,merge:Od}=pr;class nu extends ru{applyJitter(){let v=this,k=this.options.jitter,D=this.points.length;k&&this.points.forEach(function(V,H){["x","y"].forEach(function(Y,J){if(k[Y]&&!V.isNull){let ae=`plot${Y.toUpperCase()}`,_e=v[`${Y}Axis`],Me=k[Y]*_e.transA;if(_e&&!_e.logarithmic){let xe=Math.max(0,(V[ae]||0)-Me),Pe=Math.min(_e.len,(V[ae]||0)+Me);V[ae]=xe+(Pe-xe)*function(je){let Qe=1e4*Math.sin(je);return Qe-Math.floor(Qe)}(H+J*D),Y==="x"&&(V.clientX=V.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}nu.defaultOptions=Od(ru.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}"></span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),od(nu.prototype,{drawTracker:Fo.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Ah(nu,"afterTranslate",function(){this.applyJitter()}),Cl.registerSeriesType("scatter",nu);let{deg2rad:su}=Ye,{fireEvent:Qd,isNumber:ad,pick:Jd,relativeLength:cm}=pr;(function(ve){ve.getCenter=function(){let v=this.options,k=this.chart,D=2*(v.slicedOffset||0),V=k.plotWidth-2*D,H=k.plotHeight-2*D,Y=v.center,J=Math.min(V,H),ae=v.thickness,_e,Me=v.size,xe=v.innerSize||0,Pe,je;typeof Me=="string"&&(Me=parseFloat(Me)),typeof xe=="string"&&(xe=parseFloat(xe));let Qe=[Jd(Y==null?void 0:Y[0],"50%"),Jd(Y==null?void 0:Y[1],"50%"),Jd(Me&&Me<0?void 0:v.size,"100%"),Jd(xe&&xe<0?void 0:v.innerSize||0,"0%")];for(!k.angular||this instanceof yh||(Qe[3]=0),Pe=0;Pe<4;++Pe)je=Qe[Pe],_e=Pe<2||Pe===2&&/%$/.test(je),Qe[Pe]=cm(je,[V,H,J,Qe[2]][Pe])+(_e?D:0);return Qe[3]>Qe[2]&&(Qe[3]=Qe[2]),ad(ae)&&2*ae<Qe[2]&&ae>0&&(Qe[3]=Qe[2]-2*ae),Qd(this,"afterGetCenter",{positions:Qe}),Qe},ve.getStartAndEndRadians=function(v,k){let D=ad(v)?v:0,V=ad(k)&&k>D&&k-D<360?k:D+360;return{start:su*(D+-90),end:su*(V+-90)}}})(le||(le={}));let hy=le,{setAnimation:hm}=Or,{addEvent:uy,defined:Pg,extend:dy,isNumber:um,pick:ep,relativeLength:jm}=pr;class Sp extends yf{getConnectorPath(v){let k=v.dataLabelPosition,D=v.options||{},V=D.connectorShape,H=this.connectorShapes[V]||V;return k&&H.call(this,{...k.computed,alignment:k.alignment},k.connectorPosition,D)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(v){let k=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(k.x,k.y,k.r+v,k.r+v,{innerR:k.r-1,start:k.start,end:k.end,borderRadius:k.borderRadius})}constructor(v,k,D){super(v,k,D),this.half=0,this.name??(this.name=v.chart.options.lang.pieSliceName);let V=H=>{this.slice(H.type==="select")};uy(this,"select",V),uy(this,"unselect",V)}isValid(){return um(this.y)&&this.y>=0}setVisible(v,k=!0){v!==this.visible&&this.update({visible:v??!this.visible},k,void 0,!1)}slice(v,k,D){let V=this.series;hm(D,V.chart),k=ep(k,!0),this.sliced=this.options.sliced=v=Pg(v)?v:!this.sliced,V.options.data[V.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}dy(Sp.prototype,{connectorShapes:{fixedOffset:function(ve,v,k){let D=v.breakAt,V=v.touchingSliceAt,H=k.softConnector?["C",ve.x+(ve.alignment==="left"?-5:5),ve.y,2*D.x-V.x,2*D.y-V.y,D.x,D.y]:["L",D.x,D.y];return[["M",ve.x,ve.y],H,["L",V.x,V.y]]},straight:function(ve,v){let k=v.touchingSliceAt;return[["M",ve.x,ve.y],["L",k.x,k.y]]},crookedLine:function(ve,v,k){let{angle:D=this.angle||0,breakAt:V,touchingSliceAt:H}=v,{series:Y}=this,[J,ae,_e]=Y.center,Me=_e/2,{plotLeft:xe,plotWidth:Pe}=Y.chart,je=ve.alignment==="left",{x:Qe,y:at}=ve,nt=V.x;if(k.crookDistance){let wt=jm(k.crookDistance,1);nt=je?J+Me+(Pe+xe-J-Me)*(1-wt):xe+(J-Me)*wt}else nt=J+(ae-at)*Math.tan(D-Math.PI/2);let it=[["M",Qe,at]];return(je?nt<=Qe&&nt>=V.x:nt>=Qe&&nt<=V.x)&&it.push(["L",nt,at]),it.push(["L",V.x,V.y],["L",H.x,H.y]),it}}});let{getStartAndEndRadians:tp}=hy,{noop:N0}=Ye,{clamp:Og,extend:B0,fireEvent:Gy,merge:qy,pick:hv}=pr;class F0 extends yh{animate(v){let k=this,D=k.points,V=k.startAngleRad;v||D.forEach(function(H){let Y=H.graphic,J=H.shapeArgs;Y&&J&&(Y.attr({r:hv(H.startR,k.center&&k.center[3]/2),start:V,end:V}),Y.animate({r:J.r,start:J.start,end:J.end},k.options.animation))})}drawEmpty(){let v,k,D=this.startAngleRad,V=this.endAngleRad,H=this.options;this.total===0&&this.center?(v=this.center[0],k=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(v,k,this.center[1]/2,0,D,V).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Zs.arc(v,k,this.center[2]/2,0,{start:D,end:V,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":H.borderWidth,fill:H.fillColor||"none",stroke:H.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let v=this.chart.renderer;this.points.forEach(function(k){k.graphic&&k.hasNewShapeType()&&(k.graphic=k.graphic.destroy()),k.graphic||(k.graphic=v[k.shapeType](k.shapeArgs).add(k.series.group),k.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(v,k,D,V){let H=this.center,Y=this.radii?this.radii[D.index]||0:H[2]/2,J=V.dataLabelPosition,ae=(J==null?void 0:J.distance)||0,_e=Math.asin(Og((v-H[1])/(Y+ae),-1,1));return H[0]+Math.cos(_e)*(Y+ae)*(k?-1:1)+(ae>0?(k?-1:1)*(V.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let v,k,D,V,H=this,Y=H.chart;this.drawEmpty(),H.group&&!Y.styledMode&&H.group.shadow(H.options.shadow),H.points.forEach(function(J){let ae={};k=J.graphic,!J.isNull&&k?(V=J.shapeArgs,v=J.getTranslate(),Y.styledMode||(D=H.pointAttribs(J,J.selected&&"select")),J.delayedRendering?(k.setRadialReference(H.center).attr(V).attr(v),Y.styledMode||k.attr(D).attr({"stroke-linejoin":"round"}),J.delayedRendering=!1):(k.setRadialReference(H.center),Y.styledMode||qy(!0,ae,D),qy(!0,ae,V,v),k.animate(ae)),k.attr({visibility:J.visible?"inherit":"hidden"}),k.addClass(J.getClassName(),!0)):k&&(J.graphic=k.destroy())})}sortByAngle(v,k){v.sort(function(D,V){return D.angle!==void 0&&(V.angle-D.angle)*k})}translate(v){Gy(this,"translate"),this.generatePoints();let k=this.options,D=k.slicedOffset,V=tp(k.startAngle,k.endAngle),H=this.startAngleRad=V.start,Y=(this.endAngleRad=V.end)-H,J=this.points,ae=k.ignoreHiddenPoint,_e=J.length,Me,xe,Pe,je,Qe,at,nt,it=0;for(v||(this.center=v=this.getCenter()),at=0;at<_e;at++){nt=J[at],Me=H+it*Y,nt.isValid()&&(!ae||nt.visible)&&(it+=nt.percentage/100),xe=H+it*Y;let wt={x:v[0],y:v[1],r:v[2]/2,innerR:v[3]/2,start:Math.round(1e3*Me)/1e3,end:Math.round(1e3*xe)/1e3};nt.shapeType="arc",nt.shapeArgs=wt,(Pe=(xe+Me)/2)>1.5*Math.PI?Pe-=2*Math.PI:Pe<-Math.PI/2&&(Pe+=2*Math.PI),nt.slicedTranslation={translateX:Math.round(Math.cos(Pe)*D),translateY:Math.round(Math.sin(Pe)*D)},je=Math.cos(Pe)*v[2]/2,Qe=Math.sin(Pe)*v[2]/2,nt.tooltipPos=[v[0]+.7*je,v[1]+.7*Qe],nt.half=+(Pe<-Math.PI/2||Pe>Math.PI/2),nt.angle=Pe}Gy(this,"afterTranslate")}updateTotals(){let v=this.points,k=v.length,D=this.options.ignoreHiddenPoint,V,H,Y=0;for(V=0;V<k;V++)(H=v[V]).isValid()&&(!D||H.visible)&&(Y+=H.y);for(V=0,this.total=Y;V<k;V++)(H=v[V]).percentage=Y>0&&(H.visible||!D)?H.y/Y*100:0,H.total=Y}}F0.defaultOptions=qy(yh.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),B0(F0.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:ys.prototype.drawTracker,getCenter:hy.getCenter,getSymbol:N0,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:ys.prototype.pointAttribs,pointClass:Sp,requireSorting:!1,searchPoint:N0,trackerGroups:["group","dataLabelsGroup"]}),Cl.registerSeriesType("pie",F0);let{composed:uv,noop:Rg}=Ye,{distribute:py}=Cs,{series:Hh}=Cl,{arrayMax:Ng,clamp:dv,defined:pv,pick:Yy,pushUnique:E_,relativeLength:k_}=pr;(function(ve){let v={radialDistributionY:function(Y,J){var ae;return(((ae=J.dataLabelPosition)==null?void 0:ae.top)||0)+Y.distributeBox.pos},radialDistributionX:function(Y,J,ae,_e,Me){let xe=Me.dataLabelPosition;return Y.getX(ae<((xe==null?void 0:xe.top)||0)+2||ae>((xe==null?void 0:xe.bottom)||0)-2?_e:ae,J.half,J,Me)},justify:function(Y,J,ae,_e){var Me;return _e[0]+(Y.half?-1:1)*(ae+(((Me=J.dataLabelPosition)==null?void 0:Me.distance)||0))},alignToPlotEdges:function(Y,J,ae,_e){let Me=Y.getBBox().width;return J?Me+_e:ae-Me-_e},alignToConnectors:function(Y,J,ae,_e){let Me=0,xe;return Y.forEach(function(Pe){(xe=Pe.dataLabel.getBBox().width)>Me&&(Me=xe)}),J?Me+_e:ae-Me-_e}};function k(Y,J){let ae=Math.PI/2,{start:_e=0,end:Me=0}=Y.shapeArgs||{},xe=Y.angle||0;J>0&&_e<ae&&Me>ae&&xe>ae/2&&xe<1.5*ae&&(xe=xe<=ae?Math.max(ae/2,(_e+ae)/2):Math.min(1.5*ae,(ae+Me)/2));let{center:Pe,options:je}=this,Qe=Pe[2]/2,at=Math.cos(xe),nt=Math.sin(xe),it=Pe[0]+at*Qe,wt=Pe[1]+nt*Qe,kt=Math.min((je.slicedOffset||0)+(je.borderWidth||0),J/5);return{natural:{x:it+at*J,y:wt+nt*J},computed:{},alignment:J<0?"center":Y.half?"right":"left",connectorPosition:{angle:xe,breakAt:{x:it+at*kt,y:wt+nt*kt},touchingSliceAt:{x:it,y:wt}},distance:J}}function D(){var Sr;let Y=this,J=Y.points,ae=Y.chart,_e=ae.plotWidth,Me=ae.plotHeight,xe=ae.plotLeft,Pe=Math.round(ae.chartWidth/3),je=Y.center,Qe=je[2]/2,at=je[1],nt=[[],[]],it=[0,0,0,0],wt=Y.dataLabelPositioners,kt,Ai,ki,Ri=0;Y.visible&&((Sr=Y.hasDataLabels)!=null&&Sr.call(Y))&&(J.forEach(hr=>{(hr.dataLabels||[]).forEach(wr=>{wr.shortened&&(wr.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),wr.shortened=!1)})}),Hh.prototype.drawDataLabels.apply(Y),J.forEach(hr=>{(hr.dataLabels||[]).forEach((wr,Jr)=>{var ms;let yn=je[2]/2,Rn=wr.options,fn=k_((Rn==null?void 0:Rn.distance)||0,yn);Jr===0&&nt[hr.half].push(hr),!pv((ms=Rn==null?void 0:Rn.style)==null?void 0:ms.width)&&wr.getBBox().width>Pe&&(wr.css({width:Math.round(.7*Pe)+"px"}),wr.shortened=!0),wr.dataLabelPosition=this.getDataLabelPosition(hr,fn),Ri=Math.max(Ri,fn)})}),nt.forEach((hr,wr)=>{let Jr=hr.length,yn=[],Rn,fn,ms=0,hs;Jr&&(Y.sortByAngle(hr,wr-.5),Ri>0&&(Rn=Math.max(0,at-Qe-Ri),fn=Math.min(at+Qe+Ri,ae.plotHeight),hr.forEach(Is=>{(Is.dataLabels||[]).forEach(jn=>{var oa;let us=jn.dataLabelPosition;us&&us.distance>0&&(us.top=Math.max(0,at-Qe-us.distance),us.bottom=Math.min(at+Qe+us.distance,ae.plotHeight),ms=jn.getBBox().height||21,jn.lineHeight=ae.renderer.fontMetrics(jn.text||jn).h+2*jn.padding,Is.distributeBox={target:(((oa=jn.dataLabelPosition)==null?void 0:oa.natural.y)||0)-us.top+jn.lineHeight/2,size:ms,rank:Is.y},yn.push(Is.distributeBox))})}),py(yn,hs=fn+ms-Rn,hs/5)),hr.forEach(Is=>{(Is.dataLabels||[]).forEach(jn=>{let us=jn.options||{},oa=Is.distributeBox,Ea=jn.dataLabelPosition,ka=(Ea==null?void 0:Ea.natural.y)||0,Mh=us.connectorPadding||0,da=jn.lineHeight||21,Ol=(da-jn.getBBox().height)/2,Co=0,Os=ka,Us="inherit";if(Ea){if(yn&&pv(oa)&&Ea.distance>0&&(oa.pos===void 0?Us="hidden":(ki=oa.size,Os=wt.radialDistributionY(Is,jn))),us.justify)Co=wt.justify(Is,jn,Qe,je);else switch(us.alignTo){case"connectors":Co=wt.alignToConnectors(hr,wr,_e,xe);break;case"plotEdges":Co=wt.alignToPlotEdges(jn,wr,_e,xe);break;default:Co=wt.radialDistributionX(Y,Is,Os-Ol,ka,jn)}if(Ea.attribs={visibility:Us,align:Ea.alignment},Ea.posAttribs={x:Co+(us.x||0)+({left:Mh,right:-Mh}[Ea.alignment]||0),y:Os+(us.y||0)-da/2},Ea.computed.x=Co,Ea.computed.y=Os-Ol,Yy(us.crop,!0)){let tl;Co-(Ai=jn.getBBox().width)<Mh&&wr===1?(tl=Math.round(Ai-Co+Mh),it[3]=Math.max(tl,it[3])):Co+Ai>_e-Mh&&wr===0&&(tl=Math.round(Co+Ai-_e+Mh),it[1]=Math.max(tl,it[1])),Os-ki/2<0?it[0]=Math.max(Math.round(-Os+ki/2),it[0]):Os+ki/2>Me&&(it[2]=Math.max(Math.round(Os+ki/2-Me),it[2])),Ea.sideOverflow=tl}}})}))}),(Ng(it)===0||this.verifyDataLabelOverflow(it))&&(this.placeDataLabels(),this.points.forEach(hr=>{(hr.dataLabels||[]).forEach(wr=>{var fn;let{connectorColor:Jr,connectorWidth:yn=1}=wr.options||{},Rn=wr.dataLabelPosition;if(yn){let ms;kt=wr.connector,Rn&&Rn.distance>0?(ms=!kt,kt||(wr.connector=kt=ae.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+hr.colorIndex+(hr.className?" "+hr.className:"")).add(Y.dataLabelsGroup)),ae.styledMode||kt.attr({"stroke-width":yn,stroke:Jr||hr.color||"#666666"}),kt[ms?"attr":"animate"]({d:hr.getConnectorPath(wr)}),kt.attr({visibility:(fn=Rn.attribs)==null?void 0:fn.visibility})):kt&&(wr.connector=kt.destroy())}})})))}function V(){this.points.forEach(Y=>{(Y.dataLabels||[]).forEach(J=>{var _e,Me;let ae=J.dataLabelPosition;ae?(ae.sideOverflow&&(J.css({width:Math.max(J.getBBox().width-ae.sideOverflow,0)+"px",textOverflow:((Me=(_e=J.options)==null?void 0:_e.style)==null?void 0:Me.textOverflow)||"ellipsis"}),J.shortened=!0),J.attr(ae.attribs),J[J.moved?"animate":"attr"](ae.posAttribs),J.moved=!0):J&&J.attr({y:-9999})}),delete Y.distributeBox},this)}function H(Y){let J=this.center,ae=this.options,_e=ae.center,Me=ae.minSize||80,xe=Me,Pe=ae.size!==null;return!Pe&&(_e[0]!==null?xe=Math.max(J[2]-Math.max(Y[1],Y[3]),Me):(xe=Math.max(J[2]-Y[1]-Y[3],Me),J[0]+=(Y[3]-Y[1])/2),_e[1]!==null?xe=dv(xe,Me,J[2]-Math.max(Y[0],Y[2])):(xe=dv(xe,Me,J[2]-Y[0]-Y[2]),J[1]+=(Y[0]-Y[2])/2),xe<J[2]?(J[2]=xe,J[3]=Math.min(ae.thickness?Math.max(0,xe-2*ae.thickness):Math.max(0,k_(ae.innerSize||0,xe)),xe),this.translate(J),this.drawDataLabels&&this.drawDataLabels()):Pe=!0),Pe}ve.compose=function(Y){if(Ws.compose(Hh),E_(uv,"PieDataLabel")){let J=Y.prototype;J.dataLabelPositioners=v,J.alignDataLabel=Rg,J.drawDataLabels=D,J.getDataLabelPosition=k,J.placeDataLabels=V,J.verifyDataLabelOverflow=H}}})(Se||(Se={}));let fy=Se;(function(ve){ve.getCenterOfPoints=function(v){let k=v.reduce((D,V)=>(D.x+=V.x,D.y+=V.y,D),{x:0,y:0});return{x:k.x/v.length,y:k.y/v.length}},ve.getDistanceBetweenPoints=function(v,k){return Math.sqrt(Math.pow(k.x-v.x,2)+Math.pow(k.y-v.y,2))},ve.getAngleBetweenPoints=function(v,k){return Math.atan2(k.x-v.x,k.y-v.y)},ve.pointInPolygon=function({x:v,y:k},D){let V=D.length,H,Y,J=!1;for(H=0,Y=V-1;H<V;Y=H++){let[ae,_e]=D[H],[Me,xe]=D[Y];_e>k!=xe>k&&v<(Me-ae)*(k-_e)/(xe-_e)+ae&&(J=!J)}return J}})(ke||(ke={}));let{pointInPolygon:px}=ke,{addEvent:fv,getAlignFactor:fx,fireEvent:Hm,objectEach:Kp,pick:Qp}=pr;function z0(ve){let v=ve.length,k=(Me,xe)=>!(xe.x>=Me.x+Me.width||xe.x+xe.width<=Me.x||xe.y>=Me.y+Me.height||xe.y+xe.height<=Me.y),D=(Me,xe)=>{for(let Pe of Me)if(px({x:Pe[0],y:Pe[1]},xe))return!0;return!1},V,H,Y,J,ae,_e=!1;for(let Me=0;Me<v;Me++)(V=ve[Me])&&(V.oldOpacity=V.opacity,V.newOpacity=1,V.absoluteBox=function(xe){var Pe,je;if(xe&&(!xe.alignAttr||xe.placed)){let Qe=xe.box?0:xe.padding||0,at=xe.alignAttr||{x:xe.attr("x"),y:xe.attr("y")},{height:nt,polygon:it,width:wt}=xe.getBBox(),kt=fx(xe.alignValue)*wt;return xe.width=wt,xe.height=nt,{x:at.x+(((Pe=xe.parentGroup)==null?void 0:Pe.translateX)||0)+Qe-kt,y:at.y+(((je=xe.parentGroup)==null?void 0:je.translateY)||0)+Qe,width:wt-2*Qe,height:nt-2*Qe,polygon:it}}}(V));ve.sort((Me,xe)=>(xe.labelrank||0)-(Me.labelrank||0));for(let Me=0;Me<v;++Me){J=(H=ve[Me])&&H.absoluteBox;let xe=J==null?void 0:J.polygon;for(let Pe=Me+1;Pe<v;++Pe){ae=(Y=ve[Pe])&&Y.absoluteBox;let je=!1;if(J&&ae&&H!==Y&&H.newOpacity!==0&&Y.newOpacity!==0&&H.visibility!=="hidden"&&Y.visibility!=="hidden"){let Qe=ae.polygon;if(xe&&Qe&&xe!==Qe?D(xe,Qe)&&(je=!0):k(J,ae)&&(je=!0),je){let at=H.labelrank<Y.labelrank?H:Y,nt=at.text;at.newOpacity=0,nt!=null&&nt.element.querySelector("textPath")&&nt.hide()}}}}for(let Me of ve)Xy(Me,this)&&(_e=!0);_e&&Hm(this,"afterHideAllOverlappingLabels")}function Xy(ve,v){let k,D=!1;return ve&&(k=ve.newOpacity,ve.oldOpacity!==k&&(ve.hasClass("highcharts-data-label")?(ve[k?"removeClass":"addClass"]("highcharts-data-label-hidden"),D=!0,ve[ve.isOld?"animate":"attr"]({opacity:k},void 0,function(){v.styledMode||ve.css({pointerEvents:k?"auto":"none"})}),Hm(v,"afterHideOverlappingLabel")):ve.attr({opacity:k})),ve.isOld=!0),D}function Zy(){var k;let ve=this,v=[];for(let D of ve.labelCollectors||[])v=v.concat(D());for(let D of ve.yAxis||[])D.stacking&&D.options.stackLabels&&!D.options.stackLabels.allowOverlap&&Kp(D.stacking.stacks,V=>{Kp(V,H=>{H.label&&v.push(H.label)})});for(let D of ve.series||[])if(D.visible&&((k=D.hasDataLabels)!=null&&k.call(D))){let V=H=>{for(let Y of H)Y.visible&&(Y.dataLabels||[]).forEach(J=>{var _e;let ae=J.options||{};J.labelrank=Qp(ae.labelrank,Y.labelrank,(_e=Y.shapeArgs)==null?void 0:_e.height),ae.allowOverlap??Number(ae.distance)>0?(J.oldOpacity=J.opacity,J.newOpacity=1,Xy(J,ve)):v.push(J)})};V(D.nodes||[]),V(D.points)}this.hideOverlappingLabels(v)}let my={compose:function(ve){let v=ve.prototype;v.hideOverlappingLabels||(v.hideOverlappingLabels=z0,fv(ve,"render",Zy))}},{defaultOptions:gy}=$o,{noop:yy}=Ye,{addEvent:A_,extend:U0,isObject:Ky,merge:Bg,relativeLength:Fg}=pr,mv={radius:0,scope:"stack",where:void 0},Ef=yy,Qy=yy;function Jy(ve,v,k,D,V={}){let H=Ef(ve,v,k,D,V),{innerR:Y=0,r:J=k,start:ae=0,end:_e=0}=V;if(V.open||!V.borderRadius)return H;let Me=_e-ae,xe=Math.sin(Me/2),Pe=Math.max(Math.min(Fg(V.borderRadius||0,J-Y),(J-Y)/2,J*xe/(1+xe)),0),je=Math.min(Pe,Me/Math.PI*2*Y),Qe=H.length-1;for(;Qe--;)(function(at,nt,it){let wt,kt,Ai,ki=at[nt],Ri=at[nt+1];if(Ri[0]==="Z"&&(Ri=at[0]),(ki[0]==="M"||ki[0]==="L")&&Ri[0]==="A"?(wt=ki,kt=Ri,Ai=!0):ki[0]==="A"&&(Ri[0]==="M"||Ri[0]==="L")&&(wt=Ri,kt=ki),wt&&kt&&kt.params){let Sr=kt[1],hr=kt[5],wr=kt.params,{start:Jr,end:yn,cx:Rn,cy:fn}=wr,ms=hr?Sr-it:Sr+it,hs=ms?Math.asin(it/ms):0,Is=hr?hs:-hs,jn=Math.cos(hs)*ms;Ai?(wr.start=Jr+Is,wt[1]=Rn+jn*Math.cos(Jr),wt[2]=fn+jn*Math.sin(Jr),at.splice(nt+1,0,["A",it,it,0,0,1,Rn+Sr*Math.cos(wr.start),fn+Sr*Math.sin(wr.start)])):(wr.end=yn-Is,kt[6]=Rn+Sr*Math.cos(wr.end),kt[7]=fn+Sr*Math.sin(wr.end),at.splice(nt+1,0,["A",it,it,0,0,1,Rn+jn*Math.cos(yn),fn+jn*Math.sin(yn)])),kt[4]=Math.abs(wr.end-wr.start)<Math.PI?0:1}})(H,Qe,Qe>1?je:Pe);return H}function gv(){var ve,v;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:k,yAxis:D}=this,V=k.stacking==="percent",H=(v=(ve=gy.plotOptions)==null?void 0:ve[this.type])==null?void 0:v.borderRadius,Y=$0(k.borderRadius,Ky(H)?H:{}),J=D.options.reversed;for(let ae of this.points){let{shapeArgs:_e}=ae;if(ae.shapeType==="roundedRect"&&_e){let{width:Me=0,height:xe=0,y:Pe=0}=_e,je=Pe,Qe=xe;if(Y.scope==="stack"&&ae.stackTotal){let wt=D.translate(V?100:ae.stackTotal,!1,!0,!1,!0),kt=D.translate(k.threshold||0,!1,!0,!1,!0),Ai=this.crispCol(0,Math.min(wt,kt),0,Math.abs(wt-kt));je=Ai.y,Qe=Ai.height}let at=(ae.negative?-1:1)*(J?-1:1)==-1,nt=Y.where;!nt&&this.is("waterfall")&&Math.abs((ae.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(nt="all"),nt||(nt="end");let it=Math.min(Fg(Y.radius,Me),Me/2,nt==="all"?xe/2:1/0)||0;nt==="end"&&(at&&(je-=it),Qe+=it),U0(_e,{brBoxHeight:Qe,brBoxY:je,r:it})}}}}function $0(ve,v){return Ky(ve)||(ve={radius:ve||0}),Bg(mv,v,ve)}function yv(){let ve=$0(this.options.borderRadius);for(let v of this.points){let k=v.shapeArgs;k&&(k.borderRadius=Fg(ve.radius,(k.r||0)-(k.innerR||0)))}}function mx(ve,v,k,D,V={}){let H=Qy(ve,v,k,D,V),{r:Y=0,brBoxHeight:J=D,brBoxY:ae=v}=V,_e=v-ae,Me=ae+J-(v+D),xe=_e-Y>-.1?0:Y,Pe=Me-Y>-.1?0:Y,je=Math.max(xe&&_e,0),Qe=Math.max(Pe&&Me,0),at=[ve+xe,v],nt=[ve+k-xe,v],it=[ve+k,v+xe],wt=[ve+k,v+D-Pe],kt=[ve+k-Pe,v+D],Ai=[ve+Pe,v+D],ki=[ve,v+D-Pe],Ri=[ve,v+xe],Sr=(hr,wr)=>Math.sqrt(Math.pow(hr,2)-Math.pow(wr,2));if(je){let hr=Sr(xe,xe-je);at[0]-=hr,nt[0]+=hr,it[1]=Ri[1]=v+xe-je}if(D<xe-je){let hr=Sr(xe,xe-je-D);it[0]=wt[0]=ve+k-xe+hr,kt[0]=Math.min(it[0],kt[0]),Ai[0]=Math.max(wt[0],Ai[0]),ki[0]=Ri[0]=ve+xe-hr,it[1]=Ri[1]=v+D}if(Qe){let hr=Sr(Pe,Pe-Qe);kt[0]+=hr,Ai[0]-=hr,wt[1]=ki[1]=v+D-Pe+Qe}if(D<Pe-Qe){let hr=Sr(Pe,Pe-Qe-D);it[0]=wt[0]=ve+k-Pe+hr,nt[0]=Math.min(it[0],nt[0]),at[0]=Math.max(wt[0],at[0]),ki[0]=Ri[0]=ve+Pe-hr,wt[1]=ki[1]=v}return H.length=0,H.push(["M",...at],["L",...nt],["A",xe,xe,0,0,1,...it],["L",...wt],["A",Pe,Pe,0,0,1,...kt],["L",...Ai],["A",Pe,Pe,0,0,1,...ki],["L",...Ri],["A",xe,xe,0,0,1,...at],["Z"]),H}let{diffObjects:M_,extend:_v,find:I_,merge:vv,pick:e0,uniqueKey:xv}=pr;(function(ve){function v(D,V){let H=D.condition;(H.callback||function(){return this.chartWidth<=e0(H.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=e0(H.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=e0(H.minWidth,0)&&this.chartHeight>=e0(H.minHeight,0)}).call(this)&&V.push(D._id)}function k(D,V){let H=this.options.responsive,Y=this.currentResponsive,J=[],ae;!V&&H&&H.rules&&H.rules.forEach(xe=>{xe._id===void 0&&(xe._id=xv()),this.matchResponsiveRule(xe,J)},this);let _e=vv(...J.map(xe=>I_((H==null?void 0:H.rules)||[],Pe=>Pe._id===xe)).map(xe=>xe==null?void 0:xe.chartOptions));_e.isResponsiveOptions=!0,J=J.toString()||void 0;let Me=Y==null?void 0:Y.ruleIds;J!==Me&&(Y&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(Y.undoOptions,D,!0),this.updatingResponsive=!1),J?((ae=M_(_e,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:J,mergedOptions:_e,undoOptions:ae},this.updatingResponsive||this.update(_e,D,!0)):this.currentResponsive=void 0)}ve.compose=function(D){let V=D.prototype;return V.matchResponsiveRule||_v(V,{matchResponsiveRule:v,setResponsive:k}),D}})(Ee||(Ee={}));let bv=Ee;Ye.AST=rn,Ye.Axis=Yu,Ye.Chart=nd,Ye.Color=Un,Ye.DataLabel=Ws,Ye.DataTableCore=Mu,Ye.Fx=xt,Ye.HTMLElement=As,Ye.Legend=wf,Ye.LegendSymbol=Uh,Ye.OverlappingDataLabels=Ye.OverlappingDataLabels||my,Ye.PlotLineOrBand=dp,Ye.Point=yf,Ye.Pointer=$n,Ye.RendererRegistry=Uc,Ye.Series=yh,Ye.SeriesRegistry=Cl,Ye.StackItem=Lg,Ye.SVGElement=Cc,Ye.SVGRenderer=Ul,Ye.Templating=ul,Ye.Tick=dc,Ye.Time=Ls,Ye.Tooltip=mf,Ye.animate=Or.animate,Ye.animObject=Or.animObject,Ye.chart=nd.chart,Ye.color=Un.parse,Ye.dateFormat=ul.dateFormat,Ye.defaultOptions=$o.defaultOptions,Ye.distribute=Cs.distribute,Ye.format=ul.format,Ye.getDeferredAnimation=Or.getDeferredAnimation,Ye.getOptions=$o.getOptions,Ye.numberFormat=ul.numberFormat,Ye.seriesType=Cl.seriesType,Ye.setAnimation=Or.setAnimation,Ye.setOptions=$o.setOptions,Ye.stop=Or.stop,Ye.time=$o.defaultTime,Ye.timers=xt.timers,{compose:function(ve,v,k){let D=ve.types.pie;if(!v.symbolCustomAttribs.includes("borderRadius")){let V=k.prototype.symbols;A_(ve,"afterColumnTranslate",gv,{order:9}),A_(D,"afterTranslate",yv),v.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),Ef=V.arc,Qy=V.roundedRect,V.arc=Jy,V.roundedRect=mx}},optionsToObject:$0}.compose(Ye.Series,Ye.SVGElement,Ye.SVGRenderer),bo.compose(Ye.Series.types.column),Ws.compose(Ye.Series),Cm.compose(Ye.Axis),As.compose(Ye.SVGRenderer),wf.compose(Ye.Chart),Em.compose(Ye.Axis),my.compose(Ye.Chart),fy.compose(Ye.Series.types.pie),dp.compose(Ye.Chart,Ye.Axis),$n.compose(Ye.Chart),bv.compose(Ye.Chart),Yd.compose(Ye.Axis,Ye.Chart,Ye.Series),Ce.compose(Ye.Axis,Ye.Chart,Ye.Series),mf.compose(Ye.Pointer),pr.extend(Ye,pr);let wv=Ye;return He.default})())})(g$);var moe=g$.exports;const w1=w_(moe);var y$={exports:{}};(function(e,t){(function(n,s){e.exports=s(B)})(typeof self<"u"?self:og,function(n){return function(s){function a(f){if(d[f])return d[f].exports;var i=d[f]={i:f,l:!1,exports:{}};return s[f].call(i.exports,i,i.exports,a),i.l=!0,i.exports}var d={};return a.m=s,a.c=d,a.d=function(f,i,S){a.o(f,i)||Object.defineProperty(f,i,{configurable:!1,enumerable:!0,get:S})},a.n=function(f){var i=f&&f.__esModule?function(){return f.default}:function(){return f};return a.d(i,"a",i),i},a.o=function(f,i){return Object.prototype.hasOwnProperty.call(f,i)},a.p="",a(a.s=0)}([function(s,a,d){function f(){return f=Object.assign?Object.assign.bind():function(le){for(var Se=1;Se<arguments.length;Se++){var ke=arguments[Se];for(var Ee in ke)Object.prototype.hasOwnProperty.call(ke,Ee)&&(le[Ee]=ke[Ee])}return le},f.apply(this,arguments)}function i(le){return F(le)||L(le)||E(le)||S()}function S(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E(le,Se){if(le){if(typeof le=="string")return G(le,Se);var ke=Object.prototype.toString.call(le).slice(8,-1);return ke==="Object"&&le.constructor&&(ke=le.constructor.name),ke==="Map"||ke==="Set"?Array.from(le):ke==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ke)?G(le,Se):void 0}}function L(le){if(typeof Symbol<"u"&&le[Symbol.iterator]!=null||le["@@iterator"]!=null)return Array.from(le)}function F(le){if(Array.isArray(le))return G(le)}function G(le,Se){(Se==null||Se>le.length)&&(Se=le.length);for(var ke=0,Ee=new Array(Se);ke<Se;ke++)Ee[ke]=le[ke];return Ee}function q(le){"@babel/helpers - typeof";return(q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Se){return typeof Se}:function(Se){return Se&&typeof Symbol=="function"&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se})(le)}Object.defineProperty(a,"__esModule",{value:!0}),d.d(a,"HighchartsReact",function(){return fe});var Q=d(1),te=d.n(Q),he=typeof window<"u"?Q.useLayoutEffect:Q.useEffect,fe=Object(Q.memo)(Object(Q.forwardRef)(function(le,Se){var ke=Object(Q.useRef)(),Ee=Object(Q.useRef)(),Ie=Object(Q.useRef)(le.constructorType),He=Object(Q.useRef)(le.highcharts);return he(function(){function Ye(){var Pt=le.highcharts||(typeof window>"u"?"undefined":q(window))==="object"&&window.Highcharts,At=le.constructorType||"chart";Pt?Pt[At]?le.options?Ee.current=Pt[At](ke.current,le.options,le.callback):console.warn('The "options" property was not passed.'):console.warn('The "constructorType" property is incorrect or some required module is not imported.'):console.warn('The "highcharts" property was not passed.')}if(Ee.current){if(le.allowChartUpdate!==!1)if(le.constructorType!==Ie.current||le.highcharts!==He.current)Ie.current=le.constructorType,He.current=le.highcharts,Ye();else if(!le.immutable&&Ee.current){var lt;(lt=Ee.current).update.apply(lt,[le.options].concat(i(le.updateArgs||[!0,!0])))}else Ye()}else Ye()},[le.options,le.allowChartUpdate,le.updateArgs,le.containerProps,le.highcharts,le.constructorType]),he(function(){return function(){Ee.current&&(Ee.current.destroy(),Ee.current=null)}},[]),Object(Q.useImperativeHandle)(Se,function(){return{get chart(){return Ee.current},container:ke}},[]),te.a.createElement("div",f({},le.containerProps,{ref:ke}))}));a.default=fe},function(s,a){s.exports=n}])})})(y$);var goe=y$.exports;const _$=w_(goe);var l2={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */l2.exports;(function(e,t){(function(){var n,s="4.17.21",a=200,d="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",i="Invalid `variable` option passed into `_.template`",S="__lodash_hash_undefined__",E=500,L="__lodash_placeholder__",F=1,G=2,q=4,Q=1,te=2,he=1,fe=2,le=4,Se=8,ke=16,Ee=32,Ie=64,He=128,Ye=256,lt=512,Pt=30,At="...",ht=800,Ot=16,Ae=1,mt=2,bt=3,Dt=1/0,Je=9007199254740991,dt=17976931348623157e292,ui=0/0,Vt=4294967295,ei=Vt-1,ur=Vt>>>1,Zt=[["ary",He],["bind",he],["bindKey",fe],["curry",Se],["curryRight",ke],["flip",lt],["partial",Ee],["partialRight",Ie],["rearg",Ye]],Kt="[object Arguments]",Ui="[object Array]",rr="[object AsyncFunction]",gi="[object Boolean]",Oi="[object Date]",cr="[object DOMException]",ji="[object Error]",nn="[object Function]",pr="[object GeneratorFunction]",Ue="[object Map]",ni="[object Number]",fi="[object Null]",Lt="[object Object]",pt="[object Promise]",Nt="[object Proxy]",Si="[object RegExp]",pi="[object Set]",St="[object String]",Ht="[object Symbol]",nr="[object Undefined]",tr="[object WeakMap]",kr="[object WeakSet]",Mr="[object ArrayBuffer]",Cr="[object DataView]",Tn="[object Float32Array]",gs="[object Float64Array]",wn="[object Int8Array]",bs="[object Int16Array]",qn="[object Int32Array]",Ls="[object Uint8Array]",ma="[object Uint8ClampedArray]",Ln="[object Uint16Array]",qo="[object Uint32Array]",zn=/\b__p \+= '';/g,za=/\b(__p \+=) '' \+/g,$o=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Aa=/&(?:amp|lt|gt|quot|#39);/g,ja=/[&<>"']/g,Yn=RegExp(Aa.source),hl=RegExp(ja.source),fr=/<%-([\s\S]+?)%>/g,tc=/<%([\s\S]+?)%>/g,Sh=/<%=([\s\S]+?)%>/g,bl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Un=/^\w*$/,vi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ge=/[\\^$.*+?()[\]{}|]/g,Fe=RegExp(Ge.source),rt=/^\s+/,xt=/\s/,ft=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Jt=/\{\n\/\* \[wrapped with (.+)\] \*/,xi=/,? & /,ti=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ai=/[()=,{}\[\]\/\s]/,Yi=/\\(\\)?/g,Fi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pr=/\w*$/,ln=/^[-+]0x[0-9a-f]+$/i,Qr=/^0b[01]+$/i,Or=/^\[object .+?Constructor\]$/,ii=/^0o[0-7]+$/i,xr=/^(?:0|[1-9]\d*)$/,Xr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tn=/($^)/,Jn=/['\n\r\u2028\u2029\\]/g,ds="\\ud800-\\udfff",mi="\\u0300-\\u036f",_r="\\ufe20-\\ufe2f",zi="\\u20d0-\\u20ff",zr=mi+_r+zi,Yr="\\u2700-\\u27bf",yr="a-z\\xdf-\\xf6\\xf8-\\xff",Hr="\\xac\\xb1\\xd7\\xf7",rn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",is="\\u2000-\\u206f",Ps=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",vs="A-Z\\xc0-\\xd6\\xd8-\\xde",ra="\\ufe0e\\ufe0f",Po=Hr+rn+is+Ps,Sc="[']",Xl="["+ds+"]",lh="["+Po+"]",ps="["+zr+"]",la="\\d+",$u="["+Yr+"]",_u="["+yr+"]",ch="[^"+ds+Po+la+Yr+yr+vs+"]",Lc="\\ud83c[\\udffb-\\udfff]",zc="(?:"+ps+"|"+Lc+")",Kh="[^"+ds+"]",ul="(?:\\ud83c[\\udde6-\\uddff]){2}",Uc="[\\ud800-\\udbff][\\udc00-\\udfff]",du="["+vs+"]",Yc="\\u200d",Ds="(?:"+_u+"|"+ch+")",Ys="(?:"+du+"|"+ch+")",Cs="(?:"+Sc+"(?:d|ll|m|re|s|t|ve))?",to="(?:"+Sc+"(?:D|LL|M|RE|S|T|VE))?",Xs=zc+"?",Bs="["+ra+"]?",ba="(?:"+Yc+"(?:"+[Kh,ul,Uc].join("|")+")"+Bs+Xs+")*",ca="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fh="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Il=Bs+Xs+ba,Dp="(?:"+[$u,ul,Uc].join("|")+")"+Il,Th="(?:"+[Kh+ps+"?",ps,ul,Uc,Xl].join("|")+")",Vs=RegExp(Sc,"g"),pu=RegExp(ps,"g"),vu=RegExp(Lc+"(?="+Lc+")|"+Th+Il,"g"),Qh=RegExp([du+"?"+_u+"+"+Cs+"(?="+[lh,du,"$"].join("|")+")",Ys+"+"+to+"(?="+[lh,du+Ds,"$"].join("|")+")",du+"?"+Ds+"+"+Cs,du+"+"+to,fh,ca,la,Dp].join("|"),"g"),Vf=RegExp("["+Yc+ds+zr+ra+"]"),Tc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],mh=-1,qa={};qa[Tn]=qa[gs]=qa[wn]=qa[bs]=qa[qn]=qa[Ls]=qa[ma]=qa[Ln]=qa[qo]=!0,qa[Kt]=qa[Ui]=qa[Mr]=qa[gi]=qa[Cr]=qa[Oi]=qa[ji]=qa[nn]=qa[Ue]=qa[ni]=qa[Lt]=qa[Si]=qa[pi]=qa[St]=qa[tr]=!1;var Ka={};Ka[Kt]=Ka[Ui]=Ka[Mr]=Ka[Cr]=Ka[gi]=Ka[Oi]=Ka[Tn]=Ka[gs]=Ka[wn]=Ka[bs]=Ka[qn]=Ka[Ue]=Ka[ni]=Ka[Lt]=Ka[Si]=Ka[pi]=Ka[St]=Ka[Ht]=Ka[Ls]=Ka[ma]=Ka[Ln]=Ka[qo]=!0,Ka[ji]=Ka[nn]=Ka[tr]=!1;var zd={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Vu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Nh={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ud={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},up=parseFloat,hc=parseInt,fu=typeof og=="object"&&og&&og.Object===Object&&og,Ha=typeof self=="object"&&self&&self.Object===Object&&self,Ll=fu||Ha||Function("return this")(),vd=t&&!t.nodeType&&t,Bh=vd&&!0&&e&&!e.nodeType&&e,Wu=Bh&&Bh.exports===vd,Xc=Wu&&fu.process,Ma=function(){try{var or=Bh&&Bh.require&&Bh.require("util").types;return or||Xc&&Xc.binding&&Xc.binding("util")}catch{}}(),Cc=Ma&&Ma.isArrayBuffer,Fh=Ma&&Ma.isDate,ao=Ma&&Ma.isMap,Dl=Ma&&Ma.isRegExp,xu=Ma&&Ma.isSet,af=Ma&&Ma.isTypedArray;function kn(or,Kr,Ur){switch(Ur.length){case 0:return or.call(Kr);case 1:return or.call(Kr,Ur[0]);case 2:return or.call(Kr,Ur[0],Ur[1]);case 3:return or.call(Kr,Ur[0],Ur[1],Ur[2])}return or.apply(Kr,Ur)}function lf(or,Kr,Ur,Kn){for(var As=-1,Xo=or==null?0:or.length;++As<Xo;){var pl=or[As];Kr(Kn,pl,Ur(pl),or)}return Kn}function ic(or,Kr){for(var Ur=-1,Kn=or==null?0:or.length;++Ur<Kn&&Kr(or[Ur],Ur,or)!==!1;);return or}function wl(or,Kr){for(var Ur=or==null?0:or.length;Ur--&&Kr(or[Ur],Ur,or)!==!1;);return or}function Qa(or,Kr){for(var Ur=-1,Kn=or==null?0:or.length;++Ur<Kn;)if(!Kr(or[Ur],Ur,or))return!1;return!0}function Zl(or,Kr){for(var Ur=-1,Kn=or==null?0:or.length,As=0,Xo=[];++Ur<Kn;){var pl=or[Ur];Kr(pl,Ur,or)&&(Xo[As++]=pl)}return Xo}function $c(or,Kr){var Ur=or==null?0:or.length;return!!Ur&&Gu(or,Kr,0)>-1}function vn(or,Kr,Ur){for(var Kn=-1,As=or==null?0:or.length;++Kn<As;)if(Ur(Kr,or[Kn]))return!0;return!1}function os(or,Kr){for(var Ur=-1,Kn=or==null?0:or.length,As=Array(Kn);++Ur<Kn;)As[Ur]=Kr(or[Ur],Ur,or);return As}function Zs(or,Kr){for(var Ur=-1,Kn=Kr.length,As=or.length;++Ur<Kn;)or[As+Ur]=Kr[Ur];return or}function zl(or,Kr,Ur,Kn){var As=-1,Xo=or==null?0:or.length;for(Kn&&Xo&&(Ur=or[++As]);++As<Xo;)Ur=Kr(Ur,or[As],As,or);return Ur}function bu(or,Kr,Ur,Kn){var As=or==null?0:or.length;for(Kn&&As&&(Ur=or[--As]);As--;)Ur=Kr(Ur,or[As],As,or);return Ur}function Ks(or,Kr){for(var Ur=-1,Kn=or==null?0:or.length;++Ur<Kn;)if(Kr(or[Ur],Ur,or))return!0;return!1}var xd=vt("length");function ju(or){return or.split("")}function Hu(or){return or.match(ti)||[]}function Sl(or,Kr,Ur){var Kn;return Ur(or,function(As,Xo,pl){if(Kr(As,Xo,pl))return Kn=Xo,!1}),Kn}function Ja(or,Kr,Ur,Kn){for(var As=or.length,Xo=Ur+(Kn?1:-1);Kn?Xo--:++Xo<As;)if(Kr(or[Xo],Xo,or))return Xo;return-1}function Gu(or,Kr,Ur){return Kr===Kr?Ua(or,Kr,Ur):Ja(or,Ch,Ur)}function zh(or,Kr,Ur,Kn){for(var As=Ur-1,Xo=or.length;++As<Xo;)if(Kn(or[As],Kr))return As;return-1}function Ch(or){return or!==or}function hh(or,Kr){var Ur=or==null?0:or.length;return Ur?bi(or,Kr)/Ur:ui}function vt(or){return function(Kr){return Kr==null?n:Kr[or]}}function Yt(or){return function(Kr){return or==null?n:or[Kr]}}function Di(or,Kr,Ur,Kn,As){return As(or,function(Xo,pl,Fn){Ur=Kn?(Kn=!1,Xo):Kr(Ur,Xo,pl,Fn)}),Ur}function yi(or,Kr){var Ur=or.length;for(or.sort(Kr);Ur--;)or[Ur]=or[Ur].value;return or}function bi(or,Kr){for(var Ur,Kn=-1,As=or.length;++Kn<As;){var Xo=Kr(or[Kn]);Xo!==n&&(Ur=Ur===n?Xo:Ur+Xo)}return Ur}function Li(or,Kr){for(var Ur=-1,Kn=Array(or);++Ur<or;)Kn[Ur]=Kr(Ur);return Kn}function Tr(or,Kr){return os(Kr,function(Ur){return[Ur,or[Ur]]})}function Bi(or){return or&&or.slice(0,Vl(or)+1).replace(rt,"")}function Gt(or){return function(Kr){return or(Kr)}}function qr(or,Kr){return os(Kr,function(Ur){return or[Ur]})}function sr(or,Kr){return or.has(Kr)}function Qi(or,Kr){for(var Ur=-1,Kn=or.length;++Ur<Kn&&Gu(Kr,or[Ur],0)>-1;);return Ur}function sn(or,Kr){for(var Ur=or.length;Ur--&&Gu(Kr,or[Ur],0)>-1;);return Ur}function hi(or,Kr){for(var Ur=or.length,Kn=0;Ur--;)or[Ur]===Kr&&++Kn;return Kn}var Pn=Yt(zd),as=Yt(Vu);function Yo(or){return"\\"+Ud[or]}function Qn(or,Kr){return or==null?n:or[Kr]}function ro(or){return Vf.test(or)}function Ao(or){return Tc.test(or)}function el(or){for(var Kr,Ur=[];!(Kr=or.next()).done;)Ur.push(Kr.value);return Ur}function Mo(or){var Kr=-1,Ur=Array(or.size);return or.forEach(function(Kn,As){Ur[++Kr]=[As,Kn]}),Ur}function Fs(or,Kr){return function(Ur){return or(Kr(Ur))}}function Jo(or,Kr){for(var Ur=-1,Kn=or.length,As=0,Xo=[];++Ur<Kn;){var pl=or[Ur];(pl===Kr||pl===L)&&(or[Ur]=L,Xo[As++]=Ur)}return Xo}function ea(or){var Kr=-1,Ur=Array(or.size);return or.forEach(function(Kn){Ur[++Kr]=Kn}),Ur}function So(or){var Kr=-1,Ur=Array(or.size);return or.forEach(function(Kn){Ur[++Kr]=[Kn,Kn]}),Ur}function Ua(or,Kr,Ur){for(var Kn=Ur-1,As=or.length;++Kn<As;)if(or[Kn]===Kr)return Kn;return-1}function Ul(or,Kr,Ur){for(var Kn=Ur+1;Kn--;)if(or[Kn]===Kr)return Kn;return Kn}function $l(or){return ro(or)?uh(or):xd(or)}function $a(or){return ro(or)?rc(or):ju(or)}function Vl(or){for(var Kr=or.length;Kr--&&xt.test(or.charAt(Kr)););return Kr}var dl=Yt(Nh);function uh(or){for(var Kr=vu.lastIndex=0;vu.test(or);)++Kr;return Kr}function rc(or){return or.match(vu)||[]}function Dc(or){return or.match(Qh)||[]}var Pc=function or(Kr){Kr=Kr==null?Ll:Zc.defaults(Ll.Object(),Kr,Zc.pick(Ll,hp));var Ur=Kr.Array,Kn=Kr.Date,As=Kr.Error,Xo=Kr.Function,pl=Kr.Math,Fn=Kr.Object,fs=Kr.RegExp,In=Kr.String,Ms=Kr.TypeError,ho=Ur.prototype,na=Xo.prototype,ta=Fn.prototype,Oo=Kr["__core-js_shared__"],Io=na.toString,To=ta.hasOwnProperty,fl=0,rl=function(){var I=/[^.]+$/.exec(Oo&&Oo.keys&&Oo.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),mr=ta.toString,Tl=Io.call(Fn),Vo=Ll._,Kc=fs("^"+Io.call(To).replace(Ge,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uc=Wu?Kr.Buffer:n,dc=Kr.Symbol,Qc=Kr.Uint8Array,bd=uc?uc.allocUnsafe:n,Jc=Fs(Fn.getPrototypeOf,Fn),ws=Fn.create,qu=ta.propertyIsEnumerable,Pp=ho.splice,ga=dc?dc.isConcatSpreadable:n,cf=dc?dc.iterator:n,Eh=dc?dc.toStringTag:n,uo=function(){try{var I=bp(Fn,"defineProperty");return I({},"",{}),I}catch{}}(),Wl=Kr.clearTimeout!==Ll.clearTimeout&&Kr.clearTimeout,Kg=Kn&&Kn.now!==Ll.Date.now&&Kn.now,k0=Kr.setTimeout!==Ll.setTimeout&&Kr.setTimeout,hf=pl.ceil,Wf=pl.floor,pc=Fn.getOwnPropertySymbols,Qg=uc?uc.isBuffer:n,A0=Kr.isFinite,jf=ho.join,Es=Fs(Fn.keys,Fn),Ro=pl.max,eh=pl.min,gg=Kn.now,uf=Kr.parseInt,fo=pl.random,ml=ho.reverse,Hf=bp(Kr,"DataView"),df=bp(Kr,"Map"),Op=bp(Kr,"Promise"),zs=bp(Kr,"Set"),Yu=bp(Kr,"WeakMap"),Rp=bp(Fn,"create"),Np=Yu&&new Yu,wd={},No=se(Hf),Cm=se(df),yg=se(Op),_g=se(zs),M0=se(Yu),Em=dc?dc.prototype:n,wu=Em?Em.valueOf:n,Bp=Em?Em.toString:n;function zt(I){if(Ai(I)&&!D(I)&&!(I instanceof wa)){if(I instanceof Su)return I;if(To.call(I,"__wrapped__"))return be(I)}return new Su(I)}var Gf=function(){function I(){}return function(W){if(!kt(W))return{};if(ws)return ws(W);I.prototype=W;var pe=new I;return I.prototype=n,pe}}();function qf(){}function Su(I,W){this.__wrapped__=I,this.__actions__=[],this.__chain__=!!W,this.__index__=0,this.__values__=n}zt.templateSettings={escape:fr,evaluate:tc,interpolate:Sh,variable:"",imports:{_:zt}},zt.prototype=qf.prototype,zt.prototype.constructor=zt,Su.prototype=Gf(qf.prototype),Su.prototype.constructor=Su;function wa(I){this.__wrapped__=I,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Vt,this.__views__=[]}function Xu(){var I=new wa(this.__wrapped__);return I.__actions__=sc(this.__actions__),I.__dir__=this.__dir__,I.__filtered__=this.__filtered__,I.__iteratees__=sc(this.__iteratees__),I.__takeCount__=this.__takeCount__,I.__views__=sc(this.__views__),I}function Jg(){if(this.__filtered__){var I=new wa(this);I.__dir__=-1,I.__filtered__=!0}else I=this.clone(),I.__dir__*=-1;return I}function pf(){var I=this.__wrapped__.value(),W=this.__dir__,pe=D(I),Ve=W<0,gt=pe?I.length:0,Qt=Mg(0,gt,this.__views__),Ii=Qt.start,Gi=Qt.end,br=Gi-Ii,gn=Ve?Gi:Ii-1,_n=this.__iteratees__,Cn=_n.length,_s=0,Gs=eh(br,this.__takeCount__);if(!pe||!Ve&&gt==br&&Gs==br)return oy(I,this.__actions__);var Lo=[];e:for(;br--&&_s<Gs;){gn+=W;for(var Ba=-1,zo=I[gn];++Ba<Cn;){var al=_n[Ba],Xa=al.iteratee,Tp=al.type,sp=Xa(zo);if(Tp==mt)zo=sp;else if(!sp){if(Tp==Ae)continue e;break e}}Lo[_s++]=zo}return Lo}wa.prototype=Gf(qf.prototype),wa.prototype.constructor=wa;function Fp(I){var W=-1,pe=I==null?0:I.length;for(this.clear();++W<pe;){var Ve=I[W];this.set(Ve[0],Ve[1])}}function ey(){this.__data__=Rp?Rp(null):{},this.size=0}function I0(I){var W=this.has(I)&&delete this.__data__[I];return this.size-=W?1:0,W}function Yf(I){var W=this.__data__;if(Rp){var pe=W[I];return pe===S?n:pe}return To.call(W,I)?W[I]:n}function dp(I){var W=this.__data__;return Rp?W[I]!==n:To.call(W,I)}function zy(I,W){var pe=this.__data__;return this.size+=this.has(I)?0:1,pe[I]=Rp&&W===n?S:W,this}Fp.prototype.clear=ey,Fp.prototype.delete=I0,Fp.prototype.get=Yf,Fp.prototype.has=dp,Fp.prototype.set=zy;function Oc(I){var W=-1,pe=I==null?0:I.length;for(this.clear();++W<pe;){var Ve=I[W];this.set(Ve[0],Ve[1])}}function Zu(){this.__data__=[],this.size=0}function vg(I){var W=this.__data__,pe=Vd(W,I);if(pe<0)return!1;var Ve=W.length-1;return pe==Ve?W.pop():Pp.call(W,pe,1),--this.size,!0}function xg(I){var W=this.__data__,pe=Vd(W,I);return pe<0?n:W[pe][1]}function Uy(I){return Vd(this.__data__,I)>-1}function ty(I,W){var pe=this.__data__,Ve=Vd(pe,I);return Ve<0?(++this.size,pe.push([I,W])):pe[Ve][1]=W,this}Oc.prototype.clear=Zu,Oc.prototype.delete=vg,Oc.prototype.get=xg,Oc.prototype.has=Uy,Oc.prototype.set=ty;function Sd(I){var W=-1,pe=I==null?0:I.length;for(this.clear();++W<pe;){var Ve=I[W];this.set(Ve[0],Ve[1])}}function pp(){this.size=0,this.__data__={hash:new Fp,map:new(df||Oc),string:new Fp}}function fp(I){var W=Um(this,I).delete(I);return this.size-=W?1:0,W}function $y(I){return Um(this,I).get(I)}function km(I){return Um(this,I).has(I)}function iy(I,W){var pe=Um(this,I),Ve=pe.size;return pe.set(I,W),this.size+=pe.size==Ve?0:1,this}Sd.prototype.clear=pp,Sd.prototype.delete=fp,Sd.prototype.get=$y,Sd.prototype.has=km,Sd.prototype.set=iy;function zp(I){var W=-1,pe=I==null?0:I.length;for(this.__data__=new Sd;++W<pe;)this.add(I[W])}function ff(I){return this.__data__.set(I,S),this}function L0(I){return this.__data__.has(I)}zp.prototype.add=zp.prototype.push=ff,zp.prototype.has=L0;function $d(I){var W=this.__data__=new Oc(I);this.size=W.size}function Vy(){this.__data__=new Oc,this.size=0}function Am(I){var W=this.__data__,pe=W.delete(I);return this.size=W.size,pe}function mp(I){return this.__data__.get(I)}function C_(I){return this.__data__.has(I)}function Mm(I,W){var pe=this.__data__;if(pe instanceof Oc){var Ve=pe.__data__;if(!df||Ve.length<a-1)return Ve.push([I,W]),this.size=++pe.size,this;pe=this.__data__=new Sd(Ve)}return pe.set(I,W),this.size=pe.size,this}$d.prototype.clear=Vy,$d.prototype.delete=Am,$d.prototype.get=mp,$d.prototype.has=C_,$d.prototype.set=Mm;function Im(I,W){var pe=D(I),Ve=!pe&&k(I),gt=!pe&&!Ve&&ae(I),Qt=!pe&&!Ve&&!gt&&oa(I),Ii=pe||Ve||gt||Qt,Gi=Ii?Li(I.length,In):[],br=Gi.length;for(var gn in I)(W||To.call(I,gn))&&!(Ii&&(gn=="length"||gt&&(gn=="offset"||gn=="parent")||Qt&&(gn=="buffer"||gn=="byteLength"||gn=="byteOffset")||ya(gn,br)))&&Gi.push(gn);return Gi}function Lm(I){var W=I.length;return W?I[Sg(0,W-1)]:n}function mf(I,W){return R(sc(I),gp(W,0,I.length))}function Wy(I){return R(sc(I))}function bg(I,W,pe){(pe!==n&&!ld(I[W],pe)||pe===n&&!(W in I))&&Tu(I,W,pe)}function gf(I,W,pe){var Ve=I[W];(!(To.call(I,W)&&ld(Ve,pe))||pe===n&&!(W in I))&&Tu(I,W,pe)}function Vd(I,W){for(var pe=I.length;pe--;)if(ld(I[pe][0],W))return pe;return-1}function Td(I,W,pe,Ve){return gh(I,function(gt,Qt,Ii){W(Ve,gt,pe(gt),Ii)}),Ve}function jy(I,W){return I&&Wc(W,Fu(W),I)}function Ku(I,W){return I&&Wc(W,cd(W),I)}function Tu(I,W,pe){W=="__proto__"&&uo?uo(I,W,{configurable:!0,enumerable:!0,value:pe,writable:!0}):I[W]=pe}function Up(I,W){for(var pe=-1,Ve=W.length,gt=Ur(Ve),Qt=I==null;++pe<Ve;)gt[pe]=Qt?n:Sv(I,W[pe]);return gt}function gp(I,W,pe){return I===I&&(pe!==n&&(I=I<=pe?I:pe),W!==n&&(I=I>=W?I:W)),I}function Cu(I,W,pe,Ve,gt,Qt){var Ii,Gi=W&F,br=W&G,gn=W&q;if(pe&&(Ii=gt?pe(I,Ve,gt,Qt):pe(I)),Ii!==n)return Ii;if(!kt(I))return I;var _n=D(I);if(_n){if(Ii=Vm(I),!Gi)return sc(I,Ii)}else{var Cn=Kl(I),_s=Cn==nn||Cn==pr;if(ae(I))return Va(I,Gi);if(Cn==Lt||Cn==Kt||_s&&!gt){if(Ii=br||_s?{}:Tf(I),!Gi)return br?Cg(I,Ku(Ii,I)):bf(I,jy(Ii,I))}else{if(!Ka[Cn])return gt?I:{};Ii=Cf(I,Cn,Gi)}}Qt||(Qt=new $d);var Gs=Qt.get(I);if(Gs)return Gs;Qt.set(I,Ii),Is(I)?I.forEach(function(zo){Ii.add(Cu(zo,W,pe,zo,I,Qt))}):ki(I)&&I.forEach(function(zo,al){Ii.set(al,Cu(zo,W,pe,al,I,Qt))});var Lo=gn?br?am:Ag:br?cd:Fu,Ba=_n?n:Lo(I);return ic(Ba||I,function(zo,al){Ba&&(al=zo,zo=I[al]),gf(Ii,al,Cu(zo,W,pe,al,I,Qt))}),Ii}function Cd(I){var W=Fu(I);return function(pe){return $p(pe,I,W)}}function $p(I,W,pe){var Ve=pe.length;if(I==null)return!Ve;for(I=Fn(I);Ve--;){var gt=pe[Ve],Qt=W[gt],Ii=I[gt];if(Ii===n&&!(gt in I)||!Qt(Ii))return!1}return!0}function ry(I,W,pe){if(typeof I!="function")throw new Ms(f);return h(function(){I.apply(n,pe)},W)}function Qu(I,W,pe,Ve){var gt=-1,Qt=$c,Ii=!0,Gi=I.length,br=[],gn=W.length;if(!Gi)return br;pe&&(W=os(W,Gt(pe))),Ve?(Qt=vn,Ii=!1):W.length>=a&&(Qt=sr,Ii=!1,W=new zp(W));e:for(;++gt<Gi;){var _n=I[gt],Cn=pe==null?_n:pe(_n);if(_n=Ve||_n!==0?_n:0,Ii&&Cn===Cn){for(var _s=gn;_s--;)if(W[_s]===Cn)continue e;br.push(_n)}else Qt(W,Cn,Ve)||br.push(_n)}return br}var gh=wf(gl),Dm=wf(ny,!0);function Hy(I,W){var pe=!0;return gh(I,function(Ve,gt,Qt){return pe=!!W(Ve,gt,Qt),pe}),pe}function yp(I,W,pe){for(var Ve=-1,gt=I.length;++Ve<gt;){var Qt=I[Ve],Ii=W(Qt);if(Ii!=null&&(Gi===n?Ii===Ii&&!us(Ii):pe(Ii,Gi)))var Gi=Ii,br=Qt}return br}function yf(I,W,pe,Ve){var gt=I.length;for(pe=Us(pe),pe<0&&(pe=-pe>gt?0:gt+pe),Ve=Ve===n||Ve>gt?gt:Us(Ve),Ve<0&&(Ve+=gt),Ve=pe>Ve?0:tl(Ve);pe<Ve;)I[pe++]=W;return I}function Xf(I,W){var pe=[];return gh(I,function(Ve,gt,Qt){W(Ve,gt,Qt)&&pe.push(Ve)}),pe}function jl(I,W,pe,Ve,gt){var Qt=-1,Ii=I.length;for(pe||(pe=Ig),gt||(gt=[]);++Qt<Ii;){var Gi=I[Qt];W>0&&pe(Gi)?W>1?jl(Gi,W-1,pe,Ve,gt):Zs(gt,Gi):Ve||(gt[gt.length]=Gi)}return gt}var Eu=Pl(),Zf=Pl(!0);function gl(I,W){return I&&Eu(I,W,Fu)}function ny(I,W){return I&&Zf(I,W,Fu)}function Ed(I,W){return Zl(W,function(pe){return nt(I[pe])})}function ku(I,W){W=eu(W,I);for(var pe=0,Ve=W.length;I!=null&&pe<Ve;)I=I[Z(W[pe++])];return pe&&pe==Ve?I:n}function _p(I,W,pe){var Ve=W(I);return D(I)?Ve:Zs(Ve,pe(I))}function yl(I){return I==null?I===n?nr:fi:Eh&&Eh in Fn(I)?Yp(I):Nu(I)}function _f(I,W){return I>W}function Au(I,W){return I!=null&&To.call(I,W)}function Vp(I,W){return I!=null&&W in Fn(I)}function mn(I,W,pe){return I>=eh(W,pe)&&I<Ro(W,pe)}function Ec(I,W,pe){for(var Ve=pe?vn:$c,gt=I[0].length,Qt=I.length,Ii=Qt,Gi=Ur(Qt),br=1/0,gn=[];Ii--;){var _n=I[Ii];Ii&&W&&(_n=os(_n,Gt(W))),br=eh(_n.length,br),Gi[Ii]=!pe&&(W||gt>=120&&_n.length>=120)?new zp(Ii&&_n):n}_n=I[0];var Cn=-1,_s=Gi[0];e:for(;++Cn<gt&&gn.length<br;){var Gs=_n[Cn],Lo=W?W(Gs):Gs;if(Gs=pe||Gs!==0?Gs:0,!(_s?sr(_s,Lo):Ve(gn,Lo,pe))){for(Ii=Qt;--Ii;){var Ba=Gi[Ii];if(!(Ba?sr(Ba,Lo):Ve(I[Ii],Lo,pe)))continue e}_s&&_s.push(Lo),gn.push(Gs)}}return gn}function D0(I,W,pe,Ve){return gl(I,function(gt,Qt,Ii){W(Ve,pe(gt),Qt,Ii)}),Ve}function mu(I,W,pe){W=eu(W,I),I=Bu(I,W);var Ve=I==null?I:I[Z(Ni(W))];return Ve==null?n:kn(Ve,I,pe)}function Hl(I){return Ai(I)&&yl(I)==Kt}function $n(I){return Ai(I)&&yl(I)==Mr}function kd(I){return Ai(I)&&yl(I)==Oi}function Wp(I,W,pe,Ve,gt){return I===W?!0:I==null||W==null||!Ai(I)&&!Ai(W)?I!==I&&W!==W:Pm(I,W,pe,Ve,Wp,gt)}function Pm(I,W,pe,Ve,gt,Qt){var Ii=D(I),Gi=D(W),br=Ii?Ui:Kl(I),gn=Gi?Ui:Kl(W);br=br==Kt?Lt:br,gn=gn==Kt?Lt:gn;var _n=br==Lt,Cn=gn==Lt,_s=br==gn;if(_s&&ae(I)){if(!ae(W))return!1;Ii=!0,_n=!1}if(_s&&!_n)return Qt||(Qt=new $d),Ii||oa(I)?kg(I,W,pe,Ve,gt,Qt):Ou(I,W,br,pe,Ve,gt,Qt);if(!(pe&Q)){var Gs=_n&&To.call(I,"__wrapped__"),Lo=Cn&&To.call(W,"__wrapped__");if(Gs||Lo){var Ba=Gs?I.value():I,zo=Lo?W.value():W;return Qt||(Qt=new $d),gt(Ba,zo,pe,Ve,Qt)}}return _s?(Qt||(Qt=new $d),qp(I,W,pe,Ve,gt,Qt)):!1}function Kf(I){return Ai(I)&&Kl(I)==Ue}function vf(I,W,pe,Ve){var gt=pe.length,Qt=gt,Ii=!Ve;if(I==null)return!Qt;for(I=Fn(I);gt--;){var Gi=pe[gt];if(Ii&&Gi[2]?Gi[1]!==I[Gi[0]]:!(Gi[0]in I))return!1}for(;++gt<Qt;){Gi=pe[gt];var br=Gi[0],gn=I[br],_n=Gi[1];if(Ii&&Gi[2]){if(gn===n&&!(br in I))return!1}else{var Cn=new $d;if(Ve)var _s=Ve(gn,_n,br,I,W,Cn);if(!(_s===n?Wp(_n,gn,Q|te,Ve,Cn):_s))return!1}}return!0}function Mu(I){if(!kt(I)||cy(I))return!1;var W=nt(I)?Kc:Or;return W.test(se(I))}function P0(I){return Ai(I)&&yl(I)==Si}function O0(I){return Ai(I)&&Kl(I)==pi}function dh(I){return Ai(I)&&wt(I.length)&&!!qa[yl(I)]}function Uh(I){return typeof I=="function"?I:I==null?Nc:typeof I=="object"?D(I)?Wd(I[0],I[1]):Cl(I):z_(I)}function Om(I){if(!Zd(I))return Es(I);var W=[];for(var pe in Fn(I))To.call(I,pe)&&pe!="constructor"&&W.push(pe);return W}function $h(I){if(!kt(I))return lm(I);var W=Zd(I),pe=[];for(var Ve in I)Ve=="constructor"&&(W||!To.call(I,Ve))||pe.push(Ve);return pe}function Ju(I,W){return I<W}function Ad(I,W){var pe=-1,Ve=H(I)?Ur(I.length):[];return gh(I,function(gt,Qt,Ii){Ve[++pe]=W(gt,Qt,Ii)}),Ve}function Cl(I){var W=$m(I);return W.length==1&&W[0][2]?Kd(W[0][0],W[0][1]):function(pe){return pe===I||vf(pe,I,W)}}function Wd(I,W){return Yd(I)&&sd(W)?Kd(Z(I),W):function(pe){var Ve=Sv(pe,I);return Ve===n&&Ve===W?yx(pe,I):Wp(W,Ve,Q|te)}}function jp(I,W,pe,Ve,gt){I!==W&&Eu(W,function(Qt,Ii){if(gt||(gt=new $d),kt(Qt))wg(I,W,Ii,pe,jp,Ve,gt);else{var Gi=Ve?Ve(g(I,Ii),Qt,Ii+"",I,W,gt):n;Gi===n&&(Gi=Qt),bg(I,Ii,Gi)}},cd)}function wg(I,W,pe,Ve,gt,Qt,Ii){var Gi=g(I,pe),br=g(W,pe),gn=Ii.get(br);if(gn){bg(I,pe,gn);return}var _n=Qt?Qt(Gi,br,pe+"",I,W,Ii):n,Cn=_n===n;if(Cn){var _s=D(br),Gs=!_s&&ae(br),Lo=!_s&&!Gs&&oa(br);_n=br,_s||Gs||Lo?D(Gi)?_n=Gi:Y(Gi)?_n=sc(Gi):Gs?(Cn=!1,_n=Va(br,!0)):Lo?(Cn=!1,_n=tm(br,!0)):_n=[]:fn(br)||k(br)?(_n=Gi,k(Gi)?_n=Ih(Gi):(!kt(Gi)||nt(Gi))&&(_n=Tf(br))):Cn=!1}Cn&&(Ii.set(br,_n),gt(_n,br,Ve,Qt,Ii),Ii.delete(br)),bg(I,pe,_n)}function jd(I,W){var pe=I.length;if(pe)return W+=W<0?pe:0,ya(W,pe)?I[W]:n}function sa(I,W,pe){W.length?W=os(W,function(Qt){return D(Qt)?function(Ii){return ku(Ii,Qt.length===1?Qt[0]:Qt)}:Qt}):W=[Nc];var Ve=-1;W=os(W,Gt(Gn()));var gt=Ad(I,function(Qt,Ii,Gi){var br=os(W,function(gn){return gn(Qt)});return{criteria:br,index:++Ve,value:Qt}});return yi(gt,function(Qt,Ii){return Gd(Qt,Ii,pe)})}function Rm(I,W){return Iu(I,W,function(pe,Ve){return yx(I,Ve)})}function Iu(I,W,pe){for(var Ve=-1,gt=W.length,Qt={};++Ve<gt;){var Ii=W[Ve],Gi=ku(I,Ii);pe(Gi,Ii)&&ha(Qt,eu(Ii,I),Gi)}return Qt}function R0(I){return function(W){return ku(W,I)}}function Nm(I,W,pe,Ve){var gt=Ve?zh:Gu,Qt=-1,Ii=W.length,Gi=I;for(I===W&&(W=sc(W)),pe&&(Gi=os(I,Gt(pe)));++Qt<Ii;)for(var br=0,gn=W[Qt],_n=pe?pe(gn):gn;(br=gt(Gi,_n,br,Ve))>-1;)Gi!==I&&Pp.call(Gi,br,1),Pp.call(I,br,1);return I}function Ia(I,W){for(var pe=I?W.length:0,Ve=pe-1;pe--;){var gt=W[pe];if(pe==Ve||gt!==Qt){var Qt=gt;ya(gt)?Pp.call(I,gt,1):ed(I,gt)}}return I}function Sg(I,W){return I+Wf(fo()*(W-I+1))}function Qf(I,W,pe,Ve){for(var gt=-1,Qt=Ro(hf((W-I)/(pe||1)),0),Ii=Ur(Qt);Qt--;)Ii[Ve?Qt:++gt]=I,I+=pe;return Ii}function Md(I,W){var pe="";if(!I||W<1||W>Je)return pe;do W%2&&(pe+=I),W=Wf(W/2),W&&(I+=I);while(W);return pe}function Wi(I,W){return y(iu(I,W,Nc),I+"")}function cn(I){return Lm(by(I))}function Jf(I,W){var pe=by(I);return R(pe,gp(W,0,pe.length))}function ha(I,W,pe,Ve){if(!kt(I))return I;W=eu(W,I);for(var gt=-1,Qt=W.length,Ii=Qt-1,Gi=I;Gi!=null&&++gt<Qt;){var br=Z(W[gt]),gn=pe;if(br==="__proto__"||br==="constructor"||br==="prototype")return I;if(gt!=Ii){var _n=Gi[br];gn=Ve?Ve(_n,br,Gi):n,gn===n&&(gn=kt(_n)?_n:ya(W[gt+1])?[]:{})}gf(Gi,br,gn),Gi=Gi[br]}return I}var wi=Np?function(I,W){return Np.set(I,W),I}:Nc,kh=uo?function(I,W){return uo(I,"toString",{configurable:!0,enumerable:!1,value:q0(W),writable:!0})}:Nc;function Tg(I){return R(by(I))}function La(I,W,pe){var Ve=-1,gt=I.length;W<0&&(W=-W>gt?0:gt+W),pe=pe>gt?gt:pe,pe<0&&(pe+=gt),gt=W>pe?0:pe-W>>>0,W>>>=0;for(var Qt=Ur(gt);++Ve<gt;)Qt[Ve]=I[Ve+W];return Qt}function sy(I,W){var pe;return gh(I,function(Ve,gt,Qt){return pe=W(Ve,gt,Qt),!pe}),!!pe}function Bm(I,W,pe){var Ve=0,gt=I==null?Ve:I.length;if(typeof W=="number"&&W===W&&gt<=ur){for(;Ve<gt;){var Qt=Ve+gt>>>1,Ii=I[Qt];Ii!==null&&!us(Ii)&&(pe?Ii<=W:Ii<W)?Ve=Qt+1:gt=Qt}return gt}return kc(I,W,Nc,pe)}function kc(I,W,pe,Ve){var gt=0,Qt=I==null?0:I.length;if(Qt===0)return 0;W=pe(W);for(var Ii=W!==W,Gi=W===null,br=us(W),gn=W===n;gt<Qt;){var _n=Wf((gt+Qt)/2),Cn=pe(I[_n]),_s=Cn!==n,Gs=Cn===null,Lo=Cn===Cn,Ba=us(Cn);if(Ii)var zo=Ve||Lo;else gn?zo=Lo&&(Ve||_s):Gi?zo=Lo&&_s&&(Ve||!Gs):br?zo=Lo&&_s&&!Gs&&(Ve||!Ba):Gs||Ba?zo=!1:zo=Ve?Cn<=W:Cn<W;zo?gt=_n+1:Qt=_n}return eh(Qt,ei)}function xf(I,W){for(var pe=-1,Ve=I.length,gt=0,Qt=[];++pe<Ve;){var Ii=I[pe],Gi=W?W(Ii):Ii;if(!pe||!ld(Gi,br)){var br=Gi;Qt[gt++]=Ii===0?0:Ii}}return Qt}function ph(I){return typeof I=="number"?I:us(I)?ui:+I}function Lu(I){if(typeof I=="string")return I;if(D(I))return os(I,Lu)+"";if(us(I))return Bp?Bp.call(I):"";var W=I+"";return W=="0"&&1/I==-Dt?"-0":W}function Jh(I,W,pe){var Ve=-1,gt=$c,Qt=I.length,Ii=!0,Gi=[],br=Gi;if(pe)Ii=!1,gt=vn;else if(Qt>=a){var gn=W?null:sm(I);if(gn)return ea(gn);Ii=!1,gt=sr,br=new zp}else br=W?[]:Gi;e:for(;++Ve<Qt;){var _n=I[Ve],Cn=W?W(_n):_n;if(_n=pe||_n!==0?_n:0,Ii&&Cn===Cn){for(var _s=br.length;_s--;)if(br[_s]===Cn)continue e;W&&br.push(Cn),Gi.push(_n)}else gt(br,Cn,pe)||(br!==Gi&&br.push(Cn),Gi.push(_n))}return Gi}function ed(I,W){return W=eu(W,I),I=Bu(I,W),I==null||delete I[Z(Ni(W))]}function nc(I,W,pe,Ve){return ha(I,W,pe(ku(I,W)),Ve)}function Gl(I,W,pe,Ve){for(var gt=I.length,Qt=Ve?gt:-1;(Ve?Qt--:++Qt<gt)&&W(I[Qt],Qt,I););return pe?La(I,Ve?0:Qt,Ve?Qt+1:gt):La(I,Ve?Qt+1:0,Ve?gt:Qt)}function oy(I,W){var pe=I;return pe instanceof wa&&(pe=pe.value()),zl(W,function(Ve,gt){return gt.func.apply(gt.thisArg,Zs([Ve],gt.args))},pe)}function Vh(I,W,pe){var Ve=I.length;if(Ve<2)return Ve?Jh(I[0]):[];for(var gt=-1,Qt=Ur(Ve);++gt<Ve;)for(var Ii=I[gt],Gi=-1;++Gi<Ve;)Gi!=gt&&(Qt[gt]=Qu(Qt[gt]||Ii,I[Gi],W,pe));return Jh(jl(Qt,1),W,pe)}function yh(I,W,pe){for(var Ve=-1,gt=I.length,Qt=W.length,Ii={};++Ve<gt;){var Gi=Ve<Qt?W[Ve]:n;pe(Ii,I[Ve],Gi)}return Ii}function vp(I){return Y(I)?I:[]}function Rc(I){return typeof I=="function"?I:Nc}function eu(I,W){return D(I)?I:Yd(I,W)?[I]:$(va(I))}var th=Wi;function Hd(I,W,pe){var Ve=I.length;return pe=pe===n?Ve:pe,!W&&pe>=Ve?I:La(I,W,pe)}var ql=Wl||function(I){return Ll.clearTimeout(I)};function Va(I,W){if(W)return I.slice();var pe=I.length,Ve=bd?bd(pe):new I.constructor(pe);return I.copy(Ve),Ve}function lo(I){var W=new I.constructor(I.byteLength);return new Qc(W).set(new Qc(I)),W}function td(I,W){var pe=W?lo(I.buffer):I.buffer;return new I.constructor(pe,I.byteOffset,I.byteLength)}function Vc(I){var W=new I.constructor(I.source,Pr.exec(I));return W.lastIndex=I.lastIndex,W}function em(I){return wu?Fn(wu.call(I)):{}}function tm(I,W){var pe=W?lo(I.buffer):I.buffer;return new I.constructor(pe,I.byteOffset,I.length)}function xp(I,W){if(I!==W){var pe=I!==n,Ve=I===null,gt=I===I,Qt=us(I),Ii=W!==n,Gi=W===null,br=W===W,gn=us(W);if(!Gi&&!gn&&!Qt&&I>W||Qt&&Ii&&br&&!Gi&&!gn||Ve&&Ii&&br||!pe&&br||!gt)return 1;if(!Ve&&!Qt&&!gn&&I<W||gn&&pe&&gt&&!Ve&&!Qt||Gi&&pe&&gt||!Ii&&gt||!br)return-1}return 0}function Gd(I,W,pe){for(var Ve=-1,gt=I.criteria,Qt=W.criteria,Ii=gt.length,Gi=pe.length;++Ve<Ii;){var br=xp(gt[Ve],Qt[Ve]);if(br){if(Ve>=Gi)return br;var gn=pe[Ve];return br*(gn=="desc"?-1:1)}}return I.index-W.index}function im(I,W,pe,Ve){for(var gt=-1,Qt=I.length,Ii=pe.length,Gi=-1,br=W.length,gn=Ro(Qt-Ii,0),_n=Ur(br+gn),Cn=!Ve;++Gi<br;)_n[Gi]=W[Gi];for(;++gt<Ii;)(Cn||gt<Qt)&&(_n[pe[gt]]=I[gt]);for(;gn--;)_n[Gi++]=I[gt++];return _n}function id(I,W,pe,Ve){for(var gt=-1,Qt=I.length,Ii=-1,Gi=pe.length,br=-1,gn=W.length,_n=Ro(Qt-Gi,0),Cn=Ur(_n+gn),_s=!Ve;++gt<_n;)Cn[gt]=I[gt];for(var Gs=gt;++br<gn;)Cn[Gs+br]=W[br];for(;++Ii<Gi;)(_s||gt<Qt)&&(Cn[Gs+pe[Ii]]=I[gt++]);return Cn}function sc(I,W){var pe=-1,Ve=I.length;for(W||(W=Ur(Ve));++pe<Ve;)W[pe]=I[pe];return W}function Wc(I,W,pe,Ve){var gt=!pe;pe||(pe={});for(var Qt=-1,Ii=W.length;++Qt<Ii;){var Gi=W[Qt],br=Ve?Ve(pe[Gi],I[Gi],Gi,pe,I):n;br===n&&(br=I[Gi]),gt?Tu(pe,Gi,br):gf(pe,Gi,br)}return pe}function bf(I,W){return Wc(I,nl(I),W)}function Cg(I,W){return Wc(I,nd(I),W)}function Hp(I,W){return function(pe,Ve){var gt=D(pe)?lf:Td,Qt=W?W():{};return gt(pe,I,Gn(Ve,2),Qt)}}function rd(I){return Wi(function(W,pe){var Ve=-1,gt=pe.length,Qt=gt>1?pe[gt-1]:n,Ii=gt>2?pe[2]:n;for(Qt=I.length>3&&typeof Qt=="function"?(gt--,Qt):n,Ii&&Ql(pe[0],pe[1],Ii)&&(Qt=gt<3?n:Qt,gt=1),W=Fn(W);++Ve<gt;){var Gi=pe[Ve];Gi&&I(W,Gi,Ve,Qt)}return W})}function wf(I,W){return function(pe,Ve){if(pe==null)return pe;if(!H(pe))return I(pe,Ve);for(var gt=pe.length,Qt=W?gt:-1,Ii=Fn(pe);(W?Qt--:++Qt<gt)&&Ve(Ii[Qt],Qt,Ii)!==!1;);return pe}}function Pl(I){return function(W,pe,Ve){for(var gt=-1,Qt=Fn(W),Ii=Ve(W),Gi=Ii.length;Gi--;){var br=Ii[I?Gi:++gt];if(pe(Qt[br],br,Qt)===!1)break}return W}}function rm(I,W,pe){var Ve=W&he,gt=Sf(I);function Qt(){var Ii=this&&this!==Ll&&this instanceof Qt?gt:I;return Ii.apply(Ve?pe:this,arguments)}return Qt}function Wh(I){return function(W){W=va(W);var pe=ro(W)?$a(W):n,Ve=pe?pe[0]:W.charAt(0),gt=pe?Hd(pe,1).join(""):W.slice(1);return Ve[I]()+gt}}function ih(I){return function(W){return zl(l0(H0(W).replace(Vs,"")),I,"")}}function Sf(I){return function(){var W=arguments;switch(W.length){case 0:return new I;case 1:return new I(W[0]);case 2:return new I(W[0],W[1]);case 3:return new I(W[0],W[1],W[2]);case 4:return new I(W[0],W[1],W[2],W[3]);case 5:return new I(W[0],W[1],W[2],W[3],W[4]);case 6:return new I(W[0],W[1],W[2],W[3],W[4],W[5]);case 7:return new I(W[0],W[1],W[2],W[3],W[4],W[5],W[6])}var pe=Gf(I.prototype),Ve=I.apply(pe,W);return kt(Ve)?Ve:pe}}function ay(I,W,pe){var Ve=Sf(I);function gt(){for(var Qt=arguments.length,Ii=Ur(Qt),Gi=Qt,br=yc(gt);Gi--;)Ii[Gi]=arguments[Gi];var gn=Qt<3&&Ii[0]!==br&&Ii[Qt-1]!==br?[]:Jo(Ii,br);if(Qt-=gn.length,Qt<pe)return jh(I,W,qd,gt.placeholder,n,Ii,gn,n,n,pe-Qt);var _n=this&&this!==Ll&&this instanceof gt?Ve:I;return kn(_n,this,Ii)}return gt}function Id(I){return function(W,pe,Ve){var gt=Fn(W);if(!H(W)){var Qt=Gn(pe,3);W=Fu(W),pe=function(Gi){return Qt(gt[Gi],Gi,gt)}}var Ii=I(W,pe,Ve);return Ii>-1?gt[Qt?W[Ii]:Ii]:n}}function Ac(I){return tu(function(W){var pe=W.length,Ve=pe,gt=Su.prototype.thru;for(I&&W.reverse();Ve--;){var Qt=W[Ve];if(typeof Qt!="function")throw new Ms(f);if(gt&&!Ii&&Ru(Qt)=="wrapper")var Ii=new Su([],!0)}for(Ve=Ii?Ve:pe;++Ve<pe;){Qt=W[Ve];var Gi=Ru(Qt),br=Gi=="wrapper"?gu(Qt):n;br&&Xd(br[0])&&br[1]==(He|Se|Ee|Ye)&&!br[4].length&&br[9]==1?Ii=Ii[Ru(br[0])].apply(Ii,br[3]):Ii=Qt.length==1&&Xd(Qt)?Ii[Gi]():Ii.thru(Qt)}return function(){var gn=arguments,_n=gn[0];if(Ii&&gn.length==1&&D(_n))return Ii.plant(_n).value();for(var Cn=0,_s=pe?W[Cn].apply(this,gn):_n;++Cn<pe;)_s=W[Cn].call(this,_s);return _s}})}function qd(I,W,pe,Ve,gt,Qt,Ii,Gi,br,gn){var _n=W&He,Cn=W&he,_s=W&fe,Gs=W&(Se|ke),Lo=W&lt,Ba=_s?n:Sf(I);function zo(){for(var al=arguments.length,Xa=Ur(al),Tp=al;Tp--;)Xa[Tp]=arguments[Tp];if(Gs)var sp=yc(zo),ef=hi(Xa,sp);if(Ve&&(Xa=im(Xa,Ve,gt,Gs)),Qt&&(Xa=id(Xa,Qt,Ii,Gs)),al-=ef,Gs&&al<gn){var Gh=Jo(Xa,sp);return jh(I,W,qd,zo.placeholder,pe,Xa,Gh,Gi,br,gn-al)}var pm=Cn?pe:this,fm=_s?pm[I]:I;return al=Xa.length,Gi?Xa=Wm(Xa,Gi):Lo&&al>1&&Xa.reverse(),_n&&br<al&&(Xa.length=br),this&&this!==Ll&&this instanceof zo&&(fm=Ba||Sf(fm)),fm.apply(pm,Xa)}return zo}function Eg(I,W){return function(pe,Ve){return D0(pe,I,W(Ve),{})}}function Gp(I,W){return function(pe,Ve){var gt;if(pe===n&&Ve===n)return W;if(pe!==n&&(gt=pe),Ve!==n){if(gt===n)return Ve;typeof pe=="string"||typeof Ve=="string"?(pe=Lu(pe),Ve=Lu(Ve)):(pe=ph(pe),Ve=ph(Ve)),gt=I(pe,Ve)}return gt}}function Ld(I){return tu(function(W){return W=os(W,Gt(Gn())),Wi(function(pe){var Ve=this;return I(W,function(gt){return kn(gt,Ve,pe)})})})}function Dd(I,W){W=W===n?" ":Lu(W);var pe=W.length;if(pe<2)return pe?Md(W,I):W;var Ve=Md(W,hf(I/$l(W)));return ro(W)?Hd($a(Ve),0,I).join(""):Ve.slice(0,I)}function Fm(I,W,pe,Ve){var gt=W&he,Qt=Sf(I);function Ii(){for(var Gi=-1,br=arguments.length,gn=-1,_n=Ve.length,Cn=Ur(_n+br),_s=this&&this!==Ll&&this instanceof Ii?Qt:I;++gn<_n;)Cn[gn]=Ve[gn];for(;br--;)Cn[gn++]=arguments[++Gi];return kn(_s,gt?pe:this,Cn)}return Ii}function nm(I){return function(W,pe,Ve){return Ve&&typeof Ve!="number"&&Ql(W,pe,Ve)&&(pe=Ve=n),W=Os(W),pe===n?(pe=W,W=0):pe=Os(pe),Ve=Ve===n?W<pe?1:-1:Os(Ve),Qf(W,pe,Ve,I)}}function rh(I){return function(W,pe){return typeof W=="string"&&typeof pe=="string"||(W=pa(W),pe=pa(pe)),I(W,pe)}}function jh(I,W,pe,Ve,gt,Qt,Ii,Gi,br,gn){var _n=W&Se,Cn=_n?Ii:n,_s=_n?n:Ii,Gs=_n?Qt:n,Lo=_n?n:Qt;W|=_n?Ee:Ie,W&=~(_n?Ie:Ee),W&le||(W&=~(he|fe));var Ba=[I,W,gt,Gs,Cn,Lo,_s,Gi,br,gn],zo=pe.apply(n,Ba);return Xd(I)&&o(zo,Ba),zo.placeholder=Ve,C(zo,I,W)}function Pd(I){var W=pl[I];return function(pe,Ve){if(pe=pa(pe),Ve=Ve==null?0:eh(Us(Ve),292),Ve&&A0(pe)){var gt=(va(pe)+"e").split("e"),Qt=W(gt[0]+"e"+(+gt[1]+Ve));return gt=(va(Qt)+"e").split("e"),+(gt[0]+"e"+(+gt[1]-Ve))}return W(pe)}}var sm=zs&&1/ea(new zs([,-0]))[1]==Dt?function(I){return new zs(I)}:Qm;function zm(I){return function(W){var pe=Kl(W);return pe==Ue?Mo(W):pe==pi?So(W):Tr(W,I(W))}}function Du(I,W,pe,Ve,gt,Qt,Ii,Gi){var br=W&fe;if(!br&&typeof I!="function")throw new Ms(f);var gn=Ve?Ve.length:0;if(gn||(W&=~(Ee|Ie),Ve=gt=n),Ii=Ii===n?Ii:Ro(Us(Ii),0),Gi=Gi===n?Gi:Us(Gi),gn-=gt?gt.length:0,W&Ie){var _n=Ve,Cn=gt;Ve=gt=n}var _s=br?n:gu(I),Gs=[I,W,pe,Ve,gt,_n,Cn,Qt,Ii,Gi];if(_s&&Dg(Gs,_s),I=Gs[0],W=Gs[1],pe=Gs[2],Ve=Gs[3],gt=Gs[4],Gi=Gs[9]=Gs[9]===n?br?0:I.length:Ro(Gs[9]-gn,0),!Gi&&W&(Se|ke)&&(W&=~(Se|ke)),!W||W==he)var Lo=rm(I,W,pe);else W==Se||W==ke?Lo=ay(I,W,Gi):(W==Ee||W==(he|Ee))&&!gt.length?Lo=Fm(I,W,pe,Ve):Lo=qd.apply(n,Gs);var Ba=_s?wi:o;return C(Ba(Lo,Gs),I,W)}function Pu(I,W,pe,Ve){return I===n||ld(I,ta[pe])&&!To.call(Ve,pe)?W:I}function om(I,W,pe,Ve,gt,Qt){return kt(I)&&kt(W)&&(Qt.set(W,I),jp(I,W,n,om,Qt),Qt.delete(W)),I}function Sa(I){return fn(I)?n:I}function kg(I,W,pe,Ve,gt,Qt){var Ii=pe&Q,Gi=I.length,br=W.length;if(Gi!=br&&!(Ii&&br>Gi))return!1;var gn=Qt.get(I),_n=Qt.get(W);if(gn&&_n)return gn==W&&_n==I;var Cn=-1,_s=!0,Gs=pe&te?new zp:n;for(Qt.set(I,W),Qt.set(W,I);++Cn<Gi;){var Lo=I[Cn],Ba=W[Cn];if(Ve)var zo=Ii?Ve(Ba,Lo,Cn,W,I,Qt):Ve(Lo,Ba,Cn,I,W,Qt);if(zo!==n){if(zo)continue;_s=!1;break}if(Gs){if(!Ks(W,function(al,Xa){if(!sr(Gs,Xa)&&(Lo===al||gt(Lo,al,pe,Ve,Qt)))return Gs.push(Xa)})){_s=!1;break}}else if(!(Lo===Ba||gt(Lo,Ba,pe,Ve,Qt))){_s=!1;break}}return Qt.delete(I),Qt.delete(W),_s}function Ou(I,W,pe,Ve,gt,Qt,Ii){switch(pe){case Cr:if(I.byteLength!=W.byteLength||I.byteOffset!=W.byteOffset)return!1;I=I.buffer,W=W.buffer;case Mr:return!(I.byteLength!=W.byteLength||!Qt(new Qc(I),new Qc(W)));case gi:case Oi:case ni:return ld(+I,+W);case ji:return I.name==W.name&&I.message==W.message;case Si:case St:return I==W+"";case Ue:var Gi=Mo;case pi:var br=Ve&Q;if(Gi||(Gi=ea),I.size!=W.size&&!br)return!1;var gn=Ii.get(I);if(gn)return gn==W;Ve|=te,Ii.set(I,W);var _n=kg(Gi(I),Gi(W),Ve,gt,Qt,Ii);return Ii.delete(I),_n;case Ht:if(wu)return wu.call(I)==wu.call(W)}return!1}function qp(I,W,pe,Ve,gt,Qt){var Ii=pe&Q,Gi=Ag(I),br=Gi.length,gn=Ag(W),_n=gn.length;if(br!=_n&&!Ii)return!1;for(var Cn=br;Cn--;){var _s=Gi[Cn];if(!(Ii?_s in W:To.call(W,_s)))return!1}var Gs=Qt.get(I),Lo=Qt.get(W);if(Gs&&Lo)return Gs==W&&Lo==I;var Ba=!0;Qt.set(I,W),Qt.set(W,I);for(var zo=Ii;++Cn<br;){_s=Gi[Cn];var al=I[_s],Xa=W[_s];if(Ve)var Tp=Ii?Ve(Xa,al,_s,W,I,Qt):Ve(al,Xa,_s,I,W,Qt);if(!(Tp===n?al===Xa||gt(al,Xa,pe,Ve,Qt):Tp)){Ba=!1;break}zo||(zo=_s=="constructor")}if(Ba&&!zo){var sp=I.constructor,ef=W.constructor;sp!=ef&&"constructor"in I&&"constructor"in W&&!(typeof sp=="function"&&sp instanceof sp&&typeof ef=="function"&&ef instanceof ef)&&(Ba=!1)}return Qt.delete(I),Qt.delete(W),Ba}function tu(I){return y(iu(I,n,Wt),I+"")}function Ag(I){return _p(I,Fu,nl)}function am(I){return _p(I,cd,nd)}var gu=Np?function(I){return Np.get(I)}:Qm;function Ru(I){for(var W=I.name+"",pe=wd[W],Ve=To.call(wd,W)?pe.length:0;Ve--;){var gt=pe[Ve],Qt=gt.func;if(Qt==null||Qt==I)return gt.name}return W}function yc(I){var W=To.call(zt,"placeholder")?zt:I;return W.placeholder}function Gn(){var I=zt.iteratee||rp;return I=I===rp?Uh:I,arguments.length?I(arguments[0],arguments[1]):I}function Um(I,W){var pe=I.__data__;return ly(W)?pe[typeof W=="string"?"string":"hash"]:pe.map}function $m(I){for(var W=Fu(I),pe=W.length;pe--;){var Ve=W[pe],gt=I[Ve];W[pe]=[Ve,gt,sd(gt)]}return W}function bp(I,W){var pe=Qn(I,W);return Mu(pe)?pe:n}function Yp(I){var W=To.call(I,Eh),pe=I[Eh];try{I[Eh]=n;var Ve=!0}catch{}var gt=mr.call(I);return Ve&&(W?I[Eh]=pe:delete I[Eh]),gt}var nl=pc?function(I){return I==null?[]:(I=Fn(I),Zl(pc(I),function(W){return qu.call(I,W)}))}:Ax,nd=pc?function(I){for(var W=[];I;)Zs(W,nl(I)),I=Jc(I);return W}:Ax,Kl=yl;(Hf&&Kl(new Hf(new ArrayBuffer(1)))!=Cr||df&&Kl(new df)!=Ue||Op&&Kl(Op.resolve())!=pt||zs&&Kl(new zs)!=pi||Yu&&Kl(new Yu)!=tr)&&(Kl=function(I){var W=yl(I),pe=W==Lt?I.constructor:n,Ve=pe?se(pe):"";if(Ve)switch(Ve){case No:return Cr;case Cm:return Ue;case yg:return pt;case _g:return pi;case M0:return tr}return W});function Mg(I,W,pe){for(var Ve=-1,gt=pe.length;++Ve<gt;){var Qt=pe[Ve],Ii=Qt.size;switch(Qt.type){case"drop":I+=Ii;break;case"dropRight":W-=Ii;break;case"take":W=eh(W,I+Ii);break;case"takeRight":I=Ro(I,W-Ii);break}}return{start:I,end:W}}function _c(I){var W=I.match(Jt);return W?W[1].split(xi):[]}function Xp(I,W,pe){W=eu(W,I);for(var Ve=-1,gt=W.length,Qt=!1;++Ve<gt;){var Ii=Z(W[Ve]);if(!(Qt=I!=null&&pe(I,Ii)))break;I=I[Ii]}return Qt||++Ve!=gt?Qt:(gt=I==null?0:I.length,!!gt&&wt(gt)&&ya(Ii,gt)&&(D(I)||k(I)))}function Vm(I){var W=I.length,pe=new I.constructor(W);return W&&typeof I[0]=="string"&&To.call(I,"index")&&(pe.index=I.index,pe.input=I.input),pe}function Tf(I){return typeof I.constructor=="function"&&!Zd(I)?Gf(Jc(I)):{}}function Cf(I,W,pe){var Ve=I.constructor;switch(W){case Mr:return lo(I);case gi:case Oi:return new Ve(+I);case Cr:return td(I,pe);case Tn:case gs:case wn:case bs:case qn:case Ls:case ma:case Ln:case qo:return tm(I,pe);case Ue:return new Ve;case ni:case St:return new Ve(I);case Si:return Vc(I);case pi:return new Ve;case Ht:return em(I)}}function wp(I,W){var pe=W.length;if(!pe)return I;var Ve=pe-1;return W[Ve]=(pe>1?"& ":"")+W[Ve],W=W.join(pe>2?", ":" "),I.replace(ft,`{
/* [wrapped with `+W+`] */
`)}function Ig(I){return D(I)||k(I)||!!(ga&&I&&I[ga])}function ya(I,W){var pe=typeof I;return W=W??Je,!!W&&(pe=="number"||pe!="symbol"&&xr.test(I))&&I>-1&&I%1==0&&I<W}function Ql(I,W,pe){if(!kt(pe))return!1;var Ve=typeof W;return(Ve=="number"?H(pe)&&ya(W,pe.length):Ve=="string"&&W in pe)?ld(pe[W],I):!1}function Yd(I,W){if(D(I))return!1;var pe=typeof I;return pe=="number"||pe=="symbol"||pe=="boolean"||I==null||us(I)?!0:Un.test(I)||!bl.test(I)||W!=null&&I in Fn(W)}function ly(I){var W=typeof I;return W=="string"||W=="number"||W=="symbol"||W=="boolean"?I!=="__proto__":I===null}function Xd(I){var W=Ru(I),pe=zt[W];if(typeof pe!="function"||!(W in wa.prototype))return!1;if(I===pe)return!0;var Ve=gu(pe);return!!Ve&&I===Ve[0]}function cy(I){return!!rl&&rl in I}var Zp=Oo?nt:Jp;function Zd(I){var W=I&&I.constructor,pe=typeof W=="function"&&W.prototype||ta;return I===pe}function sd(I){return I===I&&!kt(I)}function Kd(I,W){return function(pe){return pe==null?!1:pe[I]===W&&(W!==n||I in Fn(pe))}}function Lg(I){var W=Bg(I,function(Ve){return pe.size===E&&pe.clear(),Ve}),pe=W.cache;return W}function Dg(I,W){var pe=I[1],Ve=W[1],gt=pe|Ve,Qt=gt<(he|fe|He),Ii=Ve==He&&pe==Se||Ve==He&&pe==Ye&&I[7].length<=W[8]||Ve==(He|Ye)&&W[7].length<=W[8]&&pe==Se;if(!(Qt||Ii))return I;Ve&he&&(I[2]=W[2],gt|=pe&he?0:le);var Gi=W[3];if(Gi){var br=I[3];I[3]=br?im(br,Gi,W[4]):Gi,I[4]=br?Jo(I[3],L):W[4]}return Gi=W[5],Gi&&(br=I[5],I[5]=br?id(br,Gi,W[6]):Gi,I[6]=br?Jo(I[5],L):W[6]),Gi=W[7],Gi&&(I[7]=Gi),Ve&He&&(I[8]=I[8]==null?W[8]:eh(I[8],W[8])),I[9]==null&&(I[9]=W[9]),I[0]=W[0],I[1]=gt,I}function lm(I){var W=[];if(I!=null)for(var pe in Fn(I))W.push(pe);return W}function Nu(I){return mr.call(I)}function iu(I,W,pe){return W=Ro(W===n?I.length-1:W,0),function(){for(var Ve=arguments,gt=-1,Qt=Ro(Ve.length-W,0),Ii=Ur(Qt);++gt<Qt;)Ii[gt]=Ve[W+gt];gt=-1;for(var Gi=Ur(W+1);++gt<W;)Gi[gt]=Ve[gt];return Gi[W]=pe(Ii),kn(I,this,Gi)}}function Bu(I,W){return W.length<2?I:ku(I,La(W,0,-1))}function Wm(I,W){for(var pe=I.length,Ve=eh(W.length,pe),gt=sc(I);Ve--;){var Qt=W[Ve];I[Ve]=ya(Qt,pe)?gt[Qt]:n}return I}function g(I,W){if(!(W==="constructor"&&typeof I[W]=="function")&&W!="__proto__")return I[W]}var o=A(wi),h=k0||function(I,W){return Ll.setTimeout(I,W)},y=A(kh);function C(I,W,pe){var Ve=W+"";return y(I,wp(Ve,ue(_c(Ve),pe)))}function A(I){var W=0,pe=0;return function(){var Ve=gg(),gt=Ot-(Ve-pe);if(pe=Ve,gt>0){if(++W>=ht)return arguments[0]}else W=0;return I.apply(n,arguments)}}function R(I,W){var pe=-1,Ve=I.length,gt=Ve-1;for(W=W===n?Ve:W;++pe<W;){var Qt=Sg(pe,gt),Ii=I[Qt];I[Qt]=I[pe],I[pe]=Ii}return I.length=W,I}var $=Lg(function(I){var W=[];return I.charCodeAt(0)===46&&W.push(""),I.replace(vi,function(pe,Ve,gt,Qt){W.push(gt?Qt.replace(Yi,"$1"):Ve||pe)}),W});function Z(I){if(typeof I=="string"||us(I))return I;var W=I+"";return W=="0"&&1/I==-Dt?"-0":W}function se(I){if(I!=null){try{return Io.call(I)}catch{}try{return I+""}catch{}}return""}function ue(I,W){return ic(Zt,function(pe){var Ve="_."+pe[0];W&pe[1]&&!$c(I,Ve)&&I.push(Ve)}),I.sort()}function be(I){if(I instanceof wa)return I.clone();var W=new Su(I.__wrapped__,I.__chain__);return W.__actions__=sc(I.__actions__),W.__index__=I.__index__,W.__values__=I.__values__,W}function ge(I,W,pe){(pe?Ql(I,W,pe):W===n)?W=1:W=Ro(Us(W),0);var Ve=I==null?0:I.length;if(!Ve||W<1)return[];for(var gt=0,Qt=0,Ii=Ur(hf(Ve/W));gt<Ve;)Ii[Qt++]=La(I,gt,gt+=W);return Ii}function Ce(I){for(var W=-1,pe=I==null?0:I.length,Ve=0,gt=[];++W<pe;){var Qt=I[W];Qt&&(gt[Ve++]=Qt)}return gt}function $e(){var I=arguments.length;if(!I)return[];for(var W=Ur(I-1),pe=arguments[0],Ve=I;Ve--;)W[Ve-1]=arguments[Ve];return Zs(D(pe)?sc(pe):[pe],jl(W,1))}var Ne=Wi(function(I,W){return Y(I)?Qu(I,jl(W,1,Y,!0)):[]}),We=Wi(function(I,W){var pe=Ni(W);return Y(pe)&&(pe=n),Y(I)?Qu(I,jl(W,1,Y,!0),Gn(pe,2)):[]}),Xe=Wi(function(I,W){var pe=Ni(W);return Y(pe)&&(pe=n),Y(I)?Qu(I,jl(W,1,Y,!0),n,pe):[]});function et(I,W,pe){var Ve=I==null?0:I.length;return Ve?(W=pe||W===n?1:Us(W),La(I,W<0?0:W,Ve)):[]}function _t(I,W,pe){var Ve=I==null?0:I.length;return Ve?(W=pe||W===n?1:Us(W),W=Ve-W,La(I,0,W<0?0:W)):[]}function Ct(I,W){return I&&I.length?Gl(I,Gn(W,3),!0,!0):[]}function jt(I,W){return I&&I.length?Gl(I,Gn(W,3),!0):[]}function Ft(I,W,pe,Ve){var gt=I==null?0:I.length;return gt?(pe&&typeof pe!="number"&&Ql(I,W,pe)&&(pe=0,Ve=gt),yf(I,W,pe,Ve)):[]}function Rt(I,W,pe){var Ve=I==null?0:I.length;if(!Ve)return-1;var gt=pe==null?0:Us(pe);return gt<0&&(gt=Ro(Ve+gt,0)),Ja(I,Gn(W,3),gt)}function Et(I,W,pe){var Ve=I==null?0:I.length;if(!Ve)return-1;var gt=Ve-1;return pe!==n&&(gt=Us(pe),gt=pe<0?Ro(Ve+gt,0):eh(gt,Ve-1)),Ja(I,Gn(W,3),gt,!0)}function Wt(I){var W=I==null?0:I.length;return W?jl(I,1):[]}function qt(I){var W=I==null?0:I.length;return W?jl(I,Dt):[]}function Ei(I,W){var pe=I==null?0:I.length;return pe?(W=W===n?1:Us(W),jl(I,W)):[]}function Mi(I){for(var W=-1,pe=I==null?0:I.length,Ve={};++W<pe;){var gt=I[W];Ve[gt[0]]=gt[1]}return Ve}function Ki(I){return I&&I.length?I[0]:n}function Ji(I,W,pe){var Ve=I==null?0:I.length;if(!Ve)return-1;var gt=pe==null?0:Us(pe);return gt<0&&(gt=Ro(Ve+gt,0)),Gu(I,W,gt)}function Er(I){var W=I==null?0:I.length;return W?La(I,0,-1):[]}var Ti=Wi(function(I){var W=os(I,vp);return W.length&&W[0]===I[0]?Ec(W):[]}),$i=Wi(function(I){var W=Ni(I),pe=os(I,vp);return W===Ni(pe)?W=n:pe.pop(),pe.length&&pe[0]===I[0]?Ec(pe,Gn(W,2)):[]}),li=Wi(function(I){var W=Ni(I),pe=os(I,vp);return W=typeof W=="function"?W:n,W&&pe.pop(),pe.length&&pe[0]===I[0]?Ec(pe,n,W):[]});function dr(I,W){return I==null?"":jf.call(I,W)}function Ni(I){var W=I==null?0:I.length;return W?I[W-1]:n}function vr(I,W,pe){var Ve=I==null?0:I.length;if(!Ve)return-1;var gt=Ve;return pe!==n&&(gt=Us(pe),gt=gt<0?Ro(Ve+gt,0):eh(gt,Ve-1)),W===W?Ul(I,W,gt):Ja(I,Ch,gt,!0)}function Nr(I,W){return I&&I.length?jd(I,Us(W)):n}var ar=Wi(Br);function Br(I,W){return I&&I.length&&W&&W.length?Nm(I,W):I}function dn(I,W,pe){return I&&I.length&&W&&W.length?Nm(I,W,Gn(pe,2)):I}function pn(I,W,pe){return I&&I.length&&W&&W.length?Nm(I,W,n,pe):I}var on=tu(function(I,W){var pe=I==null?0:I.length,Ve=Up(I,W);return Ia(I,os(W,function(gt){return ya(gt,pe)?+gt:gt}).sort(xp)),Ve});function bn(I,W){var pe=[];if(!(I&&I.length))return pe;var Ve=-1,gt=[],Qt=I.length;for(W=Gn(W,3);++Ve<Qt;){var Ii=I[Ve];W(Ii,Ve,I)&&(pe.push(Ii),gt.push(Ve))}return Ia(I,gt),pe}function An(I){return I==null?I:ml.call(I)}function Vn(I,W,pe){var Ve=I==null?0:I.length;return Ve?(pe&&typeof pe!="number"&&Ql(I,W,pe)?(W=0,pe=Ve):(W=W==null?0:Us(W),pe=pe===n?Ve:Us(pe)),La(I,W,pe)):[]}function Zn(I,W){return Bm(I,W)}function ys(I,W,pe){return kc(I,W,Gn(pe,2))}function Bo(I,W){var pe=I==null?0:I.length;if(pe){var Ve=Bm(I,W);if(Ve<pe&&ld(I[Ve],W))return Ve}return-1}function Da(I,W){return Bm(I,W,!0)}function xo(I,W,pe){return kc(I,W,Gn(pe,2),!0)}function ia(I,W){var pe=I==null?0:I.length;if(pe){var Ve=Bm(I,W,!0)-1;if(ld(I[Ve],W))return Ve}return-1}function sl(I){return I&&I.length?xf(I):[]}function ls(I,W){return I&&I.length?xf(I,Gn(W,2)):[]}function cs(I){var W=I==null?0:I.length;return W?La(I,1,W):[]}function Ts(I,W,pe){return I&&I.length?(W=pe||W===n?1:Us(W),La(I,0,W<0?0:W)):[]}function _a(I,W,pe){var Ve=I==null?0:I.length;return Ve?(W=pe||W===n?1:Us(W),W=Ve-W,La(I,W<0?0:W,Ve)):[]}function Jl(I,W){return I&&I.length?Gl(I,Gn(W,3),!1,!0):[]}function Zo(I,W){return I&&I.length?Gl(I,Gn(W,3)):[]}var Wo=Wi(function(I){return Jh(jl(I,1,Y,!0))}),ol=Wi(function(I){var W=Ni(I);return Y(W)&&(W=n),Jh(jl(I,1,Y,!0),Gn(W,2))}),Ws=Wi(function(I){var W=Ni(I);return W=typeof W=="function"?W:n,Jh(jl(I,1,Y,!0),n,W)});function ec(I){return I&&I.length?Jh(I):[]}function Ta(I,W){return I&&I.length?Jh(I,Gn(W,2)):[]}function Ca(I,W){return W=typeof W=="function"?W:n,I&&I.length?Jh(I,n,W):[]}function Ko(I){if(!(I&&I.length))return[];var W=0;return I=Zl(I,function(pe){if(Y(pe))return W=Ro(pe.length,W),!0}),Li(W,function(pe){return os(I,vt(pe))})}function bo(I,W){if(!(I&&I.length))return[];var pe=Ko(I);return W==null?pe:os(pe,function(Ve){return kn(W,n,Ve)})}var Ya=Wi(function(I,W){return Y(I)?Qu(I,W):[]}),_h=Wi(function(I){return Vh(Zl(I,Y))}),ua=Wi(function(I){var W=Ni(I);return Y(W)&&(W=n),Vh(Zl(I,Y),Gn(W,2))}),Fo=Wi(function(I){var W=Ni(I);return W=typeof W=="function"?W:n,Vh(Zl(I,Y),n,W)}),ru=Wi(Ko);function Ah(I,W){return yh(I||[],W||[],gf)}function od(I,W){return yh(I||[],W||[],ha)}var Od=Wi(function(I){var W=I.length,pe=W>1?I[W-1]:n;return pe=typeof pe=="function"?(I.pop(),pe):n,bo(I,pe)});function nu(I){var W=zt(I);return W.__chain__=!0,W}function su(I,W){return W(I),I}function Qd(I,W){return W(I)}var ad=tu(function(I){var W=I.length,pe=W?I[0]:0,Ve=this.__wrapped__,gt=function(Qt){return Up(Qt,I)};return W>1||this.__actions__.length||!(Ve instanceof wa)||!ya(pe)?this.thru(gt):(Ve=Ve.slice(pe,+pe+(W?1:0)),Ve.__actions__.push({func:Qd,args:[gt],thisArg:n}),new Su(Ve,this.__chain__).thru(function(Qt){return W&&!Qt.length&&Qt.push(n),Qt}))});function Jd(){return nu(this)}function cm(){return new Su(this.value(),this.__chain__)}function hy(){this.__values__===n&&(this.__values__=Co(this.value()));var I=this.__index__>=this.__values__.length,W=I?n:this.__values__[this.__index__++];return{done:I,value:W}}function hm(){return this}function uy(I){for(var W,pe=this;pe instanceof qf;){var Ve=be(pe);Ve.__index__=0,Ve.__values__=n,W?gt.__wrapped__=Ve:W=Ve;var gt=Ve;pe=pe.__wrapped__}return gt.__wrapped__=I,W}function Pg(){var I=this.__wrapped__;if(I instanceof wa){var W=I;return this.__actions__.length&&(W=new wa(this)),W=W.reverse(),W.__actions__.push({func:Qd,args:[An],thisArg:n}),new Su(W,this.__chain__)}return this.thru(An)}function dy(){return oy(this.__wrapped__,this.__actions__)}var um=Hp(function(I,W,pe){To.call(I,pe)?++I[pe]:Tu(I,pe,1)});function ep(I,W,pe){var Ve=D(I)?Qa:Hy;return pe&&Ql(I,W,pe)&&(W=n),Ve(I,Gn(W,3))}function jm(I,W){var pe=D(I)?Zl:Xf;return pe(I,Gn(W,3))}var Sp=Id(Rt),tp=Id(Et);function N0(I,W){return jl(py(I,W),1)}function Og(I,W){return jl(py(I,W),Dt)}function B0(I,W,pe){return pe=pe===n?1:Us(pe),jl(py(I,W),pe)}function Gy(I,W){var pe=D(I)?ic:gh;return pe(I,Gn(W,3))}function qy(I,W){var pe=D(I)?wl:Dm;return pe(I,Gn(W,3))}var hv=Hp(function(I,W,pe){To.call(I,pe)?I[pe].push(W):Tu(I,pe,[W])});function F0(I,W,pe,Ve){I=H(I)?I:by(I),pe=pe&&!Ve?Us(pe):0;var gt=I.length;return pe<0&&(pe=Ro(gt+pe,0)),jn(I)?pe<=gt&&I.indexOf(W,pe)>-1:!!gt&&Gu(I,W,pe)>-1}var uv=Wi(function(I,W,pe){var Ve=-1,gt=typeof W=="function",Qt=H(I)?Ur(I.length):[];return gh(I,function(Ii){Qt[++Ve]=gt?kn(W,Ii,pe):mu(Ii,W,pe)}),Qt}),Rg=Hp(function(I,W,pe){Tu(I,pe,W)});function py(I,W){var pe=D(I)?os:Ad;return pe(I,Gn(W,3))}function Hh(I,W,pe,Ve){return I==null?[]:(D(W)||(W=W==null?[]:[W]),pe=Ve?n:pe,D(pe)||(pe=pe==null?[]:[pe]),sa(I,W,pe))}var Ng=Hp(function(I,W,pe){I[pe?0:1].push(W)},function(){return[[],[]]});function dv(I,W,pe){var Ve=D(I)?zl:Di,gt=arguments.length<3;return Ve(I,Gn(W,4),pe,gt,gh)}function pv(I,W,pe){var Ve=D(I)?bu:Di,gt=arguments.length<3;return Ve(I,Gn(W,4),pe,gt,Dm)}function Yy(I,W){var pe=D(I)?Zl:Xf;return pe(I,Fg(Gn(W,3)))}function E_(I){var W=D(I)?Lm:cn;return W(I)}function k_(I,W,pe){(pe?Ql(I,W,pe):W===n)?W=1:W=Us(W);var Ve=D(I)?mf:Jf;return Ve(I,W)}function fy(I){var W=D(I)?Wy:Tg;return W(I)}function px(I){if(I==null)return 0;if(H(I))return jn(I)?$l(I):I.length;var W=Kl(I);return W==Ue||W==pi?I.size:Om(I).length}function fv(I,W,pe){var Ve=D(I)?Ks:sy;return pe&&Ql(I,W,pe)&&(W=n),Ve(I,Gn(W,3))}var fx=Wi(function(I,W){if(I==null)return[];var pe=W.length;return pe>1&&Ql(I,W[0],W[1])?W=[]:pe>2&&Ql(W[0],W[1],W[2])&&(W=[W[0]]),sa(I,jl(W,1),[])}),Hm=Kg||function(){return Ll.Date.now()};function Kp(I,W){if(typeof W!="function")throw new Ms(f);return I=Us(I),function(){if(--I<1)return W.apply(this,arguments)}}function Qp(I,W,pe){return W=pe?n:W,W=I&&W==null?I.length:W,Du(I,He,n,n,n,n,W)}function z0(I,W){var pe;if(typeof W!="function")throw new Ms(f);return I=Us(I),function(){return--I>0&&(pe=W.apply(this,arguments)),I<=1&&(W=n),pe}}var Xy=Wi(function(I,W,pe){var Ve=he;if(pe.length){var gt=Jo(pe,yc(Xy));Ve|=Ee}return Du(I,Ve,W,pe,gt)}),Zy=Wi(function(I,W,pe){var Ve=he|fe;if(pe.length){var gt=Jo(pe,yc(Zy));Ve|=Ee}return Du(W,Ve,I,pe,gt)});function my(I,W,pe){W=pe?n:W;var Ve=Du(I,Se,n,n,n,n,n,W);return Ve.placeholder=my.placeholder,Ve}function gy(I,W,pe){W=pe?n:W;var Ve=Du(I,ke,n,n,n,n,n,W);return Ve.placeholder=gy.placeholder,Ve}function yy(I,W,pe){var Ve,gt,Qt,Ii,Gi,br,gn=0,_n=!1,Cn=!1,_s=!0;if(typeof I!="function")throw new Ms(f);W=pa(W)||0,kt(pe)&&(_n=!!pe.leading,Cn="maxWait"in pe,Qt=Cn?Ro(pa(pe.maxWait)||0,W):Qt,_s="trailing"in pe?!!pe.trailing:_s);function Gs(Gh){var pm=Ve,fm=gt;return Ve=gt=n,gn=Gh,Ii=I.apply(fm,pm),Ii}function Lo(Gh){return gn=Gh,Gi=h(al,W),_n?Gs(Gh):Ii}function Ba(Gh){var pm=Gh-br,fm=Gh-gn,Vb=W-pm;return Cn?eh(Vb,Qt-fm):Vb}function zo(Gh){var pm=Gh-br,fm=Gh-gn;return br===n||pm>=W||pm<0||Cn&&fm>=Qt}function al(){var Gh=Hm();if(zo(Gh))return Xa(Gh);Gi=h(al,Ba(Gh))}function Xa(Gh){return Gi=n,_s&&Ve?Gs(Gh):(Ve=gt=n,Ii)}function Tp(){Gi!==n&&ql(Gi),gn=0,Ve=br=gt=Gi=n}function sp(){return Gi===n?Ii:Xa(Hm())}function ef(){var Gh=Hm(),pm=zo(Gh);if(Ve=arguments,gt=this,br=Gh,pm){if(Gi===n)return Lo(br);if(Cn)return ql(Gi),Gi=h(al,W),Gs(br)}return Gi===n&&(Gi=h(al,W)),Ii}return ef.cancel=Tp,ef.flush=sp,ef}var A_=Wi(function(I,W){return ry(I,1,W)}),U0=Wi(function(I,W,pe){return ry(I,pa(W)||0,pe)});function Ky(I){return Du(I,lt)}function Bg(I,W){if(typeof I!="function"||W!=null&&typeof W!="function")throw new Ms(f);var pe=function(){var Ve=arguments,gt=W?W.apply(this,Ve):Ve[0],Qt=pe.cache;if(Qt.has(gt))return Qt.get(gt);var Ii=I.apply(this,Ve);return pe.cache=Qt.set(gt,Ii)||Qt,Ii};return pe.cache=new(Bg.Cache||Sd),pe}Bg.Cache=Sd;function Fg(I){if(typeof I!="function")throw new Ms(f);return function(){var W=arguments;switch(W.length){case 0:return!I.call(this);case 1:return!I.call(this,W[0]);case 2:return!I.call(this,W[0],W[1]);case 3:return!I.call(this,W[0],W[1],W[2])}return!I.apply(this,W)}}function mv(I){return z0(2,I)}var Ef=th(function(I,W){W=W.length==1&&D(W[0])?os(W[0],Gt(Gn())):os(jl(W,1),Gt(Gn()));var pe=W.length;return Wi(function(Ve){for(var gt=-1,Qt=eh(Ve.length,pe);++gt<Qt;)Ve[gt]=W[gt].call(this,Ve[gt]);return kn(I,this,Ve)})}),Qy=Wi(function(I,W){var pe=Jo(W,yc(Qy));return Du(I,Ee,n,W,pe)}),Jy=Wi(function(I,W){var pe=Jo(W,yc(Jy));return Du(I,Ie,n,W,pe)}),gv=tu(function(I,W){return Du(I,Ye,n,n,n,W)});function $0(I,W){if(typeof I!="function")throw new Ms(f);return W=W===n?W:Us(W),Wi(I,W)}function yv(I,W){if(typeof I!="function")throw new Ms(f);return W=W==null?0:Ro(Us(W),0),Wi(function(pe){var Ve=pe[W],gt=Hd(pe,0,W);return Ve&&Zs(gt,Ve),kn(I,this,gt)})}function mx(I,W,pe){var Ve=!0,gt=!0;if(typeof I!="function")throw new Ms(f);return kt(pe)&&(Ve="leading"in pe?!!pe.leading:Ve,gt="trailing"in pe?!!pe.trailing:gt),yy(I,W,{leading:Ve,maxWait:W,trailing:gt})}function M_(I){return Qp(I,1)}function _v(I,W){return Qy(Rc(W),I)}function I_(){if(!arguments.length)return[];var I=arguments[0];return D(I)?I:[I]}function vv(I){return Cu(I,q)}function e0(I,W){return W=typeof W=="function"?W:n,Cu(I,q,W)}function xv(I){return Cu(I,F|q)}function bv(I,W){return W=typeof W=="function"?W:n,Cu(I,F|q,W)}function wv(I,W){return W==null||$p(I,W,Fu(W))}function ld(I,W){return I===W||I!==I&&W!==W}var ve=rh(_f),v=rh(function(I,W){return I>=W}),k=Hl(function(){return arguments}())?Hl:function(I){return Ai(I)&&To.call(I,"callee")&&!qu.call(I,"callee")},D=Ur.isArray,V=Cc?Gt(Cc):$n;function H(I){return I!=null&&wt(I.length)&&!nt(I)}function Y(I){return Ai(I)&&H(I)}function J(I){return I===!0||I===!1||Ai(I)&&yl(I)==gi}var ae=Qg||Jp,_e=Fh?Gt(Fh):kd;function Me(I){return Ai(I)&&I.nodeType===1&&!fn(I)}function xe(I){if(I==null)return!0;if(H(I)&&(D(I)||typeof I=="string"||typeof I.splice=="function"||ae(I)||oa(I)||k(I)))return!I.length;var W=Kl(I);if(W==Ue||W==pi)return!I.size;if(Zd(I))return!Om(I).length;for(var pe in I)if(To.call(I,pe))return!1;return!0}function Pe(I,W){return Wp(I,W)}function je(I,W,pe){pe=typeof pe=="function"?pe:n;var Ve=pe?pe(I,W):n;return Ve===n?Wp(I,W,n,pe):!!Ve}function Qe(I){if(!Ai(I))return!1;var W=yl(I);return W==ji||W==cr||typeof I.message=="string"&&typeof I.name=="string"&&!fn(I)}function at(I){return typeof I=="number"&&A0(I)}function nt(I){if(!kt(I))return!1;var W=yl(I);return W==nn||W==pr||W==rr||W==Nt}function it(I){return typeof I=="number"&&I==Us(I)}function wt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=Je}function kt(I){var W=typeof I;return I!=null&&(W=="object"||W=="function")}function Ai(I){return I!=null&&typeof I=="object"}var ki=ao?Gt(ao):Kf;function Ri(I,W){return I===W||vf(I,W,$m(W))}function Sr(I,W,pe){return pe=typeof pe=="function"?pe:n,vf(I,W,$m(W),pe)}function hr(I){return Rn(I)&&I!=+I}function wr(I){if(Zp(I))throw new As(d);return Mu(I)}function Jr(I){return I===null}function yn(I){return I==null}function Rn(I){return typeof I=="number"||Ai(I)&&yl(I)==ni}function fn(I){if(!Ai(I)||yl(I)!=Lt)return!1;var W=Jc(I);if(W===null)return!0;var pe=To.call(W,"constructor")&&W.constructor;return typeof pe=="function"&&pe instanceof pe&&Io.call(pe)==Tl}var ms=Dl?Gt(Dl):P0;function hs(I){return it(I)&&I>=-Je&&I<=Je}var Is=xu?Gt(xu):O0;function jn(I){return typeof I=="string"||!D(I)&&Ai(I)&&yl(I)==St}function us(I){return typeof I=="symbol"||Ai(I)&&yl(I)==Ht}var oa=af?Gt(af):dh;function Ea(I){return I===n}function ka(I){return Ai(I)&&Kl(I)==tr}function Mh(I){return Ai(I)&&yl(I)==kr}var da=rh(Ju),Ol=rh(function(I,W){return I<=W});function Co(I){if(!I)return[];if(H(I))return jn(I)?$a(I):sc(I);if(cf&&I[cf])return el(I[cf]());var W=Kl(I),pe=W==Ue?Mo:W==pi?ea:by;return pe(I)}function Os(I){if(!I)return I===0?I:0;if(I=pa(I),I===Dt||I===-Dt){var W=I<0?-1:1;return W*dt}return I===I?I:0}function Us(I){var W=Os(I),pe=W%1;return W===W?pe?W-pe:W:0}function tl(I){return I?gp(Us(I),0,Vt):0}function pa(I){if(typeof I=="number")return I;if(us(I))return ui;if(kt(I)){var W=typeof I.valueOf=="function"?I.valueOf():I;I=kt(W)?W+"":W}if(typeof I!="string")return I===0?I:+I;I=Bi(I);var pe=Qr.test(I);return pe||ii.test(I)?hc(I.slice(2),pe?2:8):ln.test(I)?ui:+I}function Ih(I){return Wc(I,cd(I))}function nh(I){return I?gp(Us(I),-Je,Je):I===0?I:0}function va(I){return I==null?"":Lu(I)}var ou=rd(function(I,W){if(Zd(W)||H(W)){Wc(W,Fu(W),I);return}for(var pe in W)To.call(W,pe)&&gf(I,pe,W[pe])}),Lh=rd(function(I,W){Wc(W,cd(W),I)}),Rl=rd(function(I,W,pe,Ve){Wc(W,cd(W),I,Ve)}),t0=rd(function(I,W,pe,Ve){Wc(W,Fu(W),I,Ve)}),Gm=tu(Up);function kf(I,W){var pe=Gf(I);return W==null?pe:jy(pe,W)}var _y=Wi(function(I,W){I=Fn(I);var pe=-1,Ve=W.length,gt=Ve>2?W[2]:n;for(gt&&Ql(W[0],W[1],gt)&&(Ve=1);++pe<Ve;)for(var Qt=W[pe],Ii=cd(Qt),Gi=-1,br=Ii.length;++Gi<br;){var gn=Ii[Gi],_n=I[gn];(_n===n||ld(_n,ta[gn])&&!To.call(I,gn))&&(I[gn]=Qt[gn])}return I}),ip=Wi(function(I){return I.push(n,om),kn(Cv,n,I)});function qm(I,W){return Sl(I,Gn(W,3),gl)}function L_(I,W){return Sl(I,Gn(W,3),ny)}function D_(I,W){return I==null?I:Eu(I,Gn(W,3),cd)}function i0(I,W){return I==null?I:Zf(I,Gn(W,3),cd)}function P_(I,W){return I&&gl(I,Gn(W,3))}function gx(I,W){return I&&ny(I,Gn(W,3))}function Ym(I){return I==null?[]:Ed(I,Fu(I))}function O_(I){return I==null?[]:Ed(I,cd(I))}function Sv(I,W,pe){var Ve=I==null?n:ku(I,W);return Ve===n?pe:Ve}function yw(I,W){return I!=null&&Xp(I,W,Au)}function yx(I,W){return I!=null&&Xp(I,W,Vp)}var r0=Eg(function(I,W,pe){W!=null&&typeof W.toString!="function"&&(W=mr.call(W)),I[W]=pe},q0(Nc)),Tv=Eg(function(I,W,pe){W!=null&&typeof W.toString!="function"&&(W=mr.call(W)),To.call(I,W)?I[W].push(pe):I[W]=[pe]},Gn),Cb=Wi(mu);function Fu(I){return H(I)?Im(I):Om(I)}function cd(I){return H(I)?Im(I,!0):$h(I)}function V0(I,W){var pe={};return W=Gn(W,3),gl(I,function(Ve,gt,Qt){Tu(pe,W(Ve,gt,Qt),Ve)}),pe}function R_(I,W){var pe={};return W=Gn(W,3),gl(I,function(Ve,gt,Qt){Tu(pe,gt,W(Ve,gt,Qt))}),pe}var W0=rd(function(I,W,pe){jp(I,W,pe)}),Cv=rd(function(I,W,pe,Ve){jp(I,W,pe,Ve)}),_x=tu(function(I,W){var pe={};if(I==null)return pe;var Ve=!1;W=os(W,function(Qt){return Qt=eu(Qt,I),Ve||(Ve=Qt.length>1),Qt}),Wc(I,am(I),pe),Ve&&(pe=Cu(pe,F|G|q,Sa));for(var gt=W.length;gt--;)ed(pe,W[gt]);return pe});function vy(I,W){return xx(I,Fg(Gn(W)))}var vx=tu(function(I,W){return I==null?{}:Rm(I,W)});function xx(I,W){if(I==null)return{};var pe=os(am(I),function(Ve){return[Ve]});return W=Gn(W),Iu(I,pe,function(Ve,gt){return W(Ve,gt[0])})}function bx(I,W,pe){W=eu(W,I);var Ve=-1,gt=W.length;for(gt||(gt=1,I=n);++Ve<gt;){var Qt=I==null?n:I[Z(W[Ve])];Qt===n&&(Ve=gt,Qt=pe),I=nt(Qt)?Qt.call(I):Qt}return I}function zu(I,W,pe){return I==null?I:ha(I,W,pe)}function wx(I,W,pe,Ve){return Ve=typeof Ve=="function"?Ve:n,I==null?I:ha(I,W,pe,Ve)}var n0=zm(Fu),xy=zm(cd);function Sx(I,W,pe){var Ve=D(I),gt=Ve||ae(I)||oa(I);if(W=Gn(W,4),pe==null){var Qt=I&&I.constructor;gt?pe=Ve?new Qt:[]:kt(I)?pe=nt(Qt)?Gf(Jc(I)):{}:pe={}}return(gt?ic:gl)(I,function(Ii,Gi,br){return W(pe,Ii,Gi,br)}),pe}function j0(I,W){return I==null?!0:ed(I,W)}function _w(I,W,pe){return I==null?I:nc(I,W,Rc(pe))}function vw(I,W,pe,Ve){return Ve=typeof Ve=="function"?Ve:n,I==null?I:nc(I,W,Rc(pe),Ve)}function by(I){return I==null?[]:qr(I,Fu(I))}function Tx(I){return I==null?[]:qr(I,cd(I))}function hd(I,W,pe){return pe===n&&(pe=W,W=n),pe!==n&&(pe=pa(pe),pe=pe===pe?pe:0),W!==n&&(W=pa(W),W=W===W?W:0),gp(pa(I),W,pe)}function Xm(I,W,pe){return W=Os(W),pe===n?(pe=W,W=0):pe=Os(pe),I=pa(I),mn(I,W,pe)}function ud(I,W,pe){if(pe&&typeof pe!="boolean"&&Ql(I,W,pe)&&(W=pe=n),pe===n&&(typeof W=="boolean"?(pe=W,W=n):typeof I=="boolean"&&(pe=I,I=n)),I===n&&W===n?(I=0,W=1):(I=Os(I),W===n?(W=I,I=0):W=Os(W)),I>W){var Ve=I;I=W,W=Ve}if(pe||I%1||W%1){var gt=fo();return eh(I+gt*(W-I+up("1e-"+((gt+"").length-1))),W)}return Sg(I,W)}var s0=ih(function(I,W,pe){return W=W.toLowerCase(),I+(pe?o0(W):W)});function o0(I){return Iv(va(I).toLowerCase())}function H0(I){return I=va(I),I&&I.replace(Xr,Pn).replace(pu,"")}function N_(I,W,pe){I=va(I),W=Lu(W);var Ve=I.length;pe=pe===n?Ve:gp(Us(pe),0,Ve);var gt=pe;return pe-=W.length,pe>=0&&I.slice(pe,gt)==W}function wy(I){return I=va(I),I&&hl.test(I)?I.replace(ja,as):I}function B_(I){return I=va(I),I&&Fe.test(I)?I.replace(Ge,"\\$&"):I}var xw=ih(function(I,W,pe){return I+(pe?"-":"")+W.toLowerCase()}),Zm=ih(function(I,W,pe){return I+(pe?" ":"")+W.toLowerCase()}),Eb=Wh("toLowerCase");function G0(I,W,pe){I=va(I),W=Us(W);var Ve=W?$l(I):0;if(!W||Ve>=W)return I;var gt=(W-Ve)/2;return Dd(Wf(gt),pe)+I+Dd(hf(gt),pe)}function Ev(I,W,pe){I=va(I),W=Us(W);var Ve=W?$l(I):0;return W&&Ve<W?I+Dd(W-Ve,pe):I}function bw(I,W,pe){I=va(I),W=Us(W);var Ve=W?$l(I):0;return W&&Ve<W?Dd(W-Ve,pe)+I:I}function kb(I,W,pe){return pe||W==null?W=0:W&&(W=+W),uf(va(I).replace(rt,""),W||0)}function F_(I,W,pe){return(pe?Ql(I,W,pe):W===n)?W=1:W=Us(W),Md(va(I),W)}function kv(){var I=arguments,W=va(I[0]);return I.length<3?W:W.replace(I[1],I[2])}var Cx=ih(function(I,W,pe){return I+(pe?"_":"")+W.toLowerCase()});function Ab(I,W,pe){return pe&&typeof pe!="number"&&Ql(I,W,pe)&&(W=pe=n),pe=pe===n?Vt:pe>>>0,pe?(I=va(I),I&&(typeof W=="string"||W!=null&&!ms(W))&&(W=Lu(W),!W&&ro(I))?Hd($a(I),0,pe):I.split(W,pe)):[]}var Sy=ih(function(I,W,pe){return I+(pe?" ":"")+Iv(W)});function Mb(I,W,pe){return I=va(I),pe=pe==null?0:gp(Us(pe),0,I.length),W=Lu(W),I.slice(pe,pe+W.length)==W}function Ib(I,W,pe){var Ve=zt.templateSettings;pe&&Ql(I,W,pe)&&(W=n),I=va(I),W=Rl({},W,Ve,Pu);var gt=Rl({},W.imports,Ve.imports,Pu),Qt=Fu(gt),Ii=qr(gt,Qt),Gi,br,gn=0,_n=W.interpolate||tn,Cn="__p += '",_s=fs((W.escape||tn).source+"|"+_n.source+"|"+(_n===Sh?Fi:tn).source+"|"+(W.evaluate||tn).source+"|$","g"),Gs="//# sourceURL="+(To.call(W,"sourceURL")?(W.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++mh+"]")+`
`;I.replace(_s,function(zo,al,Xa,Tp,sp,ef){return Xa||(Xa=Tp),Cn+=I.slice(gn,ef).replace(Jn,Yo),al&&(Gi=!0,Cn+=`' +
__e(`+al+`) +
'`),sp&&(br=!0,Cn+=`';
`+sp+`;
__p += '`),Xa&&(Cn+=`' +
((__t = (`+Xa+`)) == null ? '' : __t) +
'`),gn=ef+zo.length,zo}),Cn+=`';
`;var Lo=To.call(W,"variable")&&W.variable;if(!Lo)Cn=`with (obj) {
`+Cn+`
}
`;else if(ai.test(Lo))throw new As(i);Cn=(br?Cn.replace(zn,""):Cn).replace(za,"$1").replace($o,"$1;"),Cn="function("+(Lo||"obj")+`) {
`+(Lo?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Gi?", __e = _.escape":"")+(br?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Cn+`return __p
}`;var Ba=Ex(function(){return Xo(Qt,Gs+"return "+Cn).apply(n,Ii)});if(Ba.source=Cn,Qe(Ba))throw Ba;return Ba}function a0(I){return va(I).toLowerCase()}function Lb(I){return va(I).toUpperCase()}function Ty(I,W,pe){if(I=va(I),I&&(pe||W===n))return Bi(I);if(!I||!(W=Lu(W)))return I;var Ve=$a(I),gt=$a(W),Qt=Qi(Ve,gt),Ii=sn(Ve,gt)+1;return Hd(Ve,Qt,Ii).join("")}function Db(I,W,pe){if(I=va(I),I&&(pe||W===n))return I.slice(0,Vl(I)+1);if(!I||!(W=Lu(W)))return I;var Ve=$a(I),gt=sn(Ve,$a(W))+1;return Hd(Ve,0,gt).join("")}function Av(I,W,pe){if(I=va(I),I&&(pe||W===n))return I.replace(rt,"");if(!I||!(W=Lu(W)))return I;var Ve=$a(I),gt=Qi(Ve,$a(W));return Hd(Ve,gt).join("")}function Pb(I,W){var pe=Pt,Ve=At;if(kt(W)){var gt="separator"in W?W.separator:gt;pe="length"in W?Us(W.length):pe,Ve="omission"in W?Lu(W.omission):Ve}I=va(I);var Qt=I.length;if(ro(I)){var Ii=$a(I);Qt=Ii.length}if(pe>=Qt)return I;var Gi=pe-$l(Ve);if(Gi<1)return Ve;var br=Ii?Hd(Ii,0,Gi).join(""):I.slice(0,Gi);if(gt===n)return br+Ve;if(Ii&&(Gi+=br.length-Gi),ms(gt)){if(I.slice(Gi).search(gt)){var gn,_n=br;for(gt.global||(gt=fs(gt.source,va(Pr.exec(gt))+"g")),gt.lastIndex=0;gn=gt.exec(_n);)var Cn=gn.index;br=br.slice(0,Cn===n?Gi:Cn)}}else if(I.indexOf(Lu(gt),Gi)!=Gi){var _s=br.lastIndexOf(gt);_s>-1&&(br=br.slice(0,_s))}return br+Ve}function Mv(I){return I=va(I),I&&Yn.test(I)?I.replace(Aa,dl):I}var ww=ih(function(I,W,pe){return I+(pe?" ":"")+W.toUpperCase()}),Iv=Wh("toUpperCase");function l0(I,W,pe){return I=va(I),W=pe?n:W,W===n?Ao(I)?Dc(I):Hu(I):I.match(W)||[]}var Ex=Wi(function(I,W){try{return kn(I,n,W)}catch(pe){return Qe(pe)?pe:new As(pe)}}),Ob=tu(function(I,W){return ic(W,function(pe){pe=Z(pe),Tu(I,pe,Xy(I[pe],I))}),I});function Sw(I){var W=I==null?0:I.length,pe=Gn();return I=W?os(I,function(Ve){if(typeof Ve[1]!="function")throw new Ms(f);return[pe(Ve[0]),Ve[1]]}):[],Wi(function(Ve){for(var gt=-1;++gt<W;){var Qt=I[gt];if(kn(Qt[0],this,Ve))return kn(Qt[1],this,Ve)}})}function Tw(I){return Cd(Cu(I,F))}function q0(I){return function(){return I}}function Y0(I,W){return I==null||I!==I?W:I}var Af=Ac(),dm=Ac(!0);function Nc(I){return I}function rp(I){return Uh(typeof I=="function"?I:Cu(I,F))}function kx(I){return Cl(Cu(I,F))}function Lv(I,W){return Wd(I,Cu(W,F))}var Cw=Wi(function(I,W){return function(pe){return mu(pe,I,W)}}),X0=Wi(function(I,W){return function(pe){return mu(I,pe,W)}});function Km(I,W,pe){var Ve=Fu(W),gt=Ed(W,Ve);pe==null&&!(kt(W)&&(gt.length||!Ve.length))&&(pe=W,W=I,I=this,gt=Ed(W,Fu(W)));var Qt=!(kt(pe)&&"chain"in pe)||!!pe.chain,Ii=nt(I);return ic(gt,function(Gi){var br=W[Gi];I[Gi]=br,Ii&&(I.prototype[Gi]=function(){var gn=this.__chain__;if(Qt||gn){var _n=I(this.__wrapped__),Cn=_n.__actions__=sc(this.__actions__);return Cn.push({func:br,args:arguments,thisArg:I}),_n.__chain__=gn,_n}return br.apply(I,Zs([this.value()],arguments))})}),I}function sh(){return Ll._===this&&(Ll._=Vo),this}function Qm(){}function Jm(I){return I=Us(I),Wi(function(W){return jd(W,I)})}var Z0=Ld(os),np=Ld(Qa),Rb=Ld(Ks);function z_(I){return Yd(I)?vt(Z(I)):R0(I)}function K0(I){return function(W){return I==null?n:ku(I,W)}}var Nb=nm(),U_=nm(!0);function Ax(){return[]}function Jp(){return!1}function Mx(){return{}}function Dv(){return""}function Ix(){return!0}function Pv(I,W){if(I=Us(I),I<1||I>Je)return[];var pe=Vt,Ve=eh(I,Vt);W=Gn(W),I-=Vt;for(var gt=Li(Ve,W);++pe<I;)W(pe);return gt}function Ew(I){return D(I)?os(I,Z):us(I)?[I]:sc($(va(I)))}function zg(I){var W=++fl;return va(I)+W}var Bb=Gp(function(I,W){return I+W},0),c0=Pd("ceil"),Ug=Gp(function(I,W){return I/W},1),Lx=Pd("floor");function Dx(I){return I&&I.length?yp(I,Nc,_f):n}function Px(I,W){return I&&I.length?yp(I,Gn(W,2),_f):n}function Ov(I){return hh(I,Nc)}function Ox(I,W){return hh(I,Gn(W,2))}function Fb(I){return I&&I.length?yp(I,Nc,Ju):n}function zb(I,W){return I&&I.length?yp(I,Gn(W,2),Ju):n}var Ub=Gp(function(I,W){return I*W},1),$b=Pd("round"),kw=Gp(function(I,W){return I-W},0);function Aw(I){return I&&I.length?bi(I,Nc):0}function Rx(I,W){return I&&I.length?bi(I,Gn(W,2)):0}return zt.after=Kp,zt.ary=Qp,zt.assign=ou,zt.assignIn=Lh,zt.assignInWith=Rl,zt.assignWith=t0,zt.at=Gm,zt.before=z0,zt.bind=Xy,zt.bindAll=Ob,zt.bindKey=Zy,zt.castArray=I_,zt.chain=nu,zt.chunk=ge,zt.compact=Ce,zt.concat=$e,zt.cond=Sw,zt.conforms=Tw,zt.constant=q0,zt.countBy=um,zt.create=kf,zt.curry=my,zt.curryRight=gy,zt.debounce=yy,zt.defaults=_y,zt.defaultsDeep=ip,zt.defer=A_,zt.delay=U0,zt.difference=Ne,zt.differenceBy=We,zt.differenceWith=Xe,zt.drop=et,zt.dropRight=_t,zt.dropRightWhile=Ct,zt.dropWhile=jt,zt.fill=Ft,zt.filter=jm,zt.flatMap=N0,zt.flatMapDeep=Og,zt.flatMapDepth=B0,zt.flatten=Wt,zt.flattenDeep=qt,zt.flattenDepth=Ei,zt.flip=Ky,zt.flow=Af,zt.flowRight=dm,zt.fromPairs=Mi,zt.functions=Ym,zt.functionsIn=O_,zt.groupBy=hv,zt.initial=Er,zt.intersection=Ti,zt.intersectionBy=$i,zt.intersectionWith=li,zt.invert=r0,zt.invertBy=Tv,zt.invokeMap=uv,zt.iteratee=rp,zt.keyBy=Rg,zt.keys=Fu,zt.keysIn=cd,zt.map=py,zt.mapKeys=V0,zt.mapValues=R_,zt.matches=kx,zt.matchesProperty=Lv,zt.memoize=Bg,zt.merge=W0,zt.mergeWith=Cv,zt.method=Cw,zt.methodOf=X0,zt.mixin=Km,zt.negate=Fg,zt.nthArg=Jm,zt.omit=_x,zt.omitBy=vy,zt.once=mv,zt.orderBy=Hh,zt.over=Z0,zt.overArgs=Ef,zt.overEvery=np,zt.overSome=Rb,zt.partial=Qy,zt.partialRight=Jy,zt.partition=Ng,zt.pick=vx,zt.pickBy=xx,zt.property=z_,zt.propertyOf=K0,zt.pull=ar,zt.pullAll=Br,zt.pullAllBy=dn,zt.pullAllWith=pn,zt.pullAt=on,zt.range=Nb,zt.rangeRight=U_,zt.rearg=gv,zt.reject=Yy,zt.remove=bn,zt.rest=$0,zt.reverse=An,zt.sampleSize=k_,zt.set=zu,zt.setWith=wx,zt.shuffle=fy,zt.slice=Vn,zt.sortBy=fx,zt.sortedUniq=sl,zt.sortedUniqBy=ls,zt.split=Ab,zt.spread=yv,zt.tail=cs,zt.take=Ts,zt.takeRight=_a,zt.takeRightWhile=Jl,zt.takeWhile=Zo,zt.tap=su,zt.throttle=mx,zt.thru=Qd,zt.toArray=Co,zt.toPairs=n0,zt.toPairsIn=xy,zt.toPath=Ew,zt.toPlainObject=Ih,zt.transform=Sx,zt.unary=M_,zt.union=Wo,zt.unionBy=ol,zt.unionWith=Ws,zt.uniq=ec,zt.uniqBy=Ta,zt.uniqWith=Ca,zt.unset=j0,zt.unzip=Ko,zt.unzipWith=bo,zt.update=_w,zt.updateWith=vw,zt.values=by,zt.valuesIn=Tx,zt.without=Ya,zt.words=l0,zt.wrap=_v,zt.xor=_h,zt.xorBy=ua,zt.xorWith=Fo,zt.zip=ru,zt.zipObject=Ah,zt.zipObjectDeep=od,zt.zipWith=Od,zt.entries=n0,zt.entriesIn=xy,zt.extend=Lh,zt.extendWith=Rl,Km(zt,zt),zt.add=Bb,zt.attempt=Ex,zt.camelCase=s0,zt.capitalize=o0,zt.ceil=c0,zt.clamp=hd,zt.clone=vv,zt.cloneDeep=xv,zt.cloneDeepWith=bv,zt.cloneWith=e0,zt.conformsTo=wv,zt.deburr=H0,zt.defaultTo=Y0,zt.divide=Ug,zt.endsWith=N_,zt.eq=ld,zt.escape=wy,zt.escapeRegExp=B_,zt.every=ep,zt.find=Sp,zt.findIndex=Rt,zt.findKey=qm,zt.findLast=tp,zt.findLastIndex=Et,zt.findLastKey=L_,zt.floor=Lx,zt.forEach=Gy,zt.forEachRight=qy,zt.forIn=D_,zt.forInRight=i0,zt.forOwn=P_,zt.forOwnRight=gx,zt.get=Sv,zt.gt=ve,zt.gte=v,zt.has=yw,zt.hasIn=yx,zt.head=Ki,zt.identity=Nc,zt.includes=F0,zt.indexOf=Ji,zt.inRange=Xm,zt.invoke=Cb,zt.isArguments=k,zt.isArray=D,zt.isArrayBuffer=V,zt.isArrayLike=H,zt.isArrayLikeObject=Y,zt.isBoolean=J,zt.isBuffer=ae,zt.isDate=_e,zt.isElement=Me,zt.isEmpty=xe,zt.isEqual=Pe,zt.isEqualWith=je,zt.isError=Qe,zt.isFinite=at,zt.isFunction=nt,zt.isInteger=it,zt.isLength=wt,zt.isMap=ki,zt.isMatch=Ri,zt.isMatchWith=Sr,zt.isNaN=hr,zt.isNative=wr,zt.isNil=yn,zt.isNull=Jr,zt.isNumber=Rn,zt.isObject=kt,zt.isObjectLike=Ai,zt.isPlainObject=fn,zt.isRegExp=ms,zt.isSafeInteger=hs,zt.isSet=Is,zt.isString=jn,zt.isSymbol=us,zt.isTypedArray=oa,zt.isUndefined=Ea,zt.isWeakMap=ka,zt.isWeakSet=Mh,zt.join=dr,zt.kebabCase=xw,zt.last=Ni,zt.lastIndexOf=vr,zt.lowerCase=Zm,zt.lowerFirst=Eb,zt.lt=da,zt.lte=Ol,zt.max=Dx,zt.maxBy=Px,zt.mean=Ov,zt.meanBy=Ox,zt.min=Fb,zt.minBy=zb,zt.stubArray=Ax,zt.stubFalse=Jp,zt.stubObject=Mx,zt.stubString=Dv,zt.stubTrue=Ix,zt.multiply=Ub,zt.nth=Nr,zt.noConflict=sh,zt.noop=Qm,zt.now=Hm,zt.pad=G0,zt.padEnd=Ev,zt.padStart=bw,zt.parseInt=kb,zt.random=ud,zt.reduce=dv,zt.reduceRight=pv,zt.repeat=F_,zt.replace=kv,zt.result=bx,zt.round=$b,zt.runInContext=or,zt.sample=E_,zt.size=px,zt.snakeCase=Cx,zt.some=fv,zt.sortedIndex=Zn,zt.sortedIndexBy=ys,zt.sortedIndexOf=Bo,zt.sortedLastIndex=Da,zt.sortedLastIndexBy=xo,zt.sortedLastIndexOf=ia,zt.startCase=Sy,zt.startsWith=Mb,zt.subtract=kw,zt.sum=Aw,zt.sumBy=Rx,zt.template=Ib,zt.times=Pv,zt.toFinite=Os,zt.toInteger=Us,zt.toLength=tl,zt.toLower=a0,zt.toNumber=pa,zt.toSafeInteger=nh,zt.toString=va,zt.toUpper=Lb,zt.trim=Ty,zt.trimEnd=Db,zt.trimStart=Av,zt.truncate=Pb,zt.unescape=Mv,zt.uniqueId=zg,zt.upperCase=ww,zt.upperFirst=Iv,zt.each=Gy,zt.eachRight=qy,zt.first=Ki,Km(zt,function(){var I={};return gl(zt,function(W,pe){To.call(zt.prototype,pe)||(I[pe]=W)}),I}(),{chain:!1}),zt.VERSION=s,ic(["bind","bindKey","curry","curryRight","partial","partialRight"],function(I){zt[I].placeholder=zt}),ic(["drop","take"],function(I,W){wa.prototype[I]=function(pe){pe=pe===n?1:Ro(Us(pe),0);var Ve=this.__filtered__&&!W?new wa(this):this.clone();return Ve.__filtered__?Ve.__takeCount__=eh(pe,Ve.__takeCount__):Ve.__views__.push({size:eh(pe,Vt),type:I+(Ve.__dir__<0?"Right":"")}),Ve},wa.prototype[I+"Right"]=function(pe){return this.reverse()[I](pe).reverse()}}),ic(["filter","map","takeWhile"],function(I,W){var pe=W+1,Ve=pe==Ae||pe==bt;wa.prototype[I]=function(gt){var Qt=this.clone();return Qt.__iteratees__.push({iteratee:Gn(gt,3),type:pe}),Qt.__filtered__=Qt.__filtered__||Ve,Qt}}),ic(["head","last"],function(I,W){var pe="take"+(W?"Right":"");wa.prototype[I]=function(){return this[pe](1).value()[0]}}),ic(["initial","tail"],function(I,W){var pe="drop"+(W?"":"Right");wa.prototype[I]=function(){return this.__filtered__?new wa(this):this[pe](1)}}),wa.prototype.compact=function(){return this.filter(Nc)},wa.prototype.find=function(I){return this.filter(I).head()},wa.prototype.findLast=function(I){return this.reverse().find(I)},wa.prototype.invokeMap=Wi(function(I,W){return typeof I=="function"?new wa(this):this.map(function(pe){return mu(pe,I,W)})}),wa.prototype.reject=function(I){return this.filter(Fg(Gn(I)))},wa.prototype.slice=function(I,W){I=Us(I);var pe=this;return pe.__filtered__&&(I>0||W<0)?new wa(pe):(I<0?pe=pe.takeRight(-I):I&&(pe=pe.drop(I)),W!==n&&(W=Us(W),pe=W<0?pe.dropRight(-W):pe.take(W-I)),pe)},wa.prototype.takeRightWhile=function(I){return this.reverse().takeWhile(I).reverse()},wa.prototype.toArray=function(){return this.take(Vt)},gl(wa.prototype,function(I,W){var pe=/^(?:filter|find|map|reject)|While$/.test(W),Ve=/^(?:head|last)$/.test(W),gt=zt[Ve?"take"+(W=="last"?"Right":""):W],Qt=Ve||/^find/.test(W);gt&&(zt.prototype[W]=function(){var Ii=this.__wrapped__,Gi=Ve?[1]:arguments,br=Ii instanceof wa,gn=Gi[0],_n=br||D(Ii),Cn=function(al){var Xa=gt.apply(zt,Zs([al],Gi));return Ve&&_s?Xa[0]:Xa};_n&&pe&&typeof gn=="function"&&gn.length!=1&&(br=_n=!1);var _s=this.__chain__,Gs=!!this.__actions__.length,Lo=Qt&&!_s,Ba=br&&!Gs;if(!Qt&&_n){Ii=Ba?Ii:new wa(this);var zo=I.apply(Ii,Gi);return zo.__actions__.push({func:Qd,args:[Cn],thisArg:n}),new Su(zo,_s)}return Lo&&Ba?I.apply(this,Gi):(zo=this.thru(Cn),Lo?Ve?zo.value()[0]:zo.value():zo)})}),ic(["pop","push","shift","sort","splice","unshift"],function(I){var W=ho[I],pe=/^(?:push|sort|unshift)$/.test(I)?"tap":"thru",Ve=/^(?:pop|shift)$/.test(I);zt.prototype[I]=function(){var gt=arguments;if(Ve&&!this.__chain__){var Qt=this.value();return W.apply(D(Qt)?Qt:[],gt)}return this[pe](function(Ii){return W.apply(D(Ii)?Ii:[],gt)})}}),gl(wa.prototype,function(I,W){var pe=zt[W];if(pe){var Ve=pe.name+"";To.call(wd,Ve)||(wd[Ve]=[]),wd[Ve].push({name:W,func:pe})}}),wd[qd(n,fe).name]=[{name:"wrapper",func:n}],wa.prototype.clone=Xu,wa.prototype.reverse=Jg,wa.prototype.value=pf,zt.prototype.at=ad,zt.prototype.chain=Jd,zt.prototype.commit=cm,zt.prototype.next=hy,zt.prototype.plant=uy,zt.prototype.reverse=Pg,zt.prototype.toJSON=zt.prototype.valueOf=zt.prototype.value=dy,zt.prototype.first=zt.prototype.head,cf&&(zt.prototype[cf]=hm),zt},Zc=Pc();Bh?((Bh.exports=Zc)._=Zc,vd._=Zc):Ll._=Zc}).call(og)})(l2,l2.exports);var yoe=l2.exports;const pN=w_(yoe),mk=({chartOptions:e})=>{const[t,n]=It({}),s=(window==null?void 0:window.chartStylingObj)??{};Ar(()=>{console.debug("krypton-chart-library-cx -> chartOptions:",e);const d={...e,credits:{enabled:!1}};n(d)},[e]),Ar(()=>{console.debug("krypton-chart-library-cx -> finalChartOptions:",t)},[t]);const a=!pN.isEmpty(s)&&!pN.isEmpty(t);return B.createElement("div",{className:"chart-container",style:{backgroundColor:s.containerBgColor||"#ffffff"}},a?B.createElement(_$,{highcharts:w1,options:t}):B.createElement("div",{className:"loading-text"},"Loading..."))},_oe=({serviceId:e,customerAccountNo:t,redirectFrom:n,onAssociatedTicket:s,uptimeData:a,setUptimeData:d,uptimeSelectedPeriod:f,setUptimeSelectedPeriod:i,uptimeSelectedMonth:S,setUptimeSelectedMonth:E,uptimeSelectedQuarter:L,setUptimeSelectedQuarter:F,uptimeSelectedYear:G,setUptimeSelectedYear:q,committedUptime:Q,setCommittedUptime:te,uptimeChartOptions:he,setUptimeChartOptions:fe,serviceStartDate:le,uptimeSelectedQuarterMonthYear:Se,setUptimeSelectedQuarterMonthYear:ke,setUptimeCommittedFrequencyPeriod:Ee,uptimeCommittedFrequencyPeriod:Ie,isNetworkService:He=!0})=>{const[Ye,lt]=It(!a),[Pt,At]=It(""),[ht,Ot]=It({}),Ae=wo(null),mt=wo(null),bt=wo(null),Dt=wo(null),Je=Zt=>{var Kt;if(i(Zt.target.value),le&&le!==""){const Ui=((Kt=Dt.current)==null?void 0:Kt.value)||G,rr=Dr().getDefaultMonth(Number(Ui),le);E(rr);const gi=Dr().getQuarterFromMonth(Dr().getMonthIndex(rr));F(gi)}d([])},dt=Zt=>{E(Zt.target.value),d([])},ui=Zt=>{F(Zt.target.value),d([])},Vt=Zt=>{if(q(Zt.target.value),ke(Zt.target.value),le&&le!==""){const Kt=Dr().getDefaultMonth(Number(Zt.target.value),le);E(Kt);const Ui=Dr().getQuarterFromMonth(Dr().getMonthIndex(Kt));F(Ui)}d([])};uu(Ae,Zt=>Je(Zt),[le]),uu(bt,Zt=>dt(Zt),[le,f,G]),uu(mt,Zt=>ui(Zt),[le,f,G]),uu(Dt,Zt=>Vt(Zt),[le,f,S,L]),Ar(()=>{bt.current&&S&&AUI.$(bt.current).val(S).trigger("change.select2")},[S]),Ar(()=>{mt.current&&L&&AUI.$(mt.current).val(L).trigger("change.select2")},[L]),Ar(()=>{const Zt=async()=>{var Kt,Ui,rr,gi,Oi,cr,ji;if(f){lt(!0);try{let nn=f.toLowerCase();f==="Monthly"&&(nn=S),f==="Quarterly"&&(nn=L),f==="Yearly"&&(nn=G);const{fromDate:pr,toDate:Ue}=fa().getDateRangeFromFilter(nn,G),ni=await R1(e,f==null?void 0:f.toLowerCase(),t,fa().formatSLADate(pr),fa().formatSLADate(Ue),"uptime");if(console.log("response from getServiceSLADetails::",ni),ni&&(ni!=null&&ni.data)&&((Kt=ni==null?void 0:ni.data)==null?void 0:Kt.statusCode)==200){const fi=JSON.parse((Ui=ni==null?void 0:ni.data)==null?void 0:Ui.data);Ot(fi);const Lt=((gi=(rr=fi==null?void 0:fi.serviceDetail)==null?void 0:rr.serviceUptime)==null?void 0:gi.committedUptime)||"0.00";let pt=((cr=(Oi=fi==null?void 0:fi.serviceDetail)==null?void 0:Oi.serviceUptime)==null?void 0:cr.data.map(Nt=>({name:new Date(Nt.startDate).toLocaleString("default",{month:"long"}),y:Number(Nt.achievedUptime)>0?Number(Nt.achievedUptime):null})))||[];d(pt),te(Lt),s((ji=fi==null?void 0:fi.serviceDetail)==null?void 0:ji.associatedTickets)}else console.log("inside else condition"),d([]),te(0),s([])}catch(nn){console.error("Error fetching SLA details:",nn),At(n=="servicePerformance"?"Service performance data unavailable. Please refresh":"Data not available. Please try again later")}finally{lt(!1)}}};He&&t&&e&&(a==null?void 0:a.length)==0&&Zt()},[e,f,S,L,G,a==null?void 0:a.length]);function ei(Zt){var Kt,Ui;try{const rr=((Ui=(Kt=Zt==null?void 0:Zt.serviceDetail)==null?void 0:Kt.serviceUptime)==null?void 0:Ui.data)||[];if(!Array.isArray(rr)||rr.length===0)return[];const gi=rr.map(cr=>{if(!(cr!=null&&cr.startDate))return null;const ji=new Date(cr.startDate);return isNaN(ji)?null:`${ji.getDate().toString().padStart(2,"0")}-${ji.toLocaleString("default",{month:"short"})}-${ji.getFullYear()}`}).filter(Boolean);return[...new Set(gi)].sort((cr,ji)=>{const nn=new Date(cr.split("-").reverse().join("-")),pr=new Date(ji.split("-").reverse().join("-"));return nn-pr})}catch(rr){return console.error("Error generating chart x-axis dates:",rr),[]}}Ar(()=>{var ji,nn,pr,Ue,ni,fi;console.debug("uptimeData -------- ",a);const Zt=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling :",Zt);let Kt=[];const Ui=Dr().months,rr=Dr().currentYear,gi=new Date().getMonth();if(f==="Yearly"){const Lt=new Date(le),pt=Lt.getFullYear(),Nt=Lt.getMonth();G==rr?pt==rr?Kt=Ui.slice(Nt,gi+1):Kt=Ui.slice(0,gi+1):pt==G?Kt=Ui.slice(Nt):Kt=Ui.slice()}else if(f==="Monthly")Kt=Dr().generateWeeksForMonth(Dr().months.indexOf(S),G||Dr().currentYear,le),console.debug("xAxisCategories for Monthly :: ",Kt);else if(f==="Weekly"){if(ht&&((pr=(nn=(ji=ht==null?void 0:ht.serviceDetail)==null?void 0:ji.serviceUptime)==null?void 0:nn.data)==null?void 0:pr.length)>0&&((fi=(ni=(Ue=ht==null?void 0:ht.serviceDetail)==null?void 0:Ue.serviceUptime)==null?void 0:ni.data)==null?void 0:fi.length)<7)Kt=ei(ht);else if(Kt=Dr().generateLast7Days(),le){const Lt=new Date(le),pt=St=>`${St.getDate()}-${St.toLocaleString("default",{month:"short"})}-${St.getFullYear()}`,Nt=new Date,Si=new Date;if(Si.setDate(Nt.getDate()-6),Lt>=Si&&Lt<=Nt){const St=pt(Lt),Ht=Kt.indexOf(St);Ht!==-1&&(Kt=Kt.slice(Ht))}}console.debug("xAxisCategories for Weekly :: ",Kt)}else f==="Quarterly"?f==="Quarterly"&&(Kt=Dr().getMonthsForQuarter(L)):Kt=Dr().months;console.debug("xAxisCategories in UptimeChart :: ",Kt);let Oi=a&&a.length>0?a:Kt.map(Lt=>({name:Lt,y:null}));const cr=Oi.map(Lt=>({...Lt,color:Lt.y!==null&&Lt.y<Q?"#F04438":"#06B939"}));console.debug("chartData in UptimeChart :: ",Oi),console.debug("coloredChartData in UptimeChart :: ",cr),fe({chart:{type:"column",height:"300",backgroundColor:Zt.bgColor},title:{text:null},xAxis:{categories:Kt,useHTML:!0,lineWidth:2,gridLineColor:Zt.yAxisGridLineColor,lineColor:Zt.xAxisLineColor,labels:{rotation:-45,autoRotation:!1,step:1,crop:!1,overflow:"allow",align:"right",style:{color:Zt.xAxisLabelsStyleColor}}},yAxis:{title:{text:"Actual Service Uptime (%)",style:{color:Zt.yAxisTitleStyleColor}},min:0,max:100,tickPositions:[90,91,92,93,94,95,96,97,98,99,100],lineWidth:2,gridLineColor:Zt.yAxisGridLineColor,lineColor:Zt.yAxisLineColor,labels:{formatter:function(){return`${this.value}`},style:{color:Zt.yAxisLabelsStyleColor}},plotLines:[{dashStyle:"dash",width:2,value:Number(Q),zIndex:5,color:Zt.yAxisPlotLinesStyleColor}]},series:[{name:"Background",data:new Array(Oi.length).fill(100),enableMouseTracking:!1,showInLegend:!1,zIndex:0,color:Zt.seriesBgColor,borderColor:Zt.seriesBgBorderColor},{name:"Uptime",data:cr,borderColor:Zt.seriesDataBorderColor,dataLabels:{enabled:!0,crop:!1,overflow:"allow",allowOverlap:!0,formatter:function(){return this.y!==null?`${this.y}%`:""},style:{color:"#ffffff",fontWeight:"700",textOutline:"none",fontSize:"10px"},inside:!0,verticalAlign:"bottom",align:"center",rotation:-90,y:-10}}],credits:{enabled:!1},plotOptions:{column:{borderRadius:3,grouping:!1,pointPadding:.2,zIndex:1,pointWidth:15,dataLabels:{style:{color:Zt.columnDataLabelsStyleColor}}}},tooltip:{formatter:function(){return`${this.y}%`},backgroundColor:Zt.tooltipBgColor,style:{color:Zt.tooltipStyleColor}},legend:{enabled:!1}})},[a,Q]);const ur=B.createElement("div",{className:"row"},n=="serviceDetails"&&B.createElement("div",{className:"col-12 mb-15"},B.createElement(B.Fragment,null,B.createElement("div",{className:"chart-header"},B.createElement("div",{className:"right-controls"},B.createElement("div",{className:"form-group"},B.createElement("select",{ref:Ae,className:"custom-select",value:f},B.createElement("option",{value:"Monthly"},Liferay.Language.get("krypton-month-chart-filter-title")),B.createElement("option",{value:"Quarterly"},Liferay.Language.get("krypton-quarter-chart-filter-title")),B.createElement("option",{value:"Weekly"},Liferay.Language.get("krypton-weekly-chart-filter-title")),B.createElement("option",{value:"Yearly"},Liferay.Language.get("krypton-year-chart-filter-title")))),f==="Quarterly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{ref:mt,className:"custom-select",value:L},Dr().quarters.map(Zt=>B.createElement("option",{key:Zt,value:Zt,disabled:Dr().isQuarterYearDisabled(Zt,G,le),style:Dr().isQuarterYearDisabled(Zt,G,le)?{cursor:"not-allowed",color:"#ccc"}:{}},Zt))),B.createElement("select",{ref:Dt,className:"custom-select",value:G},Dr().years.map(Zt=>{const Kt=new Date(le).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)}))),f==="Monthly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{ref:bt,className:"custom-select",value:S},Dr().months.map(Zt=>B.createElement("option",{key:Zt,value:Zt,disabled:Dr().isMonthYearDisabled(Zt,G,x_(le)),style:Dr().isMonthYearDisabled(Zt,G,x_(le))?{cursor:"not-allowed",color:"#ccc"}:{}},Zt))),B.createElement("select",{ref:Dt,className:"custom-select",value:G},Dr().years.map(Zt=>{const Kt=new Date(le).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)}))),f==="Yearly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{ref:Dt,className:"custom-select",value:G},Dr().years.map(Zt=>{const Kt=new Date(le).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)})))),B.createElement("div",{className:"right-controls-total"},Liferay.Language.get("krypton-service-detail-uptime-committed-title")," : ",B.createElement("span",null,Q,"% ",Ie?`(${Ie})`:""))))),B.createElement("div",{className:"col-12"},B.createElement("div",{id:"MTTRChart"},Ye?Pt?B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},Pt):B.createElement("div",{className:"loader mt-3"}):B.createElement(mk,{chartOptions:he}))));return n==="servicePerformance"?ur:B.createElement("div",{id:"Uptime",className:"capsule-item-content active mb-25 loader_wrap"},ur)},voe=({serviceId:e,customerAccountNo:t,redirectFrom:n,associatedTicketConfig:s,portalServiceId:a,onAssociatedTickets:d,ttrData:f,setTTRData:i,ttrSelectedPeriod:S,setTTRSelectedPeriod:E,ttrSelectedMonth:L,setTTRSelectedMonth:F,committedTTR:G,setCommittedTTR:q,actualCommittedTTR:Q,setActualCommittedTTR:te,ttrSelectedQuarter:he,setTTRSelectedQuarter:fe,ttrSelectedYear:le,setTTRSelectedYear:Se,ttrChartOptions:ke,setTTRChartOptions:Ee,serviceStartDate:Ie,ttrSelectedQuarterMonthYear:He,setTTRSelectedQuarterMonthYear:Ye,isNetworkService:lt=!0})=>{const[Pt,At]=It(!f),[ht,Ot]=It(""),Ae=wo(null),mt=wo(null),bt=wo(null),Dt=wo(null),Je=Zt=>{var Kt;if(E(Zt.target.value),Ie&&Ie!==""){const Ui=((Kt=Dt.current)==null?void 0:Kt.value)||le,rr=Dr().getDefaultMonth(Number(Ui),Ie);F(rr);const gi=Dr().getQuarterFromMonth(Dr().getMonthIndex(rr));fe(gi)}i([])},dt=Zt=>{F(Zt.target.value),i([])},ui=Zt=>{fe(Zt.target.value),i([])},Vt=Zt=>{if(Se(Zt.target.value),Ie&&Ie!==""){const Kt=Dr().getDefaultMonth(Number(Zt.target.value),Ie);F(Kt);const Ui=Dr().getQuarterFromMonth(Dr().getMonthIndex(Kt));fe(Ui)}i([])},ei=Zt=>!Zt||isNaN(Zt)?"00":(Zt/3600).toFixed(2);Ar(()=>{const Zt=async()=>{var Kt,Ui,rr,gi,Oi,cr,ji,nn,pr,Ue,ni;if(S){At(!0);try{let fi=S.toLowerCase();S==="Monthly"&&(fi=L),S==="Quarterly"&&(fi=he),S==="Yearly"&&(fi=le);const{fromDate:Lt,toDate:pt}=fa().getDateRangeFromFilter(fi,le),Nt=await R1(e,S==null?void 0:S.toLowerCase(),t,fa().formatSLADate(Lt),fa().formatSLADate(pt),"ttr");if(console.debug("serviceStartDate ---------- ",Ie),console.log("response -> ",Nt),Nt&&(Nt!=null&&Nt.data)&&((Kt=Nt==null?void 0:Nt.data)==null?void 0:Kt.statusCode)==200){const Si=JSON.parse((Ui=Nt==null?void 0:Nt.data)==null?void 0:Ui.data),St=(((rr=Si==null?void 0:Si.serviceDetail)==null?void 0:rr.associatedTickets)??[]).flatMap(tr=>tr.split(",").map(kr=>kr.trim())),Ht=((Oi=(gi=Si==null?void 0:Si.serviceDetail)==null?void 0:gi.ttr)==null?void 0:Oi.actualCommittedTtr)||"0 Hours",nr=((ji=(cr=Si==null?void 0:Si.serviceDetail)==null?void 0:cr.ttr)==null?void 0:ji.committedTtr)||"0";if(te(Ht),q(Number(nr)),d(St),e&&a&&St&&s){let tr=s.entityData;if(tr!=null){let kr=structuredClone(tr),Mr=kr.restBuilderApiURL,Cr=kr.propsData,Tn=Cr.filters,gs=Cr.screenFilters;Tn&&Tn.fields&&(_.each(Tn.fields,Ln=>{Ln.key=="externalRefEntityId"&&(Ln.value=`'${e}'`),Ln.key=="r_ticketServiceId_c_cstlservicesId"&&(Ln.value=`'${a}'`)}),Cr.filters=Tn),Array.isArray(gs)&&(gs.forEach(Ln=>{Ln.fields&&Array.isArray(Ln.fields)&&Ln.fields.forEach(qo=>{if(qo.key==="ticketId"){const za=`(${St.join(",").split(",").map($o=>`'${$o}'`).join(",")})`;qo.value=za}})}),Cr.screenFilters=gs),Cr.pageSize=-1;let bs=JSON.stringify(Cr),qn=btoa(bs);const Ls=Liferay.ThemeDisplay.getSiteGroupId(),ma=`${Mr}?propsData=${qn}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${Ls}`;try{const Ln=await Go.get(ma);if(Ln&&((nn=Ln==null?void 0:Ln.data)!=null&&nn.items)&&((pr=Ln==null?void 0:Ln.data)==null?void 0:pr.items.length)>0){Ot("");let qo=((ni=(Ue=Ln==null?void 0:Ln.data)==null?void 0:Ue.items)==null?void 0:ni.map(zn=>({name:(zn==null?void 0:zn.ticketId)||"Unknown",ttr:ei((zn==null?void 0:zn.ttr)||"0:00"),ttrDisplay:hoe(Number(zn==null?void 0:zn.ttr)),committedTTR:zn==null?void 0:zn.committedTTR,ticketCreatedDate:zn==null?void 0:zn.ticketCreatedDate})))||[];i(qo)}}catch(Ln){console.error("Error fetching all tickets:",Ln),Ot("No resolved or closed support tickets available for the current filter.")}finally{At(!1)}}}}else i([])}catch{Ot("No resolved or closed support tickets available for the current filter.")}finally{At(!1)}}};lt&&e&&t&&f.length===0&&(Ot(""),Zt())},[e,t,S,L,he,le]),Ar(()=>{console.debug("TTR ::::: ttrData ------- ",f);const Zt=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling :",Zt);let Kt=[];const Ui=Dr().months,rr=Dr().currentYear,gi=new Date().getMonth();if(S==="Yearly"){const pt=new Date(Ie),Nt=pt.getFullYear(),Si=pt.getMonth();le==rr?Nt==rr?Kt=Ui.slice(Si,gi+1):Kt=Ui.slice(0,gi+1):Nt==le?Kt=Ui.slice(Si):Kt=Ui.slice()}else if(S==="Monthly")Kt=Dr().generateWeeksForMonth(Dr().months.indexOf(L),le||Dr().currentYear,Ie);else if(S==="Weekly"){if(Kt=Dr().generateLast7Days(),Ie){const pt=new Date(Ie),Nt=Ht=>`${Ht.getDate()}-${Ht.toLocaleString("default",{month:"short"})}-${Ht.getFullYear()}`,Si=new Date,pi=new Date;if(pi.setDate(Si.getDate()-6),pt>=pi&&pt<=Si){const Ht=Nt(pt),nr=Kt.indexOf(Ht);nr!==-1&&(Kt=Kt.slice(nr))}}}else if(S==="Quarterly")Kt=Dr().getMonthsForQuarter(he);else{let pt=0;if(Ie&&Number(le)===Dr().currentYear){const Nt=Ie.split(" ");if(Nt.length>=3){const Si=Nt[0],pi=Dr().months.findIndex(St=>St.toLowerCase()===Si.toLowerCase());pi!==-1&&(pt=pi)}}if(Number(le)===Dr().currentYear){const Nt=new Date().getMonth();Kt=Dr().months.slice(pt,Nt+1)}else{const Nt=Dr().months,Si=Number(le);let pi=0,St=11;if(Ie){const Ht=new Date(Ie);if(!isNaN(Ht.getTime())){const nr=Ht.getFullYear(),tr=Ht.getMonth();nr===Si&&(pi=tr),Si===new Date().getFullYear()&&(St=new Date().getMonth())}}Kt=Nt.slice(pi,St+1)}}const Oi=Kt.flatMap((pt,Nt)=>{const Si={"Q1 (Jan-Mar)":["January","February","March"],"Q2 (Apr-Jun)":["April","May","June"],"Q3 (Jul-Sep)":["July","August","September"],"Q4 (Oct-Dec)":["October","November","December"]},pi=f.filter(St=>{const Ht=new Date(St.ticketCreatedDate);if(pt.match(/^\d{1,2}-[A-Za-z]{3}-\d{4}$/)){const[kr,Mr,Cr]=pt.split("-"),Tn=new Date(`${Mr} ${kr}, ${Cr}`);return Ht.getDate()===Tn.getDate()&&Ht.getMonth()===Tn.getMonth()&&Ht.getFullYear()===Tn.getFullYear()}const nr=pt.match(/(\d{1,2})-(\d{1,2}) ([A-Za-z]+)/);if(nr){const[kr,Mr,Cr,Tn]=nr,gs=Dr().months.indexOf(Tn);if(gs===-1)return!1;const wn=Dr().currentYear,bs=new Date(wn,gs,parseInt(Mr)),qn=new Date(wn,gs,parseInt(Cr),23,59,59);return Ht>=bs&&Ht<=qn}if(S==="Quarterly"){const kr=Si[pt],Mr=Number(le);return kr.some(Cr=>{const Tn=Dr().months.indexOf(Cr);return Ht.getMonth()===Tn&&Ht.getFullYear()===Mr})}const tr=Dr().months.indexOf(pt);return Ht.getMonth()===tr&&Ht.getFullYear()===Number(le)});return pi.length>0?pi.map(St=>({x:Nt,y:Number(St==null?void 0:St.ttr),ttrDisplay:St==null?void 0:St.ttrDisplay,name:St==null?void 0:St.name})):[{x:Nt,y:null,isEmpty:!0}]});console.debug("filteredChartData ------------ ",Oi);const cr=Oi.map(pt=>pt.y).filter(pt=>pt!==null),ji=Math.max(...cr,0),nn=G>0?G:1,pr=ji<1?nn:Math.ceil(ji+1);console.debug("allTTRs ------------ ",cr),console.debug("maxTTRHours ------------ ",pr),console.debug("committedTTR ------------ ",G);const Ue=[],ni=5;for(let pt=0;pt<ni;pt++){const Nt=Math.round(pt*pr/(ni-1));Ue.push(Nt)}const fi=Oi.map(pt=>({...pt,color:pt.y>G?"#FF7B23":"#8A2BE2"})),Lt={chart:{type:"scatter",height:"300",spacingLeft:10,backgroundColor:Zt.bgColor},title:{text:null},xAxis:{categories:Kt,lineWidth:2,gridLineColor:Zt.yAxisGridLineColor,lineColor:Zt.xAxisLineColor,labels:{rotation:-45,autoRotation:!1,step:1,crop:!1,overflow:"allow",align:"right",style:{color:Zt.xAxisLabelsStyleColor}}},yAxis:{tickWidth:1,title:{text:"Achieved TTR (Hours)",style:{color:Zt.yAxisTitleStyleColor}},min:0,max:pr,tickPositions:Ue,lineWidth:2,gridLineColor:Zt.yAxisGridLineColor,lineColor:Zt.yAxisLineColor,labels:{style:{color:Zt.yAxisLabelsStyleColor}},plotLines:[{dashStyle:"dash",width:2,value:Number(G),zIndex:5,color:Zt.yAxisPlotLinesStyleColor}]},tooltip:{useHTML:!0,outside:!0,shadow:!1,borderWidth:0,backgroundColor:Zt.tooltipBgColor,style:{color:Zt.tooltipStyleColor},formatter:function(){var gs,wn;const pt=this.point;if(!pt||pt.isEmpty)return`<div style="
                            background-color: black;
                            color: white;
                            padding: 8px;
                            border-radius: 6px;
                            text-align: center;
                            position: relative;
                            display: inline-block;">
                            <b>No Data</b>
                            <div style="
                                position: absolute;
                                bottom: -8px;
                                left: 50%;
                                transform: translateX(-50%);
                                width: 0;
                                height: 0;
                                border-left: 8px solid transparent;
                                border-right: 8px solid transparent;
                                border-top: 8px solid black;">
                            </div>
                        </div>`;const Nt=((gs=pt.options)==null?void 0:gs.ttrDisplay)||"0Day(s) 0H 0m 0s",Si=Nt.match(/(\d+)Day\(s\)/),pi=Nt.match(/(\d+)H/),St=Nt.match(/(\d+)m/),Ht=Nt.match(/(\d+)s/),nr=Si?parseInt(Si[1],10):0,tr=pi?parseInt(pi[1],10):0,kr=St?parseInt(St[1],10):0,Mr=Ht?parseInt(Ht[1],10):0,Cr=[`${nr}Day${nr===1?"":"(s)"}`,`${tr}H`,`${kr}m`,`${Mr}s`];return`<div style="
                        background-color: black;
                        color: white;
                        padding: 8px;
                        border-radius: 6px;
                        text-align: center;
                        position: relative;
                        display: inline-block;">
                        <b>${(wn=pt.options)==null?void 0:wn.name} - </b><br>${Cr.join(" ")}
                        <div style="
                            position: absolute;
                            bottom: -8px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 0;
                            height: 0;
                            border-left: 8px solid transparent;
                            border-right: 8px solid transparent;
                            border-top: 8px solid black;">
                        </div>
                    </div>`}},series:[{name:"Achieved",data:fi,marker:{symbol:"circle",radius:6}}],credits:{enabled:!1},legend:{enabled:!1}};Ee(Lt)},[f,G,le]),uu(Ae,Zt=>Je(Zt),[Ie]),uu(mt,Zt=>ui(Zt),[Ie,S]),uu(bt,Zt=>dt(Zt),[Ie,S]),uu(Dt,Zt=>Vt(Zt),[Ie,S]),Ar(()=>{bt.current&&L&&AUI.$(bt.current).val(L).trigger("change.select2")},[L]),Ar(()=>{mt.current&&he&&AUI.$(mt.current).val(he).trigger("change.select2")},[he]);const ur=B.createElement("div",{className:"row"},n=="serviceDetails"&&B.createElement("div",{className:"col-12 mb-15"},B.createElement(B.Fragment,null,B.createElement("div",{className:"chart-header"},B.createElement("div",{className:"right-controls"},B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Ae,value:S,onChange:Je},B.createElement("option",{value:"Monthly"},Liferay.Language.get("krypton-month-chart-filter-title")),B.createElement("option",{value:"Quarterly"},Liferay.Language.get("krypton-quarter-chart-filter-title")),B.createElement("option",{value:"Weekly"},Liferay.Language.get("krypton-weekly-chart-filter-title")),B.createElement("option",{value:"Yearly"},Liferay.Language.get("krypton-year-chart-filter-title")))),S==="Quarterly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:mt,value:he,onChange:ui},Dr().quarters.map(Zt=>B.createElement("option",{key:Zt,value:Zt,disabled:Dr().isQuarterYearDisabled(Zt,le,Ie),style:Dr().isQuarterYearDisabled(Zt,le,Ie)?{cursor:"not-allowed",color:"#ccc"}:{}},Zt))),B.createElement("select",{className:"custom-select",ref:Dt,value:le,onChange:Vt},Dr().years.map(Zt=>{const Kt=new Date(Ie).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)}))),S==="Monthly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:bt,value:L,onChange:dt},Dr().months.map(Zt=>B.createElement("option",{key:Zt,value:Zt,disabled:Dr().isMonthYearDisabled(Zt,le,x_(Ie)),style:Dr().isMonthYearDisabled(Zt,le,x_(Ie))?{cursor:"not-allowed",color:"#ccc"}:{}},Zt))),B.createElement("select",{className:"custom-select",ref:Dt,value:le,onChange:Vt},Dr().years.map(Zt=>{const Kt=new Date(Ie).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)}))),S==="Yearly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Dt,value:le,onChange:Vt},Dr().years.map(Zt=>{const Kt=new Date(Ie).getFullYear(),Ui=Dr().currentYear,rr=Zt<Kt||Zt>Ui;return B.createElement("option",{key:Zt,value:Zt,disabled:rr,style:rr?{cursor:"not-allowed",color:"#ccc"}:{}},Zt)})))),B.createElement("div",{className:"right-controls-total"},Liferay.Language.get("krypton-service-detail-ttr-committed-title")," : ",B.createElement("span",null," ",Q," "))))),B.createElement("div",{className:"col-12"},B.createElement("div",{id:"TTRChart",style:{overflowX:"auto"}},Pt?B.createElement("div",{className:"loader mt-3"}):ht?B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},ht):B.createElement(mk,{chartOptions:ke}))));return n==="servicePerformance"?ur:B.createElement("div",{id:"TTR",className:"capsule-item-content mb-25 loader_wrap"},ur)},xoe=({serviceId:e,customerAccountNo:t,redirectFrom:n,onAssociatedTicket:s,mttrData:a,setMTTRData:d,serviceStartDate:f,mttrSelectedPeriod:i,setMttrSelectedPeriod:S,mttrSelectedMonth:E,setMttrSelectedMonth:L,mttrSelectedQuarter:F,setMttrSelectedQuarter:G,mttrSelectedYear:q,setMttrSelectedYear:Q,actualCommittedMTTR:te,setActualCommittedMTTR:he,committedMTTR:fe,setCommittedMTTR:le,mttrChartOptions:Se,setMTTRChartOptions:ke,mttrSelectedQuarterMonthYear:Ee,setMTTRSelectedQuarterMonthYear:Ie,associatedTicketConfig:He,portalServiceId:Ye,setMttrCommittedFrequencyPeriod:lt,mttrCommittedFrequencyPeriod:Pt,isNetworkService:At=!0})=>{const[ht,Ot]=It("");It([]);const[Ae,mt]=It(!a),[bt,Dt]=It([]),Je=wo(null),dt=wo(null),ui=wo(null),Vt=wo(null),ei=ni=>{var fi;if(S(ni.target.value),f&&f!==""){const Lt=((fi=Vt.current)==null?void 0:fi.value)||q,pt=Dr().getDefaultMonth(Number(Lt),f);L(pt);const Nt=Dr().getQuarterFromMonth(Dr().getMonthIndex(pt));G(Nt)}d([])},ur=ni=>{L(ni.target.value),d([])},Zt=ni=>{G(ni.target.value),d([])},Kt=ni=>{if(Q(ni.target.value),d([]),f&&f!==""){const fi=Dr().getDefaultMonth(Number(ni.target.value),f);L(fi);const Lt=Dr().getQuarterFromMonth(Dr().getMonthIndex(fi));G(Lt)}};Ar(()=>{const ni=async()=>{var fi,Lt,pt,Nt,Si,pi,St,Ht;if(i){mt(!0);try{let nr=i.toLowerCase();i==="Monthly"&&(nr=E),i==="Quarterly"&&(nr=F),i==="Yearly"&&(nr=q);const{fromDate:tr,toDate:kr}=fa().getDateRangeFromFilter(nr,q),Mr=await R1(e,i==null?void 0:i.toLowerCase(),t,fa().formatSLADate(tr),fa().formatSLADate(kr),"mttr");if(Mr&&(Mr!=null&&Mr.data)&&((fi=Mr==null?void 0:Mr.data)==null?void 0:fi.statusCode)==200){const Cr=JSON.parse((Lt=Mr==null?void 0:Mr.data)==null?void 0:Lt.data),Tn=((Nt=(pt=Cr==null?void 0:Cr.serviceDetail)==null?void 0:pt.mttr)==null?void 0:Nt.actualCommittedMttr)||"";le(Number((pi=(Si=Cr==null?void 0:Cr.serviceDetail)==null?void 0:Si.mttr)==null?void 0:pi.committedMttr)),he(Tn),s((St=Cr==null?void 0:Cr.serviceDetail)==null?void 0:St.associatedTickets),Dt(((Ht=Cr==null?void 0:Cr.serviceDetail)==null?void 0:Ht.associatedTickets)||[])}else le(0),he(""),s([]),d([])}catch(nr){console.error("Error fetching SLA details:",nr),Ot(n=="servicePerformance"?"Service performance data unavailable. Please refresh":"Data not available. Please try again later")}finally{mt(!1)}}};At&&e&&t&&a.length===0&&(Ot(""),ni())},[e,i,q,E,t,F]);const Ui=async()=>{var ni,fi;if(console.debug("associatedTicketConfig :: ",He),e&&Ye&&He&&bt.length>0){const pt=bt.flatMap(Si=>Si.split(",").map(pi=>pi.trim()));let Nt=He.entityData;if(Nt!=null){let Si=structuredClone(Nt),pi=Si.restBuilderApiURL,St=Si.propsData,Ht=St.filters,nr=St.screenFilters;Ht&&Ht.fields&&(_.each(Ht.fields,Tn=>{Tn.key=="externalRefEntityId"&&(Tn.value=`'${e}'`),Tn.key=="r_ticketServiceId_c_cstlservicesId"&&(Tn.value=`'${Ye}'`)}),St.filters=Ht),Array.isArray(nr)&&(nr.forEach(Tn=>{Tn.fields&&Array.isArray(Tn.fields)&&Tn.fields.forEach(gs=>{if(gs.key==="ticketId"){const bs=`(${pt.join(",").split(",").map(qn=>`'${qn}'`).join(",")})`;gs.value=bs}})}),St.screenFilters=nr),console.debug("propsDataObj --------- ",St);let tr=JSON.stringify(St),kr=btoa(tr);const Mr=Liferay.ThemeDisplay.getSiteGroupId(),Cr=`${pi}?propsData=${kr}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${Mr}`;try{const Tn=await Go.get(Cr);return console.debug("response -------- ",Tn),Tn&&((ni=Tn==null?void 0:Tn.data)!=null&&ni.items)&&((fi=Tn==null?void 0:Tn.data)==null?void 0:fi.items.length)>0?Tn.data.items:[]}catch(Tn){return console.error("Error fetching all tickets:",Tn),[]}}}else return[]},rr=ni=>/^\d{1,2}-[A-Za-z]{3}-\d{4}$/.test(ni),gi=ni=>ni.toLocaleString("default",{month:"long"}),Oi=ni=>{const[fi,Lt,pt,Nt]=uoe(ni).split(":").map(Number);return fi*24+Lt+pt/60+Nt/3600},cr=ni=>{const fi=ni.replace(/<br\s*\/?>.*$/,"").trim(),[Lt,pt]=fi.split(" ").filter(Boolean),[Nt,Si]=Lt.split("-").map(Number);return{startDay:Nt,endDay:Si,monthName:pt}},ji=(ni,fi)=>{const Lt=fi.reduce((pt,Nt)=>(pt[Nt]=[],pt),{});return ni.forEach(pt=>{const Nt=new Date(pt.ticketCreatedDate),Si=Nt.getDate(),pi=gi(Nt),St=Nt.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-");for(const Ht of fi)if(rr(Ht)){if(Ht===St){Lt[Ht].push(pt.ttr);break}}else if(/^\d+-\d+/.test(Ht)){const{startDay:nr,endDay:tr,monthName:kr}=cr(Ht);if(pi===kr&&Si>=nr&&Si<=tr){Lt[Ht].push(pt.ttr);break}}else if(Ht===pi){Lt[Ht].push(pt.ttr);break}}),Lt},nn=(ni,fi)=>{const Lt={"Q1 (Jan-Mar)":["January","February","March"],"Q2 (Apr-Jun)":["April","May","June"],"Q3 (Jul-Sep)":["July","August","September"],"Q4 (Oct-Dec)":["October","November","December"]};return fi.map(pt=>{const Nt=Lt[pt];let Si=[];if(Nt&&Nt.length>0?Nt.forEach(Ht=>{const nr=ni[Ht];nr&&nr.length>0&&(Si=Si.concat(nr))}):Si=ni[pt]||[],Si.length===0)return{name:pt,y:null,isEmpty:!0};if(Si.length===1){const Ht=Oi(Si[0]);return{name:pt,y:Ht,isEmpty:!1,displayMTTR:fa().formatHoursToDisplayMTTR(Ht)}}const St=Si.reduce((Ht,nr)=>Ht+Oi(nr),0)/Si.length;return{name:pt,y:St,isEmpty:!1,displayMTTR:fa().formatHoursToDisplayMTTR(St)}})};Ar(()=>{const ni=async()=>{mt(!0);try{let fi=i.toLowerCase();i==="Monthly"&&(fi=E),i==="Quarterly"&&(fi=F),i==="Yearly"&&(fi=q);const{fromDate:Lt,toDate:pt}=fa().getDateRangeFromFilter(fi,q),Nt=fa().convertToLfrDate(Lt,"fromDate"),Si=fa().convertToLfrDate(pt,"toDate");console.debug("lfrFromDate :: ",Nt),console.debug("lfrToDate :: ",Si);let pi=[];const St=Dr().months,Ht=Dr().currentYear,nr=new Date().getMonth();if(i==="Yearly"){const kr=new Date(f),Mr=kr.getFullYear(),Cr=kr.getMonth();q==Ht?Mr==Ht?pi=St.slice(Cr,nr+1):pi=St.slice(0,nr+1):Mr==q?pi=St.slice(Cr):pi=St.slice()}else if(i==="Monthly")pi=Dr().generateWeeksForMonth(Dr().months.indexOf(E),q||Dr().currentYear,f);else if(i==="Weekly")pi=Dr().generateLast7Days();else if(i==="Quarterly"){const kr=Dr().getLabelForQuarter(F),Mr=parseInt(q,10),Cr=Dr().currentYear,Tn=new Date().getMonth(),gs=new Date(f),wn=gs.getFullYear(),bs=gs.getMonth(),qn=Dr().months[bs],ma=(Ln=>Ln<=2?"Q1":Ln<=5?"Q2":Ln<=8?"Q3":"Q4")(bs);wn===Mr&&ma===F?pi=[qn]:Mr<Cr?pi=kr:Mr===Cr?pi=kr.filter(Ln=>Dr().months.indexOf(Ln)<=Tn):pi=kr}else pi=Dr().months;console.debug("xAxisCategories in MTTRChart :: ",pi);const tr=await Ui();if((tr==null?void 0:tr.length)>0){const kr=ji(tr,pi);i==="Quarterly"&&(pi=Dr().getMonthsForQuarter(F));const Mr=nn(kr,pi);d(Mr)}else d([])}catch(fi){console.error("Error fetching SLA details:",fi),d([]),Ot(n=="servicePerformance"?"Service performance data unavailable. Please refresh":"Data not available. Please try again later")}finally{mt(!1)}};bt.length>0&&ni()},[e,i,q,E,F,q,bt]),Ar(()=>{console.debug("mttrData ----------- ",a);const ni=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling :",ni);let fi=[];const Lt=Dr().months,pt=Dr().currentYear,Nt=new Date().getMonth();if(i==="Yearly"){const kr=new Date(f),Mr=kr.getFullYear(),Cr=kr.getMonth();q==pt?Mr==pt?fi=Lt.slice(Cr,Nt+1):fi=Lt.slice(0,Nt+1):Mr==q?fi=Lt.slice(Cr):fi=Lt.slice()}else if(i==="Monthly")fi=Dr().generateWeeksForMonth(Dr().months.indexOf(E),q||Dr().currentYear,f);else if(i==="Weekly"){if(fi=Dr().generateLast7Days(),f){const kr=new Date(f),Mr=wn=>`${wn.getDate()}-${wn.toLocaleString("default",{month:"short"})}-${wn.getFullYear()}`,Cr=new Date,Tn=new Date;if(Tn.setDate(Cr.getDate()-6),kr>=Tn&&kr<=Cr){const wn=Mr(kr),bs=fi.indexOf(wn);bs!==-1&&(fi=fi.slice(bs))}}}else i==="Quarterly"?fi=Dr().getMonthsForQuarter(F):fi=Dr().months;console.debug("xAxisCategories in MTTRChart :: ",fi);const pi=!a||a.length===0?fi.map(kr=>({name:kr,y:null,isEmpty:!0})):a;console.debug("chartData in MTTRChart :: ",pi);const St=pi.map(kr=>kr.y||0),Ht=Math.max(...St),nr=fe>0?fe:1,tr=Ht<1?nr:Math.ceil(Ht+1);ke({chart:{type:"column",height:"300",borderRadius:16,backgroundColor:ni.bgColor},title:{text:null},xAxis:{categories:fi,useHTML:!0,lineWidth:2,gridLineColor:ni.yAxisGridLineColor,lineColor:ni.xAxisLineColor,labels:{rotation:-45,autoRotation:!1,step:1,crop:!1,overflow:"allow",align:"right",style:{color:ni.xAxisLabelsStyleColor}}},yAxis:{title:{text:"MTTR (Hours)",style:{fontSize:"12px",color:ni.yAxisTitleStyleColor}},min:0,max:tr,plotLines:[{dashStyle:"dash",width:2,value:Number(fe),zIndex:5,color:ni.yAxisPlotLinesStyleColor}],lineWidth:2,gridLineColor:ni.yAxisGridLineColor,lineColor:ni.yAxisLineColor,labels:{style:{fontSize:"12px",color:ni.yAxisLabelsStyleColor},formatter:function(){return this.value.toFixed(1)}}},tooltip:{useHTML:!0,outside:!0,shadow:!1,borderWidth:0,backgroundColor:ni.tooltipBgColor,style:{color:ni.tooltipStyleColor},formatter:function(){const kr=this.point;if(kr.isEmpty)return`<div style="
                            background-color: black;
                            color: white;
                            padding: 8px;
                            border-radius: 6px;
                            text-align: center;
                            position: relative;
                            display: inline-block;">
                            <b>No Data</b>
                            <div style="
                                position: absolute;
                                bottom: -8px;
                                left: 50%;
                                transform: translateX(-50%);
                                width: 0;
                                height: 0;
                                border-left: 8px solid transparent;
                                border-right: 8px solid transparent;
                                border-top: 8px solid black;">
                            </div>
                        </div>`;const Mr=kr.options.displayMTTR||"0Day(s) 0H 0m 0s",Cr=Mr.match(/(\d+)Day\(s\)/),Tn=Mr.match(/(\d+)H/),gs=Mr.match(/(\d+)m/),wn=Mr.match(/(\d+)s/),bs=Cr?parseInt(Cr[1],10):0,qn=Tn?parseInt(Tn[1],10):0,Ls=gs?parseInt(gs[1],10):0,ma=wn?parseInt(wn[1],10):0;return`<div style="
                        background-color: black;
                        color: white;
                        padding: 8px;
                        border-radius: 6px;
                        text-align: center;
                        position: relative;
                        display: inline-block;">
                        <b>${[`${bs}Day${bs===1?"":"(s)"}`,`${qn}H`,`${Ls}m`,`${ma}s`].join(" ")}</b>
                        <div style="
                            position: absolute;
                            bottom: -8px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 0;
                            height: 0;
                            border-left: 8px solid transparent;
                            border-right: 8px solid transparent;
                            border-top: 8px solid black;">
                        </div>
                    </div>`}},series:[{name:"Background",data:new Array(pi.length).fill(tr),enableMouseTracking:!1,showInLegend:!1,zIndex:0,color:ni.seriesBgColor,borderColor:ni.seriesBgBorderColor},{name:"MTTR",data:pi,color:"#237AFF",borderRadius:6,dataLabels:{enabled:!0,crop:!1,overflow:"allow",allowOverlap:!0,formatter:function(){var kr;return pr((kr=this.point.options)==null?void 0:kr.displayMTTR)||""},style:{color:ni.yAxisPlotLinesStyleColor,fontWeight:"700",textOutline:"none",fontSize:"10px"},inside:!0,verticalAlign:"bottom",align:"center",rotation:-90,y:-10}}],plotOptions:{column:{borderRadius:3,grouping:!1,pointPadding:.2,zIndex:1,pointWidth:15}},credits:{enabled:!1},legend:{enabled:!1}})},[a,fe]),uu(Je,ni=>ei(ni),[f]),uu(dt,ni=>Zt(ni),[f,i]),uu(ui,ni=>ur(ni),[f,i]),uu(Vt,ni=>Kt(ni),[f,i]),Ar(()=>{ui.current&&E&&AUI.$(ui.current).val(E).trigger("change.select2")},[E]),Ar(()=>{dt.current&&F&&AUI.$(dt.current).val(F).trigger("change.select2")},[F]);function pr(ni){if(!ni||typeof ni!="string")return null;const fi=ni.match(/(\d+)Day/),Lt=ni.match(/(\d+)H/),pt=ni.match(/(\d+)m/);if(!fi||!Lt||!pt)return null;const Nt=parseInt(fi[1],10),Si=parseInt(Lt[1],10),pi=parseInt(pt[1],10),St=Nt*24+Si,Ht=String(St).padStart(2,"0"),nr=String(pi).padStart(2,"0");return Ht==="00"&&nr==="00"?null:`${Ht}h:${nr}m`}const Ue=B.createElement("div",{class:"row"},n=="serviceDetails"&&B.createElement("div",{class:"col-12 mb-15"},B.createElement("div",{className:"chart-header"},B.createElement("div",{class:"right-controls"},B.createElement("div",{class:"form-group"},B.createElement("select",{class:"custom-select",id:"MTTRsortingGraph",ref:Je,value:i,onChange:ei},B.createElement("option",{value:"Monthly"},Liferay.Language.get("krypton-month-chart-filter-title")),B.createElement("option",{value:"Quarterly"},Liferay.Language.get("krypton-quarter-chart-filter-title")),B.createElement("option",{value:"Weekly"},Liferay.Language.get("krypton-weekly-chart-filter-title")),B.createElement("option",{value:"Yearly"},Liferay.Language.get("krypton-year-chart-filter-title")))),i==="Quarterly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:dt,value:F,onChange:Zt},Dr().quarters.map(ni=>B.createElement("option",{key:ni,value:ni,disabled:Dr().isQuarterYearDisabled(ni,q,f),style:Dr().isQuarterYearDisabled(ni,q,f)?{cursor:"not-allowed",color:"#ccc"}:{}},ni))),B.createElement("select",{className:"custom-select",ref:Vt,value:q,onChange:Kt},Dr().years.map(ni=>{const fi=new Date(f).getFullYear(),Lt=Dr().currentYear,pt=ni<fi||ni>Lt;return B.createElement("option",{key:ni,value:ni,disabled:pt,style:pt?{cursor:"not-allowed",color:"#ccc"}:{}},ni)}))),i==="Monthly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:ui,value:E,onChange:ur},Dr().months.map(ni=>B.createElement("option",{key:ni,value:ni,disabled:Dr().isMonthYearDisabled(ni,q,x_(f)),style:Dr().isMonthYearDisabled(ni,q,x_(f))?{cursor:"not-allowed",color:"#ccc"}:{}},ni))),B.createElement("select",{className:"custom-select",ref:Vt,value:q,onChange:Kt},Dr().years.map(ni=>{const fi=new Date(f).getFullYear(),Lt=Dr().currentYear,pt=ni<fi||ni>Lt;return B.createElement("option",{key:ni,value:ni,disabled:pt,style:pt?{cursor:"not-allowed",color:"#ccc"}:{}},ni)}))),i==="Yearly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Vt,value:q,onChange:Kt},Dr().years.map(ni=>{const fi=new Date(f).getFullYear(),Lt=Dr().currentYear,pt=ni<fi||ni>Lt;return B.createElement("option",{key:ni,value:ni,disabled:pt,style:pt?{cursor:"not-allowed",color:"#ccc"}:{}},ni)})))),B.createElement("div",{className:"left-control"},B.createElement("div",{className:"right-controls-total"},te!==""&&te!=="0 Hours"?B.createElement(B.Fragment,null,Liferay.Language.get("krypton-service-detail-mttr-committed-title"),": ",B.createElement("span",null,te," ",Pt?`(${Pt})`:"")):B.createElement(B.Fragment,null,Liferay.Language.get("krypton-dashboard-mttr-target"),": ",B.createElement("span",null,"4 Hours"," ",Pt?`(${Pt})`:""))),B.createElement("div",{className:"custom-legends"},B.createElement("legend",{className:"legend-label"},B.createElement("div",{style:{borderColor:"#237AFF",background:"#237AFF"},className:"legends-checkbox"}),"Achieved MTTR"))))),B.createElement("div",{class:"col-12"},B.createElement("div",{id:"MTTRChart"},Ae?ht?B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},ht):B.createElement("div",{className:"loader mt-3"}):B.createElement(mk,{chartOptions:Se}))));return n==="servicePerformance"?Ue:B.createElement("div",{id:"MTTR",className:"capsule-item-content mb-25 loader_wrap"},Ue)},boe=({serviceId:e,customerAccountNo:t,redirectFrom:n,onAssociatedTicket:s,fiberCutData:a,setFiberCutData:d,fiberCutSelectedPeriod:f,setFiberCutSelectedPeriod:i,fiberCutSelectedMonth:S,setFiberCutSelectedMonth:E,fiberCutSelectedQuarter:L,setFiberCutSelectedQuarter:F,fiberCutSelectedYear:G,setFiberCutSelectedYear:q,committedFiberCuts:Q,setCommittedFiberCuts:te,fiberCutsChartOptions:he,setFiberCutsChartOptions:fe,serviceStartDate:le,fiberCutsSelectedQuarterMonthYear:Se,setFiberCutsSelectedQuarterMonthYear:ke,isNetworkService:Ee=!0})=>{It(null);const[Ie,He]=It(""),[Ye,lt]=It(!a),Pt=wo(null),At=wo(null),ht=wo(null),Ot=wo(null),Ae=dt=>{var ui;if(i(dt.target.value),le&&le!==""){const Vt=((ui=Ot.current)==null?void 0:ui.value)||G,ei=Dr().getDefaultMonth(Number(Vt),le);E(ei);const ur=Dr().getQuarterFromMonth(Dr().getMonthIndex(ei));F(ur)}d([])},mt=dt=>{E(dt.target.value),d([])},bt=dt=>{F(dt.target.value),d([])},Dt=dt=>{if(q(dt.target.value),d([]),le&&le!==""){const ui=Dr().getDefaultMonth(Number(dt.target.value),le);E(ui);const Vt=Dr().getQuarterFromMonth(Dr().getMonthIndex(ui));F(Vt)}};Ar(()=>{const dt=async()=>{var ui,Vt,ei,ur,Zt,Kt,Ui;if(f){lt(!0);try{let rr=f.toLowerCase();f==="Monthly"&&(rr=S),f==="Quarterly"&&(rr=L),f==="Yearly"&&(rr=G);const{fromDate:gi,toDate:Oi}=fa().getDateRangeFromFilter(rr,G),cr=await R1(e,f==null?void 0:f.toLowerCase(),t,fa().formatSLADate(gi),fa().formatSLADate(Oi),"fibercut");if(cr&&(cr!=null&&cr.data)&&((ui=cr==null?void 0:cr.data)==null?void 0:ui.statusCode)==200){const ji=JSON.parse((Vt=cr==null?void 0:cr.data)==null?void 0:Vt.data),nn=Number((ur=(ei=ji==null?void 0:ji.serviceDetail)==null?void 0:ei.fiberCuts)==null?void 0:ur.committedFiberCuts)||0;let pr=((Kt=(Zt=ji==null?void 0:ji.serviceDetail)==null?void 0:Zt.fiberCuts)==null?void 0:Kt.data.map(Ue=>({name:new Date(Ue.startDate).toLocaleString("default",{month:"long"}),y:Ue.achievedFiberCuts===null||Ue.achievedFiberCuts===0?null:Number(Ue.achievedFiberCuts)})))||[];d(pr),te(nn),s((Ui=ji==null?void 0:ji.serviceDetail)==null?void 0:Ui.associatedTickets)}else d([]),te(0),s([])}catch(rr){console.error("Error fetching SLA details:",rr),He(n=="servicePerformance"?"Service performance data unavailable. Please refresh":"Data not available. Please try again later")}finally{lt(!1)}}};Ee&&e&&t&&(a==null?void 0:a.length)===0&&dt()},[e,f,S,t,L,G]),Ar(()=>{console.debug("fiberCutData ----------- ",a);const dt=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling :",dt);let ui=[];const Vt=Dr().months,ei=Dr().currentYear,ur=new Date().getMonth();if(f==="Yearly"){const Ui=new Date(le),rr=Ui.getFullYear(),gi=Ui.getMonth();G==ei?rr==ei?ui=Vt.slice(gi,ur+1):ui=Vt.slice(0,ur+1):rr==G?ui=Vt.slice(gi):ui=Vt.slice()}else if(f==="Monthly")ui=Dr().generateWeeksForMonth(Dr().months.indexOf(S),G||Dr().currentYear,le);else if(f==="Weekly"){if(ui=Dr().generateLast7Days(),le){const Ui=new Date(le),rr=ji=>`${ji.getDate()}-${ji.toLocaleString("default",{month:"short"})}-${ji.getFullYear()}`,gi=new Date,Oi=new Date;if(Oi.setDate(gi.getDate()-6),Ui>=Oi&&Ui<=gi){const ji=rr(Ui),nn=ui.indexOf(ji);nn!==-1&&(ui=ui.slice(nn))}}}else f==="Quarterly"?ui=Dr().getMonthsForQuarter(L):ui=Dr().months;const Kt=!a||a.length===0?ui.map(Ui=>({name:Ui,y:null,isEmpty:!0})):a;fe({chart:{type:"column",height:"300",backgroundColor:dt.bgColor},title:{text:null},xAxis:{categories:ui,useHTML:!0,gridLineColor:dt.yAxisGridLineColor,lineColor:dt.xAxisLineColor,labels:{style:{color:dt.xAxisLabelsStyleColor}}},yAxis:{title:{text:"Number of Fiber Cuts",style:{color:dt.yAxisTitleStyleColor}},lineWidth:2,gridLineColor:dt.yAxisGridLineColor,lineColor:dt.yAxisLineColor,min:0,max:10,plotLines:[{value:Number(Q),dashStyle:"dash",width:2,zIndex:5,color:dt.yAxisPlotLinesStyleColor}]},tooltip:{formatter:function(){var Ui=this.series.xAxis;console.debug("axis :: ",Ui);var rr=Ui.categories&&Ui.categories[this.point.index]?Ui.categories[this.point.index]:this.x;return console.debug("category :: ",rr),`${rr}<br/><span style="color:${this.series.color}"></span> ${this.series.name}: <b>${this.y}</b>`},backgroundColor:dt.tooltipBgColor,style:{color:dt.tooltipStyleColor}},series:[{name:"Background",data:new Array(Kt.length).fill(100),enableMouseTracking:!1,showInLegend:!1,zIndex:0,color:dt.seriesBgColor,borderColor:dt.seriesBgBorderColor},{name:"Fiber Cut",data:Kt,color:"#237AFF",minPointLength:10,borderColor:dt.seriesDataBorderColor,dataLabels:{enabled:!0,formatter:function(){return this.y!==null?`${this.y}`:""},style:{color:"#ffffff",fontWeight:"700",textOutline:"none",fontSize:"10px"},inside:!0,verticalAlign:"bottom",align:"center",rotation:-90,y:-10}}],credits:{enabled:!1},plotOptions:{column:{borderRadius:3,grouping:!1,pointPadding:.2,zIndex:1,pointWidth:15,dataLabels:{style:{color:dt.columnDataLabelsStyleColor}}}},legend:{enabled:!1}})},[a,Q]),uu(Pt,dt=>Ae(dt),[le]),uu(At,dt=>bt(dt),[le,f]),uu(ht,dt=>mt(dt),[le,f]),uu(Ot,dt=>Dt(dt),[le,f]),Ar(()=>{ht.current&&S&&AUI.$(ht.current).val(S).trigger("change.select2")},[S]),Ar(()=>{At.current&&L&&AUI.$(At.current).val(L).trigger("change.select2")},[L]);const Je=B.createElement("div",{className:"row"},n==="serviceDetails"&&B.createElement(B.Fragment,null,B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"chart-header"},B.createElement("div",{className:"right-controls"},B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Pt,id:"periodSelect",value:f,onChange:Ae},B.createElement("option",{value:"Monthly"},Liferay.Language.get("krypton-month-chart-filter-title")),B.createElement("option",{value:"Quarterly"},Liferay.Language.get("krypton-quarter-chart-filter-title")),B.createElement("option",{value:"Weekly"},Liferay.Language.get("krypton-weekly-chart-filter-title")),B.createElement("option",{value:"Yearly"},Liferay.Language.get("krypton-year-chart-filter-title")))),f==="Quarterly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:At,value:L},Dr().quarters.map(dt=>B.createElement("option",{key:dt,value:dt,disabled:Dr().isQuarterYearDisabled(dt,G,le),style:Dr().isQuarterYearDisabled(dt,G,le)?{cursor:"not-allowed",color:"#ccc"}:{}},dt))),B.createElement("select",{className:"custom-select",ref:Ot,value:G},Dr().years.map(dt=>{const ui=new Date(le).getFullYear(),Vt=Dr().currentYear,ei=dt<ui||dt>Vt;return B.createElement("option",{key:dt,value:dt,disabled:ei,style:ei?{cursor:"not-allowed",color:"#ccc"}:{}},dt)}))),f==="Monthly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:ht,value:S,onChange:mt},Dr().months.map(dt=>B.createElement("option",{key:dt,value:dt,disabled:Dr().isMonthYearDisabled(dt,G,x_(le)),style:Dr().isMonthYearDisabled(dt,G,x_(le))?{cursor:"not-allowed",color:"#ccc"}:{}},dt))),B.createElement("select",{className:"custom-select",ref:Ot,value:G,onChange:Dt},Dr().years.map(dt=>{const ui=new Date(le).getFullYear(),Vt=Dr().currentYear,ei=dt<ui||dt>Vt;return B.createElement("option",{key:dt,value:dt,disabled:ei,style:ei?{cursor:"not-allowed",color:"#ccc"}:{}},dt)}))),f==="Yearly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Ot,value:G,onChange:Dt},Dr().years.map(dt=>{const ui=new Date(le).getFullYear(),Vt=Dr().currentYear,ei=dt<ui||dt>Vt;return B.createElement("option",{key:dt,value:dt,disabled:ei,style:ei?{cursor:"not-allowed",color:"#ccc"}:{}},dt)})))),n=="serviceDetails"&&B.createElement("div",{className:"right-controls-total"},Liferay.Language.get("krypton-service-detail-fibercuts-committed-title")," : ",B.createElement("span",null," ",Q,"  "))))),B.createElement("div",{className:"col-12"},B.createElement("div",{id:"fiberCut"},Ye?Ie?B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},Ie):B.createElement("div",{className:"loader mt-3"}):B.createElement(mk,{chartOptions:he}))));return n==="servicePerformance"?Je:B.createElement("div",{id:"FiberCuts",className:"capsule-item-content active mb-25 loader_wrap"},Je)},woe=({maintenance:e})=>{var i;const[t,n]=It(!1),s=3,a=((i=e==null?void 0:e.scheduleMaintenanceId)==null?void 0:i.map(S=>S.externalReferenceId).filter(Boolean))||[],d=t?a:a.slice(0,s),f=a.length>s;return B.createElement("div",{className:"text-nowrap-wrap"},d.map((S,E)=>B.createElement("span",{key:E,className:"text-nowrap"},typeof S=="object"?JSON.stringify(S):S,E<d.length-1?", ":"")),f&&!t&&B.createElement("span",{className:"view-more"},"...",B.createElement("a",{href:"#",onClick:S=>{S.preventDefault(),n(!0)},className:"button-link-view"},"View More")))},Soe=({scheduledMaintenanceConfig:e,serviceId:t,scheduleMaintenanceExportType:n,scheduleMaintenance:s,setScheduleMaintenance:a,scheduleMaintenanceFilterParams:d,setScheduleMaintenanceExportFileName:f,onDataLoaded:i,customerAccountNo:S,parentModule:E})=>{const[L,F]=It(!1),[G,q]=It(!0),[Q,te]=It(!0),he=Number(Liferay.ThemeDisplay.getUserId()),[fe,le]=It(1),[Se,ke]=It(10),[Ee,Ie]=It(0),He=()=>{const Ae=new Date,mt=new Date(Date.UTC(Ae.getUTCFullYear(),Ae.getUTCMonth(),Ae.getUTCDate(),23,59,59)),bt=new Date(Date.UTC(Ae.getUTCFullYear(),Ae.getUTCMonth(),Ae.getUTCDate()-90,0,0,0)),Dt=Je=>Je.toISOString().split(".")[0]+"Z";return{greaterThanDate:Dt(bt),lessThanDate:Dt(mt)}},{greaterThanDate:Ye,lessThanDate:lt}=He();Ar(()=>{(async()=>{var mt,bt,Dt,Je,dt;if(e!==""||e!==null){let ui=e.entityData;if(ui!=null){const Vt=ht(ui,fe,Se);try{const ei=await Go.get(Vt);if(console.debug("Scheduled Maintenance Response: ",ei),ei&&(ei!=null&&ei.data)&&((bt=(mt=ei==null?void 0:ei.data)==null?void 0:mt.items)==null?void 0:bt.length)>0){if(((Je=(Dt=ei.data)==null?void 0:Dt.items)==null?void 0:Je.length)>0){let ur=[];S&&(ur=ei.data.items.map(Zt=>{var Kt;return{...Zt,scheduleMaintenanceId:(Kt=Zt==null?void 0:Zt.scheduleMaintenanceId)==null?void 0:Kt.filter(Ui=>(Ui==null?void 0:Ui.customerAccountNo)===S)}})),E=="service-detail"&&(ur=ei.data.items.map(Zt=>{var Kt;return{...Zt,scheduleMaintenanceId:(Kt=Zt==null?void 0:Zt.scheduleMaintenanceId)==null?void 0:Kt.filter(Ui=>(Ui==null?void 0:Ui.externalReferenceId)===t)}})),te(ur)}Ie((dt=ei==null?void 0:ei.data)==null?void 0:dt.totalCount),i&&i(ei.data.items)}else te([]),le(1),ke(10),Ie(0),i&&i([])}catch(ei){F(!0),console.error("Error fetching scheduled maintenance:",ei),i&&i([]),setTimeout(()=>{F(!1)},2e3)}finally{q(!1)}}}})()},[e,fe,Se,d]),Ar(()=>{const Ae=(bt,Dt,Je,dt)=>{const ui=bt==null?void 0:bt.scheduleMaintenanceId;if(!Array.isArray(ui))return"NA";const Vt=Dt==="service-detail"?ui.filter(ur=>(ur==null?void 0:ur.externalReferenceId)===dt):ui.filter(ur=>(ur==null?void 0:ur.customerAccountNo)===Je);return(Vt==null?void 0:Vt.map(ur=>ur==null?void 0:ur.externalReferenceId).filter(Boolean).join(", "))||"NA"};(async()=>{var bt,Dt,Je,dt,ui,Vt;if(e!=""&&e!=null&&n!=null&&n!=""){let ei=n=="pdf"?e==null?void 0:e.exportPDFDataConfig:e==null?void 0:e.exportExcelDataConfig;if(!_.isEmpty(ei)){let ur=ei.restBuilderApiURL,Zt=[],Kt=[];const Ui=new Date().toISOString().split("T")[0],rr=ei==null?void 0:ei.statusRelationMappingKey;let gi=(bt=ei==null?void 0:ei.allowedAttributes)!=null&&bt.length?[...ei.allowedAttributes]:[];const Oi=`Scheduled Maintenance_${Ui}`,cr="Scheduled Maintenance List";f(Oi);let ji=[];if(e!==""||e!==null){let Ue=e.entityData;if(Ue!=null){const ni=ht(Ue,1,5e3);try{ji=await Go.get(ni)}catch(fi){F(!0),console.error("Error fetching scheduled maintenance:",fi),setTimeout(()=>{F(!1)},2e3)}finally{q(!1)}}}Zt=["Maintenance ID","Service ID","Impact Type","Description","Planned Outage Start Time","Planned Outage End Time","Actual Outage Start Time","Actual Outage End Time","Status","Urgency"],Kt=["externalReferenceId","serviceId","impactType","subject","maintenanceDateTime","planMaintenanceEndTime","actualStartTime","actualEndTime","status","eventType"],console.log("scheduleMaintenanceExportData -> ",ji),gi=gi.filter(Ue=>Kt.includes(Ue));const nn=(Je=(Dt=ji.data)==null?void 0:Dt.items)==null?void 0:Je.map(Ue=>{var Si;const ni=((Si=Ue[rr])==null?void 0:Si.statusVal)||"NA",fi=ni.toLowerCase()==="completed",Lt=Ue==null?void 0:Ue.peStatus,pt=fi?Lt==="Partial"||Lt==="Failure"?"Success":Lt||"NA":ni;return{...Ue,externalReferenceId:(Ue==null?void 0:Ue.externalReferenceId)||"NA",serviceId:Ae(Ue,E,S,t),impactType:(Ue==null?void 0:Ue.impactType)||"NA",subject:(Ue==null?void 0:Ue.subject)||"NA",maintenanceDateTime:(Ue==null?void 0:Ue.maintenanceDateTime)&&fa().formatDate(Ue==null?void 0:Ue.maintenanceDateTime)||"NA",planMaintenanceEndTime:(Ue==null?void 0:Ue.planMaintenanceEndTime)&&fa().formatDate(Ue==null?void 0:Ue.planMaintenanceEndTime)||"NA",actualStartTime:(Ue==null?void 0:Ue.actualStartTime)&&fa().formatDate(Ue==null?void 0:Ue.actualStartTime)||"NA",actualEndTime:(Ue==null?void 0:Ue.actualEndTime)&&fa().formatDate(Ue==null?void 0:Ue.actualEndTime)||"NA",status:pt,eventType:(Ue==null?void 0:Ue.eventType)||"N/A"}}),pr={title:cr,fileHeaderList:Zt,keys:Kt,data:nn};try{const Ue=await Go.post(ur,pr);if(Ue&&(Ue!=null&&Ue.data)&&((dt=Ue.data)!=null&&dt.data))if(n=="pdf")if(Ue.data.data.pdfByteArray&&!s.pdfTriggerDownload){const ni=Ue.data.data.pdfByteArray;a({...s,fileByteArr:ni,pdfTriggerDownload:!0,exportMessage:"Your file is being generated. Please wait."})}else(ui=Ue.data)!=null&&ui.errorMessage&&a({...s,exportMessage:errorMessage});else if(Ue.data.data.excelByteArray&&!s.excelTriggerDownload){const ni=Ue.data.data.excelByteArray;a({...s,fileByteArr:ni,excelTriggerDownload:!0,exportMessage:"Your file is being generated. Please wait."})}else(Vt=Ue.data)!=null&&Vt.errorMessage&&a({...s,exportMessage:errorMessage})}catch(Ue){console.error("Error calling export service:",Ue)}}}})()},[n]);const Pt=Ae=>{le(Ae)},At=Ae=>{ke(Ae),le(1)};function ht(Ae,mt,bt){let Dt=Ae.restBuilderApiURL,Je=Ae.propsData,dt=Je.filters;console.debug("filtersObj in scheduled maintenance ::::; ",dt),Array.isArray(dt)&&dt.forEach(Zt=>{Array.isArray(Zt.fields)&&Zt.fields.forEach(Kt=>{Kt.key==="maintenanceDateTime"&&(Kt.value=`${fa().getCurrentISTDateTimeAsUTC()}`),t&&(Kt.key==="serviceId"||(Kt==null?void 0:Kt.defaultKey)==="serviceId")&&(Kt.value=`'${t}'`),Kt.operator==="ge"&&Kt.key==="createdTime"&&(Kt.value=`${Ye}`),Kt.operator==="le"&&Kt.key==="createdTime"&&(Kt.value=`${lt}`)}),Je.filters=dt}),d&&d.trim()!==""&&(Je.screenFilters=Ot(d)),mt>0&&(Je.page=mt),bt>0&&(Je.pageSize=bt),(d==null?void 0:d.trim())===""&&delete Je.screenFilters,console.debug("propsDataObj in schdeuled maintenance ------- ",Je);let Vt=JSON.stringify(Je),ei=btoa(Vt);const ur=Liferay.ThemeDisplay.getSiteGroupId();return`${Dt}?propsData=${ei}&userId=${he}&siteId=${ur}`}const Ot=Ae=>{let mt=[],bt,Dt;return bt=atob(Ae),Dt=JSON.parse(bt),Dt&&Dt.length>0&&_.each(Dt,Je=>{let dt=new Object({logicalOperator:Je.lfrData.logicalOperator}),ui=[];if(Je.elType==="dynamicCheckbox")_.each(Je.values,Vt=>{let ei=new Object({});ei.key=Je.lfrData.mappingKey,ei.operator="eq",ei.value=`'${Vt.id}'`,ui.push(ei)});else if(Je.elType==="dynamicDropdown"||Je.elType==="select2DynamicDropdown"){let Vt=new Object({});Vt.key=Je.lfrData.mappingKey,Vt.operator="eq",Vt.value=`'${Je.values}'`,ui.push(Vt)}else if(Je.elType==="dateRangePicker"){let Vt=Je.lfrData.mappingKey.split(",")[0],ei=Je.lfrData.mappingKey.split(",")[1],ur=Je.values.formatted_from_date,Zt=Je.values.formatted_to_date;if(Vt){let Kt=new Object({});Kt.key=Vt,Kt.operator="ge",Kt.value=ur,ui.push(Kt)}if(ei){let Kt=new Object({});Kt.key=ei,Kt.operator="le",Kt.value=Zt,ui.push(Kt)}}dt.fields=ui,mt.push(dt)}),mt};return B.createElement(B.Fragment,null,B.createElement("div",{className:"table-main-body"},B.createElement("div",{className:"table-container"},B.createElement("table",{id:"scheduledMaintenanceTable",className:"table dataTable",style:{width:"100%"}},B.createElement("thead",null,B.createElement("tr",null,B.createElement("th",null,"Maintenance ID"),B.createElement("th",null,"Service ID"),B.createElement("th",null,"Impact Type"),B.createElement("th",null,"Description"),B.createElement("th",null,"Planned Outage"),B.createElement("th",null,"Actual Outage"),B.createElement("th",null,"Status"),B.createElement("th",null,"Urgency"))),B.createElement("tbody",null,L&&B.createElement("div",{className:"alert alert-danger mb-3 mt-3",role:"alert"},"Unable to fetch maintenance details. Please check back later."),G&&B.createElement("tr",null,B.createElement("td",{className:"loader_wrap text-center",style:{height:"80px"},colspan:"100%"},B.createElement("div",{className:"loader"}))),Q&&Q.length==0&&B.createElement("tr",null,B.createElement("td",{class:"text-center",colspan:"100%"},"No data available.")),Q&&!G&&Q.length>0&&Q.map(Ae=>{var mt;return B.createElement("tr",{key:Ae==null?void 0:Ae.externalReferenceId},B.createElement("td",{className:"text-nowrap"}," ",Ae!=null&&Ae.externalReferenceId?Ae.externalReferenceId:"-"," "),B.createElement("td",{className:"text-nowrap"},B.createElement(woe,{maintenance:Ae})),B.createElement("td",null," ",Ae!=null&&Ae.impactType?Ae.impactType:"-"," "),B.createElement("td",null," ",Ae!=null&&Ae.subject?Ae.subject:"-"," "),B.createElement("td",{className:"text-nowrap"},B.createElement(B.Fragment,null,B.createElement("span",{className:"text-nowrap"},B.createElement("strong",null,"Start:")," ",Ae!=null&&Ae.maintenanceDateTime?fa().formatDateTime(Ae==null?void 0:Ae.maintenanceDateTime):"-"),B.createElement("br",null),B.createElement("span",{className:"text-nowrap"},B.createElement("strong",null,"End:")," ",Ae!=null&&Ae.planMaintenanceEndTime?fa().formatDateTime(Ae==null?void 0:Ae.planMaintenanceEndTime):"-"))),B.createElement("td",{className:"text-nowrap"},B.createElement(B.Fragment,null,B.createElement("span",{className:"text-nowrap"},B.createElement("strong",null,"Start:")," ",Ae!=null&&Ae.actualStartTime?fa().formatDateTime(Ae==null?void 0:Ae.actualStartTime):"-"),B.createElement("br",null),B.createElement("span",{className:"text-nowrap"},B.createElement("strong",null,"End:")," ",Ae!=null&&Ae.actualEndTime?fa().formatDateTime(Ae==null?void 0:Ae.actualEndTime):"-"))),B.createElement("td",null,(mt=Ae==null?void 0:Ae.r_scheduleMaintenanceStatusMasterId_c_cstlstatusmaster)!=null&&mt.statusVal?(()=>{const bt=Ae.r_scheduleMaintenanceStatusMasterId_c_cstlstatusmaster.statusVal,Dt=bt.toLowerCase()==="completed";let Je;if(Dt){const dt=Ae==null?void 0:Ae.peStatus;Je=dt==="Partial"||dt==="Failure"?"Success":dt||"-"}else Je=bt;return B.createElement("span",{className:`status-${Je.toLowerCase().replace(/\s+/g,"")}`},Je)})():"-"),B.createElement("td",null," ",Ae!=null&&Ae.eventType?Ae.eventType:"-"," "))}))))),B.createElement("div",{className:"table-footer"},Ee>10?B.createElement(vD,{totalRecords:Ee,pageSize:Se,page:fe,onPageSizeChange:At,onPageChange:Pt}):""))};var v$={exports:{}};(function(e,t){(function(n,s){n._Highcharts=s(),e.exports=n._Highcharts})(typeof window>"u"?og:window,()=>(()=>{var $w;let n,s,a,d,f,i;var S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee,Ie,He,Ye,lt,Pt,At,ht,Ot,Ae,mt,bt={};bt.d=(ie,p)=>{for(var b in p)bt.o(p,b)&&!bt.o(ie,b)&&Object.defineProperty(ie,b,{enumerable:!0,get:p[b]})},bt.o=(ie,p)=>Object.prototype.hasOwnProperty.call(ie,p);var Dt={};bt.d(Dt,{default:()=>jk}),function(ie){var p,b,T,P,O,z,j;ie.SVG_NS="http://www.w3.org/2000/svg",ie.product="Highcharts",ie.version="12.3.0",ie.win=typeof window<"u"?window:{},ie.doc=ie.win.document,ie.svg=!!((T=(b=(p=ie.doc)==null?void 0:p.createElementNS)==null?void 0:b.call(p,ie.SVG_NS,"svg"))!=null&&T.createSVGRect),ie.pageLang=(z=(O=(P=ie.doc)==null?void 0:P.documentElement)==null?void 0:O.closest("[lang]"))==null?void 0:z.lang,ie.userAgent=((j=ie.win.navigator)==null?void 0:j.userAgent)||"",ie.isChrome=ie.win.chrome,ie.isFirefox=ie.userAgent.indexOf("Firefox")!==-1,ie.isMS=/(edge|msie|trident)/i.test(ie.userAgent)&&!ie.win.opera,ie.isSafari=!ie.isChrome&&ie.userAgent.indexOf("Safari")!==-1,ie.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(ie.userAgent),ie.isWebKit=ie.userAgent.indexOf("AppleWebKit")!==-1,ie.deg2rad=2*Math.PI/360,ie.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],ie.noop=function(){},ie.supportsPassiveEvents=function(){let X=!1;if(!ie.isMS){let re=Object.defineProperty({},"passive",{get:function(){X=!0}});ie.win.addEventListener&&ie.win.removeEventListener&&(ie.win.addEventListener("testPassive",ie.noop,re),ie.win.removeEventListener("testPassive",ie.noop,re))}return X}(),ie.charts=[],ie.composed=[],ie.dateFormats={},ie.seriesTypes={},ie.symbolSizes={},ie.chartCount=0}(S||(S={}));let Je=S,{charts:dt,doc:ui,win:Vt}=Je;function ei(ie,p,b,T){let P=p?"Highcharts error":"Highcharts warning";ie===32&&(ie=`${P}: Deprecated member`);let O=Oi(ie),z=O?`${P} #${ie}: www.highcharts.com/errors/${ie}/`:ie.toString();if(T!==void 0){let j="";O&&(z+="?"),Nt(T,function(X,re){j+=`
 - ${re}: ${X}`,O&&(z+=encodeURI(re)+"="+encodeURI(X))}),z+=j}pi(Je,"displayError",{chart:b,code:ie,message:z,params:T},function(){if(p)throw Error(z);Vt.console&&ei.messages.indexOf(z)===-1&&console.warn(z)}),ei.messages.push(z)}function ur(ie,p){return parseInt(ie,p||10)}function Zt(ie){return typeof ie=="string"}function Kt(ie){let p=Object.prototype.toString.call(ie);return p==="[object Array]"||p==="[object Array Iterator]"}function Ui(ie,p){return!!ie&&typeof ie=="object"&&(!p||!Kt(ie))}function rr(ie){return Ui(ie)&&typeof ie.nodeType=="number"}function gi(ie){let p=ie==null?void 0:ie.constructor;return!!(Ui(ie,!0)&&!rr(ie)&&(p!=null&&p.name)&&p.name!=="Object")}function Oi(ie){return typeof ie=="number"&&!isNaN(ie)&&ie<1/0&&ie>-1/0}function cr(ie){return ie!=null}function ji(ie,p,b){let T,P=Zt(p)&&!cr(b),O=(z,j)=>{cr(z)?ie.setAttribute(j,z):P?(T=ie.getAttribute(j))||j!=="class"||(T=ie.getAttribute(j+"Name")):ie.removeAttribute(j)};return Zt(p)?O(b,p):Nt(p,O),T}function nn(ie){return Kt(ie)?ie:[ie]}function pr(ie,p){let b;for(b in ie||(ie={}),p)ie[b]=p[b];return ie}function Ue(){let ie=arguments,p=ie.length;for(let b=0;b<p;b++){let T=ie[b];if(T!=null)return T}}function ni(ie,p){pr(ie.style,p)}function fi(ie){return Math.pow(10,Math.floor(Math.log(ie)/Math.LN10))}function Lt(ie,p){return ie>1e14?ie:parseFloat(ie.toPrecision(p||14))}(ei||(ei={})).messages=[],Math.easeInOutSine=function(ie){return-.5*(Math.cos(Math.PI*ie)-1)};let pt=Array.prototype.find?function(ie,p){return ie.find(p)}:function(ie,p){let b,T=ie.length;for(b=0;b<T;b++)if(p(ie[b],b))return ie[b]};function Nt(ie,p,b){for(let T in ie)Object.hasOwnProperty.call(ie,T)&&p.call(b||ie[T],ie[T],T,ie)}function Si(ie,p,b){function T(z,j){let X=ie.removeEventListener;X&&X.call(ie,z,j,!1)}function P(z){let j,X;ie.nodeName&&(p?(j={})[p]=!0:j=z,Nt(j,function(re,de){if(z[de])for(X=z[de].length;X--;)T(de,z[de][X].fn)}))}let O=typeof ie=="function"&&ie.prototype||ie;if(Object.hasOwnProperty.call(O,"hcEvents")){let z=O.hcEvents;if(p){let j=z[p]||[];b?(z[p]=j.filter(function(X){return b!==X.fn}),T(p,b)):(P(z),z[p]=[])}else P(z),delete O.hcEvents}}function pi(ie,p,b,T){if(b=b||{},(ui==null?void 0:ui.createEvent)&&(ie.dispatchEvent||ie.fireEvent&&ie!==Je)){let P=ui.createEvent("Events");P.initEvent(p,!0,!0),b=pr(P,b),ie.dispatchEvent?ie.dispatchEvent(b):ie.fireEvent(p,b)}else if(ie.hcEvents){b.target||pr(b,{preventDefault:function(){b.defaultPrevented=!0},target:ie,type:p});let P=[],O=ie,z=!1;for(;O.hcEvents;)Object.hasOwnProperty.call(O,"hcEvents")&&O.hcEvents[p]&&(P.length&&(z=!0),P.unshift.apply(P,O.hcEvents[p])),O=Object.getPrototypeOf(O);z&&P.sort((j,X)=>j.order-X.order),P.forEach(j=>{j.fn.call(ie,b)===!1&&b.preventDefault()})}T&&!b.defaultPrevented&&T.call(ie,b)}let St=function(){let ie=Math.random().toString(36).substring(2,9)+"-",p=0;return function(){return"highcharts-"+(n?"":ie)+p++}}();Vt.jQuery&&(Vt.jQuery.fn.highcharts=function(){let ie=[].slice.call(arguments);if(this[0])return ie[0]?(new Je[Zt(ie[0])?ie.shift():"Chart"](this[0],ie[0],ie[1]),this):dt[ji(this[0],"data-highcharts-chart")]});let Ht={addEvent:function(ie,p,b,T={}){let P=typeof ie=="function"&&ie.prototype||ie;Object.hasOwnProperty.call(P,"hcEvents")||(P.hcEvents={});let O=P.hcEvents;Je.Point&&ie instanceof Je.Point&&ie.series&&ie.series.chart&&(ie.series.chart.runTrackerClick=!0);let z=ie.addEventListener;z&&z.call(ie,p,b,!!Je.supportsPassiveEvents&&{passive:T.passive===void 0?p.indexOf("touch")!==-1:T.passive,capture:!1}),O[p]||(O[p]=[]);let j={fn:b,order:typeof T.order=="number"?T.order:1/0};return O[p].push(j),O[p].sort((X,re)=>X.order-re.order),function(){Si(ie,p,b)}},arrayMax:function(ie){let p=ie.length,b=ie[0];for(;p--;)ie[p]>b&&(b=ie[p]);return b},arrayMin:function(ie){let p=ie.length,b=ie[0];for(;p--;)ie[p]<b&&(b=ie[p]);return b},attr:ji,clamp:function(ie,p,b){return ie>p?ie<b?ie:b:p},clearTimeout:function(ie){cr(ie)&&clearTimeout(ie)},correctFloat:Lt,createElement:function(ie,p,b,T,P){let O=ui.createElement(ie);return p&&pr(O,p),P&&ni(O,{padding:"0",border:"none",margin:"0"}),b&&ni(O,b),T&&T.appendChild(O),O},crisp:function(ie,p=0,b){let T=p%2/2,P=b?-1:1;return(Math.round(ie*P-T)+T)*P},css:ni,defined:cr,destroyObjectProperties:function(ie,p,b){Nt(ie,function(T,P){T!==p&&(T!=null&&T.destroy)&&T.destroy(),(T!=null&&T.destroy||!b)&&delete ie[P]})},diffObjects:function(ie,p,b,T){let P={};return function O(z,j,X,re){let de=b?j:z;Nt(z,function(ne,ce){if(!re&&T&&T.indexOf(ce)>-1&&j[ce]){ne=nn(ne),X[ce]=[];for(let ye=0;ye<Math.max(ne.length,j[ce].length);ye++)j[ce][ye]&&(ne[ye]===void 0?X[ce][ye]=j[ce][ye]:(X[ce][ye]={},O(ne[ye],j[ce][ye],X[ce][ye],re+1)))}else Ui(ne,!0)&&!ne.nodeType?(X[ce]=Kt(ne)?[]:{},O(ne,j[ce]||{},X[ce],re+1),Object.keys(X[ce]).length===0&&(ce!=="colorAxis"||re!==0)&&delete X[ce]):(z[ce]!==j[ce]||ce in z&&!(ce in j))&&ce!=="__proto__"&&ce!=="constructor"&&(X[ce]=de[ce])})}(ie,p,P,0),P},discardElement:function(ie){var p;(p=ie==null?void 0:ie.parentElement)==null||p.removeChild(ie)},erase:function(ie,p){let b=ie.length;for(;b--;)if(ie[b]===p){ie.splice(b,1);break}},error:ei,extend:pr,extendClass:function(ie,p){let b=function(){};return b.prototype=new ie,pr(b.prototype,p),b},find:pt,fireEvent:pi,getAlignFactor:(ie="")=>({center:.5,right:1,middle:.5,bottom:1})[ie]||0,getClosestDistance:function(ie,p){let b,T,P,O=!p;return ie.forEach(z=>{if(z.length>1)for(P=z.length-1;P>0;P--)(T=z[P]-z[P-1])<0&&!O?(p==null||p(),p=void 0):T&&(b===void 0||T<b)&&(b=T)}),b},getMagnitude:fi,getNestedProperty:function(ie,p){let b=ie.split(".");for(;b.length&&cr(p);){let T=b.shift();if(T===void 0||T==="__proto__")return;if(T==="this"){let O;return Ui(p)&&(O=p["@this"]),O??p}let P=p[T.replace(/[\\'"]/g,"")];if(!cr(P)||typeof P=="function"||typeof P.nodeType=="number"||P===Vt)return;p=P}return p},getStyle:function ie(p,b,T){var z;let P;if(b==="width"){let j=Math.min(p.offsetWidth,p.scrollWidth),X=(z=p.getBoundingClientRect)==null?void 0:z.call(p).width;return X<j&&X>=j-1&&(j=Math.floor(X)),Math.max(0,j-(ie(p,"padding-left",!0)||0)-(ie(p,"padding-right",!0)||0))}if(b==="height")return Math.max(0,Math.min(p.offsetHeight,p.scrollHeight)-(ie(p,"padding-top",!0)||0)-(ie(p,"padding-bottom",!0)||0));let O=Vt.getComputedStyle(p,void 0);return O&&(P=O.getPropertyValue(b),Ue(T,b!=="opacity")&&(P=ur(P))),P},insertItem:function(ie,p){let b,T=ie.options.index,P=p.length;for(b=ie.options.isInternal?P:0;b<P+1;b++)if(!p[b]||Oi(T)&&T<Ue(p[b].options.index,p[b]._i)||p[b].options.isInternal){p.splice(b,0,ie);break}return b},isArray:Kt,isClass:gi,isDOMElement:rr,isFunction:function(ie){return typeof ie=="function"},isNumber:Oi,isObject:Ui,isString:Zt,merge:function(ie,...p){let b,T=[ie,...p],P={},O=function(j,X){return typeof j!="object"&&(j={}),Nt(X,function(re,de){de!=="__proto__"&&de!=="constructor"&&(!Ui(re,!0)||gi(re)||rr(re)?j[de]=X[de]:j[de]=O(j[de]||{},re))}),j};ie===!0&&(P=T[1],T=Array.prototype.slice.call(T,2));let z=T.length;for(b=0;b<z;b++)P=O(P,T[b]);return P},normalizeTickInterval:function(ie,p,b,T,P){let O,z=ie;b=Ue(b,fi(ie));let j=ie/b;for(!p&&(p=P?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],T===!1&&(b===1?p=p.filter(function(X){return X%1==0}):b<=.1&&(p=[1/b]))),O=0;O<p.length&&(z=p[O],(!P||!(z*b>=ie))&&(P||!(j<=(p[O]+(p[O+1]||p[O]))/2)));O++);return Lt(z*b,-Math.round(Math.log(.001)/Math.LN10))},objectEach:Nt,offset:function(ie){let p=ui.documentElement,b=ie.parentElement||ie.parentNode?ie.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:b.top+(Vt.pageYOffset||p.scrollTop)-(p.clientTop||0),left:b.left+(Vt.pageXOffset||p.scrollLeft)-(p.clientLeft||0),width:b.width,height:b.height}},pad:function(ie,p,b){return Array((p||2)+1-String(ie).replace("-","").length).join(b||"0")+ie},pick:Ue,pInt:ur,pushUnique:function(ie,p){return 0>ie.indexOf(p)&&!!ie.push(p)},relativeLength:function(ie,p,b){return/%$/.test(ie)?p*parseFloat(ie)/100+(b||0):parseFloat(ie)},removeEvent:Si,replaceNested:function(ie,...p){let b,T;do for(T of(b=ie,p))ie=ie.replace(T[0],T[1]);while(ie!==b);return ie},splat:nn,stableSort:function(ie,p){let b,T,P=ie.length;for(T=0;T<P;T++)ie[T].safeI=T;for(ie.sort(function(O,z){return(b=p(O,z))===0?O.safeI-z.safeI:b}),T=0;T<P;T++)delete ie[T].safeI},syncTimeout:function(ie,p,b){return p>0?setTimeout(ie,p,b):(ie.call(0,b),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(ie){return Zt(ie)?ie.substring(0,1).toUpperCase()+ie.substring(1):String(ie)},uniqueKey:St,useSerialIds:function(ie){return n=Ue(ie,n)},wrap:function(ie,p,b){let T=ie[p];ie[p]=function(){let P=arguments,O=this;return b.apply(this,[function(){return T.apply(O,arguments.length?arguments:P)}].concat([].slice.call(arguments)))}}},{pageLang:nr,win:tr}=Je,{defined:kr,error:Mr,extend:Cr,isNumber:Tn,isObject:gs,isString:wn,merge:bs,objectEach:qn,pad:Ls,splat:ma,timeUnits:Ln,ucfirst:qo}=Ht,zn=Je.isSafari&&tr.Intl&&!tr.Intl.DateTimeFormat.prototype.formatRange,za=ie=>ie.main===void 0,$o=class{constructor(ie,p){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=tr.Date,this.update(ie),this.lang=p}update(ie={}){this.dTLCache={},this.options=ie=bs(!0,this.options,ie);let{timezoneOffset:p,useUTC:b,locale:T}=ie;this.Date=ie.Date||tr.Date||Date;let P=ie.timezone;kr(b)&&(P=b?"UTC":void 0),p&&p%60==0&&(P="Etc/GMT"+(p>0?"+":"")+p/60),this.variableTimezone=P!=="UTC"&&(P==null?void 0:P.indexOf("Etc/GMT"))!==0,this.timezone=P,this.lang&&T&&(this.lang.locale=T),["months","shortMonths","weekdays","shortWeekdays"].forEach(O=>{let z=/months/i.test(O),j=/short/.test(O),X={timeZone:"UTC"};X[z?"month":"weekday"]=j?"short":"long",this[O]=(z?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(re=>this.dateFormat(X,(z?31:1)*24*36e5*re))})}toParts(ie){let[p,b,T,P,O,z,j]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},ie,"es").split(/(?:, | |\/|:)/g);return[P,T-1,b,O,z,j,Math.floor(Number(ie)||0)%1e3,"DLMXJVS".indexOf(p)].map(Number)}dateTimeFormat(ie,p,b=this.options.locale||nr){let T=JSON.stringify(ie)+b;wn(ie)&&(ie=this.str2dtf(ie));let P=this.dTLCache[T];if(!P){ie.timeZone??(ie.timeZone=this.timezone);try{P=new Intl.DateTimeFormat(b,ie)}catch(O){/Invalid time zone/i.test(O.message)?(Mr(34),ie.timeZone="UTC",P=new Intl.DateTimeFormat(b,ie)):Mr(O.message,!1)}}return this.dTLCache[T]=P,(P==null?void 0:P.format(p))||""}str2dtf(ie,p={}){let b={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(b).forEach(T=>{ie.indexOf(T)!==-1&&Cr(p,b[T])}),p}makeTime(ie,p,b=1,T=0,P,O,z){let j=this.Date.UTC(ie,p,b,T,P||0,O||0,z||0);if(this.timezone!=="UTC"){let X=this.getTimezoneOffset(j);if(j+=X,[2,3,8,9,10,11].indexOf(p)!==-1&&(T<5||T>20)){let re=this.getTimezoneOffset(j);X!==re?j+=re-X:X-36e5!==this.getTimezoneOffset(j-36e5)||zn||(j-=36e5)}}return j}parse(ie){if(!wn(ie))return ie??void 0;let p=(ie=ie.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(ie),b=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(ie);p||b||(ie+="Z");let T=Date.parse(ie);if(Tn(T))return T+(!p||b?this.getTimezoneOffset(T):0)}getTimezoneOffset(ie){if(this.timezone!=="UTC"){let[p,b,T,P,O=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},ie,"en").split(/(GMT|:)/).map(Number),z=-(60*(T+O/60)*6e4);if(Tn(z))return z}return 0}dateFormat(ie,p,b){let T=this.lang;if(!kr(p)||isNaN(p))return(T==null?void 0:T.invalidDate)||"";if(wn(ie=ie??"%Y-%m-%d %H:%M:%S")){let P,O=/%\[([a-zA-Z]+)\]/g;for(;P=O.exec(ie);)ie=ie.replace(P[0],this.dateTimeFormat(P[1],p,T==null?void 0:T.locale))}if(wn(ie)&&ie.indexOf("%")!==-1){let P=this,[O,z,j,X,re,de,ne,ce]=this.toParts(p),ye=(T==null?void 0:T.weekdays)||this.weekdays,Te=(T==null?void 0:T.shortWeekdays)||this.shortWeekdays,De=(T==null?void 0:T.months)||this.months,Oe=(T==null?void 0:T.shortMonths)||this.shortMonths;qn(Cr({a:Te?Te[ce]:ye[ce].substr(0,3),A:ye[ce],d:Ls(j),e:Ls(j,2," "),w:ce,v:(T==null?void 0:T.weekFrom)??"",b:Oe[z],B:De[z],m:Ls(z+1),o:z+1,y:O.toString().substr(2,2),Y:O,H:Ls(X),k:X,I:Ls(X%12||12),l:X%12||12,M:Ls(re),p:X<12?"AM":"PM",P:X<12?"am":"pm",S:Ls(de),L:Ls(ne,3)},Je.dateFormats),function(Be,Ke){if(wn(ie))for(;ie.indexOf("%"+Ke)!==-1;)ie=ie.replace("%"+Ke,typeof Be=="function"?Be.call(P,p):Be)})}else if(gs(ie)){let P=(this.getTimezoneOffset(p)||0)/36e5,O=this.timezone||"Etc/GMT"+(P>=0?"+":"")+P,{prefix:z="",suffix:j=""}=ie;ie=z+this.dateTimeFormat(Cr({timeZone:O},ie),p)+j}return b?qo(ie):ie}resolveDTLFormat(ie){return gs(ie,!0)?gs(ie,!0)&&za(ie)?{main:ie}:ie:{main:(ie=ma(ie))[0],from:ie[1],to:ie[2]}}getDateFormat(ie,p,b,T){let P=this.dateFormat("%m-%d %H:%M:%S.%L",p),O="01-01 00:00:00.000",z={millisecond:15,second:12,minute:9,hour:6,day:3},j="millisecond",X=j;for(j in Ln){if(ie&&ie===Ln.week&&+this.dateFormat("%w",p)===b&&P.substr(6)===O.substr(6)){j="week";break}if(ie&&Ln[j]>ie){j=X;break}if(z[j]&&P.substr(z[j])!==O.substr(z[j]))break;j!=="week"&&(X=j)}return this.resolveDTLFormat(T[j]).main}},{defined:Aa,extend:ja,timeUnits:Yn}=Ht,hl=class extends $o{getTimeTicks(ie,p,b,T){let P=this,O=[],z={},{count:j=1,unitRange:X}=ie,[re,de,ne,ce,ye,Te]=P.toParts(p),De=(p||0)%1e3,Oe;if(T??(T=1),Aa(p)){if(De=X>=Yn.second?0:j*Math.floor(De/j),X>=Yn.second&&(Te=X>=Yn.minute?0:j*Math.floor(Te/j)),X>=Yn.minute&&(ye=X>=Yn.hour?0:j*Math.floor(ye/j)),X>=Yn.hour&&(ce=X>=Yn.day?0:j*Math.floor(ce/j)),X>=Yn.day&&(ne=X>=Yn.month?1:Math.max(1,j*Math.floor(ne/j))),X>=Yn.month&&(de=X>=Yn.year?0:j*Math.floor(de/j)),X>=Yn.year&&(re-=re%j),X===Yn.week){j&&(p=P.makeTime(re,de,ne,ce,ye,Te,De));let st=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},p,"es"),Bt="DLMXJVS".indexOf(st);ne+=-Bt+T+(Bt<T?-7:0)}p=P.makeTime(re,de,ne,ce,ye,Te,De),P.variableTimezone&&Aa(b)&&(Oe=b-p>4*Yn.month||P.getTimezoneOffset(p)!==P.getTimezoneOffset(b));let Be=p,Ke=1;for(;Be<b;)O.push(Be),X===Yn.year?Be=P.makeTime(re+Ke*j,0):X===Yn.month?Be=P.makeTime(re,de+Ke*j):Oe&&(X===Yn.day||X===Yn.week)?Be=P.makeTime(re,de,ne+Ke*j*(X===Yn.day?1:7)):Oe&&X===Yn.hour&&j>1?Be=P.makeTime(re,de,ne,ce+Ke*j):Be+=X*j,Ke++;O.push(Be),X<=Yn.hour&&O.length<1e4&&O.forEach(st=>{st%18e5==0&&P.dateFormat("%H%M%S%L",st)==="000000000"&&(z[st]="day")})}return O.info=ja(ie,{higherRanks:z,totalRange:X*j}),O}},{isTouchDevice:fr}=Je,{fireEvent:tc,merge:Sh}=Ht,bl={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{color:"#333333",fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:ie=>Math.sqrt(1-Math.pow(ie-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:fr?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}"></span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},Un=new hl(bl.time,bl.lang),vi={defaultOptions:bl,defaultTime:Un,getOptions:function(){return bl},setOptions:function(ie){var p;return tc(Je,"setOptions",{options:ie}),Sh(!0,bl,ie),ie.time&&Un.update(bl.time),ie.lang&&"locale"in ie.lang&&Un.update({locale:ie.lang.locale}),(p=ie.lang)!=null&&p.chartTitle&&(bl.title={...bl.title,text:ie.lang.chartTitle}),bl}},{win:Ge}=Je,{isNumber:Fe,isString:rt,merge:xt,pInt:ft,defined:Jt}=Ht,xi=(ie,p,b)=>`color-mix(in srgb,${ie},${p} ${100*b}%)`,ti=ie=>rt(ie)&&!!ie&&ie!=="none";class ai{static parse(p){return p?new ai(p):ai.None}constructor(p){let b,T,P,O;this.rgba=[NaN,NaN,NaN,NaN],this.input=p;let z=Je.Color;if(z&&z!==ai)return new z(p);if(typeof p=="object"&&p.stops!==void 0)this.stops=p.stops.map(j=>new ai(j[1]));else if(typeof p=="string")for(this.input=p=ai.names[p.toLowerCase()]||p,P=ai.parsers.length;P--&&!T;)(b=(O=ai.parsers[P]).regex.exec(p))&&(T=O.parse(b));T&&(this.rgba=T)}get(p){let b=this.input,T=this.rgba;if(this.output)return this.output;if(typeof b=="object"&&this.stops!==void 0){let P=xt(b);return P.stops=[].slice.call(P.stops),this.stops.forEach((O,z)=>{P.stops[z]=[P.stops[z][0],O.get(p)]}),P}return T&&Fe(T[0])?p!=="rgb"&&(p||T[3]!==1)?p==="a"?`${T[3]}`:"rgba("+T.join(",")+")":"rgb("+T[0]+","+T[1]+","+T[2]+")":b}brighten(p){let b=this.rgba;if(this.stops)this.stops.forEach(function(T){T.brighten(p)});else if(Fe(p)&&p!==0)if(Fe(b[0]))for(let T=0;T<3;T++)b[T]+=ft(255*p),b[T]<0&&(b[T]=0),b[T]>255&&(b[T]=255);else ai.useColorMix&&ti(this.input)&&(this.output=xi(this.input,p>0?"white":"black",Math.abs(p)));return this}setOpacity(p){return this.rgba[3]=p,this}tweenTo(p,b){let T=this.rgba,P=p.rgba;if(!Fe(T[0])||!Fe(P[0]))return ai.useColorMix&&ti(this.input)&&ti(p.input)&&b<.99?xi(this.input,p.input,b):p.input||"none";let O=P[3]!==1||T[3]!==1,z=(X,re)=>X+(T[re]-X)*(1-b),j=P.slice(0,3).map(z).map(Math.round);return O&&j.push(z(P[3],3)),(O?"rgba(":"rgb(")+j.join(",")+")"}}ai.names={white:"#ffffff",black:"#000000"},ai.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(ie){return[ft(ie[1]),ft(ie[2]),ft(ie[3]),parseFloat(ie[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(ie){return[ft(ie[1]),ft(ie[2]),ft(ie[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(ie){return[ft(ie[1]+ie[1],16),ft(ie[2]+ie[2],16),ft(ie[3]+ie[3],16),Jt(ie[4])?ft(ie[4]+ie[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(ie){return[ft(ie[1],16),ft(ie[2],16),ft(ie[3],16),Jt(ie[4])?ft(ie[4],16)/255:1]}}],ai.useColorMix=($w=Ge.CSS)==null?void 0:$w.supports("color","color-mix(in srgb,red,blue 9%)"),ai.None=new ai("");let{parse:Yi}=ai,{win:Fi}=Je,{isNumber:Pr,objectEach:ln}=Ht;class Qr{constructor(p,b,T){this.pos=NaN,this.options=b,this.elem=p,this.prop=T}dSetter(){let p=this.paths,b=p==null?void 0:p[0],T=p==null?void 0:p[1],P=this.now||0,O=[];if(P!==1&&b&&T)if(b.length===T.length&&P<1)for(let z=0;z<T.length;z++){let j=b[z],X=T[z],re=[];for(let de=0;de<X.length;de++){let ne=j[de],ce=X[de];Pr(ne)&&Pr(ce)&&(X[0]!=="A"||de!==4&&de!==5)?re[de]=ne+P*(ce-ne):re[de]=ce}O.push(re)}else O=T;else O=this.toD||[];this.elem.attr("d",O,void 0,!0)}update(){let p=this.elem,b=this.prop,T=this.now,P=this.options.step;this[b+"Setter"]?this[b+"Setter"]():p.attr?p.element&&p.attr(b,T,null,!0):p.style[b]=T+this.unit,P&&P.call(p,T,this)}run(p,b,T){let P=this,O=P.options,z=function(re){return!z.stopped&&P.step(re)},j=Fi.requestAnimationFrame||function(re){setTimeout(re,13)},X=function(){for(let re=0;re<Qr.timers.length;re++)Qr.timers[re]()||Qr.timers.splice(re--,1);Qr.timers.length&&j(X)};p!==b||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=p,this.end=b,this.unit=T,this.now=this.start,this.pos=0,z.elem=this.elem,z.prop=this.prop,z()&&Qr.timers.push(z)===1&&j(X)):(delete O.curAnim[this.prop],O.complete&&Object.keys(O.curAnim).length===0&&O.complete.call(this.elem))}step(p){let b,T,P=+new Date,O=this.options,z=this.elem,j=O.complete,X=O.duration,re=O.curAnim;return z.attr&&!z.element?b=!1:p||P>=X+this.startTime?(this.now=this.end,this.pos=1,this.update(),re[this.prop]=!0,T=!0,ln(re,function(de){de!==!0&&(T=!1)}),T&&j&&j.call(z),b=!1):(this.pos=O.easing((P-this.startTime)/X),this.now=this.start+(this.end-this.start)*this.pos,this.update(),b=!0),b}initPath(p,b,T){let P=p.startX,O=p.endX,z=T.slice(),j=p.isArea,X=j?2:1,re=b&&T.length>b.length&&T.hasStackedCliffs,de,ne,ce,ye,Te=b==null?void 0:b.slice();if(!Te||re)return[z,z];function De(Be,Ke){for(;Be.length<ne;){let st=Be[0],Bt=Ke[ne-Be.length];if(Bt&&st[0]==="M"&&(Bt[0]==="C"?Be[0]=["C",st[1],st[2],st[1],st[2],st[1],st[2]]:Be[0]=["L",st[1],st[2]]),Be.unshift(st),j){let Ut=Be.pop();Be.push(Be[Be.length-1],Ut)}}}function Oe(Be){for(;Be.length<ne;){let Ke=Be[Math.floor(Be.length/X)-1].slice();if(Ke[0]==="C"&&(Ke[1]=Ke[5],Ke[2]=Ke[6]),j){let st=Be[Math.floor(Be.length/X)].slice();Be.splice(Be.length/2,0,Ke,st)}else Be.push(Ke)}}if(P&&O&&O.length){for(ce=0;ce<P.length;ce++)if(P[ce]===O[0]){de=ce;break}else if(P[0]===O[O.length-P.length+ce]){de=ce,ye=!0;break}else if(P[P.length-1]===O[O.length-P.length+ce]){de=P.length-ce;break}de===void 0&&(Te=[])}return Te.length&&Pr(de)&&(ne=z.length+de*X,ye?(De(Te,z),Oe(z)):(De(z,Te),Oe(Te))),[Te,z]}fillSetter(){Qr.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,Yi(this.start).tweenTo(Yi(this.end),this.pos),void 0,!0)}}Qr.timers=[];let{defined:Or,getStyle:ii,isArray:xr,isNumber:Xr,isObject:tn,merge:Jn,objectEach:ds,pick:mi}=Ht;function _r(ie){return tn(ie)?Jn({duration:500,defer:0},ie):{duration:500*!!ie,defer:0}}function zi(ie,p){let b=Qr.timers.length;for(;b--;)Qr.timers[b].elem!==ie||p&&p!==Qr.timers[b].prop||(Qr.timers[b].stopped=!0)}let zr={animate:function(ie,p,b){let T,P="",O,z,j;tn(b)||(j=arguments,b={duration:j[2],easing:j[3],complete:j[4]}),Xr(b.duration)||(b.duration=400),b.easing=typeof b.easing=="function"?b.easing:Math[b.easing]||Math.easeInOutSine,b.curAnim=Jn(p),ds(p,function(X,re){zi(ie,re),z=new Qr(ie,b,re),O=void 0,re==="d"&&xr(p.d)?(z.paths=z.initPath(ie,ie.pathArray,p.d),z.toD=p.d,T=0,O=1):ie.attr?T=ie.attr(re):(T=parseFloat(ii(ie,re))||0,re!=="opacity"&&(P="px")),O||(O=X),typeof O=="string"&&O.match("px")&&(O=O.replace(/px/g,"")),z.run(T,O,P)})},animObject:_r,getDeferredAnimation:function(ie,p,b){let T=_r(p),P=b?[b]:ie.series,O=0,z=0;return P.forEach(j=>{let X=_r(j.options.animation);O=tn(p)&&Or(p.defer)?T.defer:Math.max(O,X.duration+X.defer),z=Math.min(T.duration,X.duration)}),ie.renderer.forExport&&(O=0),{defer:Math.max(0,O-z),duration:Math.min(O,z)}},setAnimation:function(ie,p){p.renderer.globalAnimation=mi(ie,p.options.chart.animation,!0)},stop:zi},{SVG_NS:Yr,win:yr}=Je,{attr:Hr,createElement:rn,css:is,error:Ps,isFunction:vs,isString:ra,objectEach:Po,splat:Sc}=Ht,{trustedTypes:Xl}=yr,lh=Xl&&vs(Xl.createPolicy)&&Xl.createPolicy("highcharts",{createHTML:ie=>ie}),ps=lh?lh.createHTML(""):"";class la{static filterUserAttributes(p){return Po(p,(b,T)=>{let P=!0;la.allowedAttributes.indexOf(T)===-1&&(P=!1),["background","dynsrc","href","lowsrc","src"].indexOf(T)!==-1&&(P=ra(b)&&la.allowedReferences.some(O=>b.indexOf(O)===0)),P||(Ps(33,!1,void 0,{"Invalid attribute in config":`${T}`}),delete p[T]),ra(b)&&p[T]&&(p[T]=b.replace(/</g,"&lt;"))}),p}static parseStyle(p){return p.split(";").reduce((b,T)=>{let P=T.split(":").map(z=>z.trim()),O=P.shift();return O&&P.length&&(b[O.replace(/-([a-z])/g,z=>z[1].toUpperCase())]=P.join(":")),b},{})}static setElementHTML(p,b){p.innerHTML=la.emptyHTML,b&&new la(b).addToDOM(p)}constructor(p){this.nodes=typeof p=="string"?this.parseMarkup(p):p}addToDOM(p){return function b(T,P){let O;return Sc(T).forEach(function(z){let j,X=z.tagName,re=z.textContent?Je.doc.createTextNode(z.textContent):void 0,de=la.bypassHTMLFiltering;if(X)if(X==="#text")j=re;else if(la.allowedTags.indexOf(X)!==-1||de){let ne=X==="svg"?Yr:P.namespaceURI||Yr,ce=Je.doc.createElementNS(ne,X),ye=z.attributes||{};Po(z,function(Te,De){De!=="tagName"&&De!=="attributes"&&De!=="children"&&De!=="style"&&De!=="textContent"&&(ye[De]=Te)}),Hr(ce,de?ye:la.filterUserAttributes(ye)),z.style&&is(ce,z.style),re&&ce.appendChild(re),b(z.children||[],ce),j=ce}else Ps(33,!1,void 0,{"Invalid tagName in config":X});j&&P.appendChild(j),O=j}),O}(this.nodes,p)}parseMarkup(p){let b,T=[];p=p.trim().replace(/ style=(["'])/g," data-style=$1");try{b=new DOMParser().parseFromString(lh?lh.createHTML(p):p,"text/html")}catch{}if(!b){let O=rn("div");O.innerHTML=p,b={body:O}}let P=(O,z)=>{let j=O.nodeName.toLowerCase(),X={tagName:j};j==="#text"&&(X.textContent=O.textContent||"");let re=O.attributes;if(re){let de={};[].forEach.call(re,ne=>{ne.name==="data-style"?X.style=la.parseStyle(ne.value):de[ne.name]=ne.value}),X.attributes=de}if(O.childNodes.length){let de=[];[].forEach.call(O.childNodes,ne=>{P(ne,de)}),de.length&&(X.children=de)}z.push(X)};return[].forEach.call(b.body.childNodes,O=>P(O,T)),T}}la.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","disabled","dx","dy","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","result","role","rowspan","scope","slope","src","startOffset","stdDeviation","stroke-linecap","stroke-width","stroke","style","summary","tabindex","tableValues","target","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],la.allowedReferences=["https://","http://","mailto:","/","../","./","#"],la.allowedTags=["#text","a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","tbody","td","text","textPath","th","thead","title","tr","tspan","u","ul"],la.emptyHTML=ps,la.bypassHTMLFiltering=!1;let{defaultOptions:$u,defaultTime:_u}=vi,{pageLang:ch}=Je,{extend:Lc,getNestedProperty:zc,isArray:Kh,isNumber:ul,isObject:Uc,isString:du,pick:Yc,ucfirst:Ds}=Ht,Ys={add:(ie,p)=>ie+p,divide:(ie,p)=>p!==0?ie/p:"",eq:(ie,p)=>ie==p,each:function(ie){let p=arguments[arguments.length-1];return!!Kh(ie)&&ie.map((b,T)=>Xs(p.body,Lc(Uc(b)?b:{"@this":b},{"@index":T,"@first":T===0,"@last":T===ie.length-1}))).join("")},ge:(ie,p)=>ie>=p,gt:(ie,p)=>ie>p,if:ie=>!!ie,le:(ie,p)=>ie<=p,lt:(ie,p)=>ie<p,multiply:(ie,p)=>ie*p,ne:(ie,p)=>ie!=p,subtract:(ie,p)=>ie-p,ucfirst:Ds,unless:ie=>!ie},Cs={},to=ie=>/^["'].+["']$/.test(ie);function Xs(ie="",p,b){var Oe;let T=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= #\(\)]+)\}/g,P=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,O=[],z=/f$/,j=/\.(\d)/,X=((Oe=b==null?void 0:b.options)==null?void 0:Oe.lang)||$u.lang,re=(b==null?void 0:b.time)||_u,de=(b==null?void 0:b.numberFormatter)||Bs.bind(b),ne=(Be="")=>{let Ke;return Be==="true"||Be!=="false"&&((Ke=Number(Be)).toString()===Be?Ke:to(Be)?Be.slice(1,-1):zc(Be,p))},ce,ye,Te=0,De;for(;(ce=T.exec(ie))!==null;){let Be=ce,Ke=P.exec(ce[1]);Ke&&(ce=Ke,De=!0),ye!=null&&ye.isBlock||(ye={ctx:p,expression:ce[1],find:ce[0],isBlock:ce[1].charAt(0)==="#",start:ce.index,startInner:ce.index+ce[0].length,length:ce[0].length});let st=(ye.isBlock?Be:ce)[1].split(" ")[0].replace("#","");Ys[st]&&(ye.isBlock&&st===ye.fn&&Te++,ye.fn||(ye.fn=st));let Bt=ce[1]==="else";if(ye.isBlock&&ye.fn&&(ce[1]===`/${ye.fn}`||Bt))if(Te)!Bt&&Te--;else{let Ut=ye.startInner,$t=ie.substr(Ut,ce.index-Ut);ye.body===void 0?(ye.body=$t,ye.startInner=ce.index+ce[0].length):ye.elseBody=$t,ye.find+=$t+ce[0],Bt||(O.push(ye),ye=void 0)}else ye.isBlock||O.push(ye);if(Ke&&!(ye!=null&&ye.isBlock))break}return O.forEach(Be=>{let Ke,st,{body:Bt,elseBody:Ut,expression:$t,fn:ci}=Be;if(ci){let oi=[Be],di=[],er=$t.length,Vi=0,lr;for(st=0;st<=er;st++){let Vr=$t.charAt(st);lr||Vr!=='"'&&Vr!=="'"?lr===Vr&&(lr=""):lr=Vr,lr||Vr!==" "&&st!==er||(di.push($t.substr(Vi,st-Vi)),Vi=st+1)}for(st=Ys[ci].length;st--;)oi.unshift(ne(di[st+1]));Ke=Ys[ci].apply(p,oi),Be.isBlock&&typeof Ke=="boolean"&&(Ke=Xs(Ke?Bt:Ut,p,b))}else{let oi=to($t)?[$t]:$t.split(":"),di=(Ke=ne(oi.shift()||""))%1!=0;if(typeof Ke=="number"&&(oi.length||di)){let er=oi.join(":");if(z.test(er)||di){let Vi=parseInt((er.match(j)||["","-1"])[1],10);Ke!==null&&(Ke=de(Ke,Vi,X.decimalPoint,er.indexOf(",")>-1?X.thousandsSep:""))}else Ke=re.dateFormat(er,Ke)}P.lastIndex=0,P.test(Be.find)&&du(Ke)&&(Ke=`"${Ke}"`)}ie=ie.replace(Be.find,Yc(Ke,""))}),De?Xs(ie,p,b):ie}function Bs(ie,p,b,T){var De;p*=1;let P,O,[z,j]=(ie=+ie||0).toString().split("e").map(Number),X=((De=this==null?void 0:this.options)==null?void 0:De.lang)||$u.lang,re=(ie.toString().split(".")[1]||"").split("e")[0].length,de=p,ne={};b??(b=X.decimalPoint),T??(T=X.thousandsSep),p===-1?p=Math.min(re,20):ul(p)?p&&j<0&&((O=p+j)>=0?(z=+z.toExponential(O).split("e")[0],p=O):(z=Math.floor(z),ie=p<20?+(z*Math.pow(10,j)).toFixed(p):0,j=0)):p=2,j&&(p??(p=2),ie=z),ul(p)&&p>=0&&(ne.minimumFractionDigits=p,ne.maximumFractionDigits=p),T===""&&(ne.useGrouping=!1);let ce=T||b,ye=ce?"en":(this==null?void 0:this.locale)||X.locale||ch,Te=JSON.stringify(ne)+ye;return P=(Cs[Te]??(Cs[Te]=new Intl.NumberFormat(ye,ne))).format(ie),ce&&(P=P.replace(/([,\.])/g,"_$1").replace(/_\,/g,T??",").replace("_.",b??".")),(p||+P!=0)&&(!(j<0)||de)||(P="0"),j&&+P!=0&&(P+="e"+(j<0?"":"+")+j),P}let ba={dateFormat:function(ie,p,b){return _u.dateFormat(ie,p,b)},format:Xs,helpers:Ys,numberFormat:Bs};(function(ie){let p;ie.rendererTypes={},ie.getRendererType=function(b=p){return ie.rendererTypes[b]||ie.rendererTypes[p]},ie.registerRendererType=function(b,T,P){ie.rendererTypes[b]=T,(!p||P)&&(p=b,Je.Renderer=T)}})(E||(E={}));let ca=E,{clamp:fh,pick:Il,pushUnique:Dp,stableSort:Th}=Ht;(L||(L={})).distribute=function ie(p,b,T){let P=p,O=P.reducedLen||b,z=(st,Bt)=>st.target-Bt.target,j=[],X=p.length,re=[],de=j.push,ne,ce,ye,Te=!0,De,Oe,Be=0,Ke;for(ne=X;ne--;)Be+=p[ne].size;if(Be>O){for(Th(p,(st,Bt)=>(Bt.rank||0)-(st.rank||0)),ye=(Ke=p[0].rank===p[p.length-1].rank)?X/2:-1,ce=Ke?ye:X-1;ye&&Be>O;)De=p[ne=Math.floor(ce)],Dp(re,ne)&&(Be-=De.size),ce+=ye,Ke&&ce>=p.length&&(ye/=2,ce=ye);re.sort((st,Bt)=>Bt-st).forEach(st=>de.apply(j,p.splice(st,1)))}for(Th(p,z),p=p.map(st=>({size:st.size,targets:[st.target],align:Il(st.align,.5)}));Te;){for(ne=p.length;ne--;)De=p[ne],Oe=(Math.min.apply(0,De.targets)+Math.max.apply(0,De.targets))/2,De.pos=fh(Oe-De.size*De.align,0,b-De.size);for(ne=p.length,Te=!1;ne--;)ne>0&&p[ne-1].pos+p[ne-1].size>p[ne].pos&&(p[ne-1].size+=p[ne].size,p[ne-1].targets=p[ne-1].targets.concat(p[ne].targets),p[ne-1].align=.5,p[ne-1].pos+p[ne-1].size>b&&(p[ne-1].pos=b-p[ne-1].size),p.splice(ne,1),Te=!0)}return de.apply(P,j),ne=0,p.some(st=>{let Bt=0;return(st.targets||[]).some(()=>(P[ne].pos=st.pos+Bt,T!==void 0&&Math.abs(P[ne].pos-P[ne].target)>T?(P.slice(0,ne+1).forEach(Ut=>delete Ut.pos),P.reducedLen=(P.reducedLen||b)-.1*b,P.reducedLen>.1*b&&ie(P,b,T),!0):(Bt+=P[ne].size,ne++,!1)))}),Th(P,z),P};let Vs=L,{animate:pu,animObject:vu,stop:Qh}=zr,{deg2rad:Vf,doc:Tc,svg:hp,SVG_NS:mh,win:qa,isFirefox:Ka}=Je,{addEvent:zd,attr:Vu,createElement:Nh,crisp:Ud,css:up,defined:hc,erase:fu,extend:Ha,fireEvent:Ll,getAlignFactor:vd,isArray:Bh,isFunction:Wu,isNumber:Xc,isObject:Ma,isString:Cc,merge:Fh,objectEach:ao,pick:Dl,pInt:xu,pushUnique:af,replaceNested:kn,syncTimeout:lf,uniqueKey:ic}=Ht;class wl{_defaultGetter(p){let b=Dl(this[p+"Value"],this[p],this.element?this.element.getAttribute(p):null,0);return/^-?[\d\.]+$/.test(b)&&(b=parseFloat(b)),b}_defaultSetter(p,b,T){T.setAttribute(b,p)}add(p){let b,T=this.renderer,P=this.element;return p&&(this.parentGroup=p),this.textStr!==void 0&&this.element.nodeName==="text"&&T.buildText(this),this.added=!0,(!p||p.handleZ||this.zIndex)&&(b=this.zIndexSetter()),b||(p?p.element:T.box).appendChild(P),this.onAdd&&this.onAdd(),this}addClass(p,b){let T=b?"":this.attr("class")||"";return(p=(p||"").split(/ /g).reduce(function(P,O){return T.indexOf(O)===-1&&P.push(O),P},T?[T]:[]).join(" "))!==T&&this.attr("class",p),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(p,b,T,P=!0){let O=this.renderer,z=O.alignedObjects,j=!!p;p?(this.alignOptions=p,this.alignByTranslate=b,this.alignTo=T):(p=this.alignOptions||{},b=this.alignByTranslate,T=this.alignTo);let X=!T||Cc(T)?T||"renderer":void 0;X&&(j&&af(z,this),T=void 0);let re=Dl(T,O[X],O),de=(re.x||0)+(p.x||0)+((re.width||0)-(p.width||0))*vd(p.align),ne=(re.y||0)+(p.y||0)+((re.height||0)-(p.height||0))*vd(p.verticalAlign),ce={"text-align":p==null?void 0:p.align};return ce[b?"translateX":"x"]=Math.round(de),ce[b?"translateY":"y"]=Math.round(ne),P&&(this[this.placed?"animate":"attr"](ce),this.placed=!0),this.alignAttr=ce,this}alignSetter(p){let b={left:"start",center:"middle",right:"end"};b[p]&&(this.alignValue=p,this.element.setAttribute("text-anchor",b[p]))}animate(p,b,T){let P=vu(Dl(b,this.renderer.globalAnimation,!0)),O=P.defer;return Tc.hidden&&(P.duration=0),P.duration!==0?(T&&(P.complete=T),lf(()=>{this.element&&pu(this,p,P)},O)):(this.attr(p,void 0,T||P.complete),ao(p,function(z,j){P.step&&P.step.call(this,z,{prop:j,pos:1,elem:this})},this)),this}applyTextOutline(p){let b=this.element;p.indexOf("contrast")!==-1&&(p=p.replace(/contrast/g,this.renderer.getContrast(b.style.fill)));let T=p.indexOf(" "),P=p.substring(T+1),O=p.substring(0,T);if(O&&O!=="none"&&Je.svg){this.fakeTS=!0,O=O.replace(/(^[\d\.]+)(.*?)$/g,function(de,ne,ce){return 2*Number(ne)+ce}),this.removeTextOutline();let z=Tc.createElementNS(mh,"tspan");Vu(z,{class:"highcharts-text-outline",fill:P,stroke:P,"stroke-width":O,"stroke-linejoin":"round"});let j=b.querySelector("textPath")||b;[].forEach.call(j.childNodes,de=>{let ne=de.cloneNode(!0);ne.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(ce=>ne.removeAttribute(ce)),z.appendChild(ne)});let X=0;[].forEach.call(j.querySelectorAll("text tspan"),de=>{X+=Number(de.getAttribute("dy"))});let re=Tc.createElementNS(mh,"tspan");re.textContent="",Vu(re,{x:Number(b.getAttribute("x")),dy:-X}),z.appendChild(re),j.insertBefore(z,j.firstChild)}}attr(p,b,T,P){let{element:O}=this,z=wl.symbolCustomAttribs,j,X,re=this,de;return typeof p=="string"&&b!==void 0&&(j=p,(p={})[j]=b),typeof p=="string"?re=(this[p+"Getter"]||this._defaultGetter).call(this,p,O):(ao(p,function(ne,ce){de=!1,P||Qh(this,ce),this.symbolName&&z.indexOf(ce)!==-1&&(X||(this.symbolAttr(p),X=!0),de=!0),this.rotation&&(ce==="x"||ce==="y")&&(this.doTransform=!0),de||(this[ce+"Setter"]||this._defaultSetter).call(this,ne,ce,O)},this),this.afterSetters()),T&&T.call(this),re}clip(p){if(p&&!p.clipPath){let b=ic()+"-",T=this.renderer.createElement("clipPath").attr({id:b}).add(this.renderer.defs);Ha(p,{clipPath:T,id:b,count:0}),p.add(T)}return this.attr("clip-path",p?`url(${this.renderer.url}#${p.id})`:"none")}crisp(p,b){b=Math.round(b||p.strokeWidth||0);let T=p.x||this.x||0,P=p.y||this.y||0,O=(p.width||this.width||0)+T,z=(p.height||this.height||0)+P,j=Ud(T,b),X=Ud(P,b);return Ha(p,{x:j,y:X,width:Ud(O,b)-j,height:Ud(z,b)-X}),hc(p.strokeWidth)&&(p.strokeWidth=b),p}complexColor(p,b,T){let P=this.renderer,O,z,j,X,re,de,ne,ce,ye,Te,De=[],Oe;Ll(this.renderer,"complexColor",{args:arguments},function(){if(p.radialGradient?z="radialGradient":p.linearGradient&&(z="linearGradient"),z){if(j=p[z],re=P.gradients,de=p.stops,ye=T.radialReference,Bh(j)&&(p[z]=j={x1:j[0],y1:j[1],x2:j[2],y2:j[3],gradientUnits:"userSpaceOnUse"}),z==="radialGradient"&&ye&&!hc(j.gradientUnits)&&(X=j,j=Fh(j,P.getRadialAttr(ye,X),{gradientUnits:"userSpaceOnUse"})),ao(j,function(Be,Ke){Ke!=="id"&&De.push(Ke,Be)}),ao(de,function(Be){De.push(Be)}),re[De=De.join(",")])Te=re[De].attr("id");else{j.id=Te=ic();let Be=re[De]=P.createElement(z).attr(j).add(P.defs);Be.radAttr=X,Be.stops=[],de.forEach(function(Ke){Ke[1].indexOf("rgba")===0?(ne=(O=ai.parse(Ke[1])).get("rgb"),ce=O.get("a")):(ne=Ke[1],ce=1);let st=P.createElement("stop").attr({offset:Ke[0],"stop-color":ne,"stop-opacity":ce}).add(Be);Be.stops.push(st)})}Oe="url("+P.url+"#"+Te+")",T.setAttribute(b,Oe),T.gradient=De,p.toString=function(){return Oe}}})}css(p){let b=this.styles,T={},P=this.element,O,z=!b;if(b&&ao(p,function(j,X){b&&b[X]!==j&&(T[X]=j,z=!0)}),z){b&&(p=Ha(b,T)),p.width===null||p.width==="auto"?delete this.textWidth:P.nodeName.toLowerCase()==="text"&&p.width&&(O=this.textWidth=xu(p.width)),Ha(this.styles,p),O&&!hp&&this.renderer.forExport&&delete p.width;let j=Ka&&p.fontSize||null;j&&(Xc(j)||/^\d+$/.test(j))&&(p.fontSize+="px");let X=Fh(p);P.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(re=>X&&delete X[re]),X.color&&(X.fill=X.color,delete X.color)),up(P,X)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),p.textOutline&&this.applyTextOutline(p.textOutline)),this}dashstyleSetter(p){let b,T=this["stroke-width"];if(T==="inherit"&&(T=1),p){let P=(p=p.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(b=P.length;b--;)P[b]=""+xu(P[b])*Dl(T,NaN);p=P.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",p)}}destroy(){let p=this,b=p.element||{},T=p.renderer,P=b.ownerSVGElement,O=b.nodeName==="SPAN"&&p.parentGroup||void 0,z,j;if(b.onclick=b.onmouseout=b.onmouseover=b.onmousemove=b.point=null,Qh(p),p.clipPath&&P){let X=p.clipPath;[].forEach.call(P.querySelectorAll("[clip-path],[CLIP-PATH]"),function(re){re.getAttribute("clip-path").indexOf(X.element.id)>-1&&re.removeAttribute("clip-path")}),p.clipPath=X.destroy()}if(p.stops){for(j=0;j<p.stops.length;j++)p.stops[j].destroy();p.stops.length=0,p.stops=void 0}for(p.safeRemoveChild(b);O!=null&&O.div&&O.div.childNodes.length===0;)z=O.parentGroup,p.safeRemoveChild(O.div),delete O.div,O=z;p.alignOptions&&fu(T.alignedObjects,p),ao(p,(X,re)=>{var de,ne,ce;(((de=p[re])==null?void 0:de.parentGroup)===p||["connector","foreignObject"].indexOf(re)!==-1)&&((ce=(ne=p[re])==null?void 0:ne.destroy)==null||ce.call(ne)),delete p[re]})}dSetter(p,b,T){Bh(p)&&(typeof p[0]=="string"&&(p=this.renderer.pathToSegments(p)),this.pathArray=p,p=p.reduce((P,O,z)=>O!=null&&O.join?(z?P+" ":"")+O.join(" "):(O||"").toString(),"")),/(NaN| {2}|^$)/.test(p)&&(p="M 0 0"),this[b]!==p&&(T.setAttribute(b,p),this[b]=p)}fillSetter(p,b,T){typeof p=="string"?T.setAttribute(b,p):p&&this.complexColor(p,b,T)}hrefSetter(p,b,T){T.setAttributeNS("http://www.w3.org/1999/xlink",b,p)}getBBox(p,b){let T,P,O,z,{alignValue:j,element:X,renderer:re,styles:de,textStr:ne}=this,{cache:ce,cacheKeys:ye}=re,Te=X.namespaceURI===this.SVG_NS,De=Dl(b,this.rotation,0),Oe=re.styledMode?X&&wl.prototype.getStyle.call(X,"font-size"):de.fontSize;if(hc(ne)&&((z=ne.toString()).indexOf("<")===-1&&(z=z.replace(/\d/g,"0")),z+=["",re.rootFontSize,Oe,De,this.textWidth,j,de.lineClamp,de.textOverflow,de.fontWeight].join(",")),z&&!p&&(T=ce[z]),!T||T.polygon){if(Te||re.forExport){try{O=this.fakeTS&&function(Ke){let st=X.querySelector(".highcharts-text-outline");st&&up(st,{display:Ke})},Wu(O)&&O("none"),T=X.getBBox?Ha({},X.getBBox()):{width:X.offsetWidth,height:X.offsetHeight,x:0,y:0},Wu(O)&&O("")}catch{}(!T||T.width<0)&&(T={x:0,y:0,width:0,height:0})}else T=this.htmlGetBBox();P=T.height,Te&&(T.height=P={"11px,17":14,"13px,20":16}[`${Oe||""},${Math.round(P)}`]||P),De&&(T=this.getRotatedBox(T,De));let Be={bBox:T};Ll(this,"afterGetBBox",Be),T=Be.bBox}if(z&&(ne===""||T.height>0)){for(;ye.length>250;)delete ce[ye.shift()];ce[z]||ye.push(z),ce[z]=T}return T}getRotatedBox(p,b){let{x:T,y:P,width:O,height:z}=p,{alignValue:j,translateY:X,rotationOriginX:re=0,rotationOriginY:de=0}=this,ne=vd(j),ce=Number(this.element.getAttribute("y")||0)-(X?0:P),ye=b*Vf,Te=(b-90)*Vf,De=Math.cos(ye),Oe=Math.sin(ye),Be=O*De,Ke=O*Oe,st=Math.cos(Te),Bt=Math.sin(Te),[[Ut,$t],[ci,oi]]=[re,de].map(Qs=>[Qs-Qs*De,Qs*Oe]),di=T+ne*(O-Be)+Ut+oi+ce*st,er=di+Be,Vi=er-z*st,lr=Vi-Be,Vr=P+ce-ne*Ke-$t+ci+ce*Bt,Wn=Vr+Ke,xn=Wn-z*Bt,Nn=xn-Ke,Bn=Math.min(di,er,Vi,lr),Xn=Math.min(Vr,Wn,xn,Nn),es=Math.max(di,er,Vi,lr)-Bn,ns=Math.max(Vr,Wn,xn,Nn)-Xn;return{x:Bn,y:Xn,width:es,height:ns,polygon:[[di,Vr],[er,Wn],[Vi,xn],[lr,Nn]]}}getStyle(p){return qa.getComputedStyle(this.element||this,"").getPropertyValue(p)}hasClass(p){return(""+this.attr("class")).split(" ").indexOf(p)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(p,b){this.onEvents={},this.opacity=1,this.SVG_NS=mh,this.element=b==="span"||b==="body"?Nh(b):Tc.createElementNS(this.SVG_NS,b),this.renderer=p,this.styles={},Ll(this,"afterInit")}on(p,b){let{onEvents:T}=this;return T[p]&&T[p](),T[p]=zd(this.element,p,b),this}opacitySetter(p,b,T){let P=Number(Number(p).toFixed(3));this.opacity=P,T.setAttribute(b,P)}reAlign(){var p;(p=this.alignOptions)!=null&&p.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(p){return this.attr("class",(""+this.attr("class")).replace(Cc(p)?RegExp(`(^| )${p}( |$)`):p," ").replace(/ +/g," ").trim())}removeTextOutline(){let p=this.element.querySelector("tspan.highcharts-text-outline");p&&this.safeRemoveChild(p)}safeRemoveChild(p){let b=p.parentNode;b&&b.removeChild(p)}setRadialReference(p){let b=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=p,b!=null&&b.radAttr&&b.animate(this.renderer.getRadialAttr(p,b.radAttr)),this}shadow(p){var O;let{renderer:b}=this,T=Fh(((O=this.parentGroup)==null?void 0:O.rotation)===90?{offsetX:-1,offsetY:-1}:{},Ma(p)?p:{}),P=b.shadowDefinition(T);return this.attr({filter:p?`url(${b.url}#${P})`:"none"})}show(p=!0){return this.attr({visibility:p?"inherit":"visible"})}"stroke-widthSetter"(p,b,T){this[b]=p,T.setAttribute(b,p)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let p=this.getStyle("stroke-width"),b=0,T;return/px$/.test(p)?b=xu(p):p!==""&&(Vu(T=Tc.createElementNS(mh,"rect"),{width:p,"stroke-width":0}),this.element.parentNode.appendChild(T),b=T.getBBox().width,T.parentNode.removeChild(T)),b}symbolAttr(p){let b=this;wl.symbolCustomAttribs.forEach(function(T){b[T]=Dl(p[T],b[T])}),b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})}textSetter(p){p!==this.textStr&&(delete this.textPxLength,this.textStr=p,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(p){let b=this.element,T=b.getElementsByTagName("title")[0]||Tc.createElementNS(this.SVG_NS,"title");b.insertBefore?b.insertBefore(T,b.firstChild):b.appendChild(T),T.textContent=kn(Dl(p,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let p=this.element;return p.parentNode.appendChild(p),this}translate(p,b){return this.attr({translateX:p,translateY:b})}updateTransform(p="transform"){let{element:b,foreignObject:T,matrix:P,padding:O,rotation:z=0,rotationOriginX:j,rotationOriginY:X,scaleX:re,scaleY:de,text:ne,translateX:ce=0,translateY:ye=0}=this,Te=["translate("+ce+","+ye+")"];hc(P)&&Te.push("matrix("+P.join(",")+")"),z&&(Te.push("rotate("+z+" "+(j??b.getAttribute("x")??this.x??0)+" "+(X??b.getAttribute("y")??this.y??0)+")"),(ne==null?void 0:ne.element.tagName)!=="SPAN"||ne!=null&&ne.foreignObject||ne.attr({rotation:z,rotationOriginX:(j||0)-O,rotationOriginY:(X||0)-O})),(hc(re)||hc(de))&&Te.push("scale("+Dl(re,1)+" "+Dl(de,1)+")"),Te.length&&!(ne||this).textPath&&((T==null?void 0:T.element)||b).setAttribute(p,Te.join(" "))}visibilitySetter(p,b,T){p==="inherit"?T.removeAttribute(b):this[b]!==p&&T.setAttribute(b,p),this[b]=p}xGetter(p){return this.element.nodeName==="circle"&&(p==="x"?p="cx":p==="y"&&(p="cy")),this._defaultGetter(p)}zIndexSetter(p,b){let T=this.renderer,P=this.parentGroup,O=(P||T).element||T.box,z=this.element,j=O===T.box,X,re,de,ne=!1,ce,ye=this.added,Te;if(hc(p)?(z.setAttribute("data-z-index",p),p*=1,this[b]===p&&(ye=!1)):hc(this[b])&&z.removeAttribute("data-z-index"),this[b]=p,ye){for((p=this.zIndex)&&P&&(P.handleZ=!0),Te=(X=O.childNodes).length-1;Te>=0&&!ne;Te--)ce=!hc(de=(re=X[Te]).getAttribute("data-z-index")),re!==z&&(p<0&&ce&&!j&&!Te?(O.insertBefore(z,X[Te]),ne=!0):(xu(de)<=p||ce&&(!hc(p)||p>=0))&&(O.insertBefore(z,X[Te+1]),ne=!0));ne||(O.insertBefore(z,X[3*!!j]),ne=!0)}return ne}}wl.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],wl.prototype.strokeSetter=wl.prototype.fillSetter,wl.prototype.yGetter=wl.prototype.xGetter,wl.prototype.matrixSetter=wl.prototype.rotationOriginXSetter=wl.prototype.rotationOriginYSetter=wl.prototype.rotationSetter=wl.prototype.scaleXSetter=wl.prototype.scaleYSetter=wl.prototype.translateXSetter=wl.prototype.translateYSetter=wl.prototype.verticalAlignSetter=function(ie,p){this[p]=ie,this.doTransform=!0};let Qa=wl,{defined:Zl,extend:$c,getAlignFactor:vn,isNumber:os,merge:Zs,pick:zl,removeEvent:bu}=Ht;class Ks extends Qa{constructor(p,b,T,P,O,z,j,X,re,de){let ne;super(p,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=b,this.x=T,this.y=P,this.anchorX=z,this.anchorY=j,this.baseline=re,this.className=de,this.addClass(de==="button"?"highcharts-no-tooltip":"highcharts-label"),de&&this.addClass("highcharts-"+de),this.text=p.text(void 0,0,0,X).attr({zIndex:1}),typeof O=="string"&&((ne=/^url\((.*?)\)$/.test(O))||this.renderer.symbols[O])&&(this.symbolKey=O),this.bBox=Ks.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=p.styledMode||ne,this.deferredAttr={},this.alignFactor=0}alignSetter(p){let b=vn(p);this.textAlign=p,b!==this.alignFactor&&(this.alignFactor=b,this.bBox&&os(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(p,b){this.anchorX=p,this.boxAttr(b,Math.round(p)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(p,b){this.anchorY=p,this.boxAttr(b,p-this.ySetting)}boxAttr(p,b){this.box?this.box.attr(p,b):this.deferredAttr[p]=b}css(p){if(p){let b={};p=Zs(p),Ks.textProps.forEach(T=>{p[T]!==void 0&&(b[T]=p[T],delete p[T])}),this.text.css(b),"fontSize"in b||"fontWeight"in b?this.updateTextPadding():("width"in b||"textOverflow"in b)&&this.updateBoxSize()}return Qa.prototype.css.call(this,p)}destroy(){bu(this.element,"mouseenter"),bu(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),Qa.prototype.destroy.call(this)}fillSetter(p,b){p&&(this.needsBox=!0),this.fill=p,this.boxAttr(b,p)}getBBox(p,b){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:T,height:P=0,translateX:O=0,translateY:z=0,width:j=0}=this,X=zl(this.paddingLeft,T),re=b??(this.rotation||0),de={width:j,height:P,x:O+this.bBox.x-X,y:z+this.bBox.y-T+this.baselineOffset};return re&&(de=this.getRotatedBox(de,re)),de}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(p){this.heightSetting=p,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:zl(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&Zl(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(p,b){os(p)?p!==this[b]&&(this[b]=p,this.updateTextPadding()):this[b]=void 0}rSetter(p,b){this.boxAttr(b,p)}strokeSetter(p,b){this.stroke=p,this.boxAttr(b,p)}"stroke-widthSetter"(p,b){p&&(this.needsBox=!0),this["stroke-width"]=p,this.boxAttr(b,p)}"text-alignSetter"(p){this.textAlign=this["text-align"]=p,this.updateTextPadding()}textSetter(p){p!==void 0&&this.text.attr({text:p}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let p,b=this.text,T={},P=this.padding,O=this.bBox=(!os(this.widthSetting)||!os(this.heightSetting)||this.textAlign)&&Zl(b.textStr)?b.getBBox(void 0,0):Ks.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||O.height||0)+2*P;let z=this.renderer.fontMetrics(b);if(this.baselineOffset=P+Math.min((this.text.firstLineMetrics||z).b,O.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-z.h)/2),this.needsBox&&!b.textPath){if(!this.box){let j=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();j.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),j.add(this)}T.x=p=this.getCrispAdjust(),T.y=(this.baseline?-this.baselineOffset:0)+p,T.width=Math.round(this.width),T.height=Math.round(this.height),this.box.attr($c(T,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let p=this.text,b=p.styles.textAlign||this.textAlign;if(!p.textPath){this.updateBoxSize();let T=this.baseline?0:this.baselineOffset,P=(this.paddingLeft??this.padding)+vn(b)*(this.widthSetting??this.bBox.width);(P!==p.x||T!==p.y)&&(p.attr({align:b,x:P}),T!==void 0&&p.attr("y",T)),p.x=P,p.y=T}}widthSetter(p){this.widthSetting=os(p)?p:void 0,this.doUpdate=!0}getPaddedWidth(){let p=this.padding,b=zl(this.paddingLeft,p),T=zl(this.paddingRight,p);return(this.widthSetting||this.bBox.width||0)+b+T}xSetter(p){this.x=p,this.alignFactor&&(p-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(p),this.attr("translateX",this.xSetting)}ySetter(p){this.ySetting=this.y=Math.round(p),this.attr("translateY",this.ySetting)}}Ks.emptyBBox={width:0,height:0,x:0,y:0},Ks.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:xd,isNumber:ju,pick:Hu}=Ht;function Sl(ie,p,b,T,P){let O=[];if(P){let z=P.start||0,j=P.end||0,X=Hu(P.r,b),re=Hu(P.r,T||b),de=2e-4/(P.borderRadius?1:Math.max(X,1)),ne=Math.abs(j-z-2*Math.PI)<de;ne&&(z=Math.PI/2,j=2.5*Math.PI-de);let ce=P.innerR,ye=Hu(P.open,ne),Te=Math.cos(z),De=Math.sin(z),Oe=Math.cos(j),Be=Math.sin(j),Ke=Hu(P.longArc,j-z-Math.PI<de?0:1),st=["A",X,re,0,Ke,Hu(P.clockwise,1),ie+X*Oe,p+re*Be];st.params={start:z,end:j,cx:ie,cy:p},O.push(["M",ie+X*Te,p+re*De],st),xd(ce)&&((st=["A",ce,ce,0,Ke,xd(P.clockwise)?1-P.clockwise:0,ie+ce*Te,p+ce*De]).params={start:j,end:z,cx:ie,cy:p},O.push(ye?["M",ie+ce*Oe,p+ce*Be]:["L",ie+ce*Oe,p+ce*Be],st)),ye||O.push(["Z"])}return O}function Ja(ie,p,b,T,P){return P!=null&&P.r?Gu(ie,p,b,T,P):[["M",ie,p],["L",ie+b,p],["L",ie+b,p+T],["L",ie,p+T],["Z"]]}function Gu(ie,p,b,T,P){let O=(P==null?void 0:P.r)||0;return[["M",ie+O,p],["L",ie+b-O,p],["A",O,O,0,0,1,ie+b,p+O],["L",ie+b,p+T-O],["A",O,O,0,0,1,ie+b-O,p+T],["L",ie+O,p+T],["A",O,O,0,0,1,ie,p+T-O],["L",ie,p+O],["A",O,O,0,0,1,ie+O,p],["Z"]]}let zh={arc:Sl,callout:function(ie,p,b,T,P){let O=Math.min((P==null?void 0:P.r)||0,b,T),z=O+6,j=P==null?void 0:P.anchorX,X=(P==null?void 0:P.anchorY)||0,re=Gu(ie,p,b,T,{r:O});if(!ju(j)||j<b&&j>0&&X<T&&X>0)return re;if(ie+j>b-z)if(X>p+z&&X<p+T-z)re.splice(3,1,["L",ie+b,X-6],["L",ie+b+6,X],["L",ie+b,X+6],["L",ie+b,p+T-O]);else if(j<b){let de=X<p+z,ne=de?p:p+T;re.splice(de?2:5,0,["L",j,X],["L",ie+b-O,ne])}else re.splice(3,1,["L",ie+b,T/2],["L",j,X],["L",ie+b,T/2],["L",ie+b,p+T-O]);else if(ie+j<z)if(X>p+z&&X<p+T-z)re.splice(7,1,["L",ie,X+6],["L",ie-6,X],["L",ie,X-6],["L",ie,p+O]);else if(j>0){let de=X<p+z,ne=de?p:p+T;re.splice(de?1:6,0,["L",j,X],["L",ie+O,ne])}else re.splice(7,1,["L",ie,T/2],["L",j,X],["L",ie,T/2],["L",ie,p+O]);else X>T&&j<b-z?re.splice(5,1,["L",j+6,p+T],["L",j,p+T+6],["L",j-6,p+T],["L",ie+O,p+T]):X<0&&j>z&&re.splice(1,1,["L",j-6,p],["L",j,p-6],["L",j+6,p],["L",b-O,p]);return re},circle:function(ie,p,b,T){return Sl(ie+b/2,p+T/2,b/2,T/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(ie,p,b,T){return[["M",ie+b/2,p],["L",ie+b,p+T/2],["L",ie+b/2,p+T],["L",ie,p+T/2],["Z"]]},rect:Ja,roundedRect:Gu,square:Ja,triangle:function(ie,p,b,T){return[["M",ie+b/2,p],["L",ie+b,p+T],["L",ie,p+T],["Z"]]},"triangle-down":function(ie,p,b,T){return[["M",ie,p],["L",ie+b,p],["L",ie+b/2,p+T],["Z"]]}},{doc:Ch,SVG_NS:hh,win:vt}=Je,{attr:Yt,extend:Di,fireEvent:yi,isString:bi,objectEach:Li,pick:Tr}=Ht,Bi=(ie,p)=>ie.substring(0,p)+"",Gt=class{constructor(ie){let p=ie.styles;this.renderer=ie.renderer,this.svgElement=ie,this.width=ie.textWidth,this.textLineHeight=p==null?void 0:p.lineHeight,this.textOutline=p==null?void 0:p.textOutline,this.ellipsis=(p==null?void 0:p.textOverflow)==="ellipsis",this.lineClamp=p==null?void 0:p.lineClamp,this.noWrap=(p==null?void 0:p.whiteSpace)==="nowrap"}buildSVG(){let ie=this.svgElement,p=ie.element,b=ie.renderer,T=Tr(ie.textStr,"").toString(),P=T.indexOf("<")!==-1,O=p.childNodes,z=!ie.added&&b.box,j=[T,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,ie.getStyle("font-size"),ie.styles.lineClamp,this.width].join(",");if(j!==ie.textCache){ie.textCache=j,delete ie.actualWidth;for(let X=O.length;X--;)p.removeChild(O[X]);if(P||this.ellipsis||this.width||ie.textPath||T.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(T))){if(T!==""){z&&z.appendChild(p);let X=new la(T);this.modifyTree(X.nodes),X.addToDOM(p),this.modifyDOM(),this.ellipsis&&(p.textContent||"").indexOf("")!==-1&&ie.attr("title",this.unescapeEntities(ie.textStr||"",["&lt;","&gt;"])),z&&z.removeChild(p)}}else p.appendChild(Ch.createTextNode(this.unescapeEntities(T)));bi(this.textOutline)&&ie.applyTextOutline&&ie.applyTextOutline(this.textOutline)}}modifyDOM(){let ie,p=this.svgElement,b=Yt(p.element,"x");for(p.firstLineMetrics=void 0;(ie=p.element.firstChild)&&/^[\s\u200B]*$/.test(ie.textContent||" ");)p.element.removeChild(ie);[].forEach.call(p.element.querySelectorAll("tspan.highcharts-br"),(z,j)=>{z.nextSibling&&z.previousSibling&&(j===0&&z.previousSibling.nodeType===1&&(p.firstLineMetrics=p.renderer.fontMetrics(z.previousSibling)),Yt(z,{dy:this.getLineHeight(z.nextSibling),x:b}))});let T=this.width||0;if(!T)return;let P=(z,j)=>{var De;let X=z.textContent||"",re=X.replace(/([^\^])-/g,"$1- ").split(" "),de=!this.noWrap&&(re.length>1||p.element.childNodes.length>1),ne=this.getLineHeight(j),ce=Math.max(0,T-.8*ne),ye=0,Te=p.actualWidth;if(de){let Oe=[],Be=[];for(;j.firstChild&&j.firstChild!==z;)Be.push(j.firstChild),j.removeChild(j.firstChild);for(;re.length;)if(re.length&&!this.noWrap&&ye>0&&(Oe.push(z.textContent||""),z.textContent=re.join(" ").replace(/- /g,"-")),this.truncate(z,void 0,re,ye===0&&Te||0,T,ce,(Ke,st)=>re.slice(0,st).join(" ").replace(/- /g,"-")),Te=p.actualWidth,ye++,this.lineClamp&&ye>=this.lineClamp){re.length&&(this.truncate(z,z.textContent||"",void 0,0,T,ce,Bi),z.textContent=((De=z.textContent)==null?void 0:De.replace("",""))+"");break}Be.forEach(Ke=>{j.insertBefore(Ke,z)}),Oe.forEach(Ke=>{j.insertBefore(Ch.createTextNode(Ke),z);let st=Ch.createElementNS(hh,"tspan");st.textContent="",Yt(st,{dy:ne,x:b}),j.insertBefore(st,z)})}else this.ellipsis&&X&&this.truncate(z,X,void 0,0,T,ce,Bi)},O=z=>{[].slice.call(z.childNodes).forEach(j=>{j.nodeType===vt.Node.TEXT_NODE?P(j,z):(j.className.baseVal.indexOf("highcharts-br")!==-1&&(p.actualWidth=0),O(j))})};O(p.element)}getLineHeight(ie){let p=ie.nodeType===vt.Node.TEXT_NODE?ie.parentElement:ie;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(p||this.svgElement.element).h}modifyTree(ie){let p=(b,T)=>{let{attributes:P={},children:O,style:z={},tagName:j}=b,X=this.renderer.styledMode;if(j==="b"||j==="strong"?X?P.class="highcharts-strong":z.fontWeight="bold":(j==="i"||j==="em")&&(X?P.class="highcharts-emphasized":z.fontStyle="italic"),z!=null&&z.color&&(z.fill=z.color),j==="br"){P.class="highcharts-br",b.textContent="";let re=ie[T+1];re!=null&&re.textContent&&(re.textContent=re.textContent.replace(/^ +/gm,""))}else j==="a"&&O&&O.some(re=>re.tagName==="#text")&&(b.children=[{children:O,tagName:"tspan"}]);j!=="#text"&&j!=="a"&&(b.tagName="tspan"),Di(b,{attributes:P,style:z}),O&&O.filter(re=>re.tagName!=="#text").forEach(p)};ie.forEach(p),yi(this.svgElement,"afterModifyTree",{nodes:ie})}truncate(ie,p,b,T,P,O,z){let j,X,re=this.svgElement,{rotation:de}=re,ne=[],ce=b&&!T?1:0,ye=(p||b||"").length,Te=ye;b||(P=O);let De=function(Oe,Be){let Ke=Be||Oe,st=ie.parentNode;if(st&&ne[Ke]===void 0&&st.getSubStringLength)try{ne[Ke]=T+st.getSubStringLength(0,b?Ke+1:Ke)}catch{}return ne[Ke]};if(re.rotation=0,T+(X=De(ie.textContent.length))>P){for(;ce<=ye;)Te=Math.ceil((ce+ye)/2),b&&(j=z(b,Te)),X=De(Te,j&&j.length-1),ce===ye?ce=ye+1:X>P?ye=Te-1:ce=Te;ye===0?ie.textContent="":p&&ye===p.length-1||(ie.textContent=j||z(p||b,Te)),this.ellipsis&&X>P&&this.truncate(ie,ie.textContent||"",void 0,0,P,O,Bi)}b&&b.splice(0,Te),re.actualWidth=X,re.rotation=de}unescapeEntities(ie,p){return Li(this.renderer.escapes,function(b,T){p&&p.indexOf(b)!==-1||(ie=ie.toString().replace(RegExp(b,"g"),T))}),ie}},{defaultOptions:qr}=vi,{charts:sr,deg2rad:Qi,doc:sn,isFirefox:hi,isMS:Pn,isWebKit:as,noop:Yo,SVG_NS:Qn,symbolSizes:ro,win:Ao}=Je,{addEvent:el,attr:Mo,createElement:Fs,crisp:Jo,css:ea,defined:So,destroyObjectProperties:Ua,extend:Ul,isArray:$l,isNumber:$a,isObject:Vl,isString:dl,merge:uh,pick:rc,pInt:Dc,replaceNested:Pc,uniqueKey:Zc}=Ht;class or{constructor(p,b,T,P,O,z,j){let X,re;this.x=0,this.y=0;let de=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),ne=de.element;j||de.css(this.getStyle(P||{})),p.appendChild(ne),Mo(p,"dir","ltr"),p.innerHTML.indexOf("xmlns")===-1&&Mo(ne,"xmlns",this.SVG_NS),this.box=ne,this.boxWrapper=de,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(sn.createTextNode("Created with Highcharts 12.3.0")),this.defs=this.createElement("defs").add(),this.allowHTML=z,this.forExport=O,this.styledMode=j,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=de.getStyle("font-size"),this.setSize(b,T,!1),hi&&p.getBoundingClientRect&&((X=function(){ea(p,{left:0,top:0}),re=p.getBoundingClientRect(),ea(p,{left:Math.ceil(re.left)-re.left+"px",top:Math.ceil(re.top)-re.top+"px"})})(),this.unSubPixelFix=el(Ao,"resize",X))}definition(p){return new la([p]).addToDOM(this.defs.element)}getReferenceURL(){if((hi||as)&&sn.getElementsByTagName("base").length){if(!So(s)){let p=Zc(),b=new la([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:p},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${p})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(sn.body);ea(b,{position:"fixed",top:0,left:0,zIndex:9e5});let T=sn.elementFromPoint(6,6);s=(T==null?void 0:T.id)==="hitme",sn.body.removeChild(b)}if(s)return Pc(Ao.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(p){return this.style=Ul({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},p),this.style}setStyle(p){this.boxWrapper.css(this.getStyle(p))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let p=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),Ua(this.gradients||{}),this.gradients=null,this.defs=p.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(p){return new this.Element(this,p)}getRadialAttr(p,b){return{cx:p[0]-p[2]/2+(b.cx||0)*p[2],cy:p[1]-p[2]/2+(b.cy||0)*p[2],r:(b.r||0)*p[2]}}shadowDefinition(p){let b=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(p).map(P=>`${P}-${p[P]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),T=uh({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},p);return this.defs.element.querySelector(`#${b}`)||this.definition({tagName:"filter",attributes:{id:b,filterUnits:T.filterUnits},children:this.getShadowFilterContent(T)}),b}getShadowFilterContent(p){return[{tagName:"feDropShadow",attributes:{dx:p.offsetX,dy:p.offsetY,"flood-color":p.color,"flood-opacity":Math.min(5*p.opacity,1),stdDeviation:p.width/2}}]}buildText(p){new Gt(p).buildSVG()}getContrast(p){if(p==="transparent")return"#000000";let b=ai.parse(p).rgba,T=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if($a(b[0])||!ai.useColorMix){let P=b.map(z=>{let j=z/255;return j<=.04?j/12.92:Math.pow((j+.055)/1.055,2.4)}),O=.2126*P[0]+.7152*P[1]+.0722*P[2];return 1.05/(O+.05)>(O+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+p+" srgb"+T+T+T+")"}button(p,b,T,P,O={},z,j,X,re,de){let ne=this.label(p,b,T,re,void 0,void 0,de,void 0,"button"),ce=this.styledMode,ye=arguments,Te=0;O=uh(qr.global.buttonTheme,O),ce&&(delete O.fill,delete O.stroke,delete O["stroke-width"]);let De=O.states||{},Oe=O.style||{};delete O.states,delete O.style;let Be=[la.filterUserAttributes(O)],Ke=[Oe];return ce||["hover","select","disabled"].forEach((st,Bt)=>{Be.push(uh(Be[0],la.filterUserAttributes(ye[Bt+5]||De[st]||{}))),Ke.push(Be[Bt+1].style),delete Be[Bt+1].style}),el(ne.element,Pn?"mouseover":"mouseenter",function(){Te!==3&&ne.setState(1)}),el(ne.element,Pn?"mouseout":"mouseleave",function(){Te!==3&&ne.setState(Te)}),ne.setState=(st=0)=>{if(st!==1&&(ne.state=Te=st),ne.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][st]),!ce){ne.attr(Be[st]);let Bt=Ke[st];Vl(Bt)&&ne.css(Bt)}},ne.attr(Be[0]),!ce&&(ne.css(Ul({cursor:"default"},Oe)),de&&ne.text.css({pointerEvents:"none"})),ne.on("touchstart",st=>st.stopPropagation()).on("click",function(st){Te!==3&&(P==null||P.call(ne,st))})}crispLine(p,b){let[T,P]=p;return So(T[1])&&T[1]===P[1]&&(T[1]=P[1]=Jo(T[1],b)),So(T[2])&&T[2]===P[2]&&(T[2]=P[2]=Jo(T[2],b)),p}path(p){let b=this.styledMode?{}:{fill:"none"};return $l(p)?b.d=p:Vl(p)&&Ul(b,p),this.createElement("path").attr(b)}circle(p,b,T){let P=Vl(p)?p:p===void 0?{}:{x:p,y:b,r:T},O=this.createElement("circle");return O.xSetter=O.ySetter=function(z,j,X){X.setAttribute("c"+j,z)},O.attr(P)}arc(p,b,T,P,O,z){let j;Vl(p)?(b=(j=p).y,T=j.r,P=j.innerR,O=j.start,z=j.end,p=j.x):j={innerR:P,start:O,end:z};let X=this.symbol("arc",p,b,T,T,j);return X.r=T,X}rect(p,b,T,P,O,z){let j=Vl(p)?p:p===void 0?{}:{x:p,y:b,r:O,width:Math.max(T||0,0),height:Math.max(P||0,0)},X=this.createElement("rect");return this.styledMode||(z!==void 0&&(j["stroke-width"]=z,Ul(j,X.crisp(j))),j.fill="none"),X.rSetter=function(re,de,ne){X.r=re,Mo(ne,{rx:re,ry:re})},X.rGetter=function(){return X.r||0},X.attr(j)}roundedRect(p){return this.symbol("roundedRect").attr(p)}setSize(p,b,T){this.width=p,this.height=b,this.boxWrapper.animate({width:p,height:b},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:rc(T,!0)?void 0:0}),this.alignElements()}g(p){let b=this.createElement("g");return p?b.attr({class:"highcharts-"+p}):b}image(p,b,T,P,O,z){let j={preserveAspectRatio:"none"};$a(b)&&(j.x=b),$a(T)&&(j.y=T),$a(P)&&(j.width=P),$a(O)&&(j.height=O);let X=this.createElement("image").attr(j),re=function(de){X.attr({href:p}),z.call(X,de)};if(z){X.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let de=new Ao.Image;el(de,"load",re),de.src=p,de.complete&&re({})}else X.attr({href:p});return X}symbol(p,b,T,P,O,z){var Oe,Be;let j,X,re,de,ne=this,ce=/^url\((.*?)\)$/,ye=ce.test(p),Te=!ye&&(this.symbols[p]?p:"circle"),De=Te&&this.symbols[Te];if(De)typeof b=="number"&&(X=De.call(this.symbols,b||0,T||0,P||0,O||0,z)),j=this.path(X),ne.styledMode||j.attr("fill","none"),Ul(j,{symbolName:Te||void 0,x:b,y:T,width:P,height:O}),z&&Ul(j,z);else if(ye){re=p.match(ce)[1];let Ke=j=this.image(re);Ke.imgwidth=rc(z==null?void 0:z.width,(Oe=ro[re])==null?void 0:Oe.width),Ke.imgheight=rc(z==null?void 0:z.height,(Be=ro[re])==null?void 0:Be.height),de=st=>st.attr({width:st.width,height:st.height}),["width","height"].forEach(st=>{Ke[`${st}Setter`]=function(Bt,Ut){this[Ut]=Bt;let{alignByTranslate:$t,element:ci,width:oi,height:di,imgwidth:er,imgheight:Vi}=this,lr=Ut==="width"?er:Vi,Vr=1;z&&z.backgroundSize==="within"&&oi&&di&&er&&Vi?(Vr=Math.min(oi/er,di/Vi),Mo(ci,{width:Math.round(er*Vr),height:Math.round(Vi*Vr)})):ci&&lr&&ci.setAttribute(Ut,lr),!$t&&er&&Vi&&this.translate(((oi||0)-er*Vr)/2,((di||0)-Vi*Vr)/2)}}),So(b)&&Ke.attr({x:b,y:T}),Ke.isImg=!0,Ke.symbolUrl=p,So(Ke.imgwidth)&&So(Ke.imgheight)?de(Ke):(Ke.attr({width:0,height:0}),Fs("img",{onload:function(){let st=sr[ne.chartIndex];this.width===0&&(ea(this,{position:"absolute",top:"-999em"}),sn.body.appendChild(this)),ro[re]={width:this.width,height:this.height},Ke.imgwidth=this.width,Ke.imgheight=this.height,Ke.element&&de(Ke),this.parentNode&&this.parentNode.removeChild(this),ne.imgCount--,ne.imgCount||!st||st.hasLoaded||st.onload()},src:re}),this.imgCount++)}return j}clipRect(p,b,T,P){return this.rect(p,b,T,P,0)}text(p,b,T,P){let O={};if(P&&(this.allowHTML||!this.forExport))return this.html(p,b,T);O.x=Math.round(b||0),T&&(O.y=Math.round(T)),So(p)&&(O.text=p);let z=this.createElement("text").attr(O);return P&&(!this.forExport||this.allowHTML)||(z.xSetter=function(j,X,re){let de=re.getElementsByTagName("tspan"),ne=re.getAttribute(X);for(let ce=0,ye;ce<de.length;ce++)(ye=de[ce]).getAttribute(X)===ne&&ye.setAttribute(X,j);re.setAttribute(X,j)}),z}fontMetrics(p){let b=Dc(Qa.prototype.getStyle.call(p,"font-size")||0),T=b<24?b+3:Math.round(1.2*b),P=Math.round(.8*T);return{h:T,b:P,f:b}}rotCorr(p,b,T){let P=p;return b&&T&&(P=Math.max(P*Math.cos(b*Qi),4)),{x:-p/3*Math.sin(b*Qi),y:P}}pathToSegments(p){let b=[],T=[],P={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let O=0;O<p.length;O++)dl(T[0])&&$a(p[O])&&T.length===P[T[0].toUpperCase()]&&p.splice(O,0,T[0].replace("M","L").replace("m","l")),typeof p[O]=="string"&&(T.length&&b.push(T.slice(0)),T.length=0),T.push(p[O]);return b.push(T.slice(0)),b}label(p,b,T,P,O,z,j,X,re){return new Ks(this,p,b,T,P,O,z,j,X,re)}alignElements(){this.alignedObjects.forEach(p=>p.align())}}Ul(or.prototype,{Element:Qa,SVG_NS:Qn,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:zh,draw:Yo}),ca.registerRendererType("svg",or,!0);let{composed:Kr,isFirefox:Ur}=Je,{attr:Kn,css:As,createElement:Xo,defined:pl,extend:Fn,getAlignFactor:fs,isNumber:In,pInt:Ms,pushUnique:ho}=Ht;function na(ie,p,b){var P;let T=(P=this.div)==null?void 0:P.style;Qa.prototype[`${p}Setter`].call(this,ie,p,b),T&&(b.style[p]=T[p]=ie)}let ta=(ie,p)=>{var b;if(!ie.div){let T=Kn(ie.element,"class"),P=ie.css,O=Xo("div",T?{className:T}:void 0,{position:"absolute",left:`${ie.translateX||0}px`,top:`${ie.translateY||0}px`,...ie.styles,display:ie.display,opacity:ie.opacity,visibility:ie.visibility},((b=ie.parentGroup)==null?void 0:b.div)||p);ie.classSetter=(z,j,X)=>{X.setAttribute("class",z),O.className=z},ie.translateXSetter=ie.translateYSetter=(z,j)=>{ie[j]=z,O.style[j==="translateX"?"left":"top"]=`${z}px`,ie.doTransform=!0},ie.scaleXSetter=ie.scaleYSetter=(z,j)=>{ie[j]=z,ie.doTransform=!0},ie.opacitySetter=ie.visibilitySetter=na,ie.css=z=>(P.call(ie,z),z.cursor&&(O.style.cursor=z.cursor),z.pointerEvents&&(O.style.pointerEvents=z.pointerEvents),ie),ie.on=function(){return Qa.prototype.on.apply({element:O,onEvents:ie.onEvents},arguments),ie},ie.div=O}return ie.div};class Oo extends Qa{static compose(p){ho(Kr,this.compose)&&(p.prototype.html=function(b,T,P){return new Oo(this,"span").attr({text:b,x:Math.round(T),y:Math.round(P)})})}constructor(p,b){super(p,b),Oo.useForeignObject?this.foreignObject=p.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...p.styledMode?{}:{fontFamily:p.style.fontFamily,fontSize:p.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(p,b,T){this.xCorr=-p*T,this.yCorr=-b}css(p){let b,{element:T}=this,P=T.tagName==="SPAN"&&p&&"width"in p,O=P&&p.width;return P&&(delete p.width,this.textWidth=Ms(O)||void 0,b=!0),(p==null?void 0:p.textOverflow)==="ellipsis"&&(p.overflow="hidden",p.whiteSpace="nowrap"),p!=null&&p.lineClamp&&(p.display="-webkit-box",p.WebkitLineClamp=p.lineClamp,p.WebkitBoxOrient="vertical",p.overflow="hidden"),In(Number(p==null?void 0:p.fontSize))&&(p.fontSize+="px"),Fn(this.styles,p),As(T,p),b&&this.updateTransform(),this}htmlGetBBox(){let{element:p}=this;return{x:p.offsetLeft,y:p.offsetTop,width:p.offsetWidth,height:p.offsetHeight}}updateTransform(){var Ke;if(!this.added){this.alignOnAdd=!0;return}let{element:p,foreignObject:b,oldTextWidth:T,renderer:P,rotation:O,rotationOriginX:z,rotationOriginY:j,scaleX:X,scaleY:re,styles:{display:de="inline-block",whiteSpace:ne},textAlign:ce="left",textWidth:ye,translateX:Te=0,translateY:De=0,x:Oe=0,y:Be=0}=this;if(b||As(p,{marginLeft:`${Te}px`,marginTop:`${De}px`}),p.tagName==="SPAN"){let st,Bt=[O,ce,p.innerHTML,ye,this.textAlign].join(","),Ut=-(((Ke=this.parentGroup)==null?void 0:Ke.padding)*1)||0;if(ye!==T){let di=this.textPxLength?this.textPxLength:(As(p,{width:"",whiteSpace:ne||"nowrap"}),p.offsetWidth),er=ye||0,Vi=p.style.textOverflow===""&&p.style.webkitLineClamp;(er>T||di>er||Vi)&&(/[\-\s\u00AD]/.test(p.textContent||p.innerText)||p.style.textOverflow==="ellipsis")&&(As(p,{width:(O||X||di>er||Vi)&&In(ye)?ye+"px":"auto",display:de,whiteSpace:ne||"normal"}),this.oldTextWidth=ye)}b&&(As(p,{display:"inline-block",verticalAlign:"top"}),b.attr({width:P.width,height:P.height})),Bt!==this.cTT&&(st=P.fontMetrics(p).b,pl(O)&&!b&&(O!==(this.oldRotation||0)||ce!==this.oldAlign)&&As(p,{transform:`rotate(${O}deg)`,transformOrigin:`${Ut}% ${Ut}px`}),this.getSpanCorrection(!pl(O)&&!this.textWidth&&this.textPxLength||p.offsetWidth,st,fs(ce)));let{xCorr:$t=0,yCorr:ci=0}=this,oi={left:`${Oe+$t}px`,top:`${Be+ci}px`,textAlign:ce,transformOrigin:`${(z??Oe)-$t-Oe-Ut}px ${(j??Be)-ci-Be-Ut}px`};(X||re)&&(oi.transform=`scale(${X??1},${re??1})`),b?(super.updateTransform(),In(Oe)&&In(Be)?(b.attr({x:Oe+$t,y:Be+ci,width:p.offsetWidth+3,height:p.offsetHeight,"transform-origin":p.getAttribute("transform-origin")||"0 0"}),As(p,{display:de,textAlign:ce})):Ur&&b.attr({width:0,height:0})):As(p,oi),this.cTT=Bt,this.oldRotation=O,this.oldAlign=ce}}add(p){let{foreignObject:b,renderer:T}=this,P=T.box.parentNode,O=[];if(b)b.add(p),super.add(T.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(b));else{let z;if(this.parentGroup=p,p&&!(z=p.div)){let j=p;for(;j;)O.push(j),j=j.parentGroup;for(let X of O.reverse())z=ta(X,P)}(z||P).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(p){p!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,la.setElementHTML(this.element,p??""),this.textStr=p,this.doTransform=!0)}alignSetter(p){this.alignValue=this.textAlign=p,this.doTransform=!0}xSetter(p,b){this[b]=p,this.doTransform=!0}}let Io=Oo.prototype;Io.visibilitySetter=Io.opacitySetter=na,Io.ySetter=Io.rotationSetter=Io.rotationOriginXSetter=Io.rotationOriginYSetter=Io.xSetter,function(ie){ie.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},ie.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:p}=this.axis.chart;return p(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(F||(F={}));let To=F,{addEvent:fl,isFunction:rl,objectEach:mr,removeEvent:Tl}=Ht;(G||(G={})).registerEventOptions=function(ie,p){ie.eventOptions=ie.eventOptions||{},mr(p.events,function(b,T){ie.eventOptions[T]!==b&&(ie.eventOptions[T]&&(Tl(ie,T,ie.eventOptions[T]),delete ie.eventOptions[T]),rl(b)&&(ie.eventOptions[T]=b,fl(ie,T,b,{order:0})))})};let Vo=G,{deg2rad:Kc}=Je,{clamp:uc,correctFloat:dc,defined:Qc,destroyObjectProperties:bd,extend:Jc,fireEvent:ws,getAlignFactor:qu,isNumber:Pp,merge:ga,objectEach:cf,pick:Eh}=Ht,uo=class{constructor(ie,p,b,T,P){this.isNew=!0,this.isNewLabel=!0,this.axis=ie,this.pos=p,this.type=b||"",this.parameters=P||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,ws(this,"init"),b||T||this.addLabel()}addLabel(){var ci,oi;let ie=this,p=ie.axis,b=p.options,T=p.chart,P=p.categories,O=p.logarithmic,z=p.names,j=ie.pos,X=Eh((ci=ie.options)==null?void 0:ci.labels,b.labels),re=p.tickPositions,de=j===re[0],ne=j===re[re.length-1],ce=(!X.step||X.step===1)&&p.tickInterval===1,ye=re.info,Te=ie.label,De,Oe,Be,Ke=this.parameters.category||(P?Eh(P[j],z[j],j):j);O&&Pp(Ke)&&(Ke=dc(O.lin2log(Ke))),p.dateTime&&(ye?De=(Oe=T.time.resolveDTLFormat(b.dateTimeLabelFormats[!((oi=b.grid)!=null&&oi.enabled)&&ye.higherRanks[j]||ye.unitName])).main:Pp(Ke)&&(De=p.dateTime.getXDateFormat(Ke,b.dateTimeLabelFormats||{}))),ie.isFirst=de,ie.isLast=ne;let st={axis:p,chart:T,dateTimeLabelFormat:De,isFirst:de,isLast:ne,pos:j,tick:ie,tickPositionInfo:ye,value:Ke};ws(this,"labelFormat",st);let Bt=di=>X.formatter?X.formatter.call(di,di):X.format?(di.text=p.defaultLabelFormatter.call(di),ba.format(X.format,di,T)):p.defaultLabelFormatter.call(di),Ut=Bt.call(st,st),$t=Oe==null?void 0:Oe.list;$t?ie.shortenLabel=function(){for(Be=0;Be<$t.length;Be++)if(Jc(st,{dateTimeLabelFormat:$t[Be]}),Te.attr({text:Bt.call(st,st)}),Te.getBBox().width<p.getSlotWidth(ie)-2*(X.padding||0))return;Te.attr({text:""})}:ie.shortenLabel=void 0,ce&&p._addedPlotLB&&ie.moveLabel(Ut,X),Qc(Te)||ie.movedLabel?Te&&Te.textStr!==Ut&&!ce&&(!Te.textWidth||X.style.width||Te.styles.width||Te.css({width:null}),Te.attr({text:Ut}),Te.textPxLength=Te.getBBox().width):(ie.label=Te=ie.createLabel(Ut,X),ie.rotation=0)}createLabel(ie,p,b){let T=this.axis,{renderer:P,styledMode:O}=T.chart,z=p.style.whiteSpace,j=Qc(ie)&&p.enabled?P.text(ie,b==null?void 0:b.x,b==null?void 0:b.y,p.useHTML).add(T.labelGroup):void 0;return j&&(O||j.css(ga(p.style)),j.textPxLength=j.getBBox().width,!O&&z&&j.css({whiteSpace:z})),j}destroy(){bd(this,this.axis)}getPosition(ie,p,b,T){let P=this.axis,O=P.chart,z=T&&O.oldChartHeight||O.chartHeight,j={x:ie?dc(P.translate(p+b,void 0,void 0,T)+P.transB):P.left+P.offset+(P.opposite?(T&&O.oldChartWidth||O.chartWidth)-P.right-P.left:0),y:ie?z-P.bottom+P.offset-(P.opposite?P.height:0):dc(z-P.translate(p+b,void 0,void 0,T)-P.transB)};return j.y=uc(j.y,-1e9,1e9),ws(this,"afterGetPosition",{pos:j}),j}getLabelPosition(ie,p,b,T,P,O,z,j){let X,re,de=this.axis,ne=de.transA,ce=de.isLinked&&de.linkedParent?de.linkedParent.reversed:de.reversed,ye=de.staggerLines,Te=de.tickRotCorr||{x:0,y:0},De=T||de.reserveSpaceDefault?0:-de.labelOffset*(de.labelAlign==="center"?.5:1),Oe=P.distance,Be={};return X=de.side===0?b.rotation?-Oe:-b.getBBox().height:de.side===2?Te.y+Oe:Math.cos(b.rotation*Kc)*(Te.y-b.getBBox(!1,0).height/2),Qc(P.y)&&(X=de.side===0&&de.horiz?P.y+X:P.y),ie=ie+Eh(P.x,[0,1,0,-1][de.side]*Oe)+De+Te.x-(O&&T?O*ne*(ce?-1:1):0),p=p+X-(O&&!T?O*ne*(ce?1:-1):0),ye&&(re=z/(j||1)%ye,de.opposite&&(re=ye-re-1),p+=re*(de.labelOffset/ye)),Be.x=ie,Be.y=Math.round(p),ws(this,"afterGetLabelPosition",{pos:Be,tickmarkOffset:O,index:z}),Be}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(ie,p,b,T,P=!1,O){return O.crispLine([["M",ie,p],["L",ie+(P?0:-b),p+(P?b:0)]],T)}handleOverflow(ie){var Oe;let p=this.axis,b=p.options.labels,T=ie.x,P=p.chart.chartWidth,O=p.chart.spacing,z=Eh(p.labelLeft,Math.min(p.pos,O[3])),j=Eh(p.labelRight,Math.max(p.isRadial?0:p.pos+p.len,P-O[1])),X=this.label,re=this.rotation,de=qu(p.labelAlign||X.attr("align")),ne=X.getBBox().width,ce=p.getSlotWidth(this),ye=ce,Te=1,De;re||b.overflow!=="justify"?re<0&&T-de*ne<z?De=Math.round(T/Math.cos(re*Kc)-z):re>0&&T+de*ne>j&&(De=Math.round((P-T)/Math.cos(re*Kc))):(T-de*ne<z?ye=ie.x+ye*(1-de)-z:T+(1-de)*ne>j&&(ye=j-ie.x+ye*de,Te=-1),(ye=Math.min(ce,ye))<ce&&p.labelAlign==="center"&&(ie.x+=Te*(ce-ye-de*(ce-Math.min(ne,ye)))),(ne>ye||p.autoRotation&&((Oe=X==null?void 0:X.styles)!=null&&Oe.width))&&(De=ye)),De&&X&&(this.shortenLabel?this.shortenLabel():X.css(Jc({},{width:Math.floor(De)+"px",lineClamp:+!p.isRadial})))}moveLabel(ie,p){let b=this,T=b.label,P=b.axis,O=!1,z;T&&T.textStr===ie?(b.movedLabel=T,O=!0,delete b.label):cf(P.ticks,function(j){O||j.isNew||j===b||!j.label||j.label.textStr!==ie||(b.movedLabel=j.label,O=!0,j.labelPos=b.movedLabel.xy,delete j.label)}),!O&&(b.labelPos||T)&&(z=b.labelPos||T.xy,b.movedLabel=b.createLabel(ie,p,z),b.movedLabel&&b.movedLabel.attr({opacity:0}))}render(ie,p,b){var Te;let T=this.axis,P=T.horiz,O=this.pos,z=Eh(this.tickmarkOffset,T.tickmarkOffset),j=this.getPosition(P,O,z,p),X=j.x,re=j.y,de=T.pos,ne=de+T.len,ce=P?X:re,ye=Eh(b,(Te=this.label)==null?void 0:Te.newOpacity,1);!T.chart.polar&&(dc(ce)<de||ce>ne)&&(b=0),b??(b=1),this.isActive=!0,this.renderGridLine(p,b),this.renderMark(j,b),this.renderLabel(j,p,ye,ie),this.isNew=!1,ws(this,"afterRender")}renderGridLine(ie,p){let b=this.axis,T=b.options,P={},O=this.pos,z=this.type,j=Eh(this.tickmarkOffset,b.tickmarkOffset),X=b.chart.renderer,re=this.gridLine,de,ne=T.gridLineWidth,ce=T.gridLineColor,ye=T.gridLineDashStyle;this.type==="minor"&&(ne=T.minorGridLineWidth,ce=T.minorGridLineColor,ye=T.minorGridLineDashStyle),re||(b.chart.styledMode||(P.stroke=ce,P["stroke-width"]=ne||0,P.dashstyle=ye),z||(P.zIndex=1),ie&&(p=0),this.gridLine=re=X.path().attr(P).addClass("highcharts-"+(z?z+"-":"")+"grid-line").add(b.gridGroup)),re&&(de=b.getPlotLinePath({value:O+j,lineWidth:re.strokeWidth(),force:"pass",old:ie,acrossPanes:!1}))&&re[ie||this.isNew?"attr":"animate"]({d:de,opacity:p})}renderMark(ie,p){let b=this.axis,T=b.options,P=b.chart.renderer,O=this.type,z=b.tickSize(O?O+"Tick":"tick"),j=ie.x,X=ie.y,re=Eh(T[O!=="minor"?"tickWidth":"minorTickWidth"],!O&&b.isXAxis?1:0),de=T[O!=="minor"?"tickColor":"minorTickColor"],ne=this.mark,ce=!ne;z&&(b.opposite&&(z[0]=-z[0]),!ne&&(this.mark=ne=P.path().addClass("highcharts-"+(O?O+"-":"")+"tick").add(b.axisGroup),b.chart.styledMode||ne.attr({stroke:de,"stroke-width":re})),ne[ce?"attr":"animate"]({d:this.getMarkPath(j,X,z[0],ne.strokeWidth(),b.horiz,P),opacity:p}))}renderLabel(ie,p,b,T){let P=this.axis,O=P.horiz,z=P.options,j=this.label,X=z.labels,re=X.step,de=Eh(this.tickmarkOffset,P.tickmarkOffset),ne=ie.x,ce=ie.y,ye=!0;j&&Pp(ne)&&(j.xy=ie=this.getLabelPosition(ne,ce,j,O,X,de,T,re),(!this.isFirst||this.isLast||z.showFirstLabel)&&(!this.isLast||this.isFirst||z.showLastLabel)?!O||X.step||X.rotation||p||b===0||this.handleOverflow(ie):ye=!1,re&&T%re&&(ye=!1),ye&&Pp(ie.y)?(ie.opacity=b,j[this.isNewLabel?"attr":"animate"](ie).show(!0),this.isNewLabel=!1):(j.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let ie=this.label,p=this.axis;ie&&!this.isNew&&(ie.animate({opacity:0},void 0,ie.destroy),delete this.label),p.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:Wl}=zr,{xAxis:Kg,yAxis:k0}=To,{defaultOptions:hf}=vi,{registerEventOptions:Wf}=Vo,{deg2rad:pc}=Je,{arrayMax:Qg,arrayMin:A0,clamp:jf,correctFloat:Es,defined:Ro,destroyObjectProperties:eh,erase:gg,error:uf,extend:fo,fireEvent:ml,getClosestDistance:Hf,insertItem:df,isArray:Op,isNumber:zs,isString:Yu,merge:Rp,normalizeTickInterval:Np,objectEach:wd,pick:No,relativeLength:Cm,removeEvent:yg,splat:_g,syncTimeout:M0}=Ht,Em=(ie,p)=>Np(p,void 0,void 0,No(ie.options.allowDecimals,p<.5||ie.tickAmount!==void 0),!!ie.tickAmount);fo(hf,{xAxis:Kg,yAxis:Rp(Kg,k0)});class wu{constructor(p,b,T){this.init(p,b,T)}init(p,b,T=this.coll){let P=T==="xAxis",O=this.isZAxis||(p.inverted?!P:P);this.chart=p,this.horiz=O,this.isXAxis=P,this.coll=T,ml(this,"init",{userOptions:b}),this.opposite=No(b.opposite,this.opposite),this.side=No(b.side,this.side,O?2*!this.opposite:this.opposite?1:3),this.setOptions(b);let z=this.options,j=z.labels;this.type??(this.type=z.type||"linear"),this.uniqueNames??(this.uniqueNames=z.uniqueNames??!0),ml(this,"afterSetType"),this.userOptions=b,this.minPixelPadding=0,this.reversed=No(z.reversed,this.reversed),this.visible=z.visible,this.zoomEnabled=z.zoomEnabled,this.hasNames=this.type==="category"||z.categories===!0,this.categories=Op(z.categories)&&z.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=Ro(z.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=z.minRange||z.maxZoom,this.range=z.range,this.offset=z.offset||0,this.max=void 0,this.min=void 0;let X=No(z.crosshair,_g(p.options.tooltip.crosshairs)[+!P]);this.crosshair=X===!0?{}:X,p.axes.indexOf(this)===-1&&(P?p.axes.splice(p.xAxis.length,0,this):p.axes.push(this),df(this,p[this.coll])),p.orderItems(this.coll),this.series=this.series||[],p.inverted&&!this.isZAxis&&P&&!Ro(this.reversed)&&(this.reversed=!0),this.labelRotation=zs(j.rotation)?j.rotation:void 0,Wf(this,z),ml(this,"afterInit")}setOptions(p){let b=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=Rp(b,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},hf[this.coll],p),ml(this,"afterSetOptions",{userOptions:p})}defaultLabelFormatter(){let p=this.axis,{numberFormatter:b}=this.chart,T=zs(this.value)?this.value:NaN,P=p.chart.time,O=p.categories,z=this.dateTimeLabelFormat,j=hf.lang,X=j.numericSymbols,re=j.numericSymbolMagnitude||1e3,de=p.logarithmic?Math.abs(T):p.tickInterval,ne=X==null?void 0:X.length,ce,ye;if(O)ye=`${this.value}`;else if(z)ye=P.dateFormat(z,T,!0);else if(ne&&X&&de>=1e3)for(;ne--&&ye===void 0;)de>=(ce=Math.pow(re,ne+1))&&10*T%ce==0&&X[ne]!==null&&T!==0&&(ye=b(T/ce,-1)+X[ne]);return ye===void 0&&(ye=Math.abs(T)>=1e4?b(T,-1):b(T,-1,void 0,"")),ye}getSeriesExtremes(){let p,b=this;ml(this,"getSeriesExtremes",null,function(){b.hasVisibleSeries=!1,b.dataMin=b.dataMax=b.threshold=void 0,b.softThreshold=!b.isXAxis,b.series.forEach(T=>{if(T.reserveSpace()){let P=T.options,O,z=P.threshold,j,X;if(b.hasVisibleSeries=!0,b.positiveValuesOnly&&0>=(z||0)&&(z=void 0),b.isXAxis)(O=T.getColumn("x")).length&&(O=b.logarithmic?O.filter(re=>re>0):O,j=(p=T.getXExtremes(O)).min,X=p.max,zs(j)||j instanceof Date||(O=O.filter(zs),j=(p=T.getXExtremes(O)).min,X=p.max),O.length&&(b.dataMin=Math.min(No(b.dataMin,j),j),b.dataMax=Math.max(No(b.dataMax,X),X)));else{let re=T.applyExtremes();zs(re.dataMin)&&(j=re.dataMin,b.dataMin=Math.min(No(b.dataMin,j),j)),zs(re.dataMax)&&(X=re.dataMax,b.dataMax=Math.max(No(b.dataMax,X),X)),Ro(z)&&(b.threshold=z),(!P.softThreshold||b.positiveValuesOnly)&&(b.softThreshold=!1)}}})}),ml(this,"afterGetSeriesExtremes")}translate(p,b,T,P,O,z){var De;let j=this.linkedParent||this,X=P&&j.old?j.old.min:j.min;if(!zs(X))return NaN;let re=j.minPixelPadding,de=(j.isOrdinal||((De=j.brokenAxis)==null?void 0:De.hasBreaks)||j.logarithmic&&O)&&j.lin2val,ne=1,ce=0,ye=P&&j.old?j.old.transA:j.transA,Te=0;return ye||(ye=j.transA),T&&(ne*=-1,ce=j.len),j.reversed&&(ne*=-1,ce-=ne*(j.sector||j.len)),b?(Te=(p=p*ne+ce-re)/ye+X,de&&(Te=j.lin2val(Te))):(de&&(p=j.val2lin(p)),Te=ne*(p-X)*ye+ce+ne*re+(zs(z)?ye*z:0),j.isRadial||(Te=Es(Te))),Te}toPixels(p,b){var T;return this.translate(((T=this.chart)==null?void 0:T.time.parse(p))??NaN,!1,!this.horiz,void 0,!0)+(b?0:this.pos)}toValue(p,b){return this.translate(p-(b?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(p){let b=this,T=b.chart,P=b.left,O=b.top,z=p.old,j=p.value,X=p.lineWidth,re=z&&T.oldChartHeight||T.chartHeight,de=z&&T.oldChartWidth||T.chartWidth,ne=b.transB,ce=p.translatedValue,ye=p.force,Te,De,Oe,Be,Ke;function st(Ut,$t,ci){return ye!=="pass"&&(Ut<$t||Ut>ci)&&(ye?Ut=jf(Ut,$t,ci):Ke=!0),Ut}let Bt={value:j,lineWidth:X,old:z,force:ye,acrossPanes:p.acrossPanes,translatedValue:ce};return ml(this,"getPlotLinePath",Bt,function(Ut){Te=Oe=(ce=jf(ce=No(ce,b.translate(j,void 0,void 0,z)),-1e9,1e9))+ne,De=Be=re-ce-ne,zs(ce)?b.horiz?(De=O,Be=re-b.bottom+(b.options.isInternal?0:T.scrollablePixelsY||0),Te=Oe=st(Te,P,P+b.width)):(Te=P,Oe=de-b.right+(T.scrollablePixelsX||0),De=Be=st(De,O,O+b.height)):(Ke=!0,ye=!1),Ut.path=Ke&&!ye?void 0:T.renderer.crispLine([["M",Te,De],["L",Oe,Be]],X||1)}),Bt.path}getLinearTickPositions(p,b,T){let P,O,z,j=Es(Math.floor(b/p)*p),X=Es(Math.ceil(T/p)*p),re=[];if(Es(j+p)===j&&(z=20),this.single)return[b];for(P=j;P<=X&&(re.push(P),(P=Es(P+p,z))!==O);)O=P;return re}getMinorTickInterval(){let{minorTicks:p,minorTickInterval:b}=this.options;return p===!0?No(b,"auto"):p!==!1?b:void 0}getMinorTickPositions(){var de;let p=this.options,b=this.tickPositions,T=this.minorTickInterval,P=this.pointRangePadding||0,O=(this.min||0)-P,z=(this.max||0)+P,j=(de=this.brokenAxis)!=null&&de.hasBreaks?this.brokenAxis.unitLength:z-O,X=[],re;if(j&&j/T<this.len/3){let ne=this.logarithmic;if(ne)this.paddedTicks.forEach(function(ce,ye,Te){ye&&X.push.apply(X,ne.getLogTickPositions(T,Te[ye-1],Te[ye],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")X=X.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(T),O,z,p.startOfWeek));else for(re=O+(b[0]-O)%T;re<=z&&re!==X[0];re+=T)X.push(re)}return X.length!==0&&this.trimTicks(X),X}adjustForMinRange(){let p=this.options,b=this.logarithmic,T=this.chart.time,{max:P,min:O,minRange:z}=this,j,X,re,de;this.isXAxis&&z===void 0&&!b&&(z=Ro(p.min)||Ro(p.max)||Ro(p.floor)||Ro(p.ceiling)?null:Math.min(5*(Hf(this.series.map(ne=>{let ce=ne.getColumn("x");return ne.xIncrement?ce.slice(0,2):ce}))||0),this.dataMax-this.dataMin)),zs(P)&&zs(O)&&zs(z)&&P-O<z&&(X=this.dataMax-this.dataMin>=z,j=(z-P+O)/2,re=[O-j,T.parse(p.min)??O-j],X&&(re[2]=b?b.log2lin(this.dataMin):this.dataMin),de=[(O=Qg(re))+z,T.parse(p.max)??O+z],X&&(de[2]=b?b.log2lin(this.dataMax):this.dataMax),(P=A0(de))-O<z&&(re[0]=P-z,re[1]=T.parse(p.min)??P-z,O=Qg(re))),this.minRange=z,this.min=O,this.max=P}getClosest(){let p,b;if(this.categories)b=1;else{let T=[];this.series.forEach(function(P){let O=P.closestPointRange,z=P.getColumn("x");z.length===1?T.push(z[0]):P.sorted&&Ro(O)&&P.reserveSpace()&&(b=Ro(b)?Math.min(b,O):O)}),T.length&&(T.sort((P,O)=>P-O),p=Hf([T]))}return p&&b?Math.min(p,b):p||b}nameToX(p){let b=Op(this.options.categories),T=b?this.categories:this.names,P=p.options.x,O;return p.series.requireSorting=!1,Ro(P)||(P=this.uniqueNames&&T?b?T.indexOf(p.name):No(T.keys[p.name],-1):p.series.autoIncrement()),P===-1?!b&&T&&(O=T.length):zs(P)&&(O=P),O!==void 0?(this.names[O]=p.name,this.names.keys[p.name]=O):p.x&&(O=p.x),O}updateNames(){let p=this,b=this.names;b.length>0&&(Object.keys(b.keys).forEach(function(T){delete b.keys[T]}),b.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(T=>{T.xIncrement=null,(!T.points||T.isDirtyData)&&(p.max=Math.max(p.max||0,T.dataTable.rowCount-1),T.processData(),T.generatePoints());let P=T.getColumn("x").slice();T.data.forEach((O,z)=>{let j=P[z];O!=null&&O.options&&O.name!==void 0&&(j=p.nameToX(O))!==void 0&&j!==O.x&&(P[z]=O.x=j)}),T.dataTable.setColumn("x",P)}))}setAxisTranslation(){var ce;let p=this,b=p.max-p.min,T=p.linkedParent,P=!!p.categories,O=p.isXAxis,z=p.axisPointRange||0,j,X=0,re=0,de,ne=p.transA;(O||P||z)&&(j=p.getClosest(),T?(X=T.minPointOffset,re=T.pointRangePadding):p.series.forEach(function(ye){let Te=P?1:O?No(ye.options.pointRange,j,0):p.axisPointRange||0,De=ye.options.pointPlacement;if(z=Math.max(z,Te),!p.single||P){let Oe=ye.is("xrange")?!O:O;X=Math.max(X,Oe&&Yu(De)?0:Te/2),re=Math.max(re,Oe&&De==="on"?0:Te)}}),de=(ce=p.ordinal)!=null&&ce.slope&&j?p.ordinal.slope/j:1,p.minPointOffset=X*=de,p.pointRangePadding=re*=de,p.pointRange=Math.min(z,p.single&&P?1:b),O&&(p.closestPointRange=j)),p.translationSlope=p.transA=ne=p.staticScale||p.len/(b+re||1),p.transB=p.horiz?p.left:p.bottom,p.minPixelPadding=ne*X,ml(this,"afterSetAxisTranslation")}minFromRange(){let{max:p,min:b}=this;return zs(p)&&zs(b)&&p-b||void 0}setTickInterval(p){var xn,Nn,Bn,Xn;let{categories:b,chart:T,dataMax:P,dataMin:O,dateTime:z,isXAxis:j,logarithmic:X,options:re,softThreshold:de}=this,ne=T.time,ce=zs(this.threshold)?this.threshold:void 0,ye=this.minRange||0,{ceiling:Te,floor:De,linkedTo:Oe,softMax:Be,softMin:Ke}=re,st=zs(Oe)&&((xn=T[this.coll])==null?void 0:xn[Oe]),Bt=re.tickPixelInterval,Ut=re.maxPadding,$t=re.minPadding,ci=0,oi,di=zs(re.tickInterval)&&re.tickInterval>=0?re.tickInterval:void 0,er,Vi,lr,Vr;if(z||b||st||this.getTickAmount(),lr=No(this.userMin,ne.parse(re.min)),Vr=No(this.userMax,ne.parse(re.max)),st?(this.linkedParent=st,oi=st.getExtremes(),this.min=No(oi.min,oi.dataMin),this.max=No(oi.max,oi.dataMax),this.type!==st.type&&uf(11,!0,T)):(de&&Ro(ce)&&zs(P)&&zs(O)&&(O>=ce?(er=ce,$t=0):P<=ce&&(Vi=ce,Ut=0)),this.min=No(lr,er,O),this.max=No(Vr,Vi,P)),zs(this.max)&&zs(this.min)&&(X&&(this.positiveValuesOnly&&!p&&0>=Math.min(this.min,No(O,this.min))&&uf(10,!0,T),this.min=Es(X.log2lin(this.min),16),this.max=Es(X.log2lin(this.max),16)),this.range&&zs(O)&&(this.userMin=this.min=lr=Math.max(O,this.minFromRange()||0),this.userMax=Vr=this.max,this.range=void 0)),ml(this,"foundExtremes"),this.adjustForMinRange(),zs(this.min)&&zs(this.max)){if(!zs(this.userMin)&&zs(Ke)&&Ke<this.min&&(this.min=lr=Ke),!zs(this.userMax)&&zs(Be)&&Be>this.max&&(this.max=Vr=Be),b||this.axisPointRange||(Nn=this.stacking)!=null&&Nn.usePercentage||st||(ci=this.max-this.min)&&(!Ro(lr)&&$t&&(this.min-=ci*$t),!Ro(Vr)&&Ut&&(this.max+=ci*Ut)),!zs(this.userMin)&&zs(De)&&(this.min=Math.max(this.min,De)),!zs(this.userMax)&&zs(Te)&&(this.max=Math.min(this.max,Te)),de&&zs(O)&&zs(P)){let es=ce||0;!Ro(lr)&&this.min<es&&O>=es?this.min=re.minRange?Math.min(es,this.max-ye):es:!Ro(Vr)&&this.max>es&&P<=es&&(this.max=re.minRange?Math.max(es,this.min+ye):es)}!T.polar&&this.min>this.max&&(Ro(re.min)?this.max=this.min:Ro(re.max)&&(this.min=this.max)),ci=this.max-this.min}if(this.min!==this.max&&zs(this.min)&&zs(this.max)?st&&!di&&Bt===st.options.tickPixelInterval?this.tickInterval=di=st.tickInterval:this.tickInterval=No(di,this.tickAmount?ci/Math.max(this.tickAmount-1,1):void 0,b?1:ci*Bt/Math.max(this.len,Bt)):this.tickInterval=1,j&&!p){let es=this.min!==((Bn=this.old)==null?void 0:Bn.min)||this.max!==((Xn=this.old)==null?void 0:Xn.max);this.series.forEach(function(ns){var Qs;ns.forceCrop=(Qs=ns.forceCropping)==null?void 0:Qs.call(ns),ns.processData(es)}),ml(this,"postProcessData",{hasExtremesChanged:es})}this.setAxisTranslation(),ml(this,"initialAxisTranslation"),this.pointRange&&!di&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Wn=No(re.minTickInterval,z&&!this.series.some(es=>!es.sorted)?this.closestPointRange:0);!di&&Wn&&this.tickInterval<Wn&&(this.tickInterval=Wn),z||X||di||(this.tickInterval=Em(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var de,ne;let p=this.options,b=p.tickPositions,T=p.tickPositioner,P=this.getMinorTickInterval(),O=!this.isPanning,z=O&&p.startOnTick,j=O&&p.endOnTick,X=[],re;if(this.tickmarkOffset=this.categories&&p.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&Ro(this.min)&&!this.tickAmount&&(this.min%1==0||p.allowDecimals!==!1),b)X=b.slice();else if(zs(this.min)&&zs(this.max)){if(!((de=this.ordinal)!=null&&de.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))X=[this.min,this.max],uf(19,!1,this.chart);else if(this.dateTime)X=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,p.units),this.min,this.max,p.startOfWeek,(ne=this.ordinal)==null?void 0:ne.positions,this.closestPointRange,!0);else if(this.logarithmic)X=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let ce=this.tickInterval,ye=ce;for(;ye<=2*ce&&(X=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&X.length>this.tickAmount);)this.tickInterval=Em(this,ye*=1.1)}X.length>this.len&&(X=[X[0],X[X.length-1]])[0]===X[1]&&(X.length=1),T&&(this.tickPositions=X,(re=T.apply(this,[this.min,this.max]))&&(X=re))}this.tickPositions=X,this.minorTickInterval=P==="auto"&&this.tickInterval?this.tickInterval/p.minorTicksPerMajor:P,this.paddedTicks=X.slice(0),this.trimTicks(X,z,j),!this.isLinked&&zs(this.min)&&zs(this.max)&&(this.single&&X.length<2&&!this.categories&&!this.series.some(ce=>ce.is("heatmap")&&ce.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),b||re||this.adjustTickAmount()),ml(this,"afterSetTickPositions")}trimTicks(p,b,T){let P=p[0],O=p[p.length-1],z=!this.isOrdinal&&this.minPointOffset||0;if(ml(this,"trimTicks"),!this.isLinked||!this.grid){if(b&&P!==-1/0)this.min=P;else for(;this.min-z>p[0];)p.shift();if(T)this.max=O;else for(;this.max+z<p[p.length-1];)p.pop();p.length===0&&Ro(P)&&!this.options.tickPositions&&p.push((O+P)/2)}}alignToOthers(){let p,b=this,T=b.chart,P=[this],O=b.options,z=T.options.chart,j=this.coll==="yAxis"&&z.alignThresholds,X=[];if(b.thresholdAlignment=void 0,(z.alignTicks!==!1&&O.alignTicks||j)&&O.startOnTick!==!1&&O.endOnTick!==!1&&!b.logarithmic){let re=ne=>{let{horiz:ce,options:ye}=ne;return[ce?ye.left:ye.top,ye.width,ye.height,ye.pane].join(",")},de=re(this);T[this.coll].forEach(function(ne){let{series:ce}=ne;ce.length&&ce.some(ye=>ye.visible)&&ne!==b&&re(ne)===de&&(p=!0,P.push(ne))})}if(p&&j){P.forEach(de=>{let ne=de.getThresholdAlignment(b);zs(ne)&&X.push(ne)});let re=X.length>1?X.reduce((de,ne)=>de+=ne,0)/X.length:void 0;P.forEach(de=>{de.thresholdAlignment=re})}return p}getThresholdAlignment(p){if((!zs(this.dataMin)||this!==p&&this.series.some(b=>b.isDirty||b.isDirtyData))&&this.getSeriesExtremes(),zs(this.threshold)){let b=jf((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(b=1-b),b}}getTickAmount(){let p=this.options,b=p.tickPixelInterval,T=p.tickAmount;Ro(p.tickInterval)||T||!(this.len<b)||this.isRadial||this.logarithmic||!p.startOnTick||!p.endOnTick||(T=2),!T&&this.alignToOthers()&&(T=Math.ceil(this.len/b)+1),T<4&&(this.finalTickAmt=T,T=5),this.tickAmount=T}adjustTickAmount(){let p=this,{finalTickAmt:b,max:T,min:P,options:O,tickPositions:z,tickAmount:j,thresholdAlignment:X}=p,re=z==null?void 0:z.length,de=No(p.threshold,p.softThreshold?0:null),ne,ce,ye=p.tickInterval,Te,De=()=>z.push(Es(z[z.length-1]+ye)),Oe=()=>z.unshift(Es(z[0]-ye));if(zs(X)&&(Te=X<.5?Math.ceil(X*(j-1)):Math.floor(X*(j-1)),O.reversed&&(Te=j-1-Te)),p.hasData()&&zs(P)&&zs(T)){let Be=()=>{p.transA*=(re-1)/(j-1),p.min=O.startOnTick?z[0]:Math.min(P,z[0]),p.max=O.endOnTick?z[z.length-1]:Math.max(T,z[z.length-1])};if(zs(Te)&&zs(p.threshold)){for(;z[Te]!==de||z.length!==j||z[0]>P||z[z.length-1]<T;){for(z.length=0,z.push(p.threshold);z.length<j;)z[Te]===void 0||z[Te]>p.threshold?Oe():De();if(ye>8*p.tickInterval)break;ye*=2}Be()}else if(re<j){for(;z.length<j;)z.length%2||P===de?De():Oe();Be()}if(Ro(b)){for(ce=ne=z.length;ce--;)(b===3&&ce%2==1||b<=2&&ce>0&&ce<ne-1)&&z.splice(ce,1);p.finalTickAmt=void 0}}}setScale(){var z,j,X,re,de;let{coll:p,stacking:b}=this,T=!1,P=!1;this.series.forEach(ne=>{var ce;T=T||ne.isDirtyData||ne.isDirty,P=P||((ce=ne.xAxis)==null?void 0:ce.isDirty)||!1}),this.setAxisSize();let O=this.len!==((z=this.old)==null?void 0:z.len);O||T||P||this.isLinked||this.forceRedraw||this.userMin!==((j=this.old)==null?void 0:j.userMin)||this.userMax!==((X=this.old)==null?void 0:X.userMax)||this.alignToOthers()?(b&&p==="yAxis"&&b.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),b&&p==="xAxis"&&b.buildStacks(),this.isDirty||(this.isDirty=O||this.min!==((re=this.old)==null?void 0:re.min)||this.max!==((de=this.old)==null?void 0:de.max))):b&&b.cleanStacks(),T&&delete this.allExtremes,ml(this,"afterSetScale")}setExtremes(p,b,T=!0,P,O){let z=this.chart;this.series.forEach(j=>{delete j.kdTree}),p=z.time.parse(p),b=z.time.parse(b),ml(this,"setExtremes",O=fo(O,{min:p,max:b}),j=>{this.userMin=j.min,this.userMax=j.max,this.eventArgs=j,T&&z.redraw(P)})}setAxisSize(){let p=this.chart,b=this.options,T=b.offsets||[0,0,0,0],P=this.horiz,O=this.width=Math.round(Cm(No(b.width,p.plotWidth-T[3]+T[1]),p.plotWidth)),z=this.height=Math.round(Cm(No(b.height,p.plotHeight-T[0]+T[2]),p.plotHeight)),j=this.top=Math.round(Cm(No(b.top,p.plotTop+T[0]),p.plotHeight,p.plotTop)),X=this.left=Math.round(Cm(No(b.left,p.plotLeft+T[3]),p.plotWidth,p.plotLeft));this.bottom=p.chartHeight-z-j,this.right=p.chartWidth-O-X,this.len=Math.max(P?O:z,0),this.pos=P?X:j}getExtremes(){let p=this.logarithmic;return{min:p?Es(p.lin2log(this.min)):this.min,max:p?Es(p.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(p){let b=this.logarithmic,T=b?b.lin2log(this.min):this.min,P=b?b.lin2log(this.max):this.max;return p===null||p===-1/0?p=T:p===1/0?p=P:T>p?p=T:P<p&&(p=P),this.translate(p,0,1,0,1)}autoLabelAlign(p){let b=(No(p,0)-90*this.side+720)%360,T={align:"center"};return ml(this,"autoLabelAlign",T,function(P){b>15&&b<165?P.align="right":b>195&&b<345&&(P.align="left")}),T.align}tickSize(p){let b=this.options,T=No(b[p==="tick"?"tickWidth":"minorTickWidth"],p==="tick"&&this.isXAxis&&!this.categories?1:0),P=b[p==="tick"?"tickLength":"minorTickLength"],O;T&&P&&(b[p+"Position"]==="inside"&&(P=-P),O=[P,T]);let z={tickSize:O};return ml(this,"afterTickSize",z),z.tickSize}labelMetrics(){let p=this.chart.renderer,b=this.ticks,T=b[Object.keys(b)[0]]||{};return this.chart.renderer.fontMetrics(T.label||T.movedLabel||p.box)}unsquish(){let p=this.options.labels,b=p.padding||0,T=this.horiz,P=this.tickInterval,O=this.len/((+!!this.categories+this.max-this.min)/P),z=p.rotation,j=Es(.8*this.labelMetrics().h),X=Math.max(this.max-this.min,0),re=function(Te){let De=(Te+2*b)/(O||1);return(De=De>1?Math.ceil(De):1)*P>X&&Te!==1/0&&O!==1/0&&X&&(De=Math.ceil(X/P)),Es(De*P)},de=P,ne,ce=Number.MAX_VALUE,ye;if(T){if(!p.staggerLines&&(zs(z)?ye=[z]:O<p.autoRotationLimit&&(ye=p.autoRotation)),ye){let Te,De;for(let Oe of ye)(Oe===z||Oe&&Oe>=-90&&Oe<=90)&&(De=(Te=re(Math.abs(j/Math.sin(pc*Oe))))+Math.abs(Oe/360))<ce&&(ce=De,ne=Oe,de=Te)}}else de=re(.75*j);return this.autoRotation=ye,this.labelRotation=No(ne,zs(z)?z:0),p.step?P:de}getSlotWidth(p){let b=this.chart,T=this.horiz,P=this.options.labels,O=Math.max(this.tickPositions.length-!this.categories,1),z=b.margin[3];if(p&&zs(p.slotWidth))return p.slotWidth;if(T&&P.step<2&&!this.isRadial)return P.rotation?0:(this.staggerLines||1)*this.len/O;if(!T){let j=P.style.width;if(j!==void 0)return parseInt(String(j),10);if(z)return z-b.spacing[3]}return .33*b.chartWidth}renderUnsquish(){let p=this.chart,b=p.renderer,T=this.tickPositions,P=this.ticks,O=this.options.labels,z=O.style,j=this.horiz,X=this.getSlotWidth(),re=Math.max(1,Math.round(X-(j?2*(O.padding||0):O.distance||0))),de={},ne=this.labelMetrics(),ce=z.lineClamp,ye,Te=ce??(Math.floor(this.len/(T.length*ne.h))||1),De=0;Yu(O.rotation)||(de.rotation=O.rotation||0),T.forEach(function(Oe){var st;let Be=P[Oe];Be.movedLabel&&Be.replaceMovedLabel();let Ke=((st=Be.label)==null?void 0:st.textPxLength)||0;Ke>De&&(De=Ke)}),this.maxLabelLength=De,this.autoRotation?De>re&&De>ne.h?de.rotation=this.labelRotation:this.labelRotation=0:X&&(ye=re),de.rotation&&(ye=De>.5*p.chartHeight?.33*p.chartHeight:De,ce||(Te=1)),this.labelAlign=O.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(de.align=this.labelAlign),T.forEach(function(Oe){let Be=P[Oe],Ke=Be==null?void 0:Be.label,st=z.width,Bt={};Ke&&(Ke.attr(de),Be.shortenLabel?Be.shortenLabel():ye&&!st&&z.whiteSpace!=="nowrap"&&(ye<(Ke.textPxLength||0)||Ke.element.tagName==="SPAN")?Ke.css(fo(Bt,{width:`${ye}px`,lineClamp:Te})):!Ke.styles.width||Bt.width||st||Ke.css({width:"auto"}),Be.rotation=de.rotation)},this),this.tickRotCorr=b.rotCorr(ne.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(p){return p.hasData()})||this.options.showEmpty&&Ro(this.min)&&Ro(this.max)}addTitle(p){let b,T=this.chart.renderer,P=this.horiz,O=this.opposite,z=this.options.title,j=this.chart.styledMode;this.axisTitle||((b=z.textAlign)||(b=(P?{low:"left",middle:"center",high:"right"}:{low:O?"right":"left",middle:"center",high:O?"left":"right"})[z.align]),this.axisTitle=T.text(z.text||"",0,0,z.useHTML).attr({zIndex:7,rotation:z.rotation||0,align:b}).addClass("highcharts-axis-title"),j||this.axisTitle.css(Rp(z.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),j||z.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[p?"show":"hide"](p)}generateTick(p){let b=this.ticks;b[p]?b[p].addLabel():b[p]=new uo(this,p)}createGroups(){let{axisParent:p,chart:b,coll:T,options:P}=this,O=b.renderer,z=(j,X,re)=>O.g(j).attr({zIndex:re}).addClass(`highcharts-${T.toLowerCase()}${X} `+(this.isRadial?`highcharts-radial-axis${X} `:"")+(P.className||"")).add(p);this.axisGroup||(this.gridGroup=z("grid","-grid",P.gridZIndex),this.axisGroup=z("axis","",P.zIndex),this.labelGroup=z("axis-labels","-labels",P.labels.zIndex))}getOffset(){let p=this,{chart:b,horiz:T,options:P,side:O,ticks:z,tickPositions:j,coll:X}=p,re=b.inverted&&!p.isZAxis?[1,0,3,2][O]:O,de=p.hasData(),ne=P.title,ce=P.labels,ye=zs(P.crossing),Te=b.axisOffset,De=b.clipOffset,Oe=[-1,1,1,-1][O],Be,Ke=0,st,Bt=0,Ut=0,$t,ci;if(p.showAxis=Be=de||P.showEmpty,p.staggerLines=p.horiz&&ce.staggerLines||void 0,p.createGroups(),de||p.isLinked?(j.forEach(function(oi){p.generateTick(oi)}),p.renderUnsquish(),p.reserveSpaceDefault=O===0||O===2||{1:"left",3:"right"}[O]===p.labelAlign,No(ce.reserveSpace,!ye&&null,p.labelAlign==="center"||null,p.reserveSpaceDefault)&&j.forEach(function(oi){Ut=Math.max(z[oi].getLabelSize(),Ut)}),p.staggerLines&&(Ut*=p.staggerLines),p.labelOffset=Ut*(p.opposite?-1:1)):wd(z,function(oi,di){oi.destroy(),delete z[di]}),ne!=null&&ne.text&&ne.enabled!==!1&&(p.addTitle(Be),Be&&!ye&&ne.reserveSpace!==!1&&(p.titleOffset=Ke=p.axisTitle.getBBox()[T?"height":"width"],Bt=Ro(st=ne.offset)?0:No(ne.margin,T?5:10))),p.renderLine(),p.offset=Oe*No(P.offset,Te[O]?Te[O]+(P.margin||0):0),p.tickRotCorr=p.tickRotCorr||{x:0,y:0},ci=O===0?-p.labelMetrics().h:O===2?p.tickRotCorr.y:0,$t=Math.abs(Ut)+Bt,Ut&&($t-=ci,$t+=Oe*(T?No(ce.y,p.tickRotCorr.y+Oe*ce.distance):No(ce.x,Oe*ce.distance))),p.axisTitleMargin=No(st,$t),p.getMaxLabelDimensions&&(p.maxLabelDimensions=p.getMaxLabelDimensions(z,j)),X!=="colorAxis"&&De){let oi=this.tickSize("tick");Te[O]=Math.max(Te[O],(p.axisTitleMargin||0)+Ke+Oe*p.offset,$t,j!=null&&j.length&&oi?oi[0]+Oe*p.offset:0);let di=!p.axisLine||P.offset?0:p.axisLine.strokeWidth()/2;De[re]=Math.max(De[re],di)}ml(this,"afterGetOffset")}getLinePath(p){let b=this.chart,T=this.opposite,P=this.offset,O=this.horiz,z=this.left+(T?this.width:0)+P,j=b.chartHeight-this.bottom-(T?this.height:0)+P;return T&&(p*=-1),b.renderer.crispLine([["M",O?this.left:z,O?j:this.top],["L",O?b.chartWidth-this.right:z,O?j:b.chartHeight-this.bottom]],p)}renderLine(){!this.axisLine&&(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(p){let b=this.horiz,T=this.left,P=this.top,O=this.len,z=this.options.title,j=b?T:P,X=this.opposite,re=this.offset,de=z.x,ne=z.y,ce=this.chart.renderer.fontMetrics(p),ye=p?Math.max(p.getBBox(!1,0).height-ce.h-1,0):0,Te={low:j+(b?0:O),middle:j+O/2,high:j+(b?O:0)}[z.align],De=(b?P+this.height:T)+(b?1:-1)*(X?-1:1)*(this.axisTitleMargin||0)+[-ye,ye,ce.f,-ye][this.side],Oe={x:b?Te+de:De+(X?this.width:0)+re+de,y:b?De+ne-(X?this.height:0)+re:Te+ne};return ml(this,"afterGetTitlePosition",{titlePosition:Oe}),Oe}renderMinorTick(p,b){let T=this.minorTicks;T[p]||(T[p]=new uo(this,p,"minor")),b&&T[p].isNew&&T[p].render(null,!0),T[p].render(null,!1,1)}renderTick(p,b,T){var z;let P=this.isLinked,O=this.ticks;(!P||p>=this.min&&p<=this.max||(z=this.grid)!=null&&z.isColumn)&&(O[p]||(O[p]=new uo(this,p)),T&&O[p].isNew&&O[p].render(b,!0,-1),O[p].render(b))}render(){let p,b,T=this,P=T.chart,O=T.logarithmic,z=P.renderer,j=T.options,X=T.isLinked,re=T.tickPositions,de=T.axisTitle,ne=T.ticks,ce=T.minorTicks,ye=T.alternateBands,Te=j.stackLabels,De=j.alternateGridColor,Oe=j.crossing,Be=T.tickmarkOffset,Ke=T.axisLine,st=T.showAxis,Bt=Wl(z.globalAnimation);if(T.labelEdge.length=0,T.overlap=!1,[ne,ce,ye].forEach(function(Ut){wd(Ut,function($t){$t.isActive=!1})}),zs(Oe)){let Ut=this.isXAxis?P.yAxis[0]:P.xAxis[0],$t=[1,-1,-1,1][this.side];if(Ut){let ci=Ut.toPixels(Oe,!0);T.horiz&&(ci=Ut.len-ci),T.offset=$t*ci}}if(T.hasData()||X){let Ut=T.chart.hasRendered&&T.old&&zs(T.old.min);T.minorTickInterval&&!T.categories&&T.getMinorTickPositions().forEach(function($t){T.renderMinorTick($t,Ut)}),re.length&&(re.forEach(function($t,ci){T.renderTick($t,ci,Ut)}),Be&&(T.min===0||T.single)&&(ne[-1]||(ne[-1]=new uo(T,-1,null,!0)),ne[-1].render(-1))),De&&re.forEach(function($t,ci){b=re[ci+1]!==void 0?re[ci+1]+Be:T.max-Be,ci%2==0&&$t<T.max&&b<=T.max+(P.polar?-Be:Be)&&(ye[$t]||(ye[$t]=new Je.PlotLineOrBand(T,{})),p=$t+Be,ye[$t].options={from:O?O.lin2log(p):p,to:O?O.lin2log(b):b,color:De,className:"highcharts-alternate-grid"},ye[$t].render(),ye[$t].isActive=!0)}),T._addedPlotLB||(T._addedPlotLB=!0,(j.plotLines||[]).concat(j.plotBands||[]).forEach(function($t){T.addPlotBandOrLine($t)}))}[ne,ce,ye].forEach(function(Ut){let $t=[],ci=Bt.duration;wd(Ut,function(oi,di){oi.isActive||(oi.render(di,!1,0),oi.isActive=!1,$t.push(di))}),M0(function(){let oi=$t.length;for(;oi--;)Ut[$t[oi]]&&!Ut[$t[oi]].isActive&&(Ut[$t[oi]].destroy(),delete Ut[$t[oi]])},Ut!==ye&&P.hasRendered&&ci?ci:0)}),Ke&&(Ke[Ke.isPlaced?"animate":"attr"]({d:this.getLinePath(Ke.strokeWidth())}),Ke.isPlaced=!0,Ke[st?"show":"hide"](st)),de&&st&&(de[de.isNew?"attr":"animate"](T.getTitlePosition(de)),de.isNew=!1),Te!=null&&Te.enabled&&T.stacking&&T.stacking.renderStackTotals(),T.old={len:T.len,max:T.max,min:T.min,transA:T.transA,userMax:T.userMax,userMin:T.userMin},T.isDirty=!1,ml(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(p){p.render()})),this.series.forEach(function(p){p.isDirty=!0})}getKeepProps(){return this.keepProps||wu.keepProps}destroy(p){let b=this,T=b.plotLinesAndBands,P=this.eventOptions;if(ml(this,"destroy",{keepEvents:p}),p||yg(b),[b.ticks,b.minorTicks,b.alternateBands].forEach(function(O){eh(O)}),T){let O=T.length;for(;O--;)T[O].destroy()}for(let O in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(z){b[z]&&(b[z]=b[z].destroy())}),b.plotLinesAndBandsGroups)b.plotLinesAndBandsGroups[O]=b.plotLinesAndBandsGroups[O].destroy();wd(b,function(O,z){b.getKeepProps().indexOf(z)===-1&&delete b[z]}),this.eventOptions=P}drawCrosshair(p,b){var ne;let T=this.crosshair,P=(T==null?void 0:T.snap)??!0,O=this.chart,z,j,X,re=this.cross,de;if(ml(this,"drawCrosshair",{e:p,point:b}),p||(p=(ne=this.cross)==null?void 0:ne.e),T&&(Ro(b)||!P)!==!1){if(P?Ro(b)&&(j=No(this.coll!=="colorAxis"?b.crosshairPos:null,this.isXAxis?b.plotX:this.len-b.plotY)):j=p&&(this.horiz?p.chartX-this.pos:this.len-p.chartY+this.pos),Ro(j)&&(de={value:b&&(this.isXAxis?b.x:No(b.stackY,b.y)),translatedValue:j},O.polar&&fo(de,{isCrosshair:!0,chartX:p==null?void 0:p.chartX,chartY:p==null?void 0:p.chartY,point:b}),z=this.getPlotLinePath(de)||null),!Ro(z))return void this.hideCrosshair();X=this.categories&&!this.isRadial,re||(this.cross=re=O.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(X?"category ":"thin ")+(T.className||"")).attr({zIndex:No(T.zIndex,2)}).add(),!O.styledMode&&(re.attr({stroke:T.color||(X?ai.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":No(T.width,1)}).css({"pointer-events":"none"}),T.dashStyle&&re.attr({dashstyle:T.dashStyle}))),re.show().attr({d:z}),X&&!T.width&&re.attr({"stroke-width":this.transA}),this.cross.e=p}else this.hideCrosshair();ml(this,"afterDrawCrosshair",{e:p,point:b})}hideCrosshair(){this.cross&&this.cross.hide(),ml(this,"afterHideCrosshair")}update(p,b){let T=this.chart;p=Rp(this.userOptions,p),this.destroy(!0),this.init(T,p),T.isDirtyBox=!0,No(b,!0)&&T.redraw()}remove(p){let b=this.chart,T=this.coll,P=this.series,O=P.length;for(;O--;)P[O]&&P[O].remove(!1);gg(b.axes,this),gg(b[T]||[],this),b.orderItems(T),this.destroy(),b.isDirtyBox=!0,No(p,!0)&&b.redraw()}setTitle(p,b){this.update({title:p},b)}setCategories(p,b){this.update({categories:p},b)}}wu.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:Bp,getMagnitude:zt,normalizeTickInterval:Gf,timeUnits:qf}=Ht;(function(ie){function p(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function b(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new T(this))}ie.compose=function(P){return P.keepProps.includes("dateTime")||(P.keepProps.push("dateTime"),P.prototype.getTimeTicks=p,Bp(P,"afterSetType",b)),P};class T{constructor(O){this.axis=O}normalizeTimeTickInterval(O,z){let j=z||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],X=j[j.length-1],re=qf[X[0]],de=X[1],ne;for(ne=0;ne<j.length&&(re=qf[(X=j[ne])[0]],de=X[1],!j[ne+1]||!(O<=(re*de[de.length-1]+qf[j[ne+1][0]])/2));ne++);re===qf.year&&O<5*re&&(de=[1,2,5]);let ce=Gf(O/re,de,X[0]==="year"?Math.max(zt(O/re),1):1);return{unitRange:re,count:ce,unitName:X[0]}}getXDateFormat(O,z){let{axis:j}=this,X=j.chart.time;return j.closestPointRange?X.getDateFormat(j.closestPointRange,O,j.options.startOfWeek,z)||X.resolveDTLFormat(z.year).main:X.resolveDTLFormat(z.day).main}}ie.Additions=T})(q||(q={}));let Su=q,{addEvent:wa,normalizeTickInterval:Xu,pick:Jg}=Ht;(function(ie){function p(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new T(this))}function b(){let P=this.logarithmic;P&&(this.lin2val=function(O){return P.lin2log(O)},this.val2lin=function(O){return P.log2lin(O)})}ie.compose=function(P){return P.keepProps.includes("logarithmic")||(P.keepProps.push("logarithmic"),wa(P,"afterSetType",p),wa(P,"afterInit",b)),P};class T{constructor(O){this.axis=O}getLogTickPositions(O,z,j,X){let re=this.axis,de=re.len,ne=re.options,ce=[];if(X||(this.minorAutoInterval=void 0),O>=.5)O=Math.round(O),ce=re.getLinearTickPositions(O,z,j);else if(O>=.08){let ye,Te,De,Oe,Be,Ke,st,Bt=Math.floor(z);for(ye=O>.3?[1,2,4]:O>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Te=Bt;Te<j+1&&!st;Te++)for(De=0,Oe=ye.length;De<Oe&&!st;De++)(Be=this.log2lin(this.lin2log(Te)*ye[De]))>z&&(!X||Ke<=j)&&Ke!==void 0&&ce.push(Ke),Ke>j&&(st=!0),Ke=Be}else{let ye=this.lin2log(z),Te=this.lin2log(j),De=X?re.getMinorTickInterval():ne.tickInterval,Oe=ne.tickPixelInterval/(X?5:1),Be=X?de/re.tickPositions.length:de;O=Xu(O=Jg(De==="auto"?null:De,this.minorAutoInterval,(Te-ye)*Oe/(Be||1))),ce=re.getLinearTickPositions(O,ye,Te).map(this.log2lin),X||(this.minorAutoInterval=O/5)}return X||(re.tickInterval=O),ce}lin2log(O){return Math.pow(10,O)}log2lin(O){return Math.log(O)/Math.LN10}}ie.Additions=T})(Q||(Q={}));let pf=Q,{erase:Fp,extend:ey,isNumber:I0}=Ht;(function(ie){let p;function b(re){return this.addPlotBandOrLine(re,"plotBands")}function T(re,de){let ne=this.userOptions,ce=new p(this,re);if(this.visible&&(ce=ce.render()),ce){if(this._addedPlotLB||(this._addedPlotLB=!0,(ne.plotLines||[]).concat(ne.plotBands||[]).forEach(ye=>{this.addPlotBandOrLine(ye)})),de){let ye=ne[de]||[];ye.push(re),ne[de]=ye}this.plotLinesAndBands.push(ce)}return ce}function P(re){return this.addPlotBandOrLine(re,"plotLines")}function O(re,de,ne){ne=ne||this.options;let ce=this.getPlotLinePath({value:de,force:!0,acrossPanes:ne.acrossPanes}),ye=[],Te=this.horiz,De=!I0(this.min)||!I0(this.max)||re<this.min&&de<this.min||re>this.max&&de>this.max,Oe=this.getPlotLinePath({value:re,force:!0,acrossPanes:ne.acrossPanes}),Be,Ke=1,st;if(Oe&&ce)for(De&&(st=Oe.toString()===ce.toString(),Ke=0),Be=0;Be<Oe.length;Be+=2){let Bt=Oe[Be],Ut=Oe[Be+1],$t=ce[Be],ci=ce[Be+1];(Bt[0]==="M"||Bt[0]==="L")&&(Ut[0]==="M"||Ut[0]==="L")&&($t[0]==="M"||$t[0]==="L")&&(ci[0]==="M"||ci[0]==="L")&&(Te&&$t[1]===Bt[1]?($t[1]+=Ke,ci[1]+=Ke):Te||$t[2]!==Bt[2]||($t[2]+=Ke,ci[2]+=Ke),ye.push(["M",Bt[1],Bt[2]],["L",Ut[1],Ut[2]],["L",ci[1],ci[2]],["L",$t[1],$t[2]],["Z"])),ye.isFlat=st}return ye}function z(re){this.removePlotBandOrLine(re)}function j(re){let de=this.plotLinesAndBands,ne=this.options,ce=this.userOptions;if(de){let ye=de.length;for(;ye--;)de[ye].id===re&&de[ye].destroy();[ne.plotLines||[],ce.plotLines||[],ne.plotBands||[],ce.plotBands||[]].forEach(function(Te){var De;for(ye=Te.length;ye--;)((De=Te[ye])==null?void 0:De.id)===re&&Fp(Te,Te[ye])})}}function X(re){this.removePlotBandOrLine(re)}ie.compose=function(re,de){let ne=de.prototype;return ne.addPlotBand||(p=re,ey(ne,{addPlotBand:b,addPlotLine:P,addPlotBandOrLine:T,getPlotBandPath:O,removePlotBand:z,removePlotLine:X,removePlotBandOrLine:j})),de}})(te||(te={}));let Yf=te,{addEvent:dp,arrayMax:zy,arrayMin:Oc,defined:Zu,destroyObjectProperties:vg,erase:xg,fireEvent:Uy,merge:ty,objectEach:Sd,pick:pp}=Ht;class fp{static compose(p,b){return dp(p,"afterInit",function(){this.labelCollectors.push(()=>{var P;let T=[];for(let O of this.axes)for(let{label:z,options:j}of O.plotLinesAndBands)z&&!((P=j==null?void 0:j.label)!=null&&P.allowOverlap)&&T.push(z);return T})}),Yf.compose(fp,b)}constructor(p,b){this.axis=p,this.options=b,this.id=b.id}render(){Uy(this,"render");let{axis:p,options:b}=this,{horiz:T,logarithmic:P}=p,{color:O,events:z,zIndex:j=0}=b,{renderer:X,time:re}=p.chart,de={},ne=re.parse(b.to),ce=re.parse(b.from),ye=re.parse(b.value),Te=b.borderWidth,De=b.label,{label:Oe,svgElem:Be}=this,Ke=[],st,Bt=Zu(ce)&&Zu(ne),Ut=Zu(ye),$t=!Be,ci={class:"highcharts-plot-"+(Bt?"band ":"line ")+(b.className||"")},oi=Bt?"bands":"lines";if(!p.chart.styledMode&&(Ut?(ci.stroke=O||"#999999",ci["stroke-width"]=pp(b.width,1),b.dashStyle&&(ci.dashstyle=b.dashStyle)):Bt&&(ci.fill=O||"#e6e9ff",Te&&(ci.stroke=b.borderColor,ci["stroke-width"]=Te))),de.zIndex=j,oi+="-"+j,(st=p.plotLinesAndBandsGroups[oi])||(p.plotLinesAndBandsGroups[oi]=st=X.g("plot-"+oi).attr(de).add()),Be||(this.svgElem=Be=X.path().attr(ci).add(st)),Zu(ye))Ke=p.getPlotLinePath({value:(P==null?void 0:P.log2lin(ye))??ye,lineWidth:Be.strokeWidth(),acrossPanes:b.acrossPanes});else{if(!(Zu(ce)&&Zu(ne)))return;Ke=p.getPlotBandPath((P==null?void 0:P.log2lin(ce))??ce,(P==null?void 0:P.log2lin(ne))??ne,b)}return!this.eventsAdded&&z&&(Sd(z,(di,er)=>{Be==null||Be.on(er,Vi=>{z[er].apply(this,[Vi])})}),this.eventsAdded=!0),($t||!Be.d)&&(Ke!=null&&Ke.length)?Be.attr({d:Ke}):Be&&(Ke?(Be.show(),Be.animate({d:Ke})):Be.d&&(Be.hide(),Oe&&(this.label=Oe=Oe.destroy()))),De&&(Zu(De.text)||Zu(De.formatter))&&(Ke!=null&&Ke.length)&&p.width>0&&p.height>0&&!Ke.isFlat?(De=ty({align:T&&Bt?"center":void 0,x:T?!Bt&&4:10,verticalAlign:!T&&Bt?"middle":void 0,y:T?Bt?16:10:Bt?6:-4,rotation:T&&!Bt?90:0,...Bt?{inside:!0}:{}},De),this.renderLabel(De,Ke,Bt,j)):Oe&&Oe.hide(),this}renderLabel(p,b,T,P){var Te,De;let O=this.axis,z=O.chart.renderer,j=p.inside,X=this.label;X||(this.label=X=z.text(this.getLabelText(p),0,0,p.useHTML).attr({align:p.textAlign||p.align,rotation:p.rotation,class:"highcharts-plot-"+(T?"band":"line")+"-label "+(p.className||""),zIndex:P}),O.chart.styledMode||X.css(ty({color:(Te=O.chart.options.title)==null?void 0:Te.style.color,fontSize:"0.8em",textOverflow:T&&!j?"":"ellipsis"},p.style)),X.add());let re=b.xBounds||[b[0][1],b[1][1],T?b[2][1]:b[0][1]],de=b.yBounds||[b[0][2],b[1][2],T?b[2][2]:b[0][2]],ne=Oc(re),ce=Oc(de),ye=zy(re)-ne;X.align(p,!1,{x:ne,y:ce,width:ye,height:zy(de)-ce}),X.alignAttr.y-=z.fontMetrics(X).b,(!X.alignValue||X.alignValue==="left"||Zu(j))&&X.css({width:(((De=p.style)==null?void 0:De.width)||(T&&j?ye:X.rotation===90?O.height-(X.alignAttr.y-O.top):(p.clip?O.width:O.chart.chartWidth)-(X.alignAttr.x-O.left)))+"px"}),X.show(!0)}getLabelText(p){return Zu(p.formatter)?p.formatter.call(this):p.text}destroy(){xg(this.axis.plotLinesAndBands,this),delete this.axis,vg(this)}}let{animObject:$y}=zr,{format:km}=ba,{composed:iy,dateFormats:zp,doc:ff,isSafari:L0}=Je,{distribute:$d}=Vs,{addEvent:Vy,clamp:Am,css:mp,discardElement:C_,extend:Mm,fireEvent:Im,getAlignFactor:Lm,isArray:mf,isNumber:Wy,isObject:bg,isString:gf,merge:Vd,pick:Td,pushUnique:jy,splat:Ku,syncTimeout:Tu}=Ht;class Up{constructor(p,b,T){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=p,this.init(p,b),this.pointer=T}bodyFormatter(p){return p.map(b=>{let T=b.series.tooltipOptions,P=b.formatPrefix||"point";return(T[P+"Formatter"]||b.tooltipFormatter).call(b,T[P+"Format"]||"")})}cleanSplit(p){this.chart.series.forEach(function(b){let T=b==null?void 0:b.tt;T&&(!T.isActive||p?b.tt=T.destroy():T.isActive=!1)})}defaultFormatter(p){let b,T=this.points||Ku(this);return(b=(b=[p.headerFooterFormatter(T[0])]).concat(p.bodyFormatter(T))).push(p.headerFooterFormatter(T[0],!0)),b}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),C_(this.container)),Ht.clearTimeout(this.hideTimer)}getAnchor(p,b){var de;let T,{chart:P,pointer:O}=this,z=P.inverted,j=P.plotTop,X=P.plotLeft;if(p=Ku(p),(de=p[0].series)!=null&&de.yAxis&&!p[0].series.yAxis.options.reversedStacks&&(p=p.slice().reverse()),this.followPointer&&b)b.chartX===void 0&&(b=O.normalize(b)),T=[b.chartX-X,b.chartY-j];else if(p[0].tooltipPos)T=p[0].tooltipPos;else{let ne=0,ce=0;p.forEach(function(ye){let Te=ye.pos(!0);Te&&(ne+=Te[0],ce+=Te[1])}),ne/=p.length,ce/=p.length,this.shared&&p.length>1&&b&&(z?ne=b.chartX:ce=b.chartY),T=[ne-X,ce-j]}let re={point:p[0],ret:T};return Im(this,"getAnchor",re),re.ret.map(Math.round)}getClassName(p,b,T){let P=this.options,O=p.series,z=O.options;return[P.className,"highcharts-label",T&&"highcharts-tooltip-header",b?"highcharts-tooltip-box":"highcharts-tooltip",!T&&"highcharts-color-"+Td(p.colorIndex,O.colorIndex),z==null?void 0:z.className].filter(gf).join(" ")}getLabel({anchorX:p,anchorY:b}={anchorX:0,anchorY:0}){let T=this,P=this.chart.styledMode,O=this.options,z=this.split&&this.allowShared,j=this.container,X=this.chart.renderer;if(this.label){let re=!this.label.hasClass("highcharts-label");(!z&&re||z&&!re)&&this.destroy()}if(!this.label){if(this.outside){let re=this.chart,de=re.options.chart.style,ne=ca.getRendererType();this.container=j=Je.doc.createElement("div"),j.className="highcharts-tooltip-container "+(re.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),mp(j,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((de==null?void 0:de.zIndex)||0)+3)}),this.renderer=X=new ne(j,0,0,de,void 0,void 0,X.styledMode)}if(z?this.label=X.g("tooltip"):(this.label=X.label("",p,b,O.shape||"callout",void 0,void 0,O.useHTML,void 0,"tooltip").attr({padding:O.padding,r:O.borderRadius}),P||this.label.attr({fill:O.backgroundColor,"stroke-width":O.borderWidth||0}).css(O.style).css({pointerEvents:O.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),T.outside){let re=this.label;[re.xSetter,re.ySetter].forEach((de,ne)=>{re[ne?"ySetter":"xSetter"]=ce=>{de.call(re,T.distance),re[ne?"y":"x"]=ce,j&&(j.style[ne?"top":"left"]=`${ce}px`)}})}this.label.attr({zIndex:8}).shadow(O.shadow??!O.fixed).add()}return j&&!j.parentElement&&Je.doc.body.appendChild(j),this.label}getPlayingField(){let{body:p,documentElement:b}=ff,{chart:T,distance:P,outside:O}=this;return{width:O?Math.max(p.scrollWidth,b.scrollWidth,p.offsetWidth,b.offsetWidth,b.clientWidth)-2*P-2:T.chartWidth,height:O?Math.max(p.scrollHeight,b.scrollHeight,p.offsetHeight,b.offsetHeight,b.clientHeight):T.chartHeight}}getPosition(p,b,T){var xn,Nn;let{distance:P,chart:O,outside:z,pointer:j}=this,{inverted:X,plotLeft:re,plotTop:de,polar:ne}=O,{plotX:ce=0,plotY:ye=0}=T,Te={},De=X&&T.h||0,{height:Oe,width:Be}=this.getPlayingField(),Ke=j.getChartPosition(),st=Bn=>Bn*Ke.scaleX,Bt=Bn=>Bn*Ke.scaleY,Ut=Bn=>{let Xn=Bn==="x";return[Bn,Xn?Be:Oe,Xn?p:b].concat(z?[Xn?st(p):Bt(b),Xn?Ke.left-P+st(ce+re):Ke.top-P+Bt(ye+de),0,Xn?Be:Oe]:[Xn?p:b,Xn?ce+re:ye+de,Xn?re:de,Xn?re+O.plotWidth:de+O.plotHeight])},$t=Ut("y"),ci=Ut("x"),oi,di=!!T.negative;!ne&&((Nn=(xn=O.hoverSeries)==null?void 0:xn.yAxis)!=null&&Nn.reversed)&&(di=!di);let er=!this.followPointer&&Td(T.ttBelow,!ne&&!X===di),Vi=function(Bn,Xn,es,ns,Qs,Nl,Uo){let jo=z?Bn==="y"?Bt(P):st(P):P,mo=(es-ns)/2,io=ns<Qs-P,vc=Qs+P+ns<Xn,El=Qs-jo-es+mo,fc=Qs+jo-mo;if(er&&vc)Te[Bn]=fc;else if(!er&&io)Te[Bn]=El;else if(io)Te[Bn]=Math.min(Uo-ns,El-De<0?El:El-De);else{if(!vc)return Te[Bn]=0,!1;Te[Bn]=Math.max(Nl,fc+De+es>Xn?fc:fc+De)}},lr=function(Bn,Xn,es,ns,Qs){if(Qs<P||Qs>Xn-P)return!1;Qs<es/2?Te[Bn]=1:Qs>Xn-ns/2?Te[Bn]=Xn-ns-2:Te[Bn]=Qs-es/2},Vr=function(Bn){[$t,ci]=[ci,$t],oi=Bn},Wn=()=>{Vi.apply(0,$t)!==!1?lr.apply(0,ci)!==!1||oi||(Vr(!0),Wn()):oi?Te.x=Te.y=0:(Vr(!0),Wn())};return(X&&!ne||this.len>1)&&Vr(),Wn(),Te}getFixedPosition(p,b,T){var ce;let P=T.series,{chart:O,options:z,split:j}=this,X=z.position,re=X.relativeTo,de=z.shared||(ce=P==null?void 0:P.yAxis)!=null&&ce.isRadial&&(re==="pane"||!re)?"plotBox":re,ne=de==="chart"?O.renderer:O[de]||O.getClipBox(P,!0);return{x:ne.x+(ne.width-p)*Lm(X.align)+X.x,y:ne.y+(ne.height-b)*Lm(X.verticalAlign)+(!j&&X.y||0)}}hide(p){let b=this;Ht.clearTimeout(this.hideTimer),p=Td(p,this.options.hideDelay),this.isHidden||(this.hideTimer=Tu(function(){let T=b.getLabel();b.getLabel().animate({opacity:0},{duration:p&&150,complete:()=>{T.hide(),b.container&&b.container.remove()}}),b.isHidden=!0},p))}init(p,b){this.chart=p,this.options=b,this.crosshairs=[],this.isHidden=!0,this.split=b.split&&!p.inverted&&!p.polar,this.shared=b.shared||this.split,this.outside=Td(b.outside,!!(p.scrollablePixelsX||p.scrollablePixelsY))}shouldStickOnContact(p){return!!(!this.followPointer&&this.options.stickOnContact&&(!p||this.pointer.inClass(p.target,"highcharts-tooltip")))}move(p,b,T,P){let{followPointer:O,options:z}=this,j=$y(!O&&!this.isHidden&&!z.fixed&&z.animation),X=O||(this.len||0)>1,re={x:p,y:b};X?re.anchorX=re.anchorY=NaN:(re.anchorX=T,re.anchorY=P),j.step=()=>this.drawTracker(),this.getLabel().animate(re,j)}refresh(p,b){let{chart:T,options:P,pointer:O,shared:z}=this,j=Ku(p),X=j[0],re=P.format,de=P.formatter||this.defaultFormatter,ne=T.styledMode,ce=this.allowShared;if(!P.enabled||!X.series)return;Ht.clearTimeout(this.hideTimer),this.allowShared=!(!mf(p)&&p.series&&p.series.noSharedTooltip),ce=ce&&!this.allowShared,this.followPointer=!this.split&&X.series.tooltipOptions.followPointer;let ye=this.getAnchor(p,b),Te=ye[0],De=ye[1];z&&this.allowShared&&(O.applyInactiveState(j),j.forEach(Ke=>Ke.setState("hover")),X.points=j),this.len=j.length;let Oe=gf(re)?km(re,X,T):de.call(X,this);X.points=void 0;let Be=X.series;if(this.distance=Td(Be.tooltipOptions.distance,16),Oe===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(Oe,j);else{let Ke=Te,st=De;if(b&&O.isDirectTouch&&(Ke=b.chartX-T.plotLeft,st=b.chartY-T.plotTop),!(T.polar||Be.options.clip===!1||j.some(Bt=>O.isDirectTouch||Bt.series.shouldShowTooltip(Ke,st))))return void this.hide();{let Bt=this.getLabel(ce&&this.tt||{});(!P.style.width||ne)&&Bt.css({width:(this.outside?this.getPlayingField():T.spacingBox).width+"px"}),Bt.attr({class:this.getClassName(X),text:Oe&&Oe.join?Oe.join(""):Oe}),this.outside&&Bt.attr({x:Am(Bt.x||0,0,this.getPlayingField().width-(Bt.width||0)-1)}),ne||Bt.attr({stroke:P.borderColor||X.color||Be.color||"#666666"}),this.updatePosition({plotX:Te,plotY:De,negative:X.negative,ttBelow:X.ttBelow,series:Be,h:ye[2]||0})}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Im(this,"refresh")}renderSplit(p,b){var Qs,Nl;let T=this,{chart:P,chart:{chartWidth:O,chartHeight:z,plotHeight:j,plotLeft:X,plotTop:re,scrollablePixelsY:de=0,scrollablePixelsX:ne,styledMode:ce},distance:ye,options:Te,options:{fixed:De,position:Oe,positioner:Be},pointer:Ke}=T,{scrollLeft:st=0,scrollTop:Bt=0}=((Qs=P.scrollablePlotArea)==null?void 0:Qs.scrollingContainer)||{},Ut=T.outside&&typeof ne!="number"?ff.documentElement.getBoundingClientRect():{left:st,right:st+O,top:Bt,bottom:Bt+z},$t=T.getLabel(),ci=this.renderer||P.renderer,oi=!!((Nl=P.xAxis[0])!=null&&Nl.opposite),{left:di,top:er}=Ke.getChartPosition(),Vi=Be||De,lr=re+Bt,Vr=0,Wn=j-de,xn=function(Uo,jo,mo,io=[0,0],vc=!0){let El,fc;if(mo.isHeader)fc=oi?0:Wn,El=Am(io[0]-Uo/2,Ut.left,Ut.right-Uo-(T.outside?di:0));else if(De&&mo){let au=T.getFixedPosition(Uo,jo,mo);El=au.x,fc=au.y-lr}else fc=io[1]-lr,El=Am(El=vc?io[0]-Uo-ye:io[0]+ye,vc?El:Ut.left,Ut.right);return{x:El,y:fc}};gf(p)&&(p=[!1,p]);let Nn=p.slice(0,b.length+1).reduce(function(Uo,jo,mo){if(jo!==!1&&jo!==""){let io=b[mo-1]||{isHeader:!0,plotX:b[0].plotX,plotY:j,series:{}},vc=io.isHeader,El=vc?T:io.series,fc=El.tt=function(pd,Hc,Q0){let u0=pd,{isHeader:J0,series:Vv}=Hc,tg=Vv.tooltipOptions||Te;if(!u0){let e_={padding:tg.padding,r:tg.borderRadius};ce||(e_.fill=tg.backgroundColor,e_["stroke-width"]=tg.borderWidth??(De&&!J0?0:1)),u0=ci.label("",0,0,tg[J0?"headerShape":"shape"]||(De&&!J0?"rect":"callout"),void 0,void 0,tg.useHTML).addClass(T.getClassName(Hc,!0,J0)).attr(e_).add($t)}return u0.isActive=!0,u0.attr({text:Q0}),ce||u0.css(tg.style).attr({stroke:tg.borderColor||Hc.color||Vv.color||"#333333"}),u0}(El.tt,io,jo.toString()),au=fc.getBBox(),Ey=au.width+fc.strokeWidth();vc&&(Vr=au.height,Wn+=Vr,oi&&(lr-=Vr));let{anchorX:gm,anchorY:dd}=function(pd){let Hc,Q0,{isHeader:u0,plotX:J0=0,plotY:Vv=0,series:tg}=pd;if(u0)Hc=Math.max(X+J0,X),Q0=re+j/2;else{let{xAxis:e_,yAxis:Jb}=tg;Hc=e_.pos+Am(J0,-ye,e_.len+ye),tg.shouldShowTooltip(0,Jb.pos-re+Vv,{ignoreX:!0})&&(Q0=Jb.pos+Vv)}return{anchorX:Hc=Am(Hc,Ut.left-ye,Ut.right+ye),anchorY:Q0}}(io);if(typeof dd=="number"){let pd=au.height+1,Hc=(Be||xn).call(T,Ey,pd,io,[gm,dd]);Uo.push({align:Vi?0:void 0,anchorX:gm,anchorY:dd,boxWidth:Ey,point:io,rank:Td(Hc.rank,+!!vc),size:pd,target:Hc.y,tt:fc,x:Hc.x})}else fc.isActive=!1}return Uo},[]);!Vi&&Nn.some(Uo=>{let{outside:jo}=T,mo=(jo?di:0)+Uo.anchorX;return mo<Ut.left&&mo+Uo.boxWidth<Ut.right||mo<di-Ut.left+Uo.boxWidth&&Ut.right-mo>mo})&&(Nn=Nn.map(Uo=>{let{x:jo,y:mo}=xn.call(this,Uo.boxWidth,Uo.size,Uo.point,[Uo.anchorX,Uo.anchorY],!1);return Mm(Uo,{target:mo,x:jo})})),T.cleanSplit(),$d(Nn,Wn);let Bn={left:di,right:di};Nn.forEach(function(Uo){let{x:jo,boxWidth:mo,isHeader:io}=Uo;!io&&(T.outside&&di+jo<Bn.left&&(Bn.left=di+jo),!io&&T.outside&&Bn.left+mo>Bn.right&&(Bn.right=di+jo))}),Nn.forEach(function(Uo){let{x:jo,anchorX:mo,anchorY:io,pos:vc,point:{isHeader:El}}=Uo,fc={visibility:vc===void 0?"hidden":"inherit",x:jo,y:(vc||0)+lr+(De&&Oe.y||0),anchorX:mo,anchorY:io};if(T.outside&&jo<mo){let au=di-Bn.left;au>0&&(El||(fc.x=jo+au,fc.anchorX=mo+au),El&&(fc.x=(Bn.right-Bn.left)/2,fc.anchorX=mo+au))}Uo.tt.attr(fc)});let{container:Xn,outside:es,renderer:ns}=T;if(es&&Xn&&ns){let{width:Uo,height:jo,x:mo,y:io}=$t.getBBox();ns.setSize(Uo+mo,jo+io,!1),Xn.style.left=Bn.left+"px",Xn.style.top=er+"px"}L0&&$t.attr({opacity:$t.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let p=this.chart,b=this.label,T=this.shared?p.hoverPoints:p.hoverPoint;if(!b||!T)return;let P={x:0,y:0,width:0,height:0},O=this.getAnchor(T),z=b.getBBox();O[0]+=p.plotLeft-(b.translateX||0),O[1]+=p.plotTop-(b.translateY||0),P.x=Math.min(0,O[0]),P.y=Math.min(0,O[1]),P.width=O[0]<0?Math.max(Math.abs(O[0]),z.width-O[0]):Math.max(Math.abs(O[0]),z.width),P.height=O[1]<0?Math.max(Math.abs(O[1]),z.height-Math.abs(O[1])):Math.max(Math.abs(O[1]),z.height),this.tracker?this.tracker.attr(P):(this.tracker=b.renderer.rect(P).addClass("highcharts-tracker").add(b),p.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(p){return p.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(p,b){let T=p.series,P=T.tooltipOptions,O=T.xAxis,z=O==null?void 0:O.dateTime,j={isFooter:b,point:p},X=P.xDateFormat||"",re=P[b?"footerFormat":"headerFormat"];return Im(this,"headerFormatter",j,function(de){if(z&&!X&&Wy(p.key)&&(X=z.getXDateFormat(p.key,P.dateTimeLabelFormats)),z&&X){if(bg(X)){let ne=X;zp[0]=ce=>T.chart.time.dateFormat(ne,ce),X="%0"}(p.tooltipDateKeys||["key"]).forEach(ne=>{re=re.replace(RegExp("point\\."+ne+"([ \\)}])"),`(point.${ne}:${X})$1`)})}T.chart.styledMode&&(re=this.styledModeFormat(re)),de.text=km(re,p,this.chart)}),j.text||""}update(p){this.destroy(),this.init(this.chart,Vd(!0,this.options,p))}updatePosition(p){var Ut;let{chart:b,container:T,distance:P,options:O,pointer:z,renderer:j}=this,{height:X=0,width:re=0}=this.getLabel(),{fixed:de,positioner:ne}=O,{left:ce,top:ye,scaleX:Te,scaleY:De}=z.getChartPosition(),Oe=(ne||de&&this.getFixedPosition||this.getPosition).call(this,re,X,p),Be=Je.doc,Ke=(p.plotX||0)+b.plotLeft,st=(p.plotY||0)+b.plotTop,Bt;if(j&&T){if(ne||de){let{scrollLeft:$t=0,scrollTop:ci=0}=((Ut=b.scrollablePlotArea)==null?void 0:Ut.scrollingContainer)||{};Oe.x+=$t+ce-P,Oe.y+=ci+ye-P}Bt=(O.borderWidth||0)+2*P+2,j.setSize(Am(re+Bt,0,Be.documentElement.clientWidth)-1,X+Bt,!1),(Te!==1||De!==1)&&(mp(T,{transform:`scale(${Te}, ${De})`}),Ke*=Te,st*=De),Ke+=ce-Oe.x,st+=ye-Oe.y}this.move(Math.round(Oe.x),Math.round(Oe.y||0),Ke,st)}}(function(ie){ie.compose=function(p){jy(iy,"Core.Tooltip")&&Vy(p,"afterInit",function(){let b=this.chart;b.options.tooltip&&(b.tooltip=new ie(b,b.options.tooltip,this))})}})(Up||(Up={}));let gp=Up,{animObject:Cu}=zr,{defaultOptions:Cd}=vi,{format:$p}=ba,{addEvent:ry,crisp:Qu,erase:gh,extend:Dm,fireEvent:Hy,getNestedProperty:yp,isArray:yf,isFunction:Xf,isNumber:jl,isObject:Eu,merge:Zf,pick:gl,syncTimeout:ny,removeEvent:Ed,uniqueKey:ku}=Ht;class _p{animateBeforeDestroy(){let p=this,b={x:p.startXPos,opacity:0},T=p.getGraphicalProps();T.singular.forEach(function(P){p[P]=p[P].animate(P==="dataLabel"?{x:p[P].startXPos,y:p[P].startYPos,opacity:0}:b)}),T.plural.forEach(function(P){p[P].forEach(function(O){O.element&&O.animate(Dm({x:p.startXPos},O.startYPos?{x:O.startXPos,y:O.startYPos}:{}))})})}applyOptions(p,b){let T=this.series,P=T.options.pointValKey||T.pointValKey;return Dm(this,p=_p.prototype.optionsToObject.call(this,p)),this.options=this.options?Dm(this.options,p):p,p.group&&delete this.group,p.dataLabels&&delete this.dataLabels,P&&(this.y=_p.prototype.getNestedProperty.call(this,P)),this.selected&&(this.state="select"),"name"in this&&b===void 0&&T.xAxis&&T.xAxis.hasNames&&(this.x=T.xAxis.nameToX(this)),this.x===void 0&&T?this.x=b??T.autoIncrement():jl(p.x)&&T.options.relativeXValue?this.x=T.autoIncrement(p.x):typeof this.x=="string"&&(b??(b=T.chart.time.parse(this.x)),jl(b)&&(this.x=b)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let p=this,b=p.series,T=b.chart,P=b.options.dataSorting,O=T.hoverPoints,z=Cu(p.series.chart.renderer.globalAnimation),j=()=>{for(let X in(p.graphic||p.graphics||p.dataLabel||p.dataLabels)&&(Ed(p),p.destroyElements()),p)delete p[X]};p.legendItem&&T.legend.destroyItem(p),O&&(p.setState(),gh(O,p),O.length||(T.hoverPoints=null)),p===T.hoverPoint&&p.onMouseOut(),P!=null&&P.enabled?(this.animateBeforeDestroy(),ny(j,z.duration)):j(),T.pointCount--}this.destroyed=!0}destroyElements(p){let b=this,T=b.getGraphicalProps(p);T.singular.forEach(function(P){b[P]=b[P].destroy()}),T.plural.forEach(function(P){b[P].forEach(function(O){O!=null&&O.element&&O.destroy()}),delete b[P]})}firePointEvent(p,b,T){let P=this,O=this.series.options;P.manageEvent(p),p==="click"&&O.allowPointSelect&&(T=function(z){!P.destroyed&&P.select&&P.select(null,z.ctrlKey||z.metaKey||z.shiftKey)}),Hy(P,p,b,T)}getClassName(){var p;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((p=this.zone)!=null&&p.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(p){let b,T,P=this,O=[],z={singular:[],plural:[]};for((p=p||{graphic:1,dataLabel:1}).graphic&&O.push("graphic","connector"),p.dataLabel&&O.push("dataLabel","dataLabelPath","dataLabelUpper"),T=O.length;T--;)P[b=O[T]]&&z.singular.push(b);return["graphic","dataLabel"].forEach(function(j){let X=j+"s";p[j]&&P[X]&&z.plural.push(X)}),z}getNestedProperty(p){if(p)return p.indexOf("custom.")===0?yp(p,this.options):this[p]}getZone(){let p=this.series,b=p.zones,T=p.zoneAxis||"y",P,O=0;for(P=b[0];this[T]>=P.value;)P=b[++O];return this.nonZonedColor||(this.nonZonedColor=this.color),P!=null&&P.color&&!this.options.color?this.color=P.color:this.color=this.nonZonedColor,P}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(p,b,T){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=p,this.applyOptions(b,T),this.id??(this.id=ku()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=p.options.nullInteraction),p.chart.pointCount++,Hy(this,"afterInit")}isValid(){return(jl(this.x)||this.x instanceof Date)&&jl(this.y)}optionsToObject(p){var de;let b=this.series,T=b.options.keys,P=T||b.pointArrayMap||["y"],O=P.length,z={},j,X=0,re=0;if(jl(p)||p===null)z[P[0]]=p;else if(yf(p))for(!T&&p.length>O&&((j=typeof p[0])=="string"?(de=b.xAxis)!=null&&de.dateTime?z.x=b.chart.time.parse(p[0]):z.name=p[0]:j==="number"&&(z.x=p[0]),X++);re<O;)T&&p[X]===void 0||(P[re].indexOf(".")>0?_p.prototype.setNestedProperty(z,p[X],P[re]):z[P[re]]=p[X]),X++,re++;else typeof p=="object"&&(z=p,p.dataLabels&&(b.hasDataLabels=()=>!0),p.marker&&(b._hasPointMarkers=!0));return z}pos(p,b=this.plotY){if(!this.destroyed){let{plotX:T,series:P}=this,{chart:O,xAxis:z,yAxis:j}=P,X=0,re=0;if(jl(T)&&jl(b))return p&&(X=z?z.pos:O.plotLeft,re=j?j.pos:O.plotTop),O.inverted&&z&&j?[j.len-b+re,z.len-T+X]:[T+X,b+re]}}resolveColor(){let p=this.series,b=p.chart.options.chart,T=p.chart.styledMode,P,O,z=b.colorCount,j;delete this.nonZonedColor,p.options.colorByPoint?(T||(P=(O=p.options.colors||p.chart.options.colors)[p.colorCounter],z=O.length),j=p.colorCounter,p.colorCounter++,p.colorCounter===z&&(p.colorCounter=0)):(T||(P=p.color),j=p.colorIndex),this.colorIndex=gl(this.options.colorIndex,j),this.color=gl(this.options.color,P)}setNestedProperty(p,b,T){return T.split(".").reduce(function(P,O,z,j){let X=j.length-1===z;return P[O]=X?b:Eu(P[O],!0)?P[O]:{},P[O]},p),p}shouldDraw(){return!this.isNull}tooltipFormatter(p){var X;let{chart:b,pointArrayMap:T=["y"],tooltipOptions:P}=this.series,{valueDecimals:O="",valuePrefix:z="",valueSuffix:j=""}=P;return b.styledMode&&(p=((X=b.tooltip)==null?void 0:X.styledModeFormat(p))||p),T.forEach(re=>{re="{point."+re,(z||j)&&(p=p.replace(RegExp(re+"}","g"),z+re+"}"+j)),p=p.replace(RegExp(re+"}","g"),re+":,."+O+"f}")}),$p(p,this,b)}update(p,b,T,P){let O,z=this,j=z.series,X=z.graphic,re=j.chart,de=j.options;function ne(){z.applyOptions(p);let ce=X&&z.hasMockGraphic,ye=z.y===null?!ce:ce;X&&ye&&(z.graphic=X.destroy(),delete z.hasMockGraphic),Eu(p,!0)&&(X!=null&&X.element&&p&&p.marker&&p.marker.symbol!==void 0&&(z.graphic=X.destroy()),p!=null&&p.dataLabels&&z.dataLabel&&(z.dataLabel=z.dataLabel.destroy())),O=z.index;let Te={};for(let De of j.dataColumnKeys())Te[De]=z[De];j.dataTable.setRow(Te,O),de.data[O]=Eu(de.data[O],!0)||Eu(p,!0)?z.options:gl(p,de.data[O]),j.isDirty=j.isDirtyData=!0,!j.fixedBox&&j.hasCartesianSeries&&(re.isDirtyBox=!0),de.legendType==="point"&&(re.isDirtyLegend=!0),b&&re.redraw(T)}b=gl(b,!0),P===!1?ne():z.firePointEvent("update",{options:p},ne)}remove(p,b){this.series.removePoint(this.series.data.indexOf(this),p,b)}select(p,b){let T=this,P=T.series,O=P.chart;p=gl(p,!T.selected),this.selectedStaging=p,T.firePointEvent(p?"select":"unselect",{accumulate:b},function(){T.selected=T.options.selected=p,P.options.data[P.data.indexOf(T)]=T.options,T.setState(p&&"select"),b||O.getSelectedPoints().forEach(function(z){let j=z.series;z.selected&&z!==T&&(z.selected=z.options.selected=!1,j.options.data[j.data.indexOf(z)]=z.options,z.setState(O.hoverPoints&&j.options.inactiveOtherPoints?"inactive":""),z.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(p){let{inverted:b,pointer:T}=this.series.chart;T&&(p=p?T.normalize(p):T.getChartCoordinatesFromPoint(this,b),T.runPointActions(p,this))}onMouseOut(){let p=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(p.hoverPoints||[]).forEach(function(b){b.setState()}),p.hoverPoints=p.hoverPoint=null}manageEvent(p){var P,O,z,j,X,re,de;let b=Zf(this.series.options.point,this.options),T=(P=b.events)==null?void 0:P[p];Xf(T)&&(!((O=this.hcEvents)!=null&&O[p])||((j=(z=this.hcEvents)==null?void 0:z[p])==null?void 0:j.map(ne=>ne.fn).indexOf(T))===-1)?((X=this.importedUserEvent)==null||X.call(this),this.importedUserEvent=ry(this,p,T),this.hcEvents&&(this.hcEvents[p].userEvent=!0)):this.importedUserEvent&&!T&&((re=this.hcEvents)!=null&&re[p])&&((de=this.hcEvents)!=null&&de[p].userEvent)&&(Ed(this,p),delete this.hcEvents[p],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(p,b){var $t,ci;let T=this.series,P=this.state,O=T.options.states[p||"normal"]||{},z=Cd.plotOptions[T.type].marker&&T.options.marker,j=z&&z.enabled===!1,X=(($t=z==null?void 0:z.states)==null?void 0:$t[p||"normal"])||{},re=X.enabled===!1,de=this.marker||{},ne=T.chart,ce=z&&T.markerAttribs,ye=T.halo,Te,De,Oe,Be=T.stateMarkerGraphic,Ke;if((p=p||"")===this.state&&!b||this.selected&&p!=="select"||O.enabled===!1||p&&(re||j&&X.enabled===!1)||p&&de.states&&de.states[p]&&de.states[p].enabled===!1)return;if(this.state=p,ce&&(Te=T.markerAttribs(this,p)),this.graphic&&!this.hasMockGraphic){if(P&&this.graphic.removeClass("highcharts-point-"+P),p&&this.graphic.addClass("highcharts-point-"+p),!ne.styledMode){De=T.pointAttribs(this,p),Oe=gl(ne.options.chart.animation,O.animation);let oi=De.opacity;T.options.inactiveOtherPoints&&jl(oi)&&(this.dataLabels||[]).forEach(function(di){di&&!di.hasClass("highcharts-data-label-hidden")&&(di.animate({opacity:oi},Oe),di.connector&&di.connector.animate({opacity:oi},Oe))}),this.graphic.animate(De,Oe)}Te&&this.graphic.animate(Te,gl(ne.options.chart.animation,X.animation,z.animation)),Be&&Be.hide()}else p&&X&&(Ke=de.symbol||T.symbol,Be&&Be.currentSymbol!==Ke&&(Be=Be.destroy()),Te&&(Be?Be[b?"animate":"attr"]({x:Te.x,y:Te.y}):Ke&&(T.stateMarkerGraphic=Be=ne.renderer.symbol(Ke,Te.x,Te.y,Te.width,Te.height,Zf(z,X)).add(T.markerGroup),Be.currentSymbol=Ke)),!ne.styledMode&&Be&&this.state!=="inactive"&&Be.attr(T.pointAttribs(this,p))),Be&&(Be[p&&this.isInside?"show":"hide"](),Be.element.point=this,Be.addClass(this.getClassName(),!0));let st=O.halo,Bt=this.graphic||Be,Ut=(Bt==null?void 0:Bt.visibility)||"inherit";st!=null&&st.size&&Bt&&Ut!=="hidden"&&!this.isCluster?(ye||(T.halo=ye=ne.renderer.path().add(Bt.parentGroup)),ye.show()[b?"animate":"attr"]({d:this.haloPath(st.size)}),ye.attr({class:"highcharts-halo highcharts-color-"+gl(this.colorIndex,T.colorIndex)+(this.className?" "+this.className:""),visibility:Ut,zIndex:-1}),ye.point=this,ne.styledMode||ye.attr(Dm({fill:this.color||T.color,"fill-opacity":st.opacity},la.filterUserAttributes(st.attributes||{})))):(ci=ye==null?void 0:ye.point)!=null&&ci.haloPath&&!ye.point.destroyed&&ye.animate({d:ye.point.haloPath(0)},null,ye.hide),Hy(this,"afterSetState",{state:p})}haloPath(p){let b=this.pos();return b?this.series.chart.renderer.symbols.circle(Qu(b[0],1)-p,b[1]-p,2*p,2*p):[]}}let yl=_p,{parse:_f}=ai,{charts:Au,composed:Vp,isTouchDevice:mn}=Je,{addEvent:Ec,attr:D0,css:mu,extend:Hl,find:$n,fireEvent:kd,isNumber:Wp,isObject:Pm,objectEach:Kf,offset:vf,pick:Mu,pushUnique:P0,splat:O0}=Ht;class dh{applyInactiveState(p=[]){let b=[];p.forEach(T=>{let P=T.series;b.push(P),P.linkedParent&&b.push(P.linkedParent),P.linkedSeries&&b.push.apply(b,P.linkedSeries),P.navigatorSeries&&b.push(P.navigatorSeries),P.boosted&&P.markerGroup&&b.push.apply(b,this.chart.series.filter(O=>O.markerGroup===P.markerGroup))}),this.chart.series.forEach(T=>{b.indexOf(T)===-1?T.setState("inactive",!0):T.options.inactiveOtherPoints&&T.setAllPointsToState("inactive")})}destroy(){let p=this;this.eventsToUnbind.forEach(b=>b()),this.eventsToUnbind=[],!Je.chartCount&&(dh.unbindDocumentMouseUp.forEach(b=>b.unbind()),dh.unbindDocumentMouseUp.length=0,dh.unbindDocumentTouchEnd&&(dh.unbindDocumentTouchEnd=dh.unbindDocumentTouchEnd())),clearInterval(p.tooltipTimeout),Kf(p,function(b,T){p[T]=void 0})}getSelectionMarkerAttrs(p,b){let T={args:{chartX:p,chartY:b},attrs:{},shapeType:"rect"};return kd(this,"getSelectionMarkerAttrs",T,P=>{let O,{chart:z,zoomHor:j,zoomVert:X}=this,{mouseDownX:re=0,mouseDownY:de=0}=z,ne=P.attrs;ne.x=z.plotLeft,ne.y=z.plotTop,ne.width=j?1:z.plotWidth,ne.height=X?1:z.plotHeight,j&&(ne.width=Math.max(1,Math.abs(O=p-re)),ne.x=(O>0?0:O)+re),X&&(ne.height=Math.max(1,Math.abs(O=b-de)),ne.y=(O>0?0:O)+de)}),T}drag(p){let{chart:b}=this,{mouseDownX:T=0,mouseDownY:P=0}=b,{panning:O,panKey:z,selectionMarkerFill:j}=b.options.chart,X=b.plotLeft,re=b.plotTop,de=b.plotWidth,ne=b.plotHeight,ce=Pm(O)?O.enabled:O,ye=z&&p[`${z}Key`],Te=p.chartX,De=p.chartY,Oe,Be=this.selectionMarker;if((!Be||!Be.touch)&&(Te<X?Te=X:Te>X+de&&(Te=X+de),De<re?De=re:De>re+ne&&(De=re+ne),this.hasDragged=Math.sqrt(Math.pow(T-Te,2)+Math.pow(P-De,2)),this.hasDragged>10)){Oe=b.isInsidePlot(T-X,P-re,{visiblePlotOnly:!0});let{shapeType:Ke,attrs:st}=this.getSelectionMarkerAttrs(Te,De);this.hasZoom&&Oe&&!ye&&!Be&&(this.selectionMarker=Be=b.renderer[Ke](),Be.attr({class:"highcharts-selection-marker",zIndex:7}).add(),b.styledMode||Be.attr({fill:j||_f("#334eff").setOpacity(.25).get()})),Be&&Be.attr(st),Oe&&!Be&&ce&&b.pan(p,O)}}dragStart(p){let b=this.chart;b.mouseIsDown=p.type,b.cancelClick=!1,b.mouseDownX=p.chartX,b.mouseDownY=p.chartY}getSelectionBox(p){let b={args:{marker:p},result:p.getBBox()};return kd(this,"getSelectionBox",b),b.result}drop(p){let b,{chart:T,selectionMarker:P}=this;for(let O of T.axes)O.isPanning&&(O.isPanning=!1,(O.options.startOnTick||O.options.endOnTick||O.series.some(z=>z.boosted))&&(O.forceRedraw=!0,O.setExtremes(O.userMin,O.userMax,!1),b=!0));if(b&&T.redraw(),P&&p){if(this.hasDragged){let O=this.getSelectionBox(P);T.transform({axes:T.axes.filter(z=>z.zoomEnabled&&(z.coll==="xAxis"&&this.zoomX||z.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:p,xAxis:[],yAxis:[],...O},from:O})}Wp(T.index)&&(this.selectionMarker=P.destroy())}T&&Wp(T.index)&&(mu(T.container,{cursor:T._cursor}),T.cancelClick=this.hasDragged>10,T.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(p,b,T){let P;return p.forEach(function(O){let z=!(O.noSharedTooltip&&b)&&0>O.options.findNearestPointBy.indexOf("y"),j=O.searchPoint(T,z);Pm(j,!0)&&j.series&&(!Pm(P,!0)||function(X,re){var ye,Te;let de=X.distX-re.distX,ne=X.dist-re.dist,ce=((ye=re.series.group)==null?void 0:ye.zIndex)-((Te=X.series.group)==null?void 0:Te.zIndex);return de!==0&&b?de:ne!==0?ne:ce!==0?ce:X.series.index>re.series.index?-1:1}(P,j)>0)&&(P=j)}),P}getChartCoordinatesFromPoint(p,b){let{xAxis:T,yAxis:P}=p.series,O=p.shapeArgs;if(T&&P){let z=p.clientX??p.plotX??0,j=p.plotY||0;return p.isNode&&O&&Wp(O.x)&&Wp(O.y)&&(z=O.x,j=O.y),b?{chartX:P.len+P.pos-j,chartY:T.len+T.pos-z}:{chartX:z+T.pos,chartY:j+P.pos}}if(O!=null&&O.x&&O.y)return{chartX:O.x,chartY:O.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:p}=this.chart,b=vf(p);this.chartPosition={left:b.left,top:b.top,scaleX:1,scaleY:1};let{offsetHeight:T,offsetWidth:P}=p;return P>2&&T>2&&(this.chartPosition.scaleX=b.width/P,this.chartPosition.scaleY=b.height/T),this.chartPosition}getCoordinates(p){let b={xAxis:[],yAxis:[]};for(let T of this.chart.axes)b[T.isXAxis?"xAxis":"yAxis"].push({axis:T,value:T.toValue(p[T.horiz?"chartX":"chartY"])});return b}getHoverData(p,b,T,P,O,z){let j=[],X=function(ye){return ye.visible&&!(!O&&ye.directTouch)&&Mu(ye.options.enableMouseTracking,!0)},re=b,de,ne={chartX:z?z.chartX:void 0,chartY:z?z.chartY:void 0,shared:O};kd(this,"beforeGetHoverData",ne),de=re&&!re.stickyTracking?[re]:T.filter(ye=>ye.stickyTracking&&(ne.filter||X)(ye));let ce=P&&p||!z?p:this.findNearestKDPoint(de,O,z);return re=ce==null?void 0:ce.series,ce&&(O&&!re.noSharedTooltip?(de=T.filter(function(ye){return ne.filter?ne.filter(ye):X(ye)&&!ye.noSharedTooltip})).forEach(function(ye){var Oe;let Te=(Oe=ye.options)==null?void 0:Oe.nullInteraction,De=$n(ye.points,function(Be){return Be.x===ce.x&&(!Be.isNull||!!Te)});Pm(De)&&(ye.boosted&&ye.boost&&(De=ye.boost.getPoint(De)),j.push(De))}):j.push(ce)),kd(this,"afterGetHoverData",ne={hoverPoint:ce}),{hoverPoint:ne.hoverPoint,hoverSeries:re,hoverPoints:j}}getPointFromEvent(p){let b=p.target,T;for(;b&&!T;)T=b.point,b=b.parentNode;return T}onTrackerMouseOut(p){let b=this.chart,T=p.relatedTarget,P=b.hoverSeries;this.isDirectTouch=!1,!P||!T||P.stickyTracking||this.inClass(T,"highcharts-tooltip")||this.inClass(T,"highcharts-series-"+P.index)&&this.inClass(T,"highcharts-tracker")||P.onMouseOut()}inClass(p,b){let T=p,P;for(;T;){if(P=D0(T,"class")){if(P.indexOf(b)!==-1)return!0;if(P.indexOf("highcharts-container")!==-1)return!1}T=T.parentElement}}constructor(p,b){var T;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=b,this.chart=p,this.runChartClick=!!((T=b.chart.events)!=null&&T.click),this.pinchDown=[],this.setDOMEvents(),kd(this,"afterInit")}normalize(p,b){let T=p.touches,P=T?T.length?T.item(0):Mu(T.changedTouches,p.changedTouches)[0]:p;b||(b=this.getChartPosition());let O=P.pageX-b.left,z=P.pageY-b.top;return Hl(p,{chartX:Math.round(O/=b.scaleX),chartY:Math.round(z/=b.scaleY)})}onContainerClick(p){let b=this.chart,T=b.hoverPoint,P=this.normalize(p),O=b.plotLeft,z=b.plotTop;!b.cancelClick&&(T&&this.inClass(P.target,"highcharts-tracker")?(kd(T.series,"click",Hl(P,{point:T})),b.hoverPoint&&T.firePointEvent("click",P)):(Hl(P,this.getCoordinates(P)),b.isInsidePlot(P.chartX-O,P.chartY-z,{visiblePlotOnly:!0})&&kd(b,"click",P)))}onContainerMouseDown(p){var T;let b=(1&(p.buttons||p.button))==1;p=this.normalize(p),Je.isFirefox&&p.button!==0&&this.onContainerMouseMove(p),(p.button===void 0||b)&&(this.zoomOption(p),b&&((T=p.preventDefault)==null||T.call(p)),this.dragStart(p))}onContainerMouseLeave(p){let{pointer:b}=Au[Mu(dh.hoverChartIndex,-1)]||{};p=this.normalize(p),this.onContainerMouseMove(p),b&&!this.inClass(p.relatedTarget,"highcharts-tooltip")&&(b.reset(),b.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(p){var O;let b=this.chart,T=b.tooltip,P=this.normalize(p);this.setHoverChartIndex(p),(b.mouseIsDown==="mousedown"||this.touchSelect(P))&&this.drag(P),!((O=b.exporting)!=null&&O.openMenu)&&(this.inClass(P.target,"highcharts-tracker")||b.isInsidePlot(P.chartX-b.plotLeft,P.chartY-b.plotTop,{visiblePlotOnly:!0}))&&!(T!=null&&T.shouldStickOnContact(P))&&(this.inClass(P.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(P))}onDocumentTouchEnd(p){this.onDocumentMouseUp(p)}onContainerTouchMove(p){this.touchSelect(p)?this.onContainerMouseMove(p):this.touch(p)}onContainerTouchStart(p){this.touchSelect(p)?this.onContainerMouseDown(p):(this.zoomOption(p),this.touch(p,!0))}onDocumentMouseMove(p){let b=this.chart,T=b.tooltip,P=this.chartPosition,O=this.normalize(p,P);!P||b.isInsidePlot(O.chartX-b.plotLeft,O.chartY-b.plotTop,{visiblePlotOnly:!0})||T!=null&&T.shouldStickOnContact(O)||O.target!==b.container.ownerDocument&&this.inClass(O.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(p){var b,T;(T=(b=Au[Mu(dh.hoverChartIndex,-1)])==null?void 0:b.pointer)==null||T.drop(p)}pinch(p){let b=this,{chart:T,hasZoom:P,lastTouches:O}=b,z=[].map.call(p.touches||[],ne=>b.normalize(ne)),j=z.length,X=j===1&&(b.inClass(p.target,"highcharts-tracker")&&T.runTrackerClick||b.runChartClick),re=T.tooltip,de=j===1&&Mu(re==null?void 0:re.options.followTouchMove,!0);j>1?b.initiated=!0:de&&(b.initiated=!1),P&&b.initiated&&!X&&p.cancelable!==!1&&p.preventDefault(),p.type==="touchstart"?(b.pinchDown=z,b.res=!0,T.mouseDownX=p.chartX):de?this.runPointActions(b.normalize(p)):O&&(kd(T,"touchpan",{originalEvent:p,touches:z},()=>{let ne=ce=>{let ye=ce[0],Te=ce[1]||ye;return{x:ye.chartX,y:ye.chartY,width:Te.chartX-ye.chartX,height:Te.chartY-ye.chartY}};T.transform({axes:T.axes.filter(ce=>ce.zoomEnabled&&(this.zoomHor&&ce.horiz||this.zoomVert&&!ce.horiz)),to:ne(z),from:ne(O),trigger:p.type})}),b.res&&(b.res=!1,this.reset(!1,0))),b.lastTouches=z}reset(p,b){let T=this.chart,P=T.hoverSeries,O=T.hoverPoint,z=T.hoverPoints,j=T.tooltip,X=j!=null&&j.shared?z:O;p&&X&&O0(X).forEach(function(re){re.series.isCartesian&&re.plotX===void 0&&(p=!1)}),p?j&&X&&O0(X).length&&(j.refresh(X),j.shared&&z?z.forEach(function(re){re.setState(re.state,!0),re.series.isCartesian&&(re.series.xAxis.crosshair&&re.series.xAxis.drawCrosshair(null,re),re.series.yAxis.crosshair&&re.series.yAxis.drawCrosshair(null,re))}):O&&(O.setState(O.state,!0),T.axes.forEach(function(re){re.crosshair&&O.series[re.coll]===re&&re.drawCrosshair(null,O)}))):(O&&O.onMouseOut(),z&&z.forEach(function(re){re.setState()}),P&&P.onMouseOut(),j&&j.hide(b),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),T.axes.forEach(function(re){re.hideCrosshair()}),T.hoverPoints=T.hoverPoint=void 0)}runPointActions(p,b,T){var De;let P=this.chart,O=P.series,z=(De=P.tooltip)!=null&&De.options.enabled?P.tooltip:void 0,j=!!z&&z.shared,X=b||P.hoverPoint,re=(X==null?void 0:X.series)||P.hoverSeries,de=(!p||p.type!=="touchmove")&&(!!b||(re==null?void 0:re.directTouch)&&this.isDirectTouch),ne=this.getHoverData(X,re,O,de,j,p);X=ne.hoverPoint,re=ne.hoverSeries;let ce=ne.hoverPoints,ye=(re==null?void 0:re.tooltipOptions.followPointer)&&!re.tooltipOptions.split,Te=j&&re&&!re.noSharedTooltip;if(X&&(T||X!==P.hoverPoint||z!=null&&z.isHidden)){if((P.hoverPoints||[]).forEach(function(Oe){ce.indexOf(Oe)===-1&&Oe.setState()}),P.hoverSeries!==re&&re.onMouseOver(),this.applyInactiveState(ce),(ce||[]).forEach(function(Oe){Oe.setState("hover")}),P.hoverPoint&&P.hoverPoint.firePointEvent("mouseOut"),!X.series)return;P.hoverPoints=ce,P.hoverPoint=X,X.firePointEvent("mouseOver",void 0,()=>{z&&X&&z.refresh(Te?ce:X,p)})}else if(ye&&z&&!z.isHidden){let Oe=z.getAnchor([{}],p);P.isInsidePlot(Oe[0],Oe[1],{visiblePlotOnly:!0})&&z.updatePosition({plotX:Oe[0],plotY:Oe[1]})}this.unDocMouseMove||(this.unDocMouseMove=Ec(P.container.ownerDocument,"mousemove",Oe=>{var Be,Ke;return(Ke=(Be=Au[dh.hoverChartIndex??-1])==null?void 0:Be.pointer)==null?void 0:Ke.onDocumentMouseMove(Oe)}),this.eventsToUnbind.push(this.unDocMouseMove)),P.axes.forEach(function(Oe){var st;let Be,Ke=((st=Oe.crosshair)==null?void 0:st.snap)??!0;Ke&&((Be=P.hoverPoint)&&Be.series[Oe.coll]===Oe||(Be=$n(ce,Bt=>{var Ut;return((Ut=Bt.series)==null?void 0:Ut[Oe.coll])===Oe}))),Be||!Ke?Oe.drawCrosshair(p,Be):Oe.hideCrosshair()})}setDOMEvents(){let p=this.chart.container,b=p.ownerDocument;p.onmousedown=this.onContainerMouseDown.bind(this),p.onmousemove=this.onContainerMouseMove.bind(this),p.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(Ec(p,"mouseenter",this.onContainerMouseEnter.bind(this)),Ec(p,"mouseleave",this.onContainerMouseLeave.bind(this))),dh.unbindDocumentMouseUp.some(P=>P.doc===b)||dh.unbindDocumentMouseUp.push({doc:b,unbind:Ec(b,"mouseup",this.onDocumentMouseUp.bind(this))});let T=this.chart.renderTo.parentElement;for(;T&&T.tagName!=="BODY";)this.eventsToUnbind.push(Ec(T,"scroll",()=>{delete this.chartPosition})),T=T.parentElement;this.eventsToUnbind.push(Ec(p,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),Ec(p,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),dh.unbindDocumentTouchEnd||(dh.unbindDocumentTouchEnd=Ec(b,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),Ec(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var O,z;if(!mn)return;let p=this.pointerCaptureEventsToUnbind,b=this.chart,T=b.container,P=Mu((O=b.options.tooltip)==null?void 0:O.followTouchMove,!0)&&b.series.some(j=>j.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&P?(p.push(Ec(T,"pointerdown",j=>{var X,re;(X=j.target)!=null&&X.hasPointerCapture(j.pointerId)&&((re=j.target)==null||re.releasePointerCapture(j.pointerId))}),Ec(T,"pointermove",j=>{var X,re;(re=(X=b.pointer)==null?void 0:X.getPointFromEvent(j))==null||re.onMouseOver(j)})),b.styledMode||mu(T,{"touch-action":"none"}),T.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!P&&(p.forEach(j=>j()),p.length=0,b.styledMode||mu(T,{"touch-action":Mu((z=b.options.chart.style)==null?void 0:z["touch-action"],"manipulation")}),T.className=T.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(p){var P;let b=this.chart,T=Je.charts[Mu(dh.hoverChartIndex,-1)];if(T&&T!==b){let O={relatedTarget:b.container};p&&!(p!=null&&p.relatedTarget)&&Object.assign({},p,O),(P=T.pointer)==null||P.onContainerMouseLeave(p||O)}T!=null&&T.mouseIsDown||(dh.hoverChartIndex=b.index)}touch(p,b){var z;let T,{chart:P,pinchDown:O=[]}=this;this.setHoverChartIndex(),(p=this.normalize(p)).touches.length===1?P.isInsidePlot(p.chartX-P.plotLeft,p.chartY-P.plotTop,{visiblePlotOnly:!0})&&!((z=P.exporting)!=null&&z.openMenu)?(b&&this.runPointActions(p),p.type==="touchmove"&&(T=!!O[0]&&Math.pow(O[0].chartX-p.chartX,2)+Math.pow(O[0].chartY-p.chartY,2)>=16),Mu(T,!0)&&this.pinch(p)):b&&this.reset():p.touches.length===2&&this.pinch(p)}touchSelect(p){return!!(this.chart.zooming.singleTouch&&p.touches&&p.touches.length===1)}zoomOption(p){let b=this.chart,T=b.inverted,P=b.zooming.type||"",O,z;/touch/.test(p.type)&&(P=Mu(b.zooming.pinchType,P)),this.zoomX=O=/x/.test(P),this.zoomY=z=/y/.test(P),this.zoomHor=O&&!T||z&&T,this.zoomVert=z&&!T||O&&T,this.hasZoom=O||z}}dh.unbindDocumentMouseUp=[],function(ie){ie.compose=function(p){P0(Vp,"Core.Pointer")&&Ec(p,"beforeRender",function(){this.pointer=new ie(this,this.options)})}}(dh||(dh={}));let Uh=dh;(function(ie){ie.setLength=function(p,b,T){return Array.isArray(p)?(p.length=b,p):p[T?"subarray":"slice"](0,b)},ie.splice=function(p,b,T,P,O=[]){if(Array.isArray(p))return Array.isArray(O)||(O=Array.from(O)),{removed:p.splice(b,T,...O),array:p};let z=Object.getPrototypeOf(p).constructor,j=p[P?"subarray":"slice"](b,b+T),X=new z(p.length-T+O.length);return X.set(p.subarray(0,b),0),X.set(O,b),X.set(p.subarray(b+T),b+O.length),{removed:j,array:X}}})(he||(he={}));let{setLength:Om,splice:$h}=he,{fireEvent:Ju,objectEach:Ad,uniqueKey:Cl}=Ht,Wd=class{constructor(ie={}){this.autoId=!ie.id,this.columns={},this.id=ie.id||Cl(),this.modified=this,this.rowCount=0,this.versionTag=Cl();let p=0;Ad(ie.columns||{},(b,T)=>{this.columns[T]=b.slice(),p=Math.max(p,b.length)}),this.applyRowCount(p)}applyRowCount(ie){this.rowCount=ie,Ad(this.columns,(p,b)=>{p.length!==ie&&(this.columns[b]=Om(p,ie))})}deleteRows(ie,p=1){if(p>0&&ie<this.rowCount){let b=0;Ad(this.columns,(T,P)=>{this.columns[P]=$h(T,ie,p).array,b=T.length}),this.rowCount=b}Ju(this,"afterDeleteRows",{rowIndex:ie,rowCount:p}),this.versionTag=Cl()}getColumn(ie,p){return this.columns[ie]}getColumns(ie,p){return(ie||Object.keys(this.columns)).reduce((b,T)=>(b[T]=this.columns[T],b),{})}getRow(ie,p){return(p||Object.keys(this.columns)).map(b=>{var T;return(T=this.columns[b])==null?void 0:T[ie]})}setColumn(ie,p=[],b=0,T){this.setColumns({[ie]:p},b,T)}setColumns(ie,p,b){let T=this.rowCount;Ad(ie,(P,O)=>{this.columns[O]=P.slice(),T=P.length}),this.applyRowCount(T),b!=null&&b.silent||(Ju(this,"afterSetColumns"),this.versionTag=Cl())}setRow(ie,p=this.rowCount,b,T){let{columns:P}=this,O=b?this.rowCount+1:p+1;Ad(ie,(z,j)=>{let X=P[j]||(T==null?void 0:T.addColumns)!==!1&&Array(O);X&&(b?X=$h(X,p,0,!0,[z]).array:X[p]=z,P[j]=X)}),O>this.rowCount&&this.applyRowCount(O),T!=null&&T.silent||(Ju(this,"afterSetRows"),this.versionTag=Cl())}},{extend:jp,merge:wg,pick:jd}=Ht;(function(ie){function p(b,T,P){var Bt,Ut;let O=this.legendItem=this.legendItem||{},{chart:z,options:j}=this,{baseline:X=0,symbolWidth:re,symbolHeight:de}=b,ne=this.symbol||"circle",ce=de/2,ye=z.renderer,Te=O.group,De=X-Math.round((((Bt=b.fontMetrics)==null?void 0:Bt.b)||de)*(P?.4:.3)),Oe={},Be,Ke=j.marker,st=0;if(z.styledMode||(Oe["stroke-width"]=Math.min(j.lineWidth||0,24),j.dashStyle?Oe.dashstyle=j.dashStyle:j.linecap!=="square"&&(Oe["stroke-linecap"]="round")),O.line=ye.path().addClass("highcharts-graph").attr(Oe).add(Te),P&&(O.area=ye.path().addClass("highcharts-area").add(Te)),Oe["stroke-linecap"]&&(st=Math.min(O.line.strokeWidth(),re)/2),re){let $t=[["M",st,De],["L",re-st,De]];O.line.attr({d:$t}),(Ut=O.area)==null||Ut.attr({d:[...$t,["L",re-st,X],["L",st,X]]})}if(Ke&&Ke.enabled!==!1&&re){let $t=Math.min(jd(Ke.radius,ce),ce);ne.indexOf("url")===0&&(Ke=wg(Ke,{width:de,height:de}),$t=0),O.symbol=Be=ye.symbol(ne,re/2-$t,De-$t,2*$t,2*$t,jp({context:"legend"},Ke)).addClass("highcharts-point").add(Te),Be.isMarker=!0}}ie.areaMarker=function(b,T){p.call(this,b,T,!0)},ie.lineMarker=p,ie.rectangle=function(b,T){let P=T.legendItem||{},O=b.options,z=b.symbolHeight,j=O.squareSymbol,X=j?z:b.symbolWidth;P.symbol=this.chart.renderer.rect(j?(b.symbolWidth-z)/2:0,b.baseline-z+1,X,z,jd(b.options.symbolRadius,z/2)).addClass("highcharts-point").attr({zIndex:3}).add(P.group)}})(fe||(fe={}));let sa=fe,{defaultOptions:Rm}=vi,{extend:Iu,extendClass:R0,merge:Nm}=Ht;(function(ie){function p(b,T){let P=Rm.plotOptions||{},O=T.defaultOptions,z=T.prototype;return z.type=b,z.pointClass||(z.pointClass=yl),!ie.seriesTypes[b]&&(O&&(P[b]=O),ie.seriesTypes[b]=T,!0)}ie.seriesTypes=Je.seriesTypes,ie.registerSeriesType=p,ie.seriesType=function(b,T,P,O,z){let j=Rm.plotOptions||{};if(T=T||"",j[b]=Nm(j[T],P),delete ie.seriesTypes[b],p(b,R0(ie.seriesTypes[T]||function(){},O)),ie.seriesTypes[b].prototype.type=b,z){class X extends yl{}Iu(X.prototype,z),ie.seriesTypes[b].prototype.pointClass=X}return ie.seriesTypes[b]}})(le||(le={}));let Ia=le,{animObject:Sg,setAnimation:Qf}=zr,{defaultOptions:Md}=vi,{registerEventOptions:Wi}=Vo,{svg:cn,win:Jf}=Je,{seriesTypes:ha}=Ia,{format:wi}=ba,{arrayMax:kh,arrayMin:Tg,clamp:La,correctFloat:sy,crisp:Bm,defined:kc,destroyObjectProperties:xf,diffObjects:ph,erase:Lu,error:Jh,extend:ed,find:nc,fireEvent:Gl,getClosestDistance:oy,getNestedProperty:Vh,insertItem:yh,isArray:vp,isNumber:Rc,isString:eu,merge:th,objectEach:Hd,pick:ql,removeEvent:Va,syncTimeout:lo}=Ht;class td{constructor(){this.zoneAxis="y"}init(p,b){var X,re,de;let T;Gl(this,"init",{options:b}),this.dataTable??(this.dataTable=new Wd);let P=p.series;this.eventsToUnbind=[],this.chart=p,this.options=this.setOptions(b);let O=this.options,z=O.visible!==!1;this.linkedSeries=[],this.bindAxes(),ed(this,{name:O.name,state:"",visible:z,selected:O.selected===!0}),Wi(this,O);let j=O.events;(j!=null&&j.click||(re=(X=O.point)==null?void 0:X.events)!=null&&re.click||O.allowPointSelect)&&(p.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(p.hasCartesianSeries=!0),P.length&&(T=P[P.length-1]),this._i=ql(T==null?void 0:T._i,-1)+1,this.opacity=this.options.opacity,p.orderItems("series",yh(this,P)),(de=O.dataSorting)!=null&&de.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(O.data,!1),Gl(this,"afterInit")}is(p){return ha[p]&&this instanceof ha[p]}bindAxes(){let p,b=this,T=b.options,P=b.chart;Gl(this,"bindAxes",null,function(){(b.axisTypes||[]).forEach(function(O){(P[O]||[]).forEach(function(z){p=z.options,(ql(T[O],0)===z.index||T[O]!==void 0&&T[O]===p.id)&&(yh(b,z.series),b[O]=z,z.isDirty=!0)}),b[O]||b.optionalAxis===O||Jh(18,!0,P)})}),Gl(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(p,b){let T=p.marker,P=b.marker||{};return T&&(P.enabled&&!T.enabled||P.symbol!==T.symbol||P.height!==T.height||P.width!==T.width)}autoIncrement(p){let b,T=this.options,{pointIntervalUnit:P,relativeXValue:O}=this.options,z=this.chart.time,j=this.xIncrement??z.parse(T.pointStart)??0;if(this.pointInterval=b=ql(this.pointInterval,T.pointInterval,1),O&&Rc(p)&&(b*=p),P){let X=z.toParts(j);P==="day"?X[2]+=b:P==="month"?X[1]+=b:P==="year"&&(X[0]+=b),b=z.makeTime.apply(z,X)-j}return O&&Rc(p)?j+b:(this.xIncrement=j+b,j)}setDataSortingOptions(){let p=this.options;ed(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),kc(p.pointRange)||(p.pointRange=1)}setOptions(p){var Oe,Be;let b,T=this.chart,P=T.options.plotOptions,O=T.userOptions||{},z=th(p),j=T.styledMode,X={plotOptions:P,userOptions:z};Gl(this,"setOptions",X);let re=X.plotOptions[this.type],de=O.plotOptions||{},ne=de.series||{},ce=Md.plotOptions[this.type]||{},ye=de[this.type]||{};re.dataLabels=this.mergeArrays(ce.dataLabels,re.dataLabels),this.userOptions=X.userOptions;let Te=th(re,P.series,ye,z);this.tooltipOptions=th(Md.tooltip,(Oe=Md.plotOptions.series)==null?void 0:Oe.tooltip,ce==null?void 0:ce.tooltip,T.userOptions.tooltip,(Be=de.series)==null?void 0:Be.tooltip,ye.tooltip,z.tooltip),this.stickyTracking=ql(z.stickyTracking,ye.stickyTracking,ne.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Te.stickyTracking),re.marker===null&&delete Te.marker,this.zoneAxis=Te.zoneAxis||"y";let De=this.zones=(Te.zones||[]).map(Ke=>({...Ke}));return(Te.negativeColor||Te.negativeFillColor)&&!Te.zones&&(b={value:Te[this.zoneAxis+"Threshold"]||Te.threshold||0,className:"highcharts-negative"},j||(b.color=Te.negativeColor,b.fillColor=Te.negativeFillColor),De.push(b)),De.length&&kc(De[De.length-1].value)&&De.push(j?{}:{color:this.color,fillColor:this.fillColor}),Gl(this,"afterSetOptions",{options:Te}),Te}getName(){return this.options.name??wi(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(p,b,T){let P,O,z=this.chart,j=`${p}Index`,X=`${p}Counter`,re=(T==null?void 0:T.length)||z.options.chart.colorCount;!b&&(kc(O=ql(p==="color"?this.options.colorIndex:void 0,this[j]))?P=O:(z.series.length||(z[X]=0),P=z[X]%re,z[X]+=1),T&&(b=T[P])),P!==void 0&&(this[j]=P),this[p]=b}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||Md.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let p=this.options.marker;this.getCyclic("symbol",p.symbol,this.chart.options.symbols)}getColumn(p,b){return(b?this.dataTable.modified:this.dataTable).getColumn(p,!0)||[]}findPointIndex(p,b){var ne;let T,P,O,{id:z,x:j}=p,X=this.points,re=this.options.dataSorting,de=this.cropStart||0;if(z){let ce=this.chart.get(z);ce instanceof yl&&(T=ce)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let ce=ye=>!ye.touched&&ye.index===p.index;if(re!=null&&re.matchByName?ce=ye=>!ye.touched&&ye.name===p.name:this.options.relativeXValue&&(ce=ye=>!ye.touched&&ye.options.x===p.x),!(T=nc(X,ce)))return}return T&&(O=T==null?void 0:T.index)!==void 0&&(P=!0),O===void 0&&Rc(j)&&(O=this.getColumn("x").indexOf(j,b)),O!==-1&&O!==void 0&&this.cropped&&(O=O>=de?O-de:O),!P&&Rc(O)&&((ne=X[O])!=null&&ne.touched)&&(O=void 0),O}updateData(p,b){var De;let{options:T,requireSorting:P}=this,O=T.dataSorting,z=this.points,j=[],X=p.length===z.length,re,de,ne,ce,ye=!0;if(this.xIncrement=null,p.forEach((Oe,Be)=>{var $t;let Ke,st=kc(Oe)&&this.pointClass.prototype.optionsToObject.call({series:this},Oe)||{},{id:Bt,x:Ut}=st;Bt||Rc(Ut)?((Ke=this.findPointIndex(st,ce))===-1||Ke===void 0?j.push(Oe):z[Ke]&&Oe!==(($t=T.data)==null?void 0:$t[Ke])?(z[Ke].update(Oe,!1,void 0,!1),z[Ke].touched=!0,P&&(ce=Ke+1)):z[Ke]&&(z[Ke].touched=!0),(!X||Be!==Ke||O!=null&&O.enabled||this.hasDerivedData)&&(re=!0)):j.push(Oe)},this),re)for(de=z.length;de--;)(ne=z[de])&&!ne.touched&&((De=ne.remove)==null||De.call(ne,!1,b));else X&&!(O!=null&&O.enabled)?(p.forEach((Oe,Be)=>{Oe===z[Be].y||z[Be].destroyed||z[Be].update(Oe,!1,void 0,!1)}),j.length=0):ye=!1;if(z.forEach(Oe=>{Oe&&(Oe.touched=!1)}),!ye)return!1;j.forEach(Oe=>{this.addPoint(Oe,!1,void 0,void 0,!1)},this);let Te=this.getColumn("x");return this.xIncrement===null&&Te.length&&(this.xIncrement=kh(Te),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(p,b=!0,T,P){var ci,oi;let O=this.points,z=(O==null?void 0:O.length)||0,j=this.options,X=this.chart,re=j.dataSorting,de=this.xAxis,ne=j.turboThreshold,ce=this.dataTable,ye=this.dataColumnKeys(),Te=this.pointValKey||"y",De=(this.pointArrayMap||[]).length,Oe=j.keys,Be,Ke,st=0,Bt=1,Ut;X.options.chart.allowMutatingData||(j.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,Ut=th(!0,p));let $t=(p=Ut||p||[]).length;if(re!=null&&re.enabled&&(p=this.sortData(p)),X.options.chart.allowMutatingData&&P!==!1&&$t&&z&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(Ke=this.updateData(p,T)),!Ke){this.xIncrement=null,this.colorCounter=0;let di=ne&&!j.relativeXValue&&$t>ne;if(di){let er=this.getFirstValidPoint(p),Vi=this.getFirstValidPoint(p,$t-1,-1),lr=Vr=>!!(vp(Vr)&&(Oe||Rc(Vr[0])));if(Rc(er)&&Rc(Vi)){let Vr=[],Wn=[];for(let xn of p)Vr.push(this.autoIncrement()),Wn.push(xn);ce.setColumns({x:Vr,[Te]:Wn})}else if(lr(er)&&lr(Vi))if(De){let Vr=+(er.length===De),Wn=Array(ye.length).fill(0).map(()=>[]);for(let xn of p){Vr&&Wn[0].push(this.autoIncrement());for(let Nn=Vr;Nn<=De;Nn++)(ci=Wn[Nn])==null||ci.push(xn[Nn-Vr])}ce.setColumns(ye.reduce((xn,Nn,Bn)=>(xn[Nn]=Wn[Bn],xn),{}))}else{Oe&&(st=Oe.indexOf("x"),Bt=Oe.indexOf("y"),st=st>=0?st:0,Bt=Bt>=0?Bt:1),er.length===1&&(Bt=0);let Vr=[],Wn=[];if(st===Bt)for(let xn of p)Vr.push(this.autoIncrement()),Wn.push(xn[Bt]);else for(let xn of p)Vr.push(xn[st]),Wn.push(xn[Bt]);ce.setColumns({x:Vr,[Te]:Wn})}else di=!1}if(!di){let er=ye.reduce((Vi,lr)=>(Vi[lr]=[],Vi),{});for(Be=0;Be<$t;Be++){let Vi=this.pointClass.prototype.applyOptions.apply({series:this},[p[Be]]);for(let lr of ye)er[lr][Be]=Vi[lr]}ce.setColumns(er)}for(eu(this.getColumn("y")[0])&&Jh(14,!0,X),this.data=[],this.options.data=this.userOptions.data=p,Be=z;Be--;)(oi=O[Be])==null||oi.destroy();de&&(de.minRange=de.userMinRange),this.isDirty=X.isDirtyBox=!0,this.isDirtyData=!!O,T=!1}j.legendType==="point"&&(this.processData(),this.generatePoints()),b&&X.redraw(T)}sortData(p){let b=this,T=b.options.dataSorting.sortKey||"y",P=function(O,z){return kc(z)&&O.pointClass.prototype.optionsToObject.call({series:O},z)||{}};return p.forEach(function(O,z){p[z]=P(b,O),p[z].index=z},this),p.concat().sort((O,z)=>{let j=Vh(T,O),X=Vh(T,z);return X<j?-1:+(X>j)}).forEach(function(O,z){O.x=z},this),b.linkedSeries&&b.linkedSeries.forEach(function(O){var X;let z=O.options,j=z.data;!((X=z.dataSorting)!=null&&X.enabled)&&j&&(j.forEach(function(re,de){j[de]=P(O,re),p[de]&&(j[de].x=p[de].x,j[de].index=de)}),O.setData(j,!1))}),p}getProcessedData(p){let b=this,{dataTable:T,isCartesian:P,options:O,xAxis:z}=b,j=O.cropThreshold,X=p||b.getExtremesFromAll,re=z==null?void 0:z.logarithmic,de=T.rowCount,ne,ce,ye=0,Te,De,Oe,Be=b.getColumn("x"),Ke=T,st=!1;return z&&(De=(Te=z.getExtremes()).min,Oe=Te.max,st=!!(z.categories&&!z.names.length),P&&b.sorted&&!X&&(!j||de>j||b.forceCrop)&&(Be[de-1]<De||Be[0]>Oe?Ke=new Wd:b.getColumn(b.pointValKey||"y").length&&(Be[0]<De||Be[de-1]>Oe)&&(Ke=(ne=this.cropData(T,De,Oe)).modified,ye=ne.start,ce=!0))),Be=Ke.getColumn("x")||[],{modified:Ke,cropped:ce,cropStart:ye,closestPointRange:oy([re?Be.map(re.log2lin):Be],()=>b.requireSorting&&!st&&Jh(15,!1,b.chart))}}processData(p){let b=this.xAxis,T=this.dataTable;if(this.isCartesian&&!this.isDirty&&!b.isDirty&&!this.yAxis.isDirty&&!p)return!1;let P=this.getProcessedData();T.modified=P.modified,this.cropped=P.cropped,this.cropStart=P.cropStart,this.closestPointRange=this.basePointRange=P.closestPointRange,Gl(this,"afterProcessData")}cropData(p,b,T){let P=p.getColumn("x",!0)||[],O=P.length,z={},j,X,re=0,de=O;for(j=0;j<O;j++)if(P[j]>=b){re=Math.max(0,j-1);break}for(X=j;X<O;X++)if(P[X]>T){de=X+1;break}for(let ne of this.dataColumnKeys()){let ce=p.getColumn(ne,!0);ce&&(z[ne]=ce.slice(re,de))}return{modified:new Wd({columns:z}),start:re,end:de}}generatePoints(){var Ut,$t,ci;let p=this.options,b=this.processedData||p.data,T=this.dataTable.modified,P=this.getColumn("x",!0),O=this.pointClass,z=T.rowCount,j=this.cropStart||0,X=this.hasGroupedData,re=p.keys,de=[],ne=(Ut=p.dataGrouping)!=null&&Ut.groupAll?j:0,ce=($t=this.xAxis)==null?void 0:$t.categories,ye=this.pointArrayMap||["y"],Te=this.dataColumnKeys(),De,Oe,Be,Ke,st=this.data,Bt;if(!st&&!X){let oi=[];oi.length=(b==null?void 0:b.length)||0,st=this.data=oi}for(re&&X&&(this.options.keys=!1),Ke=0;Ke<z;Ke++)Oe=j+Ke,X?((Be=new O(this,T.getRow(Ke,Te)||[])).dataGroup=this.groupMap[ne+Ke],(ci=Be.dataGroup)!=null&&ci.options&&(Be.options=Be.dataGroup.options,ed(Be,Be.dataGroup.options),delete Be.dataLabels)):(Be=st[Oe],Bt=b?b[Oe]:T.getRow(Ke,ye),Be||Bt===void 0||(st[Oe]=Be=new O(this,Bt,P[Ke]))),Be&&(Be.index=X?ne+Ke:Oe,de[Ke]=Be,Be.category=(ce==null?void 0:ce[Be.x])??Be.x,Be.key=Be.name??Be.category);if(this.options.keys=re,st&&(z!==(De=st.length)||X))for(Ke=0;Ke<De;Ke++)Ke!==j||X||(Ke+=z),st[Ke]&&(st[Ke].destroyElements(),st[Ke].plotX=void 0);this.data=st,this.points=de,Gl(this,"afterGeneratePoints")}getXExtremes(p){return{min:Tg(p),max:kh(p)}}getExtremes(p,b){var Ut;let{xAxis:T,yAxis:P}=this,O=b||this.getExtremesFromAll||this.options.getExtremesFromAll,z=O&&this.cropped?this.dataTable:this.dataTable.modified,j=z.rowCount,X=p||this.stackedYData,re=X?[X]:((Ut=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:Ut.map($t=>z.getColumn($t,!0)||[]))||[],de=this.getColumn("x",!0),ne=[],ce=this.requireSorting&&!this.is("column")?1:0,ye=!!P&&P.positiveValuesOnly,Te=O||this.cropped||!T,De,Oe,Be,Ke=0,st=0;for(T&&(Ke=(De=T.getExtremes()).min,st=De.max),Be=0;Be<j;Be++)if(Oe=de[Be],Te||(de[Be+ce]||Oe)>=Ke&&(de[Be-ce]||Oe)<=st)for(let $t of re){let ci=$t[Be];Rc(ci)&&(ci>0||!ye)&&ne.push(ci)}let Bt={activeYData:ne,dataMin:Tg(ne),dataMax:kh(ne)};return Gl(this,"afterGetExtremes",{dataExtremes:Bt}),Bt}applyExtremes(){let p=this.getExtremes();return this.dataMin=p.dataMin,this.dataMax=p.dataMax,p}getFirstValidPoint(p,b=0,T=1){let P=p.length,O=b;for(;O>=0&&O<P;){if(kc(p[O]))return p[O];O+=T}}translate(){var st;this.generatePoints();let p=this.options,b=p.stacking,T=this.xAxis,P=this.enabledDataSorting,O=this.yAxis,z=this.points,j=z.length,X=this.pointPlacementToXValue(),re=!!X,de=p.threshold,ne=p.startFromThreshold?de:0,ce=(p==null?void 0:p.nullInteraction)&&O.len,ye,Te,De,Oe,Be=Number.MAX_VALUE;function Ke(Bt){return La(Bt,-1e9,1e9)}for(ye=0;ye<j;ye++){let Bt,Ut=z[ye],$t=Ut.x,ci,oi,di=Ut.y,er=Ut.low,Vi=b&&((st=O.stacking)==null?void 0:st.stacks[(this.negStacks&&di<(ne?0:de)?"-":"")+this.stackKey]);Ut.plotX=Rc(Te=T.translate($t,!1,!1,!1,!0,X))?sy(Ke(Te)):void 0,b&&this.visible&&Vi&&Vi[$t]&&(Oe=this.getStackIndicator(Oe,$t,this.index),!Ut.isNull&&Oe.key&&(oi=(ci=Vi[$t]).points[Oe.key]),ci&&vp(oi)&&(er=oi[0],di=oi[1],er===ne&&Oe.key===Vi[$t].base&&(er=ql(Rc(de)?de:O.min)),O.positiveValuesOnly&&kc(er)&&er<=0&&(er=void 0),Ut.total=Ut.stackTotal=ql(ci.total),Ut.percentage=kc(Ut.y)&&ci.total?Ut.y/ci.total*100:void 0,Ut.stackY=di,this.irregularWidths||ci.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),Ut.yBottom=kc(er)?Ke(O.translate(er,!1,!0,!1,!0)):void 0,this.dataModify&&(di=this.dataModify.modifyValue(di,ye)),Rc(di)&&Ut.plotX!==void 0?Bt=Rc(Bt=O.translate(di,!1,!0,!1,!0))?Ke(Bt):void 0:!Rc(di)&&ce&&(Bt=ce),Ut.plotY=Bt,Ut.isInside=this.isPointInside(Ut),Ut.clientX=re?sy(T.translate($t,!1,!1,!1,!0,X)):Te,Ut.negative=(Ut.y||0)<(de||0),Ut.isNull||Ut.visible===!1||(De!==void 0&&(Be=Math.min(Be,Math.abs(Te-De))),De=Te),Ut.zone=this.zones.length?Ut.getZone():void 0,!Ut.graphic&&this.group&&P&&(Ut.isNew=!0)}this.closestPointRangePx=Be,Gl(this,"afterTranslate")}getValidPoints(p,b,T){let P=this.chart;return(p||this.points||[]).filter(function(O){let{plotX:z,plotY:j}=O;return(!!T||!O.isNull&&!!Rc(j))&&(!b||!!P.isInsidePlot(z,j,{inverted:P.inverted}))&&O.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:p,group:b,markerGroup:T}=this,P=p.sharedClips,O=p.renderer,z=p.getClipBox(this),j=this.getSharedClipKey(),X=P[j];X?X.animate(z):P[j]=X=O.clipRect(z),b&&b.clip(this.options.clip===!1?void 0:X),T&&T.clip()}animate(p){let{chart:b,group:T,markerGroup:P}=this,O=b.inverted,z=Sg(this.options.animation),j=[this.getSharedClipKey(),z.duration,z.easing,z.defer].join(","),X=b.sharedClips[j],re=b.sharedClips[j+"m"];if(p&&T){let de=b.getClipBox(this);if(X)X.attr("height",de.height);else{de.width=0,O&&(de.x=b.plotHeight),X=b.renderer.clipRect(de),b.sharedClips[j]=X;let ne={x:-99,y:-99,width:O?b.plotWidth+199:99,height:O?99:b.plotHeight+199};re=b.renderer.clipRect(ne),b.sharedClips[j+"m"]=re}T.clip(X),P==null||P.clip(re)}else if(X&&!X.hasClass("highcharts-animating")){let de=b.getClipBox(this),ne=z.step;(P!=null&&P.element.childNodes.length||b.series.length>1)&&(z.step=function(ce,ye){ne&&ne.apply(ye,arguments),ye.prop==="width"&&(re!=null&&re.element)&&re.attr(O?"height":"width",ce+99)}),X.addClass("highcharts-animating").animate(de,z)}}afterAnimate(){this.setClip(),Hd(this.chart.sharedClips,(p,b,T)=>{p&&!this.chart.container.querySelector(`[clip-path="url(#${p.id})"]`)&&(p.destroy(),delete T[b])}),this.finishedAnimating=!0,Gl(this,"afterAnimate")}drawPoints(p=this.points){let b,T,P,O,z,j,X,re=this.chart,de=re.styledMode,{colorAxis:ne,options:ce}=this,ye=ce.marker,Te=ce.nullInteraction,De=this[this.specialGroup||"markerGroup"],Oe=this.xAxis,Be=ql(ye.enabled,!Oe||!!Oe.isRadial||null,this.closestPointRangePx>=ye.enabledThreshold*ye.radius);if(ye.enabled!==!1||this._hasPointMarkers)for(b=0;b<p.length;b++){O=(P=(T=p[b]).graphic)?"animate":"attr",z=T.marker||{},j=!!T.marker;let Ke=T.isNull;if((Be&&!kc(z.enabled)||z.enabled)&&(!Ke||Te)&&T.visible!==!1){let st=ql(z.symbol,this.symbol,"rect");X=this.markerAttribs(T,T.selected&&"select"),this.enabledDataSorting&&(T.startXPos=Oe.reversed?-(X.width||0):Oe.width);let Bt=T.isInside!==!1;if(!P&&Bt&&((X.width||0)>0||T.hasImage)&&(T.graphic=P=re.renderer.symbol(st,X.x,X.y,X.width,X.height,j?z:ye).add(De),this.enabledDataSorting&&re.hasRendered&&(P.attr({x:T.startXPos}),O="animate")),P&&O==="animate"&&P[Bt?"show":"hide"](Bt).animate(X),P){let Ut=this.pointAttribs(T,de||!T.selected?void 0:"select");de?ne&&P.css({fill:Ut.fill}):P[O](Ut)}P&&P.addClass(T.getClassName(),!0)}else P&&(T.graphic=P.destroy())}}markerAttribs(p,b){let T=this.options,P=T.marker,O=p.marker||{},z=O.symbol||P.symbol,j={},X,re,de=ql(O.radius,P==null?void 0:P.radius);b&&(X=P.states[b],re=O.states&&O.states[b],de=ql(re==null?void 0:re.radius,X==null?void 0:X.radius,de&&de+((X==null?void 0:X.radiusPlus)||0))),p.hasImage=z&&z.indexOf("url")===0,p.hasImage&&(de=0);let ne=p.pos();return Rc(de)&&ne&&(T.crisp&&(ne[0]=Bm(ne[0],p.hasImage?0:z==="rect"?(P==null?void 0:P.lineWidth)||0:1)),j.x=ne[0]-de,j.y=ne[1]-de),de&&(j.width=j.height=2*de),j}pointAttribs(p,b){var Be;let T=this.options,P=T.marker,O=p==null?void 0:p.options,z=(O==null?void 0:O.marker)||{},j=O==null?void 0:O.color,X=p==null?void 0:p.color,re=(Be=p==null?void 0:p.zone)==null?void 0:Be.color,de,ne,ce=this.color,ye,Te,De=ql(z.lineWidth,P.lineWidth),Oe=p!=null&&p.isNull&&T.nullInteraction?0:1;return ce=j||re||X||ce,ye=z.fillColor||P.fillColor||ce,Te=z.lineColor||P.lineColor||ce,b=b||"normal",de=P.states[b]||{},De=ql((ne=z.states&&z.states[b]||{}).lineWidth,de.lineWidth,De+ql(ne.lineWidthPlus,de.lineWidthPlus,0)),ye=ne.fillColor||de.fillColor||ye,Te=ne.lineColor||de.lineColor||Te,{stroke:Te,"stroke-width":De,fill:ye,opacity:Oe=ql(ne.opacity,de.opacity,Oe)}}destroy(p){var X,re;let b,T,P=this,O=P.chart,z=/AppleWebKit\/533/.test(Jf.navigator.userAgent),j=P.data||[];for(Gl(P,"destroy",{keepEventsForUpdate:p}),this.removeEvents(p),(P.axisTypes||[]).forEach(function(de){T=P[de],T!=null&&T.series&&(Lu(T.series,P),T.isDirty=T.forceRedraw=!0)}),P.legendItem&&P.chart.legend.destroyItem(P),b=j.length;b--;)(re=(X=j[b])==null?void 0:X.destroy)==null||re.call(X);for(let de of P.zones)xf(de,void 0,!0);Ht.clearTimeout(P.animationTimeout),Hd(P,function(de,ne){de instanceof Qa&&!de.survive&&de[z&&ne==="group"?"hide":"destroy"]()}),O.hoverSeries===P&&(O.hoverSeries=void 0),Lu(O.series,P),O.orderItems("series"),Hd(P,function(de,ne){p&&ne==="hcEvents"||delete P[ne]})}applyZones(){let{area:p,chart:b,graph:T,zones:P,points:O,xAxis:z,yAxis:j,zoneAxis:X}=this,{inverted:re,renderer:de}=b,ne=this[`${X}Axis`],{isXAxis:ce,len:ye=0,minPointOffset:Te=0}=ne||{},De=((T==null?void 0:T.strokeWidth())||0)/2+1,Oe=(Be,Ke=0,st=0)=>{re&&(st=ye-st);let{translated:Bt=0,lineClip:Ut}=Be,$t=st-Bt;Ut==null||Ut.push(["L",Ke,Math.abs($t)<De?st-De*($t<=0?-1:1):Bt])};if(P.length&&(T||p)&&ne&&Rc(ne.min)){let Be=ne.getExtremes().max+Te,Ke=Ut=>{Ut.forEach(($t,ci)=>{($t[0]==="M"||$t[0]==="L")&&(Ut[ci]=[$t[0],ce?ye-$t[1]:$t[1],ce?$t[2]:ye-$t[2]])})};if(P.forEach(Ut=>{Ut.lineClip=[],Ut.translated=La(ne.toPixels(ql(Ut.value,Be),!0)||0,0,ye)}),T&&!this.showLine&&T.hide(),p&&p.hide(),X==="y"&&O.length<z.len)for(let Ut of O){let{plotX:$t,plotY:ci,zone:oi}=Ut,di=oi&&P[P.indexOf(oi)-1];oi&&Oe(oi,$t,ci),di&&Oe(di,$t,ci)}let st=[],Bt=ne.toPixels(ne.getExtremes().min-Te,!0);P.forEach(Ut=>{var Nn,Bn;let $t=Ut.lineClip||[],ci=Math.round(Ut.translated||0);z.reversed&&$t.reverse();let{clip:oi,simpleClip:di}=Ut,er=0,Vi=0,lr=z.len,Vr=j.len;ce?(er=ci,lr=Bt):(Vi=ci,Vr=Bt);let Wn=[["M",er,Vi],["L",lr,Vi],["L",lr,Vr],["L",er,Vr],["Z"]],xn=[Wn[0],...$t,Wn[1],Wn[2],...st,Wn[3],Wn[4]];st=$t.reverse(),Bt=ci,re&&(Ke(xn),p&&Ke(Wn)),oi?(oi.animate({d:xn}),di==null||di.animate({d:Wn})):(oi=Ut.clip=de.path(xn),p&&(di=Ut.simpleClip=de.path(Wn))),T&&((Nn=Ut.graph)==null||Nn.clip(oi)),p&&((Bn=Ut.area)==null||Bn.clip(di))})}else this.visible&&(T&&T.show(),p&&p.show())}plotGroup(p,b,T,P,O){let z=this[p],j=!z,X={visibility:T,zIndex:P||.1};return kc(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(X.opacity=this.opacity),z||(this[p]=z=this.chart.renderer.g().add(O)),z.addClass("highcharts-"+b+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(kc(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(z.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),z.attr(X)[j?"attr":"animate"](this.getPlotBox(b)),z}getPlotBox(p){let b=this.xAxis,T=this.yAxis,P=this.chart,O=P.inverted&&!P.polar&&b&&this.invertible&&p==="series";P.inverted&&(b=T,T=this.xAxis);let z={scale:1,translateX:b?b.left:P.plotLeft,translateY:T?T.top:P.plotTop,name:p};Gl(this,"getPlotBox",z);let{scale:j,translateX:X,translateY:re}=z;return{translateX:X,translateY:re,rotation:90*!!O,rotationOriginX:O?j*(b.len-T.len)/2:0,rotationOriginY:O?j*(b.len+T.len)/2:0,scaleX:O?-j:j,scaleY:j}}removeEvents(p){let{eventsToUnbind:b}=this;p||Va(this),b.length&&(b.forEach(T=>{T()}),b.length=0)}render(){var de,ne,ce,ye,Te;let p=this,{chart:b,options:T,hasRendered:P}=p,O=Sg(T.animation),z=p.visible?"inherit":"hidden",j=T.zIndex,X=b.seriesGroup,re=p.finishedAnimating?0:O.duration;Gl(this,"render"),p.plotGroup("group","series",z,j,X),p.markerGroup=p.plotGroup("markerGroup","markers",z,j,X),T.clip!==!1&&p.setClip(),re&&((de=p.animate)==null||de.call(p,!0)),p.drawGraph&&(p.drawGraph(),p.applyZones()),p.visible&&p.drawPoints(),(ne=p.drawDataLabels)==null||ne.call(p),(ce=p.redrawPoints)==null||ce.call(p),T.enableMouseTracking&&((ye=p.drawTracker)==null||ye.call(p)),re&&((Te=p.animate)==null||Te.call(p)),P||(re&&O.defer&&(re+=O.defer),p.animationTimeout=lo(()=>{p.afterAnimate()},re||0)),p.isDirty=!1,p.hasRendered=!0,Gl(p,"afterRender")}redraw(){let p=this.isDirty||this.isDirtyData;this.translate(),this.render(),p&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(p,b){let{xAxis:T,yAxis:P}=this,O=this.chart.inverted;return this.searchKDTree({clientX:O?T.len-p.chartY+T.pos:p.chartX-T.pos,plotY:O?P.len-p.chartX+P.pos:p.chartY-P.pos},b,p)}buildKDTree(p){this.buildingKdTree=!0;let b=this,T=b.options,P=T.findNearestPointBy.indexOf("y")>-1?2:1;delete b.kdTree,lo(function(){b.kdTree=function O(z,j,X){let re,de,ne=z==null?void 0:z.length;if(ne)return re=b.kdAxisArray[j%X],z.sort((ce,ye)=>(ce[re]||0)-(ye[re]||0)),{point:z[de=Math.floor(ne/2)],left:O(z.slice(0,de),j+1,X),right:O(z.slice(de+1),j+1,X)}}(b.getValidPoints(void 0,!b.directTouch,T==null?void 0:T.nullInteraction),P,P),b.buildingKdTree=!1},T.kdNow||(p==null?void 0:p.type)==="touchstart"?0:1)}searchKDTree(p,b,T,P,O){let z=this,[j,X]=this.kdAxisArray,re=b?"distX":"dist",de=(z.options.findNearestPointBy||"").indexOf("y")>-1?2:1,ne=!!z.isBubble,ce=P||((Te,De,Oe)=>{let Be=Te[Oe]||0,Ke=De[Oe]||0;return[Be===Ke&&Te.index>De.index||Be<Ke?Te:De,!1]}),ye=O||((Te,De)=>Te<De);if(this.kdTree||this.buildingKdTree||this.buildKDTree(T),this.kdTree)return function Te(De,Oe,Be,Ke){var er;let st=Oe.point,Bt=z.kdAxisArray[Be%Ke],Ut=st,$t=!1;(function(Vi,lr){var ns;let Vr=Vi[j],Wn=lr[j],xn=kc(Vr)&&kc(Wn)?Vr-Wn:null,Nn=Vi[X],Bn=lr[X],Xn=kc(Nn)&&kc(Bn)?Nn-Bn:0,es=ne&&((ns=lr.marker)==null?void 0:ns.radius)||0;lr.dist=Math.sqrt((xn&&xn*xn||0)+Xn*Xn)-es,lr.distX=kc(xn)?Math.abs(xn)-es:Number.MAX_VALUE})(De,st);let ci=(De[Bt]||0)-(st[Bt]||0)+(ne&&((er=st.marker)==null?void 0:er.radius)||0),oi=ci<0?"left":"right",di=ci<0?"right":"left";return Oe[oi]&&([Ut,$t]=ce(st,Te(De,Oe[oi],Be+1,Ke),re)),Oe[di]&&ye(Math.sqrt(ci*ci),Ut[re],$t)&&(Ut=ce(Ut,Te(De,Oe[di],Be+1,Ke),re)[0]),Ut}(p,this.kdTree,de,de)}pointPlacementToXValue(){let{options:p,xAxis:b}=this,T=p.pointPlacement;return T==="between"&&(T=b.reversed?-.5:.5),Rc(T)?T*(p.pointRange||b.pointRange):0}isPointInside(p){let{chart:b,xAxis:T,yAxis:P}=this,{plotX:O=-1,plotY:z=-1}=p;return z>=0&&z<=(P?P.len:b.plotHeight)&&O>=0&&O<=(T?T.len:b.plotWidth)}drawTracker(){var ce;let p=this,b=p.options,T=b.trackByArea,P=[].concat((T?p.areaPath:p.graphPath)||[]),O=p.chart,z=O.pointer,j=O.renderer,X=((ce=O.options.tooltip)==null?void 0:ce.snap)||0,re=()=>{b.enableMouseTracking&&O.hoverSeries!==p&&p.onMouseOver()},de="rgba(192,192,192,"+(cn?1e-4:.002)+")",ne=p.tracker;ne?ne.attr({d:P}):p.graph&&(p.tracker=ne=j.path(P).attr({visibility:p.visible?"inherit":"hidden",zIndex:2}).addClass(T?"highcharts-tracker-area":"highcharts-tracker-line").add(p.group),O.styledMode||ne.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:de,fill:T?de:"none","stroke-width":p.graph.strokeWidth()+(T?0:2*X)}),[p.tracker,p.markerGroup,p.dataLabelsGroup].forEach(ye=>{ye&&(ye.addClass("highcharts-tracker").on("mouseover",re).on("mouseout",Te=>{z==null||z.onTrackerMouseOut(Te)}),b.cursor&&!O.styledMode&&ye.css({cursor:b.cursor}),ye.on("touchstart",re))})),Gl(this,"afterDrawTracker")}addPoint(p,b,T,P,O){let z,j,X=this.options,{chart:re,data:de,dataTable:ne,xAxis:ce}=this,ye=(ce==null?void 0:ce.hasNames)&&ce.names,Te=X.data,De=this.getColumn("x");b=ql(b,!0);let Oe={series:this};this.pointClass.prototype.applyOptions.apply(Oe,[p]);let Be=Oe.x;if(j=De.length,this.requireSorting&&Be<De[j-1])for(z=!0;j&&De[j-1]>Be;)j--;ne.setRow(Oe,j,!0,{addColumns:!1}),ye&&Oe.name&&(ye[Be]=Oe.name),Te==null||Te.splice(j,0,p),(z||this.processedData)&&(this.data.splice(j,0,null),this.processData()),X.legendType==="point"&&this.generatePoints(),T&&(de[0]&&de[0].remove?de[0].remove(!1):([de,Te].filter(kc).forEach(Ke=>{Ke.shift()}),ne.deleteRows(0))),O!==!1&&Gl(this,"addPoint",{point:Oe}),this.isDirty=!0,this.isDirtyData=!0,b&&re.redraw(P)}removePoint(p,b,T){let P=this,{chart:O,data:z,points:j,dataTable:X}=P,re=z[p],de=function(){[(j==null?void 0:j.length)===z.length?j:void 0,z,P.options.data].filter(kc).forEach(ne=>{ne.splice(p,1)}),X.deleteRows(p),re==null||re.destroy(),P.isDirty=!0,P.isDirtyData=!0,b&&O.redraw()};Qf(T,O),b=ql(b,!0),re?re.firePointEvent("remove",null,de):de()}remove(p,b,T,P){let O=this,z=O.chart;function j(){O.destroy(P),z.isDirtyLegend=z.isDirtyBox=!0,z.linkSeries(P),ql(p,!0)&&z.redraw(b)}T!==!1?Gl(O,"remove",null,j):j()}update(p,b){var Be,Ke;Gl(this,"update",{options:p=ph(p,this.userOptions)});let T=this,P=T.chart,O=T.userOptions,z=T.initialType||T.type,j=P.options.plotOptions,X=ha[z].prototype,re=T.finishedAnimating&&{animation:!1},de={},ne,ce,ye=td.keepProps.slice(),Te=p.type||O.type||P.options.chart.type,De=!(this.hasDerivedData||Te&&Te!==this.type||p.keys!==void 0||p.pointStart!==void 0||p.pointInterval!==void 0||p.relativeXValue!==void 0||p.joinBy||p.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(st=>T.hasOptionChanged(st)));Te=Te||z,De?(ye.push.apply(ye,td.keepPropsForPoints),p.visible!==!1&&ye.push("area","graph"),T.parallelArrays.forEach(function(st){ye.push(st+"Data")}),p.data&&(p.dataSorting&&ed(T.options.dataSorting,p.dataSorting),this.setData(p.data,!1))):this.dataTable.modified=this.dataTable,p=th(O,{index:O.index===void 0?T.index:O.index,pointStart:((Be=j==null?void 0:j.series)==null?void 0:Be.pointStart)??O.pointStart??T.getColumn("x")[0]},!De&&{data:T.options.data},p,re),De&&p.data&&(p.data=T.options.data),(ye=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(ye)).forEach(function(st){ye[st]=T[st],delete T[st]});let Oe=!1;if(ha[Te]){if(Oe=Te!==T.type,T.remove(!1,!1,!1,!0),Oe)if(P.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(T,ha[Te].prototype);else{let st=Object.hasOwnProperty.call(T,"hcEvents")&&T.hcEvents;for(ce in X)T[ce]=void 0;ed(T,ha[Te].prototype),st?T.hcEvents=st:delete T.hcEvents}}else Jh(17,!0,P,{missingModuleFor:Te});if(ye.forEach(function(st){T[st]=ye[st]}),T.init(P,p),De&&this.points)for(let st of((ne=T.options).visible===!1?(de.graphic=1,de.dataLabel=1):(this.hasMarkerChanged(ne,O)&&(de.graphic=1),(Ke=T.hasDataLabels)!=null&&Ke.call(T)||(de.dataLabel=1)),this.points))st!=null&&st.series&&(st.resolveColor(),Object.keys(de).length&&st.destroyElements(de),ne.showInLegend===!1&&st.legendItem&&P.legend.destroyItem(st));T.initialType=z,P.linkSeries(),P.setSortedData(),Oe&&T.linkedSeries.length&&(T.isDirtyData=!0),Gl(this,"afterUpdate"),ql(b,!0)&&P.redraw(!!De&&void 0)}setName(p){this.name=this.options.name=this.userOptions.name=p,this.chart.isDirtyLegend=!0}hasOptionChanged(p){var j,X;let b=this.chart,T=this.options[p],P=b.options.plotOptions,O=this.userOptions[p],z=ql((j=P==null?void 0:P[this.type])==null?void 0:j[p],(X=P==null?void 0:P.series)==null?void 0:X[p]);return O&&!kc(z)?T!==O:T!==ql(z,T)}onMouseOver(){let p=this.chart,b=p.hoverSeries,T=p.pointer;T==null||T.setHoverChartIndex(),b&&b!==this&&b.onMouseOut(),this.options.events.mouseOver&&Gl(this,"mouseOver"),this.setState("hover"),p.hoverSeries=this}onMouseOut(){let p=this.options,b=this.chart,T=b.tooltip,P=b.hoverPoint;b.hoverSeries=null,P&&P.onMouseOut(),this&&p.events.mouseOut&&Gl(this,"mouseOut"),T&&!this.stickyTracking&&(!T.shared||this.noSharedTooltip)&&T.hide(),b.series.forEach(function(O){O.setState("",!0)})}setState(p,b){let T=this,P=T.options,O=T.graph,z=P.inactiveOtherPoints,j=P.states,X=ql(j[p||"normal"]&&j[p||"normal"].animation,T.chart.options.chart.animation),re=P.lineWidth,de=P.opacity;if(p=p||"",T.state!==p&&([T.group,T.markerGroup,T.dataLabelsGroup].forEach(function(ne){ne&&(T.state&&ne.removeClass("highcharts-series-"+T.state),p&&ne.addClass("highcharts-series-"+p))}),T.state=p,!T.chart.styledMode)){if(j[p]&&j[p].enabled===!1)return;if(p&&(re=j[p].lineWidth||re+(j[p].lineWidthPlus||0),de=ql(j[p].opacity,de)),O&&!O.dashstyle&&Rc(re))for(let ne of[O,...this.zones.map(ce=>ce.graph)])ne==null||ne.animate({"stroke-width":re},X);z||[T.group,T.markerGroup,T.dataLabelsGroup,T.labelBySeries].forEach(function(ne){ne&&ne.animate({opacity:de},X)})}b&&z&&T.points&&T.setAllPointsToState(p||void 0)}setAllPointsToState(p){this.points.forEach(function(b){b.setState&&b.setState(p)})}setVisible(p,b){var X;let T=this,P=T.chart,O=P.options.chart.ignoreHiddenSeries,z=T.visible;T.visible=p=T.options.visible=T.userOptions.visible=p===void 0?!z:p;let j=p?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(re=>{var de;(de=T[re])==null||de[j]()}),(P.hoverSeries===T||((X=P.hoverPoint)==null?void 0:X.series)===T)&&T.onMouseOut(),T.legendItem&&P.legend.colorizeItem(T,p),T.isDirty=!0,T.options.stacking&&P.series.forEach(re=>{re.options.stacking&&re.visible&&(re.isDirty=!0)}),T.linkedSeries.forEach(re=>{re.setVisible(p,!1)}),O&&(P.isDirtyBox=!0),Gl(T,j),b!==!1&&P.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(p){this.selected=p=this.options.selected=p===void 0?!this.selected:p,this.checkbox&&(this.checkbox.checked=p),Gl(this,p?"select":"unselect")}shouldShowTooltip(p,b,T={}){return T.series=this,T.visiblePlotOnly=!0,this.chart.isInsidePlot(p,b,T)}drawLegendSymbol(p,b){var T;(T=sa[this.options.legendSymbol||"rectangle"])==null||T.call(this,p,b)}}td.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:ie}=this.series.chart;return typeof this.y!="number"?"":ie(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},td.types=Ia.seriesTypes,td.registerType=Ia.registerSeriesType,td.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],td.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],ed(td.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:yl,requireSorting:!0,sorted:!0}),Ia.series=td;let Vc=td,{animObject:em,setAnimation:tm}=zr,{registerEventOptions:xp}=Vo,{composed:Gd,marginNames:im}=Je,{distribute:id}=Vs,{format:sc}=ba,{addEvent:Wc,createElement:bf,css:Cg,defined:Hp,discardElement:rd,find:wf,fireEvent:Pl,isNumber:rm,merge:Wh,pick:ih,pushUnique:Sf,relativeLength:ay,stableSort:Id,syncTimeout:Ac}=Ht;class qd{constructor(p,b){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=p,this.setOptions(b),b.enabled&&(this.render(),xp(this,b),Wc(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),Wc(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(p){let b=ih(p.padding,8);this.options=p,this.chart.styledMode||(this.itemStyle=p.itemStyle,this.itemHiddenStyle=Wh(this.itemStyle,p.itemHiddenStyle)),this.itemMarginTop=p.itemMarginTop,this.itemMarginBottom=p.itemMarginBottom,this.padding=b,this.initialItemY=b-5,this.symbolWidth=ih(p.symbolWidth,16),this.pages=[],this.proximate=p.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(p,b){let T=this.chart;this.setOptions(Wh(!0,this.options,p)),"events"in this.options&&xp(this,this.options),this.destroy(),T.isDirtyLegend=T.isDirtyBox=!0,ih(b,!0)&&T.redraw(),Pl(this,"afterUpdate",{redraw:b})}colorizeItem(p,b){var re;let T=p.color,{area:P,group:O,label:z,line:j,symbol:X}=p.legendItem||{};if((p instanceof Vc||p instanceof yl)&&(p.color=((re=p.options)==null?void 0:re.legendSymbolColor)||T),O==null||O[b?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:de={}}=this,ne=de.color,{fillColor:ce,fillOpacity:ye,lineColor:Te,marker:De}=p.options,Oe=Be=>(!b&&(Be.fill&&(Be.fill=ne),Be.stroke&&(Be.stroke=ne)),Be);z==null||z.css(Wh(b?this.itemStyle:de)),j==null||j.attr(Oe({stroke:Te||p.color})),X&&X.attr(Oe(De&&X.isMarker?p.pointAttribs():{fill:p.color})),P==null||P.attr(Oe({fill:ce||p.color,"fill-opacity":ce?1:ye??.75}))}p.color=T,Pl(this,"afterColorizeItem",{item:p,visible:b})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(p){let{group:b,x:T=0,y:P=0}=p.legendItem||{},O=this.options,z=O.symbolPadding,j=!O.rtl,X=p.checkbox;if(b!=null&&b.element){let re={translateX:j?T:this.legendWidth-T-2*z-4,translateY:P};b[Hp(b.translateY)?"animate":"attr"](re,void 0,()=>{Pl(this,"afterPositionItem",{item:p})})}X&&(X.x=T,X.y=P)}destroyItem(p){let b=p.checkbox,T=p.legendItem||{};for(let P of["group","label","line","symbol"])T[P]&&(T[P]=T[P].destroy());b&&rd(b),p.legendItem=void 0}destroy(){for(let p of this.getAllItems())this.destroyItem(p);for(let p of["clipRect","up","down","pager","nav","box","title","group"])this[p]&&(this[p]=this[p].destroy());this.display=null}positionCheckboxes(){var O;let p,b=(O=this.group)==null?void 0:O.alignAttr,T=this.clipHeight||this.legendHeight,P=this.titleHeight;b&&(p=b.translateY,this.allItems.forEach(function(z){let j,X=z.checkbox;X&&(j=p+P+X.y+(this.scrollOffset||0)+3,Cg(X,{left:b.translateX+z.checkboxOffset+X.x-20+"px",top:j+"px",display:this.proximate||j>p-6&&j<p+T-6?"":"none"}))},this))}renderTitle(){let p=this.options,b=this.padding,T=p.title,P,O=0;T.text&&(this.title||(this.title=this.chart.renderer.label(T.text,b-3,b-4,void 0,void 0,void 0,p.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(T.style),this.title.add(this.group)),T.width||this.title.css({width:this.maxLegendWidth+"px"}),O=(P=this.title.getBBox()).height,this.offsetWidth=P.width,this.contentGroup.attr({translateY:O})),this.titleHeight=O}setText(p){let b=this.options;p.legendItem.label.attr({text:b.labelFormat?sc(b.labelFormat,p,this.chart):b.labelFormatter.call(p)})}renderItem(p){var ci;let b=p.legendItem=p.legendItem||{},T=this.chart,P=T.renderer,O=this.options,z=O.layout==="horizontal",j=this.symbolWidth,X=O.symbolPadding||0,re=this.itemStyle,de=this.itemHiddenStyle,ne=z?ih(O.itemDistance,20):0,ce=!O.rtl,ye=!p.series,Te=!ye&&p.series.drawLegendSymbol?p.series:p,De=Te.options,Oe=!!this.createCheckboxForItem&&De&&De.showCheckbox,Be=O.useHTML,Ke=p.options.className,st=b.label,Bt=j+X+ne+20*!!Oe;!st&&(b.group=P.g("legend-item").addClass("highcharts-"+Te.type+"-series highcharts-color-"+p.colorIndex+(Ke?" "+Ke:"")+(ye?" highcharts-series-"+p.index:"")).attr({zIndex:1}).add(this.scrollGroup),b.label=st=P.text("",ce?j+X:-X,this.baseline||0,Be),T.styledMode||st.css(Wh(p.visible?re:de)),st.attr({align:ce?"left":"right",zIndex:2}).add(b.group),!this.baseline&&(this.fontMetrics=P.fontMetrics(st),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,st.attr("y",this.baseline),this.symbolHeight=ih(O.symbolHeight,this.fontMetrics.f),O.squareSymbol&&(this.symbolWidth=ih(O.symbolWidth,Math.max(this.symbolHeight,16)),Bt=this.symbolWidth+X+ne+20*!!Oe,ce&&st.attr("x",this.symbolWidth+X))),Te.drawLegendSymbol(this,p),this.setItemEvents&&this.setItemEvents(p,st,Be)),Oe&&!p.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(p),this.colorizeItem(p,p.visible),(T.styledMode||!re.width)&&st.css({width:(O.itemWidth||this.widthOption||T.spacingBox.width)-Bt+"px"}),this.setText(p);let Ut=st.getBBox(),$t=((ci=this.fontMetrics)==null?void 0:ci.h)||0;p.itemWidth=p.checkboxOffset=O.itemWidth||b.labelWidth||Ut.width+Bt,this.maxItemWidth=Math.max(this.maxItemWidth,p.itemWidth),this.totalItemWidth+=p.itemWidth,this.itemHeight=p.itemHeight=Math.round(b.labelHeight||(Ut.height>1.5*$t?Ut.height:$t))}layoutItem(p){let b=this.options,T=this.padding,P=b.layout==="horizontal",O=p.itemHeight,z=this.itemMarginBottom,j=this.itemMarginTop,X=P?ih(b.itemDistance,20):0,re=this.maxLegendWidth,de=b.alignColumns&&this.totalItemWidth>re?this.maxItemWidth:p.itemWidth,ne=p.legendItem||{};P&&this.itemX-T+de>re&&(this.itemX=T,this.lastLineHeight&&(this.itemY+=j+this.lastLineHeight+z),this.lastLineHeight=0),this.lastItemY=j+this.itemY+z,this.lastLineHeight=Math.max(O,this.lastLineHeight),ne.x=this.itemX,ne.y=this.itemY,P?this.itemX+=de:(this.itemY+=j+O+z,this.lastLineHeight=O),this.offsetWidth=this.widthOption||Math.max((P?this.itemX-T-(p.checkbox?0:X):de)+T,this.offsetWidth)}getAllItems(){let p=[];return this.chart.series.forEach(function(b){var P;let T=b==null?void 0:b.options;b&&ih(T.showInLegend,!Hp(T.linkedTo)&&void 0,!0)&&(p=p.concat(((P=b.legendItem)==null?void 0:P.labels)||(T.legendType==="point"?b.data:b)))}),Pl(this,"afterGetAllItems",{allItems:p}),p}getAlignment(){let p=this.options;return this.proximate?p.align.charAt(0)+"tv":p.floating?"":p.align.charAt(0)+p.verticalAlign.charAt(0)+p.layout.charAt(0)}adjustMargins(p,b){let T=this.chart,P=this.options,O=this.getAlignment();O&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(z,j){z.test(O)&&!Hp(p[j])&&(T[im[j]]=Math.max(T[im[j]],T.legend[(j+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][j]*P[j%2?"x":"y"]+ih(P.margin,12)+b[j]+(T.titleOffset[j]||0)))})}proximatePositions(){let p,b=this.chart,T=[],P=this.options.align==="left";for(let O of(this.allItems.forEach(function(z){let j,X,re=P,de,ne;z.yAxis&&(z.xAxis.options.reversed&&(re=!re),z.points&&(j=wf(re?z.points:z.points.slice(0).reverse(),function(ce){return rm(ce.plotY)})),X=this.itemMarginTop+z.legendItem.label.getBBox().height+this.itemMarginBottom,ne=z.yAxis.top-b.plotTop,de=z.visible?(j?j.plotY:z.yAxis.height)+(ne-.3*X):ne+z.yAxis.height,T.push({target:de,size:X,item:z}))},this),id(T,b.plotHeight)))p=O.item.legendItem||{},rm(O.pos)&&(p.y=b.plotTop-b.spacing[0]+O.pos)}render(){let p=this.chart,b=p.renderer,T=this.options,P=this.padding,O=this.getAllItems(),z,j,X,re=this.group,de,ne=this.box;this.itemX=P,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=ay(T.width,p.spacingBox.width-P),de=p.spacingBox.width-2*P-T.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(de/=2),this.maxLegendWidth=this.widthOption||de,re||(this.group=re=b.g("legend").addClass(T.className||"").attr({zIndex:7}).add(),this.contentGroup=b.g().attr({zIndex:1}).add(re),this.scrollGroup=b.g().add(this.contentGroup)),this.renderTitle(),Id(O,(ce,ye)=>{var Te,De;return(((Te=ce.options)==null?void 0:Te.legendIndex)||0)-(((De=ye.options)==null?void 0:De.legendIndex)||0)}),T.reversed&&O.reverse(),this.allItems=O,this.display=z=!!O.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,O.forEach(this.renderItem,this),O.forEach(this.layoutItem,this),j=(this.widthOption||this.offsetWidth)+P,X=this.lastItemY+this.lastLineHeight+this.titleHeight,X=this.handleOverflow(X)+P,ne||(this.box=ne=b.rect().addClass("highcharts-legend-box").attr({r:T.borderRadius}).add(re)),p.styledMode||ne.attr({stroke:T.borderColor,"stroke-width":T.borderWidth||0,fill:T.backgroundColor||"none"}).shadow(T.shadow),j>0&&X>0&&ne[ne.placed?"animate":"attr"](ne.crisp.call({},{x:0,y:0,width:j,height:X},ne.strokeWidth())),re[z?"show":"hide"](),p.styledMode&&re.getStyle("display")==="none"&&(j=X=0),this.legendWidth=j,this.legendHeight=X,z&&this.align(),this.proximate||this.positionItems(),Pl(this,"afterRender")}align(p=this.chart.spacingBox){let b=this.chart,T=this.options,P=p.y;/(lth|ct|rth)/.test(this.getAlignment())&&b.titleOffset[0]>0?P+=b.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&b.titleOffset[2]>0&&(P-=b.titleOffset[2]),P!==p.y&&(p=Wh(p,{y:P})),b.hasRendered||(this.group.placed=!1),this.group.align(Wh(T,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":T.verticalAlign}),!0,p)}handleOverflow(p){let b=this,T=this.chart,P=T.renderer,O=this.options,z=O.y,j=O.verticalAlign==="top",X=this.padding,re=O.maxHeight,de=O.navigation,ne=ih(de.animation,!0),ce=de.arrowSize||12,ye=this.pages,Te=this.allItems,De=function(oi){typeof oi=="number"?ci.attr({height:oi}):ci&&(b.clipRect=ci.destroy(),b.contentGroup.clip()),b.contentGroup.div&&(b.contentGroup.div.style.clip=oi?"rect("+X+"px,9999px,"+(X+oi)+"px,0)":"auto")},Oe=function(oi){return b[oi]=P.circle(0,0,1.3*ce).translate(ce/2,ce/2).add($t),T.styledMode||b[oi].attr("fill","rgba(0,0,0,0.0001)"),b[oi]},Be,Ke,st,Bt,Ut=T.spacingBox.height+(j?-z:z)-X,$t=this.nav,ci=this.clipRect;return O.layout!=="horizontal"||O.verticalAlign==="middle"||O.floating||(Ut/=2),re&&(Ut=Math.min(Ut,re)),ye.length=0,p&&Ut>0&&p>Ut&&de.enabled!==!1?(this.clipHeight=Be=Math.max(Ut-20-this.titleHeight-X,0),this.currentPage=ih(this.currentPage,1),this.fullHeight=p,Te.forEach((oi,di)=>{let er=(st=oi.legendItem||{}).y||0,Vi=Math.round(st.label.getBBox().height),lr=ye.length;(!lr||er-ye[lr-1]>Be&&(Ke||er)!==ye[lr-1])&&(ye.push(Ke||er),lr++),st.pageIx=lr-1,Ke&&Bt&&(Bt.pageIx=lr-1),di===Te.length-1&&er+Vi-ye[lr-1]>Be&&er>ye[lr-1]&&(ye.push(er),st.pageIx=lr),er!==Ke&&(Ke=er),Bt=st}),ci||(ci=b.clipRect=P.clipRect(0,X-2,9999,0),b.contentGroup.clip(ci)),De(Be),$t||(this.nav=$t=P.g().attr({zIndex:1}).add(this.group),this.up=P.symbol("triangle",0,0,ce,ce).add($t),Oe("upTracker").on("click",function(){b.scroll(-1,ne)}),this.pager=P.text("",15,10).addClass("highcharts-legend-navigation"),!T.styledMode&&de.style&&this.pager.css(de.style),this.pager.add($t),this.down=P.symbol("triangle-down",0,0,ce,ce).add($t),Oe("downTracker").on("click",function(){b.scroll(1,ne)})),b.scroll(0),p=Ut):$t&&(De(),this.nav=$t.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),p}scroll(p,b){let T=this.chart,P=this.pages,O=P.length,z=this.clipHeight,j=this.options.navigation,X=this.pager,re=this.padding,de=this.currentPage+p;de>O&&(de=O),de>0&&(b!==void 0&&tm(b,T),this.nav.attr({translateX:re,translateY:z+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(ne){ne.attr({class:de===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),X.attr({text:de+"/"+O}),[this.down,this.downTracker].forEach(function(ne){ne.attr({x:18+this.pager.getBBox().width,class:de===O?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),T.styledMode||(this.up.attr({fill:de===1?j.inactiveColor:j.activeColor}),this.upTracker.css({cursor:de===1?"default":"pointer"}),this.down.attr({fill:de===O?j.inactiveColor:j.activeColor}),this.downTracker.css({cursor:de===O?"default":"pointer"})),this.scrollOffset=-P[de-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=de,this.positionCheckboxes(),Ac(()=>{Pl(this,"afterScroll",{currentPage:de})},em(ih(b,T.renderer.globalAnimation,!0)).duration))}setItemEvents(p,b,T){let P=this,O=p.legendItem||{},z=P.chart.renderer.boxWrapper,j=p instanceof yl,X=p instanceof Vc,re="highcharts-legend-"+(j?"point":"series")+"-active",de=P.chart.styledMode,ne=T?[b,O.symbol]:[O.group],ce=ye=>{P.allItems.forEach(Te=>{p!==Te&&[Te].concat(Te.linkedSeries||[]).forEach(De=>{De.setState(ye,!j)})})};for(let ye of ne)ye&&ye.on("mouseover",function(){p.visible&&ce("inactive"),p.setState("hover"),p.visible&&z.addClass(re),de||b.css(P.options.itemHoverStyle)}).on("mouseout",function(){P.chart.styledMode||b.css(Wh(p.visible?P.itemStyle:P.itemHiddenStyle)),ce(""),z.removeClass(re),p.setState()}).on("click",function(Te){let De=function(){p.setVisible&&p.setVisible(),ce(p.visible?"inactive":"")};z.removeClass(re),Pl(P,"itemClick",{browserEvent:Te,legendItem:p},De),j?p.firePointEvent("legendItemClick",{browserEvent:Te}):X&&Pl(p,"legendItemClick",{browserEvent:Te})})}createCheckboxForItem(p){p.checkbox=bf("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:p.selected,defaultChecked:p.selected},this.options.itemCheckboxStyle,this.chart.container),Wc(p.checkbox,"click",function(b){let T=b.target;Pl(p.series||p,"checkboxClick",{checked:T.checked,item:p},function(){p.select()})})}}(function(ie){ie.compose=function(p){Sf(Gd,"Core.Legend")&&Wc(p,"beforeMargins",function(){this.legend=new ie(this,this.options.legend)})}})(qd||(qd={}));let Eg=qd,{animate:Gp,animObject:Ld,setAnimation:Dd}=zr,{defaultOptions:Fm}=vi,{numberFormat:nm}=ba,{registerEventOptions:rh}=Vo,{charts:jh,doc:Pd,marginNames:sm,svg:zm,win:Du}=Je,{seriesTypes:Pu}=Ia,{addEvent:om,attr:Sa,createElement:kg,css:Ou,defined:qp,diffObjects:tu,discardElement:Ag,erase:am,error:gu,extend:Ru,find:yc,fireEvent:Gn,getAlignFactor:Um,getStyle:$m,isArray:bp,isNumber:Yp,isObject:nl,isString:nd,merge:Kl,objectEach:Mg,pick:_c,pInt:Xp,relativeLength:Vm,removeEvent:Tf,splat:Cf,syncTimeout:wp,uniqueKey:Ig}=Ht;class ya{static chart(p,b,T){return new ya(p,b,T)}constructor(p,b,T){this.sharedClips={};let P=[...arguments];(nd(p)||p.nodeName)&&(this.renderTo=P.shift()),this.init(P[0],P[1])}setZoomOptions(){let p=this.options.chart,b=p.zooming;this.zooming={...b,type:_c(p.zoomType,b.type),key:_c(p.zoomKey,b.key),pinchType:_c(p.pinchType,b.pinchType),singleTouch:_c(p.zoomBySingleTouch,b.singleTouch,!1),resetButton:Kl(b.resetButton,p.resetZoomButton)}}init(p,b){Gn(this,"init",{args:arguments},function(){var z;let T=Kl(Fm,p),P=T.chart,O=this.renderTo||P.renderTo;this.userOptions=Ru({},p),(this.renderTo=nd(O)?Pd.getElementById(O):O)||gu(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=b,this.isResizing=0,this.options=T,this.axes=[],this.series=[],this.locale=T.lang.locale??((z=this.renderTo.closest("[lang]"))==null?void 0:z.lang),this.time=new hl(Ru(T.time||{},{locale:this.locale}),T.lang),T.time=this.time.options,this.numberFormatter=(P.numberFormatter||nm).bind(this),this.styledMode=P.styledMode,this.hasCartesianSeries=P.showAxes,this.index=jh.length,jh.push(this),Je.chartCount++,rh(this,P),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Gn(this,"afterInit"),this.firstRender()})}initSeries(p){let b=this.options.chart,T=p.type||b.type,P=Pu[T];P||gu(17,!0,this,{missingModuleFor:T});let O=new P;return typeof O.init=="function"&&O.init(this,p),O}setSortedData(){this.getSeriesOrderByLinks().forEach(function(p){p.points||p.data||!p.enabledDataSorting||p.setData(p.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(p,b){return p.linkedSeries.length||b.linkedSeries.length?b.linkedSeries.length-p.linkedSeries.length:0})}orderItems(p,b=0){let T=this[p],P=this.options[p]=Cf(this.options[p]).slice(),O=this.userOptions[p]=this.userOptions[p]?Cf(this.userOptions[p]).slice():[];if(this.hasRendered&&(P.splice(b),O.splice(b)),T)for(let z=b,j=T.length;z<j;++z){let X=T[z];X&&(X.index=z,X instanceof Vc&&(X.name=X.getName()),X.options.isInternal||(P[z]=X.options,O[z]=X.userOptions))}}getClipBox(p,b){var de,ne;let T=this.inverted,{xAxis:P,yAxis:O}=p||{},{x:z,y:j,width:X,height:re}=Kl(this.clipBox);return p&&(P&&P.len!==this.plotSizeX&&(X=P.len),O&&O.len!==this.plotSizeY&&(re=O.len),T&&!p.invertible&&([X,re]=[re,X])),b&&(z+=((de=T?O:P)==null?void 0:de.pos)??this.plotLeft,j+=((ne=T?P:O)==null?void 0:ne.pos)??this.plotTop),{x:z,y:j,width:X,height:re}}isInsidePlot(p,b,T={}){var Oe;let{inverted:P,plotBox:O,plotLeft:z,plotTop:j,scrollablePlotBox:X}=this,{scrollLeft:re=0,scrollTop:de=0}=T.visiblePlotOnly&&((Oe=this.scrollablePlotArea)==null?void 0:Oe.scrollingContainer)||{},ne=T.series,ce=T.visiblePlotOnly&&X||O,ye=T.inverted?b:p,Te=T.inverted?p:b,De={x:ye,y:Te,isInsidePlot:!0,options:T};if(!T.ignoreX){let Be=ne&&(P&&!this.polar?ne.yAxis:ne.xAxis)||{pos:z,len:1/0},Ke=T.paneCoordinates?Be.pos+ye:z+ye;Ke>=Math.max(re+z,Be.pos)&&Ke<=Math.min(re+z+ce.width,Be.pos+Be.len)||(De.isInsidePlot=!1)}if(!T.ignoreY&&De.isInsidePlot){let Be=!P&&T.axis&&!T.axis.isXAxis&&T.axis||ne&&(P?ne.xAxis:ne.yAxis)||{pos:j,len:1/0},Ke=T.paneCoordinates?Be.pos+Te:j+Te;Ke>=Math.max(de+j,Be.pos)&&Ke<=Math.min(de+j+ce.height,Be.pos+Be.len)||(De.isInsidePlot=!1)}return Gn(this,"afterIsInsidePlot",De),De.isInsidePlot}redraw(p){Gn(this,"beforeRedraw");let b=this.hasCartesianSeries?this.axes:this.colorAxis||[],T=this.series,P=this.pointer,O=this.legend,z=this.userOptions.legend,j=this.renderer,X=j.isHidden(),re=[],de,ne,ce,ye=this.isDirtyBox,Te=this.isDirtyLegend,De;for(j.rootFontSize=j.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),Dd(!!this.hasRendered&&p,this),X&&this.temporaryDisplay(),this.layOutTitles(!1),ce=T.length;ce--;)if(((De=T[ce]).options.stacking||De.options.centerInCategory)&&(ne=!0,De.isDirty)){de=!0;break}if(de)for(ce=T.length;ce--;)(De=T[ce]).options.stacking&&(De.isDirty=!0);T.forEach(function(Oe){Oe.isDirty&&(Oe.options.legendType==="point"?(typeof Oe.updateTotals=="function"&&Oe.updateTotals(),Te=!0):z&&(z.labelFormatter||z.labelFormat)&&(Te=!0)),Oe.isDirtyData&&Gn(Oe,"updatedData")}),Te&&O&&O.options.enabled&&(O.render(),this.isDirtyLegend=!1),ne&&this.getStacks(),b.forEach(function(Oe){Oe.updateNames(),Oe.setScale()}),this.getMargins(),b.forEach(function(Oe){Oe.isDirty&&(ye=!0)}),b.forEach(function(Oe){let Be=Oe.min+","+Oe.max;Oe.extKey!==Be&&(Oe.extKey=Be,re.push(function(){Gn(Oe,"afterSetExtremes",Ru(Oe.eventArgs,Oe.getExtremes())),delete Oe.eventArgs})),(ye||ne)&&Oe.redraw()}),ye&&this.drawChartBox(),Gn(this,"predraw"),T.forEach(function(Oe){(ye||Oe.isDirty)&&Oe.visible&&Oe.redraw(),Oe.isDirtyData=!1}),P&&P.reset(!0),j.draw(),Gn(this,"redraw"),Gn(this,"render"),X&&this.temporaryDisplay(!0),re.forEach(function(Oe){Oe.call()})}get(p){let b=this.series;function T(O){return O.id===p||O.options&&O.options.id===p}let P=yc(this.axes,T)||yc(this.series,T);for(let O=0;!P&&O<b.length;O++)P=yc(b[O].points||[],T);return P}createAxes(){let p=this.userOptions;for(let b of(Gn(this,"createAxes"),["xAxis","yAxis"]))for(let T of p[b]=Cf(p[b]||{}))new wu(this,T,b);Gn(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((p,b)=>(b.getPointsCollection().forEach(T=>{_c(T.selectedStaging,T.selected)&&p.push(T)}),p),[])}getSelectedSeries(){return this.series.filter(p=>p.selected)}setTitle(p,b,T){this.applyDescription("title",p),this.applyDescription("subtitle",b),this.applyDescription("caption",void 0),this.layOutTitles(T)}applyDescription(p,b){var z;let T=this,P=this.options[p]=Kl(this.options[p],b),O=this[p];O&&b&&(this[p]=O=O.destroy()),P&&!O&&((O=this.renderer.text(P.text,0,0,P.useHTML).attr({align:P.align,class:"highcharts-"+p,zIndex:P.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(j,X){T.applyDescription(p,j),T.layOutTitles(X)},this.styledMode||O.css(Ru(p==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},P.style)),O.textPxLength=O.getBBox().width,O.css({whiteSpace:(z=P.style)==null?void 0:z.whiteSpace}),this[p]=O)}layOutTitles(p=!0){var j,X,re,de;let b=[0,0,0],{options:T,renderer:P,spacingBox:O}=this;["title","subtitle","caption"].forEach(ne=>{var Oe;let ce=this[ne],ye=this.options[ne],Te=Kl(O),De=(ce==null?void 0:ce.textPxLength)||0;if(ce&&ye){Gn(this,"layOutTitle",{alignTo:Te,key:ne,textPxLength:De});let Be=P.fontMetrics(ce),Ke=Be.b,st=Be.h,Bt=ye.verticalAlign||"top",Ut=Bt==="top",$t=Ut&&ye.minScale||1,ci=ne==="title"?Ut?-3:0:Ut?b[0]+2:0,oi=Math.min(Te.width/De,1),di=Math.max($t,oi),er=Kl({y:Bt==="bottom"?Ke:ci+Ke},{align:ne==="title"?oi<$t?"left":"center":(Oe=this.title)==null?void 0:Oe.alignValue},ye),Vi=(ye.width||(oi>$t?this.chartWidth:Te.width)/di)+"px";ce.alignValue!==er.align&&(ce.placed=!1);let lr=Math.round(ce.css({width:Vi}).getBBox(ye.useHTML).height);if(er.height=lr,ce.align(er,!1,Te).attr({align:er.align,scaleX:di,scaleY:di,"transform-origin":`${Te.x+De*di*Um(er.align)} ${st}`}),!ye.floating){let Vr=lr*(lr<1.2*st?1:di);Bt==="top"?b[0]=Math.ceil(b[0]+Vr):Bt==="bottom"&&(b[2]=Math.ceil(b[2]+Vr))}}},this),b[0]&&(((j=T.title)==null?void 0:j.verticalAlign)||"top")==="top"&&(b[0]+=((X=T.title)==null?void 0:X.margin)||0),b[2]&&((re=T.caption)==null?void 0:re.verticalAlign)==="bottom"&&(b[2]+=((de=T.caption)==null?void 0:de.margin)||0);let z=!this.titleOffset||this.titleOffset.join(",")!==b.join(",");this.titleOffset=b,Gn(this,"afterLayOutTitles"),!this.isDirtyBox&&z&&(this.isDirtyBox=this.isDirtyLegend=z,this.hasRendered&&p&&this.isDirtyBox&&this.redraw())}getContainerBox(){let p=[].map.call(this.renderTo.children,T=>{if(T!==this.container){let P=T.style.display;return T.style.display="none",[T,P]}}),b={width:$m(this.renderTo,"width",!0)||0,height:$m(this.renderTo,"height",!0)||0};return p.filter(Boolean).forEach(([T,P])=>{T.style.display=P}),b}getChartSize(){var z;let p=this.options.chart,b=p.width,T=p.height,P=this.getContainerBox(),O=P.height<=1||!((z=this.renderTo.parentElement)!=null&&z.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,b||P.width||600),this.chartHeight=Math.max(0,Vm(T,this.chartWidth)||(O?400:P.height)),this.containerBox=P}temporaryDisplay(p){let b=this.renderTo,T;if(p)for(;b!=null&&b.style;)b.hcOrigStyle&&(Ou(b,b.hcOrigStyle),delete b.hcOrigStyle),b.hcOrigDetached&&(Pd.body.removeChild(b),b.hcOrigDetached=!1),b=b.parentNode;else for(;b!=null&&b.style&&(Pd.body.contains(b)||b.parentNode||(b.hcOrigDetached=!0,Pd.body.appendChild(b)),($m(b,"display",!1)==="none"||b.hcOricDetached)&&(b.hcOrigStyle={display:b.style.display,height:b.style.height,overflow:b.style.overflow},T={display:"block",overflow:"hidden"},b!==this.renderTo&&(T.height=0),Ou(b,T),b.offsetWidth||b.style.setProperty("display","block","important")),(b=b.parentNode)!==Pd.body););}setClassName(p){this.container.className="highcharts-container "+(p||"")}getContainer(){var ce,ye;let p,b=this.options,T=b.chart,P="data-highcharts-chart",O=Ig(),z=this.renderTo,j=Xp(Sa(z,P));Yp(j)&&jh[j]&&jh[j].hasRendered&&jh[j].destroy(),Sa(z,P,this.index),z.innerHTML=la.emptyHTML,T.skipClone||z.offsetWidth||this.temporaryDisplay(),this.getChartSize();let X=this.chartHeight,re=this.chartWidth;Ou(z,{overflow:"hidden"}),this.styledMode||(p=Ru({position:"relative",overflow:"hidden",width:re+"px",height:X+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},T.style||{}));let de=kg("div",{id:O},p,z);this.container=de,this.getChartSize(),re!==this.chartWidth&&(re=this.chartWidth,this.styledMode||Ou(de,{width:_c((ce=T.style)==null?void 0:ce.width,re+"px")})),this.containerBox=this.getContainerBox(),this._cursor=de.style.cursor;let ne=T.renderer||!zm?ca.getRendererType(T.renderer):or;if(this.renderer=new ne(de,re,X,void 0,T.forExport,(ye=b.exporting)==null?void 0:ye.allowHTML,this.styledMode),Dd(void 0,this),this.setClassName(T.className),this.styledMode)for(let Te in b.defs)this.renderer.definition(b.defs[Te]);else this.renderer.setStyle(T.style);this.renderer.chartIndex=this.index,Gn(this,"afterGetContainer")}getMargins(p){var O;let{spacing:b,margin:T,titleOffset:P}=this;this.resetMargins(),P[0]&&!qp(T[0])&&(this.plotTop=Math.max(this.plotTop,P[0]+b[0])),P[2]&&!qp(T[2])&&(this.marginBottom=Math.max(this.marginBottom,P[2]+b[2])),(O=this.legend)!=null&&O.display&&this.legend.adjustMargins(T,b),Gn(this,"getMargins"),p||this.getAxisMargins()}getAxisMargins(){let p=this,b=p.axisOffset=[0,0,0,0],T=p.colorAxis,P=p.margin,O=function(z){z.forEach(function(j){j.visible&&j.getOffset()})};p.hasCartesianSeries?O(p.axes):T!=null&&T.length&&O(T),sm.forEach(function(z,j){qp(P[j])||(p[z]+=b[j])}),p.setChartSize()}getOptions(){return tu(this.userOptions,Fm)}reflow(p){var O,z;let b=this,T=b.containerBox,P=b.getContainerBox();(O=b.pointer)==null||delete O.chartPosition,!((z=b.exporting)!=null&&z.isPrinting)&&!b.isResizing&&T&&P.width&&((P.width!==T.width||P.height!==T.height)&&(Ht.clearTimeout(b.reflowTimeout),b.reflowTimeout=wp(function(){b.container&&b.setSize(void 0,void 0,!1)},100*!!p)),b.containerBox=P)}setReflow(){let p=this,b=T=>{var P;(P=p.options)!=null&&P.chart.reflow&&p.hasLoaded&&p.reflow(T)};if(typeof ResizeObserver=="function")new ResizeObserver(b).observe(p.renderTo);else{let T=om(Du,"resize",b);om(this,"destroy",T)}}setSize(p,b,T){let P=this,O=P.renderer;P.isResizing+=1,Dd(T,P);let z=O.globalAnimation;P.oldChartHeight=P.chartHeight,P.oldChartWidth=P.chartWidth,p!==void 0&&(P.options.chart.width=p),b!==void 0&&(P.options.chart.height=b),P.getChartSize();let{chartWidth:j,chartHeight:X,scrollablePixelsX:re=0,scrollablePixelsY:de=0}=P;(P.isDirtyBox||j!==P.oldChartWidth||X!==P.oldChartHeight)&&(P.styledMode||(z?Gp:Ou)(P.container,{width:`${j+re}px`,height:`${X+de}px`},z),P.setChartSize(!0),O.setSize(j,X,z),P.axes.forEach(function(ne){ne.isDirty=!0,ne.setScale()}),P.isDirtyLegend=!0,P.isDirtyBox=!0,P.layOutTitles(),P.getMargins(),P.redraw(z),P.oldChartHeight=void 0,Gn(P,"resize"),setTimeout(()=>{P&&Gn(P,"endResize")},Ld(z).duration)),P.isResizing-=1}setChartSize(p){let b,T,P,O,{chartHeight:z,chartWidth:j,inverted:X,spacing:re,renderer:de}=this,ne=this.clipOffset,ce=Math[X?"floor":"round"];this.plotLeft=b=Math.round(this.plotLeft),this.plotTop=T=Math.round(this.plotTop),this.plotWidth=P=Math.max(0,Math.round(j-b-(this.marginRight??0))),this.plotHeight=O=Math.max(0,Math.round(z-T-(this.marginBottom??0))),this.plotSizeX=X?O:P,this.plotSizeY=X?P:O,this.spacingBox=de.spacingBox={x:re[3],y:re[0],width:j-re[3]-re[1],height:z-re[0]-re[2]},this.plotBox=de.plotBox={x:b,y:T,width:P,height:O},ne&&(this.clipBox={x:ce(ne[3]),y:ce(ne[0]),width:ce(this.plotSizeX-ne[1]-ne[3]),height:ce(this.plotSizeY-ne[0]-ne[2])}),p||(this.axes.forEach(function(ye){ye.setAxisSize(),ye.setAxisTranslation()}),de.alignElements()),Gn(this,"afterSetChartSize",{skipAxes:p})}resetMargins(){Gn(this,"resetMargins");let p=this,b=p.options.chart,T=b.plotBorderWidth||0,P=Math.round(T)/2;["margin","spacing"].forEach(function(O){let z=b[O],j=nl(z)?z:[z,z,z,z];["Top","Right","Bottom","Left"].forEach(function(X,re){p[O][re]=_c(b[O+X],j[re])})}),sm.forEach(function(O,z){p[O]=_c(p.margin[z],p.spacing[z])}),p.axisOffset=[0,0,0,0],p.clipOffset=[P,P,P,P],p.plotBorderWidth=T}drawChartBox(){let p=this.options.chart,b=this.renderer,T=this.chartWidth,P=this.chartHeight,O=this.styledMode,z=this.plotBGImage,j=p.backgroundColor,X=p.plotBackgroundColor,re=p.plotBackgroundImage,de=this.plotLeft,ne=this.plotTop,ce=this.plotWidth,ye=this.plotHeight,Te=this.plotBox,De=this.clipRect,Oe=this.clipBox,Be=this.chartBackground,Ke=this.plotBackground,st=this.plotBorder,Bt,Ut,$t,ci="animate";Be||(this.chartBackground=Be=b.rect().addClass("highcharts-background").add(),ci="attr"),O?Bt=Ut=Be.strokeWidth():(Ut=(Bt=p.borderWidth||0)+8*!!p.shadow,$t={fill:j||"none"},(Bt||Be["stroke-width"])&&($t.stroke=p.borderColor,$t["stroke-width"]=Bt),Be.attr($t).shadow(p.shadow)),Be[ci]({x:Ut/2,y:Ut/2,width:T-Ut-Bt%2,height:P-Ut-Bt%2,r:p.borderRadius}),ci="animate",Ke||(ci="attr",this.plotBackground=Ke=b.rect().addClass("highcharts-plot-background").add()),Ke[ci](Te),!O&&(Ke.attr({fill:X||"none"}).shadow(p.plotShadow),re&&(z?(re!==z.attr("href")&&z.attr("href",re),z.animate(Te)):this.plotBGImage=b.image(re,de,ne,ce,ye).add())),De?De.animate({width:Oe.width,height:Oe.height}):this.clipRect=b.clipRect(Oe),ci="animate",st||(ci="attr",this.plotBorder=st=b.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),O||st.attr({stroke:p.plotBorderColor,"stroke-width":p.plotBorderWidth||0,fill:"none"}),st[ci](st.crisp(Te,-st.strokeWidth())),this.isDirtyBox=!1,Gn(this,"afterDrawChartBox")}propFromSeries(){let p,b,T,P=this,O=P.options.chart,z=P.options.series;["inverted","angular","polar"].forEach(function(j){for(b=Pu[O.type],T=O[j]||b&&b.prototype[j],p=z==null?void 0:z.length;!T&&p--;)(b=Pu[z[p].type])&&b.prototype[j]&&(T=!0);P[j]=T})}linkSeries(p){let b=this,T=b.series;T.forEach(function(P){P.linkedSeries.length=0}),T.forEach(function(P){let{linkedTo:O}=P.options;if(nd(O)){let z;(z=O===":previous"?b.series[P.index-1]:b.get(O))&&z.linkedParent!==P&&(z.linkedSeries.push(P),P.linkedParent=z,z.enabledDataSorting&&P.setDataSortingOptions(),P.visible=_c(P.options.visible,z.options.visible,P.visible))}}),Gn(this,"afterLinkSeries",{isUpdating:p})}renderSeries(){this.series.forEach(function(p){p.translate(),p.render()})}render(){var de;let p=this.axes,b=this.colorAxis,T=this.renderer,P=this.options.chart.axisLayoutRuns||2,O=ne=>{ne.forEach(ce=>{ce.visible&&ce.render()})},z=0,j=!0,X,re=0;for(let ne of(this.setTitle(),Gn(this,"beforeMargins"),(de=this.getStacks)==null||de.call(this),this.getMargins(!0),this.setChartSize(),p)){let{options:ce}=ne,{labels:ye}=ce;if(this.hasCartesianSeries&&ne.horiz&&ne.visible&&ye.enabled&&ne.series.length&&ne.coll!=="colorAxis"&&!this.polar){z=ce.tickLength,ne.createGroups();let Te=new uo(ne,0,"",!0),De=Te.createLabel("x",ye);if(Te.destroy(),De&&_c(ye.reserveSpace,!Yp(ce.crossing))&&(z=De.getBBox().height+ye.distance+Math.max(ce.offset||0,0)),z){De==null||De.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-z,0);(j||X||P>1)&&re<P;){let ne=this.plotWidth,ce=this.plotHeight;for(let ye of p)re===0?ye.setScale():(ye.horiz&&j||!ye.horiz&&X)&&ye.setTickInterval(!0);re===0?this.getAxisMargins():this.getMargins(),j=ne/this.plotWidth>(re?1:1.1),X=ce/this.plotHeight>(re?1:1.05),re++}this.drawChartBox(),this.hasCartesianSeries?O(p):b!=null&&b.length&&O(b),this.seriesGroup||(this.seriesGroup=T.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.dataLabelsGroup||(this.dataLabelsGroup=T.g("datalabels-group").attr({zIndex:6}).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(p){let b=this,T=Kl(!0,this.options.credits,p);T.enabled&&!this.credits&&(this.credits=this.renderer.text(T.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){T.href&&(Du.location.href=T.href)}).attr({align:T.position.align,zIndex:8}),b.styledMode||this.credits.css(T.style),this.credits.add().align(T.position),this.credits.update=function(P){b.credits=b.credits.destroy(),b.addCredits(P)})}destroy(){var j,X;let p,b=this,T=b.axes,P=b.series,O=b.container,z=O==null?void 0:O.parentNode;for(Gn(b,"destroy"),b.renderer.forExport?am(jh,b):jh[b.index]=void 0,Je.chartCount--,b.renderTo.removeAttribute("data-highcharts-chart"),Tf(b),p=T.length;p--;)T[p]=T[p].destroy();for((X=(j=this.scroller)==null?void 0:j.destroy)==null||X.call(j),p=P.length;p--;)P[p]=P[p].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(re=>{var de,ne;b[re]=(ne=(de=b[re])==null?void 0:de.destroy)==null?void 0:ne.call(de)}),O&&(O.innerHTML=la.emptyHTML,Tf(O),z&&Ag(O)),Mg(b,function(re,de){delete b[de]})}firstRender(){var P;let p=this,b=p.options;p.getContainer(),p.resetMargins(),p.setChartSize(),p.propFromSeries(),p.createAxes();let T=bp(b.series)?b.series:[];b.series=[],T.forEach(function(O){p.initSeries(O)}),p.linkSeries(),p.setSortedData(),Gn(p,"beforeRender"),p.render(),(P=p.pointer)==null||P.getChartPosition(),p.renderer.imgCount||p.hasLoaded||p.onload(),p.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(p){p&&this.index!==void 0&&p.apply(this,[this])},this),Gn(this,"load"),Gn(this,"render"),qp(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:p,title:b}=this;p&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":((b==null?void 0:b.element.textContent)||"").replace(/</g,"&lt;")}),p.accessibility&&p.accessibility.enabled===!1||gu('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(p,b,T){let P,O=this;return p&&(b=_c(b,!0),Gn(O,"addSeries",{options:p},function(){P=O.initSeries(p),O.isDirtyLegend=!0,O.linkSeries(),P.enabledDataSorting&&P.setData(p.data,!1),Gn(O,"afterAddSeries",{series:P}),b&&O.redraw(T)})),P}addAxis(p,b,T,P){return this.createAxis(b?"xAxis":"yAxis",{axis:p,redraw:T,animation:P})}addColorAxis(p,b,T){return this.createAxis("colorAxis",{axis:p,redraw:b,animation:T})}createAxis(p,b){let T=new wu(this,b.axis,p);return _c(b.redraw,!0)&&this.redraw(b.animation),T}showLoading(p){let b=this,T=b.options,P=T.loading,O=function(){z&&Ou(z,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})},z=b.loadingDiv,j=b.loadingSpan;z||(b.loadingDiv=z=kg("div",{className:"highcharts-loading highcharts-loading-hidden"},null,b.container)),j||(b.loadingSpan=j=kg("span",{className:"highcharts-loading-inner"},null,z),om(b,"redraw",O)),z.className="highcharts-loading",la.setElementHTML(j,_c(p,T.lang.loading,"")),!b.styledMode&&(Ou(z,Ru(P.style,{zIndex:10})),Ou(j,P.labelStyle),b.loadingShown||(Ou(z,{opacity:0,display:""}),Gp(z,{opacity:P.style.opacity||.5},{duration:P.showDuration||0}))),b.loadingShown=!0,O()}hideLoading(){let p=this.options,b=this.loadingDiv;b&&(b.className="highcharts-loading highcharts-loading-hidden",this.styledMode||Gp(b,{opacity:0},{duration:p.loading.hideDuration||100,complete:function(){Ou(b,{display:"none"})}})),this.loadingShown=!1}update(p,b,T,P){let O,z,j,X=this,re={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},de=p.isResponsiveOptions,ne=[];Gn(X,"update",{options:p}),de||X.setResponsive(!1,!0),p=tu(p,X.options),X.userOptions=Kl(X.userOptions,p);let ce=p.chart;ce&&(Kl(!0,X.options.chart,ce),this.setZoomOptions(),"className"in ce&&X.setClassName(ce.className),("inverted"in ce||"polar"in ce||"type"in ce)&&(X.propFromSeries(),O=!0),"alignTicks"in ce&&(O=!0),"events"in ce&&rh(this,ce),Mg(ce,function(De,Oe){X.propsRequireUpdateSeries.indexOf("chart."+Oe)!==-1&&(z=!0),X.propsRequireDirtyBox.indexOf(Oe)!==-1&&(X.isDirtyBox=!0),X.propsRequireReflow.indexOf(Oe)!==-1&&(X.isDirtyBox=!0,de||(j=!0))}),!X.styledMode&&ce.style&&X.renderer.setStyle(X.options.chart.style||{})),!X.styledMode&&p.colors&&(this.options.colors=p.colors),Mg(p,function(De,Oe){X[Oe]&&typeof X[Oe].update=="function"?X[Oe].update(De,!1):typeof X[re[Oe]]=="function"?X[re[Oe]](De):Oe!=="colors"&&X.collectionsWithUpdate.indexOf(Oe)===-1&&Kl(!0,X.options[Oe],p[Oe]),Oe!=="chart"&&X.propsRequireUpdateSeries.indexOf(Oe)!==-1&&(z=!0)}),this.collectionsWithUpdate.forEach(function(De){p[De]&&(Cf(p[De]).forEach(function(Oe,Be){let Ke,st=qp(Oe.id);st&&(Ke=X.get(Oe.id)),!Ke&&X[De]&&(Ke=X[De][_c(Oe.index,Be)])&&(st&&qp(Ke.options.id)||Ke.options.isInternal)&&(Ke=void 0),Ke&&Ke.coll===De&&(Ke.update(Oe,!1),T&&(Ke.touched=!0)),!Ke&&T&&X.collectionsWithInit[De]&&(X.collectionsWithInit[De][0].apply(X,[Oe].concat(X.collectionsWithInit[De][1]||[]).concat([!1])).touched=!0)}),T&&X[De].forEach(function(Oe){Oe.touched||Oe.options.isInternal?delete Oe.touched:ne.push(Oe)}))}),ne.forEach(function(De){De.chart&&De.remove&&De.remove(!1)}),O&&X.axes.forEach(function(De){De.update({},!1)}),z&&X.getSeriesOrderByLinks().forEach(function(De){De.chart&&De.update({},!1)},this);let ye=ce==null?void 0:ce.width,Te=ce&&(nd(ce.height)?Vm(ce.height,ye||X.chartWidth):ce.height);j||Yp(ye)&&ye!==X.chartWidth||Yp(Te)&&Te!==X.chartHeight?X.setSize(ye,Te,P):_c(b,!0)&&X.redraw(P),Gn(X,"afterUpdate",{options:p,redraw:b,animation:P})}setSubtitle(p,b){this.applyDescription("subtitle",p),this.layOutTitles(b)}setCaption(p,b){this.applyDescription("caption",p),this.layOutTitles(b)}showResetZoom(){let p=this,b=Fm.lang,T=p.zooming.resetButton,P=T.theme,O=T.relativeTo==="chart"||T.relativeTo==="spacingBox"?null:"plotBox";function z(){p.zoomOut()}Gn(this,"beforeShowResetZoom",null,function(){p.resetZoomButton=p.renderer.button(b.resetZoom,null,null,z,P).attr({align:T.position.align,title:b.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(T.position,!1,O)}),Gn(this,"afterShowResetZoom")}zoomOut(){Gn(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(p,b){let T=this,P=typeof b=="object"?b:{enabled:b,type:"x"},O=P.type,z=O&&T[{x:"xAxis",xy:"axes",y:"yAxis"}[O]].filter(X=>X.options.panningEnabled&&!X.options.isInternal),j=T.options.chart;j!=null&&j.panning&&(j.panning=P),Gn(this,"pan",{originalEvent:p},()=>{T.transform({axes:z,event:p,to:{x:p.chartX-(T.mouseDownX||0),y:p.chartY-(T.mouseDownY||0)},trigger:"pan"}),Ou(T.container,{cursor:"move"})})}transform(p){var Te;let{axes:b=this.axes,event:T,from:P={},reset:O,selection:z,to:j={},trigger:X}=p,{inverted:re,time:de}=this;(Te=this.hoverPoints)==null||Te.forEach(De=>De.setState()),Gn(this,"transform",p);let ne=p.hasZoomed||!1,ce,ye;for(let De of b){let{horiz:Oe,len:Be,minPointOffset:Ke=0,options:st,reversed:Bt}=De,Ut=Oe?"width":"height",$t=Oe?"x":"y",ci=_c(j[Ut],De.len),oi=_c(P[Ut],De.len),di=10>Math.abs(ci)?1:ci/oi,er=(P[$t]||0)+oi/2-De.pos,Vi=er-((j[$t]??De.pos)+ci/2-De.pos)/di,lr=Bt&&!re||!Bt&&re?-1:1;if(!O&&(er<0||er>De.len))continue;let Vr=De.chart.polar||De.isOrdinal?0:Ke*lr||0,Wn=De.toValue(Vi,!0),xn=De.toValue(Vi+Be/di,!0),Nn=Wn+Vr,Bn=xn-Vr,Xn=De.allExtremes;if(z&&z[De.coll].push({axis:De,min:Math.min(Wn,xn),max:Math.max(Wn,xn)}),Nn>Bn&&([Nn,Bn]=[Bn,Nn]),di===1&&!O&&De.coll==="yAxis"&&!Xn){for(let pd of De.series){let Hc=pd.getExtremes(pd.getProcessedData(!0).modified.getColumn("y")||[],!0);Xn??(Xn={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Yp(Hc.dataMin)&&Yp(Hc.dataMax)&&(Xn.dataMin=Math.min(Hc.dataMin,Xn.dataMin),Xn.dataMax=Math.max(Hc.dataMax,Xn.dataMax))}De.allExtremes=Xn}let{dataMin:es,dataMax:ns,min:Qs,max:Nl}=Ru(De.getExtremes(),Xn||{}),Uo=de.parse(st.min),jo=de.parse(st.max),mo=es??Uo,io=ns??jo,vc=Bn-Nn,El=De.categories?0:Math.min(vc,io-mo),fc=mo-El*(qp(Uo)?0:st.minPadding),au=io+El*(qp(jo)?0:st.maxPadding),Ey=De.allowZoomOutside||di===1||X!=="zoom"&&di>1,gm=Math.min(Uo??fc,fc,Ey?Qs:fc),dd=Math.max(jo??au,au,Ey?Nl:au);(!De.isOrdinal||di!==1||O)&&(Nn<gm&&(Nn=gm,di>=1&&(Bn=Nn+vc)),Bn>dd&&(Bn=dd,di>=1&&(Nn=Bn-vc)),(O||De.series.length&&(Nn!==Qs||Bn!==Nl)&&Nn>=gm&&Bn<=dd)&&(z?z[De.coll].push({axis:De,min:Nn,max:Bn}):(De.isPanning=X!=="zoom",De.isPanning&&(ye=!0),De.setExtremes(O?void 0:Nn,O?void 0:Bn,!1,!1,{move:Vi,trigger:X,scale:di}),!O&&(Nn>gm||Bn<dd)&&X!=="mousewheel"&&(ce=!0)),ne=!0),this.hasCartesianSeries||O||X==="mousewheel"||(ce=!0),T&&(this[Oe?"mouseDownX":"mouseDownY"]=T[Oe?"chartX":"chartY"]))}return ne&&(z?Gn(this,"selection",z,()=>{delete p.selection,p.trigger="zoom",this.transform(p)}):(!ce||ye||this.resetZoomButton?!ce&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(X==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),ne}}Ru(ya.prototype,{callbacks:[],collectionsWithInit:{xAxis:[ya.prototype.addAxis,[!0]],yAxis:[ya.prototype.addAxis,[!1]],series:[ya.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let Ql=ya,{stop:Yd}=zr,{composed:ly}=Je,{addEvent:Xd,createElement:cy,css:Zp,defined:Zd,erase:sd,merge:Kd,pushUnique:Lg}=Ht;function Dg(){let ie=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!ie&&(this.scrollablePlotArea=ie=new Nu(this)),ie==null||ie.applyFixed()}function lm(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class Nu{static compose(p,b,T){Lg(ly,this.compose)&&(Xd(p,"afterInit",lm),Xd(b,"afterSetChartSize",P=>this.afterSetSize(P.target,P)),Xd(b,"render",Dg),Xd(T,"show",lm))}static afterSetSize(p,b){let T,P,O,{minWidth:z,minHeight:j}=p.options.chart.scrollablePlotArea||{},{clipBox:X,plotBox:re,inverted:de,renderer:ne}=p;if(!ne.forExport&&(z?(p.scrollablePixelsX=T=Math.max(0,z-p.chartWidth),T&&(p.scrollablePlotBox=Kd(p.plotBox),re.width=p.plotWidth+=T,X[de?"height":"width"]+=T,O=!0)):j&&(p.scrollablePixelsY=P=Math.max(0,j-p.chartHeight),Zd(P)&&(p.scrollablePlotBox=Kd(p.plotBox),re.height=p.plotHeight+=P,X[de?"width":"height"]+=P,O=!1)),Zd(O)&&!b.skipAxes))for(let ce of p.axes)(ce.horiz===O||p.hasParallelCoordinates&&ce.coll==="yAxis")&&(ce.setAxisSize(),ce.setAxisTranslation())}constructor(p){var ye;let b,T=p.options.chart,P=ca.getRendererType(),O=T.scrollablePlotArea||{},z=this.moveFixedElements.bind(this),j={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};p.scrollablePixelsX&&(j.overflowX="auto"),p.scrollablePixelsY&&(j.overflowY="auto"),this.chart=p;let X=this.parentDiv=cy("div",{className:"highcharts-scrolling-parent"},{position:"relative"},p.renderTo),re=this.scrollingContainer=cy("div",{className:"highcharts-scrolling"},j,X),de=this.innerContainer=cy("div",{className:"highcharts-inner-container"},void 0,re),ne=this.fixedDiv=cy("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((ye=T.style)==null?void 0:ye.zIndex)||0)+2,top:0},void 0,!0),ce=this.fixedRenderer=new P(ne,p.chartWidth,p.chartHeight,T.style);this.mask=ce.path().attr({fill:T.backgroundColor||"#fff","fill-opacity":O.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),re.parentNode.insertBefore(ne,re),Zp(p.renderTo,{overflow:"visible"}),Xd(p,"afterShowResetZoom",z),Xd(p,"afterApplyDrilldown",z),Xd(p,"afterLayOutTitles",z),Xd(re,"scroll",()=>{let{pointer:Te,hoverPoint:De}=p;Te&&(delete Te.chartPosition,De&&(b=De),Te.runPointActions(void 0,b,!0))}),de.appendChild(p.container)}applyFixed(){var er;let{chart:p,fixedRenderer:b,isDirty:T,scrollingContainer:P}=this,{axisOffset:O,chartWidth:z,chartHeight:j,container:X,plotHeight:re,plotLeft:de,plotTop:ne,plotWidth:ce,scrollablePixelsX:ye=0,scrollablePixelsY:Te=0}=p,{scrollPositionX:De=0,scrollPositionY:Oe=0}=p.options.chart.scrollablePlotArea||{},Be=z+ye,Ke=j+Te;b.setSize(z,j),(T??!0)&&(this.isDirty=!1,this.moveFixedElements()),Yd(p.container),Zp(X,{width:`${Be}px`,height:`${Ke}px`}),p.renderer.boxWrapper.attr({width:Be,height:Ke,viewBox:[0,0,Be,Ke].join(" ")}),(er=p.chartBackground)==null||er.attr({width:Be,height:Ke}),Zp(P,{width:`${z}px`,height:`${j}px`}),Zd(T)||(P.scrollLeft=ye*De,P.scrollTop=Te*Oe);let st=ne-O[0]-1,Bt=de-O[3]-1,Ut=ne+re+O[2]+1,$t=de+ce+O[1]+1,ci=de+ce-ye,oi=ne+re-Te,di=[["M",0,0]];ye?di=[["M",0,st],["L",de-1,st],["L",de-1,Ut],["L",0,Ut],["Z"],["M",ci,st],["L",z,st],["L",z,Ut],["L",ci,Ut],["Z"]]:Te&&(di=[["M",Bt,0],["L",Bt,ne-1],["L",$t,ne-1],["L",$t,0],["Z"],["M",Bt,oi],["L",Bt,j],["L",$t,j],["L",$t,oi],["Z"]]),p.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:di})}moveFixedElements(){let p,{container:b,inverted:T,scrollablePixelsX:P,scrollablePixelsY:O}=this.chart,z=this.fixedRenderer,j=Nu.fixedSelectors;if(P&&!T?p=".highcharts-yaxis":P&&T||O&&!T?p=".highcharts-xaxis":O&&T&&(p=".highcharts-yaxis"),p&&!(this.chart.hasParallelCoordinates&&p===".highcharts-yaxis"))for(let X of[`${p}:not(.highcharts-radial-axis)`,`${p}-labels:not(.highcharts-radial-axis-labels)`])Lg(j,X);else for(let X of[".highcharts-xaxis",".highcharts-yaxis"])for(let re of[`${X}:not(.highcharts-radial-axis)`,`${X}-labels:not(.highcharts-radial-axis-labels)`])sd(j,re);for(let X of j)[].forEach.call(b.querySelectorAll(X),re=>{(re.namespaceURI===z.SVG_NS?z.box:z.box.parentNode).appendChild(re),re.style.pointerEvents="auto"})}}Nu.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:iu}=ba,{series:Bu}=Ia,{destroyObjectProperties:Wm,fireEvent:g,getAlignFactor:o,isNumber:h,pick:y}=Ht,C=class{constructor(ie,p,b,T,P){let O=ie.chart.inverted,z=ie.reversed;this.axis=ie;let j=this.isNegative=!!b!=!!z;this.options=p=p||{},this.x=T,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=P,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:p.align||(O?j?"left":"right":"center"),verticalAlign:p.verticalAlign||(O?"middle":j?"bottom":"top"),y:p.y,x:p.x},this.textAlign=p.textAlign||(O?j?"right":"left":"center")}destroy(){Wm(this,this.axis)}render(ie){let p=this.axis.chart,b=this.options,T=b.format,P=T?iu(T,this,p):b.formatter.call(this);if(this.label)this.label.attr({text:P,visibility:"hidden"});else{this.label=p.renderer.label(P,null,void 0,b.shape,void 0,void 0,b.useHTML,!1,"stack-labels");let O={r:b.borderRadius||0,text:P,padding:y(b.padding,5),visibility:"hidden"};p.styledMode||(O.fill=b.backgroundColor,O.stroke=b.borderColor,O["stroke-width"]=b.borderWidth,this.label.css(b.style||{})),this.label.attr(O),this.label.added||this.label.add(ie)}this.label.labelrank=p.plotSizeY,g(this,"afterRender")}setOffset(ie,p,b,T,P,O){let{alignOptions:z,axis:j,label:X,options:re,textAlign:de}=this,ne=j.chart,ce=this.getStackBox({xOffset:ie,width:p,boxBottom:b,boxTop:T,defaultX:P,xAxis:O}),{verticalAlign:ye}=z;if(X&&ce){let Te=X.getBBox(void 0,0),De=X.padding,Oe=y(re.overflow,"justify")==="justify",Be;z.x=re.x||0,z.y=re.y||0;let{x:Ke,y:st}=this.adjustStackPosition({labelBox:Te,verticalAlign:ye,textAlign:de});ce.x-=Ke,ce.y-=st,X.align(z,!1,ce),(Be=ne.isInsidePlot(X.alignAttr.x+z.x+Ke,X.alignAttr.y+z.y+st))||(Oe=!1),Oe&&Bu.prototype.justifyDataLabel.call(j,X,z,X.alignAttr,Te,ce),X.attr({x:X.alignAttr.x,y:X.alignAttr.y,rotation:re.rotation,rotationOriginX:Te.width*o(re.textAlign||"center"),rotationOriginY:Te.height/2}),y(!Oe&&re.crop,!0)&&(Be=h(X.x)&&h(X.y)&&ne.isInsidePlot(X.x-De+(X.width||0),X.y)&&ne.isInsidePlot(X.x+De,X.y)),X[Be?"show":"hide"]()}g(this,"afterSetOffset",{xOffset:ie,width:p})}adjustStackPosition({labelBox:ie,verticalAlign:p,textAlign:b}){return{x:ie.width/2+ie.width/2*(2*o(b)-1),y:ie.height/2*2*(1-o(p))}}getStackBox(ie){let p=this.axis,b=p.chart,{boxTop:T,defaultX:P,xOffset:O,width:z,boxBottom:j}=ie,X=p.stacking.usePercentage?100:y(T,this.total,0),re=p.toPixels(X),de=ie.xAxis||b.xAxis[0],ne=y(P,de.translate(this.x))+O,ce=Math.abs(re-p.toPixels(j||h(p.min)&&p.logarithmic&&p.logarithmic.lin2log(p.min)||0)),ye=b.inverted,Te=this.isNegative;return ye?{x:(Te?re:re-ce)-b.plotLeft,y:de.height-ne-z+de.top-b.plotTop,width:ce,height:z}:{x:ne+de.transB-b.plotLeft,y:(Te?re-ce:re)-b.plotTop,width:z,height:ce}}},{getDeferredAnimation:A}=zr,{series:{prototype:R}}=Ia,{addEvent:$,correctFloat:Z,defined:se,destroyObjectProperties:ue,fireEvent:be,isNumber:ge,objectEach:Ce,pick:$e}=Ht;function Ne(){let ie=this.inverted;this.axes.forEach(p=>{var b;(b=p.stacking)!=null&&b.stacks&&p.hasVisibleSeries&&(p.stacking.oldStacks=p.stacking.stacks)}),this.series.forEach(p=>{var T;let b=((T=p.xAxis)==null?void 0:T.options)||{};p.options.stacking&&p.reserveSpace()&&(p.stackKey=[p.type,$e(p.options.stack,""),ie?b.top:b.left,ie?b.height:b.width].join(","))})}function We(){var p;let ie=this.stacking;if(ie){let b=ie.stacks;Ce(b,(T,P)=>{ue(T),delete b[P]}),(p=ie.stackTotalGroup)==null||p.destroy()}}function Xe(){this.stacking||(this.stacking=new Rt(this))}function et(ie,p,b,T){return!se(ie)||ie.x!==p||T&&ie.stackKey!==T?ie={x:p,index:0,key:T,stackKey:T}:ie.index++,ie.key=[b,p,ie.index].join(","),ie}function _t(){let ie,p=this,b=p.yAxis,T=p.stackKey||"",P=b.stacking.stacks,O=p.getColumn("x",!0),z=p.options.stacking,j=p[z+"Stacker"];j&&[T,"-"+T].forEach(X=>{var ye;let re=O.length,de,ne,ce;for(;re--;)de=O[re],ie=p.getStackIndicator(ie,de,p.index,X),ne=(ye=P[X])==null?void 0:ye[de],(ce=ne==null?void 0:ne.points[ie.key||""])&&j.call(p,ce,ne,re)})}function Ct(ie,p,b){let T=p.total?100/p.total:0;ie[0]=Z(ie[0]*T),ie[1]=Z(ie[1]*T),this.stackedYData[b]=ie[1]}function jt(ie){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?R.setStackedPoints.call(this,ie,"group"):ie.stacking.resetStacks())}function Ft(ie,p){var oi,di;let b,T,P,O,z,j,X,re=p||this.options.stacking;if(!re||!this.reserveSpace()||({group:"xAxis"}[re]||"yAxis")!==ie.coll)return;let de=this.getColumn("x",!0),ne=this.getColumn(this.pointValKey||"y",!0),ce=[],ye=ne.length,Te=this.options,De=Te.threshold||0,Oe=Te.startFromThreshold?De:0,Be=Te.stack,Ke=p?`${this.type},${re}`:this.stackKey||"",st="-"+Ke,Bt=this.negStacks,Ut=ie.stacking,$t=Ut.stacks,ci=Ut.oldStacks;for(Ut.stacksTouched+=1,X=0;X<ye;X++){let er=de[X]||0,Vi=ne[X],lr=ge(Vi)&&Vi||0;j=(b=this.getStackIndicator(b,er,this.index)).key||"",$t[z=(T=Bt&&lr<(Oe?0:De))?st:Ke]||($t[z]={}),$t[z][er]||((oi=ci[z])!=null&&oi[er]?($t[z][er]=ci[z][er],$t[z][er].total=null):$t[z][er]=new C(ie,ie.options.stackLabels,!!T,er,Be)),P=$t[z][er],Vi!==null?(P.points[j]=P.points[this.index]=[$e(P.cumulative,Oe)],se(P.cumulative)||(P.base=j),P.touched=Ut.stacksTouched,b.index>0&&this.singleStacks===!1&&(P.points[j][0]=P.points[this.index+","+er+",0"][0])):(delete P.points[j],delete P.points[this.index]);let Vr=P.total||0;re==="percent"?(O=T?Ke:st,Vr=Bt&&((di=$t[O])!=null&&di[er])?(O=$t[O][er]).total=Math.max(O.total||0,Vr)+Math.abs(lr):Z(Vr+Math.abs(lr))):re==="group"?ge(Vi)&&Vr++:Vr=Z(Vr+lr),re==="group"?P.cumulative=(Vr||1)-1:P.cumulative=Z($e(P.cumulative,Oe)+lr),P.total=Vr,Vi!==null&&(P.points[j].push(P.cumulative),ce[X]=P.cumulative,P.hasValidPoints=!0)}re==="percent"&&(Ut.usePercentage=!0),re!=="group"&&(this.stackedYData=ce),Ut.oldStacks={}}class Rt{constructor(p){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=p}buildStacks(){let p,b,T=this.axis,P=T.series,O=T.coll==="xAxis",z=T.options.reversedStacks,j=P.length;for(this.resetStacks(),this.usePercentage=!1,b=j;b--;)p=P[z?b:j-b-1],O&&p.setGroupedPoints(T),p.setStackedPoints(T);if(!O)for(b=0;b<j;b++)P[b].modifyStacks();be(T,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,Ce(this.stacks,p=>{Ce(p,b=>{b.cumulative=b.total})}))}resetStacks(){Ce(this.stacks,p=>{Ce(p,(b,T)=>{ge(b.touched)&&b.touched<this.stacksTouched?(b.destroy(),delete p[T]):(b.total=null,b.cumulative=null)})})}renderStackTotals(){var j;let p=this.axis,b=p.chart,T=b.renderer,P=this.stacks,O=A(b,((j=p.options.stackLabels)==null?void 0:j.animation)||!1),z=this.stackTotalGroup=this.stackTotalGroup||T.g("stack-labels").attr({zIndex:6,opacity:0}).add();z.translate(b.plotLeft,b.plotTop),Ce(P,X=>{Ce(X,re=>{re.render(z)})}),z.animate({opacity:1},O)}}(Se||(Se={})).compose=function(ie,p,b){let T=p.prototype,P=b.prototype;T.getStacks||($(ie,"init",Xe),$(ie,"destroy",We),T.getStacks=Ne,P.getStackIndicator=et,P.modifyStacks=_t,P.percentStacker=Ct,P.setGroupedPoints=jt,P.setStackedPoints=Ft)};let Et=Se,{defined:Wt,merge:qt,isObject:Ei}=Ht;class Mi extends Vc{drawGraph(){let p=this.options,b=(this.gappedPath||this.getGraphPath).call(this),T=this.chart.styledMode;[this,...this.zones].forEach((P,O)=>{let z,j=P.graph,X=j?"animate":"attr",re=P.dashStyle||p.dashStyle;j?(j.endX=this.preventGraphAnimation?null:b.xMap,j.animate({d:b})):b.length&&(P.graph=j=this.chart.renderer.path(b).addClass("highcharts-graph"+(O?` highcharts-zone-graph-${O-1} `:" ")+(O&&P.className||"")).attr({zIndex:1}).add(this.group)),j&&!T&&(z={stroke:!O&&p.lineColor||P.color||this.color||"#cccccc","stroke-width":p.lineWidth||0,fill:this.fillGraph&&this.color||"none"},re?z.dashstyle=re:p.linecap!=="square"&&(z["stroke-linecap"]=z["stroke-linejoin"]="round"),j[X](z).shadow(p.shadow&&qt({filterUnits:"userSpaceOnUse"},Ei(p.shadow)?p.shadow:{}))),j&&(j.startX=b.xMap,j.isArea=b.isArea)})}getGraphPath(p,b,T){let P=this,O=P.options,z=[],j=[],X,re=O.step,de=(p=p||P.points).reversed;return de&&p.reverse(),(re={right:1,center:2}[re]||re&&3)&&de&&(re=4-re),(p=this.getValidPoints(p,!1,O.nullInteraction||!(O.connectNulls&&!b&&!T))).forEach(function(ne,ce){let ye,Te=ne.plotX,De=ne.plotY,Oe=p[ce-1],Be=ne.isNull||typeof De!="number";(ne.leftCliff||Oe!=null&&Oe.rightCliff)&&!T&&(X=!0),Be&&!Wt(b)&&ce>0?X=!O.connectNulls:Be&&!b?X=!0:(ce===0||X?ye=[["M",ne.plotX,ne.plotY]]:P.getPointSpline?ye=[P.getPointSpline(p,ne,ce)]:re?(ye=re===1?[["L",Oe.plotX,De]]:re===2?[["L",(Oe.plotX+Te)/2,Oe.plotY],["L",(Oe.plotX+Te)/2,De]]:[["L",Te,Oe.plotY]]).push(["L",Te,De]):ye=[["L",Te,De]],j.push(ne.x),re&&(j.push(ne.x),re===2&&j.push(ne.x)),z.push.apply(z,ye),X=!1)}),z.xMap=j,P.graphPath=z,z}}Mi.defaultOptions=qt(Vc.defaultOptions,{legendSymbol:"lineMarker"}),Ia.registerSeriesType("line",Mi);let{seriesTypes:{line:Ki}}=Ia,{extend:Ji,merge:Er,objectEach:Ti,pick:$i}=Ht;class li extends Ki{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:p,options:b}=this;[this,...this.zones].forEach((T,P)=>{let O={},z=T.fillColor||b.fillColor,j=T.area,X=j?"animate":"attr";j?(j.endX=this.preventGraphAnimation?null:p.xMap,j.animate({d:p})):(O.zIndex=0,(j=T.area=this.chart.renderer.path(p).addClass("highcharts-area"+(P?` highcharts-zone-area-${P-1} `:" ")+(P&&T.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(O.fill=z||T.color||this.color,O["fill-opacity"]=z?1:b.fillOpacity??.75,j.css({pointerEvents:this.stickyTracking?"none":"auto"})),j[X](O),j.startX=p.xMap,j.shiftUnit=b.step?2:1})}getGraphPath(p){let b,T,P,O=Ki.prototype.getGraphPath,z=this.options,j=z.stacking,X=this.yAxis,re=[],de=[],ne=this.index,ce=X.stacking.stacks[this.stackKey],ye=z.threshold,Te=Math.round(X.getThreshold(z.threshold)),De=$i(z.connectNulls,j==="percent"),Oe=function($t,ci,oi){let di=p[$t],er=j&&ce[di.x].points[ne],Vi=di[oi+"Null"]||0,lr=di[oi+"Cliff"]||0,Vr,Wn,xn=!0;lr||Vi?(Vr=(Vi?er[0]:er[1])+lr,Wn=er[0]+lr,xn=!!Vi):!j&&p[ci]&&p[ci].isNull&&(Vr=Wn=ye),Vr!==void 0&&(de.push({plotX:b,plotY:Vr===null?Te:X.getThreshold(Vr),isNull:xn,isCliff:!0}),re.push({plotX:b,plotY:Wn===null?Te:X.getThreshold(Wn),doCurve:!1}))};p=p||this.points,j&&(p=this.getStackPoints(p));for(let $t=0,ci=p.length;$t<ci;++$t)j||(p[$t].leftCliff=p[$t].rightCliff=p[$t].leftNull=p[$t].rightNull=void 0),T=p[$t].isNull,b=$i(p[$t].rectPlotX,p[$t].plotX),P=j?$i(p[$t].yBottom,Te):Te,(!T||De)&&(De||Oe($t,$t-1,"left"),T&&!j&&De||(de.push(p[$t]),re.push({x:$t,plotX:b,plotY:P})),De||Oe($t,$t+1,"right"));let Be=O.call(this,de,!0,!0);re.reversed=!0;let Ke=O.call(this,re,!0,!0),st=Ke[0];st&&st[0]==="M"&&(Ke[0]=["L",st[1],st[2]]);let Bt=Be.concat(Ke);Bt.length&&Bt.push(["Z"]);let Ut=O.call(this,de,!1,De);return this.chart.series.length>1&&j&&de.some($t=>$t.isCliff)&&(Bt.hasStackedCliffs=Ut.hasStackedCliffs=!0),Bt.xMap=Be.xMap,this.areaPath=Bt,Ut}getStackPoints(p){let b=this,T=[],P=[],O=this.xAxis,z=this.yAxis,j=z.stacking.stacks[this.stackKey],X={},re=z.series,de=re.length,ne=z.options.reversedStacks?1:-1,ce=re.indexOf(b);if(p=p||this.points,this.options.stacking){for(let Te=0;Te<p.length;Te++)p[Te].leftNull=p[Te].rightNull=void 0,X[p[Te].x]=p[Te];Ti(j,function(Te,De){Te.total!==null&&P.push(De)}),P.sort(function(Te,De){return Te-De});let ye=re.map(Te=>Te.visible);P.forEach(function(Te,De){let Oe=0,Be,Ke;if(X[Te]&&!X[Te].isNull)T.push(X[Te]),[-1,1].forEach(function(st){let Bt=st===1?"rightNull":"leftNull",Ut=j[P[De+st]],$t=0;if(Ut){let ci=ce;for(;ci>=0&&ci<de;){let oi=re[ci].index;!(Be=Ut.points[oi])&&(oi===b.index?X[Te][Bt]=!0:ye[ci]&&(Ke=j[Te].points[oi])&&($t-=Ke[1]-Ke[0])),ci+=ne}}X[Te][st===1?"rightCliff":"leftCliff"]=$t});else{let st=ce;for(;st>=0&&st<de;){let Bt=re[st].index;if(Be=j[Te].points[Bt]){Oe=Be[1];break}st+=ne}Oe=$i(Oe,0),Oe=z.translate(Oe,0,1,0,1),T.push({isNull:!0,plotX:O.translate(Te,0,0,0,1),x:Te,plotY:Oe,yBottom:Oe})}})}return T}}li.defaultOptions=Er(Ki.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),Ji(li.prototype,{singleStacks:!1}),Ia.registerSeriesType("area",li);let{line:dr}=Ia.seriesTypes,{merge:Ni,pick:vr}=Ht;class Nr extends dr{getPointSpline(p,b,T){let P,O,z,j,X=b.plotX||0,re=b.plotY||0,de=p[T-1],ne=p[T+1];function ce(Te){return Te&&!Te.isNull&&Te.doCurve!==!1&&!b.isCliff}if(ce(de)&&ce(ne)){let Te=de.plotX||0,De=de.plotY||0,Oe=ne.plotX||0,Be=ne.plotY||0,Ke=0;P=(1.5*X+Te)/2.5,O=(1.5*re+De)/2.5,z=(1.5*X+Oe)/2.5,j=(1.5*re+Be)/2.5,z!==P&&(Ke=(j-O)*(z-X)/(z-P)+re-j),O+=Ke,j+=Ke,O>De&&O>re?(O=Math.max(De,re),j=2*re-O):O<De&&O<re&&(O=Math.min(De,re),j=2*re-O),j>Be&&j>re?(j=Math.max(Be,re),O=2*re-j):j<Be&&j<re&&(j=Math.min(Be,re),O=2*re-j),b.rightContX=z,b.rightContY=j,b.controlPoints={low:[P,O],high:[z,j]}}let ye=["C",vr(de.rightContX,de.plotX,0),vr(de.rightContY,de.plotY,0),vr(P,X,0),vr(O,re,0),X,re];return de.rightContX=de.rightContY=void 0,ye}}Nr.defaultOptions=Ni(dr.defaultOptions),Ia.registerSeriesType("spline",Nr);let ar=Nr,{area:Br,area:{prototype:dn}}=Ia.seriesTypes,{extend:pn,merge:on}=Ht;class bn extends ar{}bn.defaultOptions=on(ar.defaultOptions,Br.defaultOptions),pn(bn.prototype,{getGraphPath:dn.getGraphPath,getStackPoints:dn.getStackPoints,drawGraph:dn.drawGraph}),Ia.registerSeriesType("areaspline",bn);let{animObject:An}=zr,{parse:Vn}=ai,{noop:Zn}=Je,{clamp:ys,crisp:Bo,defined:Da,extend:xo,fireEvent:ia,isArray:sl,isNumber:ls,merge:cs,pick:Ts,objectEach:_a}=Ht;class Jl extends Vc{animate(p){let b,T,P=this,O=this.yAxis,z=O.pos,j=O.reversed,X=P.options,{clipOffset:re,inverted:de}=this.chart,ne={},ce=de?"translateX":"translateY";p&&re?(ne.scaleY=.001,T=ys(O.toPixels(X.threshold||0),z,z+O.len),de?ne.translateX=(T+=j?-Math.floor(re[0]):Math.ceil(re[2]))-O.len:ne.translateY=T+=j?Math.ceil(re[0]):-Math.floor(re[2]),P.clipBox&&P.setClip(),P.group.attr(ne)):(b=Number(P.group.attr(ce)),P.group.animate({scaleY:1},xo(An(P.options.animation),{step:function(ye,Te){P.group&&(ne[ce]=b+Te.pos*(z-b),P.group.attr(ne))}})))}init(p,b){super.init.apply(this,arguments);let T=this;(p=T.chart).hasRendered&&p.series.forEach(function(P){P.type===T.type&&(P.isDirty=!0)})}getColumnMetrics(){var De,Oe;let p=this,b=p.options,T=p.xAxis,P=p.yAxis,O=T.options.reversedStacks,z=T.reversed&&!O||!T.reversed&&O,j={},X,re=0;b.grouping===!1?re=1:p.chart.series.forEach(function(Be){let Ke,st=Be.yAxis,Bt=Be.options;Be.type===p.type&&Be.reserveSpace()&&P.len===st.len&&P.pos===st.pos&&(Bt.stacking&&Bt.stacking!=="group"?(j[X=Be.stackKey]===void 0&&(j[X]=re++),Ke=j[X]):Bt.grouping!==!1&&(Ke=re++),Be.columnIndex=Ke)});let de=Math.min(Math.abs(T.transA)*(!((De=T.brokenAxis)!=null&&De.hasBreaks)&&((Oe=T.ordinal)==null?void 0:Oe.slope)||b.pointRange||T.closestPointRange||T.tickInterval||1),T.len),ne=de*b.groupPadding,ce=(de-2*ne)/(re||1),ye=Math.min(b.maxPointWidth||T.len,Ts(b.pointWidth,ce*(1-2*b.pointPadding))),Te=(p.columnIndex||0)+ +!!z;return p.columnMetrics={width:ye,offset:(ce-ye)/2+(ne+Te*ce-de/2)*(z?-1:1),paddedWidth:ce,columnCount:re},p.columnMetrics}crispCol(p,b,T,P){let O=this.borderWidth,z=this.chart.inverted;return P=Bo(b+P,O,z)-(b=Bo(b,O,z)),this.options.crisp&&(T=Bo(p+T,O)-(p=Bo(p,O))),{x:p,y:b,width:T,height:P}}adjustForMissingColumns(p,b,T,P){var O;if(!T.isNull&&P.columnCount>1){let z=this.xAxis.series.filter(de=>de.visible).map(de=>de.index),j=0,X=0;_a((O=this.xAxis.stacking)==null?void 0:O.stacks,de=>{var Te;let ne=typeof T.x=="number"?(Te=de[T.x.toString()])==null?void 0:Te.points:void 0,ce=ne==null?void 0:ne[this.index],ye={};if(ne&&sl(ce)){let De=this.index,Oe=Object.keys(ne).filter(Be=>!Be.match(",")&&ne[Be]&&ne[Be].length>1).map(parseFloat).filter(Be=>z.indexOf(Be)!==-1).filter(Be=>{let Ke=this.chart.series[Be].options,st=Ke.stacking&&Ke.stack;if(Da(st)){if(ls(ye[st]))return De===Be&&(De=ye[st]),!1;ye[st]=Be}return!0}).sort((Be,Ke)=>Ke-Be);j=Oe.indexOf(De),X=Oe.length}}),j=this.xAxis.reversed?X-1-j:j;let re=(X-1)*P.paddedWidth+b;p=(T.plotX||0)+re/2-b-j*P.paddedWidth}return p}translate(){let p=this,b=p.chart,T=p.options,P=p.dense=p.closestPointRange*p.xAxis.transA<2,O=p.borderWidth=Ts(T.borderWidth,+!P),z=p.xAxis,j=p.yAxis,X=T.threshold,re=Ts(T.minPointLength,5),de=p.getColumnMetrics(),ne=de.width,ce=p.pointXOffset=de.offset,ye=p.dataMin,Te=p.dataMax,De=p.translatedThreshold=j.getThreshold(X),Oe=p.barW=Math.max(ne,1+2*O);T.pointPadding&&T.crisp&&(Oe=Math.ceil(Oe)),Vc.prototype.translate.apply(p),p.points.forEach(function(Be){let Ke=Ts(Be.yBottom,De),st=999+Math.abs(Ke),Bt=Be.plotX||0,Ut=ys(Be.plotY,-st,j.len+st),$t,ci=Math.min(Ut,Ke),oi=Math.max(Ut,Ke)-ci,di=ne,er=Bt+ce,Vi=Oe;re&&Math.abs(oi)<re&&(oi=re,$t=!j.reversed&&!Be.negative||j.reversed&&Be.negative,ls(X)&&ls(Te)&&Be.y===X&&Te<=X&&(j.min||0)<X&&(ye!==Te||(j.max||0)<=X)&&($t=!$t,Be.negative=!Be.negative),ci=Math.abs(ci-De)>re?Ke-re:De-($t?re:0)),Da(Be.options.pointWidth)&&(er-=Math.round(((di=Vi=Math.ceil(Be.options.pointWidth))-ne)/2)),T.centerInCategory&&(er=p.adjustForMissingColumns(er,di,Be,de)),Be.barX=er,Be.pointWidth=di,Be.tooltipPos=b.inverted?[ys(j.len+j.pos-b.plotLeft-Ut,j.pos-b.plotLeft,j.len+j.pos-b.plotLeft),z.len+z.pos-b.plotTop-er-Vi/2,oi]:[z.left-b.plotLeft+er+Vi/2,ys(Ut+j.pos-b.plotTop,j.pos-b.plotTop,j.len+j.pos-b.plotTop),oi],Be.shapeType=p.pointClass.prototype.shapeType||"roundedRect",Be.shapeArgs=p.crispCol(er,ci,Vi,Be.isNull?0:oi)}),ia(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(p,b){let T=this.options,P=this.pointAttrToOptions||{},O=P.stroke||"borderColor",z=P["stroke-width"]||"borderWidth",j,X,re,de=p&&p.color||this.color,ne=p&&p[O]||T[O]||de,ce=p&&p.options.dashStyle||T.dashStyle,ye=p&&p[z]||T[z]||this[z]||0,Te=p!=null&&p.isNull&&T.nullInteraction?0:(p==null?void 0:p.opacity)??T.opacity??1;p&&this.zones.length&&(X=p.getZone(),de=p.options.color||X&&(X.color||p.nonZonedColor)||this.color,X&&(ne=X.borderColor||ne,ce=X.dashStyle||ce,ye=X.borderWidth||ye)),b&&p&&(re=(j=cs(T.states[b],p.options.states&&p.options.states[b]||{})).brightness,de=j.color||re!==void 0&&Vn(de).brighten(j.brightness).get()||de,ne=j[O]||ne,ye=j[z]||ye,ce=j.dashStyle||ce,Te=Ts(j.opacity,Te));let De={fill:de,stroke:ne,"stroke-width":ye,opacity:Te};return ce&&(De.dashstyle=ce),De}drawPoints(p=this.points){let b,T=this,P=this.chart,O=T.options,z=O.nullInteraction,j=P.renderer,X=O.animationLimit||250;p.forEach(function(re){let de=re.plotY,ne=re.graphic,ce=!!ne,ye=ne&&P.pointCount<X?"animate":"attr";ls(de)&&(re.y!==null||z)?(b=re.shapeArgs,ne&&re.hasNewShapeType()&&(ne=ne.destroy()),T.enabledDataSorting&&(re.startXPos=T.xAxis.reversed?-(b&&b.width||0):T.xAxis.width),!ne&&(re.graphic=ne=j[re.shapeType](b).add(re.group||T.group),ne&&T.enabledDataSorting&&P.hasRendered&&P.pointCount<X&&(ne.attr({x:re.startXPos}),ce=!0,ye="animate")),ne&&ce&&ne[ye](cs(b)),P.styledMode||ne[ye](T.pointAttribs(re,re.selected&&"select")).shadow(re.allowShadow!==!1&&O.shadow),ne&&(ne.addClass(re.getClassName(),!0),ne.attr({visibility:re.visible?"inherit":"hidden"}))):ne&&(re.graphic=ne.destroy())})}drawTracker(p=this.points){let b,T=this,P=T.chart,O=P.pointer,z=function(j){O==null||O.normalize(j);let X=O==null?void 0:O.getPointFromEvent(j);O&&X&&T.options.enableMouseTracking&&(P.isInsidePlot(j.chartX-P.plotLeft,j.chartY-P.plotTop,{visiblePlotOnly:!0})||O!=null&&O.inClass(j.target,"highcharts-data-label"))&&(O.isDirectTouch=!0,X.onMouseOver(j))};p.forEach(function(j){b=sl(j.dataLabels)?j.dataLabels:j.dataLabel?[j.dataLabel]:[],j.graphic&&(j.graphic.element.point=j),b.forEach(function(X){(X.div||X.element).point=j})}),T._hasTracking||(T.trackerGroups.forEach(function(j){T[j]&&(T[j].addClass("highcharts-tracker").on("mouseover",z).on("mouseout",function(X){O==null||O.onTrackerMouseOut(X)}).on("touchstart",z),!P.styledMode&&T.options.cursor&&T[j].css({cursor:T.options.cursor}))}),T._hasTracking=!0),ia(this,"afterDrawTracker")}remove(){let p=this,b=p.chart;b.hasRendered&&b.series.forEach(function(T){T.type===p.type&&(T.isDirty=!0)}),Vc.prototype.remove.apply(p,arguments)}}Jl.defaultOptions=cs(Vc.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),xo(Jl.prototype,{directTouch:!0,getSymbol:Zn,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),Ia.registerSeriesType("column",Jl);let Zo=Jl,{getDeferredAnimation:Wo}=zr,{format:ol}=ba,{defined:Ws,extend:ec,fireEvent:Ta,getAlignFactor:Ca,isArray:Ko,isString:bo,merge:Ya,objectEach:_h,pick:ua,pInt:Fo,splat:ru}=Ht;(function(ie){function p(){return X(this).some(de=>de==null?void 0:de.enabled)}function b(de,ne,ce,ye,Te){var er;let{chart:De,enabledDataSorting:Oe}=this,Be=this.isCartesian&&De.inverted,Ke=de.plotX,st=de.plotY,Bt=ce.rotation||0,Ut=Ws(Ke)&&Ws(st)&&De.isInsidePlot(Ke,Math.round(st),{inverted:Be,paneCoordinates:!0,series:this}),$t=Bt===0&&ua(ce.overflow,Oe?"none":"justify")==="justify",ci=this.visible&&de.visible!==!1&&Ws(Ke)&&(de.series.forceDL||Oe&&!$t||Ut||ua(ce.inside,!!this.options.stacking)&&ye&&De.isInsidePlot(Ke,Be?ye.x+1:ye.y+ye.height-1,{inverted:Be,paneCoordinates:!0,series:this})),oi=de.pos();if(ci&&oi){var di;let Vi=ne.getBBox(),lr=ne.getBBox(void 0,0);if(ye=ec({x:oi[0],y:Math.round(oi[1]),width:0,height:0},ye||{}),ce.alignTo==="plotEdges"&&this.isCartesian&&(ye[Be?"x":"y"]=0,ye[Be?"width":"height"]=((er=this.yAxis)==null?void 0:er.len)||0),ec(ce,{width:Vi.width,height:Vi.height}),di=ye,Oe&&this.xAxis&&!$t&&this.setDataLabelStartPos(de,ne,Te,Ut,di),ne.align(Ya(ce,{width:lr.width,height:lr.height}),!1,ye,!1),ne.alignAttr.x+=Ca(ce.align)*(lr.width-Vi.width),ne.alignAttr.y+=Ca(ce.verticalAlign)*(lr.height-Vi.height),ne[ne.placed?"animate":"attr"]({"text-align":ne.alignAttr["text-align"]||"center",x:ne.alignAttr.x+(Vi.width-lr.width)/2,y:ne.alignAttr.y+(Vi.height-lr.height)/2,rotationOriginX:(ne.width||0)/2,rotationOriginY:(ne.height||0)/2}),$t&&ye.height>=0)this.justifyDataLabel(ne,ce,ne.alignAttr,Vi,ye,Te);else if(ua(ce.crop,!0)){let{x:Vr,y:Wn}=ne.alignAttr;ci=De.isInsidePlot(Vr,Wn,{paneCoordinates:!0,series:this})&&De.isInsidePlot(Vr+Vi.width-1,Wn+Vi.height-1,{paneCoordinates:!0,series:this})}ce.shape&&!Bt&&ne[Te?"attr":"animate"]({anchorX:oi[0],anchorY:oi[1]})}Te&&Oe&&(ne.placed=!1),ci||Oe&&!$t?(ne.show(),ne.placed=!0):(ne.hide(),ne.placed=!1)}function T(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function P(de){let ne=this.hasRendered||0,ce=this.initDataLabelsGroup().attr({opacity:+ne});return!ne&&ce&&(this.visible&&ce.show(),this.options.animation?ce.animate({opacity:1},de):ce.attr({opacity:1})),ce}function O(de){var ci;let ne;de=de||this.points;let ce=this,ye=ce.chart,Te=ce.options,De=ye.renderer,{backgroundColor:Oe,plotBackgroundColor:Be}=ye.options.chart,Ke=De.getContrast(bo(Be)&&Be||bo(Oe)&&Oe||"#000000"),st=X(ce),{animation:Bt,defer:Ut}=st[0],$t=Ut?Wo(ye,Bt,ce):{defer:0,duration:0};Ta(this,"drawDataLabels"),(ci=ce.hasDataLabels)!=null&&ci.call(ce)&&(ne=this.initDataLabels($t),de.forEach(oi=>{var lr,Vr,Wn;let di=oi.dataLabels||[],er=oi.color||ce.color;ru(j(st,oi.dlOptions||((lr=oi.options)==null?void 0:lr.dataLabels))).forEach((xn,Nn)=>{var fc;let Bn=xn.enabled&&(oi.visible||oi.dataLabelOnHidden)&&(!oi.isNull||oi.dataLabelOnNull)&&function(au,Ey){let gm=Ey.filter;if(gm){let dd=gm.operator,pd=au[gm.property],Hc=gm.value;return dd===">"&&pd>Hc||dd==="<"&&pd<Hc||dd===">="&&pd>=Hc||dd==="<="&&pd<=Hc||dd==="=="&&pd==Hc||dd==="==="&&pd===Hc||dd==="!="&&pd!=Hc||dd==="!=="&&pd!==Hc||!1}return!0}(oi,xn),{backgroundColor:Xn,borderColor:es,distance:ns,style:Qs={}}=xn,Nl,Uo,jo,mo={},io=di[Nn],vc=!io,El;Bn&&(Uo=Ws(Nl=ua(xn[oi.formatPrefix+"Format"],xn.format))?ol(Nl,oi,ye):(xn[oi.formatPrefix+"Formatter"]||xn.formatter).call(oi,xn),jo=xn.rotation,!ye.styledMode&&(Qs.color=ua(xn.color,Qs.color,bo(ce.color)?ce.color:void 0,"#000000"),Qs.color==="contrast"?(Xn!=="none"&&(El=Xn),oi.contrastColor=De.getContrast(El!=="auto"&&bo(El)&&El||(bo(er)?er:"")),Qs.color=El||!Ws(ns)&&xn.inside||0>Fo(ns||0)||Te.stacking?oi.contrastColor:Ke):delete oi.contrastColor,Te.cursor&&(Qs.cursor=Te.cursor)),mo={r:xn.borderRadius||0,rotation:jo,padding:xn.padding,zIndex:1},ye.styledMode||(mo.fill=Xn==="auto"?oi.color:Xn,mo.stroke=es==="auto"?oi.color:es,mo["stroke-width"]=xn.borderWidth),_h(mo,(au,Ey)=>{au===void 0&&delete mo[Ey]})),!io||Bn&&Ws(Uo)&&!!(io.div||(fc=io.text)!=null&&fc.foreignObject)==!!xn.useHTML&&(io.rotation&&xn.rotation||io.rotation===xn.rotation)||(io=void 0,vc=!0),Bn&&Ws(Uo)&&Uo!==""&&(io?mo.text=Uo:(io=De.label(Uo,0,0,xn.shape,void 0,void 0,xn.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+oi.colorIndex+" "+(xn.className||"")+(xn.useHTML?" highcharts-tracker":"")),io&&(io.options=xn,io.attr(mo),ye.styledMode?Qs.width&&io.css({width:Qs.width,textOverflow:Qs.textOverflow,whiteSpace:Qs.whiteSpace}):io.css(Qs).shadow(xn.shadow),Ta(io,"beforeAddingDataLabel",{labelOptions:xn,point:oi}),io.added||io.add(ne),ce.alignDataLabel(oi,io,xn,void 0,vc),io.isActive=!0,di[Nn]&&di[Nn]!==io&&di[Nn].destroy(),di[Nn]=io))});let Vi=di.length;for(;Vi--;)(Vr=di[Vi])!=null&&Vr.isActive?di[Vi].isActive=!1:((Wn=di[Vi])==null||Wn.destroy(),di.splice(Vi,1));oi.dataLabel=di[0],oi.dataLabels=di})),Ta(this,"afterDrawDataLabels")}function z(de,ne,ce,ye,Te,De){let Oe=this.chart,Be=ne.align,Ke=ne.verticalAlign,st=de.box?0:de.padding||0,Bt=Oe.inverted?this.yAxis:this.xAxis,Ut=Bt?Bt.left-Oe.plotLeft:0,$t=Oe.inverted?this.xAxis:this.yAxis,ci=$t?$t.top-Oe.plotTop:0,{x:oi=0,y:di=0}=ne,er,Vi;return(er=(ce.x||0)+st+Ut)<0&&(Be==="right"&&oi>=0?(ne.align="left",ne.inside=!0):oi-=er,Vi=!0),(er=(ce.x||0)+ye.width-st+Ut)>Oe.plotWidth&&(Be==="left"&&oi<=0?(ne.align="right",ne.inside=!0):oi+=Oe.plotWidth-er,Vi=!0),(er=ce.y+st+ci)<0&&(Ke==="bottom"&&di>=0?(ne.verticalAlign="top",ne.inside=!0):di-=er,Vi=!0),(er=(ce.y||0)+ye.height-st+ci)>Oe.plotHeight&&(Ke==="top"&&di<=0?(ne.verticalAlign="bottom",ne.inside=!0):di+=Oe.plotHeight-er,Vi=!0),Vi&&(ne.x=oi,ne.y=di,de.placed=!De,de.align(ne,void 0,Te)),Vi}function j(de,ne){let ce=[],ye;if(Ko(de)&&!Ko(ne))ce=de.map(function(Te){return Ya(Te,ne)});else if(Ko(ne)&&!Ko(de))ce=ne.map(function(Te){return Ya(de,Te)});else if(Ko(de)||Ko(ne)){if(Ko(de)&&Ko(ne))for(ye=Math.max(de.length,ne.length);ye--;)ce[ye]=Ya(de[ye],ne[ye])}else ce=Ya(de,ne);return ce}function X(de){var ce,ye;let ne=de.chart.options.plotOptions;return ru(j(j((ce=ne==null?void 0:ne.series)==null?void 0:ce.dataLabels,(ye=ne==null?void 0:ne[de.type])==null?void 0:ye.dataLabels),de.options.dataLabels))}function re(de,ne,ce,ye,Te){let De=this.chart,Oe=De.inverted,Be=this.xAxis,Ke=Be.reversed,st=((Oe?ne.height:ne.width)||0)/2,Bt=de.pointWidth,Ut=Bt?Bt/2:0;ne.startXPos=Oe?Te.x:Ke?-st-Ut:Be.width-st+Ut,ne.startYPos=Oe?Ke?this.yAxis.height-st+Ut:-st-Ut:Te.y,ye?ne.visibility==="hidden"&&(ne.show(),ne.attr({opacity:0}).animate({opacity:1})):ne.attr({opacity:1}).animate({opacity:0},void 0,ne.hide),De.hasRendered&&(ce&&ne.attr({x:ne.startXPos,y:ne.startYPos}),ne.placed=!0)}ie.compose=function(de){let ne=de.prototype;ne.initDataLabels||(ne.initDataLabels=P,ne.initDataLabelsGroup=T,ne.alignDataLabel=b,ne.drawDataLabels=O,ne.justifyDataLabel=z,ne.mergeArrays=j,ne.setDataLabelStartPos=re,ne.hasDataLabels=p)}})(ke||(ke={}));let Ah=ke,{composed:od}=Je,{series:Od}=Ia,{merge:nu,pushUnique:su}=Ht;(function(ie){function p(b,T,P,O,z){var De,Oe;let{chart:j,options:X}=this,re=j.inverted,de=((De=this.xAxis)==null?void 0:De.len)||j.plotSizeX||0,ne=((Oe=this.yAxis)==null?void 0:Oe.len)||j.plotSizeY||0,ce=b.dlBox||b.shapeArgs,ye=b.below??(b.plotY||0)>(this.translatedThreshold??ne),Te=P.inside??!!X.stacking;if(ce){if(O=nu(ce),P.overflow!=="allow"||P.crop!==!1||X.clip!==!1){O.y<0&&(O.height+=O.y,O.y=0);let Be=O.y+O.height-ne;Be>0&&Be<O.height-1&&(O.height-=Be)}re&&(O={x:ne-O.y-O.height,y:de-O.x-O.width,width:O.height,height:O.width}),Te||(re?(O.x+=ye?0:O.width,O.width=0):(O.y+=ye?O.height:0,O.height=0))}P.align??(P.align=!re||Te?"center":ye?"right":"left"),P.verticalAlign??(P.verticalAlign=re||Te?"middle":ye?"top":"bottom"),Od.prototype.alignDataLabel.call(this,b,T,P,O,z),P.inside&&b.contrastColor&&T.css({color:b.contrastColor})}ie.compose=function(b){Ah.compose(Od),su(od,"ColumnDataLabel")&&(b.prototype.alignDataLabel=p)}})(Ee||(Ee={}));let Qd=Ee,{extend:ad,merge:Jd}=Ht;class cm extends Zo{}cm.defaultOptions=Jd(Zo.defaultOptions,{}),ad(cm.prototype,{inverted:!0}),Ia.registerSeriesType("bar",cm);let{column:hy,line:hm}=Ia.seriesTypes,{addEvent:uy,extend:Pg,merge:dy}=Ht;class um extends hm{applyJitter(){let p=this,b=this.options.jitter,T=this.points.length;b&&this.points.forEach(function(P,O){["x","y"].forEach(function(z,j){if(b[z]&&!P.isNull){let X=`plot${z.toUpperCase()}`,re=p[`${z}Axis`],de=b[z]*re.transA;if(re&&!re.logarithmic){let ne=Math.max(0,(P[X]||0)-de),ce=Math.min(re.len,(P[X]||0)+de);P[X]=ne+(ce-ne)*function(ye){let Te=1e4*Math.sin(ye);return Te-Math.floor(Te)}(O+j*T),z==="x"&&(P.clientX=P.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}um.defaultOptions=dy(hm.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}"></span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),Pg(um.prototype,{drawTracker:hy.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),uy(um,"afterTranslate",function(){this.applyJitter()}),Ia.registerSeriesType("scatter",um);let{deg2rad:ep}=Je,{fireEvent:jm,isNumber:Sp,pick:tp,relativeLength:N0}=Ht;(function(ie){ie.getCenter=function(){let p=this.options,b=this.chart,T=2*(p.slicedOffset||0),P=b.plotWidth-2*T,O=b.plotHeight-2*T,z=p.center,j=Math.min(P,O),X=p.thickness,re,de=p.size,ne=p.innerSize||0,ce,ye;typeof de=="string"&&(de=parseFloat(de)),typeof ne=="string"&&(ne=parseFloat(ne));let Te=[tp(z==null?void 0:z[0],"50%"),tp(z==null?void 0:z[1],"50%"),tp(de&&de<0?void 0:p.size,"100%"),tp(ne&&ne<0?void 0:p.innerSize||0,"0%")];for(!b.angular||this instanceof Vc||(Te[3]=0),ce=0;ce<4;++ce)ye=Te[ce],re=ce<2||ce===2&&/%$/.test(ye),Te[ce]=N0(ye,[P,O,j,Te[2]][ce])+(re?T:0);return Te[3]>Te[2]&&(Te[3]=Te[2]),Sp(X)&&2*X<Te[2]&&X>0&&(Te[3]=Te[2]-2*X),jm(this,"afterGetCenter",{positions:Te}),Te},ie.getStartAndEndRadians=function(p,b){let T=Sp(p)?p:0,P=Sp(b)&&b>T&&b-T<360?b:T+360;return{start:ep*(T+-90),end:ep*(P+-90)}}})(Ie||(Ie={}));let Og=Ie,{setAnimation:B0}=zr,{addEvent:Gy,defined:qy,extend:hv,isNumber:F0,pick:uv,relativeLength:Rg}=Ht;class py extends yl{getConnectorPath(p){let b=p.dataLabelPosition,T=p.options||{},P=T.connectorShape,O=this.connectorShapes[P]||P;return b&&O.call(this,{...b.computed,alignment:b.alignment},b.connectorPosition,T)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(p){let b=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(b.x,b.y,b.r+p,b.r+p,{innerR:b.r-1,start:b.start,end:b.end,borderRadius:b.borderRadius})}constructor(p,b,T){super(p,b,T),this.half=0,this.name??(this.name=p.chart.options.lang.pieSliceName);let P=O=>{this.slice(O.type==="select")};Gy(this,"select",P),Gy(this,"unselect",P)}isValid(){return F0(this.y)&&this.y>=0}setVisible(p,b=!0){p!==this.visible&&this.update({visible:p??!this.visible},b,void 0,!1)}slice(p,b,T){let P=this.series;B0(T,P.chart),b=uv(b,!0),this.sliced=this.options.sliced=p=qy(p)?p:!this.sliced,P.options.data[P.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}hv(py.prototype,{connectorShapes:{fixedOffset:function(ie,p,b){let T=p.breakAt,P=p.touchingSliceAt,O=b.softConnector?["C",ie.x+(ie.alignment==="left"?-5:5),ie.y,2*T.x-P.x,2*T.y-P.y,T.x,T.y]:["L",T.x,T.y];return[["M",ie.x,ie.y],O,["L",P.x,P.y]]},straight:function(ie,p){let b=p.touchingSliceAt;return[["M",ie.x,ie.y],["L",b.x,b.y]]},crookedLine:function(ie,p,b){let{angle:T=this.angle||0,breakAt:P,touchingSliceAt:O}=p,{series:z}=this,[j,X,re]=z.center,de=re/2,{plotLeft:ne,plotWidth:ce}=z.chart,ye=ie.alignment==="left",{x:Te,y:De}=ie,Oe=P.x;if(b.crookDistance){let Ke=Rg(b.crookDistance,1);Oe=ye?j+de+(ce+ne-j-de)*(1-Ke):ne+(j-de)*Ke}else Oe=j+(X-De)*Math.tan(T-Math.PI/2);let Be=[["M",Te,De]];return(ye?Oe<=Te&&Oe>=P.x:Oe>=Te&&Oe<=P.x)&&Be.push(["L",Oe,De]),Be.push(["L",P.x,P.y],["L",O.x,O.y]),Be}}});let{getStartAndEndRadians:Hh}=Og,{noop:Ng}=Je,{clamp:dv,extend:pv,fireEvent:Yy,merge:E_,pick:k_}=Ht;class fy extends Vc{animate(p){let b=this,T=b.points,P=b.startAngleRad;p||T.forEach(function(O){let z=O.graphic,j=O.shapeArgs;z&&j&&(z.attr({r:k_(O.startR,b.center&&b.center[3]/2),start:P,end:P}),z.animate({r:j.r,start:j.start,end:j.end},b.options.animation))})}drawEmpty(){let p,b,T=this.startAngleRad,P=this.endAngleRad,O=this.options;this.total===0&&this.center?(p=this.center[0],b=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(p,b,this.center[1]/2,0,T,P).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:zh.arc(p,b,this.center[2]/2,0,{start:T,end:P,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":O.borderWidth,fill:O.fillColor||"none",stroke:O.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let p=this.chart.renderer;this.points.forEach(function(b){b.graphic&&b.hasNewShapeType()&&(b.graphic=b.graphic.destroy()),b.graphic||(b.graphic=p[b.shapeType](b.shapeArgs).add(b.series.group),b.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(p,b,T,P){let O=this.center,z=this.radii?this.radii[T.index]||0:O[2]/2,j=P.dataLabelPosition,X=(j==null?void 0:j.distance)||0,re=Math.asin(dv((p-O[1])/(z+X),-1,1));return O[0]+Math.cos(re)*(z+X)*(b?-1:1)+(X>0?(b?-1:1)*(P.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let p,b,T,P,O=this,z=O.chart;this.drawEmpty(),O.group&&!z.styledMode&&O.group.shadow(O.options.shadow),O.points.forEach(function(j){let X={};b=j.graphic,!j.isNull&&b?(P=j.shapeArgs,p=j.getTranslate(),z.styledMode||(T=O.pointAttribs(j,j.selected&&"select")),j.delayedRendering?(b.setRadialReference(O.center).attr(P).attr(p),z.styledMode||b.attr(T).attr({"stroke-linejoin":"round"}),j.delayedRendering=!1):(b.setRadialReference(O.center),z.styledMode||E_(!0,X,T),E_(!0,X,P,p),b.animate(X)),b.attr({visibility:j.visible?"inherit":"hidden"}),b.addClass(j.getClassName(),!0)):b&&(j.graphic=b.destroy())})}sortByAngle(p,b){p.sort(function(T,P){return T.angle!==void 0&&(P.angle-T.angle)*b})}translate(p){Yy(this,"translate"),this.generatePoints();let b=this.options,T=b.slicedOffset,P=Hh(b.startAngle,b.endAngle),O=this.startAngleRad=P.start,z=(this.endAngleRad=P.end)-O,j=this.points,X=b.ignoreHiddenPoint,re=j.length,de,ne,ce,ye,Te,De,Oe,Be=0;for(p||(this.center=p=this.getCenter()),De=0;De<re;De++){Oe=j[De],de=O+Be*z,Oe.isValid()&&(!X||Oe.visible)&&(Be+=Oe.percentage/100),ne=O+Be*z;let Ke={x:p[0],y:p[1],r:p[2]/2,innerR:p[3]/2,start:Math.round(1e3*de)/1e3,end:Math.round(1e3*ne)/1e3};Oe.shapeType="arc",Oe.shapeArgs=Ke,(ce=(ne+de)/2)>1.5*Math.PI?ce-=2*Math.PI:ce<-Math.PI/2&&(ce+=2*Math.PI),Oe.slicedTranslation={translateX:Math.round(Math.cos(ce)*T),translateY:Math.round(Math.sin(ce)*T)},ye=Math.cos(ce)*p[2]/2,Te=Math.sin(ce)*p[2]/2,Oe.tooltipPos=[p[0]+.7*ye,p[1]+.7*Te],Oe.half=+(ce<-Math.PI/2||ce>Math.PI/2),Oe.angle=ce}Yy(this,"afterTranslate")}updateTotals(){let p=this.points,b=p.length,T=this.options.ignoreHiddenPoint,P,O,z=0;for(P=0;P<b;P++)(O=p[P]).isValid()&&(!T||O.visible)&&(z+=O.y);for(P=0,this.total=z;P<b;P++)(O=p[P]).percentage=z>0&&(O.visible||!T)?O.y/z*100:0,O.total=z}}fy.defaultOptions=E_(Vc.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),pv(fy.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Zo.prototype.drawTracker,getCenter:Og.getCenter,getSymbol:Ng,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Zo.prototype.pointAttribs,pointClass:py,requireSorting:!1,searchPoint:Ng,trackerGroups:["group","dataLabelsGroup"]}),Ia.registerSeriesType("pie",fy);let{composed:px,noop:fv}=Je,{distribute:fx}=Vs,{series:Hm}=Ia,{arrayMax:Kp,clamp:Qp,defined:z0,pick:Xy,pushUnique:Zy,relativeLength:my}=Ht;(function(ie){let p={radialDistributionY:function(z,j){var X;return(((X=j.dataLabelPosition)==null?void 0:X.top)||0)+z.distributeBox.pos},radialDistributionX:function(z,j,X,re,de){let ne=de.dataLabelPosition;return z.getX(X<((ne==null?void 0:ne.top)||0)+2||X>((ne==null?void 0:ne.bottom)||0)-2?re:X,j.half,j,de)},justify:function(z,j,X,re){var de;return re[0]+(z.half?-1:1)*(X+(((de=j.dataLabelPosition)==null?void 0:de.distance)||0))},alignToPlotEdges:function(z,j,X,re){let de=z.getBBox().width;return j?de+re:X-de-re},alignToConnectors:function(z,j,X,re){let de=0,ne;return z.forEach(function(ce){(ne=ce.dataLabel.getBBox().width)>de&&(de=ne)}),j?de+re:X-de-re}};function b(z,j){let X=Math.PI/2,{start:re=0,end:de=0}=z.shapeArgs||{},ne=z.angle||0;j>0&&re<X&&de>X&&ne>X/2&&ne<1.5*X&&(ne=ne<=X?Math.max(X/2,(re+X)/2):Math.min(1.5*X,(X+de)/2));let{center:ce,options:ye}=this,Te=ce[2]/2,De=Math.cos(ne),Oe=Math.sin(ne),Be=ce[0]+De*Te,Ke=ce[1]+Oe*Te,st=Math.min((ye.slicedOffset||0)+(ye.borderWidth||0),j/5);return{natural:{x:Be+De*j,y:Ke+Oe*j},computed:{},alignment:j<0?"center":z.half?"right":"left",connectorPosition:{angle:ne,breakAt:{x:Be+De*st,y:Ke+Oe*st},touchingSliceAt:{x:Be,y:Ke}},distance:j}}function T(){var ci;let z=this,j=z.points,X=z.chart,re=X.plotWidth,de=X.plotHeight,ne=X.plotLeft,ce=Math.round(X.chartWidth/3),ye=z.center,Te=ye[2]/2,De=ye[1],Oe=[[],[]],Be=[0,0,0,0],Ke=z.dataLabelPositioners,st,Bt,Ut,$t=0;z.visible&&((ci=z.hasDataLabels)!=null&&ci.call(z))&&(j.forEach(oi=>{(oi.dataLabels||[]).forEach(di=>{di.shortened&&(di.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),di.shortened=!1)})}),Hm.prototype.drawDataLabels.apply(z),j.forEach(oi=>{(oi.dataLabels||[]).forEach((di,er)=>{var Wn;let Vi=ye[2]/2,lr=di.options,Vr=my((lr==null?void 0:lr.distance)||0,Vi);er===0&&Oe[oi.half].push(oi),!z0((Wn=lr==null?void 0:lr.style)==null?void 0:Wn.width)&&di.getBBox().width>ce&&(di.css({width:Math.round(.7*ce)+"px"}),di.shortened=!0),di.dataLabelPosition=this.getDataLabelPosition(oi,Vr),$t=Math.max($t,Vr)})}),Oe.forEach((oi,di)=>{let er=oi.length,Vi=[],lr,Vr,Wn=0,xn;er&&(z.sortByAngle(oi,di-.5),$t>0&&(lr=Math.max(0,De-Te-$t),Vr=Math.min(De+Te+$t,X.plotHeight),oi.forEach(Nn=>{(Nn.dataLabels||[]).forEach(Bn=>{var es;let Xn=Bn.dataLabelPosition;Xn&&Xn.distance>0&&(Xn.top=Math.max(0,De-Te-Xn.distance),Xn.bottom=Math.min(De+Te+Xn.distance,X.plotHeight),Wn=Bn.getBBox().height||21,Bn.lineHeight=X.renderer.fontMetrics(Bn.text||Bn).h+2*Bn.padding,Nn.distributeBox={target:(((es=Bn.dataLabelPosition)==null?void 0:es.natural.y)||0)-Xn.top+Bn.lineHeight/2,size:Wn,rank:Nn.y},Vi.push(Nn.distributeBox))})}),fx(Vi,xn=Vr+Wn-lr,xn/5)),oi.forEach(Nn=>{(Nn.dataLabels||[]).forEach(Bn=>{let Xn=Bn.options||{},es=Nn.distributeBox,ns=Bn.dataLabelPosition,Qs=(ns==null?void 0:ns.natural.y)||0,Nl=Xn.connectorPadding||0,Uo=Bn.lineHeight||21,jo=(Uo-Bn.getBBox().height)/2,mo=0,io=Qs,vc="inherit";if(ns){if(Vi&&z0(es)&&ns.distance>0&&(es.pos===void 0?vc="hidden":(Ut=es.size,io=Ke.radialDistributionY(Nn,Bn))),Xn.justify)mo=Ke.justify(Nn,Bn,Te,ye);else switch(Xn.alignTo){case"connectors":mo=Ke.alignToConnectors(oi,di,re,ne);break;case"plotEdges":mo=Ke.alignToPlotEdges(Bn,di,re,ne);break;default:mo=Ke.radialDistributionX(z,Nn,io-jo,Qs,Bn)}if(ns.attribs={visibility:vc,align:ns.alignment},ns.posAttribs={x:mo+(Xn.x||0)+({left:Nl,right:-Nl}[ns.alignment]||0),y:io+(Xn.y||0)-Uo/2},ns.computed.x=mo,ns.computed.y=io-jo,Xy(Xn.crop,!0)){let El;mo-(Bt=Bn.getBBox().width)<Nl&&di===1?(El=Math.round(Bt-mo+Nl),Be[3]=Math.max(El,Be[3])):mo+Bt>re-Nl&&di===0&&(El=Math.round(mo+Bt-re+Nl),Be[1]=Math.max(El,Be[1])),io-Ut/2<0?Be[0]=Math.max(Math.round(-io+Ut/2),Be[0]):io+Ut/2>de&&(Be[2]=Math.max(Math.round(io+Ut/2-de),Be[2])),ns.sideOverflow=El}}})}))}),(Kp(Be)===0||this.verifyDataLabelOverflow(Be))&&(this.placeDataLabels(),this.points.forEach(oi=>{(oi.dataLabels||[]).forEach(di=>{var Vr;let{connectorColor:er,connectorWidth:Vi=1}=di.options||{},lr=di.dataLabelPosition;if(Vi){let Wn;st=di.connector,lr&&lr.distance>0?(Wn=!st,st||(di.connector=st=X.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+oi.colorIndex+(oi.className?" "+oi.className:"")).add(z.dataLabelsGroup)),X.styledMode||st.attr({"stroke-width":Vi,stroke:er||oi.color||"#666666"}),st[Wn?"attr":"animate"]({d:oi.getConnectorPath(di)}),st.attr({visibility:(Vr=lr.attribs)==null?void 0:Vr.visibility})):st&&(di.connector=st.destroy())}})})))}function P(){this.points.forEach(z=>{(z.dataLabels||[]).forEach(j=>{var re,de;let X=j.dataLabelPosition;X?(X.sideOverflow&&(j.css({width:Math.max(j.getBBox().width-X.sideOverflow,0)+"px",textOverflow:((de=(re=j.options)==null?void 0:re.style)==null?void 0:de.textOverflow)||"ellipsis"}),j.shortened=!0),j.attr(X.attribs),j[j.moved?"animate":"attr"](X.posAttribs),j.moved=!0):j&&j.attr({y:-9999})}),delete z.distributeBox},this)}function O(z){let j=this.center,X=this.options,re=X.center,de=X.minSize||80,ne=de,ce=X.size!==null;return!ce&&(re[0]!==null?ne=Math.max(j[2]-Math.max(z[1],z[3]),de):(ne=Math.max(j[2]-z[1]-z[3],de),j[0]+=(z[3]-z[1])/2),re[1]!==null?ne=Qp(ne,de,j[2]-Math.max(z[0],z[2])):(ne=Qp(ne,de,j[2]-z[0]-z[2]),j[1]+=(z[0]-z[2])/2),ne<j[2]?(j[2]=ne,j[3]=Math.min(X.thickness?Math.max(0,ne-2*X.thickness):Math.max(0,my(X.innerSize||0,ne)),ne),this.translate(j),this.drawDataLabels&&this.drawDataLabels()):ce=!0),ce}ie.compose=function(z){if(Ah.compose(Hm),Zy(px,"PieDataLabel")){let j=z.prototype;j.dataLabelPositioners=p,j.alignDataLabel=fv,j.drawDataLabels=T,j.getDataLabelPosition=b,j.placeDataLabels=P,j.verifyDataLabelOverflow=O}}})(He||(He={}));let gy=He;(function(ie){ie.getCenterOfPoints=function(p){let b=p.reduce((T,P)=>(T.x+=P.x,T.y+=P.y,T),{x:0,y:0});return{x:b.x/p.length,y:b.y/p.length}},ie.getDistanceBetweenPoints=function(p,b){return Math.sqrt(Math.pow(b.x-p.x,2)+Math.pow(b.y-p.y,2))},ie.getAngleBetweenPoints=function(p,b){return Math.atan2(b.x-p.x,b.y-p.y)},ie.pointInPolygon=function({x:p,y:b},T){let P=T.length,O,z,j=!1;for(O=0,z=P-1;O<P;z=O++){let[X,re]=T[O],[de,ne]=T[z];re>b!=ne>b&&p<(de-X)*(b-re)/(ne-re)+X&&(j=!j)}return j}})(Ye||(Ye={}));let{pointInPolygon:yy}=Ye,{addEvent:A_,getAlignFactor:U0,fireEvent:Ky,objectEach:Bg,pick:Fg}=Ht;function mv(ie){let p=ie.length,b=(de,ne)=>!(ne.x>=de.x+de.width||ne.x+ne.width<=de.x||ne.y>=de.y+de.height||ne.y+ne.height<=de.y),T=(de,ne)=>{for(let ce of de)if(yy({x:ce[0],y:ce[1]},ne))return!0;return!1},P,O,z,j,X,re=!1;for(let de=0;de<p;de++)(P=ie[de])&&(P.oldOpacity=P.opacity,P.newOpacity=1,P.absoluteBox=function(ne){var ce,ye;if(ne&&(!ne.alignAttr||ne.placed)){let Te=ne.box?0:ne.padding||0,De=ne.alignAttr||{x:ne.attr("x"),y:ne.attr("y")},{height:Oe,polygon:Be,width:Ke}=ne.getBBox(),st=U0(ne.alignValue)*Ke;return ne.width=Ke,ne.height=Oe,{x:De.x+(((ce=ne.parentGroup)==null?void 0:ce.translateX)||0)+Te-st,y:De.y+(((ye=ne.parentGroup)==null?void 0:ye.translateY)||0)+Te,width:Ke-2*Te,height:Oe-2*Te,polygon:Be}}}(P));ie.sort((de,ne)=>(ne.labelrank||0)-(de.labelrank||0));for(let de=0;de<p;++de){j=(O=ie[de])&&O.absoluteBox;let ne=j==null?void 0:j.polygon;for(let ce=de+1;ce<p;++ce){X=(z=ie[ce])&&z.absoluteBox;let ye=!1;if(j&&X&&O!==z&&O.newOpacity!==0&&z.newOpacity!==0&&O.visibility!=="hidden"&&z.visibility!=="hidden"){let Te=X.polygon;if(ne&&Te&&ne!==Te?T(ne,Te)&&(ye=!0):b(j,X)&&(ye=!0),ye){let De=O.labelrank<z.labelrank?O:z,Oe=De.text;De.newOpacity=0,Oe!=null&&Oe.element.querySelector("textPath")&&Oe.hide()}}}}for(let de of ie)Ef(de,this)&&(re=!0);re&&Ky(this,"afterHideAllOverlappingLabels")}function Ef(ie,p){let b,T=!1;return ie&&(b=ie.newOpacity,ie.oldOpacity!==b&&(ie.hasClass("highcharts-data-label")?(ie[b?"removeClass":"addClass"]("highcharts-data-label-hidden"),T=!0,ie[ie.isOld?"animate":"attr"]({opacity:b},void 0,function(){p.styledMode||ie.css({pointerEvents:b?"auto":"none"})}),Ky(p,"afterHideOverlappingLabel")):ie.attr({opacity:b})),ie.isOld=!0),T}function Qy(){var b;let ie=this,p=[];for(let T of ie.labelCollectors||[])p=p.concat(T());for(let T of ie.yAxis||[])T.stacking&&T.options.stackLabels&&!T.options.stackLabels.allowOverlap&&Bg(T.stacking.stacks,P=>{Bg(P,O=>{O.label&&p.push(O.label)})});for(let T of ie.series||[])if(T.visible&&((b=T.hasDataLabels)!=null&&b.call(T))){let P=O=>{for(let z of O)z.visible&&(z.dataLabels||[]).forEach(j=>{var re;let X=j.options||{};j.labelrank=Fg(X.labelrank,z.labelrank,(re=z.shapeArgs)==null?void 0:re.height),X.allowOverlap??Number(X.distance)>0?(j.oldOpacity=j.opacity,j.newOpacity=1,Ef(j,ie)):p.push(j)})};P(T.nodes||[]),P(T.points)}this.hideOverlappingLabels(p)}let Jy={compose:function(ie){let p=ie.prototype;p.hideOverlappingLabels||(p.hideOverlappingLabels=mv,A_(ie,"render",Qy))}},{defaultOptions:gv}=vi,{noop:$0}=Je,{addEvent:yv,extend:mx,isObject:M_,merge:_v,relativeLength:I_}=Ht,vv={radius:0,scope:"stack",where:void 0},e0=$0,xv=$0;function bv(ie,p,b,T,P={}){let O=e0(ie,p,b,T,P),{innerR:z=0,r:j=b,start:X=0,end:re=0}=P;if(P.open||!P.borderRadius)return O;let de=re-X,ne=Math.sin(de/2),ce=Math.max(Math.min(I_(P.borderRadius||0,j-z),(j-z)/2,j*ne/(1+ne)),0),ye=Math.min(ce,de/Math.PI*2*z),Te=O.length-1;for(;Te--;)(function(De,Oe,Be){let Ke,st,Bt,Ut=De[Oe],$t=De[Oe+1];if($t[0]==="Z"&&($t=De[0]),(Ut[0]==="M"||Ut[0]==="L")&&$t[0]==="A"?(Ke=Ut,st=$t,Bt=!0):Ut[0]==="A"&&($t[0]==="M"||$t[0]==="L")&&(Ke=$t,st=Ut),Ke&&st&&st.params){let ci=st[1],oi=st[5],di=st.params,{start:er,end:Vi,cx:lr,cy:Vr}=di,Wn=oi?ci-Be:ci+Be,xn=Wn?Math.asin(Be/Wn):0,Nn=oi?xn:-xn,Bn=Math.cos(xn)*Wn;Bt?(di.start=er+Nn,Ke[1]=lr+Bn*Math.cos(er),Ke[2]=Vr+Bn*Math.sin(er),De.splice(Oe+1,0,["A",Be,Be,0,0,1,lr+ci*Math.cos(di.start),Vr+ci*Math.sin(di.start)])):(di.end=Vi-Nn,st[6]=lr+ci*Math.cos(di.end),st[7]=Vr+ci*Math.sin(di.end),De.splice(Oe+1,0,["A",Be,Be,0,0,1,lr+Bn*Math.cos(Vi),Vr+Bn*Math.sin(Vi)])),st[4]=Math.abs(di.end-di.start)<Math.PI?0:1}})(O,Te,Te>1?ye:ce);return O}function wv(){var ie,p;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:b,yAxis:T}=this,P=b.stacking==="percent",O=(p=(ie=gv.plotOptions)==null?void 0:ie[this.type])==null?void 0:p.borderRadius,z=ld(b.borderRadius,M_(O)?O:{}),j=T.options.reversed;for(let X of this.points){let{shapeArgs:re}=X;if(X.shapeType==="roundedRect"&&re){let{width:de=0,height:ne=0,y:ce=0}=re,ye=ce,Te=ne;if(z.scope==="stack"&&X.stackTotal){let Ke=T.translate(P?100:X.stackTotal,!1,!0,!1,!0),st=T.translate(b.threshold||0,!1,!0,!1,!0),Bt=this.crispCol(0,Math.min(Ke,st),0,Math.abs(Ke-st));ye=Bt.y,Te=Bt.height}let De=(X.negative?-1:1)*(j?-1:1)==-1,Oe=z.where;!Oe&&this.is("waterfall")&&Math.abs((X.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(Oe="all"),Oe||(Oe="end");let Be=Math.min(I_(z.radius,de),de/2,Oe==="all"?ne/2:1/0)||0;Oe==="end"&&(De&&(ye-=Be),Te+=Be),mx(re,{brBoxHeight:Te,brBoxY:ye,r:Be})}}}}function ld(ie,p){return M_(ie)||(ie={radius:ie||0}),_v(vv,p,ie)}function ve(){let ie=ld(this.options.borderRadius);for(let p of this.points){let b=p.shapeArgs;b&&(b.borderRadius=I_(ie.radius,(b.r||0)-(b.innerR||0)))}}function v(ie,p,b,T,P={}){let O=xv(ie,p,b,T,P),{r:z=0,brBoxHeight:j=T,brBoxY:X=p}=P,re=p-X,de=X+j-(p+T),ne=re-z>-.1?0:z,ce=de-z>-.1?0:z,ye=Math.max(ne&&re,0),Te=Math.max(ce&&de,0),De=[ie+ne,p],Oe=[ie+b-ne,p],Be=[ie+b,p+ne],Ke=[ie+b,p+T-ce],st=[ie+b-ce,p+T],Bt=[ie+ce,p+T],Ut=[ie,p+T-ce],$t=[ie,p+ne],ci=(oi,di)=>Math.sqrt(Math.pow(oi,2)-Math.pow(di,2));if(ye){let oi=ci(ne,ne-ye);De[0]-=oi,Oe[0]+=oi,Be[1]=$t[1]=p+ne-ye}if(T<ne-ye){let oi=ci(ne,ne-ye-T);Be[0]=Ke[0]=ie+b-ne+oi,st[0]=Math.min(Be[0],st[0]),Bt[0]=Math.max(Ke[0],Bt[0]),Ut[0]=$t[0]=ie+ne-oi,Be[1]=$t[1]=p+T}if(Te){let oi=ci(ce,ce-Te);st[0]+=oi,Bt[0]-=oi,Ke[1]=Ut[1]=p+T-ce+Te}if(T<ce-Te){let oi=ci(ce,ce-Te-T);Be[0]=Ke[0]=ie+b-ce+oi,Oe[0]=Math.min(Be[0],Oe[0]),De[0]=Math.max(Ke[0],De[0]),Ut[0]=$t[0]=ie+ce-oi,Ke[1]=Ut[1]=p}return O.length=0,O.push(["M",...De],["L",...Oe],["A",ne,ne,0,0,1,...Be],["L",...Ke],["A",ce,ce,0,0,1,...st],["L",...Bt],["A",ce,ce,0,0,1,...Ut],["L",...$t],["A",ne,ne,0,0,1,...De],["Z"]),O}let{diffObjects:k,extend:D,find:V,merge:H,pick:Y,uniqueKey:J}=Ht;(function(ie){function p(T,P){let O=T.condition;(O.callback||function(){return this.chartWidth<=Y(O.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=Y(O.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=Y(O.minWidth,0)&&this.chartHeight>=Y(O.minHeight,0)}).call(this)&&P.push(T._id)}function b(T,P){let O=this.options.responsive,z=this.currentResponsive,j=[],X;!P&&O&&O.rules&&O.rules.forEach(ne=>{ne._id===void 0&&(ne._id=J()),this.matchResponsiveRule(ne,j)},this);let re=H(...j.map(ne=>V((O==null?void 0:O.rules)||[],ce=>ce._id===ne)).map(ne=>ne==null?void 0:ne.chartOptions));re.isResponsiveOptions=!0,j=j.toString()||void 0;let de=z==null?void 0:z.ruleIds;j!==de&&(z&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(z.undoOptions,T,!0),this.updatingResponsive=!1),j?((X=k(re,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:j,mergedOptions:re,undoOptions:X},this.updatingResponsive||this.update(re,T,!0)):this.currentResponsive=void 0)}ie.compose=function(T){let P=T.prototype;return P.matchResponsiveRule||D(P,{matchResponsiveRule:p,setResponsive:b}),T}})(lt||(lt={}));let ae=lt;Je.AST=la,Je.Axis=wu,Je.Chart=Ql,Je.Color=ai,Je.DataLabel=Ah,Je.DataTableCore=Wd,Je.Fx=Qr,Je.HTMLElement=Oo,Je.Legend=Eg,Je.LegendSymbol=sa,Je.OverlappingDataLabels=Je.OverlappingDataLabels||Jy,Je.PlotLineOrBand=fp,Je.Point=yl,Je.Pointer=Uh,Je.RendererRegistry=ca,Je.Series=Vc,Je.SeriesRegistry=Ia,Je.StackItem=C,Je.SVGElement=Qa,Je.SVGRenderer=or,Je.Templating=ba,Je.Tick=uo,Je.Time=hl,Je.Tooltip=gp,Je.animate=zr.animate,Je.animObject=zr.animObject,Je.chart=Ql.chart,Je.color=ai.parse,Je.dateFormat=ba.dateFormat,Je.defaultOptions=vi.defaultOptions,Je.distribute=Vs.distribute,Je.format=ba.format,Je.getDeferredAnimation=zr.getDeferredAnimation,Je.getOptions=vi.getOptions,Je.numberFormat=ba.numberFormat,Je.seriesType=Ia.seriesType,Je.setAnimation=zr.setAnimation,Je.setOptions=vi.setOptions,Je.stop=zr.stop,Je.time=vi.defaultTime,Je.timers=Qr.timers,{compose:function(ie,p,b){let T=ie.types.pie;if(!p.symbolCustomAttribs.includes("borderRadius")){let P=b.prototype.symbols;yv(ie,"afterColumnTranslate",wv,{order:9}),yv(T,"afterTranslate",ve),p.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),e0=P.arc,xv=P.roundedRect,P.arc=bv,P.roundedRect=v}},optionsToObject:ld}.compose(Je.Series,Je.SVGElement,Je.SVGRenderer),Qd.compose(Je.Series.types.column),Ah.compose(Je.Series),Su.compose(Je.Axis),Oo.compose(Je.SVGRenderer),Eg.compose(Je.Chart),pf.compose(Je.Axis),Jy.compose(Je.Chart),gy.compose(Je.Series.types.pie),fp.compose(Je.Chart,Je.Axis),Uh.compose(Je.Chart),ae.compose(Je.Chart),Nu.compose(Je.Axis,Je.Chart,Je.Series),Et.compose(Je.Axis,Je.Chart,Je.Series),gp.compose(Je.Pointer),Ht.extend(Je,Ht);let{tooltipFormatter:_e}=yl.prototype,{addEvent:Me,arrayMax:xe,arrayMin:Pe,correctFloat:je,defined:Qe,isArray:at,isNumber:nt,isString:it,pick:wt}=Ht;(function(ie){function p(ne,ce,ye){!this.isXAxis&&(this.series.forEach(function(Te){ne==="compare"&&typeof ce!="boolean"?Te.setCompare(ce,!1):ne!=="cumulative"||it(ce)||Te.setCumulative(ce,!1)}),wt(ye,!0)&&this.chart.redraw())}function b(ne){let ce=this,{numberFormatter:ye}=ce.series.chart,Te=function(De){ne=ne.replace("{point."+De+"}",(ce[De]>0&&De==="change"?"+":"")+ye(ce[De],wt(ce.series.tooltipOptions.changeDecimals,2)))};return Qe(ce.change)&&Te("change"),Qe(ce.cumulativeSum)&&Te("cumulativeSum"),_e.apply(this,[ne])}function T(){let ne,ce=this.options.compare;(ce==="percent"||ce==="value"||this.options.cumulative)&&(ne=new de(this),ce==="percent"||ce==="value"?ne.initCompare(ce):ne.initCumulative()),this.dataModify=ne}function P(ne){let ce=ne.dataExtremes,ye=ce.activeYData;if(this.dataModify&&ce){let Te;this.options.compare?Te=[this.dataModify.modifyValue(ce.dataMin),this.dataModify.modifyValue(ce.dataMax)]:this.options.cumulative&&at(ye)&&ye.length>=2&&(Te=de.getCumulativeExtremes(ye)),Te&&(ce.dataMin=Pe(Te),ce.dataMax=xe(Te))}}function O(ne,ce){this.options.compare=this.userOptions.compare=ne,this.update({},wt(ce,!0)),this.dataModify&&(ne==="value"||ne==="percent")?this.dataModify.initCompare(ne):this.points.forEach(ye=>{delete ye.change})}function z(){let ne=this.getColumn(this.pointArrayMap&&(this.options.pointValKey||this.pointValKey)||"y",!0);if(this.xAxis&&ne.length&&this.dataModify){let ce=this.getColumn("x",!0),ye=this.dataTable.rowCount,Te=+(this.options.compareStart!==!0);for(let De=0;De<ye-Te;De++){let Oe=ne[De];if(nt(Oe)&&Oe!==0&&ce[De+Te]>=(this.xAxis.min||0)){this.dataModify.compareValue=Oe;break}}}}function j(ne,ce){this.setModifier("compare",ne,ce)}function X(ne,ce){ne=wt(ne,!1),this.options.cumulative=this.userOptions.cumulative=ne,this.update({},wt(ce,!0)),this.dataModify?this.dataModify.initCumulative():this.points.forEach(ye=>{delete ye.cumulativeSum})}function re(ne,ce){this.setModifier("cumulative",ne,ce)}ie.compose=function(ne,ce,ye){let Te=ce.prototype,De=ye.prototype,Oe=ne.prototype;return Oe.setCompare||(Oe.setCompare=O,Oe.setCumulative=X,Me(ne,"afterInit",T),Me(ne,"afterGetExtremes",P),Me(ne,"afterProcessData",z)),Te.setCompare||(Te.setCompare=j,Te.setModifier=p,Te.setCumulative=re,De.tooltipFormatter=b),ne};class de{constructor(ce){this.series=ce}modifyValue(){return 0}static getCumulativeExtremes(ce){let ye=1/0,Te=-1/0;return ce.reduce((De,Oe)=>{let Be=De+Oe;return ye=Math.min(ye,Be,De),Te=Math.max(Te,Be,De),Be}),[ye,Te]}initCompare(ce){this.modifyValue=function(ye,Te){ye===null&&(ye=0);let De=this.compareValue;if(ye!==void 0&&De!==void 0){if(ce==="value"?ye-=De:ye=ye/De*100-100*(this.series.options.compareBase!==100),Te!==void 0){let Oe=this.series.points[Te];Oe&&(Oe.change=ye)}return ye}return 0}}initCumulative(){this.modifyValue=function(ce,ye){if(ce===null&&(ce=0),ce!==void 0&&ye!==void 0){let Te=ye>0?this.series.points[ye-1]:null;Te&&Te.cumulativeSum&&(ce=je(Te.cumulativeSum+ce));let De=this.series.points[ye],Oe=De.series.options.cumulativeStart,Be=De.x<=this.series.xAxis.max&&De.x>=this.series.xAxis.min;return De&&(!Oe||Be?De.cumulativeSum=ce:De.cumulativeSum=void 0),ce}return 0}}}ie.Additions=de})(Pt||(Pt={}));let kt=Pt,{isTouchDevice:Ai}=Je,{addEvent:ki,merge:Ri,pick:Sr}=Ht,hr=[];function wr(){this.navigator&&this.navigator.setBaseSeries(null,!1)}function Jr(){var O;let ie,p,b,T=this.legend,P=this.navigator;if(P){ie=T&&T.options,p=P.xAxis,b=P.yAxis;let{scrollbarHeight:z,scrollButtonSize:j}=P;this.inverted?(P.left=P.opposite?this.chartWidth-z-P.height:this.spacing[3]+z,P.top=this.plotTop+j):(P.left=Sr(p.left,this.plotLeft+j),P.top=P.navigatorOptions.top||this.chartHeight-P.height-z-(((O=this.scrollbar)==null?void 0:O.options.margin)||0)-this.spacing[2]-(this.rangeSelector&&this.extraBottomMargin?this.rangeSelector.getHeight():0)-(ie&&ie.verticalAlign==="bottom"&&ie.layout!=="proximate"&&ie.enabled&&!ie.floating?T.legendHeight+Sr(ie.margin,10):0)-(this.titleOffset?this.titleOffset[2]:0)),p&&b&&(this.inverted?p.options.left=b.options.left=P.left:p.options.top=b.options.top=P.top,p.setAxisSize(),b.setAxisSize())}}function yn(ie){!this.navigator&&!this.scroller&&(this.options.navigator.enabled||this.options.scrollbar.enabled)&&(this.scroller=this.navigator=new a(this),Sr(ie.redraw,!0)&&this.redraw(ie.animation))}function Rn(){let ie=this.options;(ie.navigator.enabled||ie.scrollbar.enabled)&&(this.scroller=this.navigator=new a(this))}function fn(){let ie=this.options,p=ie.navigator,b=ie.rangeSelector;if((p&&p.enabled||b&&b.enabled)&&(!Ai&&this.zooming.type==="x"||Ai&&this.zooming.pinchType==="x"))return!1}function ms(ie){let p=ie.navigator;if(p&&ie.xAxis[0]){let b=ie.xAxis[0].getExtremes();p.render(b.min,b.max)}}function hs(ie){let p=ie.options.navigator||{},b=ie.options.scrollbar||{};!this.navigator&&!this.scroller&&(p.enabled||b.enabled)&&(Ri(!0,this.options.navigator,p),Ri(!0,this.options.scrollbar,b),delete ie.options.navigator,delete ie.options.scrollbar)}let Is={compose:function(ie,p){if(Ht.pushUnique(hr,ie)){let b=ie.prototype;a=p,b.callbacks.push(ms),ki(ie,"afterAddSeries",wr),ki(ie,"afterSetChartSize",Jr),ki(ie,"afterUpdate",yn),ki(ie,"beforeRender",Rn),ki(ie,"beforeShowResetZoom",fn),ki(ie,"update",hs)}}},{isTouchDevice:jn}=Je,{addEvent:us,correctFloat:oa,defined:Ea,isNumber:ka,pick:Mh}=Ht;function da(){this.navigatorAxis||(this.navigatorAxis=new Co(this))}function Ol(ie){let p,b=this.chart,T=b.options,P=T.navigator,O=this.navigatorAxis,z=b.zooming.pinchType,j=T.rangeSelector,X=b.zooming.type;if(this.isXAxis&&(P!=null&&P.enabled||j!=null&&j.enabled)){if(X==="y"&&ie.trigger==="zoom")p=!1;else if((ie.trigger==="zoom"&&X==="xy"||jn&&z==="xy")&&this.options.range){let re=O.previousZoom;Ea(ie.min)?O.previousZoom=[this.min,this.max]:re&&(ie.min=re[0],ie.max=re[1],O.previousZoom=void 0)}}p!==void 0&&ie.preventDefault()}class Co{static compose(p){p.keepProps.includes("navigatorAxis")||(p.keepProps.push("navigatorAxis"),us(p,"init",da),us(p,"setExtremes",Ol))}constructor(p){this.axis=p}destroy(){this.axis=void 0}toFixedRange(p,b,T,P){let O=this.axis,z=(O.pointRange||0)/2,j=Mh(T,O.translate(p,!0,!O.horiz)),X=Mh(P,O.translate(b,!0,!O.horiz));return Ea(T)||(j=oa(j+z)),Ea(P)||(X=oa(X-z)),ka(j)&&ka(X)||(j=X=void 0),{min:j,max:X}}}let{parse:Os}=ai,{seriesTypes:Us}=Ia,tl={height:40,margin:22,maskInside:!0,handles:{width:7,borderRadius:0,height:15,symbols:["navigator-handle","navigator-handle"],enabled:!0,lineWidth:1,backgroundColor:"#f2f2f2",borderColor:"#999999"},maskFill:Os("#667aff").setOpacity(.3).get(),outlineColor:"#999999",outlineWidth:1,series:{type:Us.areaspline===void 0?"line":"areaspline",fillOpacity:.05,lineWidth:1,compare:null,sonification:{enabled:!1},dataGrouping:{approximation:"average",enabled:!0,groupPixelWidth:2,firstAnchor:"firstPoint",anchor:"middle",lastAnchor:"lastPoint",units:[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2,3,4]],["week",[1,2,3]],["month",[1,3,6]],["year",null]]},dataLabels:{enabled:!1,zIndex:2},id:"highcharts-navigator-series",className:"highcharts-navigator-series",lineColor:null,marker:{enabled:!1},threshold:null},xAxis:{className:"highcharts-navigator-xaxis",tickLength:0,lineWidth:0,gridLineColor:"#e6e6e6",id:"navigator-x-axis",gridLineWidth:1,tickPixelInterval:200,labels:{align:"left",style:{color:"#000000",fontSize:"0.7em",opacity:.6,textOutline:"2px contrast"},x:3,y:-4},crosshair:!1},yAxis:{className:"highcharts-navigator-yaxis",gridLineWidth:0,startOnTick:!1,endOnTick:!1,minPadding:.1,id:"navigator-y-axis",maxPadding:.1,labels:{enabled:!1},crosshair:!1,title:{text:void 0},tickLength:0,tickWidth:0}},{relativeLength:pa}=Ht,Ih={"navigator-handle":function(ie,p,b,T,P={}){let O=P.width?P.width/2:b,z=pa(P.borderRadius||0,Math.min(2*O,T));return[["M",-1.5,(T=P.height||T)/2-3.5],["L",-1.5,T/2+4.5],["M",.5,T/2-3.5],["L",.5,T/2+4.5],...zh.rect(-O-1,.5,2*O+1,T,{r:z})]}},{defined:nh}=Ht,va={setFixedRange:function(ie){let p=this.xAxis[0];nh(p.dataMax)&&nh(p.dataMin)&&ie?this.fixedRange=Math.min(ie,p.dataMax-p.dataMin):this.fixedRange=ie}},{defaultOptions:ou}=vi,{composed:Lh}=Je,{getRendererType:Rl}=ca,{setFixedRange:t0}=va,{addEvent:Gm,extend:kf,pushUnique:_y}=Ht;function ip(){this.chart.navigator&&!this.options.isInternal&&this.chart.navigator.setBaseSeries(null,!1)}let qm={compose:function(ie,p,b){Co.compose(p),_y(Lh,"Navigator")&&(ie.prototype.setFixedRange=t0,kf(Rl().prototype.symbols,Ih),kf(ou,{navigator:tl}),Gm(b,"afterUpdate",ip))}},{composed:L_}=Je,{addEvent:D_,defined:i0,pick:P_,pushUnique:gx}=Ht;(function(ie){let p;function b(z){var re,de;let j=P_((re=z.options)==null?void 0:re.min,z.min),X=P_((de=z.options)==null?void 0:de.max,z.max);return{axisMin:j,axisMax:X,scrollMin:i0(z.dataMin)?Math.min(j,z.min,z.dataMin,P_(z.threshold,1/0)):j,scrollMax:i0(z.dataMax)?Math.max(X,z.max,z.dataMax,P_(z.threshold,-1/0)):X}}function T(){let z=this.scrollbar,j=z&&!z.options.opposite,X=this.horiz?2:j?3:1;z&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[X]+=z.size+(z.options.margin||0))}function P(){var j,X;let z=this;(X=(j=z.options)==null?void 0:j.scrollbar)!=null&&X.enabled&&(z.options.scrollbar.vertical=!z.horiz,z.options.startOnTick=z.options.endOnTick=!1,z.scrollbar=new p(z.chart.renderer,z.options.scrollbar,z.chart),D_(z.scrollbar,"changed",function(re){let de,ne,{axisMin:ce,axisMax:ye,scrollMin:Te,scrollMax:De}=b(z),Oe=De-Te;if(i0(ce)&&i0(ye))if(z.horiz&&!z.reversed||!z.horiz&&z.reversed?(de=Te+Oe*this.to,ne=Te+Oe*this.from):(de=Te+Oe*(1-this.from),ne=Te+Oe*(1-this.to)),this.shouldUpdateExtremes(re.DOMType)){let Be=re.DOMType!=="mousemove"&&re.DOMType!=="touchmove"&&void 0;z.setExtremes(ne,de,!0,Be,re)}else this.setRange(this.from,this.to)}))}function O(){let z,j,X,{scrollMin:re,scrollMax:de}=b(this),ne=this.scrollbar,ce=this.axisTitleMargin+(this.titleOffset||0),ye=this.chart.scrollbarsOffsets,Te=this.options.margin||0;if(ne&&ye){if(this.horiz)this.opposite||(ye[1]+=ce),ne.position(this.left,this.top+this.height+2+ye[1]-(this.opposite?Te:0),this.width,this.height),this.opposite||(ye[1]+=Te),z=1;else{let De;this.opposite&&(ye[0]+=ce),De=ne.options.opposite?this.left+this.width+2+ye[0]-(this.opposite?0:Te):this.opposite?0:Te,ne.position(De,this.top,this.width,this.height),this.opposite&&(ye[0]+=Te),z=0}if(ye[z]+=ne.size+(ne.options.margin||0),isNaN(re)||isNaN(de)||!i0(this.min)||!i0(this.max)||this.dataMin===this.dataMax)ne.setRange(0,1);else if(this.min===this.max){let De=this.pointRange/(this.dataMax+1);j=De*this.min,X=De*(this.max+1),ne.setRange(j,X)}else j=(this.min-re)/(de-re),X=(this.max-re)/(de-re),this.horiz&&!this.reversed||!this.horiz&&this.reversed?ne.setRange(j,X):ne.setRange(1-X,1-j)}}ie.compose=function(z,j){gx(L_,"Axis.Scrollbar")&&(p=j,D_(z,"afterGetOffset",T),D_(z,"afterInit",P),D_(z,"afterRender",O))}})(At||(At={}));let Ym=At,O_={height:10,barBorderRadius:5,buttonBorderRadius:0,buttonsEnabled:!1,liveRedraw:void 0,margin:void 0,minWidth:6,opposite:!0,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:0,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"none",trackBackgroundColor:"rgba(255, 255, 255, 0.001)",trackBorderColor:"#cccccc",trackBorderRadius:5,trackBorderWidth:1},{defaultOptions:Sv}=vi,{composed:yw}=Je,{addEvent:yx,correctFloat:r0,crisp:Tv,defined:Cb,destroyObjectProperties:Fu,extend:cd,fireEvent:V0,merge:R_,pick:W0,pushUnique:Cv,removeEvent:_x}=Ht;class vy{static compose(p){Ym.compose(p,vy),Cv(yw,"Scrollbar")&&cd(Sv,{scrollbar:O_})}static swapXY(p,b){return b&&p.forEach(T=>{let P,O=T.length;for(let z=0;z<O;z+=2)typeof(P=T[z+1])=="number"&&(T[z+1]=T[z+2],T[z+2]=P)}),p}constructor(p,b,T){this._events=[],this.chartX=0,this.chartY=0,this.from=0,this.scrollbarButtons=[],this.scrollbarLeft=0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.trackBorderWidth=1,this.x=0,this.y=0,this.init(p,b,T)}addEvents(){let p=this.options.inverted?[1,0]:[0,1],b=this.scrollbarButtons,T=this.scrollbarGroup.element,P=this.track.element,O=this.mouseDownHandler.bind(this),z=this.mouseMoveHandler.bind(this),j=this.mouseUpHandler.bind(this),X=[[b[p[0]].element,"click",this.buttonToMinClick.bind(this)],[b[p[1]].element,"click",this.buttonToMaxClick.bind(this)],[P,"click",this.trackClick.bind(this)],[T,"mousedown",O],[T.ownerDocument,"mousemove",z],[T.ownerDocument,"mouseup",j],[T,"touchstart",O],[T.ownerDocument,"touchmove",z],[T.ownerDocument,"touchend",j]];X.forEach(function(re){yx.apply(null,re)}),this._events=X}buttonToMaxClick(p){let b=(this.to-this.from)*W0(this.options.step,.2);this.updatePosition(this.from+b,this.to+b),V0(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:p})}buttonToMinClick(p){let b=r0(this.to-this.from)*W0(this.options.step,.2);this.updatePosition(r0(this.from-b),r0(this.to-b)),V0(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:p})}cursorToScrollbarPosition(p){let b=this.options,T=b.minWidth>this.calculatedWidth?b.minWidth:0;return{chartX:(p.chartX-this.x-this.xOffset)/(this.barWidth-T),chartY:(p.chartY-this.y-this.yOffset)/(this.barWidth-T)}}destroy(){let p=this,b=p.chart.scroller;p.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(T){p[T]&&p[T].destroy&&(p[T]=p[T].destroy())}),b&&p===b.scrollbar&&(b.scrollbar=null,Fu(b.scrollbarButtons))}drawScrollbarButton(p){let b=this.renderer,T=this.scrollbarButtons,P=this.options,O=this.size,z=b.g().add(this.group);if(T.push(z),P.buttonsEnabled){let j=b.rect().addClass("highcharts-scrollbar-button").add(z);this.chart.styledMode||j.attr({stroke:P.buttonBorderColor,"stroke-width":P.buttonBorderWidth,fill:P.buttonBackgroundColor}),j.attr(j.crisp({x:-.5,y:-.5,width:O,height:O,r:P.buttonBorderRadius},j.strokeWidth()));let X=b.path(vy.swapXY([["M",O/2+(p?-1:1),O/2-3],["L",O/2+(p?-1:1),O/2+3],["L",O/2+(p?2:-2),O/2]],P.vertical)).addClass("highcharts-scrollbar-arrow").add(T[p]);this.chart.styledMode||X.attr({fill:P.buttonArrowColor})}}init(p,b,T){this.scrollbarButtons=[],this.renderer=p,this.userOptions=b,this.options=R_(O_,Sv.scrollbar,b),this.options.margin=W0(this.options.margin,10),this.chart=T,this.size=W0(this.options.size,this.options.height),b.enabled&&(this.render(),this.addEvents())}mouseDownHandler(p){var P;let b=((P=this.chart.pointer)==null?void 0:P.normalize(p))||p,T=this.cursorToScrollbarPosition(b);this.chartX=T.chartX,this.chartY=T.chartY,this.initPositions=[this.from,this.to],this.grabbedCenter=!0}mouseMoveHandler(p){var z;let b,T=((z=this.chart.pointer)==null?void 0:z.normalize(p))||p,P=this.options.vertical?"chartY":"chartX",O=this.initPositions||[];this.grabbedCenter&&(!p.touches||p.touches[0][P]!==0)&&(b=this.cursorToScrollbarPosition(T)[P]-this[P],this.hasDragged=!0,this.updatePosition(O[0]+b,O[1]+b),this.hasDragged&&V0(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:p.type,DOMEvent:p}))}mouseUpHandler(p){this.hasDragged&&V0(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:p.type,DOMEvent:p}),this.grabbedCenter=this.hasDragged=this.chartX=this.chartY=null}position(p,b,T,P){let{buttonsEnabled:O,margin:z=0,vertical:j}=this.options,X=this.rendered?"animate":"attr",re=P,de=0;this.group.show(),this.x=p,this.y=b+this.trackBorderWidth,this.width=T,this.height=P,this.xOffset=re,this.yOffset=de,j?(this.width=this.yOffset=T=de=this.size,this.xOffset=re=0,this.yOffset=de=O?this.size:0,this.barWidth=P-(O?2*T:0),this.x=p+=z):(this.height=P=this.size,this.xOffset=re=O?this.size:0,this.barWidth=T-(O?2*P:0),this.y=this.y+z),this.group[X]({translateX:p,translateY:this.y}),this.track[X]({width:T,height:P}),this.scrollbarButtons[1][X]({translateX:j?0:T-re,translateY:j?P-de:0})}removeEvents(){this._events.forEach(function(p){_x.apply(null,p)}),this._events.length=0}render(){let p=this.renderer,b=this.options,T=this.size,P=this.chart.styledMode,O=p.g("scrollbar").attr({zIndex:b.zIndex}).hide().add();this.group=O,this.track=p.rect().addClass("highcharts-scrollbar-track").attr({r:b.trackBorderRadius||0,height:T,width:T}).add(O),P||this.track.attr({fill:b.trackBackgroundColor,stroke:b.trackBorderColor,"stroke-width":b.trackBorderWidth});let z=this.trackBorderWidth=this.track.strokeWidth();this.track.attr({x:-Tv(0,z),y:-Tv(0,z)}),this.scrollbarGroup=p.g().add(O),this.scrollbar=p.rect().addClass("highcharts-scrollbar-thumb").attr({height:T-z,width:T-z,r:b.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=p.path(vy.swapXY([["M",-3,T/4],["L",-3,2*T/3],["M",0,T/4],["L",0,2*T/3],["M",3,T/4],["L",3,2*T/3]],b.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),P||(this.scrollbar.attr({fill:b.barBackgroundColor,stroke:b.barBorderColor,"stroke-width":b.barBorderWidth}),this.scrollbarRifles.attr({stroke:b.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-Tv(0,this.scrollbarStrokeWidth),-Tv(0,this.scrollbarStrokeWidth)),this.drawScrollbarButton(0),this.drawScrollbarButton(1)}setRange(p,b){let T,P,O=this.options,z=O.vertical,j=O.minWidth,X=this.barWidth,re=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";if(!Cb(X))return;let de=X*Math.min(b,1);T=Math.ceil(X*(p=Math.max(p,0))),this.calculatedWidth=P=r0(de-T),P<j&&(T=(X-j+P)*p,P=j);let ne=Math.floor(T+this.xOffset+this.yOffset),ce=P/2-.5;this.from=p,this.to=b,z?(this.scrollbarGroup[re]({translateY:ne}),this.scrollbar[re]({height:P}),this.scrollbarRifles[re]({translateY:ce}),this.scrollbarTop=ne,this.scrollbarLeft=0):(this.scrollbarGroup[re]({translateX:ne}),this.scrollbar[re]({width:P}),this.scrollbarRifles[re]({translateX:ce}),this.scrollbarLeft=ne,this.scrollbarTop=0),P<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(),O.showFull===!1&&(p<=0&&b>=1?this.group.hide():this.group.show()),this.rendered=!0}shouldUpdateExtremes(p){return W0(this.options.liveRedraw,Je.svg&&!Je.isTouchDevice&&!this.chart.boosted)||p==="mouseup"||p==="touchend"||!Cb(p)}trackClick(p){var z;let b=((z=this.chart.pointer)==null?void 0:z.normalize(p))||p,T=this.to-this.from,P=this.y+this.scrollbarTop,O=this.x+this.scrollbarLeft;this.options.vertical&&b.chartY>P||!this.options.vertical&&b.chartX>O?this.updatePosition(this.from+T,this.to+T):this.updatePosition(this.from-T,this.to-T),V0(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:p})}update(p){this.destroy(),this.init(this.chart.renderer,R_(!0,this.options,p),this.chart)}updatePosition(p,b){b>1&&(p=r0(1-r0(b-p)),b=1),p<0&&(b=r0(b-p),p=0),this.from=p,this.to=b}}vy.defaultOptions=O_;let{defaultOptions:vx}=vi,{isTouchDevice:xx}=Je,{prototype:{symbols:bx}}=or,{addEvent:zu,clamp:wx,correctFloat:n0,defined:xy,destroyObjectProperties:Sx,erase:j0,extend:_w,find:vw,fireEvent:by,isArray:Tx,isNumber:hd,merge:Xm,pick:ud,removeEvent:s0,splat:o0}=Ht;function H0(ie,...p){let b=[].filter.call(p,hd);if(b.length)return Math[ie].apply(0,b)}class N_{static compose(p,b,T){Is.compose(p,N_),qm.compose(p,b,T)}constructor(p){this.isDirty=!1,this.scrollbarHeight=0,this.init(p)}drawHandle(p,b,T,P){let O=this.navigatorOptions.handles.height;this.handles[b][P](T?{translateX:Math.round(this.left+this.height/2),translateY:Math.round(this.top+parseInt(p,10)+.5-O)}:{translateX:Math.round(this.left+parseInt(p,10)),translateY:Math.round(this.top+this.height/2-O/2-1)})}drawOutline(p,b,T,P){let O=this.navigatorOptions.maskInside,z=this.outline.strokeWidth(),j=z/2,X=z%2/2,re=this.scrollButtonSize,de=this.size,ne=this.top,ce=this.height,ye=ne-j,Te=ne+ce,De=this.left,Oe,Be;T?(Oe=ne+b+X,b=ne+p+X,Be=[["M",De+ce,ne-re-X],["L",De+ce,Oe],["L",De,Oe],["M",De,b],["L",De+ce,b],["L",De+ce,ne+de+re]],O&&Be.push(["M",De+ce,Oe-j],["L",De+ce,b+j])):(De-=re,p+=De+re-X,b+=De+re-X,Be=[["M",De,ye],["L",p,ye],["L",p,Te],["M",b,Te],["L",b,ye],["L",De+de+2*re,ye]],O&&Be.push(["M",p-j,ye],["L",b+j,ye])),this.outline[P]({d:Be})}drawMasks(p,b,T,P){let O,z,j,X,re=this.left,de=this.top,ne=this.height;T?(j=[re,re,re],X=[de,de+p,de+b],z=[ne,ne,ne],O=[p,b-p,this.size-b]):(j=[re,re+p,re+b],X=[de,de,de],z=[p,b-p,this.size-b],O=[ne,ne,ne]),this.shades.forEach((ce,ye)=>{ce[P]({x:j[ye],y:X[ye],width:z[ye],height:O[ye]})})}renderElements(){var re;let p=this,b=p.navigatorOptions,T=b.maskInside,P=p.chart,O=P.inverted,z=P.renderer,j={cursor:O?"ns-resize":"ew-resize"},X=p.navigatorGroup??(p.navigatorGroup=z.g("navigator").attr({zIndex:8,visibility:"hidden"}).add());if([!T,T,!T].forEach((de,ne)=>{let ce=p.shades[ne]??(p.shades[ne]=z.rect().addClass("highcharts-navigator-mask"+(ne===1?"-inside":"-outside")).add(X));P.styledMode||(ce.attr({fill:de?b.maskFill:"rgba(0,0,0,0)"}),ne===1&&ce.css(j))}),p.outline||(p.outline=z.path().addClass("highcharts-navigator-outline").add(X)),P.styledMode||p.outline.attr({"stroke-width":b.outlineWidth,stroke:b.outlineColor}),(re=b.handles)==null?void 0:re.enabled){let de=b.handles,{height:ne,width:ce}=de;[0,1].forEach(ye=>{var De;let Te=de.symbols[ye];if(p.handles[ye]&&p.handles[ye].symbolUrl===Te){if(!p.handles[ye].isImg&&p.handles[ye].symbolName!==Te){let Oe=bx[Te].call(bx,-ce/2-1,0,ce,ne);p.handles[ye].attr({d:Oe}),p.handles[ye].symbolName=Te}}else(De=p.handles[ye])==null||De.destroy(),p.handles[ye]=z.symbol(Te,-ce/2-1,0,ce,ne,de),p.handles[ye].attr({zIndex:7-ye}).addClass("highcharts-navigator-handle highcharts-navigator-handle-"+["left","right"][ye]).add(X),p.addMouseEvents();P.inverted&&p.handles[ye].attr({rotation:90,rotationOriginX:Math.floor(-ce/2),rotationOriginY:(ne+ce)/2}),P.styledMode||p.handles[ye].attr({fill:de.backgroundColor,stroke:de.borderColor,"stroke-width":de.lineWidth,width:de.width,height:de.height,x:-ce/2-1,y:0}).css(j)})}}update(p,b=!1){var O;let T=this.chart,P=T.options.chart.inverted!==((O=T.scrollbar)==null?void 0:O.options.vertical);if(Xm(!0,T.options.navigator,p),this.navigatorOptions=T.options.navigator||{},this.setOpposite(),xy(p.enabled)||P)return this.destroy(),this.navigatorEnabled=p.enabled||this.navigatorEnabled,this.init(T);if(this.navigatorEnabled&&(this.isDirty=!0,p.adaptToUpdatedData===!1&&this.baseSeries.forEach(z=>{s0(z,"updatedData",this.updatedDataHandler)},this),p.adaptToUpdatedData&&this.baseSeries.forEach(z=>{z.eventsToUnbind.push(zu(z,"updatedData",this.updatedDataHandler))},this),(p.series||p.baseSeries)&&this.setBaseSeries(void 0,!1),p.height||p.xAxis||p.yAxis)){this.height=p.height??this.height;let z=this.getXAxisOffsets();this.xAxis.update({...p.xAxis,offsets:z,[T.inverted?"width":"height"]:this.height,[T.inverted?"height":"width"]:void 0},!1),this.yAxis.update({...p.yAxis,[T.inverted?"width":"height"]:this.height},!1)}b&&T.redraw()}render(p,b,T,P){let O=this.chart,z=this.xAxis,j=z.pointRange||0,X=z.navigatorAxis.fake?O.xAxis[0]:z,re=this.navigatorEnabled,de=this.rendered,ne=O.inverted,ce=O.xAxis[0].minRange,ye=O.xAxis[0].options.maxRange,Te=this.scrollButtonSize,De,Oe,Be,Ke=this.scrollbarHeight,st,Bt;if(this.hasDragged&&!xy(T))return;if(this.isDirty&&this.renderElements(),p=n0(p-j/2),b=n0(b+j/2),!hd(p)||!hd(b))if(de)T=0,P=ud(z.width,X.width);else return;this.left=ud(z.left,O.plotLeft+Te+(ne?O.plotWidth:0));let Ut=this.size=st=ud(z.len,(ne?O.plotHeight:O.plotWidth)-2*Te);De=ne?Ke:st+2*Te,T=ud(T,z.toPixels(p,!0)),P=ud(P,z.toPixels(b,!0)),hd(T)&&Math.abs(T)!==1/0||(T=0,P=De);let $t=z.toValue(T,!0),ci=z.toValue(P,!0),oi=Math.abs(n0(ci-$t));oi<ce?this.grabbedLeft?T=z.toPixels(ci-ce-j,!0):this.grabbedRight&&(P=z.toPixels($t+ce+j,!0)):xy(ye)&&n0(oi-j)>ye&&(this.grabbedLeft?T=z.toPixels(ci-ye-j,!0):this.grabbedRight&&(P=z.toPixels($t+ye+j,!0))),this.zoomedMax=wx(Math.max(T,P),0,Ut),this.zoomedMin=wx(this.fixedWidth?this.zoomedMax-this.fixedWidth:Math.min(T,P),0,Ut),this.range=this.zoomedMax-this.zoomedMin,Ut=Math.round(this.zoomedMax);let di=Math.round(this.zoomedMin);re&&(this.navigatorGroup.attr({visibility:"inherit"}),Bt=de&&!this.hasDragged?"animate":"attr",this.drawMasks(di,Ut,ne,Bt),this.drawOutline(di,Ut,ne,Bt),this.navigatorOptions.handles.enabled&&(this.drawHandle(di,0,ne,Bt),this.drawHandle(Ut,1,ne,Bt))),this.scrollbar&&(ne?(Be=this.top-Te,Oe=this.left-Ke+(re||!X.opposite?0:(X.titleOffset||0)+X.axisTitleMargin),Ke=st+2*Te):(Be=this.top+(re?this.height:-Ke),Oe=this.left-Te),this.scrollbar.position(Oe,Be,De,Ke),this.scrollbar.setRange(this.zoomedMin/(st||1),this.zoomedMax/(st||1))),this.rendered=!0,this.isDirty=!1,by(this,"afterRender")}addMouseEvents(){let p=this,b=p.chart,T=b.container,P=[],O,z;p.mouseMoveHandler=O=function(j){p.onMouseMove(j)},p.mouseUpHandler=z=function(j){p.onMouseUp(j)},(P=p.getPartsEvents("mousedown")).push(zu(b.renderTo,"mousemove",O),zu(T.ownerDocument,"mouseup",z),zu(b.renderTo,"touchmove",O),zu(T.ownerDocument,"touchend",z)),P.concat(p.getPartsEvents("touchstart")),p.eventsToUnbind=P,p.series&&p.series[0]&&P.push(zu(p.series[0].xAxis,"foundExtremes",function(){b.navigator.modifyNavigatorAxisExtremes()}))}getPartsEvents(p){let b=this,T=[];return["shades","handles"].forEach(function(P){b[P].forEach(function(O,z){T.push(zu(O.element,p,function(j){b[P+"Mousedown"](j,z)}))})}),T}shadesMousedown(p,b){var Te;p=((Te=this.chart.pointer)==null?void 0:Te.normalize(p))||p;let T=this.chart,P=this.xAxis,O=this.zoomedMin,z=this.size,j=this.range,X=this.left,re=p.chartX,de,ne,ce,ye;T.inverted&&(re=p.chartY,X=this.top),b===1?(this.grabbedCenter=re,this.fixedWidth=j,this.dragOffset=re-O):(ye=re-X-j/2,b===0?ye=Math.max(0,ye):b===2&&ye+j>=z&&(ye=z-j,this.reversedExtremes?(ye-=j,ne=this.getUnionExtremes().dataMin):de=this.getUnionExtremes().dataMax),ye!==O&&(this.fixedWidth=j,xy((ce=P.navigatorAxis.toFixedRange(ye,ye+j,ne,de)).min)&&by(this,"setRange",{min:Math.min(ce.min,ce.max),max:Math.max(ce.min,ce.max),redraw:!0,eventArguments:{trigger:"navigator"}})))}handlesMousedown(p,b){var z;p=((z=this.chart.pointer)==null?void 0:z.normalize(p))||p;let T=this.chart,P=T.xAxis[0],O=this.reversedExtremes;b===0?(this.grabbedLeft=!0,this.otherHandlePos=this.zoomedMax,this.fixedExtreme=O?P.min:P.max):(this.grabbedRight=!0,this.otherHandlePos=this.zoomedMin,this.fixedExtreme=O?P.max:P.min),T.setFixedRange(void 0)}onMouseMove(p){var de;let b=this,T=b.chart,P=b.navigatorSize,O=b.range,z=b.dragOffset,j=T.inverted,X=b.left,re;(!p.touches||p.touches[0].pageX!==0)&&(re=(p=((de=T.pointer)==null?void 0:de.normalize(p))||p).chartX,j&&(X=b.top,re=p.chartY),b.grabbedLeft?(b.hasDragged=!0,b.render(0,0,re-X,b.otherHandlePos)):b.grabbedRight?(b.hasDragged=!0,b.render(0,0,b.otherHandlePos,re-X)):b.grabbedCenter&&(b.hasDragged=!0,re<z?re=z:re>P+z-O&&(re=P+z-O),b.render(0,0,re-z,re-z+O)),b.hasDragged&&b.scrollbar&&ud(b.scrollbar.options.liveRedraw,!xx&&!this.chart.boosted)&&(p.DOMType=p.type,setTimeout(function(){b.onMouseUp(p)},0)))}onMouseUp(p){let b,T,P,O,z,j,X=this.chart,re=this.xAxis,de=this.scrollbar,ne=p.DOMEvent||p,ce=X.inverted,ye=this.rendered&&!this.hasDragged?"animate":"attr";(this.hasDragged&&(!de||!de.hasDragged)||p.trigger==="scrollbar")&&(P=this.getUnionExtremes(),this.zoomedMin===this.otherHandlePos?O=this.fixedExtreme:this.zoomedMax===this.otherHandlePos&&(z=this.fixedExtreme),this.zoomedMax===this.size&&(z=this.reversedExtremes?P.dataMin:P.dataMax),this.zoomedMin===0&&(O=this.reversedExtremes?P.dataMax:P.dataMin),xy((j=re.navigatorAxis.toFixedRange(this.zoomedMin,this.zoomedMax,O,z)).min)&&by(this,"setRange",{min:Math.min(j.min,j.max),max:Math.max(j.min,j.max),redraw:!0,animation:!this.hasDragged&&null,eventArguments:{trigger:"navigator",triggerOp:"navigator-drag",DOMEvent:ne}})),p.DOMType!=="mousemove"&&p.DOMType!=="touchmove"&&(this.grabbedLeft=this.grabbedRight=this.grabbedCenter=this.fixedWidth=this.fixedExtreme=this.otherHandlePos=this.hasDragged=this.dragOffset=null),this.navigatorEnabled&&hd(this.zoomedMin)&&hd(this.zoomedMax)&&(T=Math.round(this.zoomedMin),b=Math.round(this.zoomedMax),this.shades&&this.drawMasks(T,b,ce,ye),this.outline&&this.drawOutline(T,b,ce,ye),this.navigatorOptions.handles.enabled&&Object.keys(this.handles).length===this.handles.length&&(this.drawHandle(T,0,ce,ye),this.drawHandle(b,1,ce,ye)))}removeEvents(){this.eventsToUnbind&&(this.eventsToUnbind.forEach(function(p){p()}),this.eventsToUnbind=void 0),this.removeBaseSeriesEvents()}removeBaseSeriesEvents(){let p=this.baseSeries||[];this.navigatorEnabled&&p[0]&&(this.navigatorOptions.adaptToUpdatedData!==!1&&p.forEach(function(b){s0(b,"updatedData",this.updatedDataHandler)},this),p[0].xAxis&&s0(p[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes))}getXAxisOffsets(){return this.chart.inverted?[this.scrollButtonSize,0,-this.scrollButtonSize,0]:[0,-this.scrollButtonSize,0,this.scrollButtonSize]}init(p){var De,Oe;let b=p.options,T=b.navigator||{},P=T.enabled,O=b.scrollbar||{},z=O.enabled,j=P&&T.height||0,X=z&&O.height||0,re=O.buttonsEnabled&&X||0;this.handles=[],this.shades=[],this.chart=p,this.setBaseSeries(),this.height=j,this.scrollbarHeight=X,this.scrollButtonSize=re,this.scrollbarEnabled=z,this.navigatorEnabled=P,this.navigatorOptions=T,this.scrollbarOptions=O,this.setOpposite();let de=this,ne=de.baseSeries,ce=p.xAxis.length,ye=p.yAxis.length,Te=ne&&ne[0]&&ne[0].xAxis||p.xAxis[0]||{options:{}};if(p.isDirtyBox=!0,de.navigatorEnabled){let Be=this.getXAxisOffsets();de.xAxis=new wu(p,Xm({breaks:Te.options.breaks,ordinal:Te.options.ordinal,overscroll:Te.options.overscroll},T.xAxis,{type:"datetime",yAxis:(De=T.yAxis)==null?void 0:De.id,index:ce,isInternal:!0,offset:0,keepOrdinalPadding:!0,startOnTick:!1,endOnTick:!1,minPadding:Te.options.ordinal?0:Te.options.minPadding,maxPadding:Te.options.ordinal?0:Te.options.maxPadding,zoomEnabled:!1},p.inverted?{offsets:Be,width:j}:{offsets:Be,height:j}),"xAxis"),de.yAxis=new wu(p,Xm(T.yAxis,{alignTicks:!1,offset:0,index:ye,isInternal:!0,reversed:ud(T.yAxis&&T.yAxis.reversed,p.yAxis[0]&&p.yAxis[0].reversed,!1),zoomEnabled:!1},p.inverted?{width:j}:{height:j}),"yAxis"),ne||T.series.data?de.updateNavigatorSeries(!1):p.series.length===0&&(de.unbindRedraw=zu(p,"beforeRedraw",function(){p.series.length>0&&!de.series&&(de.setBaseSeries(),de.unbindRedraw())})),de.reversedExtremes=p.inverted&&!de.xAxis.reversed||!p.inverted&&de.xAxis.reversed,de.renderElements(),de.addMouseEvents()}else de.xAxis={chart:p,navigatorAxis:{fake:!0},translate:function(Be,Ke){let st=p.xAxis[0],Bt=st.getExtremes(),Ut=st.len-2*re,$t=H0("min",st.options.min,Bt.dataMin),ci=H0("max",st.options.max,Bt.dataMax)-$t;return Ke?Be*ci/Ut+$t:Ut*(Be-$t)/ci},toPixels:function(Be){return this.translate(Be)},toValue:function(Be){return this.translate(Be,!0)}},de.xAxis.navigatorAxis.axis=de.xAxis,de.xAxis.navigatorAxis.toFixedRange=Co.prototype.toFixedRange.bind(de.xAxis.navigatorAxis);if((Oe=p.options.scrollbar)!=null&&Oe.enabled){let Be=Xm(p.options.scrollbar,{vertical:p.inverted});hd(Be.margin)||(Be.margin=p.inverted?-3:3),p.scrollbar=de.scrollbar=new vy(p.renderer,Be,p),zu(de.scrollbar,"changed",function(Ke){let st=de.size,Bt=st*this.to,Ut=st*this.from;de.hasDragged=de.scrollbar.hasDragged,de.render(0,0,Ut,Bt),this.shouldUpdateExtremes(Ke.DOMType)&&setTimeout(function(){de.onMouseUp(Ke)})})}de.addBaseSeriesEvents(),de.addChartEvents()}setOpposite(){let p=this.navigatorOptions,b=this.navigatorEnabled,T=this.chart;this.opposite=ud(p.opposite,!!(!b&&T.inverted))}getUnionExtremes(p){let b,T=this.chart.xAxis[0],P=this.chart.time,O=this.xAxis,z=O.options,j=T.options;return p&&T.dataMin===null||(b={dataMin:ud(P.parse(z==null?void 0:z.min),H0("min",P.parse(j.min),T.dataMin,O.dataMin,O.min)),dataMax:ud(P.parse(z==null?void 0:z.max),H0("max",P.parse(j.max),T.dataMax,O.dataMax,O.max))}),b}setBaseSeries(p,b){let T=this.chart,P=this.baseSeries=[];p=p||T.options&&T.options.navigator.baseSeries||(T.series.length?vw(T.series,O=>!O.options.isInternal).index:0),(T.series||[]).forEach((O,z)=>{!O.options.isInternal&&(O.options.showInNavigator||(z===p||O.options.id===p)&&O.options.showInNavigator!==!1)&&P.push(O)}),this.xAxis&&!this.xAxis.navigatorAxis.fake&&this.updateNavigatorSeries(!0,b)}updateNavigatorSeries(p,b){var ce,ye;let T=this,P=T.chart,O=T.baseSeries,z={enableMouseTracking:!1,index:null,linkedTo:null,group:"nav",padXAxis:!1,xAxis:(ce=this.navigatorOptions.xAxis)==null?void 0:ce.id,yAxis:(ye=this.navigatorOptions.yAxis)==null?void 0:ye.id,showInLegend:!1,stacking:void 0,isInternal:!0,states:{inactive:{opacity:1}}},j=T.series=(T.series||[]).filter(Te=>{let De=Te.baseSeries;return!(0>O.indexOf(De))||(De&&(s0(De,"updatedData",T.updatedDataHandler),delete De.navigatorSeries),Te.chart&&Te.destroy(),!1)}),X,re,de=T.navigatorOptions.series,ne;O&&O.length&&O.forEach(Te=>{var Ke;let De=Te.navigatorSeries,Oe=_w({color:Te.color,visible:Te.visible},Tx(de)?vx.navigator.series:de);if(De&&T.navigatorOptions.adaptToUpdatedData===!1)return;z.name="Navigator "+O.length,ne=(X=Te.options||{}).navigatorOptions||{},Oe.dataLabels=o0(Oe.dataLabels),(re=Xm(X,z,Oe,ne)).pointRange=ud(Oe.pointRange,ne.pointRange,vx.plotOptions[re.type||"line"].pointRange);let Be=ne.data||Oe.data;T.hasNavigatorData=T.hasNavigatorData||!!Be,re.data=Be||((Ke=X.data)==null?void 0:Ke.slice(0)),De&&De.options?De.update(re,b):(Te.navigatorSeries=P.initSeries(re),P.setSortedData(),Te.navigatorSeries.baseSeries=Te,j.push(Te.navigatorSeries))}),(de.data&&!(O&&O.length)||Tx(de))&&(T.hasNavigatorData=!1,(de=o0(de)).forEach((Te,De)=>{z.name="Navigator "+(j.length+1),(re=Xm(vx.navigator.series,{color:P.series[De]&&!P.series[De].options.isInternal&&P.series[De].color||P.options.colors[De]||P.options.colors[0]},z,Te)).data=Te.data,re.data&&(T.hasNavigatorData=!0,j.push(P.initSeries(re)))})),p&&this.addBaseSeriesEvents()}addBaseSeriesEvents(){let p=this,b=p.baseSeries||[];b[0]&&b[0].xAxis&&b[0].eventsToUnbind.push(zu(b[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes)),b.forEach(T=>{T.eventsToUnbind.push(zu(T,"show",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!0,!1)})),T.eventsToUnbind.push(zu(T,"hide",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!1,!1)})),this.navigatorOptions.adaptToUpdatedData!==!1&&T.xAxis&&T.eventsToUnbind.push(zu(T,"updatedData",this.updatedDataHandler)),T.eventsToUnbind.push(zu(T,"remove",function(){b&&j0(b,T),this.navigatorSeries&&p.series&&(j0(p.series,this.navigatorSeries),xy(this.navigatorSeries.options)&&this.navigatorSeries.remove(!1),delete this.navigatorSeries)}))})}getBaseSeriesMin(p){return this.baseSeries.reduce(function(b,T){return Math.min(b,T.getColumn("x")[0]??b)},p)}modifyNavigatorAxisExtremes(){let p=this.xAxis;if(p.getExtremes!==void 0){let b=this.getUnionExtremes(!0);b&&(b.dataMin!==p.min||b.dataMax!==p.max)&&(p.min=b.dataMin,p.max=b.dataMax)}}modifyBaseAxisExtremes(){var De;let p,b,T=this.chart.navigator,P=this.getExtremes(),O=P.min,z=P.max,j=P.dataMin,X=P.dataMax,re=z-O,de=T.stickToMin,ne=T.stickToMax,ce=ud((De=this.ordinal)==null?void 0:De.convertOverscroll(this.options.overscroll),0),ye=T.series&&T.series[0],Te=!!this.setExtremes;!(this.eventArgs&&this.eventArgs.trigger==="rangeSelectorButton")&&(de&&(p=(b=j)+re),ne&&(p=X+ce,de||(b=Math.max(j,p-re,T.getBaseSeriesMin(ye&&ye.xData?ye.xData[0]:-Number.MAX_VALUE)))),Te&&(de||ne)&&hd(b)&&(this.min=this.userMin=b,this.max=this.userMax=p)),T.stickToMin=T.stickToMax=null}updatedDataHandler(){let p=this.chart.navigator,b=this.navigatorSeries,T=p.reversedExtremes?Math.round(p.zoomedMin)===0:Math.round(p.zoomedMax)>=Math.round(p.size);p.stickToMax=ud(this.chart.options.navigator&&this.chart.options.navigator.stickToMax,T),p.stickToMin=p.shouldStickToMin(this,p),b&&!p.hasNavigatorData&&(b.options.pointStart=this.getColumn("x")[0],b.setData(this.options.data,!1,null,!1))}shouldStickToMin(p,b){let T=b.getBaseSeriesMin(p.getColumn("x")[0]),P=p.xAxis,O=P.max,z=P.min,j=P.options.range;return!!(hd(O)&&hd(z))&&(j&&O-T>0?O-T<j:z<=T)}addChartEvents(){this.eventsToUnbind||(this.eventsToUnbind=[]),this.eventsToUnbind.push(zu(this.chart,"redraw",function(){let p=this.navigator,b=p&&(p.baseSeries&&p.baseSeries[0]&&p.baseSeries[0].xAxis||this.xAxis[0]);b&&p.render(b.min,b.max)}),zu(this.chart,"getMargins",function(){var T;let p=this.navigator,b=p.opposite?"plotTop":"marginBottom";this.inverted&&(b=p.opposite?"marginRight":"plotLeft"),this[b]=(this[b]||0)+(p.navigatorEnabled||!this.inverted?p.height+(((T=this.scrollbar)==null?void 0:T.options.margin)||0)+p.scrollbarHeight:0)+(p.navigatorOptions.margin||0)}),zu(N_,"setRange",function(p){this.chart.xAxis[0].setExtremes(p.min,p.max,p.redraw,p.animation,p.eventArguments)}))}destroy(){this.removeEvents(),this.xAxis&&(j0(this.chart.xAxis,this.xAxis),j0(this.chart.axes,this.xAxis)),this.yAxis&&(j0(this.chart.yAxis,this.yAxis),j0(this.chart.axes,this.yAxis)),(this.series||[]).forEach(p=>{p.destroy&&p.destroy()}),["series","xAxis","yAxis","shades","outline","scrollbarTrack","scrollbarRifles","scrollbarGroup","scrollbar","navigatorGroup","rendered"].forEach(p=>{this[p]&&this[p].destroy&&this[p].destroy(),this[p]=null}),[this.handles].forEach(p=>{Sx(p)}),this.baseSeries.forEach(p=>{p.navigatorSeries=void 0}),this.navigatorEnabled=!1}}let{addEvent:wy,correctFloat:B_,css:xw,defined:Zm,error:Eb,isNumber:G0,pick:Ev,timeUnits:bw,isString:kb}=Ht;(function(ie){function p(ce,ye,Te,De,Oe=[],Be=0,Ke){let st={},Bt=this.options.tickPixelInterval,Ut=this.chart.time,$t=[],ci,oi,di,er,Vi,lr=0,Vr=[],Wn=-Number.MAX_VALUE;if(!this.options.ordinal&&!this.options.breaks||!Oe||Oe.length<3||ye===void 0)return Ut.getTimeTicks.apply(Ut,arguments);let xn=Oe.length;for(ci=0;ci<xn;ci++){if(Vi=ci&&Oe[ci-1]>Te,Oe[ci]<ye&&(lr=ci),ci===xn-1||Oe[ci+1]-Oe[ci]>5*Be||Vi){if(Oe[ci]>Wn){for(oi=Ut.getTimeTicks(ce,Oe[lr],Oe[ci],De);oi.length&&oi[0]<=Wn;)oi.shift();oi.length&&(Wn=oi[oi.length-1]),$t.push(Vr.length),Vr=Vr.concat(oi)}lr=ci+1}if(Vi)break}if(oi){if(er=oi.info,Ke&&er.unitRange<=bw.hour){for(lr=1,ci=Vr.length-1;lr<ci;lr++)Ut.dateFormat("%d",Vr[lr])!==Ut.dateFormat("%d",Vr[lr-1])&&(st[Vr[lr]]="day",di=!0);di&&(st[Vr[0]]="day"),er.higherRanks=st}er.segmentStarts=$t,Vr.info=er}else Eb(12,!1,this.chart);if(Ke&&Zm(Bt)){let Nn=Vr.length,Bn=[],Xn=[],es,ns,Qs,Nl,Uo,jo=Nn;for(;jo--;)ns=this.translate(Vr[jo]),Qs&&(Xn[jo]=Qs-ns),Bn[jo]=Qs=ns;for(Xn.sort((mo,io)=>mo-io),(Nl=Xn[Math.floor(Xn.length/2)])<.6*Bt&&(Nl=null),jo=Vr[Nn-1]>Te?Nn-1:Nn,Qs=void 0;jo--;)Uo=Math.abs(Qs-(ns=Bn[jo])),Qs&&Uo<.8*Bt&&(Nl===null||Uo<.8*Nl)?(st[Vr[jo]]&&!st[Vr[jo+1]]?(es=jo+1,Qs=ns):es=jo,Vr.splice(es,1)):Qs=ns}return Vr}function b(ce){let ye=this.ordinal.positions;if(!ye)return ce;let Te=ye.length-1,De;return ce<0?ce=ye[0]:ce>Te?ce=ye[Te]:(Te=Math.floor(ce),De=ce-Te),De!==void 0&&ye[Te]!==void 0?ye[Te]+(De?De*(ye[Te+1]-ye[Te]):0):ce}function T(ce){let ye=this.ordinal,Te=this.old?this.old.min:this.min,De=this.old?this.old.transA:this.transA,Oe=ye.getExtendedPositions();if(Oe!=null&&Oe.length){let Be=B_((ce-Te)*De+this.minPixelPadding),Ke=B_(ye.getIndexOfPoint(Be,Oe)),st=B_(Ke%1);if(Ke>=0&&Ke<=Oe.length-1){let Bt=Oe[Math.floor(Ke)],Ut=Oe[Math.ceil(Ke)];return Oe[Math.floor(Ke)]+st*(Ut-Bt)}}return ce}function P(ce,ye){let Te=ie.Additions.findIndexOf(ce,ye,!0);if(ce[Te]===ye)return Te;let De=(ye-ce[Te])/(ce[Te+1]-ce[Te]);return Te+De}function O(){this.ordinal||(this.ordinal=new ie.Additions(this))}function z(){let{eventArgs:ce,options:ye}=this;if(this.isXAxis&&Zm(ye.overscroll)&&ye.overscroll!==0&&G0(this.max)&&G0(this.min)&&(this.options.ordinal&&!this.ordinal.originalOrdinalRange&&this.ordinal.getExtendedPositions(!1),this.max===this.dataMax&&((ce==null?void 0:ce.trigger)!=="pan"||this.isInternal)&&(ce==null?void 0:ce.trigger)!=="navigator")){let Te=this.ordinal.convertOverscroll(ye.overscroll);this.max+=Te,!this.isInternal&&Zm(this.userMin)&&(ce==null?void 0:ce.trigger)!=="mousewheel"&&(this.min+=Te)}}function j(){this.horiz&&!this.isDirty&&(this.isDirty=this.isOrdinal&&this.chart.navigator&&!this.chart.navigator.adaptToUpdatedData)}function X(){this.ordinal&&(this.ordinal.beforeSetTickPositions(),this.tickInterval=this.ordinal.postProcessTickInterval(this.tickInterval))}function re(ce){var Ke;let ye=this.xAxis[0],Te=ye.ordinal.convertOverscroll(ye.options.overscroll),De=ce.originalEvent.chartX,Oe=this.options.chart.panning,Be=!1;if((Oe==null?void 0:Oe.type)!=="y"&&ye.options.ordinal&&ye.series.length&&(!ce.touches||ce.touches.length<=1)){let st,Bt,Ut=this.mouseDownX,$t=ye.getExtremes(),ci=$t.dataMin,oi=$t.dataMax,di=$t.min,er=$t.max,Vi=this.hoverPoints,lr=ye.closestPointRange||((Ke=ye.ordinal)==null?void 0:Ke.overscrollPointsRange),Vr=Math.round((Ut-De)/(ye.translationSlope*(ye.ordinal.slope||lr))),Wn=ye.ordinal.getExtendedPositions(),xn={ordinal:{positions:Wn,extendedOrdinalPositions:Wn}},Nn=ye.index2val,Bn=ye.val2lin;if(di<=ci&&Vr<=0||er>=oi+Te&&Vr>=0)return void ce.preventDefault();xn.ordinal.positions?Math.abs(Vr)>1&&(Vi&&Vi.forEach(function(Xn){Xn.setState()}),Bt=xn.ordinal.positions,Te&&(Bt=xn.ordinal.positions=Bt.concat(ye.ordinal.getOverscrollPositions())),oi>Bt[Bt.length-1]&&Bt.push(oi),this.setFixedRange(er-di),(st=ye.navigatorAxis.toFixedRange(void 0,void 0,Nn.apply(xn,[Bn.apply(xn,[di,!0])+Vr]),Nn.apply(xn,[Bn.apply(xn,[er,!0])+Vr]))).min>=Math.min(Bt[0],di)&&st.max<=Math.max(Bt[Bt.length-1],er)+Te&&ye.setExtremes(st.min,st.max,!0,!1,{trigger:"pan"}),this.mouseDownX=De,xw(this.container,{cursor:"move"})):Be=!0}else Be=!0;Be||Oe&&/y/.test(Oe.type)?Te&&G0(ye.dataMax)&&(ye.max=ye.dataMax+Te):ce.preventDefault()}function de(){let ce=this.xAxis;ce!=null&&ce.options.ordinal&&(delete ce.ordinal.index,delete ce.ordinal.originalOrdinalRange)}function ne(ce,ye){var Bt;let Te,De=this.ordinal,Oe=De.positions,Be=De.slope,Ke;if(!Oe)return ce;let st=Oe.length;if(Oe[0]<=ce&&Oe[st-1]>=ce)Te=P(Oe,ce);else{if(Ke=(Bt=De.getExtendedPositions)==null?void 0:Bt.call(De),!(Ke!=null&&Ke.length))return ce;let Ut=Ke.length;Be||(Be=(Ke[Ut-1]-Ke[0])/Ut);let $t=P(Ke,Oe[0]);if(ce>=Ke[0]&&ce<=Ke[Ut-1])Te=P(Ke,ce)-$t;else{if(!ye)return ce;Te=ce<Ke[0]?-$t-(Ke[0]-ce)/Be:(ce-Ke[Ut-1])/Be+Ut-$t}}return ye?Te:Be*(Te||0)+De.offset}ie.compose=function(ce,ye,Te){let De=ce.prototype;return De.ordinal2lin||(De.getTimeTicks=p,De.index2val=b,De.lin2val=T,De.val2lin=ne,De.ordinal2lin=De.val2lin,wy(ce,"afterInit",O),wy(ce,"foundExtremes",z),wy(ce,"afterSetScale",j),wy(ce,"initialAxisTranslation",X),wy(Te,"pan",re),wy(Te,"touchpan",re),wy(ye,"updatedData",de)),ce},ie.Additions=class{constructor(ce){this.index={},this.axis=ce}beforeSetTickPositions(){var Nn;let ce=this.axis,ye=ce.ordinal,Te=ce.getExtremes(),De=Te.min,Oe=Te.max,Be=(Nn=ce.brokenAxis)==null?void 0:Nn.hasBreaks,Ke=ce.options.ordinal,st=ce.options.overscroll&&ce.ordinal.convertOverscroll(ce.options.overscroll)||0,Bt,Ut,$t,ci,oi,di,er,Vi=[],lr=Number.MAX_VALUE,Vr=!1,Wn=!1,xn=!1;if(Ke||Be){let Bn=0;if(ce.series.forEach(function(Xn,es){let ns=Xn.getColumn("x",!0);if(Ut=[],es>0&&Xn.options.id!=="highcharts-navigator-series"&&ns.length>1&&(Wn=Bn!==ns[1]-ns[0]),Bn=ns[1]-ns[0],Xn.boosted&&(xn=Xn.boosted),Xn.reserveSpace()&&(Xn.takeOrdinalPosition!==!1||Be)&&(Bt=(Vi=Vi.concat(ns)).length,Vi.sort(function(Qs,Nl){return Qs-Nl}),lr=Math.min(lr,Ev(Xn.closestPointRange,lr)),Bt)){for(es=0;es<Bt-1;)Vi[es]!==Vi[es+1]&&Ut.push(Vi[es+1]),es++;Ut[0]!==Vi[0]&&Ut.unshift(Vi[0]),Vi=Ut}}),ce.ordinal.originalOrdinalRange||(ce.ordinal.originalOrdinalRange=(Vi.length-1)*lr),Wn&&xn&&(Vi.pop(),Vi.shift()),(Bt=Vi.length)>2){for($t=Vi[1]-Vi[0],er=Bt-1;er--&&!Vr;)Vi[er+1]-Vi[er]!==$t&&(Vr=!0);!ce.options.keepOrdinalPadding&&(Vi[0]-De>$t||Oe-st-Vi[Bt-1]>$t)&&(Vr=!0)}else ce.options.overscroll&&(Bt===2?lr=Vi[1]-Vi[0]:Bt===1?(lr=st,Vi=[Vi[0],Vi[0]+lr]):lr=ye.overscrollPointsRange);Vr||ce.forceOrdinal?(ce.options.overscroll&&(ye.overscrollPointsRange=lr,Vi=Vi.concat(ye.getOverscrollPositions())),ye.positions=Vi,ci=ce.ordinal2lin(Math.max(De,Vi[0]),!0),oi=Math.max(ce.ordinal2lin(Math.min(Oe,Vi[Vi.length-1]),!0),1),ye.slope=di=(Oe-De)/(oi-ci),ye.offset=De-ci*di):(ye.overscrollPointsRange=Ev(ce.closestPointRange,ye.overscrollPointsRange),ye.positions=ce.ordinal.slope=ye.offset=void 0)}ce.isOrdinal=Ke&&Vr,ye.groupIntervalFactor=null}static findIndexOf(ce,ye,Te){let De=0,Oe=ce.length-1,Be;for(;De<Oe;)ce[Be=Math.ceil((De+Oe)/2)]<=ye?De=Be:Oe=Be-1;return ce[De]===ye||Te?De:-1}getExtendedPositions(ce=!0){let ye=this,Te=ye.axis,De=Te.constructor.prototype,Oe=Te.chart,Be=Te.series.reduce((ci,oi)=>{let di=oi.currentDataGrouping;return ci+(di?di.count+di.unitName:"raw")},""),Ke=ce?Te.ordinal.convertOverscroll(Te.options.overscroll):0,st=Te.getExtremes(),Bt,Ut,$t=ye.index;return $t||($t=ye.index={}),!$t[Be]&&((Bt={series:[],chart:Oe,forceOrdinal:!1,getExtremes:function(){return{min:st.dataMin,max:st.dataMax+Ke}},applyGrouping:De.applyGrouping,getGroupPixelWidth:De.getGroupPixelWidth,getTimeTicks:De.getTimeTicks,options:{ordinal:!0},ordinal:{getGroupIntervalFactor:this.getGroupIntervalFactor},ordinal2lin:De.ordinal2lin,getIndexOfPoint:De.getIndexOfPoint,val2lin:De.val2lin}).ordinal.axis=Bt,Te.series.forEach(ci=>{var di,er,Vi;if(ci.takeOrdinalPosition===!1)return;Ut={xAxis:Bt,chart:Oe,groupPixelWidth:ci.groupPixelWidth,destroyGroupedData:Je.noop,getColumn:ci.getColumn,applyGrouping:ci.applyGrouping,getProcessedData:ci.getProcessedData,reserveSpace:ci.reserveSpace,visible:ci.visible};let oi=ci.getColumn("x").concat(ce?ye.getOverscrollPositions():[]);Ut.dataTable=new Wd({columns:{x:oi}}),Ut.options={...ci.options,dataGrouping:ci.currentDataGrouping?{firstAnchor:(di=ci.options.dataGrouping)==null?void 0:di.firstAnchor,anchor:(er=ci.options.dataGrouping)==null?void 0:er.anchor,lastAnchor:(Vi=ci.options.dataGrouping)==null?void 0:Vi.firstAnchor,enabled:!0,forced:!0,approximation:"open",units:[[ci.currentDataGrouping.unitName,[ci.currentDataGrouping.count]]]}:{enabled:!1}},Bt.series.push(Ut),ci.processData.apply(Ut)}),Bt.applyGrouping({hasExtremesChanged:!0}),(Ut==null?void 0:Ut.closestPointRange)!==(Ut==null?void 0:Ut.basePointRange)&&Ut.currentDataGrouping&&(Bt.forceOrdinal=!0),Te.ordinal.beforeSetTickPositions.apply({axis:Bt}),!Te.ordinal.originalOrdinalRange&&Bt.ordinal.originalOrdinalRange&&(Te.ordinal.originalOrdinalRange=Bt.ordinal.originalOrdinalRange),Bt.ordinal.positions&&($t[Be]=Bt.ordinal.positions)),$t[Be]}getGroupIntervalFactor(ce,ye,Te){let De=Te.getColumn("x",!0),Oe=De.length,Be=[],Ke,st,Bt=this.groupIntervalFactor;if(!Bt){for(st=0;st<Oe-1;st++)Be[st]=De[st+1]-De[st];Be.sort(function(Ut,$t){return Ut-$t}),Ke=Be[Math.floor(Oe/2)],ce=Math.max(ce,De[0]),ye=Math.min(ye,De[Oe-1]),this.groupIntervalFactor=Bt=Oe*Ke/(ye-ce)}return Bt}getIndexOfPoint(ce,ye){let Te=this.axis,De=Te.min,Oe=Te.minPixelPadding;return P(ye,De)+B_((ce-Oe)/(Te.translationSlope*(this.slope||Te.closestPointRange||this.overscrollPointsRange)))}getOverscrollPositions(){let ce=this.axis,ye=this.convertOverscroll(ce.options.overscroll),Te=this.overscrollPointsRange,De=[],Oe=ce.dataMax;if(Zm(Te))for(;Oe<ce.dataMax+ye;)De.push(Oe+=Te);return De}postProcessTickInterval(ce){let ye=this.axis,Te=this.slope,De=ye.closestPointRange;return Te&&De?ye.options.breaks?De||ce:ce/(Te/De):ce}convertOverscroll(ce=0){let ye=this,Te=ye.axis,De=function(Oe){return Ev(ye.originalOrdinalRange,Zm(Te.dataMax)&&Zm(Te.dataMin)?Te.dataMax-Te.dataMin:0)*Oe};if(kb(ce)){let Oe,Be=parseInt(ce,10);if(Zm(Te.min)&&Zm(Te.max)&&Zm(Te.dataMin)&&Zm(Te.dataMax)&&((Oe=Te.max-Te.min==Te.dataMax-Te.dataMin)||(this.originalOrdinalRange=Te.max-Te.min)),/%$/.test(ce))return De(Be/100);if(/px/.test(ce)){let Ke=Math.min(Be,.9*Te.len)/Te.len;return De(Ke/(Oe?1-Ke:1))}return 0}return ce}}})(ht||(ht={}));let F_=ht,kv={lang:{rangeSelectorZoom:"Zoom",rangeSelectorFrom:"",rangeSelectorTo:"",rangeSelector:{allText:"All",allTitle:"View all",monthText:"{count}m",monthTitle:"View {count} {#eq count 1}month{else}months{/eq}",yearText:"{count}y",yearTitle:"View {count} {#eq count 1}year{else}years{/eq}",ytdText:"YTD",ytdTitle:"View year to date"}},rangeSelector:{allButtonsEnabled:!1,buttons:[{type:"month",count:1},{type:"month",count:3},{type:"month",count:6},{type:"ytd"},{type:"year",count:1},{type:"all"}],buttonSpacing:5,dropdown:"responsive",enabled:void 0,verticalAlign:"top",buttonTheme:{width:28,height:18,padding:2,zIndex:7},floating:!1,x:0,y:0,height:void 0,inputBoxBorderColor:"none",inputBoxHeight:17,inputBoxWidth:void 0,inputDateFormat:"%[ebY]",inputDateParser:void 0,inputEditDateFormat:"%Y-%m-%d",inputEnabled:!0,inputPosition:{align:"right",x:0,y:0},inputSpacing:5,selected:void 0,buttonPosition:{align:"left",x:0,y:0},inputStyle:{color:"#334eff",cursor:"pointer",fontSize:"0.8em"},labelStyle:{color:"#666666",fontSize:"0.8em"}}},{defaultOptions:Cx}=vi,{composed:Ab}=Je,{addEvent:Sy,defined:Mb,extend:Ib,isNumber:a0,merge:Lb,pick:Ty,pushUnique:Db}=Ht,Av=[];function Pb(){let ie,p,b=this.range,T=b.type,P=this.max,O=this.chart.time,z=function(X,re){let de=O.toParts(X),ne=de.slice();T==="year"?ne[0]+=re:ne[1]+=re;let ce=O.makeTime.apply(O,ne),ye=O.toParts(ce);return T==="month"&&de[1]===ye[1]&&Math.abs(re)===1&&(ne[0]=de[0],ne[1]=de[1],ne[2]=0),(ce=O.makeTime.apply(O,ne))-X};a0(b)?(ie=P-b,p=b):b&&(ie=P+z(P,-(b.count||1)),this.chart&&this.chart.setFixedRange(P-ie));let j=Ty(this.dataMin,Number.MIN_VALUE);return a0(ie)||(ie=j),ie<=j&&(ie=j,p===void 0&&(p=z(ie,b.count)),this.newMax=Math.min(ie+p,Ty(this.dataMax,Number.MAX_VALUE))),a0(P)?!a0(b)&&b&&b._offsetMin&&(ie+=b._offsetMin):ie=void 0,ie}function Mv(){var ie;(ie=this.rangeSelector)==null||ie.redrawElements()}function ww(){this.options.rangeSelector&&this.options.rangeSelector.enabled&&(this.rangeSelector=new d(this))}function Iv(){let ie=this.rangeSelector;if(ie){a0(ie.deferredYTDClick)&&(ie.clickButton(ie.deferredYTDClick),delete ie.deferredYTDClick);let p=ie.options.verticalAlign;ie.options.floating||(p==="bottom"?this.extraBottomMargin=!0:p==="top"&&(this.extraTopMargin=!0))}}function l0(){let ie,p=this.rangeSelector;if(!p)return;let b=this.xAxis[0].getExtremes(),T=this.legend,P=p&&p.options.verticalAlign;a0(b.min)&&p.render(b.min,b.max),T.display&&P==="top"&&P===T.options.verticalAlign&&(ie=Lb(this.spacingBox),T.options.layout==="vertical"?ie.y=this.plotTop:ie.y+=p.getHeight(),T.group.placed=!1,T.align(ie))}function Ex(){for(let ie=0,p=Av.length;ie<p;++ie){let b=Av[ie];if(b[0]===this){b[1].forEach(T=>T()),Av.splice(ie,1);return}}}function Ob(){var p;let ie=this.rangeSelector;if((p=ie==null?void 0:ie.options)!=null&&p.enabled){let b=ie.getHeight(),T=ie.options.verticalAlign;ie.options.floating||(T==="bottom"?this.marginBottom+=b:T!=="middle"&&(this.plotTop+=b))}}function Sw(ie){let p=ie.options.rangeSelector,b=this.extraBottomMargin,T=this.extraTopMargin,P=this.rangeSelector;if(p&&p.enabled&&!Mb(P)&&this.options.rangeSelector&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=P=new d(this)),this.extraBottomMargin=!1,this.extraTopMargin=!1,P){let O=p&&p.verticalAlign||P.options&&P.options.verticalAlign;P.options.floating||(O==="bottom"?this.extraBottomMargin=!0:O!=="middle"&&(this.extraTopMargin=!0)),(this.extraBottomMargin!==b||this.extraTopMargin!==T)&&(this.isDirtyBox=!0)}}let Tw={compose:function(ie,p,b){if(d=b,Db(Ab,"RangeSelector")){let T=p.prototype;ie.prototype.minFromRange=Pb,Sy(p,"afterGetContainer",ww),Sy(p,"beforeRender",Iv),Sy(p,"destroy",Ex),Sy(p,"getMargins",Ob),Sy(p,"redraw",l0),Sy(p,"update",Sw),Sy(p,"beforeRedraw",Mv),T.callbacks.push(l0),Ib(Cx,{rangeSelector:kv.rangeSelector}),Ib(Cx.lang,kv.lang)}}},{defaultOptions:q0}=vi,{format:Y0}=ba,{addEvent:Af,createElement:dm,css:Nc,defined:rp,destroyObjectProperties:kx,diffObjects:Lv,discardElement:Cw,extend:X0,fireEvent:Km,isNumber:sh,isString:Qm,merge:Jm,objectEach:Z0,pick:np,splat:Rb}=Ht;function z_(ie){let p=P=>RegExp(`%[[a-zA-Z]*${P}`).test(ie);if(Qm(ie)?ie.indexOf("%L")!==-1:ie.fractionalSecondDigits)return"text";let b=Qm(ie)?["a","A","d","e","w","b","B","m","o","y","Y"].some(p):ie.dateStyle||ie.day||ie.month||ie.year,T=Qm(ie)?["H","k","I","l","M","S"].some(p):ie.timeStyle||ie.hour||ie.minute||ie.second;return b&&T?"datetime-local":b?"date":T?"time":"text"}class K0{static compose(p,b){Tw.compose(p,b,K0)}constructor(p){this.isDirty=!1,this.buttonOptions=[],this.initialButtonGroupWidth=0,this.maxButtonWidth=()=>{let b=0;return this.buttons.forEach(T=>{let P=T.getBBox();P.width>b&&(b=P.width)}),b},this.init(p)}clickButton(p,b){let T=this.chart,P=this.buttonOptions[p],O=T.xAxis[0],z=T.scroller&&T.scroller.getUnionExtremes()||O||{},j=P.type,X=P.dataGrouping,re=z.dataMin,de=z.dataMax,ne,ce=sh(O==null?void 0:O.max)?Math.round(Math.min(O.max,de??O.max)):void 0,ye,Te=P._range,De,Oe,Be,Ke=!0;if(re!==null&&de!==null){if(this.setSelected(p),X&&(this.forcedDataGrouping=!0,wu.prototype.setDataGrouping.call(O||{chart:this.chart},X,!1),this.frozenStates=P.preserveDataGrouping),j==="month"||j==="year")O?(Oe={range:P,max:ce,chart:T,dataMin:re,dataMax:de},ne=O.minFromRange.call(Oe),sh(Oe.newMax)&&(ce=Oe.newMax),Ke=!1):Te=P;else if(Te)sh(ce)&&(ce=Math.min((ne=Math.max(ce-Te,re))+Te,de),Ke=!1);else if(j==="ytd")if(O)!O.hasData()||sh(de)&&sh(re)||(re=Number.MAX_VALUE,de=-Number.MAX_VALUE,T.series.forEach(st=>{let Bt=st.getColumn("x");Bt.length&&(re=Math.min(Bt[0],re),de=Math.max(Bt[Bt.length-1],de))}),b=!1),sh(de)&&sh(re)&&(ne=De=(Be=this.getYTDExtremes(de,re)).min,ce=Be.max);else{this.deferredYTDClick=p;return}else j==="all"&&O&&(T.navigator&&T.navigator.baseSeries[0]&&(T.navigator.baseSeries[0].xAxis.options.range=void 0),ne=re,ce=de);if(Ke&&P._offsetMin&&rp(ne)&&(ne+=P._offsetMin),P._offsetMax&&rp(ce)&&(ce+=P._offsetMax),this.dropdown&&(this.dropdown.selectedIndex=p+1),O)sh(ne)&&sh(ce)&&(O.setExtremes(ne,ce,np(b,!0),void 0,{trigger:"rangeSelectorButton",rangeSelectorButton:P}),T.setFixedRange(P._range));else{ye=Rb(T.options.xAxis||{})[0];let st=Af(T,"afterCreateAxes",function(){let Bt=T.xAxis[0];Bt.range=Bt.options.range=Te,Bt.min=Bt.options.min=De});Af(T,"load",function(){let Bt=T.xAxis[0];T.setFixedRange(P._range),Bt.options.range=ye.range,Bt.options.min=ye.min,st()})}Km(this,"afterBtnClick")}}setSelected(p){this.selected=this.options.selected=p}init(p){let b=this,T=p.options.rangeSelector,P=p.options.lang,O=T.buttons,z=T.selected,j=function(){let X=b.minInput,re=b.maxInput;X&&X.blur&&Km(X,"blur"),re&&re.blur&&Km(re,"blur")};b.chart=p,b.options=T,b.buttons=[],b.buttonOptions=O.map(X=>(X.type&&P.rangeSelector&&(X.text??(X.text=P.rangeSelector[`${X.type}Text`]),X.title??(X.title=P.rangeSelector[`${X.type}Title`])),X.text=Y0(X.text,{count:X.count||1}),X.title=Y0(X.title,{count:X.count||1}),X)),this.eventsToUnbind=[],this.eventsToUnbind.push(Af(p.container,"mousedown",j)),this.eventsToUnbind.push(Af(p,"resize",j)),O.forEach(b.computeButtonRange),z!==void 0&&O[z]&&this.clickButton(z,!1),this.eventsToUnbind.push(Af(p,"load",function(){p.xAxis&&p.xAxis[0]&&Af(p.xAxis[0],"setExtremes",function(X){sh(this.max)&&sh(this.min)&&this.max-this.min!==p.fixedRange&&X.trigger!=="rangeSelectorButton"&&X.trigger!=="updatedData"&&b.forcedDataGrouping&&!b.frozenStates&&this.setDataGrouping(!1,!1)})})),this.createElements()}updateButtonStates(){let p=this,b=this.chart,T=this.dropdown,P=this.dropdownLabel,O=b.xAxis[0],z=Math.round(O.max-O.min),j=!O.hasVisibleSeries,X=24*36e5,re=b.scroller&&b.scroller.getUnionExtremes()||O,de=re.dataMin,ne=re.dataMax,ce=p.getYTDExtremes(ne,de),ye=ce.min,Te=ce.max,De=p.selected,Oe=p.options.allButtonsEnabled,Be=Array(p.buttonOptions.length).fill(0),Ke=sh(De),st=p.buttons,Bt=!1,Ut=null;p.buttonOptions.forEach(($t,ci)=>{var es;let oi=$t._range,di=$t.type,er=$t.count||1,Vi=$t._offsetMax-$t._offsetMin,lr=ci===De,Vr=oi>ne-de,Wn=oi<O.minRange,xn=!1,Nn=oi===z;if(lr&&Vr&&(Bt=!0),O.isOrdinal&&((es=O.ordinal)==null?void 0:es.positions)&&oi&&z<oi){let ns=O.ordinal.positions,Qs=F_.Additions.findIndexOf(ns,O.min,!0),Nl=Math.min(F_.Additions.findIndexOf(ns,O.max,!0)+1,ns.length-1);ns[Nl]-ns[Qs]>oi&&(Nn=!0)}else(di==="month"||di==="year")&&z+36e5>={month:28,year:365}[di]*X*er-Vi&&z-36e5<={month:31,year:366}[di]*X*er+Vi?Nn=!0:di==="ytd"?(Nn=Te-ye+Vi===z,xn=!lr):di==="all"&&(Nn=O.max-O.min>=ne-de);let Bn=!Oe&&!(Bt&&di==="all")&&(Vr||Wn||j),Xn=Bt&&di==="all"||!xn&&Nn||lr&&p.frozenStates;Bn?Be[ci]=3:Xn&&(!Ke||ci===De)&&(Ut=ci)}),Ut!==null?(Be[Ut]=2,p.setSelected(Ut),this.dropdown&&(this.dropdown.selectedIndex=Ut+1)):(p.setSelected(),this.dropdown&&(this.dropdown.selectedIndex=-1),P&&(P.setState(0),P.attr({text:(q0.lang.rangeSelectorZoom||"")+" "})));for(let $t=0;$t<Be.length;$t++){let ci=Be[$t],oi=st[$t];if(oi.state!==ci&&(oi.setState(ci),T)){T.options[$t+1].disabled=ci===3,ci===2&&(P&&(P.setState(2),P.attr({text:p.buttonOptions[$t].text+" "})),T.selectedIndex=$t+1);let di=P.getBBox();Nc(T,{width:`${di.width}px`,height:`${di.height}px`})}}}computeButtonRange(p){let b=p.type,T=p.count||1,P={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5};P[b]?p._range=P[b]*T:(b==="month"||b==="year")&&(p._range=24*{month:30,year:365}[b]*36e5*T),p._offsetMin=np(p.offsetMin,0),p._offsetMax=np(p.offsetMax,0),p._range+=p._offsetMax-p._offsetMin}getInputValue(p){let b=p==="min"?this.minInput:this.maxInput,T=this.chart.options.rangeSelector,P=this.chart.time;return b?(b.type==="text"&&T.inputDateParser||this.defaultInputDateParser)(b.value,P.timezone==="UTC",P):0}setInputValue(p,b){let T=this.options,P=this.chart.time,O=p==="min"?this.minInput:this.maxInput,z=p==="min"?this.minDateBox:this.maxDateBox;if(O){O.setAttribute("type",z_(T.inputDateFormat||"%e %b %Y"));let j=O.getAttribute("data-hc-time"),X=rp(j)?Number(j):void 0;if(rp(b)){let re=X;rp(re)&&O.setAttribute("data-hc-time-previous",re),O.setAttribute("data-hc-time",b),X=b}O.value=P.dateFormat(this.inputTypeFormats[O.type]||T.inputEditDateFormat,X),z&&z.attr({text:P.dateFormat(T.inputDateFormat,X)})}}setInputExtremes(p,b,T){let P=p==="min"?this.minInput:this.maxInput;if(P){let O=this.inputTypeFormats[P.type],z=this.chart.time;if(O){let j=z.dateFormat(O,b);P.min!==j&&(P.min=j);let X=z.dateFormat(O,T);P.max!==X&&(P.max=X)}}}showInput(p){let b=p==="min"?this.minDateBox:this.maxDateBox,T=p==="min"?this.minInput:this.maxInput;if(T&&b&&this.inputGroup){let P=T.type==="text",{translateX:O=0,translateY:z=0}=this.inputGroup,{x:j=0,width:X=0,height:re=0}=b,{inputBoxWidth:de}=this.options;Nc(T,{width:P?X+(de?-2:20)+"px":"auto",height:re-2+"px",border:"2px solid silver"}),P&&de?Nc(T,{left:O+j+"px",top:z+"px"}):Nc(T,{left:Math.min(Math.round(j+O-(T.offsetWidth-X)/2),this.chart.chartWidth-T.offsetWidth)+"px",top:z-(T.offsetHeight-re)/2+"px"})}}hideInput(p){let b=p==="min"?this.minInput:this.maxInput;b&&Nc(b,{top:"-9999em",border:0,width:"1px",height:"1px"})}defaultInputDateParser(p,b,T){return(T==null?void 0:T.parse(p))||0}drawInput(p){let{chart:b,div:T,inputGroup:P}=this,O=this,z=b.renderer.style||{},j=b.renderer,X=b.options.rangeSelector,re=q0.lang,de=p==="min";function ne(Be){var er;let{maxInput:Ke,minInput:st}=O,Bt=b.xAxis[0],Ut=((er=b.scroller)==null?void 0:er.getUnionExtremes())||Bt,$t=Ut.dataMin,ci=Ut.dataMax,oi=b.xAxis[0].getExtremes()[Be],di=O.getInputValue(Be);sh(di)&&di!==oi&&(de&&Ke&&sh($t)?di>Number(Ke.getAttribute("data-hc-time"))?di=void 0:di<$t&&(di=$t):st&&sh(ci)&&(di<Number(st.getAttribute("data-hc-time"))?di=void 0:di>ci&&(di=ci)),di!==void 0&&Bt.setExtremes(de?di:Bt.min,de?Bt.max:di,void 0,void 0,{trigger:"rangeSelectorInput"}))}let ce=re[de?"rangeSelectorFrom":"rangeSelectorTo"]||"",ye=j.label(ce,0).addClass("highcharts-range-label").attr({padding:2*!!ce,height:ce?X.inputBoxHeight:0}).add(P),Te=j.label("",0).addClass("highcharts-range-input").attr({padding:2,width:X.inputBoxWidth,height:X.inputBoxHeight,"text-align":"center"}).on("click",function(){O.showInput(p),O[p+"Input"].focus()});b.styledMode||Te.attr({stroke:X.inputBoxBorderColor,"stroke-width":1}),Te.add(P);let De=dm("input",{name:p,className:"highcharts-range-selector"},void 0,T);De.setAttribute("type",z_(X.inputDateFormat||"%e %b %Y")),b.styledMode||(ye.css(Jm(z,X.labelStyle)),Te.css(Jm({color:"#333333"},z,X.inputStyle)),Nc(De,X0({position:"absolute",border:0,boxShadow:"0 0 15px rgba(0,0,0,0.3)",width:"1px",height:"1px",padding:0,textAlign:"center",fontSize:z.fontSize,fontFamily:z.fontFamily,top:"-9999em"},X.inputStyle))),De.onfocus=()=>{O.showInput(p)},De.onblur=()=>{De===Je.doc.activeElement&&ne(p),O.hideInput(p),O.setInputValue(p),De.blur()};let Oe=!1;return De.onchange=()=>{Oe||(ne(p),O.hideInput(p),De.blur())},De.onkeypress=Be=>{Be.keyCode===13&&ne(p)},De.onkeydown=Be=>{Oe=!0,(Be.key==="ArrowUp"||Be.key==="ArrowDown"||Be.key==="Tab")&&ne(p)},De.onkeyup=()=>{Oe=!1},{dateBox:Te,input:De,label:ye}}getPosition(){let p=this.chart,b=p.options.rangeSelector,T=b.verticalAlign==="top"?p.plotTop-p.axisOffset[0]:0;return{buttonTop:T+b.buttonPosition.y,inputTop:T+b.inputPosition.y-10}}getYTDExtremes(p,b){let T=this.chart.time,P=T.toParts(p)[0];return{max:p,min:Math.max(b,T.makeTime(P,0))}}createElements(){var X;let p=this.chart,b=p.renderer,T=p.container,P=p.options,O=P.rangeSelector,z=O.inputEnabled,j=np((X=P.chart.style)==null?void 0:X.zIndex,0)+1;O.enabled!==!1&&(this.group=b.g("range-selector-group").attr({zIndex:7}).add(),this.div=dm("div",void 0,{position:"relative",height:0,zIndex:j}),this.buttonOptions.length&&this.renderButtons(),T.parentNode&&T.parentNode.insertBefore(this.div,T),z&&this.createInputs())}createInputs(){this.inputGroup=this.chart.renderer.g("input-group").add(this.group);let p=this.drawInput("min");this.minDateBox=p.dateBox,this.minLabel=p.label,this.minInput=p.input;let b=this.drawInput("max");this.maxDateBox=b.dateBox,this.maxLabel=b.label,this.maxInput=b.input}render(p,b){var O,z;if(this.options.enabled===!1)return;let T=this.chart,P=T.options.rangeSelector;if(P.inputEnabled){this.inputGroup||this.createInputs(),this.setInputValue("min",p),this.setInputValue("max",b),this.chart.styledMode||((O=this.maxLabel)==null||O.css(P.labelStyle),(z=this.minLabel)==null||z.css(P.labelStyle));let j=T.scroller&&T.scroller.getUnionExtremes()||T.xAxis[0]||{};if(rp(j.dataMin)&&rp(j.dataMax)){let X=T.xAxis[0].minRange||0;this.setInputExtremes("min",j.dataMin,Math.min(j.dataMax,this.getInputValue("max"))-X),this.setInputExtremes("max",Math.max(j.dataMin,this.getInputValue("min"))+X,j.dataMax)}if(this.inputGroup){let X=0;[this.minLabel,this.minDateBox,this.maxLabel,this.maxDateBox].forEach(re=>{if(re){let{width:de}=re.getBBox();de&&(re.attr({x:X}),X+=de+P.inputSpacing)}})}}else this.inputGroup&&(this.inputGroup.destroy(),delete this.inputGroup);!this.chart.styledMode&&this.zoomText&&this.zoomText.css(P.labelStyle),this.alignElements(),this.updateButtonStates()}renderButtons(){var ce;var p;let{chart:b,options:T}=this,P=q0.lang,O=b.renderer,z=Jm(T.buttonTheme),j=z&&z.states;delete z.width,delete z.states,this.buttonGroup=O.g("range-selector-buttons").add(this.group);let X=this.dropdown=dm("select",void 0,{position:"absolute",padding:0,border:0,cursor:"pointer",opacity:1e-4},this.div),re=(ce=b.userOptions.rangeSelector)==null?void 0:ce.buttonTheme;this.dropdownLabel=O.button("",0,0,()=>{},Jm(z,{"stroke-width":np(z["stroke-width"],0),width:"auto",paddingLeft:np(T.buttonTheme.paddingLeft,re==null?void 0:re.padding,8),paddingRight:np(T.buttonTheme.paddingRight,re==null?void 0:re.padding,8)}),j&&j.hover,j&&j.select,j&&j.disabled).hide().add(this.group),Af(X,"touchstart",()=>{X.style.fontSize="16px"});let de=Je.isMS?"mouseover":"mouseenter",ne=Je.isMS?"mouseout":"mouseleave";Af(X,de,()=>{Km(this.dropdownLabel.element,de)}),Af(X,ne,()=>{Km(this.dropdownLabel.element,ne)}),Af(X,"change",()=>{Km(this.buttons[X.selectedIndex-1].element,"click")}),this.zoomText=O.label(P.rangeSelectorZoom||"",0).attr({padding:T.buttonTheme.padding,height:T.buttonTheme.height,paddingLeft:0,paddingRight:0}).add(this.buttonGroup),this.chart.styledMode||(this.zoomText.css(T.labelStyle),(p=T.buttonTheme)["stroke-width"]??(p["stroke-width"]=0)),dm("option",{textContent:this.zoomText.textStr,disabled:!0},void 0,X),this.createButtons()}createButtons(){let{options:p}=this,b=Jm(p.buttonTheme),T=b&&b.states,P=b.width||28;delete b.width,delete b.states,this.buttonOptions.forEach((O,z)=>{this.createButton(O,z,P,T)})}createButton(p,b,T,P){let{dropdown:O,buttons:z,chart:j,options:X}=this,re=j.renderer,de=Jm(X.buttonTheme);O==null||O.add(dm("option",{textContent:p.title||p.text}),b+2),z[b]=re.button(p.text??"",0,0,ne=>{let ce,ye=p.events&&p.events.click;ye&&(ce=ye.call(p,ne)),ce!==!1&&this.clickButton(b),this.isActive=!0},de,P&&P.hover,P&&P.select,P&&P.disabled).attr({"text-align":"center",width:T}).add(this.buttonGroup),p.title&&z[b].attr("title",p.title)}alignElements(){var De;let{buttonGroup:p,buttons:b,chart:T,group:P,inputGroup:O,options:z,zoomText:j}=this,X=T.options,re=X.exporting&&X.exporting.enabled!==!1&&X.navigation&&X.navigation.buttonOptions,{buttonPosition:de,inputPosition:ne,verticalAlign:ce}=z,ye=(Oe,Be,Ke)=>re&&this.titleCollision(T)&&ce==="top"&&Ke&&Be.y-Oe.getBBox().height-12<(re.y||0)+(re.height||0)+T.spacing[0]?-40:0,Te=T.plotLeft;if(P&&de&&ne){let Oe=de.x-T.spacing[3];if(p){if(this.positionButtons(),!this.initialButtonGroupWidth){let di=0;j&&(di+=j.getBBox().width+5),b.forEach((er,Vi)=>{di+=er.width||0,Vi!==b.length-1&&(di+=z.buttonSpacing)}),this.initialButtonGroupWidth=di}Te-=T.spacing[3];let oi=ye(p,de,de.align==="right"||ne.align==="right");this.alignButtonGroup(oi),(De=this.buttonGroup)!=null&&De.translateY&&this.dropdownLabel.attr({y:this.buttonGroup.translateY}),P.placed=p.placed=T.hasLoaded}let Be=0;z.inputEnabled&&O&&(Be=ye(O,ne,de.align==="right"||ne.align==="right"),ne.align==="left"?Oe=Te:ne.align==="right"&&(Oe=-Math.max(T.axisOffset[1],-Be)),O.align({y:ne.y,width:O.getBBox().width,align:ne.align,x:ne.x+Oe-2},!0,T.spacingBox),O.placed=T.hasLoaded),this.handleCollision(Be),P.align({verticalAlign:ce},!0,T.spacingBox);let Ke=P.alignAttr.translateY,st=P.getBBox().height+20,Bt=0;if(ce==="bottom"){let oi=T.legend&&T.legend.options;Bt=Ke-(st=st+(oi&&oi.verticalAlign==="bottom"&&oi.enabled&&!oi.floating?T.legend.legendHeight+np(oi.margin,10):0)-20)-(z.floating?0:z.y)-(T.titleOffset?T.titleOffset[2]:0)-10}ce==="top"?(z.floating&&(Bt=0),T.titleOffset&&T.titleOffset[0]&&(Bt=T.titleOffset[0]),Bt+=T.margin[0]-T.spacing[0]||0):ce==="middle"&&(ne.y===de.y?Bt=Ke:(ne.y||de.y)&&(ne.y<0||de.y<0?Bt-=Math.min(ne.y,de.y):Bt=Ke-st)),P.translate(z.x,z.y+Math.floor(Bt));let{minInput:Ut,maxInput:$t,dropdown:ci}=this;z.inputEnabled&&Ut&&$t&&(Ut.style.marginTop=P.translateY+"px",$t.style.marginTop=P.translateY+"px"),ci&&(ci.style.marginTop=P.translateY+"px")}}redrawElements(){var P,O,z,j,X;let p=this.chart,{inputBoxHeight:b,inputBoxBorderColor:T}=this.options;if((P=this.maxDateBox)==null||P.attr({height:b}),(O=this.minDateBox)==null||O.attr({height:b}),p.styledMode||((z=this.maxDateBox)==null||z.attr({stroke:T}),(j=this.minDateBox)==null||j.attr({stroke:T})),this.isDirty){this.isDirty=!1,this.isCollapsed=void 0;let re=this.options.buttons??[],de=Math.min(re.length,this.buttonOptions.length),{dropdown:ne,options:ce}=this,ye=Jm(ce.buttonTheme),Te=ye&&ye.states,De=ye.width||28;if(re.length<this.buttonOptions.length)for(let Oe=this.buttonOptions.length-1;Oe>=re.length;Oe--){let Be=this.buttons.pop();Be==null||Be.destroy(),(X=this.dropdown)==null||X.options.remove(Oe+1)}for(let Oe=de-1;Oe>=0;Oe--)if(Object.keys(Lv(re[Oe],this.buttonOptions[Oe])).length!==0){let Be=re[Oe];this.buttons[Oe].destroy(),ne==null||ne.options.remove(Oe+1),this.createButton(Be,Oe,De,Te),this.computeButtonRange(Be)}if(re.length>this.buttonOptions.length)for(let Oe=this.buttonOptions.length;Oe<re.length;Oe++)this.createButton(re[Oe],Oe,De,Te),this.computeButtonRange(re[Oe]);this.buttonOptions=this.options.buttons??[],rp(this.options.selected)&&this.buttons.length&&this.clickButton(this.options.selected,!1)}}alignButtonGroup(p,b){let{chart:T,options:P,buttonGroup:O,dropdown:z,dropdownLabel:j}=this,{buttonPosition:X}=P,re=T.plotLeft-T.spacing[3],de=X.x-T.spacing[3],ne=T.plotLeft;X.align==="right"?(de+=p-re,this.hasVisibleDropdown&&(ne=T.chartWidth+p-this.maxButtonWidth()-20)):X.align==="center"&&(de-=re/2,this.hasVisibleDropdown&&(ne=T.chartWidth/2-this.maxButtonWidth())),z&&Nc(z,{left:ne+"px",top:(O==null?void 0:O.translateY)+"px"}),j==null||j.attr({x:ne}),O&&O.align({y:X.y,width:np(b,this.initialButtonGroupWidth),align:X.align,x:de},!0,T.spacingBox)}positionButtons(){let{buttons:p,chart:b,options:T,zoomText:P}=this,O=b.hasLoaded?"animate":"attr",{buttonPosition:z}=T,j=b.plotLeft,X=j;P&&P.visibility!=="hidden"&&(P[O]({x:np(j+z.x,j)}),X+=z.x+P.getBBox().width+5);for(let re=0,de=this.buttonOptions.length;re<de;++re)p[re].visibility!=="hidden"?(p[re][O]({x:X}),X+=(p[re].width||0)+T.buttonSpacing):p[re][O]({x:j})}handleCollision(p){let{chart:b,buttonGroup:T,inputGroup:P,initialButtonGroupWidth:O}=this,{buttonPosition:z,dropdown:j,inputPosition:X}=this.options,re=()=>{P&&T&&P.attr({translateX:P.alignAttr.translateX+(b.axisOffset[1]>=-p?0:-p),translateY:P.alignAttr.translateY+T.getBBox().height+10})};P&&T?X.align===z.align?(re(),O>b.plotWidth+p-20?this.collapseButtons():this.expandButtons()):O-p+P.getBBox().width>b.plotWidth?j==="responsive"?this.collapseButtons():re():this.expandButtons():T&&j==="responsive"&&(O>b.plotWidth?this.collapseButtons():this.expandButtons()),T&&(j==="always"&&this.collapseButtons(),j==="never"&&this.expandButtons()),this.alignButtonGroup(p)}collapseButtons(){let{buttons:p,zoomText:b}=this;this.isCollapsed!==!0&&(this.isCollapsed=!0,b.hide(),p.forEach(T=>void T.hide()),this.showDropdown())}expandButtons(){let{buttons:p,zoomText:b}=this;this.isCollapsed!==!1&&(this.isCollapsed=!1,this.hideDropdown(),b.show(),p.forEach(T=>void T.show()),this.positionButtons())}showDropdown(){let{buttonGroup:p,dropdownLabel:b,dropdown:T}=this;p&&T&&(b.show(),Nc(T,{visibility:"inherit"}),this.hasVisibleDropdown=!0)}hideDropdown(){let{dropdown:p}=this;p&&(this.dropdownLabel.hide(),Nc(p,{visibility:"hidden",width:"1px",height:"1px"}),this.hasVisibleDropdown=!1)}getHeight(){let p=this.options,b=this.group,T=p.inputPosition,P=p.buttonPosition,O=p.y,z=P.y,j=T.y,X=0;if(p.height)return p.height;this.alignElements(),X=b?b.getBBox(!0).height+13+O:0;let re=Math.min(j,z);return(j<0&&z<0||j>0&&z>0)&&(X+=Math.abs(re)),X}titleCollision(p){return!(p.options.title.text||p.options.subtitle.text)}update(p,b=!0){let T=this.chart;if(Jm(!0,this.options,p),this.options.selected&&this.options.selected>=this.options.buttons.length&&(this.options.selected=void 0,T.options.rangeSelector.selected=void 0),rp(p.enabled))return this.destroy(),this.init(T);this.isDirty=!!p.buttons,b&&this.render()}destroy(){let p=this,b=p.minInput,T=p.maxInput;p.eventsToUnbind&&(p.eventsToUnbind.forEach(P=>P()),p.eventsToUnbind=void 0),kx(p.buttons),b&&(b.onfocus=b.onblur=b.onchange=null),T&&(T.onfocus=T.onblur=T.onchange=null),Z0(p,function(P,O){P&&O!=="chart"&&(P instanceof Qa?P.destroy():P instanceof window.HTMLElement&&Cw(P),delete p[O]),P!==K0.prototype[O]&&(p[O]=null)},this),this.buttons=[]}}X0(K0.prototype,{inputTypeFormats:{"datetime-local":"%Y-%m-%dT%H:%M:%S",date:"%Y-%m-%d",time:"%H:%M:%S"}});let{format:Nb}=ba,{getOptions:U_}=vi,{setFixedRange:Ax}=va,{addEvent:Jp,clamp:Mx,crisp:Dv,defined:Ix,extend:Pv,find:Ew,isNumber:zg,isString:Bb,merge:c0,pick:Ug,splat:Lx}=Ht;function Dx(ie,p,b){return ie==="xAxis"?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0}:ie==="yAxis"?{labels:{y:-2},opposite:b.opposite??p.opposite??!0,showLastLabel:!!(p.categories||p.type==="category"),title:{text:void 0}}:{}}function Px(ie,p){var b;if(ie==="xAxis"){let T=Ug((b=p.navigator)==null?void 0:b.enabled,tl.enabled,!0),P={type:"datetime",categories:void 0};return T&&(P.startOnTick=!1,P.endOnTick=!1),P}return{}}class Ov extends Ql{init(p,b){var X,re;let T=U_(),P=p.xAxis,O=p.yAxis,z=Ug((X=p.navigator)==null?void 0:X.enabled,tl.enabled,!0);p.xAxis=p.yAxis=void 0;let j=c0({chart:{panning:{enabled:!0,type:"x"},zooming:{pinchType:"x",mouseWheel:{type:"x"}}},navigator:{enabled:z},scrollbar:{enabled:Ug(O_.enabled,!0)},rangeSelector:{enabled:Ug(kv.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:Ug((re=T.tooltip)==null?void 0:re.split,!0),crosshairs:!0},legend:{enabled:!1}},p,{isStock:!0});p.xAxis=P,p.yAxis=O,j.xAxis=Lx(p.xAxis||{}).map(de=>c0(Dx("xAxis",de,T.xAxis),de,Px("xAxis",p))),j.yAxis=Lx(p.yAxis||{}).map(de=>c0(Dx("yAxis",de,T.yAxis),de)),super.init(j,b)}createAxis(p,b){return b.axis=c0(Dx(p,b.axis,U_()[p]),b.axis,Px(p,this.userOptions)),super.createAxis(p,b)}}Jp(Ql,"update",function(ie){let p=ie.options;"scrollbar"in p&&this.navigator&&(c0(!0,this.options.scrollbar,p.scrollbar),this.navigator.update({enabled:!!this.navigator.navigatorEnabled}),delete p.scrollbar)}),function(ie){function p(re){var Qs,Nl,Uo,jo;if(!((Nl=(Qs=this.crosshair)==null?void 0:Qs.label)!=null&&Nl.enabled&&this.cross&&zg(this.min)&&zg(this.max)))return;let de=this.chart,ne=this.logarithmic,ce=this.crosshair.label,ye=this.horiz,Te=this.opposite,De=this.left,Oe=this.top,Be=this.width,Ke=this.options.tickPosition==="inside",st=this.crosshair.snap!==!1,Bt=re.e||((Uo=this.cross)==null?void 0:Uo.e),Ut=re.point,$t=this.crossLabel,ci,oi,di=ce.format,er="",Vi,lr=0,Vr=this.min,Wn=this.max;ne&&(Vr=ne.lin2log(this.min),Wn=ne.lin2log(this.max));let xn=ye?"center":Te?this.labelAlign==="right"?"right":"left":this.labelAlign==="left"?"left":"center";!$t&&($t=this.crossLabel=de.renderer.label("",0,void 0,ce.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(Ut!=null&&Ut.series?Ut.series.colorIndex:this.series[0]&&this.series[0].colorIndex)).attr({align:ce.align||xn,padding:Ug(ce.padding,8),r:Ug(ce.borderRadius,3),zIndex:2}).add(this.labelGroup),de.styledMode||$t.attr({fill:ce.backgroundColor||((jo=Ut==null?void 0:Ut.series)==null?void 0:jo.color)||"#666666",stroke:ce.borderColor||"","stroke-width":ce.borderWidth||0}).css(Pv({color:"#ffffff",fontWeight:"normal",fontSize:"0.7em",textAlign:"center"},ce.style||{}))),ye?(ci=st?(Ut.plotX||0)+De:Bt.chartX,oi=Oe+(Te?0:this.height)):(ci=De+this.offset+(Te?Be:0),oi=st?(Ut.plotY||0)+Oe:Bt.chartY),di||ce.formatter||(this.dateTime&&(er="%b %d, %Y"),di="{value"+(er?":"+er:"")+"}");let Nn=st?this.isXAxis?Ut.x:Ut.y:this.toValue(ye?Bt.chartX:Bt.chartY),Bn=Ut!=null&&Ut.series?Ut.series.isPointInside(Ut):zg(Nn)&&Nn>Vr&&Nn<Wn,Xn="";di?Xn=Nb(di,{value:Nn},de):ce.formatter&&zg(Nn)&&(Xn=ce.formatter.call(this,Nn)),$t.attr({text:Xn,x:ci,y:oi,visibility:Bn?"inherit":"hidden"});let es=$t.getBBox();!zg($t.x)||ye||Te||(ci=$t.x-es.width/2),zg($t.y)&&(ye?(Ke&&!Te||!Ke&&Te)&&(oi=$t.y-es.height):oi=$t.y-es.height/2),Vi=ye?{left:De,right:De+this.width}:{left:this.labelAlign==="left"?De:0,right:this.labelAlign==="right"?De+this.width:de.chartWidth};let ns=$t.translateX||0;ns<Vi.left&&(lr=Vi.left-ns),ns+es.width>=Vi.right&&(lr=-(ns+es.width-Vi.right)),$t.attr({x:Math.max(0,ci+lr),y:Math.max(0,oi),anchorX:ye?ci:this.opposite?0:de.chartWidth,anchorY:ye?this.opposite?de.chartHeight:0:oi+es.height/2})}function b(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}function T(re){let de=this.chart,ne=this.options,ce=de._labelPanes=de._labelPanes||{},ye=ne.labels;if(de.options.isStock&&this.coll==="yAxis"){let Te=ne.top+","+ne.height;!ce[Te]&&ye.enabled&&(ye.distance===15&&this.side===1&&(ye.distance=0),ye.align===void 0&&(ye.align="right"),ce[Te]=this,re.align="right",re.preventDefault())}}function P(){let re=this.chart,de=this.options&&this.options.top+","+this.options.height;de&&re._labelPanes&&re._labelPanes[de]===this&&delete re._labelPanes[de]}function O(re){let de=this,ne=de.isLinked&&!de.series&&de.linkedParent?de.linkedParent.series:de.series,ce=de.chart,ye=ce.renderer,Te=de.left,De=de.top,Oe=[],Be=re.translatedValue,Ke=re.value,st=re.force,Bt,Ut,$t,ci,oi=[],di,er;if(ce.options.isStock&&re.acrossPanes!==!1&&de.coll==="xAxis"||de.coll==="yAxis"){for(let Vi of(re.preventDefault(),oi=(lr=>{let Vr=lr==="xAxis"?"yAxis":"xAxis",Wn=de.options[Vr];return zg(Wn)?[ce[Vr][Wn]]:Bb(Wn)?[ce.get(Wn)]:ne.map(xn=>xn[Vr])})(de.coll),de.isXAxis?ce.yAxis:ce.xAxis))if(!Vi.options.isInternal){let lr=Vi.isXAxis?"yAxis":"xAxis";de===(Ix(Vi.options[lr])?ce[lr][Vi.options[lr]]:ce[lr][0])&&oi.push(Vi)}for(let Vi of(di=oi.length?[]:[de.isXAxis?ce.yAxis[0]:ce.xAxis[0]],oi))di.indexOf(Vi)!==-1||Ew(di,lr=>lr.pos===Vi.pos&&lr.len===Vi.len)||di.push(Vi);if(zg(er=Ug(Be,de.translate(Ke||0,void 0,void 0,re.old))))if(de.horiz)for(let Vi of di){let lr;ci=(Ut=Vi.pos)+Vi.len,Bt=$t=Math.round(er+de.transB),st!=="pass"&&(Bt<Te||Bt>Te+de.width)&&(st?Bt=$t=Mx(Bt,Te,Te+de.width):lr=!0),lr||Oe.push(["M",Bt,Ut],["L",$t,ci])}else for(let Vi of di){let lr;$t=(Bt=Vi.pos)+Vi.len,Ut=ci=De+de.height-er,st!=="pass"&&(Ut<De||Ut>De+de.height)&&(st?Ut=ci=Mx(Ut,De,De+de.height):lr=!0),lr||Oe.push(["M",Bt,Ut],["L",$t,ci])}re.path=Oe.length>0?ye.crispPolyLine(Oe,re.lineWidth||1):void 0}}function z(re){if(this.chart.options.isStock){let de;this.is("column")||this.is("columnrange")?de={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(de={marker:{enabled:!1,radius:2}}),de&&(re.plotOptions[this.type]=c0(re.plotOptions[this.type],de))}}function j(){let re=this.chart,de=this.options.dataGrouping;return this.allowDG!==!1&&de&&Ug(de.enabled,re.options.isStock)}function X(re,de){for(let ne=0;ne<re.length;ne+=2){let ce=re[ne],ye=re[ne+1];Ix(ce[1])&&ce[1]===ye[1]&&(ce[1]=ye[1]=Dv(ce[1],de)),Ix(ce[2])&&ce[2]===ye[2]&&(ce[2]=ye[2]=Dv(ce[2],de))}return re}ie.compose=function(re,de,ne,ce){let ye=ne.prototype;ye.forceCropping||(Jp(de,"afterDrawCrosshair",p),Jp(de,"afterHideCrosshair",b),Jp(de,"autoLabelAlign",T),Jp(de,"destroy",P),Jp(de,"getPlotLinePath",O),re.prototype.setFixedRange=Ax,ye.forceCropping=j,Jp(ne,"setOptions",z),ce.prototype.crispPolyLine=X)},ie.stockChart=function(re,de,ne){return new ie(re,de,ne)}}(Ov||(Ov={}));let Ox=Ov,{column:{prototype:{pointClass:Fb}}}=Ia.seriesTypes,{column:zb}=Ia.seriesTypes,{crisp:Ub,extend:$b,merge:kw}=Ht,{defaultOptions:Aw}=vi;class Rx extends zb{extendStem(p,b,T){let P=p[0],O=p[1];typeof P[2]=="number"&&(P[2]=Math.max(T+b,P[2])),typeof O[2]=="number"&&(O[2]=Math.min(T-b,O[2]))}getPointPath(p,b){let T=b.strokeWidth(),P=p.series,O=Ub(p.plotX||0,T),z=Math.round(p.shapeArgs.width/2),j=[["M",O,Math.round(p.yBottom)],["L",O,Math.round(p.plotHigh)]];if(p.close!==null){let X=Ub(p.plotClose,T);j.push(["M",O,X],["L",O+z,X]),P.extendStem(j,T/2,X)}return j}drawSinglePoint(p){let b=p.series,T=b.chart,P,O=p.graphic;p.plotY!==void 0&&(O||(p.graphic=O=T.renderer.path().add(b.group)),T.styledMode||O.attr(b.pointAttribs(p,p.selected&&"select")),P=b.getPointPath(p,O),O[O?"animate":"attr"]({d:P}).addClass(p.getClassName(),!0))}drawPoints(){this.points.forEach(this.drawSinglePoint)}init(){super.init.apply(this,arguments),this.options.stacking=void 0}pointAttribs(p,b){let T=super.pointAttribs.call(this,p,b);return delete T.fill,T}toYData(p){return[p.high,p.low,p.close]}translate(){let p=this,b=p.yAxis,T=this.pointArrayMap&&this.pointArrayMap.slice()||[],P=T.map(O=>`plot${O.charAt(0).toUpperCase()+O.slice(1)}`);P.push("yBottom"),T.push("low"),super.translate.apply(p),p.points.forEach(function(O){T.forEach(function(z,j){let X=O[z];X!==null&&(p.dataModify&&(X=p.dataModify.modifyValue(X)),O[P[j]]=b.toPixels(X,!0))}),O.tooltipPos[1]=O.plotHigh+b.pos-p.chart.plotTop})}}Rx.defaultOptions=kw(zb.defaultOptions,{lineWidth:1,tooltip:{pointFormat:'<span style="color:{point.color}"></span> <b> {series.name}</b><br/>{series.chart.options.lang.stockHigh}: {point.high}<br/>{series.chart.options.lang.stockLow}: {point.low}<br/>{series.chart.options.lang.stockClose}: {point.close}<br/>'},threshold:null,states:{hover:{lineWidth:3}},stickyTracking:!0}),$b(Rx.prototype,{pointClass:class extends Fb{},animate:null,directTouch:!1,keysAffectYAxis:["low","high"],pointArrayMap:["high","low","close"],pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth"},pointValKey:"close"}),$b(Aw.lang,{stockOpen:"Open",stockHigh:"High",stockLow:"Low",stockClose:"Close"}),Ia.registerSeriesType("hlc",Rx);let{seriesTypes:{hlc:I}}=Ia;class W extends I.prototype.pointClass{getClassName(){return super.getClassName.call(this)+(this.open<this.close?" highcharts-point-up":" highcharts-point-down")}resolveUpColor(){this.open<this.close&&!this.options.color&&this.series.options.upColor&&(this.color=this.series.options.upColor)}resolveColor(){super.resolveColor(),this.series.is("heikinashi")||this.resolveUpColor()}getZone(){let p=super.getZone();return this.resolveUpColor(),p}applyOptions(){return super.applyOptions.apply(this,arguments),this.resolveColor&&this.resolveColor(),this}}let{composed:pe}=Je,{hlc:Ve}=Ia.seriesTypes,{addEvent:gt,crisp:Qt,extend:Ii,merge:Gi,pushUnique:br}=Ht;function gn(ie){let p=ie.options,b=p.dataGrouping;b&&p.useOhlcData&&p.id!=="highcharts-navigator-series"&&(b.approximation="ohlc")}function _n(ie){let p=ie.options;p.useOhlcData&&p.id!=="highcharts-navigator-series"&&Ii(this,{pointValKey:Cn.prototype.pointValKey,pointArrayMap:Cn.prototype.pointArrayMap,toYData:Cn.prototype.toYData})}class Cn extends Ve{static compose(p,...b){br(pe,"OHLCSeries")&&(gt(p,"afterSetOptions",gn),gt(p,"init",_n))}getPointPath(p,b){let T=super.getPointPath(p,b),P=b.strokeWidth(),O=Qt(p.plotX||0,P),z=Math.round(p.shapeArgs.width/2);if(p.open!==null){let j=Qt(p.plotOpen,P);T.push(["M",O,j],["L",O-z,j]),super.extendStem(T,P/2,j)}return T}pointAttribs(p,b){let T=super.pointAttribs.call(this,p,b),P=this.options;return delete T.fill,!p.options.color&&P.upColor&&p.open<p.close&&(T.stroke=P.upColor),T}toYData(p){return[p.open,p.high,p.low,p.close]}}Cn.defaultOptions=Gi(Ve.defaultOptions,{tooltip:{pointFormat:'<span style="color:{point.color}"></span> <b> {series.name}</b><br/>{series.chart.options.lang.stockOpen}: {point.open}<br/>{series.chart.options.lang.stockHigh}: {point.high}<br/>{series.chart.options.lang.stockLow}: {point.low}<br/>{series.chart.options.lang.stockClose}: {point.close}<br/>'}}),Ii(Cn.prototype,{pointClass:W,pointArrayMap:["open","high","low","close"]}),Ia.registerSeriesType("ohlc",Cn);let{column:_s,ohlc:Gs}=Ia.seriesTypes,{crisp:Lo,merge:Ba}=Ht;class zo extends Gs{pointAttribs(p,b){let T=_s.prototype.pointAttribs.call(this,p,b),P=this.options,O=p.open<p.close,z=P.lineColor||this.color,j=p.color||this.color;if(T["stroke-width"]=P.lineWidth,T.fill=p.options.color||O&&P.upColor||j,T.stroke=p.options.lineColor||O&&P.upLineColor||z,b){let X=P.states[b];T.fill=X.color||T.fill,T.stroke=X.lineColor||T.stroke,T["stroke-width"]=X.lineWidth||T["stroke-width"]}return T}drawPoints(){let p=this.points,b=this.chart,T=this.yAxis.reversed;for(let P of p){let O=P.graphic,z,j,X,re,de,ne,ce,ye,Te,De=!O;if(P.plotY!==void 0){O||(P.graphic=O=b.renderer.path().add(this.group)),this.chart.styledMode||O.attr(this.pointAttribs(P,P.selected&&"select")).shadow(this.options.shadow);let Oe=O.strokeWidth();ce=Lo(P.plotX||0,Oe),X=Math.min(z=P.plotOpen,j=P.plotClose),re=Math.max(z,j),Te=Math.round(P.shapeArgs.width/2),de=T?re!==P.yBottom:Math.round(X)!==Math.round(P.plotHigh||0),ne=T?Math.round(X)!==Math.round(P.plotHigh||0):re!==P.yBottom,X=Lo(X,Oe),re=Lo(re,Oe),(ye=[]).push(["M",ce-Te,re],["L",ce-Te,X],["L",ce+Te,X],["L",ce+Te,re],["Z"],["M",ce,X],["L",ce,de?Math.round(T?P.yBottom:P.plotHigh):X],["M",ce,re],["L",ce,ne?Math.round(T?P.plotHigh:P.yBottom):re]),O[De?"attr":"animate"]({d:ye}).addClass(P.getClassName(),!0)}}}}zo.defaultOptions=Ba(Gs.defaultOptions,{tooltip:Gs.defaultOptions.tooltip},{states:{hover:{lineWidth:2}},threshold:null,lineColor:"#000000",lineWidth:1,upColor:"#ffffff",stickyTracking:!0}),Ia.registerSeriesType("candlestick",zo);let{column:{prototype:{pointClass:al}}}=Ia.seriesTypes,{isNumber:Xa}=Ht,Tp=class extends al{constructor(){super(...arguments),this.ttBelow=!1}isValid(){return Xa(this.y)||this.y===void 0}hasNewShapeType(){let ie=this.options.shape||this.series.options.shape;return this.graphic&&ie&&ie!==this.graphic.symbolKey}};(function(ie){let p=[];function b(P,O,z,j,X){let re=X&&X.anchorX||P,de=X&&X.anchorY||O,ne=this.circle(re-1,de-1,2,2);return ne.push(["M",re,de],["L",P,O+j],["L",P,O],["L",P+z,O],["L",P+z,O+j],["L",P,O+j],["Z"]),ne}function T(P,O){P[O+"pin"]=function(z,j,X,re,de){let ne,ce=de&&de.anchorX,ye=de&&de.anchorY;if(O==="circle"&&re>X&&(z-=Math.round((re-X)/2),X=re),ne=P[O](z,j,X,re,de),ce&&ye){let Te=ce;if(O==="circle")Te=z+X/2;else{let Oe=ne[0],Be=ne[1];Oe[0]==="M"&&Be[0]==="L"&&(Te=(Oe[1]+Be[1])/2)}let De=j>ye?j:j+re;ne.push(["M",Te,De],["L",ce,ye]),ne=ne.concat(P.circle(ce-1,ye-1,2,2))}return ne}}ie.compose=function(P){if(p.indexOf(P)===-1){p.push(P);let z=P.prototype.symbols;z.flag=b,T(z,"circle"),T(z,"square")}let O=ca.getRendererType();p.indexOf(O)&&p.push(O)}})(Ot||(Ot={}));let sp=Ot,{composed:ef}=Je,{prototype:Gh}=Zo,{prototype:pm}=Vc,{defined:fm,pushUnique:Vb,stableSort:Dk}=Ht;(function(ie){function p(T){return pm.getPlotBox.call(this.options.onSeries&&this.chart.get(this.options.onSeries)||this,T)}function b(){var di,er;Gh.translate.apply(this);let T=this,P=T.options,O=T.chart,z=T.points,j=P.onSeries,X=j&&O.get(j),re=X&&X.options.step,de=X&&X.points,ne=O.inverted,ce=T.xAxis,ye=T.yAxis,Te=z.length-1,De,Oe,Be=P.onKey||"y",Ke=de&&de.length,st=0,Bt,Ut,$t,ci,oi;if(X&&X.visible&&Ke){for(st=(X.pointXOffset||0)+(X.barW||0)/2,ci=X.currentDataGrouping,Ut=de[Ke-1].x+(ci?ci.totalRange:0),Dk(z,(Vi,lr)=>Vi.x-lr.x),Be="plot"+Be[0].toUpperCase()+Be.substr(1);Ke--&&z[Te];)if(Bt=de[Ke],(De=z[Te]).y=Bt.y,Bt.x<=De.x&&Bt[Be]!==void 0){if(De.x<=Ut&&(De.plotY=Bt[Be],Bt.x<De.x&&!re&&($t=de[Ke+1]))&&$t[Be]!==void 0)if(fm(De.plotX)&&X.is("spline")){let Vi=[Bt.plotX||0,Bt.plotY||0],lr=[$t.plotX||0,$t.plotY||0],Vr=((di=Bt.controlPoints)==null?void 0:di.high)||Vi,Wn=((er=$t.controlPoints)==null?void 0:er.low)||lr,xn=(es,ns)=>Math.pow(1-es,3)*Vi[ns]+3*(1-es)*(1-es)*es*Vr[ns]+3*(1-es)*es*es*Wn[ns]+es*es*es*lr[ns],Nn=0,Bn=1,Xn;for(let es=0;es<100;es++){let ns=(Nn+Bn)/2,Qs=xn(ns,0);if(Qs===null)break;if(.25>Math.abs(Qs-De.plotX)){Xn=ns;break}Qs<De.plotX?Nn=ns:Bn=ns}fm(Xn)&&(De.plotY=xn(Xn,1),De.y=ye.toValue(De.plotY,!0))}else oi=(De.x-Bt.x)/($t.x-Bt.x),De.plotY+=oi*($t[Be]-Bt[Be]),De.y+=oi*($t.y-Bt.y);if(Te--,Ke++,Te<0)break}}z.forEach((Vi,lr)=>{let Vr;Vi.plotX+=st,(Vi.plotY===void 0||ne)&&(Vi.plotX>=0&&Vi.plotX<=ce.len?ne?(Vi.plotY=ce.translate(Vi.x,0,1,0,1),Vi.plotX=fm(Vi.y)?ye.translate(Vi.y,0,0,0,1):0):Vi.plotY=(ce.opposite?0:T.yAxis.len)+ce.offset:Vi.shapeArgs={}),(Oe=z[lr-1])&&Oe.plotX===Vi.plotX&&(Oe.stackIndex===void 0&&(Oe.stackIndex=0),Vr=Oe.stackIndex+1),Vi.stackIndex=Vr}),this.onSeries=X}ie.compose=function(T){if(Vb(ef,"OnSeries")){let P=T.prototype;P.getPlotBox=p,P.translate=b}return T},ie.getPlotBox=p,ie.translate=b})(Ae||(Ae={}));let Pk=Ae,{noop:BT}=Je,{distribute:Ok}=Vs,{series:qh,seriesTypes:{column:FT}}=Ia,{addEvent:Nx,defined:Rk,extend:Nk,isNumber:zT,merge:Wb,objectEach:UT,wrap:Mw}=Ht;class Rv extends FT{animate(p){p&&this.setClip()}drawPoints(){let p,b,T,P,O,z,j,X,re,de,ne,ce=this.points,ye=this.chart,Te=ye.renderer,De=ye.inverted,Oe=this.options,Be=Oe.y,Ke=this.yAxis,st={},Bt=[],Ut=zT(Oe.borderRadius)?Oe.borderRadius:0;for(P=ce.length;P--;)O=ce[P],de=(De?O.plotY:O.plotX)>this.xAxis.len,p=O.plotX,j=O.stackIndex,T=O.options.shape||Oe.shape,(b=O.plotY)!==void 0&&(b=O.plotY+Be-(j!==void 0&&j*Oe.stackDistance)),O.anchorX=j?void 0:O.plotX,X=j?void 0:O.plotY,ne=T!=="flag",z=O.graphic,b!==void 0&&p>=0&&!de?(z&&O.hasNewShapeType()&&(z=z.destroy()),z||(z=O.graphic=Te.label("",0,void 0,T,void 0,void 0,Oe.useHTML).addClass("highcharts-point").add(this.markerGroup),O.graphic.div&&(O.graphic.div.point=O),z.isNew=!0),z.attr({align:ne?"center":"left",width:Oe.width,height:Oe.height,"text-align":Oe.textAlign,r:Ut}),ye.styledMode||z.attr(this.pointAttribs(O)).css(Wb(Oe.style,O.style)).shadow(Oe.shadow),p>0&&(p-=z.strokeWidth()%2),re={y:b,anchorY:X},Oe.allowOverlapX&&(re.x=p,re.anchorX=O.anchorX),z.attr({text:O.options.title??Oe.title??"A"})[z.isNew?"attr":"animate"](re),Oe.allowOverlapX||(st[O.plotX]?st[O.plotX].size=Math.max(st[O.plotX].size,z.width||0):st[O.plotX]={align:.5*!!ne,size:z.width||0,target:p,anchorX:p}),O.tooltipPos=[p,b+Ke.pos-ye.plotTop]):z&&(O.graphic=z.destroy());if(!Oe.allowOverlapX){let $t=100;for(let ci of(UT(st,function(oi){oi.plotX=oi.anchorX,Bt.push(oi),$t=Math.max(oi.size,$t)}),Ok(Bt,De?Ke.len:this.xAxis.len,$t),ce)){let oi=ci.plotX,di=ci.graphic,er=di&&st[oi];er&&di&&(Rk(er.pos)?di[di.isNew?"attr":"animate"]({x:er.pos+(er.align||0)*er.size,anchorX:ci.anchorX}).show().isNew=!1:di.hide().isNew=!0)}}Oe.useHTML&&this.markerGroup&&Mw(this.markerGroup,"on",function($t){return Qa.prototype.on.apply($t.apply(this,[].slice.call(arguments,1)),[].slice.call(arguments,1))})}drawTracker(){let p=this.points;for(let b of(super.drawTracker(),p)){let T=b.graphic;T&&(b.unbindMouseOver&&b.unbindMouseOver(),b.unbindMouseOver=Nx(T.element,"mouseover",function(){for(let P of(b.stackIndex>0&&!b.raised&&(b._y=T.y,T.attr({y:b._y-8}),b.raised=!0),p))P!==b&&P.raised&&P.graphic&&(P.graphic.attr({y:P._y}),P.raised=!1)}))}}pointAttribs(p,b){let T=this.options,P=p&&p.color||this.color,O=T.lineColor,z=p&&p.lineWidth,j=p&&p.fillColor||T.fillColor;return b&&(j=T.states[b].fillColor,O=T.states[b].lineColor,z=T.states[b].lineWidth),{fill:j||P,stroke:O||P,"stroke-width":z||T.lineWidth||0}}setClip(){qh.prototype.setClip.apply(this,arguments),this.options.clip!==!1&&this.sharedClipKey&&this.markerGroup&&this.markerGroup.clip(this.chart.sharedClips[this.sharedClipKey])}}Rv.compose=sp.compose,Rv.defaultOptions=Wb(FT.defaultOptions,{borderRadius:0,pointRange:0,allowOverlapX:!1,shape:"flag",stackDistance:12,textAlign:"center",tooltip:{pointFormat:"{point.text}"},threshold:null,y:-30,fillColor:"#ffffff",lineWidth:1,states:{hover:{lineColor:"#000000",fillColor:"#ccd3ff"}},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold"}}),Pk.compose(Rv),Nk(Rv.prototype,{allowDG:!1,forceCrop:!0,invertible:!1,noSharedTooltip:!0,pointClass:Tp,sorted:!1,takeOrdinalPosition:!1,trackerGroups:["markerGroup"],buildKDTree:BT,init:qh.prototype.init}),Ia.registerSeriesType("flags",Rv);let{addEvent:$_,find:jb,fireEvent:Bx,isArray:Bk,isNumber:mm,pick:Nv}=Ht;(function(ie){function p(){this.brokenAxis!==void 0&&this.brokenAxis.setBreaks(this.options.breaks,!1)}function b(){var de;(de=this.brokenAxis)!=null&&de.hasBreaks&&(this.options.ordinal=!1)}function T(){let de=this.brokenAxis;if(de!=null&&de.hasBreaks){let ne=this.tickPositions,ce=this.tickPositions.info,ye=[];for(let Te=0;Te<ne.length;Te++)de.isInAnyBreak(ne[Te])||ye.push(ne[Te]);this.tickPositions=ye,this.tickPositions.info=ce}}function P(){this.brokenAxis||(this.brokenAxis=new re(this))}function O(){var De,Oe;let{isDirty:de,options:{connectNulls:ne},points:ce,xAxis:ye,yAxis:Te}=this;if(de){let Be=ce.length;for(;Be--;){let Ke=ce[Be],st=(Ke.y!==null||ne!==!1)&&(((De=ye==null?void 0:ye.brokenAxis)==null?void 0:De.isInAnyBreak(Ke.x,!0))||((Oe=Te==null?void 0:Te.brokenAxis)==null?void 0:Oe.isInAnyBreak(Ke.y,!0)));Ke.visible=!st&&Ke.options.visible!==!1}}}function z(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,Nv(this.pointArrayMap,["y"]))}function j(de,ne){var Be;let ce,ye,Te,De=this,Oe=De.points;if((Be=de==null?void 0:de.brokenAxis)!=null&&Be.hasBreaks){let Ke=de.brokenAxis;ne.forEach(function(st){var Ut,$t;ce=(Ke==null?void 0:Ke.breakArray)||[],ye=de.isXAxis?de.min:Nv(De.options.threshold,de.min);let Bt=($t=(Ut=de==null?void 0:de.options)==null?void 0:Ut.breaks)==null?void 0:$t.filter(function(ci){let oi=!0;for(let di=0;di<ce.length;di++){let er=ce[di];if(er.from===ci.from&&er.to===ci.to){oi=!1;break}}return oi});Oe.forEach(function(ci){Te=Nv(ci["stack"+st.toUpperCase()],ci[st]),ce.forEach(function(oi){if(mm(ye)&&mm(Te)){let di="";ye<oi.from&&Te>oi.to||ye>oi.from&&Te<oi.from?di="pointBreak":(ye<oi.from&&Te>oi.from&&Te<oi.to||ye>oi.from&&Te>oi.to&&Te<oi.from)&&(di="pointInBreak"),di&&Bx(de,di,{point:ci,brk:oi})}}),Bt==null||Bt.forEach(function(oi){Bx(de,"pointOutsideOfBreak",{point:ci,brk:oi})})})})}}function X(){let de=this.currentDataGrouping,ne=de==null?void 0:de.gapSize,ce=this.points.slice(),ye=this.yAxis,Te=this.options.gapSize,De=ce.length-1;if(Te&&De>0){let Oe,Be;for(this.options.gapUnit!=="value"&&(Te*=this.basePointRange),ne&&ne>Te&&ne>=this.basePointRange&&(Te=ne);De--;)if(Be&&Be.visible!==!1||(Be=ce[De+1]),Oe=ce[De],Be.visible!==!1&&Oe.visible!==!1){if(Be.x-Oe.x>Te){let Ke=(Oe.x+Be.x)/2;ce.splice(De+1,0,{isNull:!0,x:Ke}),ye.stacking&&this.options.stacking&&((ye.stacking.stacks[this.stackKey][Ke]=new C(ye,ye.options.stackLabels,!1,Ke,this.stack)).total=0)}Be=Oe}}return this.getGraphPath(ce)}ie.compose=function(de,ne){if(!de.keepProps.includes("brokenAxis")){de.keepProps.push("brokenAxis"),$_(de,"init",P),$_(de,"afterInit",p),$_(de,"afterSetTickPositions",T),$_(de,"afterSetOptions",b);let ce=ne.prototype;ce.drawBreaks=j,ce.gappedPath=X,$_(ne,"afterGeneratePoints",O),$_(ne,"afterRender",z)}return de};class re{static isInBreak(ne,ce){let ye=ne.repeat||1/0,Te=ne.from,De=ne.to-ne.from,Oe=ce>=Te?(ce-Te)%ye:ye-(Te-ce)%ye;return ne.inclusive?Oe<=De:Oe<De&&Oe!==0}static lin2Val(ne){let ce=this.brokenAxis,ye=ce==null?void 0:ce.breakArray;if(!ye||!mm(ne))return ne;let Te=ne,De,Oe;for(Oe=0;Oe<ye.length&&!((De=ye[Oe]).from>=Te);Oe++)(De.to<Te||re.isInBreak(De,Te))&&(Te+=De.len);return Te}static val2Lin(ne){let ce=this.brokenAxis,ye=ce==null?void 0:ce.breakArray;if(!ye||!mm(ne))return ne;let Te=ne,De,Oe;for(Oe=0;Oe<ye.length;Oe++)if((De=ye[Oe]).to<=ne)Te-=De.len;else{if(De.from>=ne)break;if(re.isInBreak(De,ne)){Te-=ne-De.from;break}}return Te}constructor(ne){this.hasBreaks=!1,this.axis=ne}findBreakAt(ne,ce){return jb(ce,function(ye){return ye.from<ne&&ne<ye.to})}isInAnyBreak(ne,ce){let ye=this.axis,Te=ye.options.breaks||[],De=Te.length,Oe,Be,Ke;if(De&&mm(ne)){for(;De--;)re.isInBreak(Te[De],ne)&&(Oe=!0,Be||(Be=Nv(Te[De].showPoints,!ye.isXAxis)));Ke=Oe&&ce?Oe&&!Be:Oe}return Ke}setBreaks(ne,ce){let ye=this,Te=ye.axis,De=Te.chart.time,Oe=Bk(ne)&&!!ne.length&&!!Object.keys(ne[0]).length;Te.isDirty=ye.hasBreaks!==Oe,ye.hasBreaks=Oe,ne==null||ne.forEach(Be=>{Be.from=De.parse(Be.from)||0,Be.to=De.parse(Be.to)||0}),ne!==Te.options.breaks&&(Te.options.breaks=Te.userOptions.breaks=ne),Te.forceRedraw=!0,Te.series.forEach(function(Be){Be.isDirty=!0}),Oe||Te.val2lin!==re.val2Lin||(delete Te.val2lin,delete Te.lin2val),Oe&&(Te.userOptions.ordinal=!1,Te.lin2val=re.lin2Val,Te.val2lin=re.val2Lin,Te.setExtremes=function(Be,Ke,st,Bt,Ut){if(ye.hasBreaks){let $t,ci=this.options.breaks||[];for(;$t=ye.findBreakAt(Be,ci);)Be=$t.to;for(;$t=ye.findBreakAt(Ke,ci);)Ke=$t.from;Ke<Be&&(Ke=Be)}Te.constructor.prototype.setExtremes.call(this,Be,Ke,st,Bt,Ut)},Te.setAxisTranslation=function(){if(Te.constructor.prototype.setAxisTranslation.call(this),ye.unitLength=void 0,ye.hasBreaks){let Be=Te.options.breaks||[],Ke=[],st=[],Bt=Nv(Te.pointRangePadding,0),Ut=0,$t,ci,oi=Te.userMin||Te.min,di=Te.userMax||Te.max,er,Vi;Be.forEach(function(lr){ci=lr.repeat||1/0,mm(oi)&&mm(di)&&(re.isInBreak(lr,oi)&&(oi+=lr.to%ci-oi%ci),re.isInBreak(lr,di)&&(di-=di%ci-lr.from%ci))}),Be.forEach(function(lr){if(er=lr.from,ci=lr.repeat||1/0,mm(oi)&&mm(di)){for(;er-ci>oi;)er-=ci;for(;er<oi;)er+=ci;for(Vi=er;Vi<di;Vi+=ci)Ke.push({value:Vi,move:"in"}),Ke.push({value:Vi+lr.to-lr.from,move:"out",size:lr.breakSize})}}),Ke.sort(function(lr,Vr){return lr.value===Vr.value?(lr.move!=="in")-(Vr.move!=="in"):lr.value-Vr.value}),$t=0,er=oi,Ke.forEach(function(lr){($t+=lr.move==="in"?1:-1)===1&&lr.move==="in"&&(er=lr.value),$t===0&&mm(er)&&(st.push({from:er,to:lr.value,len:lr.value-er-(lr.size||0)}),Ut+=lr.value-er-(lr.size||0))}),ye.breakArray=st,mm(oi)&&mm(di)&&mm(Te.min)&&(ye.unitLength=di-oi-Ut+Bt,Bx(Te,"afterBreaks"),Te.staticScale?Te.transA=Te.staticScale:ye.unitLength&&(Te.transA*=(di-Te.min+Bt)/ye.unitLength),Bt&&(Te.minPixelPadding=Te.transA*(Te.minPointOffset||0)),Te.min=oi,Te.max=di)}}),Nv(ce,!0)&&Te.chart.redraw()}}ie.Additions=re})(mt||(mt={}));let Fk=mt;Je.BrokenAxis=Je.BrokenAxis||Fk,Je.BrokenAxis.compose(Je.Axis,Je.Series);let jc={},{arrayMax:Fx,arrayMin:Bv,correctFloat:Iw,extend:Hb,isNumber:Cy}=Ht;function Lw(ie){let p=ie.length,b=Dw(ie);return Cy(b)&&p&&(b=Iw(b/p)),b}function Dw(ie){let p=ie.length,b;if(!p&&ie.hasNulls)b=null;else if(p)for(b=0;p--;)b+=ie[p];return b}let $T={average:Lw,averages:function(){let ie=[];return[].forEach.call(arguments,function(p){ie.push(Lw(p))}),ie[0]===void 0?void 0:ie},close:function(ie){return ie.length?ie[ie.length-1]:ie.hasNulls?null:void 0},high:function(ie){return ie.length?Fx(ie):ie.hasNulls?null:void 0},hlc:function(ie,p,b){if(ie=jc.high(ie),p=jc.low(p),b=jc.close(b),Cy(ie)||Cy(p)||Cy(b))return[ie,p,b]},low:function(ie){return ie.length?Bv(ie):ie.hasNulls?null:void 0},ohlc:function(ie,p,b,T){if(ie=jc.open(ie),p=jc.high(p),b=jc.low(b),T=jc.close(T),Cy(ie)||Cy(p)||Cy(b)||Cy(T))return[ie,p,b,T]},open:function(ie){return ie.length?ie[0]:ie.hasNulls?null:void 0},range:function(ie,p){return ie=jc.low(ie),p=jc.high(p),Cy(ie)||Cy(p)?[ie,p]:ie===null&&p===null?null:void 0},sum:Dw};Hb(jc,$T);let V_={common:{groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%[AebHMSL]","%[AebHMSL]","-%[HMSL]"],second:["%[AebHMS]","%[AebHMS]","-%[HMS]"],minute:["%[AebHM]","%[AebHM]","-%[HM]"],hour:["%[AebHM]","%[AebHM]","-%[HM]"],day:["%[AebY]","%[Aeb]","-%[AebY]"],week:["%v %[AebY]","%[Aeb]","-%[AebY]"],month:["%[BY]","%[B]","-%[BY]"],year:["%Y","%Y","-%Y"]}},seriesSpecific:{line:{},spline:{},area:{},areaspline:{},arearange:{},column:{groupPixelWidth:10},columnrange:{groupPixelWidth:10},candlestick:{groupPixelWidth:10},ohlc:{groupPixelWidth:5},hlc:{groupPixelWidth:5},heikinashi:{groupPixelWidth:10}},units:[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]]},{addEvent:Pw,extend:Ow,merge:VT,pick:Rw}=Ht;function WT(ie){let p=this,b=p.series;b.forEach(function(T){T.groupPixelWidth=void 0}),b.forEach(function(T){T.groupPixelWidth=p.getGroupPixelWidth&&p.getGroupPixelWidth(),T.groupPixelWidth&&(T.hasProcessed=!0),T.applyGrouping(!!ie.hasExtremesChanged)})}function jT(){let ie=this.series,p=ie.length,b=0,T=!1,P,O;for(;p--;)(O=ie[p].options.dataGrouping)&&(b=Math.max(b,Rw(O.groupPixelWidth,V_.common.groupPixelWidth)),P=(ie[p].dataTable.modified||ie[p].dataTable).rowCount,(ie[p].groupPixelWidth||P>this.chart.plotSizeX/b||P&&O.forced)&&(T=!0));return T?b:0}function HT(){this.series.forEach(function(ie){ie.hasProcessed=!1})}function GT(ie,p){let b;if(p=Rw(p,!0),ie||(ie={forced:!1,units:null}),this instanceof f)for(b=this.series.length;b--;)this.series[b].update({dataGrouping:ie},!1);else this.chart.options.series.forEach(function(T){T.dataGrouping=typeof ie=="boolean"?ie:VT(ie,T.dataGrouping)});this.ordinal&&(this.ordinal.slope=void 0),p&&this.chart.redraw()}let qT={compose:function(ie){f=ie;let p=ie.prototype;p.applyGrouping||(Pw(ie,"afterSetScale",HT),Pw(ie,"postProcessData",WT),Ow(p,{applyGrouping:WT,getGroupPixelWidth:jT,setDataGrouping:GT}))}},{series:{prototype:$g}}=Ia,{addEvent:Gb,defined:W_,error:Fv,extend:h0,isNumber:eg,merge:qb,pick:YT,splat:XT}=Ht,zk=$g.generatePoints;function Uk(ie){var p,b,T;let P,O,z=this.chart,j=this.options.dataGrouping,X=this.allowDG!==!1&&j&&YT(j.enabled,z.options.isStock),re=this.reserveSpace(),de=this.currentDataGrouping,ne,ce,ye=!1;X&&!this.requireSorting&&(this.requireSorting=ye=!0);let Te=(p=this,b=ie,!!(p.isCartesian&&!p.isDirty&&!p.xAxis.isDirty&&!p.yAxis.isDirty&&!b)||!X);if(ye&&(this.requireSorting=!1),Te)return;this.destroyGroupedData();let De=j.groupAll?this.dataTable:this.dataTable.modified||this.dataTable,Oe=this.getColumn("x",!j.groupAll),Be=z.plotSizeX,Ke=this.xAxis,st=Ke.getExtremes(),Bt=Ke.options.ordinal,Ut=this.groupPixelWidth;if(Ut&&Oe&&De.rowCount&&Be&&eg(st.min)){O=!0,this.isDirty=!0,this.points=null;let $t=st.min,ci=st.max,oi=Bt&&Ke.ordinal&&Ke.ordinal.getGroupIntervalFactor($t,ci,this)||1,di=Ut*(ci-$t)/Be*oi,er=Ke.getTimeTicks(Su.Additions.prototype.normalizeTimeTickInterval(di,j.units||V_.units),Math.min($t,Oe[0]),Math.max(ci,Oe[Oe.length-1]),Ke.options.startOfWeek,Oe,this.closestPointRange),Vi=$g.groupData.apply(this,[De,er,j.approximation]),lr=Vi.modified,Vr=lr.getColumn("x",!0),Wn=0;for(j!=null&&j.smoothed&&lr.rowCount&&(j.firstAnchor="firstPoint",j.anchor="middle",j.lastAnchor="lastPoint",Fv(32,!1,z,{"dataGrouping.smoothed":"use dataGrouping.anchor"})),P=1;P<er.length;P++)er.info.segmentStarts&&er.info.segmentStarts.indexOf(P)!==-1||(Wn=Math.max(er[P]-er[P-1],Wn));(ne=er.info).gapSize=Wn,this.closestPointRange=er.info.totalRange,this.groupMap=Vi.groupMap,this.currentDataGrouping=ne,function(xn,Nn,Bn){let Xn=xn.options.dataGrouping,es=xn.currentDataGrouping&&xn.currentDataGrouping.gapSize,ns=xn.getColumn("x");if(!(Xn&&ns.length&&es&&xn.groupMap))return;let Qs=Nn.length-1,Nl=Xn.anchor,Uo=Xn.firstAnchor,jo=Xn.lastAnchor,mo=Nn.length-1,io=0;if(Uo&&ns[0]>=Nn[0]){let vc;io++;let El=xn.groupMap[0].start,fc=xn.groupMap[0].length;eg(El)&&eg(fc)&&(vc=El+(fc-1)),Nn[0]={start:Nn[0],middle:Nn[0]+.5*es,end:Nn[0]+es,firstPoint:ns[0],lastPoint:vc&&ns[vc]}[Uo]}if(Qs>0&&jo&&es&&Nn[Qs]>=Bn-es){mo--;let vc=xn.groupMap[xn.groupMap.length-1].start;Nn[Qs]={start:Nn[Qs],middle:Nn[Qs]+.5*es,end:Nn[Qs]+es,firstPoint:vc&&ns[vc],lastPoint:ns[ns.length-1]}[jo]}if(Nl&&Nl!=="start"){let vc=es*{middle:.5,end:1}[Nl];for(;mo>=io;)Nn[mo]+=vc,mo--}}(this,Vr||[],ci),re&&Vr&&(W_((T=Vr)[0])&&eg(Ke.min)&&eg(Ke.dataMin)&&T[0]<Ke.min&&((!W_(Ke.options.min)&&Ke.min<=Ke.dataMin||Ke.min===Ke.dataMin)&&(Ke.min=Math.min(T[0],Ke.min)),Ke.dataMin=Math.min(T[0],Ke.dataMin)),W_(T[T.length-1])&&eg(Ke.max)&&eg(Ke.dataMax)&&T[T.length-1]>Ke.max&&((!W_(Ke.options.max)&&eg(Ke.dataMax)&&Ke.max>=Ke.dataMax||Ke.max===Ke.dataMax)&&(Ke.max=Math.max(T[T.length-1],Ke.max)),Ke.dataMax=Math.max(T[T.length-1],Ke.dataMax))),j.groupAll&&(this.allGroupedTable=lr,Vr=(lr=(ce=this.cropData(lr,Ke.min||0,Ke.max||0)).modified).getColumn("x"),this.cropStart=ce.start),this.dataTable.modified=lr}else this.groupMap=void 0,this.currentDataGrouping=void 0;this.hasGroupedData=O,this.preventGraphAnimation=(de&&de.totalRange)!==(ne&&ne.totalRange)}function Nw(){this.groupedData&&(this.groupedData.forEach(function(ie,p){ie&&(this.groupedData[p]=ie.destroy?ie.destroy():null)},this),this.groupedData.length=0,delete this.allGroupedTable)}function ZT(){zk.apply(this),this.destroyGroupedData(),this.groupedData=this.hasGroupedData?this.points:null}function j_(){return this.is("arearange")?"range":this.is("ohlc")?"ohlc":this.is("hlc")?"hlc":this.is("column")||this.options.cumulative?"sum":"average"}function zv(ie,p,b){let T=ie.getColumn("x",!0)||[],P=ie.getColumn("y",!0),O=this,z=O.data,j=O.options&&O.options.data,X=[],re=new Wd,de=[],ne=ie.rowCount,ce=!!P,ye=[],Te=O.pointArrayMap,De=Te&&Te.length,Oe=["x"].concat(Te||["y"]),Be=(Te||["y"]).map(()=>[]),Ke=this.options.dataGrouping&&this.options.dataGrouping.groupAll,st,Bt,Ut,$t=0,ci=0,oi=typeof b=="function"?b:b&&jc[b]?jc[b]:jc[O.getDGApproximation&&O.getDGApproximation()||"average"];if(De){let Vi=Te.length;for(;Vi--;)ye.push([])}else ye.push([]);let di=De||1;for(let Vi=0;Vi<=ne;Vi++)if(!(T[Vi]<p[0])){for(;p[$t+1]!==void 0&&T[Vi]>=p[$t+1]||Vi===ne;){if(st=p[$t],O.dataGroupInfo={start:Ke?ci:O.cropStart+ci,length:ye[0].length,groupStart:st},Ut=oi.apply(O,ye),O.pointClass&&!W_(O.dataGroupInfo.options)&&(O.dataGroupInfo.options=qb(O.pointClass.prototype.optionsToObject.call({series:O},O.options.data[O.cropStart+ci])),Oe.forEach(function(lr){delete O.dataGroupInfo.options[lr]})),Ut!==void 0){X.push(st);let lr=XT(Ut);for(let Vr=0;Vr<lr.length;Vr++)Be[Vr].push(lr[Vr]);de.push(O.dataGroupInfo)}ci=Vi;for(let lr=0;lr<di;lr++)ye[lr].length=0,ye[lr].hasNulls=!1;if($t+=1,Vi===ne)break}if(Vi===ne)break;if(Te){let lr,Vr=Ke?Vi:O.cropStart+Vi,Wn=z&&z[Vr]||O.pointClass.prototype.applyOptions.apply({series:O},[j[Vr]]);for(let xn=0;xn<De;xn++)eg(lr=Wn[Te[xn]])?ye[xn].push(lr):lr===null&&(ye[xn].hasNulls=!0)}else eg(Bt=ce?P[Vi]:null)?ye[0].push(Bt):Bt===null&&(ye[0].hasNulls=!0)}let er={x:X};return(Te||["y"]).forEach((Vi,lr)=>{er[Vi]=Be[lr]}),re.setColumns(er),{groupMap:de,modified:re}}function Bw(ie){let p=ie.options,b=this.type,T=this.chart.options.plotOptions,P=this.useCommonDataGrouping&&V_.common,O=V_.seriesSpecific,z=vi.defaultOptions.plotOptions[b].dataGrouping;if(T&&(O[b]||P)){let j=this.chart.rangeSelector;z||(z=qb(V_.common,O[b])),p.dataGrouping=qb(P,z,T.series&&T.series.dataGrouping,T[b].dataGrouping,this.userOptions.dataGrouping,!p.isInternal&&j&&eg(j.selected)&&j.buttonOptions[j.selected].dataGrouping)}}let Fw={compose:function(ie){let p=ie.prototype;p.applyGrouping||(Gb(ie.prototype.pointClass,"update",function(){if(this.dataGroup)return Fv(24,!1,this.series.chart),!1}),Gb(ie,"afterSetOptions",Bw),Gb(ie,"destroy",Nw),h0(p,{applyGrouping:Uk,destroyGroupedData:Nw,generatePoints:ZT,getDGApproximation:j_,groupData:zv}))},groupData:zv},{format:Yb}=ba,{composed:KT}=Je,{addEvent:QT,extend:Vg,isNumber:zw,pick:Uv,pushUnique:H_}=Ht;function JT(ie){var Oe;let p=this.chart,b=p.time,T=ie.point,P=T.series,O=P.options,z=P.tooltipOptions,j=O.dataGrouping,X=P.xAxis,re=z.xDateFormat||"",de,ne,ce,ye,Te,De=z[ie.isFooter?"footerFormat":"headerFormat"];if(X&&X.options.type==="datetime"&&j&&zw(T.key)){ne=P.currentDataGrouping,ce=j.dateTimeLabelFormats||V_.common.dateTimeLabelFormats,ne?(ye=ce[ne.unitName],ne.count===1?re=ye[0]:(re=ye[1],de=ye[2])):!re&&ce&&X.dateTime&&(re=X.dateTime.getXDateFormat(T.x,z.dateTimeLabelFormats));let Be=Uv((Oe=P.groupMap)==null?void 0:Oe[T.index].groupStart,T.key),Ke=Be+((ne==null?void 0:ne.totalRange)||0)-1;Te=b.dateFormat(re,Be),de&&(Te+=b.dateFormat(de,Ke)),P.chart.styledMode&&(De=this.styledModeFormat(De)),ie.text=Yb(De,{point:Vg(T,{key:Te}),series:P},p),ie.preventDefault()}}let eC={compose:function(ie,p,b){qT.compose(ie),Fw.compose(p),b&&H_(KT,"DataGrouping")&&QT(b,"headerFormatter",JT)},groupData:Fw.groupData};Je.dataGrouping=Je.dataGrouping||{},Je.dataGrouping.approximationDefaults=Je.dataGrouping.approximationDefaults||$T,Je.dataGrouping.approximations=Je.dataGrouping.approximations||jc,eC.compose(Je.Axis,Je.Series,Je.Tooltip);let{defined:Xb,isNumber:Uw,pick:Zb}=Ht,zx={backgroundColor:"string",borderColor:"string",borderRadius:"string",color:"string",fill:"string",fontSize:"string",labels:"string",name:"string",stroke:"string",title:"string"},{addEvent:tC,isObject:$k,pick:Vk,defined:$v,merge:Wk}=Ht,{getAssignedAxis:Kb}={annotationsFieldsTypes:zx,getAssignedAxis:function(ie){return ie.filter(p=>{let b=p.axis.getExtremes(),T=b.min,P=b.max,O=Zb(p.axis.minPointOffset,0);return Uw(T)&&Uw(P)&&p.value>=T-O&&p.value<=P+O&&!p.axis.options.isInternal})[0]},getFieldType:function(ie,p){let b=zx[ie],T=typeof p;return Xb(b)&&(T=b),{string:"text",number:"number",boolean:"checkbox"}[T]}},iC=[],rC={enabled:!0,sensitivity:1.1},Qb=ie=>($k(ie)||(ie={enabled:ie??!0}),Wk(rC,ie)),nC=function(ie,p,b,T,P,O,z){let j=Vk(z.type,ie.zooming.type,""),X=[];j==="x"?X=b:j==="y"?X=T:j==="xy"&&(X=ie.axes);let re=ie.transform({axes:X,to:{x:P-5,y:O-5,width:10,height:10},from:{x:P-5*p,y:O-5*p,width:10*p,height:10*p},trigger:"mousewheel"});return re&&($v(i)&&clearTimeout(i),i=setTimeout(()=>{var de;(de=ie.pointer)==null||de.drop()},400)),re};function sC(){let ie=Qb(this.zooming.mouseWheel);ie.enabled&&tC(this.container,"wheel",p=>{var P,O;p=((P=this.pointer)==null?void 0:P.normalize(p))||p;let{pointer:b}=this,T=b&&!b.inClass(p.target,"highcharts-no-mousewheel");if(this.isInsidePlot(p.chartX-this.plotLeft,p.chartY-this.plotTop)&&T){let z=ie.sensitivity||1.1,j=p.detail||(p.deltaY||0)/120,X=Kb(b.getCoordinates(p).xAxis),re=Kb(b.getCoordinates(p).yAxis);nC(this,Math.pow(z,j),X?[X.axis]:this.xAxis,re?[re.axis]:this.yAxis,p.chartX,p.chartY,ie)&&((O=p.preventDefault)==null||O.call(p))}})}Je.MouseWheelZoom=Je.MouseWheelZoom||{compose:function(ie){iC.indexOf(ie)===-1&&(iC.push(ie),tC(ie,"afterGetContainer",sC))}},Je.MouseWheelZoom.compose(Je.Chart),Je.Navigator=Je.Navigator||N_,Je.OrdinalAxis=Je.OrdinalAxis||F_,Je.RangeSelector=Je.RangeSelector||K0,Je.Scrollbar=Je.Scrollbar||vy,Je.stockChart=Je.stockChart||Ox.stockChart,Je.StockChart=Je.StockChart||Je.stockChart,Je.extend(Je.StockChart,Ox),kt.compose(Je.Series,Je.Axis,Je.Point),Rv.compose(Je.Renderer),Cn.compose(Je.Series),Je.Navigator.compose(Je.Chart,Je.Axis,Je.Series),Je.OrdinalAxis.compose(Je.Axis,Je.Series,Je.Chart),Je.RangeSelector.compose(Je.Axis,Je.Chart),Je.Scrollbar.compose(Je.Axis),Je.StockChart.compose(Je.Chart,Je.Axis,Je.Series,Je.SVGRenderer),Je.product="Highstock";let jk=Je;return Dt.default})())})(v$);var Toe=v$.exports;const fN=w_(Toe),Coe=({serviceId:e,customerAccountNo:t,redirectFrom:n,latencyData:s,setLatencyData:a,serviceStartDate:d,latencySelectedPeriod:f,setLatencySelectedPeriod:i,latencySelectedMonth:S,setLatencySelectedMonth:E,latencySelectedQuarter:L,setLatencySelectedQuarter:F,latencySelectedYear:G,setLatencySelectedYear:q,committedLatency:Q,setCommittedLatency:te,latencyChartOptions:he,setLatencyChartOptions:fe,last24HrsLatencyData:le,setLast24HrsLatencyData:Se,last24HrsCommittedLatency:ke,setLast24HrsCommittedLatency:Ee,latencySelectedQuarterMonthYear:Ie,setLatencySelectedQuarterMonthYear:He,isNetworkService:Ye=!0})=>{const[lt,Pt]=It(!s),[At,ht]=It(""),Ot=wo(null),[Ae,mt]=It([]),bt=wo(null),Dt=wo(null),Je=wo(null),dt=wo(null),ui=gi=>{var Oi;if(i(gi.target.value),d&&d!==""){const cr=((Oi=dt.current)==null?void 0:Oi.value)||G,ji=Dr().getDefaultMonth(Number(cr),d);E(ji);const nn=Dr().getQuarterFromMonth(Dr().getMonthIndex(ji));F(nn)}mt([]),a([]),Se([]),te(0),Ee(0),fe([])},Vt=gi=>{E(gi.target.value),a([])},ei=gi=>{F(gi.target.value),a([])},ur=gi=>{if(q(gi.target.value),a([]),d&&d!==""){const Oi=Dr().getDefaultMonth(Number(gi.target.value),d);E(Oi);const cr=Dr().getQuarterFromMonth(Dr().getMonthIndex(Oi));F(cr)}};Ar(()=>{const gi=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling 1:",gi);const Oi=async()=>{var cr,ji,nn,pr,Ue,ni,fi,Lt,pt,Nt,Si,pi,St;if(f){Pt(!0);try{let Ht=f.toLowerCase();f==="Monthly"&&(Ht=S),f==="Quarterly"&&(Ht=L),f==="Yearly"&&(Ht=G);const{fromDate:nr,toDate:tr}=fa().getDateRangeFromFilter(Ht,G),kr=await R1(e,f==null?void 0:f.toLowerCase(),t,fa().formatSLADate(nr),fa().formatSLADate(tr),"latency");console.log("Latency response:",kr);let Mr=null;if(f=="Weekly"){const{fromDate:Cr,toDate:Tn}=fa().getDateRangeFromFilter("current");Mr=await R1(e,"current",t,fa().formatSLADate(Cr),fa().formatSLADate(Tn),"latency")}if(kr&&(kr!=null&&kr.data)&&((cr=kr==null?void 0:kr.data)==null?void 0:cr.statusCode)==200){const Cr=JSON.parse((ji=kr==null?void 0:kr.data)==null?void 0:ji.data),Tn=((pr=(nn=Cr==null?void 0:Cr.serviceDetail)==null?void 0:nn.latency)==null?void 0:pr.commitedSla)||"0.00";let gs=((ni=(Ue=Cr==null?void 0:Cr.serviceDetail)==null?void 0:Ue.latency)==null?void 0:ni.slaData.map(wn=>({name:`${wn==null?void 0:wn.startDate} - ${wn==null?void 0:wn.endDate}`,y:Number(wn==null?void 0:wn.measurementAverage)>0?Number(wn==null?void 0:wn.measurementAverage):0})))||[];a(gs),te(Tn)}else a([]),te(0);if(f=="Weekly"&&Mr&&(Mr!=null&&Mr.data)&&((fi=Mr==null?void 0:Mr.data)==null?void 0:fi.statusCode)==200){const Cr=JSON.parse((Lt=Mr==null?void 0:Mr.data)==null?void 0:Lt.data),Tn=((Nt=(pt=Cr==null?void 0:Cr.serviceDetail)==null?void 0:pt.latency)==null?void 0:Nt.commitedSla)||"0.00",gs=((pi=(Si=Cr==null?void 0:Cr.serviceDetail)==null?void 0:Si.latency)==null?void 0:pi.slaData.map(wn=>({name:`${wn==null?void 0:wn.startDate} - ${wn==null?void 0:wn.endDate}`,y:Number(wn==null?void 0:wn.measurementAverage)>0?Number(wn==null?void 0:wn.measurementAverage):null})))||[];Se(gs),Ee(Tn)}else f=="Weekly"&&Mr&&(Mr!=null&&Mr.data)&&((St=Mr==null?void 0:Mr.data)==null?void 0:St.statusCode)!=200&&(Se([]),Ee(0))}catch(Ht){console.error("Error fetching Latency SLA details:",Ht),ht("Unable to load latency graphs. Please try again later.")}finally{Pt(!1)}}};Ye&&t&&e&&(s==null?void 0:s.length)==0&&Oi()},[e,f,S,L,G,s==null?void 0:s.length]);const Zt=gi=>{const[Oi,cr,ji]=gi.split("-"),[nn]=ji.split(" "),pr={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Ue=new Date(parseInt(nn),pr[cr],parseInt(Oi),0,0,0);return Ue.getTime()-Ue.getTimezoneOffset()*60*1e3};function Kt(gi){const Oi={};gi.forEach(([Ue,ni])=>{Oi[Ue]=ni});const cr=new Date,ji=new Date(cr.getFullYear(),cr.getMonth(),cr.getDate(),0,0,0,0).getTime(),nn=cr.getTime(),pr=[];for(let Ue=ji;Ue<=nn;Ue+=15*60*1e3)pr.push([Ue,Oi[Ue]??null]);return pr}function Ui(){const gi=new Date,Oi=new Date(gi.getFullYear(),gi.getMonth(),gi.getDate(),0,0,0,0).getTime(),cr=gi.getTime(),ji=[];for(let nn=Oi;nn<=cr;nn+=60*60*1e3)ji.push([nn,null]);return ji}Ar(()=>{console.debug("latencyData -------- ",s),console.debug("last24HrsLatencyData -------- ",le);const gi=(window==null?void 0:window.chartStylingObj)??{};console.debug("chartStyling 2:",gi);let Oi=[],cr=[],ji=[];const nn=Dr().months,pr=Dr().currentYear,Ue=new Date().getMonth();if(f==="Yearly"){const pt=new Date(d),Nt=pt.getFullYear(),Si=pt.getMonth();G==pr?Nt==pr?(Oi=nn.slice(Si,Ue+1),cr=s.slice(Si,Ue+1).map((St,Ht)=>({name:Oi[Ht],y:St.y!==void 0?St.y!==null?Number(St.y):null:St.measurementAverage!==void 0&&St.measurementAverage!==null?Number(St.measurementAverage):null}))):(Oi=nn.slice(0,Ue+1),cr=s.slice(0,Ue+1).map((St,Ht)=>({name:Oi[Ht],y:St.y!==void 0?St.y!==null?Number(St.y):null:St.measurementAverage!==void 0&&St.measurementAverage!==null?Number(St.measurementAverage):null}))):Nt==G?(Oi=nn.slice(Si),cr=s.slice(Si).map((St,Ht)=>({name:Oi[Ht],y:St.y!==void 0?St.y!==null?Number(St.y):null:St.measurementAverage!==void 0&&St.measurementAverage!==null?Number(St.measurementAverage):null}))):(Oi=nn.slice(),cr=s.slice(0,12).map((pi,St)=>({name:Oi[St],y:pi.y!==void 0?pi.y!==null?Number(pi.y):null:pi.measurementAverage!==void 0&&pi.measurementAverage!==null?Number(pi.measurementAverage):null})))}else if(f==="Monthly")Oi=Dr().generateWeeksForMonth(Dr().months.indexOf(S),G||Dr().currentYear,d);else if(f==="Weekly"){if(Oi=Dr().generateLast7Days(),d){const St=new Date(d),Ht=Mr=>`${Mr.getDate()}-${Mr.toLocaleString("default",{month:"short"})}-${Mr.getFullYear()}`,nr=new Date,tr=new Date;if(tr.setDate(nr.getDate()-6),St>=tr&&St<=nr){const Mr=Ht(St),Cr=Oi.indexOf(Mr);Cr!==-1&&(Oi=Oi.slice(Cr))}}let pt=s.map(St=>{var Mr;const Ht=(Mr=St.name)==null?void 0:Mr.split(" - ")[0],nr=new Date(Ht),tr=fa().formatDateTime(nr),kr=Number(St.y);return!isNaN(nr)&&!isNaN(kr)?[tr,kr]:null}).filter(Boolean);console.debug("updatedWeeklyData before filling gaps -------- ",pt),mt(pt);const Nt=Date.now(),Si=Nt-24*60*60*1e3,pi=new Map;for(let St=Si;St<=Nt;St+=60*60*1e3)pi.set(St,null);ji=le.map(({name:St,y:Ht})=>{try{const[nr,tr]=St.split(" - ")[0].split(" "),[kr,Mr,Cr]=nr.split("-").map(Number),[Tn,gs,wn]=tr.split(":").map(Number),bs=new Date(kr,Mr-1,Cr,Tn,gs,wn).getTime();return!isNaN(bs)&&!isNaN(Ht)?[bs,Ht]:[null,Ht]}catch(nr){return console.error("Parsing error for name:",St,nr),[null,Ht]}}),ji=ji.filter(([St,Ht])=>St!==null).sort(([St],[Ht])=>St-Ht)}else f==="Quarterly"&&(Oi=Dr().getMonthsForQuarter(L));if(f==="Monthly"&&s&&s.length>0){const pt=Dr().months,Nt=pi=>{const Ht=pi.replace(/<br\s*\/?>.*$/i,"").match(/^\s*(\d{1,2})\s*-\s*(\d{1,2})\s*([A-Za-z]+)/);if(!Ht)return null;const[,nr,tr,kr]=Ht,Mr=pt.findIndex(Cr=>Cr.toLowerCase().startsWith(kr.toLowerCase()));return{sDay:Number(nr),eDay:Number(tr),monthIdx:Mr}},Si=s.map(pi=>{const[St,Ht]=pi.name.split(" - ").map(kr=>kr.trim()),nr=new Date(St),tr=new Date(Ht);return{sDay:nr.getDate(),eDay:tr.getDate(),monthIdx:nr.getMonth(),y:Number(pi.y)}});cr=Oi.map(pi=>{const St=Nt(pi);if(!St||St.monthIdx<0)return{name:pi,y:null};const Ht=Si.find(nr=>nr.monthIdx===St.monthIdx&&nr.sDay===St.sDay&&nr.eDay===St.eDay);return{name:pi,y:Ht?Ht.y:null}})}else if(f==="Yearly"&&s&&s.length>0){const pt=Dr().months,Nt=s.map(Si=>{const[pi,St]=Si.name.split(" - ").map(nr=>nr.trim()),Ht=new Date(pi);return{monthIdx:Ht.getMonth(),year:Ht.getFullYear(),y:Si.y!==null?Number(Si.y):null}});cr=Oi.map(Si=>{const pi=pt.findIndex(Ht=>Ht.toLowerCase()===Si.toLowerCase());if(pi<0)return{name:Si,y:null};const St=Nt.find(Ht=>Ht.monthIdx===pi);return{name:Si,y:St?St.y:null}})}else if(f==="Quarterly"&&s&&s.length>0){const pt=Dr().months,Nt={"Q1 (Jan-Mar)":"January","Q2 (Apr-Jun)":"April","Q3 (Jul-Sep)":"July","Q4 (Oct-Dec)":"October"},Si=s.map(pi=>{const[St,Ht]=pi.name.split(" - ").map(tr=>tr.trim()),nr=new Date(St);return{monthIdx:nr.getMonth(),year:nr.getFullYear(),y:pi.y!==null?Number(pi.y):null}});cr=Oi.map(pi=>{const St=Nt[pi];if(!St)return{name:pi,y:null};const Ht=pt.findIndex(tr=>tr.toLowerCase()===St.toLowerCase());if(Ht<0)return{name:pi,y:null};const nr=Si.find(tr=>tr.monthIdx===Ht);return{name:pi,y:nr?nr.y:null}})}else cr=Oi.map(pt=>({name:pt,y:null}));console.debug("xAxisCategories latency ----------- ",Oi),console.debug("chartData latency-------- ",cr);const ni=Q?Number(Q):0,Lt=Math.max(...cr.map(pt=>Array.isArray(pt)?pt[1]:pt.y),ni)+5;if(Ot.current&&f==="Weekly"&&Ae.length>0){let pt=function(Ln){var Aa,ja;const qo=Ln.rangeSelector.buttons[0];if(St){if(!kr.length)return;Ln.series[0].setData(kr,!1),Ln.yAxis[0].update({max:Mr,plotLines:[{value:Number(Cr),dashStyle:"ShortDash",color:gi.yAxisPlotLinesStyleColor,width:2,zIndex:3}]},!1),Ln.xAxis[0].update({labels:{formatter:function(){return w1.dateFormat("%d-%b-%Y",this.value)},style:{color:gi.xAxisLabelsStyleColor}},tickPositions:tr},!1),Ln.xAxis[0].setExtremes(Ht,nr,!0,!1),qo.text.element.textContent="Today",St=!1;return}const zn=new Date,za=new Date(zn.getFullYear(),zn.getMonth(),zn.getDate()).getTime(),$o=zn.getTime();if(!St){const Yn=Ln.xAxis[0],hl=Ln.yAxis[0],fr=Ln.series[0];Ht=Yn.min??fr.options.data[0][0],nr=Yn.max??fr.options.data.slice(-1)[0][0],tr=Yn.tickPositions?[...Yn.tickPositions]:[],Mr=hl.options.max??null,Cr=((ja=(Aa=hl.options.plotLines)==null?void 0:Aa[0])==null?void 0:ja.value)??0,kr=[...fr.options.data]}Ln.series[0].setData(Nt,!1),Ln.yAxis[0].update({max:Si,plotLines:[{value:Number(ke),dashStyle:"ShortDash",color:gi.yAxisPlotLinesStyleColor,width:2,zIndex:3}]},!1),Ln.xAxis[0].update({labels:{formatter:function(){return w1.dateFormat("%H:%M",this.value)},style:{color:gi.xAxisLabelsStyleColor}},tickPositions:(pi==null?void 0:pi.map(Yn=>Yn[0]))??[]},!1),Ln.xAxis[0].setExtremes(za,$o,!0,!1),qo.text.element.textContent="Refresh",St=!0};console.debug("condition when weekly and has data"),console.debug("hourlyData -------- ",ji);let Nt=[],Si=0;if(ji&&ji.length>0){Nt=Kt(ji),console.debug("updatedHourlyData -------- ",Nt);const Ln=ke?Number(ke):0;Si=Math.max(...ji.map(zn=>Array.isArray(zn)?zn[1]:zn.y),Ln)+5,console.debug("maxLast24Latency -------- ",Si)}const pi=Ui();console.debug("hourlyTimestamps -------- ",pi);let St=!1,Ht=null,nr=null,tr=[],kr=[],Mr=null,Cr=null;const Tn=[{text:"Today",events:{click:function(){pt(ma)}}}];console.debug("weeklyData -------- ",Ae);const gs=Ae.map(([Ln,qo])=>[Zt(Ln),qo]);console.debug("updatedWeeklyData -------- ",gs);const wn=Q?Number(Q):0,qn=Math.max(...Ae.map(Ln=>Array.isArray(Ln)?Ln[1]:Ln.y),wn)+5;console.debug("weeklyMaxLatency -------- ",qn);const Ls={chart:{events:{load:function(){this.showing24hr=!1}},height:"300",zoomType:"x",backgroundColor:gi.bgColor},title:{text:null},credits:{enabled:!1},rangeSelector:{allButtonsEnabled:!0,buttonSpacing:6,inputEnabled:!1,labelStyle:{display:"none"},buttonTheme:{width:100,fill:gi.buttonThemeFillColor,r:4,padding:6,style:{color:gi.buttonThemeStyleColor,fontSize:"14px",fontWeight:"500",textOverflow:"none"},states:{hover:{fill:gi.buttonThemeStatesHoverFillColor,style:{color:gi.buttonThemeStatesHoverStyleColor}},select:{fill:gi.buttonThemeStatesSelectFillColor,style:{color:gi.buttonThemeStatesSelectStyleColor,fontWeight:"600"}}}},buttons:Tn,selected:-1},navigator:{enabled:!1},xAxis:{type:"datetime",tickPositions:gs.map(Ln=>Ln[0]),labels:{style:{color:gi.xAxisLabelsStyleColor},formatter:function(){return w1.dateFormat("%d-%b-%Y",new Date(this.value).getTime())}},useHTML:!0},yAxis:{title:{text:"Latency (ms)",style:{color:gi.yAxisTitleStyleColor}},min:0,max:qn,tickInterval:2,opposite:!1,labels:{style:{color:gi.yAxisTitleStyleColor}},plotLines:[{value:Number(Q),dashStyle:"ShortDash",color:gi.yAxisPlotLinesStyleColor,width:2,zIndex:3}]},responsive:{rules:[{condition:{maxWidth:600},chartOptions:{xAxis:{type:"datetime",tickPixelInterval:100,labels:{staggerLines:2,style:{color:gi.xAxisLabelsStyleColor},formatter:function(){return w1.dateFormat("%d-%b-%Y",new Date(this.value).getTime())}}}}}]},tooltip:{useHTML:!0,outside:!0,shadow:!1,borderWidth:0,formatter:function(){const Ln=this.point;if(!Ln||Ln.isEmpty||Ln.y===null)return`<div style="
                                background-color: black;
                                color: white;
                                padding: 8px;
                                border-radius: 6px;
                                text-align: center;
                                position: relative;
                                display: inline-block;">
                                <b>No Data</b>                               
                            </div>`;const qo=Ln.y;if(this.series.chart.showing24hr||St){const zn=new Date(Ln.x),za=zn.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(",","").replace(/\s/g,"-"),$o=zn.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1});return`<div class="today-tooltip" style="
                                background-color: black;
                                color: white;
                                padding: 8px 12px;
                                border-radius: 6px;
                                text-align: center;
                                position: relative;
                                display: inline-block;
                                box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                                ${`${za} ${$o}`} <br>
                                Latency - ${qo} ms
                            </div>`}else return`<div style="
                                background-color: black;
                                color: white;
                                padding: 8px;
                                border-radius: 6px;
                                text-align: center;
                                position: relative;
                                display: inline-block;">
                                Latency - ${qo} ms
                              
                            </div>`}},series:[{name:"Latency",type:"areaspline",data:gs,marker:{enabled:!0,radius:3},lineWidth:2,fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(128,128,128,0.35)"],[1,"rgba(128,128,128,0)"]]},color:"#0000FF"}]},ma=fN.stockChart(Ot.current,Ls);w1.setOptions({time:{useUTC:!1}}),fe(Ls);return}else if(f=="Weekly"&&Ae&&(Ae==null?void 0:Ae.length)===0){console.debug("condition when weekly and no data"),fe({chart:{height:"300",backgroundColor:gi.bgColor,zoomType:"x"},title:{text:null},navigator:{enabled:!1},rangeSelector:{enabled:!1},xAxis:{categories:Oi,labels:{style:{color:gi.xAxisLabelsStyleColor}},useHTML:!0},yAxis:{title:{text:"Latency (ms)",style:{color:gi.yAxisTitleStyleColor}},min:0,max:Lt>0?Lt:4,opposite:!1,labels:{style:{color:gi.xAxisLabelsStyleColor}},plotLines:[{color:gi.yAxisPlotLinesStyleColor,dashStyle:"ShortDash",width:2,value:Number(Q),zIndex:5}]},series:[{name:"Latency",type:"areaspline",data:cr,marker:{enabled:!0,radius:4},lineWidth:2,fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(128,128,128,0.35)"],[1,"rgba(128,128,128,0)"]]},color:"#0000FF"}],credits:{enabled:!1},legend:{enabled:!1}});return}else{console.debug("condition when not weekly"),fe({chart:{height:"300",backgroundColor:gi.bgColor,zoomType:"x"},title:{text:null,style:{color:gi.titleStyleColor}},navigator:{enabled:!1},rangeSelector:{enabled:!1},xAxis:{categories:Oi,labels:{style:{color:gi.xAxisLabelsStyleColor}},useHTML:!0},yAxis:{title:{text:"Latency (ms)",style:{color:gi.yAxisTitleStyleColor}},min:0,max:Lt>0?Lt:4,opposite:!1,labels:{style:{color:gi.xAxisLabelsStyleColor}},plotLines:[{color:gi.yAxisPlotLinesStyleColor,dashStyle:"ShortDash",width:2,value:Number(Q),zIndex:5}]},series:[{name:"Latency",type:"areaspline",data:cr,marker:{enabled:!0,radius:3},lineWidth:2,fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(128,128,128,0.35)"],[1,"rgba(128,128,128,0)"]]},color:"#0000FF"}],credits:{enabled:!1},tooltip:{useHTML:!0,outside:!0,shadow:!1,borderWidth:0,formatter:function(){var pi,St;const pt=this.point,Nt=pt.options.originalName,Si=f==="Last24Hrs"&&Nt?Nt:(pi=pt==null?void 0:pt.options)==null?void 0:pi.name;return!pt||pt.isEmpty?`<div
                                    className : "custom-tooltips"
                                    style="
                                    background-color: black;
                                    color: white;
                                    padding: 8px;
                                    border-radius: 6px;
                                    text-align: center;
                                    position: relative;
                                    display: inline-block; fill: black">
                                    <b>No Data</b>
                                    <div
                                    className : "custom-tooltips"
                                    style="
                                        position: absolute;
                                        bottom: -8px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 0;
                                        height: 0;
                                        border-left: 8px solid transparent;
                                        border-right: 8px solid transparent;
                                        border-top: 8px solid black; fill: black;">
                                    </div>
                                </div>`:`<div style="
                                className : "custom-tooltips"
                                background-color: black;
                                color: white;
                                padding: 8px;
                                border-radius: 6px;
                                text-align: center;
                                position: relative;
                                display: inline-block; fill: black;">
                                <b>${Si} </b><br> <b/> Latency - ${(St=pt==null?void 0:pt.options)==null?void 0:St.y} ms </b>
                              
                            </div>`}},legend:{enabled:!1}});return}},[s,Q,le,ke]),uu(bt,gi=>ui(gi),[d]),uu(Dt,gi=>ei(gi),[d,f]),uu(Je,gi=>Vt(gi),[d,f]),uu(dt,gi=>ur(gi),[d,f]),Ar(()=>{Je.current&&S&&AUI.$(Je.current).val(S).trigger("change.select2")},[S]),Ar(()=>{Dt.current&&L&&AUI.$(Dt.current).val(L).trigger("change.select2")},[L]);const rr=B.createElement("div",{className:"row"},n=="serviceDetails"&&B.createElement("div",{className:"col-12 mb-15"},B.createElement(B.Fragment,null,B.createElement("div",{className:"chart-header"},B.createElement("div",{className:"right-controls"},B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:bt,value:f,onChange:ui},B.createElement("option",{value:"Monthly"},Liferay.Language.get("krypton-month-chart-filter-title")),B.createElement("option",{value:"Quarterly"},Liferay.Language.get("krypton-quarter-chart-filter-title")),B.createElement("option",{value:"Weekly"},Liferay.Language.get("krypton-weekly-chart-filter-title")),B.createElement("option",{value:"Yearly"},Liferay.Language.get("krypton-year-chart-filter-title")))),f==="Quarterly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Dt,value:L,onChange:ei},Dr().quarters.map(gi=>B.createElement("option",{key:gi,value:gi,disabled:Dr().isQuarterYearDisabled(gi,G,d),style:Dr().isQuarterYearDisabled(gi,G,d)?{cursor:"not-allowed",color:"#ccc"}:{}},gi))),B.createElement("select",{className:"custom-select",ref:dt,value:G,onChange:ur},Dr().years.map(gi=>{const Oi=new Date(d).getFullYear(),cr=Dr().currentYear,ji=gi<Oi||gi>cr;return B.createElement("option",{key:gi,value:gi,disabled:ji,style:ji?{cursor:"not-allowed",color:"#ccc"}:{}},gi)}))),f==="Monthly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:Je,value:S,onChange:Vt},Dr().months.map(gi=>B.createElement("option",{key:gi,value:gi,disabled:Dr().isMonthYearDisabled(gi,G,x_(d)),style:Dr().isMonthYearDisabled(gi,G,x_(d))?{cursor:"not-allowed",color:"#ccc"}:{}},gi))),B.createElement("select",{className:"custom-select",ref:dt,value:G,onChange:ur},Dr().years.map(gi=>{const Oi=new Date(d).getFullYear(),cr=Dr().currentYear,ji=gi<Oi||gi>cr;return B.createElement("option",{key:gi,value:gi,disabled:ji,style:ji?{cursor:"not-allowed",color:"#ccc"}:{}},gi)}))),f==="Yearly"&&B.createElement("div",{className:"form-group"},B.createElement("select",{className:"custom-select",ref:dt,value:G,onChange:ur},Dr().years.map(gi=>{const Oi=new Date(d).getFullYear(),cr=Dr().currentYear,ji=gi<Oi||gi>cr;return B.createElement("option",{key:gi,value:gi,disabled:ji,style:ji?{cursor:"not-allowed",color:"#ccc"}:{}},gi)})))),B.createElement("div",{className:"right-controls-total"},Liferay.Language.get("krypton-service-detail-latency-committed-title")," : ",B.createElement("span",null," ",Q," ms "))))),B.createElement("div",{className:"col-12"},B.createElement("div",{id:"LatencyChart"},lt&&(At?B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},At):B.createElement("div",{className:"loader mt-3"})),f==="Weekly"&&Ae&&Ae.length>0?B.createElement("div",{ref:Ot}):B.createElement(_$,{highcharts:fN,constructorType:"stockChart",options:he}))));return n==="servicePerformance"?rr:B.createElement("div",{id:"Uptime",className:"capsule-item-content active mb-25 loader_wrap"},rr)};var x$={};Object.defineProperty(x$,"__esModule",{value:!0});class q1{constructor(t,n){this.styles=t||q1.DEFAULT_STYLES;const s=typeof n=="string"?n:n?n.defaultStyle:void 0;this.defaultStyle=s||q1.DEFAULT_STYLE,this.onDocumentClick=this.onDocumentClick.bind(this),this.events=typeof n!="string"&&n?n.eventListeners:void 0}getDefaultPosition(){return"top-right"}onAdd(t){this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const n of this.styles){const s=document.createElement("button");s.type="button",s.innerText=n.title,s.classList.add(n.title.replace(/[^a-z0-9-]/gi,"_")),s.dataset.uri=JSON.stringify(n.uri),s.addEventListener("click",a=>{const d=a.srcElement;if(this.closeModal(),d.classList.contains("active")||this.events&&this.events.onOpen&&this.events.onOpen(a))return;const f=JSON.parse(d.dataset.uri);this.map.setStyle(f);const i=this.mapStyleContainer.getElementsByClassName("active");for(;i[0];)i[0].classList.remove("active");d.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(a,f)}),n.title===this.defaultStyle&&s.classList.add("active"),this.mapStyleContainer.appendChild(s)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",n=>{this.events&&this.events.onSelect&&this.events.onSelect(n)||this.openModal()}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.styleButton||(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}closeModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")}openModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.closeModal()}}q1.DEFAULT_STYLE="Streets";q1.DEFAULT_STYLES=[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v10"},{title:"Light",uri:"mapbox://styles/mapbox/light-v10"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"}];var Eoe=x$.MapboxStyleSwitcherControl=q1;var mN=63710088e-1;function b$(e,t,n){if(e!==null)for(var s,a,d,f,i,S,E,L=0,F=0,G,q=e.type,Q=q==="FeatureCollection",te=q==="Feature",he=Q?e.features.length:1,fe=0;fe<he;fe++){E=Q?e.features[fe].geometry:te?e.geometry:e,G=E?E.type==="GeometryCollection":!1,i=G?E.geometries.length:1;for(var le=0;le<i;le++){var Se=0,ke=0;if(f=G?E.geometries[le]:E,f!==null){S=f.coordinates;var Ee=f.type;switch(L=n&&(Ee==="Polygon"||Ee==="MultiPolygon")?1:0,Ee){case null:break;case"Point":if(t(S,F,fe,Se,ke)===!1)return!1;F++,Se++;break;case"LineString":case"MultiPoint":for(s=0;s<S.length;s++){if(t(S[s],F,fe,Se,ke)===!1)return!1;F++,Ee==="MultiPoint"&&Se++}Ee==="LineString"&&Se++;break;case"Polygon":case"MultiLineString":for(s=0;s<S.length;s++){for(a=0;a<S[s].length-L;a++){if(t(S[s][a],F,fe,Se,ke)===!1)return!1;F++}Ee==="MultiLineString"&&Se++,Ee==="Polygon"&&ke++}Ee==="Polygon"&&Se++;break;case"MultiPolygon":for(s=0;s<S.length;s++){for(ke=0,a=0;a<S[s].length;a++){for(d=0;d<S[s][a].length-L;d++){if(t(S[s][a][d],F,fe,Se,ke)===!1)return!1;F++}ke++}Se++}break;case"GeometryCollection":for(s=0;s<f.geometries.length;s++)if(b$(f.geometries[s],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function koe(e,t){var n,s,a,d,f,i,S,E,L,F,G=0,q=e.type==="FeatureCollection",Q=e.type==="Feature",te=q?e.features.length:1;for(n=0;n<te;n++){for(i=q?e.features[n].geometry:Q?e.geometry:e,E=q?e.features[n].properties:Q?e.properties:{},L=q?e.features[n].bbox:Q?e.bbox:void 0,F=q?e.features[n].id:Q?e.id:void 0,S=i?i.type==="GeometryCollection":!1,f=S?i.geometries.length:1,a=0;a<f;a++){if(d=S?i.geometries[a]:i,d===null){if(t(null,G,E,L,F)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(d,G,E,L,F)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(t(d.geometries[s],G,E,L,F)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}G++}}function Aoe(e,t,n){var s=n;return koe(e,function(a,d,f,i,S){d===0&&n===void 0?s=a:s=t(s,a,d,f,i,S)}),s}function Moe(e){return Aoe(e,(t,n)=>t+Ioe(n),0)}function Ioe(e){let t=0,n;switch(e.type){case"Polygon":return gN(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=gN(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function gN(e){let t=0;if(e&&e.length>0){t+=Math.abs(yN(e[0]));for(let n=1;n<e.length;n++)t-=Math.abs(yN(e[n]))}return t}var Loe=mN*mN/2,FA=Math.PI/180;function yN(e){const t=e.length-1;if(t<=2)return 0;let n=0,s=0;for(;s<t;){const a=e[s],d=e[s+1===t?0:s+1],f=e[s+2>=t?(s+2)%t:s+2],i=a[0]*FA,S=d[1]*FA,E=f[0]*FA;n+=(E-i)*Math.sin(S),s++}return n*Loe}var Doe=Moe;function Poe(e,t,n={}){const s={type:"Feature"};return(n.id===0||n.id)&&(s.id=n.id),n.bbox&&(s.bbox=n.bbox),s.properties=t||{},s.geometry=e,s}function _N(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Poe({type:"LineString",coordinates:e},t,n)}const Ooe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAxCAYAAAC78KvKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAsxSURBVHgBpVhrdFNVFv5uXvTdpGmbtPTdWsG2UASE0SIBi+XhEuqILqkCOj/kx4wy4zj6Yxzhnz9cPpbicnQcqrN0wSwXykCdkToz5TFtRQotfYB9ps8kbZomaZLmnTn7lMS0JG2Z2Wvd9ubec8/e59t7f3ufI+B/EM2GysOCSDiAgFDOHwiB1kAA7zY019fiDkW4k8GajZUaAaLj7DYv0nuf36t1ux1bmlubtViiLMkAzUZNniggezsgYE+0MYGAH063M/ijlplzdCmGiBcbwFb9uhCQ1DJTyxca5/a6md7A7A+BuUYQ9ixX5wij+uHmhb4TFlC8INy7du9E8YoiJCTGo/FCM86eqYsyU0DLYuXZ5tZLDUsygOAGpMcFCJpIH5SuLsEzz+2DSp0eeuZ2uzExbsS7b76HQe0QItsR2S0hAzQajRxOyYtCQHSYPZXP/16VocL+52pQVl4Cv9/Pn83MzMDn88HlcnH4ZTIZrv7Qiq+/PA2dTn+7DYBZCOAdhsbROQZUrNNoxCKCW5QnCLM2Bf+TPPn0XlRWbYVUJgk9s9vt3IBIMmk0oedmL/5S+zmiwMHcEmBoNNYKG8srXmdmHJk/hAwoKirEK79/GYnJCXPeEQImkwmLicvpZm55n7llMIodOCJsXFMRiDbB2++/icysDDgcDni9Xg4zXXS/VCE0/vDq0ajvRarMtKgv33vrGIwTk9wACjSPx3NHyt0MgdqPP4v6XrU8HcLzzz8fME1MwTA6wZR4Ig7ct/8prN9wL2TLZFiK+Lw+/OdCE7458w9MT0/f9l4mkyK7YDkSkuJnDQi+0I+Mw2gw8cieLxmZGah+/FGsWVfO0YgkYrEYPT/24otPT7Is0EV4L0KqSok0tRJiySwHcgPSU1UYGhpCTNwyuF1u6BkaU0ZzRCV5eTl48eVf3YaGz+PHJ388jrbW6xG/i0+MQw5b9fzvxOvWrTtSUFiAbdsqcbnxGmLjZUhWJHGGs1vtDA3/nA/MZgu+/aYeHpeHjUlAwB/A5aYrePONt2DQG25TTHDn3ZUDdVY6PG4v0tNVmHH+lL4cgcyMTB6t26oq2cqtaGpuhB+zwTahm2RumYwaH9EkHG7KHJcjgB07tqO0/G588MEHoXGcWbKys1BWuhp/+6oOitQk7Kneg67OG2htvYq0DCWSUxIXdMt8SVIkYnmOmsOtG5xAxaZNrHZUISZ2GYaHh+caSi6YmjJDpx/FwwwBh8WDzpttUKYqsHnzFlxva2cTSblbUlLlsE5N3+aW+XBTajvsLoh9y/Dr372AjQ+s45xrs9ngdDrR0dExF4HS0hJIRTEcgfK1ZVi9dhsuN19B3Y2zLFXiONenKtOh149hZXkxKG0nmFucDhefRMoMTFHKuZ+9Hi8sxhk8VfMkn4uEKJuoO5JIzJNW8+XLl+XJycl49hcH0NnRhS8+/5zHwwObNuDEib9CEAGry8ugHEqBwTDOP0xJU0ScUOyLx2tHD/EgJgKjFQeLFwktJiiT4yazOF2hesNhm4EgFtDR2Y7UNCWHvr+3Hy1XWxAXH8s/ys7KQWd7F1tpCu7fWIHevp6IBqSnqFG2ZiVfdbBKBqW9vR0XLlxgqe6BfthASMaItzykOWKbdsAwNsHJwTptwZhuFCXMLUpFOrp7ekCFkUgmKZnFgVyJa1evweN1RTRgmTgOd99TNGfVRErnzp1Dd3c3Y9xxaHuHWR0KIL84BxKKVCIITseMCYmSC1fkob6+HuQWOQs+i8WC/IJ8znKdXR2oqqrCmbrTWEyIhpuamqDVamGbts/SPasPeUXZnIZ5DNAfChzyKV1Ex90dfSzqE+Fe7uEZQEJQGicnkZ+fB6vVuqBigp4inS6HfYav2mSc4rxAyoM0TMLT8MFNGvi9AsbHDZAr2aqVSQi6hfInPiGWKy1gKPg8AZZOVkyajBGVE513dXXyVYfDXXB3LuOTJIhEojnj+a9LjRfY6pNw4OB+CH4pgm7JK8qCUW/EjbYe3uu1trZiaHQAJSVlUVdvtpigG9Oj76YWE/pJvuKilfnw+1gfYRfhoa3b5oznCFTc/yB0zNqrLOq373oYaSySBweGIIuRzFYuRqtjg3qW905IpBJ0996MqNzn9fPo1rFLnpLMg4xWPGPzYXvVDtQ8+wQP6La2ttA3kiACmxhdlpSuDNHx40/8HEODQ7h06SKPDQoaomOKDzJKwVgxGB+kmOoFkRNVveLSQo6i1eRAWclq7H58J+cFYkJqasKFG0AI9Hb3weG04dHqXRge0OGf/6pHbm4uzwSXx8lXQm6hct13Q8uMGQ8ZQHnNafhWdFNBE3ljcPilF6DOSOcpOckCOJwTQgZ4vT5ze2ebnBCgD4N0TL4iOrY7bBz2fTX7cO7v38EusXE6nmHumHHMllVqx4NpZbe4UVNTw+eg9o3YMJyQwpmQdIvlcco3ZDFS9PX3MRIyo/qxPbCap1FXdxZr71vDYDXSppMrI/jycwuQkMDgtE8jNi6WX+FNRm5mASp3bOZdUxDycOXNzc2spzBzXhjoHooRpapSWJR3Y7h/lO9uTp48wfZ5TrbiGujHDBwBDhVDQSpZhv7+AWRlZXPuiCTE/URcVHzCIW9paWF15QT6GMVTQGu7h0C6JSlpcl7xKMAodVTL03D9+nUMDg5i1apVvFWjGMjOykWLroXTsVqdwQ1aihANNzQ0cFY0srTUM26hviAYqHyWYN5bpqzcOqLMvLuy2UouhibSG3SsH1AgOVHB6XUxIYXnz5/H2NhYVBom4UREqSJitlDTQQGWmp7CISK3UISTqNUq5gIpBrT9KC4ujq5Z7Odwnzp1CsNDIyG44xNm0zNcOR9ORORiBws7d+5iDaaAkeER3oJRLQinY8OEnjWTDsjlCsTHJGB4NPJ2y+l2cNiDNCySiJDPuiSi4UmDGStWrmC0bplrQFxMItqvt0KdqeK9wM2uHoilAkeEDBnVjvH9AvUMLjfLBnYYYbPbIhpAcA8PjGHabENuYdac9uzFl37JDCjmCAWFx0Aai8YtWzWhNmzXo1WcEy5evMjjI9iGjWl1sCZZZ4nnFgkFhdgwvOpRSZ/fnlEaUkyECzfAbLKE2rCtlZtR++fPOB1Ti/anjz9hPZ94Dh1T2hI6VPlIaI9gYdyRJE8MRbfJYMWa8rUhGqa0pBSdL9wAKhwVm2rQ1NjEU5DomBD4+vRXXDlJ6T2l+JF1NDkFMqhZqpIhNutso0kKg9E9bXFwGv7tq78J0fBCZwni9evXC4ynNdSGrbm3HIqkVNR/+x3ik2Kw4b6f8RMPMoJaMuqKqDc0jOtn2/RbTQzdB9kwJVGFV147zKM+SEjhO2pqy0ZGRvg9I6qj/Bjk0KFDeezHv9ltHhWfvXv34ofvr+H77xtDMD/yyCNs39cOqVSM8tX34tTXX0ZcUUq8Gk88syd0lhCU8PaMPT/PituRDz/8sGHOIRUz5CB7+ToZQixYVFiMkydOcgTIBUbTJDJUGXTWg9a2qxENUMSpsPfp3XOeUdRTe8ZigLZWRz/66KN3Qi4IH3jlypVW5pLTzAjF+Ph4OZEORTtt1+UKOWJksby4KFlrPjgUmQdipQkoWbWC3xMfnD17lq+azfFuXFxc9bFjxxrCx0c9J7zllq/YLT+grK5+DHVnvmGp5cP+A0+j9rPjiIbA9t1bQzQcDnek8Yse1Ya7JT+/EHJWC6haUnseSRITE3kpjgR3JFn0qJbcwpqVTxmErqkpk0ZvYPvDFSujuoCUR4M7ktzRaTm5heX1EXaEdyDS+8Xg/r8NCDPkIDPkIH46R9YyxbVMcS3uUP4LNxzon64hgykAAAAASUVORK5CYII=",vN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADsSURBVHgB5ZLhDcIgEIXBBWQT3cCO4AaygThB6wR1hHYDR9AJ2g06AmyAR/ouoRfa+FsveYEcx8fxQKmfDV1KxhgNDZZ0Ih1JAeq11t1XIIKcaWhJCdaTRixVAKe4rwEZUsc5HuiqVNOgpt6CeHTEuStpIg0km3eN2lpCLE45i5xHBw5zl61X2HPhhMGpjYAPYmMCTqKGDzA75JIfQdzWQByhULNf5LKrVYXTXOafVUufYp7LW/cFnwZc3QmIl3ZI2OrTws8WNQtI6UNaGhj0Ir0xP6j5tydPbvQhn5sgAUxPy6aPgHYECep/4gNc7hPI24aneQAAAABJRU5ErkJggg==",Roe=async()=>{var a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke;const e=JSON.stringify({pageSize:"500",page:"1"}),t=JSON.stringify(e),s=`/o/krypton-gis-middleware-api/v1.0/projectCodes?requestParams=${encodeURIComponent(t)}`;try{const Ee=await Go.get(s);if((f=(d=(a=Ee==null?void 0:Ee.data)==null?void 0:a.data)==null?void 0:d.items)!=null&&f.length){const Ie=(S=(i=Ee==null?void 0:Ee.data)==null?void 0:i.data)==null?void 0:S.items.filter(Ye=>Ye.projectCode!=="Vi-LM"),He=((L=(E=Ee==null?void 0:Ee.data)==null?void 0:E.data)==null?void 0:L.totalCount)||0;return He>0&&(Ee.data.data.totalCount=He-1),{data:Ie,page:((G=(F=Ee==null?void 0:Ee.data)==null?void 0:F.data)==null?void 0:G.page)||1,pageSize:((Q=(q=Ee==null?void 0:Ee.data)==null?void 0:q.data)==null?void 0:Q.pageSize)||10,lastPage:((he=(te=Ee==null?void 0:Ee.data)==null?void 0:te.data)==null?void 0:he.lastPage)||1,totalCount:(le=(fe=Ee==null?void 0:Ee.data)==null?void 0:fe.data)==null?void 0:le.totalCount,fileByteArray:(ke=(Se=Ee==null?void 0:Ee.data)==null?void 0:Se.data)==null?void 0:ke.fileByteArray}}else return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(Ee){throw console.error("Error fetching all Project Codes:",Ee),Ee}},Noe=async e=>{var d,f,i,S,E,L,F,G,q,Q,te,he,fe;const t=JSON.stringify({pageSize:"500",page:"1",userId:e}),n=JSON.stringify(t),a=`/o/krypton-gis-middleware-api/v1.0/deviceTypes?requestParams=${encodeURIComponent(n)}`;try{const le=await Go.get(a);return(i=(f=(d=le.data)==null?void 0:d.data)==null?void 0:f.deviceTypes)!=null&&i.length?{data:[...le.data.data.deviceTypes].sort((ke,Ee)=>ke.name==="Cable"?-1:Ee.name==="Cable"?1:0),page:((E=(S=le==null?void 0:le.data)==null?void 0:S.data)==null?void 0:E.page)||1,pageSize:((F=(L=le==null?void 0:le.data)==null?void 0:L.data)==null?void 0:F.pageSize)||10,lastPage:((q=(G=le==null?void 0:le.data)==null?void 0:G.data)==null?void 0:q.lastPage)||1,totalCount:(te=(Q=le==null?void 0:le.data)==null?void 0:Q.data)==null?void 0:te.totalCount,fileByteArray:(fe=(he=le==null?void 0:le.data)==null?void 0:he.data)==null?void 0:fe.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(le){throw console.error("Error fetching all elements:",le),le}},Boe=async(e,t,n)=>{var a,d,f,i,S,E,L;let s=`/o/c/cstlserviceses/?sort=externalReferenceId:asc&fields=id,externalReferenceId,isActive,sourceEndName,destinationEndName,sourceEndLatitude,sourceEndLongitude,destinationEndLatitude,destinationEndLongitude&filter=parentId eq 0 and customerAccountNo eq '${e}'&restrictFields=creator,status,actions&pageSize=500&page=1`;t&&n&&(s=`/o/c/cstlserviceses/?sort=externalReferenceId:asc&fields=id,externalReferenceId,isActive,sourceEndName,destinationEndName,sourceEndLatitude,sourceEndLongitude,destinationEndLatitude,destinationEndLongitude&filter=parentId eq 0 and customerAccountNo eq '${e}' and r_serviceDisplayId_c_cstlentitydisplaymasterId ne ${t} and r_serviceCategoryId_c_cstlentitycategorymasterId eq ${n}&restrictFields=creator,status,actions&pageSize=500&page=1`);try{const F=await Go.get(s);return(d=(a=F==null?void 0:F.data)==null?void 0:a.items)!=null&&d.length?{data:(f=F==null?void 0:F.data)==null?void 0:f.items,page:((i=F==null?void 0:F.data)==null?void 0:i.page)||1,pageSize:((S=F==null?void 0:F.data)==null?void 0:S.pageSize)||10,lastPage:((E=F==null?void 0:F.data)==null?void 0:E.lastPage)||1,totalCount:(L=F==null?void 0:F.data)==null?void 0:L.totalCount,fileByteArray:F==null?void 0:F.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(F){throw console.error("Error fetching all services:",F),F}},c2=async(e,t,n)=>{var a,d,f,i,S,E,L;let s=`/o/c/cstlserviceses/?fields=id,externalReferenceId,isActive,customerAccountNo,sourceEndName,destinationEndName,sourceEndLatitude,sourceEndLongitude,destinationEndLatitude,destinationEndLongitude&filter=externalReferenceId eq '${e}'&restrictFields=creator,status,actions`;t&&n&&(s=`/o/c/cstlserviceses/?fields=id,externalReferenceId,isActive,customerAccountNo,sourceEndName,destinationEndName,sourceEndLatitude,sourceEndLongitude,destinationEndLatitude,destinationEndLongitude&filter=externalReferenceId eq '${e}' and r_serviceDisplayId_c_cstlentitydisplaymasterId ne ${t} and r_serviceCategoryId_c_cstlentitycategorymasterId eq ${n}&restrictFields=creator,status,actions`);try{const F=await Go.get(s);return(d=(a=F==null?void 0:F.data)==null?void 0:a.items)!=null&&d.length?{data:(f=F==null?void 0:F.data)==null?void 0:f.items,page:((i=F==null?void 0:F.data)==null?void 0:i.page)||1,pageSize:((S=F==null?void 0:F.data)==null?void 0:S.pageSize)||10,lastPage:((E=F==null?void 0:F.data)==null?void 0:E.lastPage)||1,totalCount:(L=F==null?void 0:F.data)==null?void 0:L.totalCount,fileByteArray:F==null?void 0:F.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(F){throw console.error("Error fetching all services:",F),F}},Foe=async e=>{var n,s,a,d,f;const t="/o/c/cstlcustomerses/?nestedFields=serviceCustomerAccountNo&fields=id,customerAccountNo,customerName,isOnboarded,isActive,serviceCustomerAccountNo.externalReferenceId&sort=customerName:asc&restrictFields=actions, status, creator, serviceCustomerAccountNo.status, serviceCustomerAccountNo.creator, serviceCustomerAccountNo.actions&pageSize=500&page=1";try{const i=await Go.get(t);let S=((n=i==null?void 0:i.data)==null?void 0:n.items)||[];return S=S.filter(E=>Array.isArray(E.serviceCustomerAccountNo)&&E.serviceCustomerAccountNo.length>0),S.length?{data:S,page:((s=i==null?void 0:i.data)==null?void 0:s.page)||1,pageSize:((a=i==null?void 0:i.data)==null?void 0:a.pageSize)||10,lastPage:((d=i==null?void 0:i.data)==null?void 0:d.lastPage)||1,totalCount:(f=i==null?void 0:i.data)==null?void 0:f.totalCount,fileByteArray:i==null?void 0:i.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(i){throw console.error("Error fetching all services:",i),i}},zoe=async e=>{var n,s,a,d,f,i,S;const t=`/o/c/cstlcustomerses/?fields=id,customerAccountNo,customerName,isOnboarded,isActive&restrictFields=creator,status,actions&sort=customerName:asc&filter=customerAccountNo eq '${e}'`;try{const E=await Go.get(t);return(s=(n=E==null?void 0:E.data)==null?void 0:n.items)!=null&&s.length?{data:(a=E==null?void 0:E.data)==null?void 0:a.items,page:((d=E==null?void 0:E.data)==null?void 0:d.page)||1,pageSize:((f=E==null?void 0:E.data)==null?void 0:f.pageSize)||10,lastPage:((i=E==null?void 0:E.data)==null?void 0:i.lastPage)||1,totalCount:(S=E==null?void 0:E.data)==null?void 0:S.totalCount,fileByteArray:E==null?void 0:E.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(E){throw console.error("Error fetching all services:",E),E}},Uoe=async e=>{var t;try{const n="/o/krypton-gis-api/v1.0/competitor-geojson",s=await Go.post(n,e,{headers:{"Content-Type":"multipart/form-data"}});return(t=s==null?void 0:s.data)!=null&&t.errorMessage?{error:s.data.errorMessage}:{data:(s==null?void 0:s.data)||[]}}catch(n){return console.error("Error Uploading KMZ:",n),{error:"Failed to Upload KMZ. Please try again later."}}},$oe=async e=>{var n,s,a,d,f,i,S;const t=`/o/c/cstlgisexternalkmzes/?filter=contains(employeeUserIds,'${e}')&
nestedFields=competitorKMZId&
restrictFields=status,creator,actions,competitorKMZId.status,competitorKMZId.creator&sort=competitor:asc&pageSize=500&page=1`;try{const E=await Go.get(t);return(s=(n=E==null?void 0:E.data)==null?void 0:n.items)!=null&&s.length?{data:(a=E==null?void 0:E.data)==null?void 0:a.items,page:((d=E==null?void 0:E.data)==null?void 0:d.page)||1,pageSize:((f=E==null?void 0:E.data)==null?void 0:f.pageSize)||10,lastPage:((i=E==null?void 0:E.data)==null?void 0:i.lastPage)||1,totalCount:(S=E==null?void 0:E.data)==null?void 0:S.totalCount,fileByteArray:E==null?void 0:E.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(E){throw console.error("Error fetching all kmz:",E),E}},Voe=async()=>{var t,n,s,a,d,f,i;const e="/o/krypton-common-api/v1.0/employee-users";try{const S=await Go.get(e);return(n=(t=S==null?void 0:S.data)==null?void 0:t.items)!=null&&n.length?{data:(s=S==null?void 0:S.data)==null?void 0:s.items,page:((a=S==null?void 0:S.data)==null?void 0:a.page)||1,pageSize:((d=S==null?void 0:S.data)==null?void 0:d.pageSize)||10,lastPage:((f=S==null?void 0:S.data)==null?void 0:f.lastPage)||1,totalCount:(i=S==null?void 0:S.data)==null?void 0:i.totalCount,fileByteArray:S==null?void 0:S.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(S){throw console.error("Error fetching all employee:",S),S}},Woe=async e=>{try{const t=await Go.get(e);if(console.log("KMZ Response Data:",t),t)return t.data||null}catch(t){return console.error("Error fetching all kmz:",t),null}},joe=async e=>{try{const t=await Go.get(e,{responseType:"arraybuffer"});if(console.log("KMZ Response Data:",t),t)return t.data||null}catch(t){return console.error("Error fetching all kmz:",t),null}},zA=async(e,t=1,n=5e3,s,a,d)=>{const f={pageNumber:t,pageSize:n,projectCodeIds:e||[],geometryType:s,deviceTypeIds:a||[],deviceTypeAttrIds:d||[]},i=(s=="Point"||s=="","/o/krypton-gis-middleware-api/v1.0/gis-network");try{const S=await Go.post(i,f,{headers:{"Content-Type":"application/json","Content-Encoding":"gzip"}});let E={};return s=="Point"||s==""?E={data:S.data.data.items,totalCount:S.data.data.totalCount}:S.data&&(E={data:S.data.data.items,totalCount:S.data.data.totalCount}),E}catch(S){throw console.error("Error fetching filtered network data:",S),S}},pS=async(e,t,n)=>{const s="/o/krypton-gis-middleware-api/v1.0/service-network";let d=1,f=[],i=[];try{const S={customerAccountNumbers:t||[],pageNumber:d,pageSize:5e3,serviceIds:e||[]};return(await Go.post(s,S,{headers:{"Content-Type":"application/json"}})).data.data.items.forEach(L=>{if(L.data){let F=L.sid,G=atob(L.data),q=JSON.parse(G);q=q.map(Q=>({...Q,sid:F})),f=f.concat(q),i.push({serviceId:L.serviceId,sourceEndName:L.sourceEndName,destinationEndName:L.destinationEndName,sourceEndLatitude:L.sourceEndLatitude,sourceEndLongitude:L.sourceEndLongitude,destinationEndLatitude:L.destinationEndLatitude,destinationEndLongitude:L.destinationEndLongitude})}}),{data:f,dataFetchedMarker:i,totalCount:f.length||0}}catch(S){throw console.error("Error fetching filtered network data:",S),S}},Hoe=async(e,t)=>{var a;const n="/o/krypton-gis-api/v1.0/share-kmz",s={kmzId:e,userIds:t};try{const d=await Go.post(n,s,{headers:{"Content-Type":"application/json"}});return(a=d==null?void 0:d.data)!=null&&a.error?{error:d.data.error}:{data:(d==null?void 0:d.data)||{}}}catch(d){return console.error("Error Uploading KMZ:",d),{error:"Failed to Share KMZ. Please try again later."}}},Goe=async(e,t)=>{var s,a,d,f,i,S,E;const n=`/o/krypton-gis-middleware-api/v1.0/service-topology?serviceId=${e}&customerAccountNo=${t}`;try{const L=await Go.get(n);return(s=L==null?void 0:L.data)!=null&&s.data?{data:((a=L==null?void 0:L.data)==null?void 0:a.data)||[],page:((d=L==null?void 0:L.data)==null?void 0:d.data.page)||1,pageSize:((f=L==null?void 0:L.data)==null?void 0:f.data.pageSize)||10,lastPage:((i=L==null?void 0:L.data)==null?void 0:i.data.lastPage)||1,totalCount:(S=L==null?void 0:L.data)==null?void 0:S.data.totalCount,fileByteArray:(E=L==null?void 0:L.data)==null?void 0:E.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(L){throw console.error("Error fetching all topology:",L),L}},qoe=async()=>{var t,n,s,a,d,f,i;const e="/o/c/cstlgiscategorymasters/?restrictFields=status,creator,actions&sort=category:asc";try{const S=await Go.get(e);return(n=(t=S==null?void 0:S.data)==null?void 0:t.items)!=null&&n.length?{data:(s=S==null?void 0:S.data)==null?void 0:s.items,page:((a=S==null?void 0:S.data)==null?void 0:a.page)||1,pageSize:((d=S==null?void 0:S.data)==null?void 0:d.pageSize)||10,lastPage:((f=S==null?void 0:S.data)==null?void 0:f.lastPage)||1,totalCount:(i=S==null?void 0:S.data)==null?void 0:i.totalCount,fileByteArray:S==null?void 0:S.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(S){throw console.error("Error fetching all Category:",S),S}},Yoe=async e=>{var t,n,s,a,d,f,i;try{const S=await Go.get(e);return(n=(t=S==null?void 0:S.data)==null?void 0:t.items)!=null&&n.length?{data:(s=S==null?void 0:S.data)==null?void 0:s.items,page:((a=S==null?void 0:S.data)==null?void 0:a.page)||1,pageSize:((d=S==null?void 0:S.data)==null?void 0:d.pageSize)||10,lastPage:((f=S==null?void 0:S.data)==null?void 0:f.lastPage)||1,totalCount:(i=S==null?void 0:S.data)==null?void 0:i.totalCount,fileByteArray:S==null?void 0:S.data.fileByteArray}:{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}catch(S){throw console.error("Error fetching all ticket entities:",S),S}},Xoe=async()=>{var S,E,L;let t=1;const n=JSON.stringify({pageSize:500,page:t,attributeName:"dc_name"}),s=JSON.stringify(n),d=`/o/krypton-gis-middleware-api/v1.0/attribute-data?requestParams=${encodeURIComponent(s)}`;let f=[],i=0;try{do{const F=await Go.get(d);if(!((L=(E=(S=F==null?void 0:F.data)==null?void 0:S.data)==null?void 0:E.items)!=null&&L.length))break;f=f.concat(F.data.data.items),i=F.data.data.totalCount||0,t++}while(f.length<i);return{data:f,page:1,pageSize:f.length,lastPage:Math.ceil(i/500),totalCount:i}}catch(F){throw console.error("Error fetching filtered datacenter data:",F),F}},UA=async(e,t)=>{var s;const n=`/o/krypton-gis-middleware-api/v1.0/network-elements/${e}/${t}`;try{const a=await Go.get(n);return(s=a==null?void 0:a.data)!=null&&s.data?{data:a.data.data}:{data:""}}catch(a){if(typeof a=="object"&&a!==null&&"status"in a&&a.status===404)return{data:""};throw a}},gI=(e,t)=>t.some(n=>e instanceof n);let xN,bN;function Zoe(){return xN||(xN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Koe(){return bN||(bN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yI=new WeakMap,$A=new WeakMap,gk=new WeakMap;function Qoe(e){const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("success",d),e.removeEventListener("error",f)},d=()=>{n(sb(e.result)),a()},f=()=>{s(e.error),a()};e.addEventListener("success",d),e.addEventListener("error",f)});return gk.set(t,e),t}function Joe(e){if(yI.has(e))return;const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("complete",d),e.removeEventListener("error",f),e.removeEventListener("abort",f)},d=()=>{n(),a()},f=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",d),e.addEventListener("error",f),e.addEventListener("abort",f)});yI.set(e,t)}let _I={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return yI.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return sb(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function w$(e){_I=e(_I)}function eae(e){return Koe().includes(e)?function(...t){return e.apply(vI(this),t),sb(this.request)}:function(...t){return sb(e.apply(vI(this),t))}}function tae(e){return typeof e=="function"?eae(e):(e instanceof IDBTransaction&&Joe(e),gI(e,Zoe())?new Proxy(e,_I):e)}function sb(e){if(e instanceof IDBRequest)return Qoe(e);if($A.has(e))return $A.get(e);const t=tae(e);return t!==e&&($A.set(e,t),gk.set(t,e)),t}const vI=e=>gk.get(e);function iae(e,t,{blocked:n,upgrade:s,blocking:a,terminated:d}={}){const f=indexedDB.open(e,t),i=sb(f);return s&&f.addEventListener("upgradeneeded",S=>{s(sb(f.result),S.oldVersion,S.newVersion,sb(f.transaction),S)}),n&&f.addEventListener("blocked",S=>n(S.oldVersion,S.newVersion,S)),i.then(S=>{d&&S.addEventListener("close",()=>d()),a&&S.addEventListener("versionchange",E=>a(E.oldVersion,E.newVersion,E))}).catch(()=>{}),i}const rae=["get","getKey","getAll","getAllKeys","count"],nae=["put","add","delete","clear"],VA=new Map;function wN(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(VA.get(t))return VA.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,a=nae.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||rae.includes(n)))return;const d=async function(f,...i){const S=this.transaction(f,a?"readwrite":"readonly");let E=S.store;return s&&(E=E.index(i.shift())),(await Promise.all([E[n](...i),a&&S.done]))[0]};return VA.set(t,d),d}w$(e=>({...e,get:(t,n,s)=>wN(t,n)||e.get(t,n,s),has:(t,n)=>!!wN(t,n)||e.has(t,n)}));const sae=["continue","continuePrimaryKey","advance"],SN={},xI=new WeakMap,S$=new WeakMap,oae={get(e,t){if(!sae.includes(t))return e[t];let n=SN[t];return n||(n=SN[t]=function(...s){xI.set(this,S$.get(this)[t](...s))}),n}};async function*aae(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,oae);for(S$.set(n,t),gk.set(n,vI(t));t;)yield n,t=await(xI.get(n)||t.continue()),xI.delete(n)}function TN(e,t){return t===Symbol.asyncIterator&&gI(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&gI(e,[IDBIndex,IDBObjectStore])}w$(e=>({...e,get(t,n,s){return TN(t,n)?aae:e.get(t,n,s)},has(t,n){return TN(t,n)||e.has(t,n)}}));async function lae(){try{return await iae("GeoJSONDB",1,{upgrade(t){t.objectStoreNames.contains("geojsonStore")||t.createObjectStore("geojsonStore",{keyPath:"id"})}})}catch(e){throw new Error(`Failed to open database: ${e.message}`)}}async function cae(e){await(await lae()).delete("geojsonStore",e)}function hae(e,t={}){if(e.bbox!=null&&t.recompute!==!0)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return b$(e,s=>{n[0]>s[0]&&(n[0]=s[0]),n[1]>s[1]&&(n[1]=s[1]),n[2]<s[0]&&(n[2]=s[0]),n[3]<s[1]&&(n[3]=s[1])}),n}var uae=hae;const BC=new Set,fS=new Set,WA=new Set,jA=new Set;let p1=!0,Oh=null,bh=null,md=null,f1=!1,HA=!1,GA=!1;const dae=$3(({redirectFrom:e,customerAccountNo:t,productName:n,customerIds:s,projectCodes:a,selectedElement:d,selectedKmzValue:f,kmzList:i,selectedProjectCodes:S,customerSpecificServiceLayer:E,kmzColorPattern:L,kmzIdVal:F,setResizeConatiner:G,elementIds:q,projectCodeColorPattern:Q,projectCodeIdVal:te,constlDefaultColor:he,serviceCodeColorPattern:fe,serviceIdVal:le,customerServiceResponse:Se,userType:ke,selectedElementToggle:Ee,selectedDataCenter:Ie,setHasMoreDatacenter:He,hasMoreDatacenter:Ye,serviceIdValRef:lt,unCheckedServiceIds:Pt,resizeConatiner:At,checkedServiceIdsByCustomer:ht,stopApiCallEmp:Ot,servicePathSelection:Ae,viewCablePermission:mt,invalidId:bt,networkServiceValue:Dt},Je)=>{const dt=wo(),ui=wo(null),Vt=wo(),ei=wo(),ur=wo(),Zt=wo(),Kt=wo(),Ui=wo(),rr=wo(!1),gi=wo([]),Oi=wo(!1),cr=wo(!1);wo(null);const ji=wo([]);wo({});const nn=wo(S),[pr,Ue]=It([]),[ni,fi]=It(!1),[Lt,pt]=It({Overhead_Own:0,"Overhead_Third Party":0,Underground_Own:0,"Underground_Third Party":0,Total:0}),[Nt,Si]=It([]),[pi,St]=It(null),[Ht,nr]=It(null),[tr,kr]=It(1),[Mr,Cr]=It(1),[Tn,gs]=It(""),[wn]=It(5e3),[bs,qn]=It(!0),[Ls,ma]=It(!0),[Ln,qo]=It(!0),[zn,za]=It(!0),[$o,Aa]=It(!0),[ja,Yn]=It(!0),[hl,fr]=It([]),[tc,Sh]=It(!1),[bl,Un]=It(!1),[vi,Ge]=It(!1),[Fe,rt]=It([]),[xt,ft]=It([]),[Jt,xi]=It(1),[ti,ai]=It(!1);let Yi="#4CAF50",Fi=4,Pr=4,ln=Liferay.ThemeDisplay.getPortalURL()+"/documents/d/internal/india-composite",Qr=Liferay.ThemeDisplay.getPortalURL()+"/documents/d/internal/india_states";const[Or,ii]=It(),[xr,Xr]=It(0),[tn,Jn]=It(0),[ds,mi]=It([]),[_r,zi]=It([]),[zr,Yr]=It(),[yr,Hr]=It([]),[rn,is]=It({}),[Ps,vs]=It([]);It([]),It(!1);const[ra,Po]=It(""),[Sc,Xl]=It(!1),[lh,ps]=It(!1),[la,$u]=It(!1);It(!1);const[_u,ch]=It(!1),[Lc,zc]=It(0),ul="mapbox://styles/abhishek-map/"+(document.querySelector(".theme-dark"),"cmc8pcx2g02ys01sc1430grsn"),Uc="mapbox://styles/abhishek-map/cmf7cvle0000i01s310j18rki",du="pk.eyJ1IjoiYWJoaXNoZWstbWFwIiwiYSI6ImNtNmtrYWFncTA1ZjQycnB5aDAxam15b2gifQ.79bJZcwtpZweeqePPBGU-w",[Yc,Ds]=It(ul);It(!1);let Cs=Liferay.ThemeDisplay.getLayoutRelativeURL().replace(/\/[^/]+$/,"");const to="constl-line-layer",Xs="constl-line-source";let Bs=[];const ba=q.find(vt=>vt.name&&vt.name.toLowerCase()==="cable"),ca=ba&&d.includes(ba.id);if(t&&Array.isArray(Se)){const vt=Se.find(Yt=>Yt.customerId===t);Bs=vt?vt.services:[]}Ar(()=>{yr.length===xr&&xr>0&&(ps(!0),$c(yr))},[d,yr,xr]),Ar(()=>{ds.length==tn&&ds.length>0&&vn()},[ds,tn]),Ar(()=>{const vt=Array.isArray(d)?d:[];let Yt=[];vt.forEach(Di=>{const yi=rn==null?void 0:rn[Di];Array.isArray(yi)&&(Yt=Yt.concat(yi))}),ic(Yt)},[rn,_r]);const fh=()=>{var Yt,Di,yi,bi,Li,Tr,Bi,Gt;const vt=document.querySelector(".map-container");document.fullscreenElement?(G(!0),(Li=document.exitFullscreen)==null||Li.call(document),(Tr=document.webkitExitFullscreen)==null||Tr.call(document),(Bi=document.mozCancelFullScreen)==null||Bi.call(document),(Gt=document.msExitFullscreen)==null||Gt.call(document)):(G(!1),(Yt=vt.requestFullscreen)==null||Yt.call(vt),(Di=vt.webkitRequestFullscreen)==null||Di.call(vt),(yi=vt.mozRequestFullScreen)==null||yi.call(vt),(bi=vt.msRequestFullscreen)==null||bi.call(vt))},Il=vt=>new URLSearchParams(window.location.search).get(vt),Dp=async vt=>{if(!vt)return null;const Yt=new Uint8Array(vt),Di=await yO.loadAsync(Yt),yi=Object.values(Di.files).find(bi=>bi.name.toLowerCase().endsWith(".kml"));return yi?await yi.async("text"):null},Th=async(vt,Yt)=>{if(Yt&&Yt.toLowerCase().endsWith(".kml")){const Di=await Woe(vt);if(Di&&typeof Di=="string"&&Di.trim().startsWith("<?xml")){const bi=new DOMParser().parseFromString(Di,"application/xml");return AO(bi)}}if(Yt&&Yt.toLowerCase().endsWith(".kmz")){const Di=await joe(vt);if(Di instanceof ArrayBuffer&&Di.byteLength>0){const yi=await Dp(Di);if(yi&&typeof yi=="string"&&yi.trim().startsWith("<?xml")){const Li=new DOMParser().parseFromString(yi,"application/xml");return AO(Li)}return null}}return null},Vs=async()=>{var yi,bi;const vt=Il("id")||Il("entityDetailId"),Yt=[`${vt}`];rt([`${vt}`]);const Di=[];await c2(vt,bt,Dt).then(Li=>{Li&&Li.data&&Li.data.length>0&&Dl(Li.data)});try{Oh&&Oh.remove();const Li=Yt.filter(Bi=>Bi.includes("DFC"));if(Yt.filter(Bi=>Bi.includes("PLC")).length>0){const Bi=await pS(Yt,Di,"LineString");((yi=Bi==null?void 0:Bi.data)==null?void 0:yi.statusCode)==="500"?(Po((Bi==null?void 0:Bi.error)||"Failed to retrieve customer service topology data"),ps(!1)):(vs((Bi==null?void 0:Bi.data)||[]),up(Bi==null?void 0:Bi.data),ps(!1))}if(Li.length>0)try{const Bi=await yA(Li);if(((bi=Bi==null?void 0:Bi.data)==null?void 0:bi.length)>0){const qr=(await Promise.all(Bi==null?void 0:Bi.data.map(async sr=>{try{const Qi=await Th(sr==null?void 0:sr.fileURL,sr==null?void 0:sr.fileName);return{serviceId:sr.serviceId,darkFiberJson:Qi}}catch(Qi){return console.error("Error parsing KMZ for serviceId:",sr.serviceId,Qi),null}}))).filter(Boolean);pu(qr,!0),Si(qr),ai(!0),setTimeout(()=>{ps(!1)},1e3)}else Si([]),ai(!0),setTimeout(()=>{ps(!1)},1e3),Po("Unable to fetch KMZ file.")}catch(Bi){console.error("Error fetching dark fiber KMZs:",Bi)}}catch{ps(!1)}},pu=async(vt,Yt=!1)=>{try{const Di=dt.current;if(!Di)return;for(;!Di.isStyleLoaded();)await new Promise(yi=>setTimeout(yi,100));await Ma(),await Cc(),vt&&vt.length>0&&vt.forEach(async yi=>{var Tr;const bi=yi==null?void 0:yi.serviceId,Li=(Tr=yi==null?void 0:yi.darkFiberJson)==null?void 0:Tr.features.filter(Bi=>Bi.geometry.type==="LineString");Li&&Li.length>0&&(await ao(Li,`line-${bi}`,`${bi}`),Yt&&setTimeout(()=>{Ha()},500))})}catch(Di){console.error("Error loading routes:",Di)}},vu=async()=>{var vt,Yt,Di;if(e==="dashboard"){let yi=[],bi=[],Li;if(Array.isArray(s)&&Array.isArray(E.customer_customerListNetwork)&&s.length>0&&E.customer_customerListNetwork.length===s.length?bi=E.customer_customerListNetwork:(bi=E.customer_customerListNetwork||[],yi=Object.entries(E).filter(([Tr,Bi])=>Tr.startsWith("service_")&&Bi===!0).map(([Tr])=>Tr.replace("service_","")),rt([...yi])),yi.length!=ht.length&&ke=="customer"&&(yi=[...ht]),yi.length===0&&bi.length===0){Oh&&Oh.remove(),Si([]),vs([]),ai(!0),fr([]),ji.current=[],ke=="customer"&&Fh(),setTimeout(()=>{$o||ps(!1)},1e3);return}try{if(Oh&&Oh.remove(),ke=="customer"){if(yi.length>0){const Tr=yi.filter(qr=>qr.includes("DFC")),Bi=yi.filter(qr=>qr.includes("PLC")),Gt=Bs.filter(qr=>yi.includes(qr.externalReferenceId));if(await Dl(Gt),fr(Gt),Tr.length>0){ps(!0);const qr=ji.current;if(!(qr.length==Tr.length&&qr.every((Qi,sn)=>Qi==Tr[sn]))){ji.current=[...Tr];try{const Qi=await yA(Tr);if(((vt=Qi==null?void 0:Qi.data)==null?void 0:vt.length)>0){const hi=(await Promise.all(Qi==null?void 0:Qi.data.map(async Pn=>{try{const as=await Th(Pn==null?void 0:Pn.fileURL,Pn==null?void 0:Pn.fileName);return{serviceId:Pn.serviceId,darkFiberJson:as}}catch(as){return console.error("Error parsing KMZ for serviceId:",Pn.serviceId,as),null}}))).filter(Boolean);pu(hi,!0),Si(hi),ai(!0),setTimeout(()=>{ps(!1)},1e3)}else Po("Unable to fetch KMZ file."),Si([]),ai(!0),setTimeout(()=>{ps(!1)},1e3)}catch(Qi){console.error("Error fetching dark fiber KMZs:",Qi)}}}else ji.current.length>0&&(await Ma(),await Cc(),Si([]),ai(!0),ji.current=[],setTimeout(()=>{ps(!1)},1e3));Bi.length>0&&(Li=await pS(Bi,[],"LineString"),console.log("servicesTopologyResp--841--->",Li))}if(yi.length==0){yi=Object.entries(E).filter(([Gt,qr])=>Gt.startsWith("service_")&&qr===!0).map(([Gt])=>Gt.replace("service_",""));const Tr=yi.filter(Gt=>Gt.includes("DFC")),Bi=yi.filter(Gt=>Gt.includes("PLC"));if(yi.length>0){const Gt=Bs.filter(qr=>yi.includes(qr.externalReferenceId));await Dl(Gt),fr(Gt)}if(Tr.length==0&&Bi.length==0&&bi.length>0&&(Li=await pS([],bi,"LineString")),Tr.length>0){ps(!0);const Gt=ji.current;if(!(Gt.length===Tr.length&&Gt.every((sr,Qi)=>sr===Tr[Qi]))){ji.current=[...Tr];try{const sr=await yA(Tr);if(((Yt=sr==null?void 0:sr.data)==null?void 0:Yt.length)>0){const sn=(await Promise.all(sr==null?void 0:sr.data.map(async hi=>{try{const Pn=await Th(hi==null?void 0:hi.fileURL,hi==null?void 0:hi.fileName);return{serviceId:hi.serviceId,darkFiberJson:Pn}}catch(Pn){return console.error("Error parsing KMZ for serviceId:",hi.serviceId,Pn),null}}))).filter(Boolean);pu(sn,!0),Si(sn),ai(!0),setTimeout(()=>{ps(!1)},1e3)}else Si([]),ai(!0),Po("Unable to fetch KMZ file."),setTimeout(()=>{ps(!1)},1e3)}catch(sr){console.error("Error fetching dark fiber KMZs:",sr)}}}else ji.current.length>0&&(await Ma(),await Cc(),Si([]),ai(!0),ji.current=[],setTimeout(()=>{ps(!1)},1e3));Bi.length>0&&(Li=await pS(Bi,[],"LineString"))}}else{let Tr;if(Se?Tr=bi.filter(Bi=>{const Gt=Se.find(qr=>qr.customerId===Bi);return!Gt||!Array.isArray(Gt.services)?!0:!Gt.services.some(qr=>yi.includes(qr.externalReferenceId))}):Tr=[...bi],!Ot){ps(!1);return}Li=await pS(yi,Tr,"LineString")}((Di=Li==null?void 0:Li.data)==null?void 0:Di.statusCode)==="500"?(Po((Li==null?void 0:Li.error)||"Failed to retrieve customer service topology data"),ps(!1)):(vs((Li==null?void 0:Li.data)||[]),ke=="employee"&&(Dl((Li==null?void 0:Li.dataFetchedMarker)||[]),fr((Li==null?void 0:Li.dataFetchedMarker)||[])),ps(!1))}catch{ps(!1)}}},Qh=async vt=>{var Yt;try{let Di;GA?Di=d:Di=Ee.isSelected?[Ee.option]:[];const yi=await zA(S,vt,wn,"Point",Di);if(console.log("markerCodesTopologyResp :: ",yi),((Yt=yi==null?void 0:yi.data)==null?void 0:Yt.length)>0&&(d&&d.length>0&&Ee.isSelected&&zi(bi=>[...bi.filter(Tr=>!Tr.hasOwnProperty(Ee.option)),{[Ee.option]:yi.totalCount}]),is(bi=>{const Li=Ee.option,Bi=[...bi[Li]||[],...yi.data],Gt=[],qr=new Set;for(const sr of Bi)qr.has(sr.id)||(Gt.push(sr),qr.add(sr.id));return{...bi,[Li]:Gt}}),(yi==null?void 0:yi.totalCount)==0&&(Yn(!1),setTimeout(()=>{ps(!1)},2e3)),(yi==null?void 0:yi.totalCount)<wn*vt?(Yn(!1),setTimeout(()=>{ps(!1)},3e3)):(Yn(!0),Cr(Number(vt)+1))),(yi==null?void 0:yi.totalCount)==0){const bi=ba&&d.includes(ba.id);d&&d.length==1&&bi?(Yn(!1),$o||setTimeout(()=>{ps(!1)},3e3)):(Yn(!1),setTimeout(()=>{ps(!1)},3e3))}}catch{}},Vf=async vt=>{var Yt;try{ps(!0);const Di=await zA([],vt,wn,"",[],Ie);((Yt=Di==null?void 0:Di.data)==null?void 0:Yt.length)>0?(Jn(Di.totalCount),mi(yi=>[...yi,...Di.data]),(Di==null?void 0:Di.totalCount)<wn*vt?(He(!1),setTimeout(async()=>{ps(!1)},1e3)):xi(yi=>yi+1)):(qa(),Jn(0),mi([]),He(!1),setTimeout(async()=>{ps(!1)},1e3))}catch{qa(),Jn(0),mi([]),He(!1),setTimeout(async()=>{ps(!1)},1e3)}},Tc=async()=>{var vt;if(e==="dashboard"&&S&&Array.isArray(S)&&S.length>0)try{const Yt=await zA(S,tr,wn,"LineString");console.log("projectCodesTopologyResp :: ",Yt),((vt=Yt==null?void 0:Yt.data)==null?void 0:vt.length)>0&&(Xr(Yt.totalCount),Hr(Di=>[...Di,...Yt.data]),(Yt==null?void 0:Yt.totalCount)<wn*tr?(Aa(!1),setTimeout(async()=>{ps(!1)},1e3)):kr(Di=>Di+1)),(Yt==null?void 0:Yt.totalCount)==0&&(Aa(!1),setTimeout(async()=>{ps(!1)},1e3))}catch{yr.length==0&&(p1=!0),ps(!1)}};Ar(()=>{$o&&tr>1&&Tc()},[tr]);const hp=async()=>{if(e==="dashboard")if(f&&Array.isArray(f)&&f.length>0){const vt=i.filter(Yt=>f.includes(Yt.id)).reduce((Yt,Di)=>(Yt.some(yi=>yi.id==Di.id)||Yt.push(Di),Yt),[]);Ue(vt)}else Ue([])};function mh(vt){const Yt=dt.current;if(!Yt)return;const Di=Yt.getStyle().sources||{},yi=Object.keys(Di).filter(bi=>bi.includes("constl-marker-source"));yi.length&&yi.forEach(bi=>{const Li=Yt.getSource(bi);if(!Li||!Li._data||!Array.isArray(Li._data.features))return;const Tr=`marker-${vt}-`,Bi=Li._data.features.filter(Gt=>!Gt.id.includes(Tr));Li.setData({type:"FeatureCollection",features:Bi})})}function qa(){const vt=dt.current;vt&&(vt.getLayer("data-center-marker-layer")&&vt.removeLayer("data-center-marker-layer"),vt.getSource("data-center-marker-source")&&vt.removeSource("data-center-marker-source"))}const Ka=async()=>{if(za(!0),qo(!0),ma(!0),qn(!0),gs(""),ui.current&&window.$&&window.$(ui.current).data("select2")&&window.$(ui.current).val("").trigger("change"),S.length===0&&ps(!1),!Ee.isSelected){q.filter(Yt=>{var Di;return!(Yt.id===Ee.option&&((Di=Yt.name)==null?void 0:Di.toLowerCase())==="pop")}).length&&md&&(md.remove(),md=null),mh(Ee.option),delete rn[Ee.option];return}d&&d.length>0&&ke!="customer"&&(Yn(!0),Qh(1))};Ar(()=>{e==="dashboard"&&(f&&Array.isArray(f)&&f.length>0&&(ps(!0),setTimeout(()=>{ps(!1)},2e3)),hp().then(async()=>{const vt=dt.current;for(;vt&&!vt.isStyleLoaded();)await new Promise(Yt=>setTimeout(Yt,100));await Ha()}))},[e,f]),Ar(()=>{e==="dashboard"&&(!Pt&&ke==="customer"&&!cr.current&&ht.length>0&&(cr.current=!0,ps(!0),vu().then(async()=>{const vt=dt.current;for(;vt&&!vt.isStyleLoaded();)await new Promise(Yt=>setTimeout(Yt,100));await Ha()})),ke==="employee"&&(ps(!0),vu().then(async()=>{const vt=dt.current;for(;vt&&!vt.isStyleLoaded();)await new Promise(Yt=>setTimeout(Yt,100));await Ha()}))),e=="service details"&&(ps(!0),Vs())},[e,E]),Ar(()=>{Oh&&Oh.remove();const vt=Bs.some(Yt=>typeof Yt.externalReferenceId=="string"&&Yt.externalReferenceId.includes("DFC"));if(e==="dashboard"&&ke==="customer"&&cr.current&&Ps&&Ps.length>0&&!vt){if(ps(!0),Bs){const Yt=Bs.filter(Di=>ht.includes(Di.externalReferenceId));Dl(Yt),fr(Yt)}Zl(),setTimeout(async()=>{await Ha()},500)}e==="dashboard"&&ke==="customer"&&cr.current&&vt&&vu().then(async()=>{const Yt=dt.current;for(;Yt&&!Yt.isStyleLoaded();)await new Promise(Di=>setTimeout(Di,100));await Ha()})},[ht]),Ar(()=>{Ae&&typeof Ae=="object"&&Object.keys(Ae).length>0&&Zl()},[JSON.stringify(Ae)]),Ar(()=>{GA=!1,Ka()},[d]);const zd=()=>{const vt=document.querySelector(".mapboxgl-style-list button.active");let Yt;vt&&(Yt=vt.textContent.trim()),Yt==="Default"?(["state-boundaries","india-border-shadow-inner","india-border-shadow-outer"].forEach(Di=>{dt.current.getLayer(Di)&&dt.current.removeLayer(Di)}),dt.current.getSource("india-geojson")&&dt.current.removeSource("india-geojson"),dt.current.getSource("india-states")&&dt.current.removeSource("india-states"),dt.current.addSource("india-geojson",{type:"geojson",data:ln}),dt.current.addSource("india-states",{type:"geojson",data:Qr}),dt.current.addLayer({id:"india-border-shadow-outer",type:"line",source:"india-geojson",paint:{"line-color":(document.querySelector(".theme-dark"),"#68388b"),"line-width":2,"line-opacity":.05,"line-translate":[1,1]}}),dt.current.addLayer({id:"india-border-shadow-inner",type:"line",source:"india-geojson",paint:{"line-color":(document.querySelector(".theme-dark"),"#b57edc"),"line-width":2,"line-opacity":.6,"line-translate":[1,1]}}),dt.current.addLayer({id:"state-boundaries",type:"line",source:"india-states",paint:{"line-color":(document.querySelector(".theme-dark"),"#b57edc"),"line-width":1,"line-opacity":.6}})):(["state-boundaries","india-border-shadow-inner","india-border-shadow-outer"].forEach(Di=>{dt.current.getLayer(Di)&&dt.current.removeLayer(Di)}),dt.current.getSource("india-geojson")&&dt.current.removeSource("india-geojson"),dt.current.getSource("india-states")&&dt.current.removeSource("india-states"))};Ar(()=>{ps(!0),f0.accessToken=du,dt.current||(dt.current=new f0.Map({container:Zt.current,style:Yc,center:[78.9629,20.5937],minZoom:Fi,zoom:Pr,projection:"mercator"}),dt.current.addControl(new f0.NavigationControl),ps(!1))},[Yc]),Ar(()=>{if(dt.current&&L&&F){const vt=dt.current,Yt=L[F];if(Yt&&Yt.color){const Di=`kmz-line-source${F}`,yi=vt.getSource(Di);yi&&yi._data&&Array.isArray(yi._data.features)&&(yi._data.features.forEach(bi=>{bi.properties.color=Yt.color}),yi.setData(yi._data))}}},[L,F]);function Vu(vt,Yt){const Di=dt.current;if(!Di)return;const yi=Di.getSource(vt);if(!yi)return;const bi=JSON.parse(JSON.stringify(yi._data));let Li=!1;bi.features=bi.features.map(Tr=>(Yt[Tr.id]&&(Tr.properties.color=Yt[Tr.id],Li=!0),Tr)),Li?yi.setData(bi):console.warn("No matching features found in updateMultipleFeatureColors.")}Ar(()=>{if(dt.current&&Q&&te&&te!=="all"){const vt=Q[te],Yt=Array.from(fS).filter(yi=>yi.includes(`-project-${te}`)),Di={};Yt.forEach(yi=>{Di[yi]=vt.color}),Vu(Xs,Di),setTimeout(()=>{Vu(Xs,Di)},300)}else if(dt.current.getLayer(to)){const vt={};fS.forEach(Yt=>{vt[Yt]=he}),Vu(Xs,vt)}},[Q,te]),Ar(()=>{dt.current&&fe&&Object.keys(fe).length>0&&le&&ke==="employee"&&!Pt&&Zl()},[fe,le]),Ar(()=>{var vt,Yt,Di;if(dt.current&&fe&&Object.keys(fe).length>0&&le&&typeof lt=="string"&&lt&&lt.includes("PLC")&&ke==="customer"&&!Pt){const yi=Ui.current||{},bi={primary:(vt=fe[le])==null?void 0:vt["Primary Path"],secondary:(Yt=fe[le])==null?void 0:Yt["Secondary Path"],restoration:(Di=fe[le])==null?void 0:Di["Restoration Path"]};(yi.primary!==bi.primary||yi.secondary!==bi.secondary||yi.restoration!==bi.restoration)&&(Ui.current=bi,Zl())}},[fe,le,lt]),Ar(()=>{ke=="customer"&&Nt.length>0&&fe&&Object.keys(fe).length>0&&lt&&lt.includes("DFC")&&ai(!0)},[fe]),Ar(()=>{ke==="customer"&&Nt.length>0&&fe&&Object.keys(fe).length>0&&le&&ti?(pu(Nt,!0),ai(!1)):ke==="customer"&&Nt.length===0&&ti&&(Ma(),Cc(),ai(!1))},[Nt,fe,le,ke,ti]),Ar(()=>{const vt=Yt=>{ei.current&&!ei.current.contains(Yt.target)&&Un(!1)};return document.addEventListener("mousedown",vt),()=>{document.removeEventListener("mousedown",vt)}},[]),Ar(()=>{const vt=Yt=>{ur.current&&!ur.current.contains(Yt.target)&&Ge(!1)};return document.addEventListener("mousedown",vt),()=>{document.removeEventListener("mousedown",vt)}},[]),Ar(()=>()=>{dt.current.remove()},[]);const Nh=()=>{dt.current.flyTo({center:[78.9629,20.5937],minZoom:Fi,zoom:Pr,speed:2})},Ud=async()=>{var qr,sr;const vt=dt.current;if(!vt)return;const Yt=[],Di=vt.getStyle().layers.filter(Qi=>Qi.type==="line"&&(Qi.id&&Qi.id.includes("constl-line-layer")||Qi.id&&Qi.id.includes("kmz-line-layer")||Qi.id&&Qi.id.includes("customer-line-layer")||Qi.id&&Qi.id.includes("dark-fiber-line-layer")))||[];for(const Qi of Di){const sn=vt.getSource(Qi.source);if(sn&&((qr=sn._data)==null?void 0:qr.type)==="FeatureCollection")for(const hi of sn._data.features)((sr=hi==null?void 0:hi.geometry)==null?void 0:sr.type)==="LineString"&&Array.isArray(hi.geometry.coordinates)&&hi.geometry.coordinates.every(Pn=>Array.isArray(Pn)&&Pn.length===2&&typeof Pn[0]=="number"&&typeof Pn[1]=="number"&&!isNaN(Pn[0])&&!isNaN(Pn[1]))&&(hi.properties={name:"Route",description:"",...hi.properties||{}},Yt.push(hi))}if(!Yt.length){Bh();return}const yi=Qi=>String(Qi).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");let bi=`<?xml version="1.0" encoding="UTF-8"?>
`;bi+=`<kml xmlns="http://www.opengis.net/kml/2.2">
<Document>
`,bi+=`  <name>Routes and Markers</name>
`,Yt.filter(Qi=>{var sn;return((sn=Qi.geometry)==null?void 0:sn.type)==="LineString"&&Array.isArray(Qi.geometry.coordinates)&&Qi.geometry.coordinates.length>1}).forEach((Qi,sn)=>{var Pn,as;const hi=Qi.geometry.coordinates.map(([Yo,Qn])=>`${parseFloat(Yo.toFixed(6))},${parseFloat(Qn.toFixed(6))},0`).join(" ");bi+=`  <Placemark>
`,bi+=`    <name>${yi(((Pn=Qi.properties)==null?void 0:Pn.name)||`Route ${sn+1}`)}</name>
`,bi+=`    <description>${yi(((as=Qi.properties)==null?void 0:as.description)||"")}</description>
`,bi+=`    <LineString>
`,bi+=`      <tessellate>1</tessellate>
`,bi+=`      <coordinates>${hi}</coordinates>
`,bi+=`    </LineString>
`,bi+=`  </Placemark>
`}),bi+=`</Document>
</kml>`;const Li=new yO;Li.file("doc.kml",bi);const Tr=await Li.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),Bi=URL.createObjectURL(Tr),Gt=document.createElement("a");Gt.href=Bi,Gt.download="application.kmz",document.body.appendChild(Gt),Gt.click(),document.body.removeChild(Gt),URL.revokeObjectURL(Bi)};V3(Je,()=>({resetMap:Nh,clearDataCenterServices:()=>mi([]),removeAllDataCenterMarkers:qa,downloadAllRoutesAsKmz:Ud}));const up=vt=>{if(e!=="service details"||!Array.isArray(vt))return;const Yt=[];for(const Di of vt)if(Di.geometryType==="LineString"&&Di.geometryCoordinates&&Di.serviceOtsLink)try{const yi=JSON.parse(Di.geometryCoordinates).map(bi=>[bi[0],bi[1]]);Yt.push(...yi)}catch{console.warn("Invalid geometryCoordinates:",Di.geometryCoordinates)}Yt.length>0&&dt.current&&setTimeout(()=>{const Di=new f0.LngLatBounds;Yt.forEach(bi=>Di.extend(bi));const yi=Di.getCenter();dt.current.flyTo({center:yi,zoom:6,speed:1.5,curve:1.42,essential:!0})},1e3)};Ar(()=>{const vt=new ResizeObserver(()=>{Kt.current.offsetHeight>0&&dt.current&&dt.current.resize()});return Kt.current&&e=="serviceDetail"&&vt.observe(Kt.current),()=>{vt.disconnect()}},[e]),Ar(()=>{const vt=document.getElementById("dashboard-map");if(!vt)return;zc(vt.offsetHeight);const Yt=new ResizeObserver(()=>{zc(vt.offsetHeight)});return Yt.observe(vt),()=>{Yt.disconnect()}},[]),Ar(()=>{Lc>0&&dt.current&&dt.current.resize()},[Lc]),Ar(()=>{if(ni){Oh&&Oh.remove(),bh&&bh.remove();const vt=async()=>{dt.current.once("styledata",async()=>{dt.current.resize(),setTimeout(()=>{dt.current.resize()},200),zd(),pr.length>0&&yr.length>0&&Ps.length>0?await Promise.all([$c(),Zl(),ju()]):pr.length===0&&yr.length>0&&Ps.length>0?await Promise.all([$c(),Zl()]):pr.length>0&&yr.length===0&&Ps.length>0?await Promise.all([Zl(),ju()]):pr.length>0&&yr.length>0&&Ps.length==0?await Promise.all([$c(),ju()]):pr.length>0&&yr.length===0&&Ps.length===0?await ju():pr.length===0&&yr.length>0&&Ps.length===0?await $c():pr.length===0&&yr.length===0&&Ps.length>0&&await Zl(),Nt.length>0&&ke=="customer"&&await pu(Nt),ke=="customer"&&hl.length>0&&await Dl(hl),d&&d.length>0&&d.forEach(sr=>{const Qi=Object.values(rn).flat().filter(sn=>sn.deviceTypeId==sr);ic(Qi)}),Ie&&Ie.length>0&&xu(ds)});const bi=dt.current;if(!bi)return;const Li=()=>{ch(!0)},Tr=(sr,Qi)=>{const sn=bi.getZoom();if(sn>=sr)return;const hi=Math.min(sr,sn+2);bi.easeTo({center:Qi,zoom:hi,essential:!0})},Bi=sr=>{sr.preventDefault();const Qi=bi.getZoom();bi.unproject([sr.clientX,sr.clientY]);let sn=Qi+2;sn=Math.max(bi.getMinZoom(),Math.min(bi.getMaxZoom(),sn));const hi=bi.getCenter();Tr(sn,[hi.lng,hi.lat])},Gt=sr=>{sr.preventDefault();const Qi=bi.getZoom();bi.unproject([sr.clientX,sr.clientY]);const sn=sr.deltaY<0?2:-2;let hi=Qi+sn;hi=Math.max(bi.getMinZoom(),Math.min(bi.getMaxZoom(),hi));const Pn=bi.getCenter();bi.easeTo({center:[Pn.lng,Pn.lat],zoom:hi,essential:!0})},qr=bi.getContainer();qr.addEventListener("wheel",Gt,{passive:!1}),qr.addEventListener("dblclick",Bi,{passive:!1}),bi.on("load",Li),bi.on("style.load",Li),bi.once("remove",()=>{bi.off("load",Li),bi.off("style.load",Li),qr.removeEventListener("wheel",Gt),qr.removeEventListener("dblclick",Bi)}),bi&&setTimeout(()=>{Hu(bi)},100),fi(!1)},Yt=dt.current;if(!Yt||typeof Yt.getStyle!="function")return;(Yt.getStyle().layers||[]).forEach(bi=>{bi.id!=="mapbox-gl-style-switcher"&&Yt.getLayer(bi.id)&&Yt.removeLayer(bi.id)});const yi=Yt.getStyle().sources||{};Object.keys(yi).forEach(bi=>{bi==="mapbox-dem"&&Yt.getTerrain()&&Yt.setTerrain(null),bi!=="mapbox-gl-style-switcher-source"&&Yt.getSource(bi)&&Yt.removeSource(bi)}),document.querySelectorAll(".mapboxgl-popup").forEach(bi=>bi.remove()),setTimeout(()=>{vt()},100)}},[ni]);async function hc(){const vt=dt.current;if(!vt.getStyle||!vt.getStyle().layers)return[];const Yt=vt.getStyle().layers.filter(yi=>yi.type==="line"&&(yi.id&&yi.id.includes("constl-line-layer")||yi.id&&yi.id.includes("kmz-line-layer")||yi.id&&yi.id.includes("customer-line-layer")||yi.id&&yi.id.includes("dark-fiber-line-layer"))),Di=[...new Set(Yt.map(yi=>yi.source))];return Di.length==0&&vt&&typeof Nh=="function"&&Nh(),Di}async function fu(vt){vt&&(vt.isStyleLoaded()||await new Promise(Yt=>vt.once("style.load",Yt)))}async function Ha(){const vt=dt.current;if(!vt)return[];p1||await fu(vt);let Yt=[];const Di=new Set;if((await hc()).forEach(bi=>{const Li=vt.getSource(bi);Li&&Li._data&&Array.isArray(Li._data.features)&&Li._data.features.forEach(Tr=>{Tr.geometry.type==="LineString"&&Tr.geometry.coordinates.forEach(Bi=>{const Gt=Bi.join(",");Di.has(Gt)||(Yt.push(Bi),Di.add(Gt))})})}),Yt.length>0){const bi=_N(Yt),Li=uae(bi),Tr=[[Li[0],Li[1]],[Li[2],Li[3]]],Bi={type:"Polygon",coordinates:[[[Li[0],Li[1]],[Li[0],Li[3]],[Li[2],Li[3]],[Li[2],Li[1]],[Li[0],Li[1]]]]},Gt=Doe(Bi);let qr=9;Gt>5e9?qr=6.5:Gt>1e9?qr=7.5:Gt>1e8?qr=9:qr=14,vt.fitBounds(Tr,{padding:50,duration:500,maxZoom:qr})}else Nh()}const Ll=async vt=>{var qr,sr;const Yt=[],Di=new Set;for(const Qi of vt){const sn=Qi.projectcodemstid;if(sn&&S.includes(sn)&&Qi.geometrytype=="LineString"&&Qi.geocoords){const hi=`route-constl-${Qi.id}-project-${sn}`,Pn=`${hi}-${hi}`;Di.add(Pn);let as=JSON.parse(Qi.geocoords);Qi.cable_type=="Underground"&&Yt.push({type:"Feature",id:hi,geometry:{type:"LineString",coordinates:as},properties:{routeId:hi,parentId:hi,color:((qr=Q==null?void 0:Q[sn])==null?void 0:qr.color)||he,pathType:Qi.pathType||"primary",serviceId:Qi.serviceId||"",serviceStatus:Qi.serviceStatus||"",source:Qi.source,destination:Qi.destination,bandwidth:Qi.bandwidth,routeCities:Qi.routeCities||[],cable_type:Qi.cable_type||"",Ownership:Qi.Ownership||"",deviceTypeAttr:Qi.deviceTypeAttributes||[]}}),Qi.cable_type==="Overhead"&&Yt.push({type:"Feature",id:hi,geometry:{type:"LineString",coordinates:as},properties:{routeId:hi,parentId:hi,color:((sr=Q==null?void 0:Q[sn])==null?void 0:sr.color)||he,pathType:Qi.pathType||"primary",serviceId:Qi.serviceId||"",serviceStatus:Qi.serviceStatus||"",source:Qi.source,destination:Qi.destination,bandwidth:Qi.bandwidth,routeCities:Qi.routeCities||[],cable_type:Qi.cable_type||"",Ownership:Qi.Ownership||"",deviceTypeAttr:Qi.deviceTypeAttributes||[]}})}}const yi=dt.current;yi.getSource(Xs)?yi.getSource(Xs).setData({type:"FeatureCollection",features:Yt}):yi.addSource(Xs,{type:"geojson",data:{type:"FeatureCollection",features:Yt}}),yi.getLayer(to)||(yi.addLayer({id:to,type:"line",source:Xs,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["linear"],["zoom"],4,3,10,6,16,10,20,14],"line-dasharray":["case",["==",["get","pathType"],"secondary"],["literal",[2,3]],["==",["get","pathType"],"restoration"],["literal",[.1,2]],["literal",[]]]}}),yi.on("mouseenter",to,()=>{yi.getCanvas().style.cursor="pointer",yi.getCanvas().classList.add("cursor-pointer")}),yi.on("mouseleave",to,()=>{yi.getCanvas().style.cursor="",yi.getCanvas().classList.remove("cursor-pointer")}),yi.on("click",to,async Qi=>{if(Oh&&Oh.remove(),bh||HA)return;HA=!0;const sn=Qi.features[0].properties,hi=Qi.lngLat;bh=new f0.Popup({closeOnClick:!1,closeButton:!0,offset:25}).setLngLat(hi).setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header loading-text">Loading...</div></div>').addTo(yi),yi.easeTo({center:hi,zoom:Math.max(yi.getZoom(),6),duration:800});try{const Pn=await fae(sn.deviceTypeAttr,sn.cable_type,sn.Ownership);bh&&bh.setHTML(Pn)}catch{bh&&bh.setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header">Error loading popup</div></div>')}finally{HA=!1}bh.on("close",()=>{bh=null})}));const bi=new Set(fS);for(const Qi of bi)Di.has(Qi)||(yi.getLayer(Qi)&&yi.removeLayer(Qi),yi.getSource(Qi)&&yi.removeSource(Qi),fS.delete(Qi));Yt.forEach(Qi=>fS.add(Qi.id)),p1&&((async()=>await Ha())(),p1=!1),gi.current=Yt;const Li=gi.current.filter(Qi=>{var Pn;const sn=Qi.properties.cable_type==="Overhead"&&zn||Qi.properties.cable_type==="Underground"&&Ln,hi=Qi.properties.Ownership==="Own"&&Ls||Qi.properties.Ownership==="Third Party"&&bs;if(Tn){const as=Array.isArray(Qi.properties.deviceTypeAttr)?(Pn=Qi.properties.deviceTypeAttr.find(Yo=>Yo.attrName==="vendor_name"))==null?void 0:Pn.attrValue:"";return Ls&&Qi.properties.Ownership==="Own"||bs&&Qi.properties.Ownership==="Third Party"&&as===Tn?sn&&hi:sn&&hi&&as===Tn}else return sn&&hi}),Tr={Overhead_Own:0,"Overhead_Third Party":0,Underground_Own:0,"Underground_Third Party":0,Total:0};Li.forEach(Qi=>{var as;const sn=`${Qi.properties.cable_type}_${Qi.properties.Ownership}`,hi=(Array.isArray(Qi.properties.deviceTypeAttr)?(as=Qi.properties.deviceTypeAttr.find(Yo=>Yo.attrName==="cable_calculated_length"))==null?void 0:as.attrValue:0)||0,Pn=parseFloat(hi)||0;Tr[sn]!==void 0&&(Tr[sn]+=Pn),Tr.Total+=Pn});const Bi=gi.current.filter(Qi=>{const sn=Qi.properties.cable_type==="Overhead"&&zn||Qi.properties.cable_type==="Underground"&&Ln,hi=Qi.properties.Ownership==="Own"&&Ls||Qi.properties.Ownership==="Third Party"&&bs;return sn&&hi}).map(Qi=>{var sn;return Array.isArray(Qi.properties.deviceTypeAttr)?(sn=Qi.properties.deviceTypeAttr.find(hi=>hi.attrName==="third_party_vendor_name"))==null?void 0:sn.attrValue:void 0}).filter(Qi=>Qi!=null&&Qi!==""),Gt=Array.from(new Set(Bi));ft(Gt),pt(Tr)};function vd(){const vt=dt.current;if(!vt)return;const Yt=["constl-marker-layer","clusters-shadow","clusters","cluster-count"],Di=vt.getStyle().layers||[],yi=vt.getStyle().sources||{};Yt.forEach(bi=>{Di.filter(Li=>Li.id.includes(bi)).forEach(Li=>{vt.getLayer(Li.id)&&vt.removeLayer(Li.id),Li.source&&Li.source.includes(bi)&&vt.getSource(Li.source)&&vt.removeSource(Li.source)}),Object.keys(yi).forEach(Li=>{Li.includes(bi)&&vt.getSource(Li)&&vt.removeSource(Li)})})}function Bh(){Sh(!0)}function Wu(){Sh(!1)}function Xc(vt){const Yt=dt.current;if(!Yt)return;const Di=Yt.getStyle().sources||{},yi=Object.keys(Di).filter(Li=>Li.startsWith("constl-marker-source-"));let bi=!0;yi.forEach(Li=>{const Tr=Yt.getSource(Li);if(!Tr||!Tr._data||!Array.isArray(Tr._data.features))return;const Bi=Tr._data.features.filter(Gt=>Gt.properties&&Gt.properties.projectCodeId!==vt);Tr.setData({type:"FeatureCollection",features:Bi}),Bi.length>0&&(bi=!1)}),bi&&vd()}async function Ma(){const vt=dt.current;if(!vt)return;const Yt=vt.getStyle().layers;Yt&&(Yt.filter(Di=>Di.id.includes("dark-fiber-line-layer")&&Di.id.endsWith("-clickable")).forEach(Di=>{vt.getLayer(Di.id)&&vt.removeLayer(Di.id)}),Yt.filter(Di=>Di.id.includes("dark-fiber-line-layer")&&!Di.id.endsWith("-clickable")).forEach(Di=>{vt.getLayer(Di.id)&&vt.removeLayer(Di.id);const yi=Di.source;yi&&vt.getSource(yi)&&vt.removeSource(yi)}))}async function Cc(){const vt=dt.current;if(!vt)return;const Yt=vt.getStyle().layers;Yt&&Yt.filter(Di=>Di.id.startsWith("dark-fiber-marker-layer-")).forEach(Di=>{vt.getLayer(Di.id)&&vt.removeLayer(Di.id);const yi=Di.source;yi&&vt.getSource(yi)&&vt.removeSource(yi)})}async function Fh(){const vt=dt.current;if(!vt)return;const Yt=vt.getStyle().layers;Yt&&Yt.filter(Di=>Di.id.startsWith("customer-marker-layer")).forEach(Di=>{vt.getLayer(Di.id)&&vt.removeLayer(Di.id);const yi=Di.source;yi&&vt.getSource(yi)&&vt.removeSource(yi)})}const ao=async(vt,Yt,Di)=>{const yi=dt.current;if(!yi)return;for(;!yi.isStyleLoaded();)await new Promise(hi=>setTimeout(hi,100));const bi=[],Li=new Set;let Tr=null,Bi=Di;if(e=="dashboard"){const hi=Se.find(Pn=>Pn.services.some(as=>as.externalReferenceId==Di));if(hi){const Pn=hi.services.find(as=>as.externalReferenceId==Di);Pn&&(Tr=Pn.id)}}e=="service details"&&await c2(Di,bt,Dt).then(hi=>{hi&&hi.data&&hi.data.length>0&&(Tr=hi.data[0].id)}),vt.filter(hi=>hi.geometry&&hi.geometry.type==="LineString"&&Array.isArray(hi.geometry.coordinates)).forEach((hi,Pn)=>{const as=hi.geometry.coordinates.map(Qn=>[Qn[0],Qn[1]]),Yo=`DarkFiber-${Yt}-${Pn}`;bi.push({type:"Feature",id:Yo,geometry:{type:"LineString",coordinates:as},properties:{routeId:Yo,parentId:`DarkFiber-${Yt}`,color:fe&&Object.keys(fe).length>0&&fe[Tr]&&fe[Tr].color?fe[Tr].color:"#36CC36",pathType:"primary",serviceId:Tr||"",serviceStatus:"",serviceExternalIdLocal:Bi}}),Li.add(Yo)});const Gt=dt.current,qr="dark-fiber-line-source"+Yt,sr="dark-fiber-line-layer"+Yt,Qi=sr+"-clickable";if(Gt.getSource(qr))Gt.getSource(qr).setData({type:"FeatureCollection",features:bi});else{Gt.addSource(qr,{type:"geojson",data:{type:"FeatureCollection",features:bi}});const hi=Gt.getSource(qr);hi&&hi._data}Gt.getLayer(sr)||(Gt.addLayer({id:sr,type:"line",source:qr,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["linear"],["zoom"],4,["case",["==",["get","pathType"],"secondary"],3,["==",["get","pathType"],"restoration"],3,5],10,["case",["==",["get","pathType"],"secondary"],5,["==",["get","pathType"],"restoration"],5,7],16,["case",["==",["get","pathType"],"secondary"],8,["==",["get","pathType"],"restoration"],8,10],20,["case",["==",["get","pathType"],"secondary"],14,["==",["get","pathType"],"restoration"],14,18]],"line-dasharray":["case",["==",["get","pathType"],"secondary"],["literal",[]],["==",["get","pathType"],"restoration"],["literal",[.1,4]],["literal",[]]]}}),Gt.on("mouseenter",sr,()=>{Gt.getCanvas().style.cursor="pointer",Gt.getCanvas().classList.add("cursor-pointer")}),Gt.on("mouseleave",sr,()=>{Gt.getCanvas().style.cursor="",Gt.getCanvas().classList.remove("cursor-pointer")})),Gt.getLayer(Qi)||(Gt.addLayer({id:Qi,type:"line",source:qr,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000000","line-opacity":.01,"line-width":["interpolate",["linear"],["zoom"],4,10,10,15,16,20,20,22]}}),Gt.on("mouseenter",Qi,()=>{Gt.getCanvas().style.cursor="pointer",Gt.getCanvas().classList.add("cursor-pointer")}),Gt.on("mouseleave",Qi,()=>{Gt.getCanvas().style.cursor="",Gt.getCanvas().classList.remove("cursor-pointer")}),Gt.on("click",Qi,async hi=>{if(bh&&bh.remove(),Oh||f1)return;f1=!0;const Pn=hi.features[0].properties,as=hi.lngLat;Oh=new f0.Popup({closeOnClick:!1,closeButton:!0,offset:25}).setLngLat(as).setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header loading-text">Loading...</div></div>').addTo(Gt),Gt.easeTo({center:as,zoom:Math.max(Gt.getZoom(),6),duration:800});try{const Yo=await CN(e,Pn.serviceExternalIdLocal,t,Pn.pathType,Cs||"",Pn.serviceStatus,Se,ke,s,Pn.color,bt,Dt);Oh.setHTML(Yo)}catch(Yo){console.error("Popup loading failed:",Yo),Oh.setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header">Error loading popup</div></div>')}finally{f1=!1}Oh.on("close",()=>{Oh=null})}));const sn=new Set(jA);for(const hi of sn)Li.has(hi)||(Gt.getLayer(hi)&&Gt.removeLayer(hi),Gt.getSource(hi)&&Gt.removeSource(hi),jA.delete(hi));bi.forEach(hi=>jA.add(hi.id))},Dl=async vt=>{const Yt=dt.current;if(!Yt)return;for(;!Yt.isStyleLoaded();)await new Promise(bi=>setTimeout(bi,100));await Fh(),await new Promise(bi=>setTimeout(bi,300));const Di=Array.isArray(vt)&&vt.length>0?vt:[],yi=[];if(Di.forEach(bi=>{const Li=parseFloat(bi==null?void 0:bi.sourceEndLatitude),Tr=parseFloat(bi==null?void 0:bi.sourceEndLongitude);!Number.isNaN(Li)&&!Number.isNaN(Tr)&&yi.push({type:"Feature",id:`customer-marker-source-${bi.id}`,geometry:{type:"Point",coordinates:[Tr,Li]},properties:{icon:"customer-building-icon",title:bi==null?void 0:bi.sourceEndName,markerType:"source",externalReferenceId:bi==null?void 0:bi.externalReferenceId,customerAccountNo:bi==null?void 0:bi.customerAccountNo,isActive:bi==null?void 0:bi.isActive}});const Bi=parseFloat(bi==null?void 0:bi.destinationEndLatitude),Gt=parseFloat(bi==null?void 0:bi.destinationEndLongitude);!Number.isNaN(Bi)&&!Number.isNaN(Gt)&&yi.push({type:"Feature",id:`customer-marker-destination-${bi.id}`,geometry:{type:"Point",coordinates:[Gt,Bi]},properties:{icon:"customer-building-icon",title:bi==null?void 0:bi.destinationEndName,markerType:"destination",externalReferenceId:bi==null?void 0:bi.externalReferenceId,customerAccountNo:bi==null?void 0:bi.customerAccountNo,isActive:bi==null?void 0:bi.isActive}})}),Yt.hasImage("customer-building-icon")||await new Promise(bi=>{Yt.loadImage(Ooe,(Li,Tr)=>{!Li&&Tr&&!Yt.hasImage("customer-building-icon")&&Yt.addImage("customer-building-icon",Tr),bi()})}),Yt.getSource("customer-marker-source")?Yt.getSource("customer-marker-source").setData({type:"FeatureCollection",features:yi}):Yt.addSource("customer-marker-source",{type:"geojson",data:{type:"FeatureCollection",features:yi}}),Yt.getLayer("customer-marker-layer")||Yt.addLayer({id:"customer-marker-layer",type:"symbol",source:"customer-marker-source",layout:{"icon-image":"customer-building-icon","icon-size":.8,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}),!Yt.__customerMarkerController){const bi={tooltipEl:null,activeId:null,activeCoords:null,isDragging:!1,rafId:null,lastEvent:null,debug:!1,DRAG_SAFE_DELAY:120},Li=document.createElement("div");Li.className="customer-popup-custom",Li.style.position="absolute",Li.style.pointerEvents="none",Li.style.display="none",Li.style.transform="translate(-50%, -110%)",Li.style.zIndex=9999,Li.style.padding="6px 10px",Li.style.background="#fff",Li.style.borderRadius="6px",Li.style.border="1px solid #ccc",Li.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",Li.style.fontSize="13px",Li.style.fontWeight="600",Li.style.whiteSpace="nowrap",Li.style.fontFamily="'Open Sans',sans-serif";const Tr=document.createElement("div");Tr.style.position="absolute",Tr.style.width="0",Tr.style.height="0",Tr.style.left="50%",Tr.style.bottom="-6px",Tr.style.transform="translateX(-50%)",Tr.style.borderLeft="6px solid transparent",Tr.style.borderRight="6px solid transparent",Tr.style.borderTop="6px solid #fff",Li.appendChild(Tr),Yt.getContainer().appendChild(Li),bi.tooltipEl=Li;const Bi=(sn,hi)=>`
        <div style="display:inline-block; font-weight:600; color:#333;font-family:'Open Sans',sans-serif">
          <span style="color:${sn==="source"?"#0077cc":"#cc3300"};">
            ${sn==="source"?" Source":" Destination"}
          </span>
          &nbsp; ${hi||""}
        </div>
      `,Gt=(sn,hi,Pn)=>{bi.activeCoords=sn.slice(),bi.tooltipEl.innerHTML=Bi(hi,Pn),bi.tooltipEl.style.display="block",sr()},qr=()=>{bi.activeId=null,bi.activeCoords=null,bi.tooltipEl.style.display="none"},sr=()=>{if(bi.activeCoords)try{const sn=Yt.project(bi.activeCoords);bi.tooltipEl.style.left=`${sn.x}px`,bi.tooltipEl.style.top=`${sn.y}px`}catch(sn){bi.debug&&console.warn("project error",sn)}},Qi=()=>{var el,Mo,Fs,Jo,ea;bi.rafId=null;const sn=bi.lastEvent;if(bi.lastEvent=null,!sn)return;if(bi.isDragging){bi.tooltipEl.style.display!=="none"&&qr();return}if(!Yt.getLayer("customer-marker-layer")){bi.tooltipEl.style.display!=="none"&&qr(),Yt.getCanvas().style.cursor="";return}const hi=Yt.queryRenderedFeatures(sn.point,{layers:["customer-marker-layer"]});if(!hi||hi.length===0){bi.tooltipEl.style.display!=="none"&&qr(),Yt.getCanvas().style.cursor="";return}const Pn=hi[0],as=Pn.id??((el=Pn.properties)==null?void 0:el.externalReferenceId)??((Mo=Pn.properties)==null?void 0:Mo.customerAccountNo)??Pn.geometry.coordinates.join(",");if(bi.activeId===as){Yt.getCanvas().style.cursor="pointer";return}bi.activeId=as,Yt.getCanvas().style.cursor="pointer";const Yo=(Fs=Pn.properties)==null?void 0:Fs.markerType,Qn=((Jo=Pn.properties)==null?void 0:Jo.title)??"",ro=Pn.geometry.coordinates.slice(),Ao=((ea=sn.lngLat)==null?void 0:ea.lng)??ro[0];for(;Math.abs(Ao-ro[0])>180;)ro[0]+=Ao>ro[0]?360:-360;Gt(ro,Yo,Qn),bi.debug&&console.log("showTooltip",as,ro)};Yt.on("mousemove",sn=>{bi.lastEvent=sn,!bi.rafId&&(bi.rafId=requestAnimationFrame(Qi))}),Yt.on("dragstart",()=>{bi.isDragging=!0,bi.tooltipEl.style.display!=="none"&&qr()}),Yt.on("dragend",()=>{setTimeout(()=>{bi.isDragging=!1},bi.DRAG_SAFE_DELAY)}),Yt.on("move",()=>{bi.tooltipEl.style.display!=="none"&&bi.activeCoords&&sr()}),Yt.__customerMarkerController=bi}},xu=async vt=>{const Yt=dt.current;if(!Yt)return;for(;!Yt.isStyleLoaded();)await new Promise(Gt=>setTimeout(Gt,100));const Di=Array.isArray(vt)&&vt.length>0?vt:[],yi=[],bi=new Map;Di.forEach(Gt=>{if(Gt.geometryType=="Point"&&Gt.geometryCoordinates){const qr=JSON.parse(Gt.geometryCoordinates),sr=Gt.deviceTypeId,Qi=q.find(hi=>hi.id==sr);let sn=null;if(Qi&&Qi.iconURL){const hi=`icon-${sr}`;bi.set(hi,Qi.iconURL),sn=Gt.buildingName,yi.push({type:"Feature",id:`marker-${sr}-${Gt.id}`,geometry:{type:"Point",coordinates:qr},properties:{icon:hi,title:sn,deviceId:sr,projectCodeId:Gt.projectCodeId,pId:Gt.id}})}}});const Li=dt.current,Tr=Array.from(bi.entries()).map(([Gt,qr])=>new Promise(sr=>{if(Li.hasImage(Gt))return sr();Li.loadImage(qr,(Qi,sn)=>{!Qi&&sn&&!Li.hasImage(Gt)?Li.addImage(Gt,sn):console.warn("Failed to load:",Gt,qr),sr()})}));await Promise.all(Tr);let Bi=yi;if(Li.getSource("data-center-marker-source")){const Gt=Li.getSource("data-center-marker-source")._data;if(Gt&&Array.isArray(Gt.features)){const qr=Gt.features,sr=new Set(qr.map(Qi=>Qi.id));Bi=[...qr,...yi.filter(Qi=>!sr.has(Qi.id))]}Li.getSource("data-center-marker-source").setData({type:"FeatureCollection",features:Bi})}else Li.addSource("data-center-marker-source",{type:"geojson",data:{type:"FeatureCollection",features:Bi}});Li.getLayer("data-center-marker-layer")||(Li.addLayer({id:"data-center-marker-layer",type:"symbol",source:"data-center-marker-source",layout:{"icon-image":["get","icon"],"icon-size":.75,"icon-allow-overlap":!0,"icon-anchor":"bottom","text-field":["get","title"],"text-font":["Open Sans Bold"],"text-size":12,"text-offset":[4.2,-2],"text-anchor":"right","text-variable-anchor":["left","right"],"text-radial-offset":-3.5},paint:{"text-color":"#38313C","text-halo-color":"#fff","text-halo-width":1}}),af(Li,"data-center-marker-layer"))},af=(vt,Yt)=>{vt.on("click",Yt,async function(Di){var qr,sr,Qi,sn,hi,Pn,as,Yo,Qn,ro,Ao,el,Mo,Fs,Jo,ea,So,Ua,Ul,$l,$a,Vl,dl,uh,rc,Dc,Pc,Zc;if(console.log("Data Center Marker clicked:",Di),bh&&bh.remove(),!Di.features.length)return;const yi=Di.features[0],bi=yi.geometry.coordinates.slice(),Li=yi.properties,Tr=Li.pId;Li.title;const Bi=await UA("Data Center",Tr);let Gt=`
        <div class="mapbox-dialog-constl">
  <div class="mapbox-dialog-header-constl">
    <div class="mapbox-dialog-heading-constl">Data Center Information</div>
  </div>
  <div class="mapbox-dialog-body-constl">
    <div class="row">
     
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">DC Name:</div>
          <div class="value">${((sr=(qr=Bi==null?void 0:Bi.data)==null?void 0:qr.oss)==null?void 0:sr.buildingName)||"N/A"}</div>
        </div>
      </div>

      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">District Name/Block Name:</div>
          <div class="value">${((sn=(Qi=Bi==null?void 0:Bi.data)==null?void 0:Qi.gis)==null?void 0:sn.district)||"N/A"} (${((Pn=(hi=Bi==null?void 0:Bi.data)==null?void 0:hi.gis)==null?void 0:Pn.blockName)||"N/A"})</div>
        </div>
      </div>
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">Project Code:</div>
          <div class="value">${((Yo=(as=Bi==null?void 0:Bi.data)==null?void 0:as.gis)==null?void 0:Yo.projectCode)||"N/A"}</div>
        </div>
      </div>
      <div class="col-md-12 mb-15">
        <div class="form-group-view">
          <div class="title">Address:</div>
          <div class="value">${((ro=(Qn=Bi==null?void 0:Bi.data)==null?void 0:Qn.oss)==null?void 0:ro.address)||"N/A"}, ${((el=(Ao=Bi==null?void 0:Bi.data)==null?void 0:Ao.oss)==null?void 0:el.cityName)||"N/A"}, ${((Fs=(Mo=Bi==null?void 0:Bi.data)==null?void 0:Mo.oss)==null?void 0:Fs.stateName)||"N/A"}</div>
        </div>
      </div>
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">Building Code:</div>
          <div class="value">${((ea=(Jo=Bi==null?void 0:Bi.data)==null?void 0:Jo.oss)==null?void 0:ea.buildingCode)||"N/A"}</div>
        </div>
      </div>
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">Site Code:</div>
          <div class="value">${((Ua=(So=Bi==null?void 0:Bi.data)==null?void 0:So.oss)==null?void 0:Ua.siteCode)||"N/A"} (${(($l=(Ul=Bi==null?void 0:Bi.data)==null?void 0:Ul.oss)==null?void 0:$l.networkStatus)||"N/A"})</div>
        </div>
      </div>


     
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">Region:</div>
          <div class="value">${((Vl=($a=Bi==null?void 0:Bi.data)==null?void 0:$a.oss)==null?void 0:Vl.regionName)||"N/A"} (${((uh=(dl=Bi==null?void 0:Bi.data)==null?void 0:dl.oss)==null?void 0:uh.regionCode)||"N/A"})</div>
        </div>
      </div>
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">Capability:</div>
          <div class="value">${((Dc=(rc=Bi==null?void 0:Bi.data)==null?void 0:rc.oss)==null?void 0:Dc.capability)||"N/A"}</div>
        </div>
      </div>
      <div class="col-md-6 mb-15">
        <div class="form-group-view">
          <div class="title">POP/DC Type:</div>
          <div class="value">${((Zc=(Pc=Bi==null?void 0:Bi.data)==null?void 0:Pc.oss)==null?void 0:Zc.popDcType)||"N/A"}</div>
        </div>
      </div>

      
    </div>
  </div>
</div>
        `;md&&(md.remove(),md=null),md=new f0.Popup({offset:25,closeButton:!0,closeOnClick:!0,className:"custom-mapbox-popup"}).setLngLat(bi).setHTML(Gt).addTo(vt)}),vt.on("mouseenter",Yt,function(){vt.getCanvas().style.cursor="pointer"}),vt.on("mouseleave",Yt,function(){vt.getCanvas().style.cursor=""})},kn=(vt,Yt,Di,yi,bi,Li)=>{console.log("Adding popup without pop..."),vt.on("click",Yt,async function(Tr){var as,Yo,Qn,ro,Ao,el,Mo,Fs,Jo,ea,So,Ua,Ul,$l,$a,Vl,dl,uh,rc,Dc,Pc,Zc,or,Kr,Ur,Kn,As,Xo,pl,Fn,fs,In,Ms,ho,na,ta,Oo,Io,To,fl,rl,mr,Tl,Vo,Kc,uc,dc,Qc,bd,Jc,ws;if(console.log("Marker clicked:",Tr),bh&&bh.remove(),!Tr.features.length)return;const Bi=Tr.features[0],Gt=Bi.geometry.coordinates.slice(),qr=Bi.properties,sr=Bi.id;yi.find(qu=>qu.id.toString()===sr),qr.title;const Qi=((as=bi.find(qu=>qu.id==qr.deviceId))==null?void 0:as.name)||"",sn=qr.pId,hi=await UA(Li,sn);let Pn=`<div class="mapbox-dialog-constl">
  <div class="mapbox-dialog-header-constl">
    <div class="mapbox-dialog-heading-constl">${Qi} Information</div></div>
  <div class="mapbox-dialog-body-constl">

       

        ${Li.toLowerCase()=="splice closure"||Li.toLowerCase()=="spliceclosure"?`<div class="row">
            <div class="col-md-6 mb-15">
                <div class="form-group-view">
                    <div class="title">Splice Closure Name:</div>
                    <div class="value"> ${((Qn=(Yo=hi==null?void 0:hi.data)==null?void 0:Yo.gis)==null?void 0:Qn.name)||"N/A"}</div>
                </div>
            </div>
            <div class="col-md-6 mb-15">
                <div class="form-group-view">
                    <div class="title">Region:</div>
                    <div class="value">${((Ao=(ro=hi==null?void 0:hi.data)==null?void 0:ro.gis)==null?void 0:Ao.region)||"N/A"}</div>
                </div>
            </div>
            <div class="col-md-6 mb-15">
                <div class="form-group-view">
                    <div class="title">District Name/Block Name:</div>
                    <div class="value">${((Mo=(el=hi==null?void 0:hi.data)==null?void 0:el.gis)==null?void 0:Mo.district)||"N/A"} (${((Jo=(Fs=hi==null?void 0:hi.data)==null?void 0:Fs.gis)==null?void 0:Jo.blockName)||"N/A"})</div>
                </div>
            </div>
            <div class="col-md-6 mb-15">
                <div class="form-group-view">
                    <div class="title">Number of Ports:</div>
                    <div class="value">${((So=(ea=hi==null?void 0:hi.data)==null?void 0:ea.gis)==null?void 0:So.numberOfPorts)||"N/A"}</div>
                </div>
            </div>
            
            <div class="col-md-6 mb-15">
                <div class="form-group-view">
                    <div class="title">Project Code:</div>
                    <div class="value">${((Ul=(Ua=hi==null?void 0:hi.data)==null?void 0:Ua.gis)==null?void 0:Ul.projectCode)||"N/A"}</div>
                </div>
            </div>
            
            
            </div>`:""}

         ${Li.toLowerCase()=="data center"||Li.toLowerCase()=="dc"?` <div class="row">
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">DC Name:</div>
                        <div class="value">${(($a=($l=hi==null?void 0:hi.data)==null?void 0:$l.oss)==null?void 0:$a.buildingName)||"N/A"}</div>
                    </div>
                </div>

                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">District Name/Block Name:</div>
                        <div class="value">${((dl=(Vl=hi==null?void 0:hi.data)==null?void 0:Vl.gis)==null?void 0:dl.district)||"N/A"} (${((rc=(uh=hi==null?void 0:hi.data)==null?void 0:uh.gis)==null?void 0:rc.blockName)||"N/A"})</div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">Project Code:</div>
                        <div class="value">${((Pc=(Dc=hi==null?void 0:hi.data)==null?void 0:Dc.gis)==null?void 0:Pc.projectCode)||"N/A"}</div>
                    </div>
                </div>
                <div class="col-md-12 mb-15">
                    <div class="form-group-view">
                        <div class="title">Address:</div>
                        <div class="value">${((or=(Zc=hi==null?void 0:hi.data)==null?void 0:Zc.oss)==null?void 0:or.address)||"N/A"}, ${((Ur=(Kr=hi==null?void 0:hi.data)==null?void 0:Kr.oss)==null?void 0:Ur.cityName)||"N/A"}, ${((As=(Kn=hi==null?void 0:hi.data)==null?void 0:Kn.oss)==null?void 0:As.stateName)||"N/A"}</div>
                    </div>
                </div>
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">Building Code:</div>
                        <div class="value">${((pl=(Xo=hi==null?void 0:hi.data)==null?void 0:Xo.oss)==null?void 0:pl.buildingCode)||"N/A"}</div>
                    </div>
                </div>
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">Site Code:</div>
                        <div class="value">${((fs=(Fn=hi==null?void 0:hi.data)==null?void 0:Fn.oss)==null?void 0:fs.siteCode)||"N/A"} (${((Ms=(In=hi==null?void 0:hi.data)==null?void 0:In.oss)==null?void 0:Ms.networkStatus)||"N/A"})</div>
                    </div>
                </div>
  
             
              
                  <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">Capability:</div>
                        <div class="value">${((na=(ho=hi==null?void 0:hi.data)==null?void 0:ho.oss)==null?void 0:na.capability)||"N/A"}</div>
                    </div>
                </div>
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">Region:</div>
                        <div class="value">${((Oo=(ta=hi==null?void 0:hi.data)==null?void 0:ta.oss)==null?void 0:Oo.regionName)||"N/A"} (${((To=(Io=hi==null?void 0:hi.data)==null?void 0:Io.oss)==null?void 0:To.regionCode)||"N/A"})</div>
                    </div>
                </div>
           
                <div class="col-md-6 mb-15">
                    <div class="form-group-view">
                        <div class="title">POP/DC Type:</div>
                        <div class="value">${((rl=(fl=hi==null?void 0:hi.data)==null?void 0:fl.oss)==null?void 0:rl.popDcType)||"N/A"}</div>
                    </div>
                </div>
                  
            </div>`:""}

         ${Li.toLowerCase()=="equipment"?`<div class="row">
              <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                      <div class="title">Equipment Name:</div>
                      <div class="value">${((Tl=(mr=hi==null?void 0:hi.data)==null?void 0:mr.gis)==null?void 0:Tl.name)||"N/A"}</div>
                  </div>
              </div>
              <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                      <div class="title">Network Status :</div>
                      <div class="value">${((Kc=(Vo=hi==null?void 0:hi.data)==null?void 0:Vo.gis)==null?void 0:Kc.networkStatus)||"N/A"}</div>
                  </div>
              </div>
              <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                      <div class="title">Region:</div>
                      <div class="value">${((dc=(uc=hi==null?void 0:hi.data)==null?void 0:uc.gis)==null?void 0:dc.region)||"N/A"}</div>
                  </div>
              </div>
              <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                      <div class="title">Number of Ports:</div>
                      <div class="value">${((bd=(Qc=hi==null?void 0:hi.data)==null?void 0:Qc.gis)==null?void 0:bd.numberOfPorts)||"N/A"}</div>
                  </div>
              </div>
              <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                      <div class="title">Project Code:</div>
                      <div class="value">${((ws=(Jc=hi==null?void 0:hi.data)==null?void 0:Jc.gis)==null?void 0:ws.projectCode)||"N/A"}</div>
                  </div>
              </div>
             
            </div>`:""} 
  </div>
</div>`;md&&(md.remove(),md=null),md=new f0.Popup({offset:25,closeButton:!0,closeOnClick:!0,className:"custom-mapbox-popup"}).setLngLat(Gt).setHTML(Pn).addTo(vt)}),vt.on("mouseenter",Yt,function(){vt.getCanvas().style.cursor="pointer"}),vt.on("mouseleave",Yt,function(){vt.getCanvas().style.cursor=""})},lf=(vt,Yt,Di,yi,bi,Li)=>{vt.on("click",Yt,async function(Tr){var Ao,el,Mo,Fs,Jo,ea,So,Ua,Ul,$l,$a,Vl,dl,uh,rc,Dc,Pc,Zc,or,Kr,Ur,Kn,As,Xo,pl,Fn,fs,In,Ms,ho,na,ta,Oo;if(bh&&bh.remove(),!Tr.features.length)return;const Bi=Tr.features[0],Gt=Bi.geometry.coordinates.slice(),qr=Bi.properties,sr=Bi.id,Qi=yi.find(Io=>Io.id.toString()===sr),sn=qr.title||"",Pn=Liferay.ThemeDisplay.getPortalURL()+qr.buildingImageUrl||"",as=((Ao=bi.find(Io=>Io.id==qr.deviceId))==null?void 0:Ao.name)||"";if(Qi&&Array.isArray(Qi.gISDeviceTypeAttrInternalNWID)){const Io=Qi.gISDeviceTypeAttrInternalNWID.find(To=>To.attrName==="pop_name"||To.attrName==="dc_name");Io&&Io.attrValue}const Yo=qr.pId,Qn=await UA(Li,Yo);let ro=`
           <div class="mapbox-dialog-constl">
            <div class="mapbox-dialog-header-constl">
              <div class="mapbox-dialog-heading-constl">${as} Information</div>
            </div>
            <div class="mapbox-dialog-body-constl">
              <div class="row">
              <div class="col-md-12 mb-15">
               <div class="form-group-view">
                    <div class="value">
                        <a href="http://trueview.in/?type=truecloud#" target="_blank" rel="noopener noreferrer">
                        ${sn} 
                        </a>
                      </div>
                </div>
              </div>
                <div class="col-md-12 mb-15">
                  <div class="imgBox">
                    <img src="${Pn||""}" alt="${sn}" style="max-width: 100%; height: auto;">
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">POP Name:</div>
                    <div class="value">${((Mo=(el=Qn==null?void 0:Qn.data)==null?void 0:el.gis)==null?void 0:Mo.name)||"N/A"}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">District Name/Block Name:</div>
                    <div class="value">${((Jo=(Fs=Qn==null?void 0:Qn.data)==null?void 0:Fs.gis)==null?void 0:Jo.district)||"N/A"} (${((So=(ea=Qn==null?void 0:Qn.data)==null?void 0:ea.gis)==null?void 0:So.blockName)||"N/A"})</div>
                  </div>
                </div>
               
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Project Code:</div>
                    <div class="value">${((Ul=(Ua=Qn==null?void 0:Qn.data)==null?void 0:Ua.gis)==null?void 0:Ul.projectCode)||"N/A"}</div>
                  </div>
                </div>
                <div class="col-md-12 mb-15">
                  <div class="form-group-view">
                    <div class="title">Address:</div>
                    <div class="value">${(($a=($l=Qn==null?void 0:Qn.data)==null?void 0:$l.oss)==null?void 0:$a.address)||"N/A"}, ${((dl=(Vl=Qn==null?void 0:Qn.data)==null?void 0:Vl.oss)==null?void 0:dl.cityName)||"N/A"}, ${((rc=(uh=Qn==null?void 0:Qn.data)==null?void 0:uh.oss)==null?void 0:rc.stateName)||"N/A"}</div>
                  </div>
                </div>
                
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Building Code:</div>
                    <div class="value">${((Pc=(Dc=Qn==null?void 0:Qn.data)==null?void 0:Dc.oss)==null?void 0:Pc.buildingCode)||"N/A"}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Site Code:</div>
                    <div class="value">${((or=(Zc=Qn==null?void 0:Qn.data)==null?void 0:Zc.oss)==null?void 0:or.siteCode)||"N/A"} (${((Ur=(Kr=Qn==null?void 0:Qn.data)==null?void 0:Kr.oss)==null?void 0:Ur.networkStatus)||"N/A"})</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Project Name:</div>
                    <div class="value">${((As=(Kn=Qn==null?void 0:Qn.data)==null?void 0:Kn.oss)==null?void 0:As.projectName)||"N/A"}</div>
                  </div>
                </div>
               
               
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Region:</div>
                    <div class="value">${((pl=(Xo=Qn==null?void 0:Qn.data)==null?void 0:Xo.oss)==null?void 0:pl.regionName)||"N/A"} (${((fs=(Fn=Qn==null?void 0:Qn.data)==null?void 0:Fn.oss)==null?void 0:fs.regionCode)||"N/A"})</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Building Name:</div>
                    <div class="value">${((Ms=(In=Qn==null?void 0:Qn.data)==null?void 0:In.oss)==null?void 0:Ms.buildingName)||"N/A"}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">Capability:</div>
                    <div class="value">${((na=(ho=Qn==null?void 0:Qn.data)==null?void 0:ho.oss)==null?void 0:na.capability)||"N/A"}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-15">
                  <div class="form-group-view">
                    <div class="title">POP/DC Type:</div>
                    <div class="value">${((Oo=(ta=Qn==null?void 0:Qn.data)==null?void 0:ta.oss)==null?void 0:Oo.popDcType)||"N/A"}</div>
                  </div>
                </div>
            
                

              </div>
            </div>
          </div>`;md&&(md.remove(),md=null),md=new f0.Popup({offset:25,closeButton:!0,closeOnClick:!0,className:"custom-mapbox-popup"}).setLngLat(Gt).setHTML(ro).addTo(vt)}),vt.on("mouseenter",Yt,function(){vt.getCanvas().style.cursor="pointer"}),vt.on("mouseleave",Yt,function(){vt.getCanvas().style.cursor=""})},ic=async vt=>{const Yt=dt.current;if(!Yt)return;for(;!Yt.isStyleLoaded();)await new Promise(Gt=>setTimeout(Gt,100));const yi=(Array.isArray(vt)?vt:[]).filter(Gt=>Gt.projectCodeId&&S.includes(Gt.projectCodeId)),bi=[],Li=new Map,Tr=new Map;yi.forEach(Gt=>{var el,Mo,Fs,Jo,ea;if(console.log("Processing GIS:",Gt.id),Gt.geometryType!=="Point"||!Gt.geometryCoordinates)return;console.log("Processing GIS:",Gt.geometryType);const qr=JSON.parse(Gt.geometryCoordinates),sr=Gt.deviceTypeId,Qi=Gt.id,sn=q.find(So=>So.id==sr);if(!sn||!sn.iconURL)return;console.log("Matched element:",sn.name);const hi=`icon-${sr}`;Li.set(hi,sn.iconURL);let Pn="#0077CC",as=1,Yo=1.5;((el=sn.name)==null?void 0:el.toLowerCase())==="data center"?(Pn="#38313C",as=.75,Yo=1.125):((Mo=sn.name)==null?void 0:Mo.toLowerCase())==="pop"&&(Pn="#5D12E9");const Qn=`icon-size-${sr}`;Tr.set(Qn,{min:as,max:Yo,text_color:Pn});let ro=null,Ao=null;["pop"].includes((Fs=sn.name)==null?void 0:Fs.toLowerCase())&&(ro=Gt.buildingName,Ao=Gt.deviceTypeImageUrl),["data center"].includes((Jo=sn.name)==null?void 0:Jo.toLowerCase())&&(ro=Gt.buildingName,Ao=Gt.deviceTypeImageUrl),bi.push({type:"Feature",id:`marker-${sr}-${Gt.id}`,geometry:{type:"Point",coordinates:qr},properties:{icon:hi,title:ro,buildingImageUrl:Ao,deviceId:sr,projectCodeId:Gt.projectCodeId,iconType:((ea=sn.name)==null?void 0:ea.toLowerCase())==="data center"?"data center":"default",iconKeySizeKey:Qn,pId:Qi}})}),await Promise.all(Array.from(Li.entries()).map(([Gt,qr])=>new Promise(sr=>{if(Yt.hasImage(Gt))return sr();Yt.loadImage(qr,(Qi,sn)=>{!Qi&&sn&&!Yt.hasImage(Gt)&&Yt.addImage(Gt,sn),sr()})})));const Bi={};bi.forEach(Gt=>{const qr=Gt.properties.deviceId;Bi[qr]||(Bi[qr]=[]),Bi[qr].push(Gt)}),Object.keys(Bi).forEach(Gt=>{var Ao,el,Mo,Fs,Jo,ea,So;const qr=`constl-marker-source-${Gt}`,sr=`clusters-${Gt}`,Qi=`constl-marker-layer-${Gt}`,sn=(Ao=Bi[Gt][0])==null?void 0:Ao.properties.iconKeySizeKey,hi=Tr.get(sn)||{min:1,max:1.5,text_color:"#5D12E9"};[Qi,sr].forEach(Ua=>{Yt.getLayer(Ua)&&Yt.removeLayer(Ua)}),Yt.getSource(qr)&&Yt.removeSource(qr),Yt.addSource(qr,{type:"geojson",data:{type:"FeatureCollection",features:Bi[Gt]},cluster:!0,clusterMaxZoom:12,clusterRadius:Math.max(40,60-Yt.getZoom()*2),clusterProperties:{icon:["get","icon"]}});const Pn=["interpolate",["linear"],["zoom"],4,hi.min,16,hi.max];Yt.addLayer({id:sr,type:"symbol",source:qr,filter:["has","point_count"],layout:{"icon-image":`icon-${Gt}`,"icon-size":Pn,"icon-allow-overlap":!0,"text-allow-overlap":!0,"icon-ignore-placement":!0,"text-ignore-placement":!0,"symbol-z-order":"viewport-y","icon-anchor":"center","text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold"],"text-size":16,"text-anchor":"center"},paint:{"text-color":"#fff","text-halo-color":"#000","text-halo-width":1}});function as(){const Ua=Pn[4],Ul=Pn[6],$l=Ul*1.6,$a=250;let Vl=null,dl=0;function uh(Dc){return 1-Math.pow(1-Dc,3)}function rc(Dc){Vl||(Vl=Dc);const Pc=Math.min((Dc-Vl)/$a,1),Zc=uh(Pc),or=Ul+($l-Ul)*Zc;if(Dc-dl>33){const Kr=["interpolate",["linear"],["zoom"],3,Ua,16,or];Yt.getLayer(sr)&&Yt.setLayoutProperty(sr,"icon-size",Kr),dl=Dc}Pc<1?requestAnimationFrame(rc):Yt.getLayer(sr)&&Yt.setLayoutProperty(sr,"icon-size",Pn)}requestAnimationFrame(rc)}let Yo;const Qn=()=>{clearTimeout(Yo),Yo=setTimeout(()=>{Yt.getLayer(sr)&&as()},150)};Yt.once("idle",Qn),Yt.on("data",Ua=>{Ua.sourceId===qr&&Ua.isSourceLoaded&&Qn()}),Yt.on("moveend",Qn),Yt.addLayer({id:Qi,type:"symbol",source:qr,filter:["!",["has","point_count"]],layout:{"icon-image":["get","icon"],"icon-size":Pn,"icon-allow-overlap":!0,"icon-anchor":"bottom","text-field":["get","title"],"text-font":["Open Sans Bold"],"text-size":12,"text-offset":[4.2,-2],"text-anchor":"right","text-variable-anchor":["left","right"],"text-radial-offset":-3.5},paint:{"text-color":hi.text_color,"text-halo-color":"#fff","text-halo-width":1}});const ro=q.find(Ua=>Ua.id==Gt);ro&&((el=ro.name)==null?void 0:el.toLowerCase())==="pop"&&lf(Yt,Qi,qr,yi,q,ro.name),(ro&&((Mo=ro.name)==null?void 0:Mo.toLowerCase())==="data center"||((Fs=ro.name)==null?void 0:Fs.toLowerCase())==="dc"||((Jo=ro.name)==null?void 0:Jo.toLowerCase())==="splice closure"||((ea=ro.name)==null?void 0:ea.toLowerCase())==="spliceclosure"||((So=ro.name)==null?void 0:So.toLowerCase())=="equipment")&&kn(Yt,Qi,qr,yi,q,ro.name),Yt.on("click",sr,async Ua=>{bh&&bh.remove(),md&&(md.remove(),md=null);const $l=Yt.queryRenderedFeatures(Ua.point,{layers:[sr]})[0].properties.cluster_id,$a=Yt.getSource(qr);$a.getClusterLeaves($l,1/0,0,(Vl,dl)=>{if(Vl||!dl.length)return;const uh=new f0.LngLatBounds;dl.forEach(rc=>{rc.geometry&&Array.isArray(rc.geometry.coordinates)&&uh.extend(rc.geometry.coordinates)}),$a.getClusterExpansionZoom($l,(rc,Dc)=>{rc||Yt.fitBounds(uh,{padding:80,maxZoom:Math.max(Dc,14),duration:400,essential:!0})})})}),Yt.on("mouseenter",sr,()=>{Yt.getCanvas().style.cursor="pointer"}),Yt.on("mouseleave",sr,()=>{Yt.getCanvas().style.cursor=""})})};function wl(vt){return vt?vt.charAt(0).toUpperCase()+vt.slice(1):""}const Qa=async vt=>{var Tr,Bi;const Yt=new Set,Di={restoration:[],secondary:[],primary:[]};for(const Gt of vt)if(`${Gt.id}`,Gt.geometryType==="LineString"&&Gt.geometryCoordinates&&Gt.serviceOtsLink){const qr=Gt.serviceOtsLink,sr=qr.serviceId,Qi=wl(qr.pathType)+" Path",sn=Ae==null?void 0:Ae[sr];if(sn&&sn[`${Qi}`]!==!0)continue;const hi=`route-customer-${Gt.sid}`,as=`${`route-service-${qr.serviceId}`}-${hi}-${Gt.id}-home`;Yt.add(as);const Yo=Gt.geometryCoordinates.map(Jo=>[Jo[0],Jo[1]]),ro=_N(Yo);let Ao;const el={primary:"#36CC36",secondary:"#0023F5",restoration:"#505050",active:"#00A315"};if(fe&&Object.keys(fe).length>0&&fe[Gt.sid]){const Jo=wl(qr.pathType)+" Path";Ao=fe[Gt.sid][Jo]}Ao||(Ao=el[(Tr=qr.pathType)==null?void 0:Tr.toLowerCase()]||"#36CC36");const Mo={type:"Feature",id:as,geometry:ro.geometry,properties:{routeId:as,parentId:as,color:Ao||"#0023F5",pathType:((Bi=qr.pathType)==null?void 0:Bi.toLowerCase())||"primary",serviceId:qr.serviceId||"",serviceStatus:qr.serviceStatus||""}},Fs=Mo.properties.pathType;Di[Fs]?Di[Fs].push(Mo):Di.primary.push(Mo)}const yi=dt.current;["restoration","secondary","primary"].forEach(Gt=>{const qr=Di[Gt];if(!qr.length)return;const sr=`customer-line-source-${Gt}`,Qi=`customer-line-layer-${Gt}`,sn=Qi+"-clickable";yi.getSource(sr)?yi.getSource(sr).setData({type:"FeatureCollection",features:qr}):yi.addSource(sr,{type:"geojson",data:{type:"FeatureCollection",features:qr}}),yi.getLayer(Qi)||(yi.addLayer({id:Qi,type:"line",source:sr,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["linear"],["zoom"],4,4,10,6,16,9,20,16],"line-blur":1,"line-opacity":.95}}),yi.on("mouseenter",Qi,()=>{yi.getCanvas().style.cursor="pointer",yi.getCanvas().classList.add("cursor-pointer")}),yi.on("mouseleave",Qi,()=>{yi.getCanvas().style.cursor="",yi.getCanvas().classList.remove("cursor-pointer")})),yi.getLayer(sn)||(yi.addLayer({id:sn,type:"line",source:sr,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000000","line-opacity":0,"line-width":["interpolate",["linear"],["zoom"],4,10,10,15,16,20,20,22]}}),yi.on("mouseenter",sn,()=>{yi.getCanvas().style.cursor="pointer",yi.getCanvas().classList.add("cursor-pointer")}),yi.on("mouseleave",sn,()=>{yi.getCanvas().style.cursor="",yi.getCanvas().classList.remove("cursor-pointer")}),yi.on("click",sn,async hi=>{if(bh&&bh.remove(),Oh||f1)return;f1=!0;const Pn=hi.features[0].properties,as=hi.lngLat;Oh=new f0.Popup({closeOnClick:!1,closeButton:!0,offset:25}).setLngLat(as).setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header loading-text">Loading...</div></div>').addTo(yi),yi.easeTo({center:as,zoom:Math.max(yi.getZoom(),6),duration:800});try{const Yo=await CN(e,Pn.serviceId,t,Pn.pathType,Cs||"",Pn.serviceStatus,Se,ke,s,Pn.color,bt,Dt);Oh.setHTML(Yo)}catch(Yo){console.error("Popup loading failed:",Yo),Oh.setHTML('<div class="mapbox-dialog route-popup"><div class="mapbox-dialog-header">Error loading popup</div></div>')}finally{f1=!1}Oh.on("close",()=>{Oh=null})}))});const Li=new Set(WA);for(const Gt of Li)Yt.has(Gt)||(yi.getLayer(Gt)&&yi.removeLayer(Gt),yi.getLayer(Gt+"-clickable")&&yi.removeLayer(Gt+"-clickable"),yi.getSource(Gt)&&yi.removeSource(Gt),WA.delete(Gt));Object.values(Di).flat().forEach(Gt=>{WA.add(Gt.id)})},Zl=async()=>{try{const vt=dt.current;let Yt=Ps||[];ke==="customer"&&e=="dashboard"&&(Yt=Yt.filter(Li=>{var Tr;return ht.includes((Tr=Li.serviceOtsLink)==null?void 0:Tr.serviceId)}));const yi=(Yt||[]).filter(Li=>Li.serviceOtsLink).map(Li=>Li.serviceOtsLink.serviceId).map(Li=>`customer-line-layer${Li}`);if(!vt)return;const bi=vt.getStyle().layers;if(!bi)return;bi.filter(Li=>Li.id.startsWith("customer-line-layer")&&!yi.includes(Li.id)).forEach(Li=>{const Tr=Li.id+"-clickable";vt.getLayer(Tr)&&vt.removeLayer(Tr),vt.getLayer(Li.id)&&vt.removeLayer(Li.id);const Bi=Li.source;Bi&&vt.getSource(Bi)&&vt.removeSource(Bi)}),Yt.length?Qa(Yt).then(()=>{setTimeout(()=>{ps(!1)},1e3)}):(ke=="employee"&&await Fh(),os(),setTimeout(()=>{ps(!1)},1e3))}catch{}},$c=async vt=>{try{if(!ca){dt.current&&dt.current.getLayer(to)&&dt.current.removeLayer(to),dt.current&&dt.current.getSource(Xs)&&dt.current.removeSource(Xs),Ee.isSelected||ps(!1);return}if(vt){if(vt!=null&&vt.length){if(await Ll(vt),!$o&&!ja&&ca&&d&&d.length==1){ps(!1);return}if(!$o&&!ja){setTimeout(()=>{ps(!1)},2e3);return}!$o&&ja&&!Ee.isSelected&&setTimeout(()=>{ps(!1)},2e3)}}else yr!=null&&yr.length?(await Ll(yr),setTimeout(()=>{ps(!1)},2e3)):yr!=null&&yr.length||(dt.current.getLayer(to)&&dt.current.removeLayer(to),dt.current.getSource(Xs)&&dt.current.removeSource(Xs),ps(!1))}catch{ps(!1)}},vn=async()=>{qa(),await xu(ds)};function os(){const vt=dt.current;if(!vt||typeof vt.getLayer!="function")return;const Yt=vt.getStyle().layers;Yt&&Yt.filter(Di=>Di.id.includes("customer-line-layer")).forEach(Di=>{const yi=Di.id+"-clickable";vt.getLayer(yi)&&vt.removeLayer(yi),vt.getLayer(Di.id)&&vt.removeLayer(Di.id);const bi=Di.source;bi&&vt.getSource(bi)&&vt.removeSource(bi)})}function Zs(){const vt=dt.current;if(!vt)return;const Yt=vt.getStyle().layers;Yt&&Yt.filter(Di=>Di.id.includes("kmz-line-layer")).forEach(Di=>{vt.getLayer(Di.id)&&vt.removeLayer(Di.id);const yi=Di.source;yi&&vt.getSource(yi)&&vt.removeSource(yi)})}const zl=async(vt,Yt,Di)=>{const yi=dt.current;if(!yi)return;for(;!yi.isStyleLoaded();)await new Promise(Tr=>setTimeout(Tr,100));const bi=[],Li=new Set;vt.filter(Tr=>Tr.geometry&&Tr.geometry.type==="LineString"&&Array.isArray(Tr.geometry.coordinates)).forEach((Tr,Bi)=>{const Gt=Tr.geometry.coordinates.map(Pn=>[Pn[0],Pn[1]]),qr=L?L[Di].color:Yi,sr=`kmz-${Yt}-${Bi}`;bi.push({type:"Feature",id:sr,geometry:{type:"LineString",coordinates:Gt},properties:{routeId:sr,parentId:`kmz-${Yt}`,color:qr,pathType:"primary",kmzId:Di}});const Qi=dt.current,sn="kmz-line-source"+Di,hi="kmz-line-layer"+Di;if(Qi.getSource(sn)?Qi.getSource(sn).setData({type:"FeatureCollection",features:bi}):Qi.addSource(sn,{type:"geojson",data:{type:"FeatureCollection",features:bi}}),!Qi.getLayer(hi)){Qi.addLayer({id:hi,type:"line",source:sn,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["linear"],["zoom"],4,3,10,6,16,12,20,18],"line-dasharray":["case",["==",["get","pathType"],"secondary"],["literal",[2,4]],["==",["get","pathType"],"restoration"],["literal",[.1,4]],["literal",[]]]}});const Pn=new Set(BC);for(const as of Pn)Li.has(as)||(Qi.getLayer(as)&&Qi.removeLayer(as),Qi.getSource(as)&&Qi.removeSource(as),BC.delete(as));bi.forEach(as=>BC.add(as.id))}})};function bu(vt){const Yt=vt.match(/\/([^\/]+\.kmz|[^\/]+\.kml)(\/|$)/i);return Yt?Yt[1]:null}const Ks=async vt=>{const Yt=await Promise.all(vt==null?void 0:vt.map(async Di=>{const yi=await Th(Di==null?void 0:Di.fileUrl,bu(Di==null?void 0:Di.fileUrl));return{id:Di.id,kmzJson:yi}}));Yt&&Yt.length>0&&Yt.forEach(async Di=>{var Li;const yi=Di==null?void 0:Di.id,bi=(Li=Di==null?void 0:Di.kmzJson)==null?void 0:Li.features.filter(Tr=>Tr.geometry.type==="LineString");bi&&bi.length>0&&(await zl(bi,`line-${yi}`,`${yi}`),setTimeout(()=>{Ha()},500))})},xd=wo([]),ju=async()=>{try{const vt=dt.current;if(!vt)return;const Yt=(pr||[]).map(Tr=>Tr.id),Di=xd.current||[];Di.filter(Tr=>!Yt.includes(Tr)).forEach(Tr=>{const Bi=`kmz-line-layer${Tr}`,Gt=`kmz-line-source${Tr}`;vt.getLayer(Bi)&&vt.removeLayer(Bi),vt.getSource(Gt)&&vt.removeSource(Gt),BC.delete(Bi)});const bi=Yt.filter(Tr=>!Di.includes(Tr)),Li=pr.filter(Tr=>bi.includes(Tr.id));Li.length&&await Ks(Li),Yt.length||Zs(),xd.current=Yt}catch{}},Hu=async vt=>{if(!vt)return;vt.getZoom()>14&&vt.setZoom(14)},Sl=vt=>{gs(vt.target.value)};Ar(()=>{bs||(gs(""),ui.current&&window.$&&window.$(ui.current).data("select2")&&window.$(ui.current).val("").trigger("change"))},[bs]),Ar(()=>{if(!rr.current){rr.current=!0;return}const vt=dt.current;if(!vt)return;const Yt=gi.current.filter(Li=>{var Gt;const Tr=Li.properties.cable_type==="Overhead"&&zn||Li.properties.cable_type==="Underground"&&Ln,Bi=Li.properties.Ownership==="Own"&&Ls||Li.properties.Ownership==="Third Party"&&bs;if(Tn){const qr=Array.isArray(Li.properties.deviceTypeAttr)?(Gt=Li.properties.deviceTypeAttr.find(sr=>sr.attrName==="vendor_name"))==null?void 0:Gt.attrValue:"";return Ls&&Li.properties.Ownership==="Own"||bs&&Li.properties.Ownership==="Third Party"&&qr===Tn?Tr&&Bi:Tr&&Bi&&qr===Tn}else return Tr&&Bi}),Di={Overhead_Own:0,"Overhead_Third Party":0,Underground_Own:0,"Underground_Third Party":0,Total:0};Yt.forEach(Li=>{var qr;const Tr=`${Li.properties.cable_type}_${Li.properties.Ownership}`,Bi=(Array.isArray(Li.properties.deviceTypeAttr)?(qr=Li.properties.deviceTypeAttr.find(sr=>sr.attrName==="cable_calculated_length"))==null?void 0:qr.attrValue:0)||0,Gt=parseFloat(Bi)||0;Di[Tr]!==void 0&&(Di[Tr]+=Gt),Di.Total+=Gt});const yi=gi.current.filter(Li=>{const Tr=Li.properties.cable_type==="Overhead"&&zn||Li.properties.cable_type==="Underground"&&Ln,Bi=Li.properties.Ownership==="Own"&&Ls||Li.properties.Ownership==="Third Party"&&bs;return Tr&&Bi}).map(Li=>{var Tr;return Array.isArray(Li.properties.deviceTypeAttr)?(Tr=Li.properties.deviceTypeAttr.find(Bi=>Bi.attrName==="third_party_vendor_name"))==null?void 0:Tr.attrValue:void 0}).filter(Li=>Li!=null&&Li!==""),bi=Array.from(new Set(yi));ft(bi),pt(Di),vt.getSource(Xs)&&vt.getSource(Xs).setData({type:"FeatureCollection",features:Yt})},[zn,Ln,Ls,bs,Tn]),Ar(()=>(gs(""),md&&(md.remove(),md=null),ui.current&&window.$&&window.$(ui.current).data("select2")&&window.$(ui.current).val("").trigger("change"),e!=="service details"&&(qn(!0),ma(!0),qo(!0),za(!0),bh&&bh.remove(),ps(!0),Vt.current&&clearTimeout(Vt.current),Vt.current=setTimeout(()=>{if(p1){const vt=async()=>{await Tc(),setTimeout(async()=>{await Ha()},200)};S&&Array.isArray(S)&&S.length>0&&vt()}else{const vt=()=>{if(d&&d.length>0){const Di=nn.current||[],yi=Di.filter(Li=>!S.includes(Li));yi.forEach(Li=>{Xc(Li)}),yi.length>0&&is(Li=>{const Tr={...Li};return yi.forEach(Bi=>{delete Tr[Bi]}),Tr}),S.filter(Li=>!Di.includes(Li)).length>0&&(GA=!0,Qh(1)),nn.current=S}ps(!0),yr.length===0?(Aa(!0),kr(1)):(ps(!0),$c().then(async()=>{setTimeout(async()=>{await Ha()},500)}))},Yt=async()=>{dt.current.getLayer(to)&&dt.current.removeLayer(to),dt.current.getSource(Xs)&&dt.current.removeSource(Xs),bh=null,ft([]),pt({Overhead_Own:0,"Overhead_Third Party":0,Underground_Own:0,"Underground_Third Party":0,Total:0})};S&&Array.isArray(S)&&S.length>0?vt():(ps(!1),Yt(),nn.current=[],dt.current&&vd(),is({}),(async()=>await Ha())())}Xl(!1)},300)),()=>{Vt.current&&clearTimeout(Vt.current)}),[S]),Ar(()=>{e!="service details"&&ju()},[pr]),Ar(()=>{if(e!="service details")return async()=>{p1=!0,await cae("constlServices")}},[]),Ar(()=>{(()=>{!Pt&&ke==="customer"&&(ps(!0),Zl()),ke=="employee"&&(ps(!0),Zl())})()},[Ps]),Ar(()=>{const vt=()=>{document.fullscreenElement||G(!0)},Yt=Di=>{Di.key==="Escape"&&G(!0)};return document.addEventListener("fullscreenchange",vt),document.addEventListener("keydown",Yt),()=>{document.removeEventListener("fullscreenchange",vt),document.removeEventListener("keydown",Yt)}},[]),Ar(()=>{(async()=>{try{const[Yt,Di]=await Promise.all([fetch("/o/krypton-employee-map-cx/india-composite.geojson",{cache:"reload"}),fetch("/o/krypton-employee-map-cx/india_states.geojson",{cache:"reload"})]);if(!Yt.ok||!Di.ok)throw new Error("Failed to load GeoJSON");const yi=await Yt.json(),bi=await Di.json();ii(yi),Yr(bi)}catch(Yt){console.error("Error loading GeoJSON:",Yt)}})()},[]),Ar(()=>{const vt=dt.current;if(!vt)return;const Yt=new Eoe([{title:"Default",uri:ul},{title:"Light",uri:"mapbox://styles/mapbox/light-v10"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"},{title:"Satellite",uri:Uc}],{showTitle:!1,eventListeners:{onChange:()=>{fi(!0)}},defaultStyle:Yc}),Di=()=>{try{vt.removeControl(Yt)}catch{}vt.addControl(Yt,"top-right"),setTimeout(()=>{const yi=document.querySelector(".Default");yi&&yi.classList.add("active")},100)};return vt.on("load",Di),()=>{vt.off("load",Di),vt.removeControl(Yt)}},[dt,Yc]),Ar(()=>{let vt;function Yt(){const Di=document.querySelector(".mapboxgl-style-switcher");return Di&&!Di.classList.contains("custom-tooltip")?(Di.classList.add("custom-tooltip"),Di.setAttribute("title","Map Gallery"),!0):!1}if(!Yt())return vt=new MutationObserver(()=>{Yt()&&vt&&vt.disconnect()}),vt.observe(document.body,{childList:!0,subtree:!0}),()=>{vt&&vt.disconnect()}},[Yc]),Ar(()=>{const vt=document.getElementsByClassName("custom-tooltip"),Yt=Array.from(vt).map(Di=>new window.bootstrap.Tooltip(Di));return()=>{Yt.forEach(Di=>Di.dispose())}},[]),Ar(()=>{const vt=dt.current;if(!vt)return;const Yt=()=>{ch(!0)},Di=(Tr,Bi)=>{const Gt=vt.getZoom();if(Gt>=Tr)return;const qr=Math.min(Tr,Gt+4);vt.easeTo({center:Bi,zoom:qr,duration:200,essential:!0})},yi=Tr=>{Tr.preventDefault();const Bi=vt.getZoom();vt.unproject([Tr.clientX,Tr.clientY]);let Gt=Bi+2;Gt=Math.max(vt.getMinZoom(),Math.min(vt.getMaxZoom(),Gt));const qr=vt.getCenter();Di(Gt,[qr.lng,qr.lat])},bi=Tr=>{Tr.preventDefault();const Bi=vt.getZoom();vt.unproject([Tr.clientX,Tr.clientY]);const Gt=Tr.deltaY<0?2:-2;let qr=Bi+Gt;qr=Math.max(vt.getMinZoom(),Math.min(vt.getMaxZoom(),qr));const sr=vt.getCenter();vt.easeTo({center:[sr.lng,sr.lat],zoom:qr,essential:!0})},Li=vt.getContainer();return Li.addEventListener("wheel",bi,{passive:!1}),Li.addEventListener("dblclick",yi,{passive:!1}),vt.on("load",Yt),vt.on("style.load",Yt),()=>{vt.off("load",Yt),vt.off("style.load",Yt),Li.removeEventListener("wheel",bi),Li.removeEventListener("dblclick",yi)}},[dt]),Ar(()=>{const vt=dt.current;if(!vt)return;const Yt=()=>{vt.getSource("composite")&&(vt.getLayer("3d-buildings")||vt.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":["case",["has","colour"],["get","colour"],"#d1d1d1"],"fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.9}}))};return vt.on("style.load",Yt),vt.isStyleLoaded()&&Yt(),()=>{if(!(!vt||vt._removed)){vt.off("style.load",Yt);try{vt.getLayer("3d-buildings")&&vt.removeLayer("3d-buildings")}catch(Di){console.warn("Cleanup failed:",Di)}}}},[dt]),Ar(()=>{const vt=()=>{const bi=document.getElementsByClassName("mapboxgl-ctrl-icon");return Array.from(bi).forEach(Tr=>{Tr.setAttribute("data-bs-toggle","tooltip")}),Array.from(bi).map(Tr=>new window.bootstrap.Tooltip(Tr))},Yt=dt.current;if(!Yt)return;let Di=[];const yi=()=>{Di=vt()};return Yt.on("load",yi),Yt.on("style.load",yi),Di=vt(),()=>{Yt.off("load",yi),Yt.off("style.load",yi),Di.forEach(bi=>bi.dispose())}},[dt]),Ar(()=>{const vt=dt.current;if(!vt)return;const Yt=()=>{Oi.current||(Oi.current=!0,["state-boundaries","india-border-shadow-inner","india-border-shadow-outer"].forEach(Di=>{vt.getLayer(Di)&&vt.removeLayer(Di)}),["india-geojson","india-states"].forEach(Di=>{vt.getSource(Di)&&vt.removeSource(Di)}),vt.addSource("india-geojson",{type:"geojson",data:ln}),vt.addSource("india-states",{type:"geojson",data:Qr}),vt.addLayer({id:"india-border-shadow-outer",type:"line",source:"india-geojson",paint:{"line-color":(document.querySelector(".theme-dark"),"#68388b"),"line-width":2,"line-opacity":.05,"line-translate":[1,1]}}),vt.addLayer({id:"india-border-shadow-inner",type:"line",source:"india-geojson",paint:{"line-color":(document.querySelector(".theme-dark"),"#b57edc"),"line-width":2,"line-opacity":.6,"line-translate":[1,1]}}),vt.addLayer({id:"state-boundaries",type:"line",source:"india-states",paint:{"line-color":(document.querySelector(".theme-dark"),"#b57edc"),"line-width":1,"line-opacity":.6}}),$u(!0))};return vt.on("style.load",Yt),vt.loaded()?Yt():vt.on("load",Yt),()=>{vt.off("style.load",Yt),vt.off("load",Yt),Oi.current=!1}},[dt]),Ar(()=>{ja&&e=="dashboard"&&Mr>1&&d&&d.length>0&&ke!="customer"&&Qh(Mr)},[Mr]),Ar(()=>{Ye&&e=="dashboard"&&Jt>0&&Ie&&Ie.length==2&&ke!="customer"&&(Jt==1&&mi([]),Vf(Jt))},[Ie,Jt]),uu(ui,Sl,[]);const Ja=gi.current.some(vt=>vt.properties.cable_type==="Overhead"),Gu=gi.current.some(vt=>vt.properties.cable_type==="Underground"),zh=gi.current.some(vt=>vt.properties.Ownership==="Own"),Ch=gi.current.some(vt=>vt.properties.Ownership==="Third Party"),hh=S.length>0;return B.createElement(B.Fragment,null,mt&&B.createElement("div",{class:`cable-dropdown ${vi?"show":""}`,ref:ur},B.createElement("button",{type:"button",className:"custom-tooltip cable-btn","data-bs-toggle":"tooltip","data-placement":"top",disabled:!ca,onClick:()=>{Oh&&Oh.remove(),bh&&bh.remove(),Ge(Yt=>!Yt);const vt=document.querySelector(".cable-dropdown .btn");vt&&nr(vt.offsetLeft-260)},title:"Cables"},B.createElement("div",{class:"filterIcon"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"filter_alt"))),B.createElement("div",{class:`dropdown-menu cable-dropdown-click ${vi?"show":""}`,style:Ht!==null?{left:Ht}:{},onClick:vt=>vt.stopPropagation()},B.createElement("div",{class:"dropdown-inner"},B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Cables"),B.createElement("div",{class:"legend-section-content"},B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("label",null,"Type"),B.createElement("div",{className:"custom-control-inline-row "},B.createElement("div",{className:"custom-control  custom-control-inline white-space-nowrap"},B.createElement("div",{className:!Ja||!hh?"disabled":""},B.createElement("input",{type:"checkbox",className:"cable-checkbox",id:"overhead",style:{marginRight:"8px"},checked:zn,onChange:vt=>za(vt.target.checked),disabled:!Ja||!hh}),B.createElement("span",{className:"legend-label"},"Overhead"))),B.createElement("div",{className:"ccustom-control  custom-control-inline white-space-nowrap"},B.createElement("div",{className:!Gu||!hh?"disabled":""},B.createElement("input",{type:"checkbox",className:"cable-checkbox",id:"underground",style:{marginRight:"8px"},checked:Ln,onChange:vt=>qo(vt.target.checked),disabled:!Gu||!hh}),B.createElement("span",{className:"legend-label"},"Underground")))))),B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("label",null,"Ownership"),B.createElement("div",{className:"custom-control-inline-row"},B.createElement("div",{class:"custom-control  custom-control-inline white-space-nowrap"},B.createElement("div",{className:!zh||!hh?"disabled":""},B.createElement("input",{type:"checkbox",className:"cable-checkbox",id:"own",style:{marginRight:"8px"},checked:Ls,onChange:vt=>ma(vt.target.checked),disabled:!zh||!hh}),B.createElement("span",{className:"legend-label"},"Own"))),B.createElement("div",{class:"custom-control  custom-control-inline white-space-nowrap"},B.createElement("div",{className:!Ch||!hh?"disabled":""},B.createElement("input",{type:"checkbox",className:"cable-checkbox",id:"third-party",style:{marginRight:"8px"},checked:bs,onChange:vt=>qn(vt.target.checked),disabled:!Ch||!hh}),B.createElement("span",{className:"legend-label"},"Third-Party"))),B.createElement("div",{className:"custom-control  custom-control-inline w-100"},B.createElement("div",{className:`d-block ${!Ch||!hh?"disabled":""}`},B.createElement("select",{className:`custom-select d-none ${!Ch||!hh?"disabled":""}`,name:"vendor",id:"vendor",ref:ui,value:Tn,onChange:Sl,disabled:!bs},B.createElement("option",{value:""},"Vendor Name"),xt&&xt.length>0?xt.map(vt=>B.createElement("option",{key:vt,value:vt},vt)):B.createElement("option",{disabled:!0},"No Vendor Available"))))))),B.createElement("div",{className:"col-12"},B.createElement("div",{className:"form-group"},B.createElement("label",{className:"border-heading"},"Cable Length"),B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Overhead (Own)"),B.createElement("div",{className:"value"},Lt.Overhead_Own.toFixed(2)," ","kms"))),B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Overhead (Third-Party)"),B.createElement("div",{className:"value"},Lt["Overhead_Third Party"].toFixed(2)," ","kms"))),B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Underground (Own)"),B.createElement("div",{className:"value"},Lt.Underground_Own.toFixed(2)," ","kms"))),B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"title"},"Underground (Third-Party)"),B.createElement("div",{className:"value"},Lt["Underground_Third Party"].toFixed(2)," ","kms"))),B.createElement("div",{className:"col-12"},B.createElement("div",{className:"form-group-view"},B.createElement("div",{className:"value text-left"},"Total"),B.createElement("div",{className:"value"},B.createElement("span",{className:"legend-value pl-1"},Lt.Total.toFixed(2)," ","kms"))))))))))))),B.createElement("div",{class:`legend-dropdown ${bl?"show":""}`,ref:ei},B.createElement("button",{type:"button",className:"custom-tooltip legend-btn","data-bs-toggle":"tooltip","data-placement":"top",onClick:()=>{Un(Yt=>!Yt);const vt=document.querySelector(".legend-dropdown .btn");vt&&St(vt.offsetLeft-260)},title:"Legends"},B.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B.createElement("path",{d:"M3 5.5H13",stroke:"black","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M18.6 16.8926C17.5333 17.607 17 17.9642 17 18.5C17 19.0358 17.5333 19.393 18.6 20.1074C19.6667 20.8218 20.2 21.1789 20.6 20.9111C21 20.6432 21 19.9288 21 18.5C21 17.0712 21 16.3568 20.6 16.0889C20.2 15.8211 19.6667 16.1782 18.6 16.8926Z",stroke:"black","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M18.6 3.89263C17.5333 4.60702 17 4.96421 17 5.5C17 6.03579 17.5333 6.39298 18.6 7.10737C19.6667 7.82176 20.2 8.17895 20.6 7.91105C21 7.64316 21 6.92877 21 5.5C21 4.07123 21 3.35684 20.6 3.08895C20.2 2.82105 19.6667 3.17824 18.6 3.89263Z",stroke:"black","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M3 12H13",stroke:"black","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M3 18.5H13",stroke:"black","stroke-width":"1.5","stroke-linecap":"round"}))),B.createElement("div",{class:`dropdown-menu legend-dropdown-click ${bl?"show":""}`,style:pi!==null?{left:pi}:{},onClick:vt=>vt.stopPropagation()},B.createElement("div",{class:"dropdown-inner"},ke==="customer"&&e=="dashboard"&&Array.isArray(Bs)&&Bs.length===0&&B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Services"),B.createElement("div",{class:"legend-section-content"},B.createElement("div",{className:"alert alert-info mt-3"},"Currently no legend available."))),ke==="customer"&&e=="dashboard"&&((Bs==null?void 0:Bs.some(vt=>typeof vt.externalReferenceId=="string"&&vt.externalReferenceId.includes("PLC")))||(Bs==null?void 0:Bs.some(vt=>typeof vt.externalReferenceId=="string"&&vt.externalReferenceId.includes("DFC"))))&&B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Services"),B.createElement("div",{class:"legend-section-content"},B.createElement("ul",null,(Bs==null?void 0:Bs.some(vt=>typeof vt.externalReferenceId=="string"&&vt.externalReferenceId.includes("PLC")))&&B.createElement("li",{class:"header-title"},"Private Line",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}}),B.createElement("span",{className:"legend-label"}," Primary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#0023F5"}}),B.createElement("span",{className:"legend-label"}," Secondary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#505050"}}),B.createElement("span",{className:"legend-label"}," Tertiary")))),(Bs==null?void 0:Bs.some(vt=>typeof vt.externalReferenceId=="string"&&vt.externalReferenceId.includes("DFC")))&&B.createElement("li",{class:"header-title"},"Dark Fiber",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}})," ",B.createElement("span",{className:"legend-label"}," Primary"))))))),ke==="customer"&&e=="service details"&&(Il("id")&&(Il("id").includes("PLC")||Il("id").includes("DFC"))||Il("entityDetailId")&&(Il("entityDetailId").includes("PLC")||Il("entityDetailId").includes("DFC")))&&B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Services"),B.createElement("div",{class:"legend-section-content"},B.createElement("ul",null,(Il("id")&&Il("id").includes("PLC")||Il("entityDetailId")&&Il("entityDetailId").includes("PLC"))&&B.createElement("li",{class:"header-title"},"Private Line",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}}),B.createElement("span",{className:"legend-label"}," Primary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#0023F5"}}),B.createElement("span",{className:"legend-label"}," Secondary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#505050"}}),B.createElement("span",{className:"legend-label"}," Tertiary")))),(Il("id")&&Il("id").includes("DFC")||Il("entityDetailId")&&Il("entityDetailId").includes("DFC"))&&B.createElement("li",{class:"header-title"},"Dark Fiber",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}})," ",B.createElement("span",{className:"legend-label"}," Primary"))))))),ke==="employee"&&B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Services"),B.createElement("div",{class:"legend-section-content"},B.createElement("ul",null,B.createElement("li",{class:"header-title"},"Private Line",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}}),B.createElement("span",{className:"legend-label"}," Primary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#0023F5"}}),B.createElement("span",{className:"legend-label"}," Secondary")),B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#505050"}}),B.createElement("span",{className:"legend-label"}," Tertiary")))),B.createElement("li",{class:"header-title"},"Dark Fiber",B.createElement("ul",{class:"sub-listing-item"},B.createElement("li",null,B.createElement("div",{class:"legend-line solid-line mr-2",style:{backgroundColor:"#36CC36"}})," ",B.createElement("span",{className:"legend-label"}," Primary"))))))),q.some(vt=>vt.hasPermission)&&B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Elements"),B.createElement("div",{class:"legend-section-content"},B.createElement("ul",null,q.filter(vt=>vt.hasPermission).map(vt=>B.createElement("li",{class:"elements-item"},B.createElement("img",{src:vt.iconURL,alt:"",style:{width:"24px",height:"24px",marginRight:"8px",verticalAlign:"middle"}})," ",vt.name," ")))))))),B.createElement("button",{onClick:fh,"data-bs-toggle":"tooltip","data-placement":"top",className:"fullscreen-btn custom-tooltip",title:At?"Maximize":"Minimize"},B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("path",{d:"M352.2 425.8l-79.2 79.2c-9.4 9.4-24.6 9.4-33.9 0l-79.2-79.2c-15.1-15.1-4.4-41 17-41h51.2L228 284H127.2v51.2c0 21.4-25.9 32.1-41 17L7 272.9c-9.4-9.4-9.4-24.6 0-33.9L86.2 159.8c15.1-15.1 41-4.4 41 17V228H228V127.2h-51.2c-21.4 0-32.1-25.9-17-41l79.2-79.2c9.4-9.4 24.6-9.4 33.9 0l79.2 79.2c15.1 15.1 4.4 41-17 41h-51.2V228h100.8v-51.2c0-21.4 25.9-32.1 41-17l79.2 79.2c9.4 9.4 9.4 24.6 0 33.9L425.8 352.2c-15.1 15.1-41 4.4-41-17V284H284v100.8h51.2c21.4 0 32.1 25.9 17 41z"}))),B.createElement("button",{onClick:Nh,className:"map-home-btn custom-tooltip",title:"Home","data-bs-toggle":"tooltip","data-placement":"top"},B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},B.createElement("path",{d:"M543.8 287.6c17 0 32-14 32-32.1c1-9-3-17-11-24L512 185l0-121c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32l0 36.7L309.5 7c-6-5-14-7-21-7s-15 1-22 8L10 231.5c-7 7-10 15-10 24c0 18 14 32.1 32 32.1l32 0 0 69.7c-.1 .9-.1 1.8-.1 2.8l0 112c0 22.1 17.9 40 40 40l16 0c1.2 0 2.4-.1 3.6-.2c1.5 .1 3 .2 4.5 .2l31.9 0 24 0c22.1 0 40-17.9 40-40l0-24 0-64c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 64 0 24c0 22.1 17.9 40 40 40l24 0 32.5 0c1.4 0 2.8 0 4.2-.1c1.1 .1 2.2 .1 3.3 .1l16 0c22.1 0 40-17.9 40-40l0-16.2c.3-2.6 .5-5.3 .5-8.1l-.7-160.2 32 0z"}))),B.createElement("div",{ref:Kt,className:"mapbox-wrap loader_wrap"},ra&&B.createElement("div",{className:"alert alert-info mt-3"},"No service topology data available."),!la&&B.createElement("div",{className:"loader"}),B.createElement("div",{className:"mapboxgl-map",id:"map",ref:Zt}),lh&&B.createElement("div",{className:"loader"})),tc&&B.createElement("div",{className:"modal theme-modal d-block custom-modal",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},B.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:Wu},B.createElement("span",{className:"material-symbols-outlined constl-icon"},""))),B.createElement("div",{className:"modal-body"},B.createElement("div",{className:"ticket-details-success"},B.createElement("div",{className:"details"},"No valid route or marker features to export.")))))))});async function pae(e,t,n,s){var f,i,S;let a;n=="service details"&&s=="customer"?a=document.getElementsByTagName("krypton-service-details-cx"):s=="customer"&&n=="dashboard"?(a=document.getElementsByTagName("krypton-dashboard-cx"),(!a||a.length==0)&&(a=document.getElementsByTagName("krypton-custom-dashboard-cx"))):s=="employee"&&n=="dashboard"&&(a=document.getElementsByTagName("krypton-employee-map-cx"));let d=a[0].getAttribute("data-gisServiceImpactedTicketConfig");if(d!=null&&d!=null){const E=atob(d),L=JSON.parse(E),F=L.entityData;if(L.serviceIdMappingFieldName,F){const G=F.restBuilderApiURL,q=F.propsData,Q=q.filters;Array.isArray(Q)&&(Q.forEach(Ee=>{Array.isArray(Ee.fields)&&Ee.fields.forEach(Ie=>{Ie.key=="customerAccountNo"&&(Ie.value=`'${t}'`),Ie.key=="externalRefEntityId"&&(Ie.value=`'${e}'`)})}),q.filters=Q);const he=JSON.stringify(q),fe=btoa(he),le=Liferay.ThemeDisplay.getSiteGroupId(),Se=`${G}?propsData=${fe}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${le}`,ke=await Yoe(Se);if(ke&&((f=ke==null?void 0:ke.data)!=null&&f.items)&&((i=ke==null?void 0:ke.data)==null?void 0:i.items.length)>0)return!1;if(ke&&((S=ke==null?void 0:ke.data)!=null&&S.errMessage)||ke&&Array.isArray(ke.data)&&ke.data.length==0)return!0}}}async function fae(e,t,n){if(e){const s=JSON.parse(e),a=n,d=s.find(Ye=>Ye.attrName=="total_core"),f=d?d.attrValue:"N/A",i=s.find(Ye=>Ye.attrName=="no_of_core_per_tube"),S=i?i.attrValue:"N/A",E=s.find(Ye=>Ye.attrName=="cable_calculated_length");E&&E.attrValue;const L=s.find(Ye=>Ye.attrName=="no_of_tube");L&&L.attrValue;const F=s.find(Ye=>Ye.attrName=="vendor_name");F&&F.attrValue;const G=s.find(Ye=>Ye.attrName=="cable_name"),q=G?G.attrValue:"N/A",Q=s.find(Ye=>Ye.attrName=="project_code"),te=Q?Q.attrValue:"N/A",he=s.find(Ye=>Ye.attrName=="district_name"),fe=he?he.attrValue:"N/A",le=s.find(Ye=>Ye.attrName=="third_party_vendor_name"),Se=le?le.attrValue:"N/A",ke=s.find(Ye=>Ye.attrName=="block_name"),Ee=ke?ke.attrValue:"N/A",Ie=s.find(Ye=>Ye.attrName=="cable_type"),He=Ie?Ie.attrValue:"N/A";return`
   <div class="mapbox-dialog-constl">
  <div class="mapbox-dialog-header-constl">
    <div class="mapbox-dialog-heading-constl">Cable Information</div>
  </div>
  <div class="mapbox-dialog-body-constl">
    <div class="row">
        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">Cable Name:</div>
                <div class="value"> ${q}</div>
            </div>
        </div>
        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">Project Code:</div>
                <div class="value">${te}</div>
            </div>
        </div>
        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">District Name/Block Name:</div>
                <div class="value">${fe} (${Ee})</div>
            </div>
        </div>

        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">No. of cores per tube(s):</div>
                <div class="value">${S}</div>
            </div>
        </div>
        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">Total core(s):</div>
                <div class="value">${f}</div>
            </div>
        </div>
        <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">Ownership:</div>
                <div class="value">${a}</div>
            </div>
        </div>
        ${a&&a.toLowerCase()!=="own"?`<div class="col-md-6 mb-15">
          <div class="form-group-view">
            <div class="title">Third Party Vendor Name:</div>
            <div class="value">${Se}</div>
          </div>
        </div>`:""}

         <div class="col-md-6 mb-15">
            <div class="form-group-view">
                <div class="title">Cable Type:</div>
                <div class="value">${He}</div>
            </div>
        </div>

       
    </div>
  </div>
</div>`}else return`
     <div class="mapbox-dialog-constl">
  <div class="mapbox-dialog-header-constl">
    <div class="mapbox-dialog-heading-constl">Cable Information</div>
  </div>
  <div class="mapbox-dialog-body-constl">
    <div class="row">
        <div class="col-md-12 mb-15">
           <div class="noRecordFound">No record available</div>
        </div>
    </div>
  </div>
</div>`}async function CN(e,t,n,s,a,d,f,i,S,E,L,F){var ke,Ee,Ie,He;const G=t.includes("PLC")?"Private Line":"Dark Fiber";let q="",Q;e=="service details"?await c2(t,L,F).then(Ye=>{Ye&&Ye.data&&Ye.data.length>0&&(Q=Ye.data[0].customerAccountNo)}):await c2(t,L,F).then(Ye=>{Ye&&Ye.data&&Ye.data.length>0&&(Q=Ye.data[0].customerAccountNo)});const te=Liferay.ThemeDisplay.getLayoutRelativeURL();let he=Liferay.ThemeDisplay.getUserId();const fe=new URLSearchParams(te.split("?")[1]||"").get("doAsUserId")||"";let le;fe?le=`id=${t}&productName=${G}&customerAccountNo=${Q}&tab=${G}&doAsUserId=${he}`:le=`id=${t}&productName=${G}&customerAccountNo=${Q}&tab=${G}`;const Se=await pae(t,Q,e,i);if(G=="Private Line"){const Ye=await Goe(t,Q);let lt=(Ye==null?void 0:Ye.data)||{};return e=="dashboard"&&(i=="employee"||(q=`
        <div class="mapbox-dialog-footer mt-3">
            <button class="button button-icon-text" onClick="window.location.href='${a}/service-details?${le}'">
              <img src=${vN} alt="" /> View Detail
            </button>
        </div>`)),`
    <div class="mapbox-dialog route-popup">
      <div class="mapbox-dialog-header">
        <div class="route-details">${t} - ${((ke=lt==null?void 0:lt.aendLocation)==null?void 0:ke.buildingName)||"N/A"} to ${((Ee=lt==null?void 0:lt.zendLocation)==null?void 0:Ee.buildingName)||"N/A"}
        ${Se?`<span class="status-active text-success">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 13V8H15" stroke="#14B268" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 8L15 13C14.1174 13.8826 13.6762 14.3238 13.1346 14.3726C13.045 14.3807 12.955 14.3807 12.8654 14.3726C12.3238 14.3238 11.8826 13.8826 11 13C10.1174 12.1174 9.67615 11.6762 9.13457 11.6274C9.04504 11.6193 8.95496 11.6193 8.86543 11.6274C8.32385 11.6762 7.88256 12.1174 7 13L4 16" stroke="#14B268" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg> UP
            </span>`:`<span class="status-inactive text-danger">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 11V16H15" stroke="#F04438" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 16L15 11C14.1174 10.1174 13.6762 9.67615 13.1346 9.62737C13.045 9.6193 12.955 9.6193 12.8654 9.62737C12.3238 9.67615 11.8826 10.1174 11 11C10.1174 11.8826 9.67615 12.3238 9.13457 12.3726C9.04504 12.3807 8.95496 12.3807 8.86543 12.3726C8.32385 12.3238 7.88256 11.8826 7 11L4 8" stroke="#F04438" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg> Down
            </span>`}

        </div>
        <div class="line-details">${G} - ${(lt==null?void 0:lt.bandwidth)||""}</div>
      </div>
      <div class="mapbox-dialog-body">
        <ul class="routes-details mb-3">
            ${s=="primary"?qA("Primary Path",(lt==null?void 0:lt.mainRoutes)||[],E):""}
            ${s=="secondary"?qA("Secondary Path",(lt==null?void 0:lt.secondaryRoutes)||[],E):""}
            ${s=="restoration"?qA("Restoration Path",(lt==null?void 0:lt.restorationRoutes)||[],E):""}
        </ul>
      </div>
      ${q}
    </div>`}else if(G=="Dark Fiber"){const Ye=await WB(t,"darkFiber",Q);let lt=(Ie=Ye==null?void 0:Ye.data)==null?void 0:Ie.items,Pt,At,ht,Ot;return lt&&(ht=lt==null?void 0:lt.sourceEndName,Ot=lt==null?void 0:lt.destinationEndName,(He=lt==null?void 0:lt.serviceCharacteristic)!=null&&He.length&&lt.serviceCharacteristic.forEach(Ae=>{switch(Ae==null?void 0:Ae.name){case"sourceEndSite":Pt=Ae==null?void 0:Ae.value;break;case"destinationEndSite":At=Ae==null?void 0:Ae.value;break}})),e=="dashboard"&&(i=="employee"||(q=`
        <div class="mapbox-dialog-footer mt-3">
            <button class="button button-icon-text" onClick="window.location.href='${a}/service-details?${le}'">
              <img src=${vN} alt="" /> View Detail
            </button>
        </div>`)),`
    <div class="mapbox-dialog route-popup">
      <div class="mapbox-dialog-header">
        <div class="route-details">${t} - ${ht||"N/A"} to ${Ot||"N/A"}
        ${Se?`<span class="status-active text-success">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 13V8H15" stroke="#14B268" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 8L15 13C14.1174 13.8826 13.6762 14.3238 13.1346 14.3726C13.045 14.3807 12.955 14.3807 12.8654 14.3726C12.3238 14.3238 11.8826 13.8826 11 13C10.1174 12.1174 9.67615 11.6762 9.13457 11.6274C9.04504 11.6193 8.95496 11.6193 8.86543 11.6274C8.32385 11.6762 7.88256 12.1174 7 13L4 16" stroke="#14B268" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg> UP
            </span>`:`<span class="status-inactive text-danger">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 11V16H15" stroke="#F04438" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 16L15 11C14.1174 10.1174 13.6762 9.67615 13.1346 9.62737C13.045 9.6193 12.955 9.6193 12.8654 9.62737C12.3238 9.67615 11.8826 10.1174 11 11C10.1174 11.8826 9.67615 12.3238 9.13457 12.3726C9.04504 12.3807 8.95496 12.3807 8.86543 12.3726C8.32385 12.3238 7.88256 11.8826 7 11L4 8" stroke="#F04438" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg> Down
            </span>`}

        </div>
      </div>
         <div class="mapbox-dialog-body">
        <ul class="routes-details mb-3">
            ${mae("Primary Path",Pt,At,E,ht,Ot)}
        </ul>
      </div>
   
      ${q}
    </div>`}}function mae(e,t,n,s,a,d){let f="<div class='noRecordFound' > No data available </div>";return!t&&!n?`
    <li>
      <div class="route-box">
          
        <div class="route-title"><span class="route-icon-display" style="background-color: ${s};"></span>${e}</div>
         ${f}
      </div>
    </li>`:((t||n)&&(f=`
      <div class="route-point">
        <span>${a} (${t||"N/A"})</span>
      </div>
      <div class="route-point">
        <span>${d} (${n||"N/A"})</span>
      </div>
    `),`
    <li>
      <div class="route-box">
          
        <div class="route-title"><span class="route-icon-display" style="background-color: ${s};"></span>${e}</div>
        <div class="route-points">
          ${f}
        </div>
      </div>
    </li>`)}function qA(e,t,n){var a;let s="";if(Array.isArray(t)&&t.length>0){const d=(a=t[0])==null?void 0:a.oms;Array.isArray(d)&&d.length>0?s=d.map(f=>`
        <div class="route-point">
            <span>${(f==null?void 0:f.buildingName)||"N/A"}, ${(f==null?void 0:f.city)||"N/A"}</span>
        </div>
      `).join(""):s=""}return`
    <li>
      <div class="route-box">
          
           <div class="route-title"><span class="route-icon-display" style="background-color: ${n};"></span>  ${e==="Restoration Path"?"Tertiary Path":e}</div>
         ${s?`<div class="route-points">${s}</div>`:`<div class="route-points"><div class='noRecordFound' > No data available </div></div>`}
      </div>
    </li>`}function yk(){return(yk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function T$(e,t){if(e==null)return{};var n,s,a={},d=Object.keys(e);for(s=0;s<d.length;s++)t.indexOf(n=d[s])>=0||(a[n]=e[n]);return a}function bI(e){var t=wo(e),n=wo(function(s){t.current&&t.current(s)});return t.current=e,n.current}var rT=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},PS=function(e){return"touches"in e},wI=function(e){return e&&e.ownerDocument.defaultView||self},EN=function(e,t,n){var s=e.getBoundingClientRect(),a=PS(t)?function(d,f){for(var i=0;i<d.length;i++)if(d[i].identifier===f)return d[i];return d[0]}(t.touches,n):t;return{left:rT((a.pageX-(s.left+wI(e).pageXOffset))/s.width),top:rT((a.pageY-(s.top+wI(e).pageYOffset))/s.height)}},kN=function(e){!PS(e)&&e.preventDefault()},C$=B.memo(function(e){var t=e.onMove,n=e.onKey,s=T$(e,["onMove","onKey"]),a=wo(null),d=bI(t),f=bI(n),i=wo(null),S=wo(!1),E=nW(function(){var q=function(he){kN(he),(PS(he)?he.touches.length>0:he.buttons>0)&&a.current?d(EN(a.current,he,i.current)):te(!1)},Q=function(){return te(!1)};function te(he){var fe=S.current,le=wI(a.current),Se=he?le.addEventListener:le.removeEventListener;Se(fe?"touchmove":"mousemove",q),Se(fe?"touchend":"mouseup",Q)}return[function(he){var fe=he.nativeEvent,le=a.current;if(le&&(kN(fe),!function(ke,Ee){return Ee&&!PS(ke)}(fe,S.current)&&le)){if(PS(fe)){S.current=!0;var Se=fe.changedTouches||[];Se.length&&(i.current=Se[0].identifier)}le.focus(),d(EN(le,fe,i.current)),te(!0)}},function(he){var fe=he.which||he.keyCode;fe<37||fe>40||(he.preventDefault(),f({left:fe===39?.05:fe===37?-.05:0,top:fe===40?.05:fe===38?-.05:0}))},te]},[f,d]),L=E[0],F=E[1],G=E[2];return Ar(function(){return G},[G]),B.createElement("div",yk({},s,{onTouchStart:L,onMouseDown:L,className:"react-colorful__interactive",ref:a,onKeyDown:F,tabIndex:0,role:"slider"}))}),xD=function(e){return e.filter(Boolean).join(" ")},E$=function(e){var t=e.color,n=e.left,s=e.top,a=s===void 0?.5:s,d=xD(["react-colorful__pointer",e.className]);return B.createElement("div",{className:d,style:{top:100*a+"%",left:100*n+"%"}},B.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},sf=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},gae=function(e){return bae(SI(e))},SI=function(e){return e[0]==="#"&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?sf(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:e.length===8?sf(parseInt(e.substring(6,8),16)/255,2):1}},yae=function(e){return xae(vae(e))},_ae=function(e){var t=e.s,n=e.v,s=e.a,a=(200-t)*n/100;return{h:sf(e.h),s:sf(a>0&&a<200?t*n/100/(a<=100?a:200-a)*100:0),l:sf(a/2),a:sf(s,2)}},TI=function(e){var t=_ae(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},vae=function(e){var t=e.h,n=e.s,s=e.v,a=e.a;t=t/360*6,n/=100,s/=100;var d=Math.floor(t),f=s*(1-n),i=s*(1-(t-d)*n),S=s*(1-(1-t+d)*n),E=d%6;return{r:sf(255*[s,i,f,f,S,s][E]),g:sf(255*[S,s,s,i,f,f][E]),b:sf(255*[f,f,S,s,s,i][E]),a:sf(a,2)}},FC=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},xae=function(e){var t=e.r,n=e.g,s=e.b,a=e.a,d=a<1?FC(sf(255*a)):"";return"#"+FC(t)+FC(n)+FC(s)+d},bae=function(e){var t=e.r,n=e.g,s=e.b,a=e.a,d=Math.max(t,n,s),f=d-Math.min(t,n,s),i=f?d===t?(n-s)/f:d===n?2+(s-t)/f:4+(t-n)/f:0;return{h:sf(60*(i<0?i+6:i)),s:sf(d?f/d*100:0),v:sf(d/255*100),a}},wae=B.memo(function(e){var t=e.hue,n=e.onChange,s=xD(["react-colorful__hue",e.className]);return B.createElement("div",{className:s},B.createElement(C$,{onMove:function(a){n({h:360*a.left})},onKey:function(a){n({h:rT(t+360*a.left,0,360)})},"aria-label":"Hue","aria-valuenow":sf(t),"aria-valuemax":"360","aria-valuemin":"0"},B.createElement(E$,{className:"react-colorful__hue-pointer",left:t/360,color:TI({h:t,s:100,v:100,a:1})})))}),Sae=B.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:TI({h:t.h,s:100,v:100,a:1})};return B.createElement("div",{className:"react-colorful__saturation",style:s},B.createElement(C$,{onMove:function(a){n({s:100*a.left,v:100-100*a.top})},onKey:function(a){n({s:rT(t.s+100*a.left,0,100),v:rT(t.v-100*a.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+sf(t.s)+"%, Brightness "+sf(t.v)+"%"},B.createElement(E$,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:TI(t)})))}),k$=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0},Tae=function(e,t){return e.toLowerCase()===t.toLowerCase()||k$(SI(e),SI(t))};function Cae(e,t,n){var s=bI(n),a=It(function(){return e.toHsva(t)}),d=a[0],f=a[1],i=wo({color:t,hsva:d});Ar(function(){if(!e.equal(t,i.current.color)){var E=e.toHsva(t);i.current={hsva:E,color:t},f(E)}},[t,e]),Ar(function(){var E;k$(d,i.current.hsva)||e.equal(E=e.fromHsva(d),i.current.color)||(i.current={hsva:d,color:E},s(E))},[d,e,s]);var S=U3(function(E){f(function(L){return Object.assign({},L,E)})},[]);return[d,S]}var Eae=typeof window<"u"?sW:Ar,kae=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},AN=new Map,Aae=function(e){Eae(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!AN.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,AN.set(t,n);var s=kae();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},Mae=function(e){var t=e.className,n=e.colorModel,s=e.color,a=s===void 0?n.defaultColor:s,d=e.onChange,f=T$(e,["className","colorModel","color","onChange"]),i=wo(null);Aae(i);var S=Cae(n,a,d),E=S[0],L=S[1],F=xD(["react-colorful",t]);return B.createElement("div",yk({},f,{ref:i,className:F}),B.createElement(Sae,{hsva:E,onChange:L}),B.createElement(wae,{hue:E.h,onChange:L,className:"react-colorful__last-control"}))},Iae={defaultColor:"000",toHsva:gae,fromHsva:function(e){return yae({h:e.h,s:e.s,v:e.v,a:1})},equal:Tae},Lae=function(e){return B.createElement(Mae,yk({},e,{colorModel:Iae}))},_k={},A$={exports:{}},Dae="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Pae=Dae,Oae=Pae;function M$(){}function I$(){}I$.resetWarningCache=M$;var Rae=function(){function e(s,a,d,f,i,S){if(S!==Oae){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:I$,resetWarningCache:M$};return n.PropTypes=n,n};A$.exports=Rae();var uw=A$.exports,Sb={};Object.defineProperty(Sb,"__esModule",{value:!0});Sb.default=void 0;function Nae(e){if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=Bae(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(S){throw S},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,d=!1,f;return{s:function(){s=e[Symbol.iterator]()},n:function(){var S=s.next();return a=S.done,S},e:function(S){d=!0,f=S},f:function(){try{!a&&s.return!=null&&s.return()}finally{if(d)throw f}}}}function Bae(e,t){if(e){if(typeof e=="string")return MN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MN(e,t)}}function MN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Fae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function zae(e,t,n){return t&&IN(e.prototype,t),n&&IN(e,n),e}var Uae=function(){function e(){Fae(this,e)}return zae(e,null,[{key:"innerWidth",value:function(n){if(n){var s=n.offsetWidth,a=getComputedStyle(n);return s+=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight),s}return 0}},{key:"width",value:function(n){if(n){var s=n.offsetWidth,a=getComputedStyle(n);return s-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight),s}return 0}},{key:"getWindowScrollTop",value:function(){var n=document.documentElement;return(window.pageYOffset||n.scrollTop)-(n.clientTop||0)}},{key:"getWindowScrollLeft",value:function(){var n=document.documentElement;return(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}},{key:"getOuterWidth",value:function(n,s){if(n){var a=n.offsetWidth;if(s){var d=getComputedStyle(n);a+=parseFloat(d.marginLeft)+parseFloat(d.marginRight)}return a}return 0}},{key:"getOuterHeight",value:function(n,s){if(n){var a=n.offsetHeight;if(s){var d=getComputedStyle(n);a+=parseFloat(d.marginTop)+parseFloat(d.marginBottom)}return a}return 0}},{key:"getClientHeight",value:function(n,s){if(n){var a=n.clientHeight;if(s){var d=getComputedStyle(n);a+=parseFloat(d.marginTop)+parseFloat(d.marginBottom)}return a}return 0}},{key:"getViewport",value:function(){var n=window,s=document,a=s.documentElement,d=s.getElementsByTagName("body")[0],f=n.innerWidth||a.clientWidth||d.clientWidth,i=n.innerHeight||a.clientHeight||d.clientHeight;return{width:f,height:i}}},{key:"getOffset",value:function(n){if(n){var s=n.getBoundingClientRect();return{top:s.top+document.body.scrollTop,left:s.left+document.body.scrollLeft}}return{top:"auto",left:"auto"}}},{key:"generateZIndex",value:function(){return this.zindex=this.zindex||999,++this.zindex}},{key:"getCurrentZIndex",value:function(){return this.zindex}},{key:"index",value:function(n){if(n)for(var s=n.parentNode.childNodes,a=0,d=0;d<s.length;d++){if(s[d]===n)return a;s[d].nodeType===1&&a++}return-1}},{key:"addMultipleClasses",value:function(n,s){if(n)if(n.classList)for(var a=s.split(" "),d=0;d<a.length;d++)n.classList.add(a[d]);else for(var f=s.split(" "),i=0;i<f.length;i++)n.className+=" "+f[i]}},{key:"addClass",value:function(n,s){n&&(n.classList?n.classList.add(s):n.className+=" "+s)}},{key:"removeClass",value:function(n,s){n&&(n.classList?n.classList.remove(s):n.className=n.className.replace(new RegExp("(^|\\b)"+s.split(" ").join("|")+"(\\b|$)","gi")," "))}},{key:"hasClass",value:function(n,s){if(n)return n.classList?n.classList.contains(s):new RegExp("(^| )"+s+"( |$)","gi").test(n.className)}},{key:"find",value:function(n,s){return n?Array.from(n.querySelectorAll(s)):[]}},{key:"findSingle",value:function(n,s){return n?n.querySelector(s):null}},{key:"getHeight",value:function(n){if(n){var s=n.offsetHeight,a=getComputedStyle(n);return s-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom)+parseFloat(a.borderTopWidth)+parseFloat(a.borderBottomWidth),s}return 0}},{key:"getWidth",value:function(n){if(n){var s=n.offsetWidth,a=getComputedStyle(n);return s-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight)+parseFloat(a.borderLeftWidth)+parseFloat(a.borderRightWidth),s}return 0}},{key:"absolutePosition",value:function(n,s){if(n){var a=n.offsetParent?{width:n.offsetWidth,height:n.offsetHeight}:this.getHiddenElementDimensions(n),d=a.height,f=a.width,i=s.offsetHeight,S=s.offsetWidth,E=s.getBoundingClientRect(),L=this.getWindowScrollTop(),F=this.getWindowScrollLeft(),G=this.getViewport(),q,Q;E.top+i+d>G.height?(q=E.top+L-d,q<0&&(q=L)):q=i+E.top+L,E.left+S+f>G.width?Q=Math.max(0,E.left+F+S-f):Q=E.left+F,n.style.top=q+"px",n.style.left=Q+"px"}}},{key:"relativePosition",value:function(n,s){if(n){var a=n.offsetParent?{width:n.offsetWidth,height:n.offsetHeight}:this.getHiddenElementDimensions(n),d=s.offsetHeight,f=s.getBoundingClientRect(),i=this.getViewport(),S,E;f.top+d+a.height>i.height?(S=-1*a.height,f.top+S<0&&(S=-1*f.top)):S=d,a.width>i.width?E=f.left*-1:f.left+a.width>i.width?E=(f.left+a.width-i.width)*-1:E=0,n.style.top=S+"px",n.style.left=E+"px"}}},{key:"getHiddenElementOuterHeight",value:function(n){if(n){n.style.visibility="hidden",n.style.display="block";var s=n.offsetHeight;return n.style.display="none",n.style.visibility="visible",s}return 0}},{key:"getHiddenElementOuterWidth",value:function(n){if(n){n.style.visibility="hidden",n.style.display="block";var s=n.offsetWidth;return n.style.display="none",n.style.visibility="visible",s}return 0}},{key:"getHiddenElementDimensions",value:function(n){var s={};return n&&(n.style.visibility="hidden",n.style.display="block",s.width=n.offsetWidth,s.height=n.offsetHeight,n.style.display="none",n.style.visibility="visible"),s}},{key:"fadeIn",value:function(n,s){if(n){n.style.opacity=0;var a=+new Date,d=0,f=function i(){d=+n.style.opacity+(new Date().getTime()-a)/s,n.style.opacity=d,a=+new Date,+d<1&&(window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16))};f()}}},{key:"fadeOut",value:function(n,s){if(n)var a=1,d=50,f=s,i=d/f,S=setInterval(function(){a-=i,a<=0&&(a=0,clearInterval(S)),n.style.opacity=a},d)}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"isIOS",value:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}},{key:"isAndroid",value:function(){return/(android)/i.test(navigator.userAgent)}},{key:"appendChild",value:function(n,s){if(this.isElement(s))s.appendChild(n);else if(s.el&&s.el.nativeElement)s.el.nativeElement.appendChild(n);else throw new Error("Cannot append "+s+" to "+n)}},{key:"scrollInView",value:function(n,s){var a=getComputedStyle(n).getPropertyValue("borderTopWidth"),d=a?parseFloat(a):0,f=getComputedStyle(n).getPropertyValue("paddingTop"),i=f?parseFloat(f):0,S=n.getBoundingClientRect(),E=s.getBoundingClientRect(),L=E.top+document.body.scrollTop-(S.top+document.body.scrollTop)-d-i,F=n.scrollTop,G=n.clientHeight,q=this.getOuterHeight(s);L<0?n.scrollTop=F+L:L+q>G&&(n.scrollTop=F+L-G+q)}},{key:"clearSelection",value:function(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().rangeCount>0&&window.getSelection().getRangeAt(0).getClientRects().length>0&&window.getSelection().removeAllRanges();else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch{}}},{key:"calculateScrollbarWidth",value:function(n){if(n){var s=getComputedStyle(n);return n.offsetWidth-n.clientWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.borderRightWidth)}else{if(this.calculatedScrollbarWidth!=null)return this.calculatedScrollbarWidth;var a=document.createElement("div");a.className="p-scrollbar-measure",document.body.appendChild(a);var d=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),this.calculatedScrollbarWidth=d,d}}},{key:"getBrowser",value:function(){if(!this.browser){var n=this.resolveUserAgent();this.browser={},n.browser&&(this.browser[n.browser]=!0,this.browser.version=n.version),this.browser.chrome?this.browser.webkit=!0:this.browser.webkit&&(this.browser.safari=!0)}return this.browser}},{key:"resolveUserAgent",value:function(){var n=navigator.userAgent.toLowerCase(),s=/(chrome)[ ]([\w.]+)/.exec(n)||/(webkit)[ ]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ ]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:s[1]||"",version:s[2]||"0"}}},{key:"isVisible",value:function(n){return n&&n.offsetParent!=null}},{key:"getFocusableElements",value:function(n){var s=e.find(n,`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), 
                [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), 
                input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), 
                textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), 
                [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])`),a=[],d=Nae(s),f;try{for(d.s();!(f=d.n()).done;){var i=f.value;getComputedStyle(i).display!=="none"&&getComputedStyle(i).visibility!=="hidden"&&a.push(i)}}catch(S){d.e(S)}finally{d.f()}return a}}]),e}();Sb.default=Uae;var dw={};Object.defineProperty(dw,"__esModule",{value:!0});dw.default=void 0;function ib(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ib=function(n){return typeof n}:ib=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ib(e)}function $ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Vae(e,t,n){return t&&LN(e.prototype,t),n&&LN(e,n),e}var Wae=function(){function e(){$ae(this,e)}return Vae(e,null,[{key:"equals",value:function(n,s,a){return a&&n&&ib(n)==="object"&&s&&ib(s)==="object"?this.resolveFieldData(n,a)===this.resolveFieldData(s,a):this.deepEquals(n,s)}},{key:"deepEquals",value:function(n,s){if(n===s)return!0;if(n&&s&&ib(n)=="object"&&ib(s)=="object"){var a=Array.isArray(n),d=Array.isArray(s),f,i,S;if(a&&d){if(i=n.length,i!==s.length)return!1;for(f=i;f--!==0;)if(!this.deepEquals(n[f],s[f]))return!1;return!0}if(a!==d)return!1;var E=n instanceof Date,L=s instanceof Date;if(E!==L)return!1;if(E&&L)return n.getTime()===s.getTime();var F=n instanceof RegExp,G=s instanceof RegExp;if(F!==G)return!1;if(F&&G)return n.toString()===s.toString();var q=Object.keys(n);if(i=q.length,i!==Object.keys(s).length)return!1;for(f=i;f--!==0;)if(!Object.prototype.hasOwnProperty.call(s,q[f]))return!1;for(f=i;f--!==0;)if(S=q[f],!this.deepEquals(n[S],s[S]))return!1;return!0}return n!==n&&s!==s}},{key:"resolveFieldData",value:function(n,s){if(n&&s){if(this.isFunction(s))return s(n);if(s.indexOf(".")===-1)return n[s];for(var a=s.split("."),d=n,f=0,i=a.length;f<i;++f){if(d==null)return null;d=d[a[f]]}return d}else return null}},{key:"isFunction",value:function(n){return!!(n&&n.constructor&&n.call&&n.apply)}},{key:"findDiffKeys",value:function(n,s){return!n||!s?{}:Object.keys(n).filter(function(a){return!s.hasOwnProperty(a)}).reduce(function(a,d){return a[d]=n[d],a},{})}},{key:"reorderArray",value:function(n,s,a){var d;if(n&&s!==a){if(a>=n.length)for(d=a-n.length;d--+1;)n.push(void 0);n.splice(a,0,n.splice(s,1)[0])}}},{key:"findIndexInList",value:function(n,s){var a=-1;if(s){for(var d=0;d<s.length;d++)if(s[d]===n){a=d;break}}return a}},{key:"getJSXElement",value:function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),d=1;d<s;d++)a[d-1]=arguments[d];return this.isFunction(n)?n.apply(void 0,a):n}},{key:"removeAccents",value:function(n){return n&&n.search(/[\xC0-\xFF]/g)>-1&&(n=n.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),n}}]),e}();dw.default=Wae;var vk={};Object.defineProperty(vk,"__esModule",{value:!0});vk.default=void 0;var ng=jae(dw);function jae(e){return e&&e.__esModule?e:{default:e}}function DN(e){if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=Hae(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(S){throw S},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,d=!1,f;return{s:function(){s=e[Symbol.iterator]()},n:function(){var S=s.next();return a=S.done,S},e:function(S){d=!0,f=S},f:function(){try{!a&&s.return!=null&&s.return()}finally{if(d)throw f}}}}function Hae(e,t){if(e){if(typeof e=="string")return PN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PN(e,t)}}function PN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Gae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ON(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function qae(e,t,n){return t&&ON(e.prototype,t),n&&ON(e,n),e}var Yae=function(){function e(){Gae(this,e)}return qae(e,null,[{key:"filter",value:function(n,s,a,d,f){var i=[],S=ng.default.removeAccents(a).toLocaleLowerCase(f);if(n){var E=DN(n),L;try{for(E.s();!(L=E.n()).done;){var F=L.value,G=DN(s),q;try{for(G.s();!(q=G.n()).done;){var Q=q.value,te=ng.default.removeAccents(String(ng.default.resolveFieldData(F,Q))).toLocaleLowerCase(f);if(e[d](te,S,f)){i.push(F);break}}}catch(he){G.e(he)}finally{G.f()}}}catch(he){E.e(he)}finally{E.f()}}return i}},{key:"startsWith",value:function(n,s,a){if(s==null||s.trim()==="")return!0;if(n==null)return!1;var d=ng.default.removeAccents(s.toString()).toLocaleLowerCase(a),f=ng.default.removeAccents(n.toString()).toLocaleLowerCase(a);return f.slice(0,d.length)===d}},{key:"contains",value:function(n,s,a){if(s==null||typeof s=="string"&&s.trim()==="")return!0;if(n==null)return!1;var d=ng.default.removeAccents(s.toString()).toLocaleLowerCase(a),f=ng.default.removeAccents(n.toString()).toLocaleLowerCase(a);return f.indexOf(d)!==-1}},{key:"endsWith",value:function(n,s,a){if(s==null||s.trim()==="")return!0;if(n==null)return!1;var d=ng.default.removeAccents(s.toString()).toLocaleLowerCase(a),f=ng.default.removeAccents(n.toString()).toLocaleLowerCase(a);return f.indexOf(d,f.length-d.length)!==-1}},{key:"equals",value:function(n,s,a){return s==null||typeof s=="string"&&s.trim()===""?!0:n==null?!1:n.getTime&&s.getTime?n.getTime()===s.getTime():ng.default.removeAccents(n.toString()).toLocaleLowerCase(a)===ng.default.removeAccents(s.toString()).toLocaleLowerCase(a)}},{key:"notEquals",value:function(n,s,a){return s==null||typeof s=="string"&&s.trim()===""?!1:n==null?!0:n.getTime&&s.getTime?n.getTime()!==s.getTime():ng.default.removeAccents(n.toString()).toLocaleLowerCase(a)!==ng.default.removeAccents(s.toString()).toLocaleLowerCase(a)}},{key:"in",value:function(n,s,a){if(s==null||s.length===0)return!0;if(n==null)return!1;for(var d=0;d<s.length;d++)if(ng.default.equals(n,s[d]))return!0;return!1}},{key:"lt",value:function(n,s,a){return s==null||s.trim&&s.trim().length===0?!0:n==null?!1:n.getTime&&s.getTime?n.getTime()<s.getTime():n<parseFloat(s)}},{key:"lte",value:function(n,s,a){return s==null||s.trim&&s.trim().length===0?!0:n==null?!1:n.getTime&&s.getTime?n.getTime()<=s.getTime():n<=parseFloat(s)}},{key:"gt",value:function(n,s,a){return s==null||s.trim&&s.trim().length===0?!0:n==null?!1:n.getTime&&s.getTime?n.getTime()>s.getTime():n>parseFloat(s)}},{key:"gte",value:function(n,s,a){return s==null||s.trim&&s.trim().length===0?!0:n==null?!1:n.getTime&&s.getTime?n.getTime()>=s.getTime():n>=parseFloat(s)}}]),e}();vk.default=Yae;var L$={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function n(){for(var d="",f=0;f<arguments.length;f++){var i=arguments[f];i&&(d=a(d,s(i)))}return d}function s(d){if(typeof d=="string"||typeof d=="number")return d;if(typeof d!="object")return"";if(Array.isArray(d))return n.apply(null,d);if(d.toString!==Object.prototype.toString&&!d.toString.toString().includes("[native code]"))return d.toString();var f="";for(var i in d)t.call(d,i)&&d[i]&&(f=a(f,i));return f}function a(d,f){return f?d?d+" "+f:d+f:d}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(L$);var OT=L$.exports;const of=w_(OT);var xk={};Object.defineProperty(xk,"__esModule",{value:!0});xk.MultiSelectPanel=void 0;var zC=Zae(B),UC=D$(uw),Xae=D$(M2);function D$(e){return e&&e.__esModule?e:{default:e}}function P$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return P$=function(){return e},e}function Zae(e){if(e&&e.__esModule)return e;if(e===null||OS(e)!=="object"&&typeof e!="function")return{default:e};var t=P$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function OS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?OS=function(n){return typeof n}:OS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},OS(e)}function Kae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Qae(e,t,n){return t&&RN(e.prototype,t),n&&RN(e,n),e}function Jae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&CI(e,t)}function CI(e,t){return CI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},CI(e,t)}function ele(e){var t=rle();return function(){var n=h2(e),s;if(t){var a=h2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return tle(this,s)}}function tle(e,t){return t&&(OS(t)==="object"||typeof t=="function")?t:ile(e)}function ile(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rle(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function h2(e){return h2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},h2(e)}function O$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bD=function(e){Jae(n,e);var t=ele(n);function n(){return Kae(this,n),t.apply(this,arguments)}return Qae(n,[{key:"renderElement",value:function(){var a=this;return zC.default.createElement("div",{className:"p-multiselect-panel p-hidden p-input-overlay",ref:function(f){return a.element=f},onClick:this.props.onClick},this.props.header,zC.default.createElement("div",{className:"p-multiselect-items-wrapper",style:{maxHeight:this.props.scrollHeight}},zC.default.createElement("ul",{className:"p-multiselect-items p-multiselect-list p-component",role:"listbox","aria-multiselectable":!0},this.props.children)))}},{key:"render",value:function(){var a=this.renderElement();return this.props.appendTo?Xae.default.createPortal(a,this.props.appendTo):a}}]),n}(zC.Component);xk.MultiSelectPanel=bD;O$(bD,"defaultProps",{appendTo:null,header:null,onClick:null,scrollHeight:null});O$(bD,"propTypes",{appendTo:UC.default.object,header:UC.default.any,onClick:UC.default.func,scrollHeight:UC.default.string});var bk={};Object.defineProperty(bk,"__esModule",{value:!0});bk.MultiSelectItem=void 0;var m1=nle(B),jx=R$(uw),YA=R$(OT);function R$(e){return e&&e.__esModule?e:{default:e}}function N$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return N$=function(){return e},e}function nle(e){if(e&&e.__esModule)return e;if(e===null||RS(e)!=="object"&&typeof e!="function")return{default:e};var t=N$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function RS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?RS=function(n){return typeof n}:RS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},RS(e)}function sle(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function NN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function ole(e,t,n){return t&&NN(e.prototype,t),n&&NN(e,n),e}function ale(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&EI(e,t)}function EI(e,t){return EI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},EI(e,t)}function lle(e){var t=hle();return function(){var n=u2(e),s;if(t){var a=u2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return cle(this,s)}}function cle(e,t){return t&&(RS(t)==="object"||typeof t=="function")?t:kI(e)}function kI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hle(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function u2(e){return u2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},u2(e)}function B$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wD=function(e){ale(n,e);var t=lle(n);function n(){var s;return sle(this,n),s=t.call(this),s.onClick=s.onClick.bind(kI(s)),s.onKeyDown=s.onKeyDown.bind(kI(s)),s}return ole(n,[{key:"onClick",value:function(a){this.props.onClick&&this.props.onClick({originalEvent:a,option:this.props.option}),a.preventDefault()}},{key:"onKeyDown",value:function(a){this.props.onKeyDown&&this.props.onKeyDown({originalEvent:a,option:this.props.option})}},{key:"render",value:function(){var a=(0,YA.default)(this.props.option.className,"p-multiselect-item",{"p-highlight":this.props.selected}),d=(0,YA.default)("p-checkbox-box p-component",{"p-highlight":this.props.selected}),f=(0,YA.default)("p-checkbox-icon p-c",{"pi pi-check":this.props.selected}),i=this.props.template?this.props.template(this.props.option):this.props.label;return m1.default.createElement("li",{className:a,onClick:this.onClick,tabIndex:this.props.tabIndex,onKeyDown:this.onKeyDown,role:"option","aria-selected":this.props.selected},m1.default.createElement("div",{className:"p-checkbox p-component"},m1.default.createElement("div",{className:d},m1.default.createElement("span",{className:f}))),m1.default.createElement("label",null,i))}}]),n}(m1.Component);bk.MultiSelectItem=wD;B$(wD,"defaultProps",{option:null,label:null,selected:!1,tabIndex:null,template:null,onClick:null,onKeyDown:null});B$(wD,"propTypes",{option:jx.default.object,label:jx.default.string,selected:jx.default.bool,tabIndex:jx.default.string,template:jx.default.func,onClick:jx.default.func,onKeyDown:jx.default.func});var wk={},Sk={},Tk={};Object.defineProperty(Tk,"__esModule",{value:!0});Tk.default=void 0;var $C=ule(Sb);function ule(e){return e&&e.__esModule?e:{default:e}}function dle(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function ple(e,t,n){return t&&BN(e.prototype,t),n&&BN(e,n),e}function SD(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ck=function(){function e(){dle(this,e)}return ple(e,null,[{key:"isNavKeyPress",value:function(n){var s=n.keyCode;return s=$C.default.getBrowser().safari&&e.SAFARI_KEYS[s]||s,s>=33&&s<=40||s===e.KEYS.RETURN||s===e.KEYS.TAB||s===e.KEYS.ESC}},{key:"isSpecialKey",value:function(n){var s=n.keyCode;return s===9||s===13||s===27||s===16||s===17||s>=18&&s<=20||$C.default.getBrowser().opera&&!n.shiftKey&&(s===8||s>=33&&s<=35||s>=36&&s<=39||s>=44&&s<=45)}},{key:"getKey",value:function(n){var s=n.keyCode||n.charCode;return $C.default.getBrowser().safari&&e.SAFARI_KEYS[s]||s}},{key:"getCharCode",value:function(n){return n.charCode||n.keyCode||n.which}},{key:"onKeyPress",value:function(n,s,a){if(!a){var d=e.DEFAULT_MASKS[s]?e.DEFAULT_MASKS[s]:s,f=$C.default.getBrowser();if(!(n.ctrlKey||n.altKey)){var i=this.getKey(n);if(!(f.mozilla&&(this.isNavKeyPress(n)||i===e.KEYS.BACKSPACE||i===e.KEYS.DELETE&&n.charCode===0))){var S=this.getCharCode(n),E=String.fromCharCode(S);f.mozilla&&(this.isSpecialKey(n)||!E)||d.test(E)||n.preventDefault()}}}}},{key:"validate",value:function(n,s){var a=n.target.value,d=!0;return a&&!s.test(a)&&(d=!1),d}}]),e}();Tk.default=Ck;SD(Ck,"DEFAULT_MASKS",{pint:/[\d]/,int:/[\d\-]/,pnum:/[\d\.]/,money:/[\d\.\s,]/,num:/[\d\-\.]/,hex:/[0-9a-f]/i,email:/[a-z0-9_\.\-@]/i,alpha:/[a-z_]/i,alphanum:/[a-z0-9_]/i});SD(Ck,"KEYS",{TAB:9,RETURN:13,ESC:27,BACKSPACE:8,DELETE:46});SD(Ck,"SAFARI_KEYS",{63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35});var pw={};Object.defineProperty(pw,"__esModule",{value:!0});pw.default=void 0;var ap=fle(Sb);function fle(e){return e&&e.__esModule?e:{default:e}}function mle(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function gle(e,t,n){return t&&FN(e.prototype,t),n&&FN(e,n),e}var yle=function(){function e(t){mle(this,e),this.target=t.target,this.targetContainer=t.targetContainer,this.content=t.content,this.options=t.options||{},this.options.event=this.options.event||"hover",this.options.position=this.options.position||"right",this.bindEvents()}return gle(e,[{key:"bindEvents",value:function(){this.options.event==="hover"?(this.mouseEnterListener=this.onMouseEnter.bind(this),this.mouseLeaveListener=this.onMouseLeave.bind(this),this.clickListener=this.onClick.bind(this),this.target.addEventListener("mouseenter",this.mouseEnterListener),this.target.addEventListener("mouseleave",this.mouseLeaveListener),this.target.addEventListener("click",this.clickListener)):this.options.event==="focus"&&(this.focusListener=this.onFocus.bind(this),this.blurListener=this.onBlur.bind(this),this.target.addEventListener("focus",this.focusListener),this.target.addEventListener("blur",this.blurListener))}},{key:"unbindEvents",value:function(){this.options.event==="hover"?(this.target.removeEventListener("mouseenter",this.mouseEnterListener),this.target.removeEventListener("mouseleave",this.mouseLeaveListener),this.target.removeEventListener("click",this.clickListener)):this.options.event==="focus"&&(this.target.removeEventListener("focus",this.focusListener),this.target.removeEventListener("blur",this.blurListener)),this.unbindDocumentResizeListener()}},{key:"onMouseEnter",value:function(){!this.container&&!this.showTimeout&&this.activate()}},{key:"onMouseLeave",value:function(){this.deactivate()}},{key:"onFocus",value:function(){this.activate()}},{key:"onBlur",value:function(){this.deactivate()}},{key:"onClick",value:function(){this.deactivate()}},{key:"activate",value:function(){var n=this;this.clearHideTimeout(),this.options.showDelay?this.showTimeout=setTimeout(function(){n.show()},this.options.showDelay):this.show()}},{key:"deactivate",value:function(){var n=this;this.clearShowTimeout(),this.options.hideDelay?this.hideTimeout=setTimeout(function(){n.hide()},this.options.hideDelay):this.hide()}},{key:"clearShowTimeout",value:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}},{key:"clearHideTimeout",value:function(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}},{key:"clearTimeouts",value:function(){this.clearShowTimeout(),this.clearHideTimeout()}},{key:"updateContent",value:function(n){this.content=n}},{key:"show",value:function(){this.content&&(this.create(),this.align(),ap.default.fadeIn(this.container,250),this.container.style.zIndex=++ap.default.zindex,this.bindDocumentResizeListener())}},{key:"hide",value:function(){this.remove()}},{key:"create",value:function(){this.container=document.createElement("div");var n=document.createElement("div");n.className="p-tooltip-arrow",this.container.appendChild(n),this.tooltipText=document.createElement("div"),this.tooltipText.className="p-tooltip-text",this.tooltipText.innerHTML=this.content,this.container.appendChild(this.tooltipText),document.body.appendChild(this.container),this.container.style.display="inline-block"}},{key:"remove",value:function(){this.container&&this.container.parentElement&&document.body.removeChild(this.container),this.unbindDocumentResizeListener(),this.clearTimeouts(),this.container=null}},{key:"align",value:function(){switch(this.options.position){case"top":this.alignTop(),this.isOutOfBounds()&&this.alignBottom();break;case"bottom":this.alignBottom(),this.isOutOfBounds()&&this.alignTop();break;case"left":this.alignLeft(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()));break;case"right":this.alignRight(),this.isOutOfBounds()&&(this.alignLeft(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()));break;default:throw new Error("Invalid position:"+this.options.position)}}},{key:"getHostOffset",value:function(){var n=this.targetContainer||this.target,s=n.getBoundingClientRect(),a=s.left+ap.default.getWindowScrollLeft(),d=s.top+ap.default.getWindowScrollTop();return{left:a,top:d}}},{key:"alignRight",value:function(){this.preAlign("right");var n=this.targetContainer||this.target,s=this.getHostOffset(),a=s.left+ap.default.getOuterWidth(n),d=s.top+(ap.default.getOuterHeight(n)-ap.default.getOuterHeight(this.container))/2;this.container.style.left=a+"px",this.container.style.top=d+"px"}},{key:"alignLeft",value:function(){this.preAlign("left");var n=this.targetContainer||this.target,s=this.getHostOffset(),a=s.left-ap.default.getOuterWidth(this.container),d=s.top+(ap.default.getOuterHeight(n)-ap.default.getOuterHeight(this.container))/2;this.container.style.left=a+"px",this.container.style.top=d+"px"}},{key:"alignTop",value:function(){this.preAlign("top");var n=this.targetContainer||this.target,s=this.getHostOffset(),a=s.left+(ap.default.getOuterWidth(n)-ap.default.getOuterWidth(this.container))/2,d=s.top-ap.default.getOuterHeight(this.container);this.container.style.left=a+"px",this.container.style.top=d+"px"}},{key:"alignBottom",value:function(){this.preAlign("bottom");var n=this.targetContainer||this.target,s=this.getHostOffset(),a=s.left+(ap.default.getOuterWidth(n)-ap.default.getOuterWidth(this.container))/2,d=s.top+ap.default.getOuterHeight(n);this.container.style.left=a+"px",this.container.style.top=d+"px"}},{key:"preAlign",value:function(n){this.container.style.left="-999px",this.container.style.top="-999px";var s="p-tooltip p-component p-tooltip-"+n;this.container.className=this.options.className?s+" "+this.options.className:s}},{key:"isOutOfBounds",value:function(){var n=this.container.getBoundingClientRect(),s=n.top,a=n.left,d=ap.default.getOuterWidth(this.container),f=ap.default.getOuterHeight(this.container),i=ap.default.getViewport();return a+d>i.width||a<0||s<0||s+f>i.height}},{key:"bindDocumentResizeListener",value:function(){this.resizeListener=this.onWindowResize.bind(this),window.addEventListener("resize",this.resizeListener)}},{key:"unbindDocumentResizeListener",value:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)}},{key:"onWindowResize",value:function(){this.hide()}},{key:"destroy",value:function(){this.unbindEvents(),this.remove(),this.target=null,this.targetContainer=null}}]),e}();pw.default=yle;Object.defineProperty(Sk,"__esModule",{value:!0});Sk.InputText=void 0;var zN=ble(B),g1=fw(uw),_le=fw(OT),UN=fw(Tk),vle=fw(pw),$N=fw(Sb),xle=fw(dw);function fw(e){return e&&e.__esModule?e:{default:e}}function F$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return F$=function(){return e},e}function ble(e){if(e&&e.__esModule)return e;if(e===null||NS(e)!=="object"&&typeof e!="function")return{default:e};var t=F$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function NS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?NS=function(n){return typeof n}:NS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},NS(e)}function AI(){return AI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},AI.apply(this,arguments)}function wle(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Sle(e,t,n){return t&&VN(e.prototype,t),n&&VN(e,n),e}function Tle(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&MI(e,t)}function MI(e,t){return MI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},MI(e,t)}function Cle(e){var t=kle();return function(){var n=d2(e),s;if(t){var a=d2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return Ele(this,s)}}function Ele(e,t){return t&&(NS(t)==="object"||typeof t=="function")?t:II(e)}function II(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kle(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function d2(e){return d2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},d2(e)}function z$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var TD=function(e){Tle(n,e);var t=Cle(n);function n(s){var a;return wle(this,n),a=t.call(this,s),a.onInput=a.onInput.bind(II(a)),a.onKeyPress=a.onKeyPress.bind(II(a)),a}return Sle(n,[{key:"onKeyPress",value:function(a){this.props.onKeyPress&&this.props.onKeyPress(a),this.props.keyfilter&&UN.default.onKeyPress(a,this.props.keyfilter,this.props.validateOnly)}},{key:"onInput",value:function(a){var d=!0;this.props.keyfilter&&this.props.validateOnly&&(d=UN.default.validate(a,this.props.keyfilter)),this.props.onInput&&this.props.onInput(a,d),this.props.onChange||(a.target.value.length>0?$N.default.addClass(a.target,"p-filled"):$N.default.removeClass(a.target,"p-filled"))}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(a){a.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"renderTooltip",value:function(){this.tooltip=new vle.default({target:this.element,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"render",value:function(){var a=this,d=(0,_le.default)("p-inputtext p-component",this.props.className,{"p-disabled":this.props.disabled,"p-filled":this.props.value!=null&&this.props.value.toString().length>0||this.props.defaultValue!=null&&this.props.defaultValue.toString().length>0}),f=xle.default.findDiffKeys(this.props,n.defaultProps);return zN.default.createElement("input",AI({ref:function(S){return a.element=S}},f,{className:d,onInput:this.onInput,onKeyPress:this.onKeyPress}))}}]),n}(zN.Component);Sk.InputText=TD;z$(TD,"defaultProps",{onInput:null,onKeyPress:null,keyfilter:null,validateOnly:!1,tooltip:null,tooltipOptions:null});z$(TD,"propTypes",{onInput:g1.default.func,onKeyPress:g1.default.func,keyfilter:g1.default.any,validateOnly:g1.default.bool,tooltip:g1.default.string,tooltipOptions:g1.default.object});var Ek={};Object.defineProperty(Ek,"__esModule",{value:!0});Ek.Checkbox=void 0;var y1=Mle(B),Lf=CD(uw),XA=CD(OT),Ale=CD(pw);function CD(e){return e&&e.__esModule?e:{default:e}}function U$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return U$=function(){return e},e}function Mle(e){if(e&&e.__esModule)return e;if(e===null||BS(e)!=="object"&&typeof e!="function")return{default:e};var t=U$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function BS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?BS=function(n){return typeof n}:BS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},BS(e)}function Ile(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function WN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Lle(e,t,n){return t&&WN(e.prototype,t),n&&WN(e,n),e}function Dle(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&LI(e,t)}function LI(e,t){return LI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},LI(e,t)}function Ple(e){var t=Rle();return function(){var n=p2(e),s;if(t){var a=p2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return Ole(this,s)}}function Ole(e,t){return t&&(BS(t)==="object"||typeof t=="function")?t:CS(e)}function CS(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rle(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function p2(e){return p2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},p2(e)}function $$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ED=function(e){Dle(n,e);var t=Ple(n);function n(s){var a;return Ile(this,n),a=t.call(this,s),a.state={},a.onClick=a.onClick.bind(CS(a)),a.onFocus=a.onFocus.bind(CS(a)),a.onBlur=a.onBlur.bind(CS(a)),a.onKeyDown=a.onKeyDown.bind(CS(a)),a}return Lle(n,[{key:"onClick",value:function(a){!this.props.disabled&&!this.props.readOnly&&this.props.onChange&&(this.props.onChange({originalEvent:a,value:this.props.value,checked:!this.props.checked,stopPropagation:function(){},preventDefault:function(){},target:{type:"checkbox",name:this.props.name,id:this.props.id,value:this.props.value,checked:!this.props.checked}}),this.input.checked=!this.props.checked,this.input.focus(),a.preventDefault())}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentWillUnmount",value:function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"componentDidUpdate",value:function(a){this.input.checked=this.props.checked,a.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"onFocus",value:function(){this.setState({focused:!0})}},{key:"onBlur",value:function(){this.setState({focused:!1})}},{key:"onKeyDown",value:function(a){a.key==="Enter"&&(this.onClick(a),a.preventDefault())}},{key:"renderTooltip",value:function(){this.tooltip=new Ale.default({target:this.element,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"render",value:function(){var a=this,d=(0,XA.default)("p-checkbox p-component",this.props.className),f=(0,XA.default)("p-checkbox-box p-component",{"p-highlight":this.props.checked,"p-disabled":this.props.disabled,"p-focus":this.state.focused}),i=(0,XA.default)("p-checkbox-icon p-c",{"pi pi-check":this.props.checked});return y1.default.createElement("div",{ref:function(E){return a.element=E},id:this.props.id,className:d,style:this.props.style,onClick:this.onClick,onContextMenu:this.props.onContextMenu,onMouseDown:this.props.onMouseDown},y1.default.createElement("div",{className:"p-hidden-accessible"},y1.default.createElement("input",{type:"checkbox","aria-labelledby":this.props.ariaLabelledBy,ref:function(E){return a.input=E},id:this.props.inputId,name:this.props.name,defaultChecked:this.props.checked,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,disabled:this.props.disabled,readOnly:this.props.readOnly,required:this.props.required})),y1.default.createElement("div",{className:f,ref:function(E){return a.box=E},role:"checkbox","aria-checked":this.props.checked},y1.default.createElement("span",{className:i})))}}]),n}(y1.Component);Ek.Checkbox=ED;$$(ED,"defaultProps",{id:null,inputId:null,value:null,name:null,checked:!1,style:null,className:null,disabled:!1,required:!1,readOnly:!1,tooltip:null,tooltipOptions:null,ariaLabelledBy:null,onChange:null,onMouseDown:null,onContextMenu:null});$$(ED,"propTypes",{id:Lf.default.string,inputId:Lf.default.string,value:Lf.default.any,name:Lf.default.string,checked:Lf.default.bool,style:Lf.default.object,className:Lf.default.string,disabled:Lf.default.bool,required:Lf.default.bool,readOnly:Lf.default.bool,tooltip:Lf.default.string,tooltipOptions:Lf.default.object,ariaLabelledBy:Lf.default.string,onChange:Lf.default.func,onMouseDown:Lf.default.func,onContextMenu:Lf.default.func});Object.defineProperty(wk,"__esModule",{value:!0});wk.MultiSelectHeader=void 0;var qv=zle(B),Hx=Fle(uw),Nle=Sk,Ble=Ek;function Fle(e){return e&&e.__esModule?e:{default:e}}function V$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return V$=function(){return e},e}function zle(e){if(e&&e.__esModule)return e;if(e===null||FS(e)!=="object"&&typeof e!="function")return{default:e};var t=V$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function FS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?FS=function(n){return typeof n}:FS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},FS(e)}function Ule(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function $le(e,t,n){return t&&jN(e.prototype,t),n&&jN(e,n),e}function Vle(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&DI(e,t)}function DI(e,t){return DI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},DI(e,t)}function Wle(e){var t=Hle();return function(){var n=f2(e),s;if(t){var a=f2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return jle(this,s)}}function jle(e,t){return t&&(FS(t)==="object"||typeof t=="function")?t:PI(e)}function PI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hle(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function f2(e){return f2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},f2(e)}function W$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kD=function(e){Vle(n,e);var t=Wle(n);function n(){var s;return Ule(this,n),s=t.call(this),s.onFilter=s.onFilter.bind(PI(s)),s.onToggleAll=s.onToggleAll.bind(PI(s)),s}return $le(n,[{key:"onFilter",value:function(a){this.props.onFilter&&this.props.onFilter({originalEvent:a,query:a.target.value})}},{key:"onToggleAll",value:function(a){this.props.onToggleAll&&this.props.onToggleAll({originalEvent:a,checked:this.props.allChecked})}},{key:"renderFilterElement",value:function(){return this.props.filter?qv.default.createElement("div",{className:"p-multiselect-filter-container"},qv.default.createElement(Nle.InputText,{type:"text",role:"textbox",value:this.props.filterValue,onChange:this.onFilter,className:"p-inputtext p-component",placeholder:this.props.filterPlaceholder}),qv.default.createElement("span",{className:"p-multiselect-filter-icon pi pi-search"})):null}},{key:"render",value:function(){var a=this.renderFilterElement();return qv.default.createElement("div",{className:"p-multiselect-header"},qv.default.createElement(Ble.Checkbox,{checked:this.props.allChecked,onChange:this.onToggleAll,role:"checkbox","aria-checked":this.props.allChecked}),a,qv.default.createElement("button",{type:"button",className:"p-multiselect-close p-link",onClick:this.props.onClose},qv.default.createElement("span",{className:"p-multiselect-close-icon pi pi-times"})))}}]),n}(qv.Component);wk.MultiSelectHeader=kD;W$(kD,"defaultProps",{filter:!1,filterValue:null,filterPlaceholder:null,onFilter:null,onClose:null,onToggleAll:null,allChecked:!1});W$(kD,"propTypes",{filter:Hx.default.bool,filterValue:Hx.default.string,filterPlaceholder:Hx.default.string,allChecked:Hx.default.bool,onFilter:Hx.default.func,onClose:Hx.default.func,onToggleAll:Hx.default.func});Object.defineProperty(_k,"__esModule",{value:!0});_k.MultiSelect=void 0;var Df=Kle(B),Ic=mw(uw),Gg=mw(Sb),VC=mw(dw),Gle=mw(vk),HN=mw(OT),qle=xk,Yle=bk,Xle=wk,Zle=mw(pw);function mw(e){return e&&e.__esModule?e:{default:e}}function j$(){if(typeof WeakMap!="function")return null;var e=new WeakMap;return j$=function(){return e},e}function Kle(e){if(e&&e.__esModule)return e;if(e===null||zS(e)!=="object"&&typeof e!="function")return{default:e};var t=j$();if(t&&t.has(e))return t.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d=s?Object.getOwnPropertyDescriptor(e,a):null;d&&(d.get||d.set)?Object.defineProperty(n,a,d):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function zS(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?zS=function(n){return typeof n}:zS=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zS(e)}function Qle(e){if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=H$(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(S){throw S},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,d=!1,f;return{s:function(){s=e[Symbol.iterator]()},n:function(){var S=s.next();return a=S.done,S},e:function(S){d=!0,f=S},f:function(){try{!a&&s.return!=null&&s.return()}finally{if(d)throw f}}}}function Jle(e){return ice(e)||tce(e)||H$(e)||ece()}function ece(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H$(e,t){if(e){if(typeof e=="string")return OI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OI(e,t)}}function tce(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function ice(e){if(Array.isArray(e))return OI(e)}function OI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function rce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function nce(e,t,n){return t&&GN(e.prototype,t),n&&GN(e,n),e}function sce(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&RI(e,t)}function RI(e,t){return RI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},RI(e,t)}function oce(e){var t=lce();return function(){var n=m2(e),s;if(t){var a=m2(this).constructor;s=Reflect.construct(n,arguments,a)}else s=n.apply(this,arguments);return ace(this,s)}}function ace(e,t){return t&&(zS(t)==="object"||typeof t=="function")?t:a_(e)}function a_(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lce(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function m2(e){return m2=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},m2(e)}function G$(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var AD=function(e){sce(n,e);var t=oce(n);function n(s){var a;return rce(this,n),a=t.call(this,s),a.state={filter:"",panelClick:!1},a.onClick=a.onClick.bind(a_(a)),a.onPanelClick=a.onPanelClick.bind(a_(a)),a.onOptionClick=a.onOptionClick.bind(a_(a)),a.onOptionKeyDown=a.onOptionKeyDown.bind(a_(a)),a.onFocus=a.onFocus.bind(a_(a)),a.onBlur=a.onBlur.bind(a_(a)),a.onFilter=a.onFilter.bind(a_(a)),a.onCloseClick=a.onCloseClick.bind(a_(a)),a.onToggleAll=a.onToggleAll.bind(a_(a)),a}return nce(n,[{key:"onOptionClick",value:function(a){var d=this.getOptionValue(a.option),f=this.findSelectionIndex(d),i;f!==-1?i=this.props.value.filter(function(S,E){return E!==f}):i=[].concat(Jle(this.props.value||[]),[d]),this.updateModel(a.originalEvent,i)}},{key:"onOptionKeyDown",value:function(a){var d=a.originalEvent.currentTarget;switch(a.originalEvent.which){case 40:var f=this.findNextItem(d);f&&f.focus(),a.originalEvent.preventDefault();break;case 38:var i=this.findPrevItem(d);i&&i.focus(),a.originalEvent.preventDefault();break;case 13:this.onOptionClick(a),a.originalEvent.preventDefault();break}}},{key:"findNextItem",value:function(a){var d=a.nextElementSibling;return d?Gg.default.hasClass(d,"p-multiselect-item")?d:this.findNextItem(d):null}},{key:"findPrevItem",value:function(a){var d=a.previousElementSibling;return d?Gg.default.hasClass(d,"p-multiselect-item")?d:this.findPrevItem(d):null}},{key:"onClick",value:function(a){this.props.disabled||this.isPanelClicked(a)||(this.panel.element.offsetParent?this.hide():(this.focusInput.focus(),this.show()))}},{key:"onPanelClick",value:function(a){this.setState({panelClick:!0})}},{key:"onToggleAll",value:function(a){var d;if(a.checked)d=[];else{var f=this.hasFilter()?this.filterOptions(this.props.options):this.props.options;if(f){d=[];var i=Qle(f),S;try{for(i.s();!(S=i.n()).done;){var E=S.value;d.push(this.getOptionValue(E))}}catch(L){i.e(L)}finally{i.f()}}}this.updateModel(a.originalEvent,d)}},{key:"updateModel",value:function(a,d){this.props.onChange&&this.props.onChange({originalEvent:a,value:d,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:d}})}},{key:"onFilter",value:function(a){this.setState({filter:a.query})}},{key:"show",value:function(){var a=this;this.props.options&&this.props.options.length&&(this.panel.element.style.zIndex=String(Gg.default.generateZIndex()),this.panel.element.style.display="block",setTimeout(function(){Gg.default.addClass(a.panel.element,"p-input-overlay-visible"),Gg.default.removeClass(a.panel.element,"p-input-overlay-hidden")},1),this.alignPanel(),this.bindDocumentClickListener())}},{key:"hide",value:function(){var a=this;Gg.default.addClass(this.panel.element,"p-input-overlay-hidden"),Gg.default.removeClass(this.panel.element,"p-input-overlay-visible"),this.unbindDocumentClickListener(),setTimeout(function(){a.panel.element.style.display="none",Gg.default.removeClass(a.panel.element,"p-input-overlay-hidden")},150)}},{key:"alignPanel",value:function(){this.props.appendTo?(this.panel.element.style.minWidth=Gg.default.getWidth(this.container)+"px",Gg.default.absolutePosition(this.panel.element,this.container)):Gg.default.relativePosition(this.panel.element,this.container)}},{key:"onCloseClick",value:function(a){this.setState({panelClick:!1}),this.hide(),a.preventDefault(),a.stopPropagation()}},{key:"findSelectionIndex",value:function(a){var d=-1;if(this.props.value){for(var f=0;f<this.props.value.length;f++)if(VC.default.equals(this.props.value[f],a,this.props.dataKey)){d=f;break}}return d}},{key:"isSelected",value:function(a){return this.findSelectionIndex(this.getOptionValue(a))!==-1}},{key:"findLabelByValue",value:function(a){for(var d=null,f=0;f<this.props.options.length;f++){var i=this.props.options[f],S=this.getOptionValue(i);if(VC.default.equals(S,a)){d=this.getOptionLabel(i);break}}return d}},{key:"onFocus",value:function(a){Gg.default.addClass(this.container,"p-focus"),this.focus=!0,this.props.onFocus&&this.props.onFocus(a)}},{key:"onBlur",value:function(a){Gg.default.removeClass(this.container,"p-focus"),this.focus=!1,this.props.onBlur&&this.props.onBlur(a)}},{key:"bindDocumentClickListener",value:function(){var a=this;this.documentClickListener||(this.documentClickListener=function(d){a.isOutsideClicked(d)&&(a.setState({panelClick:!1}),a.hide())},document.addEventListener("click",this.documentClickListener))}},{key:"isOutsideClicked",value:function(a){return this.container&&!(this.container.isSameNode(a.target)||this.container.contains(a.target)||this.panel&&this.panel.element&&this.panel.element.contains(a.target))}},{key:"isPanelClicked",value:function(a){return this.panel&&this.panel.element&&this.panel.element.contains(a.target)}},{key:"unbindDocumentClickListener",value:function(){this.documentClickListener&&(document.removeEventListener("click",this.documentClickListener),this.documentClickListener=null)}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(a){a.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.unbindDocumentClickListener(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"hasFilter",value:function(){return this.state.filter&&this.state.filter.trim().length>0}},{key:"isAllChecked",value:function(a){return this.hasFilter()?this.props.value&&a&&a.length&&this.props.value.length===a.length:this.props.value&&this.props.options&&this.props.value.length===this.props.options.length}},{key:"filterOptions",value:function(a){var d=this.state.filter.trim().toLocaleLowerCase(this.props.filterLocale),f=this.props.filterBy?this.props.filterBy.split(","):[this.props.optionLabel||"label"];return Gle.default.filter(a,f,d,this.props.filterMatchMode,this.props.filterLocale)}},{key:"getOptionLabel",value:function(a){return this.props.optionLabel?VC.default.resolveFieldData(a,this.props.optionLabel):a.label!==void 0?a.label:a}},{key:"getOptionValue",value:function(a){return this.props.optionValue?VC.default.resolveFieldData(a,this.props.optionValue):a.value!==void 0?a.value:a}},{key:"isEmpty",value:function(){return!this.props.value||this.props.value.length===0}},{key:"checkValidity",value:function(){return this.nativeSelect.checkValidity()}},{key:"getSelectedItemsLabel",value:function(){var a=/{(.*?)}/;return a.test(this.props.selectedItemsLabel)?this.props.selectedItemsLabel.replace(this.props.selectedItemsLabel.match(a)[0],this.props.value.length+""):this.props.selectedItemsLabel}},{key:"getLabel",value:function(){var a;if(!this.isEmpty()&&!this.props.fixedPlaceholder){a="";for(var d=0;d<this.props.value.length;d++)d!==0&&(a+=","),a+=this.findLabelByValue(this.props.value[d]);return this.props.value.length<=this.props.maxSelectedLabels?a:this.getSelectedItemsLabel()}return a}},{key:"getLabelContent",value:function(){var a=this;return this.props.selectedItemTemplate?this.isEmpty()?this.props.selectedItemTemplate():this.props.value.length<=this.props.maxSelectedLabels?this.props.value.map(function(d,f){return Df.default.createElement(Df.default.Fragment,{key:f},a.props.selectedItemTemplate(d))}):this.getSelectedItemsLabel():this.getLabel()}},{key:"renderTooltip",value:function(){this.tooltip=new Zle.default({target:this.container,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderHeader",value:function(a){return Df.default.createElement(Xle.MultiSelectHeader,{filter:this.props.filter,filterValue:this.state.filter,onFilter:this.onFilter,filterPlaceholder:this.props.filterPlaceholder,onClose:this.onCloseClick,onToggleAll:this.onToggleAll,allChecked:this.isAllChecked(a)})}},{key:"renderLabel",value:function(){var a=this.isEmpty(),d=this.getLabelContent(),f=(0,HN.default)("p-multiselect-label",{"p-placeholder":a&&this.props.placeholder,"p-multiselect-label-empty":a&&!this.props.placeholder&&!this.props.selectedItemTemplate});return Df.default.createElement("div",{className:"p-multiselect-label-container"},Df.default.createElement("label",{className:f},d||this.props.placeholder||"empty"))}},{key:"renderHiddenSelect",value:function(){var a=this,d=this.props.value?this.props.value.map(function(f,i){return Df.default.createElement("option",{key:a.getOptionLabel(f)+"_"+i,value:a.getOptionValue(f)})}):null;return Df.default.createElement("div",{className:"p-hidden-accessible p-multiselect-hidden-select"},Df.default.createElement("select",{ref:function(i){return a.nativeSelect=i},required:this.props.required,name:this.props.name,tabIndex:"-1","aria-hidden":"true",multiple:!0},d))}},{key:"render",value:function(){var a=this,d=(0,HN.default)("p-multiselect p-component",this.props.className,{"p-disabled":this.props.disabled,"p-inputwrapper-filled":this.props.value&&this.props.value.length>0,"p-inputwrapper-focus":this.focus||this.props.filter&&this.state.panelClick}),f=this.renderLabel(),i=this.renderHiddenSelect(),S=this.props.options;S&&(this.hasFilter()&&(S=this.filterOptions(S)),S=S.map(function(L,F){var G=a.getOptionLabel(L);return Df.default.createElement(Yle.MultiSelectItem,{key:G+"_"+F,label:G,option:L,template:a.props.itemTemplate,selected:a.isSelected(L),onClick:a.onOptionClick,onKeyDown:a.onOptionKeyDown,tabIndex:a.props.tabIndex})}));var E=this.renderHeader(S);return Df.default.createElement("div",{id:this.props.id,className:d,onClick:this.onClick,ref:function(F){return a.container=F},style:this.props.style},i,Df.default.createElement("div",{className:"p-hidden-accessible"},Df.default.createElement("input",{readOnly:!0,type:"text",onFocus:this.onFocus,onBlur:this.onBlur,ref:function(F){return a.focusInput=F},"aria-haspopup":"listbox","aria-labelledby":this.props.ariaLabelledBy,id:this.props.inputId})),f,Df.default.createElement("div",{className:"p-multiselect-trigger"},Df.default.createElement("span",{className:"p-multiselect-trigger-icon pi pi-chevron-down p-c"})),Df.default.createElement(qle.MultiSelectPanel,{ref:function(F){return a.panel=F},onClick:this.onPanelClick,header:E,appendTo:this.props.appendTo,scrollHeight:this.props.scrollHeight},S))}}]),n}(Df.Component);_k.MultiSelect=AD;G$(AD,"defaultProps",{id:null,name:null,value:null,options:null,optionLabel:null,optionValue:null,style:null,className:null,scrollHeight:"200px",placeholder:null,fixedPlaceholder:!1,disabled:!1,filter:!1,filterBy:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,tabIndex:"0",dataKey:null,inputId:null,required:!1,appendTo:null,tooltip:null,tooltipOptions:null,maxSelectedLabels:3,selectedItemsLabel:"{0} items selected",ariaLabelledBy:null,itemTemplate:null,selectedItemTemplate:null,onChange:null,onFocus:null,onBlur:null});G$(AD,"propTypes",{id:Ic.default.string,name:Ic.default.string,value:Ic.default.any,options:Ic.default.array,optionLabel:Ic.default.string,optionValue:Ic.default.string,style:Ic.default.object,className:Ic.default.string,scrollHeight:Ic.default.string,placeholder:Ic.default.string,fixedPlaceholder:Ic.default.bool,disabled:Ic.default.bool,filter:Ic.default.bool,filterBy:Ic.default.string,filterMatchMode:Ic.default.string,filterPlaceholder:Ic.default.string,filterLocale:Ic.default.string,tabIndex:Ic.default.string,dataKey:Ic.default.string,inputId:Ic.default.string,required:Ic.default.bool,appendTo:Ic.default.object,tooltip:Ic.default.string,tooltipOptions:Ic.default.object,maxSelectedLabels:Ic.default.number,selectedItemsLabel:Ic.default.string,ariaLabelledBy:Ic.default.string,itemTemplate:Ic.default.func,selectedItemTemplate:Ic.default.func,onChange:Ic.default.func,onFocus:Ic.default.func,onBlur:Ic.default.func});var cce=_k;const q$=({employeeList:e,setIsSuccessModalOpen:t,setKmzSuccessMessage:n,setSelectedKmzShare:s,selectedKmzShare:a,isShareModalOpen:d,setIsShareModalOpen:f,setIsLoadingModal:i})=>{const S=wo(null),[E,L]=It(""),[F,G]=It(!0),[q,Q]=It({}),[te,he]=It(""),fe=()=>{f(!1),s(""),Q({}),he(""),G(!0),L("")};async function le(Ee){var Ye;i(!0);const Ie=E.map(lt=>String(lt.userId||lt.UserId)),He=await Hoe(a,Ie);He&&(He!=null&&He.data)?(i(!1),f(!1),G(!0),s(""),L(""),n(((Ye=He==null?void 0:He.data)==null?void 0:Ye.message)||"KMZ shared successfully."),setTimeout(()=>{t(!0)},1e3)):(i(!1),he(He==null?void 0:He.error))}const Se=()=>{setTimeout(()=>{const Ee=document.querySelector(".p-multiselect-panel");Ee&&Ee.classList.add("multiselect-open")},0)},ke=()=>{const Ee=document.querySelector(".p-multiselect-panel");Ee&&Ee.classList.remove("multiselect-open")};return Ar(()=>{d&&S.current&&(S.current.hide(),Q({}),he(""),G(!0),L(""))},[d]),B.createElement(B.Fragment,null,d&&B.createElement("div",{className:"modal theme-modal d-block custom-modal shareKmzModal",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-dialog-centered route-popup"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},B.createElement("h4",{className:"modal-title"},"Share KMZ"),B.createElement("button",{type:"button",className:"close",onClick:fe},B.createElement("span",{className:"material-symbols-outlined constl-icon"},""))),B.createElement("div",{class:"modal-body"},B.createElement("div",{class:"confirmationUserRole mb-25"},te&&B.createElement("div",{class:""},B.createElement("div",{class:"alert alert-danger mb-3 mt-3",role:"alert"},te)),B.createElement("div",{class:"description"},B.createElement("div",{className:"mb-25"},B.createElement("div",{className:"form-group"},B.createElement(cce.MultiSelect,{ref:S,value:E,id:"employeeType",onChange:Ee=>{var Ie,He;(Ie=Ee==null?void 0:Ee.target)!=null&&Ie.value&&((He=Ee==null?void 0:Ee.target)==null?void 0:He.value)!=="Select Employee"&&G(!1),L(Ee.target.value),Q(Ye=>{var Pt,At;const lt={...Ye};return(Pt=Ee==null?void 0:Ee.target)!=null&&Pt.value&&((At=Ee==null?void 0:Ee.target)==null?void 0:At.value)!=="Select Employee"&&delete lt.employeeType,lt})},options:e,optionLabel:Ee=>`${Ee==null?void 0:Ee.fullName} (${Ee==null?void 0:Ee.emailAddress})`,filter:!0,placeholder:"Select Employee",maxSelectedLabels:3,className:"p-multiselect-panel-share-kmz form-control",onShow:Se,onHide:ke}),q.employeeType&&B.createElement("small",{className:"text-danger"},q.employeeType)))))),B.createElement("div",{className:"modal-footer"},B.createElement("button",{className:"button button-primary",onClick:le,disabled:F},"Share"))))))},qN=e=>{const t=e.replace("#",""),n=parseInt(t,16);return{r:n>>16&255,g:n>>8&255,b:n&255}},hce=({r:e,g:t,b:n})=>"#"+[e,t,n].map(s=>{const a=s.toString(16);return a.length===1?"0"+a:a}).join("").toUpperCase(),Gx=({constlDefaultColor:e,onChange:t})=>{console.log("constlDefaultColor:",e);const[n,s]=It(e),[a,d]=It(qN(e));Ar(()=>{d(qN(n)),t&&t(n)},[n]);const f=S=>{const E=S.target.value;/^#[0-9A-Fa-f]{6}$/.test(E)&&s(E.toUpperCase())},i=S=>E=>{const L=Math.min(255,Math.max(0,Number(E.target.value))),F={...a,[S]:L};d(F),s(hce(F))};return B.createElement(B.Fragment,null,B.createElement("div",{className:"picker-wrapper"},B.createElement(Lae,{color:n,onChange:s}),B.createElement("div",{className:"my-2"},B.createElement("label",null,"HEX"),B.createElement("input",{type:"text",className:"form-control",value:n,onChange:f})),B.createElement("div",{className:" d-flex"},B.createElement("div",{className:"input-row-child"},B.createElement("label",null,"R"),B.createElement("input",{type:"number",value:a.r,className:"form-control px-1",onChange:i("r")})),B.createElement("div",{className:"input-row-child mx-2"},B.createElement("label",null,"G"),B.createElement("input",{type:"number",value:a.g,className:"form-control px-1",onChange:i("g")})),B.createElement("div",{className:"input-row-child"},B.createElement("label",null,"B"),B.createElement("input",{type:"number",value:a.b,className:"form-control px-1",onChange:i("b")})))))},Y$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMASURBVHgBzZkxiNNQGMf/iR1uKFJFtMMNOSx4yEHjIoLDvXrIuXmi4NhzcFK46+Yil+Ki0/VGJ9vR6XBT5Og7cBEcKjjcIJixg2AHB6fW73tJalqbXl+btPnB16RNQn58L+/lva8GpkR8dATMng3TWKevNkXOD6ZD4aro4iuFlLcdiSkwdE4WTYcEjB2gtxuSmRSXQlJUZclxJ71oIkFPDHsUu4iHOiYUPVVQNKucMQf6GTsNbv6q3HDq404aK0iZ20d8WYuiRpmsRB0cKeg36SHvYj60KEok2hk+YEZc0MT85BgeBQ5HHfhP0G9WG/NH+PceYKCJxZGzTcpvsEi6vYrcqNaCr31BsrfgNa2FxcLP4UrwPIabmMc5C4snGHMVKoN+9n4gXZzjLAYZ3EPa6HrjbyAokDZM7PDGULOSjOociXF/+Qbu5It4/OU1NCmZZCqQIJt5G08Lm8hmlqBNt2ezYBEJcfPCFTxbvYv2nw4qrQa0MQzBz6CFBChk8yS31ZfjrTYGiokI5pdyeLH2UO0///Z2OjmPHAvGOs9juX27rLavTt7h++82ZiBnal6gbvwk4qEflvv08wSzwoJa+bdzFh7QsMEiYUne52ZluYYr8b7dQgx0tAX5xg33WHWCsCTv828sV6fjMeGesbaFoJ1VnataHZc6mIFbF9dw/XwBV88uq23McrQUwucMDYbHtLbdgiZ1kmHK1rrK3AfKbKxynmArQ3JTPyyB5OXsJbykThE7JmQw3fqF+JeVs+LSdGvFG2a6OED6kPzhCZqoIX1U+UMJqvl/urJYD8oi/94kJhxojokJ4cLPHtMX9FZRvSoWz0BRaeBdLEu0Hl1sUx+QXD38Q1RtZt6lD6ZFcteGf4yazdyDV9CZF5KiNOrA+PLbkVMLVlcJws0aWeIbOx+k4iJf+Ahez4ob7pSVcXLMpCVgi17cDp1dRjxwR3RG1QOH0S2iB6Jc2begR8cXq00ihmkEw5CsoCFJ+MtWy4/w3xAc1NFoOgeDe6jEFPwFjsn6WuOwXgcAAAAASUVORK5CYII=",uce=$3(({projectCodes:e,handleProjectCodeChange:t,customerIds:n,handleCallServiceMap:s,customerService:a,kmzList:d,handleKmzColorChange:f,setCustomerSpecificServiceLayer:i,setKmzColorPattern:S,setKmzIdVal:E,setProjectCodeIdVal:L,setProjectCodeColorPattern:F,shareKMZFilePermission:G,viewKMZFilePermission:q,viewAllCustomerPermission:Q,viewProjectCodePermission:te,viewConstlNetworkPermission:he,employeeList:fe,setConstlDefaultColor:le,constlDefaultColor:Se,setServiceCodeColorPattern:ke,setServiceIdVal:Ee,userType:Ie,customerAccountNumber:He,setActiveColorPickerKmz:Ye,activeColorPickerKmz:lt,setKmzColors:Pt,kmzColors:At,setSelectedKMZ:ht,selectedKMZ:Ot,setServiceIdValRef:Ae,setUncheckedServiceIds:mt,setIsKmzDropdownOpen:bt,setSelectedServicesIdsVal:Dt,setSelectCustomerCount:Je,setCheckedServiceIdsByCustomer:dt,setStopApiCallEmp:ui,setServicePathSelection:Vt,servicePathSelection:ei},ur)=>{let Zt=!0;const[Kt,Ui]=It(!0),[rr,gi]=It({}),[Oi,cr]=It(!1),[ji,nn]=It(!1),[pr,Ue]=It(null),[ni,fi]=It(null),[Lt,pt]=It([]),[Nt,Si]=It(""),[pi,St]=It([]),[Ht,nr]=It({}),[tr,kr]=It({}),[Mr,Cr]=It(null),[Tn,gs]=It(""),[wn,bs]=It(!1),[qn,Ls]=It(!1),[ma,Ln]=It(""),[qo,zn]=It({});It({});const za=mi=>{zn(_r=>({..._r,[mi]:!_r[mi]}))},$o=()=>{const mi=n.reduce((_r,zi)=>(_r[zi.customerAccountNo]=!0,_r),{});gi(mi)},Aa=()=>{const mi=a==null?void 0:a.find(_r=>_r.customerId==He);return mi?mi.services:[]},ja=async()=>{const mi=n.reduce((_r,zi)=>(_r[zi.customerAccountNo]=!1,_r),{});gi(mi),await bl(He,!1,!1,"customerNetwork")},[Yn,hl]=It({constlNetwork:!0,kmz:!1,customerListNetwork:!1}),fr=(mi,_r)=>zi=>{Pt(zr=>({...zr,[_r]:{kmzId:_r,color:zi}})),E(_r)},tc=(mi,_r)=>zi=>{nr(zr=>({...zr,[_r]:{id:_r,color:zi}})),L(_r)},Sh=()=>Ui(!Kt),bl=async(mi,_r=!1,zi,zr)=>{if(console.log("Loading services for customer:",zr),zr=="customerListNetwork")console.log("Custom type"),ui(!0),a&&(a==null||a.forEach(Yr=>{Vt(yr=>{const Hr={...yr};return Yr.services.forEach(rn=>{Hr[rn.externalReferenceId]={"Primary Path":!0,"Secondary Path":!0,"Restoration Path":!0}}),Hr})}));else if(zr=="customerNetwork"){if(console.log("type customerNetwork"),Array.isArray(Yn[`customer_${mi}`])&&Yn[`customer_${mi}`].length>0)return;const Yr=await s(mi);ui(!1);const yr=Yr==null?void 0:Yr.find(Hr=>Hr.customerId===mi);yr&&(Ie==="customer"&&Vt(Hr=>{const rn={...Hr};return yr.services.forEach(is=>{rn[is.externalReferenceId]={"Primary Path":!0,"Secondary Path":!0,"Restoration Path":!0}}),rn}),Ie==="employee"&&Vt(Hr=>{const rn={...Hr};return yr.services.forEach(is=>{rn[is.externalReferenceId]={"Primary Path":Yn[`customer_${mi}`]||!1,"Secondary Path":Yn[`customer_${mi}`]||!1,"Restoration Path":Yn[`customer_${mi}`]||!1}}),rn}),hl(Hr=>{const rn={...Hr};return Array.isArray(rn[`customer_${yr.customerId}`])||(rn[`customer_${yr.customerId}`]=[]),yr.services.forEach(is=>{const Ps=`service_${is.externalReferenceId}`;rn[Ps]=!0,Array.isArray(rn[`customer_${yr.customerId}`])&&!rn[`customer_${yr.customerId}`].includes(is.externalReferenceId)&&rn[`customer_${yr.customerId}`].push(is.externalReferenceId)}),St(is=>{const Ps=yr.services.map(ra=>ra.id),vs=is.filter(ra=>{const Sc=((a==null?void 0:a.flatMap(Xl=>Xl.services))||[]).find(Xl=>Xl.id===ra);return Yn[`service_${Sc==null?void 0:Sc.externalReferenceId}`]});return Array.from(new Set([...vs,...Ps]))}),rn}))}else{console.log("else type customerNetwork"),ui(!0);let Yr=a==null?void 0:a.find(yr=>yr.customerId===mi);if(!Yr){const yr=await s(mi);zi&&(Yr=yr==null?void 0:yr.find(Hr=>Hr.customerId===mi))}Yr&&_r&&(Vt(yr=>{const Hr={...yr};return Yr.services.forEach(rn=>{Hr[rn.externalReferenceId]={"Primary Path":_r||!1,"Secondary Path":_r||!1,"Restoration Path":_r||!1}}),Hr}),hl(yr=>{const Hr={...yr};return Array.isArray(Hr[`customer_${Yr.customerId}`])||(Hr[`customer_${Yr.customerId}`]=[]),Yr.services.forEach(rn=>{const is=`service_${rn.externalReferenceId}`;Hr[is]=_r,_r?Hr[`customer_${Yr.customerId}`].includes(rn.externalReferenceId)||Hr[`customer_${Yr.customerId}`].push(rn.externalReferenceId):Hr[`customer_${Yr.customerId}`]=Hr[`customer_${Yr.customerId}`].filter(Ps=>Ps!==rn.externalReferenceId)}),_r&&(St(rn=>{const is=Yr.services.map(vs=>vs.id),Ps=rn.filter(vs=>{const Po=((a==null?void 0:a.flatMap(Sc=>Sc.services))||[]).find(Sc=>Sc.id===vs);return Yn[`service_${Po==null?void 0:Po.externalReferenceId}`]});return Array.from(new Set([...Ps,...is]))}),console.log("Selected Services ID Val:",pi)),Hr}))}},Un=async mi=>{let _r="network";const zi=rr[mi];if(gi(zr=>({...zr,[mi]:!zr[mi]})),zi){const zr=a==null?void 0:a.find(yr=>yr.customerId===mi);let Yr=!1;if(zr){const yr=Yn[`customer_${mi}`]||[];yr&&Array.isArray(yr)&&yr.length>0&&(Yr=zr.services.every(Hr=>yr.includes(Hr.externalReferenceId))),yr&&!Array.isArray(yr)&&(Yr=yr)}Yn[`customer_${mi}`]&&(console.log("Customer Layer:",Yn[`customer_${mi}`]),_r="customerNetwork"),console.log("Loading customer services for:",mi),await bl(mi,Yr,!1,_r)}},vi=(mi,_r)=>{const zi=mi.target.checked;bt(!1),Ye(null);const zr=zi?[...Ot,_r]:Ot.filter(Yr=>Yr.id!==_r.id);ht(zr),zi||Pt(Yr=>({...Yr,[_r.id]:{kmzId:_r.id,color:"#4CAF50"}})),f(zr.map(Yr=>Yr.id))},Ge=(mi,_r)=>{const zi=mi.target.checked,zr=zi?[...Lt,_r]:Lt.filter(yr=>yr.id!==_r.id);pt(zr),zi||nr(yr=>({...yr,[_r.id]:{id:_r.id,color:Se}})),t(zr.map(yr=>yr.id));const Yr=e.every(yr=>zi?[...Lt,_r].some(Hr=>Hr.id===yr.id):zr.some(Hr=>Hr.id===yr.id));hl(yr=>({...yr,constlNetwork:Yr}))},Fe=mi=>_r=>{const zi=_r.target.checked;hl(zr=>({...zr,[mi]:zi})),mi==="constlNetwork"&&setTimeout(()=>{const zr=zi?[...e]:[];if(pt(zr),!zi){const Yr=e.reduce((yr,Hr)=>(yr[Hr.id]={id:Hr.id,color:Se},yr),{});nr(Yr)}t(zr.map(Yr=>Yr.id))},0),mi==="customerListNetwork"&&(Ie=="customer"&&$o(),console.log("Customer List Network Toggled:",tn),Ie=="employee"&&hl(zr=>{const Yr={...zr,customerListNetwork:zi};return tn.forEach(yr=>{const Hr=a==null?void 0:a.find(rn=>rn.customerId===yr.customerAccountNo);Yr[`customer_${yr.customerAccountNo}`]=zi,Hr&&Array.isArray(Hr.services)&&Hr.services.forEach(rn=>{Yr[`service_${rn.externalReferenceId}`]=zi})}),Yr}),tn.forEach(zr=>{ft(zr.customerAccountNo,"customerListNetwork")({target:{checked:zi}})}),Yn.customerListNetwork=zi,console.log("Layers after customerListNetwork toggle:",Yn))},rt=mi=>{switch(mi){case"Active Path":return"#00A315";case"Primary Path":return"#36CC36";case"Secondary Path":return"#0023F5";case"Restoration Path":return"#505050";default:return"#36CC36"}},xt=mi=>{const _r=["Active Path","Primary Path","Secondary Path","Restoration Path"],zi={};return _r.forEach(zr=>{zi[zr]=rt(zr)}),{externalReferenceId:mi.externalReferenceId,...zi}},ft=(mi,_r)=>async zi=>{const zr=zi.target.checked;if(zr&&mt(""),!zr){const Yr=a==null?void 0:a.find(yr=>yr.customerId===mi);Yr&&Vt(yr=>{const Hr={...yr};return Yr.services.forEach(rn=>{Hr[rn.externalReferenceId]={"Primary Path":!1,"Secondary Path":!1,"Restoration Path":!1}}),Hr})}hl(Yr=>{const yr={...Yr};if(zr)Array.isArray(yr.customer_customerListNetwork)||(yr.customer_customerListNetwork=[]),yr[`customer_${mi}`]=!0,yr.customer_customerListNetwork.includes(mi)||yr.customer_customerListNetwork.push(mi),yr[`customer_${mi}`]=!0;else{const Hr=a==null?void 0:a.find(rn=>rn.customerId===mi);Hr&&Hr.services.forEach(rn=>{const is=`service_${rn.externalReferenceId}`;delete yr[is]}),yr[`customer_${mi}`]=!1,Array.isArray(yr.customer_customerListNetwork)&&(yr.customer_customerListNetwork=yr.customer_customerListNetwork.filter(rn=>rn!==mi)),St(rn=>{if(console.log("Previous Selected Services ID Val:",rn),!zr){console.log("Removing services for customer:",mi);const is=(Hr==null?void 0:Hr.services.map(Ps=>Ps.id))||[];return rn.filter(Ps=>!is.includes(Ps))}}),kr(rn=>{const is={...rn};return Hr==null||Hr.services.forEach(Ps=>{is[Ps.id]={externalReferenceId:Ps.externalReferenceId,color:"#36CC36"}}),is})}return Array.isArray(yr.customer_customerListNetwork)&&yr.customer_customerListNetwork.length==tn.length?yr.customerListNetwork=!0:yr.customerListNetwork=!1,yr}),zr&&await bl(mi,zr,!0,_r)},Jt=mi=>{const _r=mi.target.checked,zi=_r?[...d]:[];if(console.log("Updated Selected KMZ:",zi),ht(zi),!_r){const zr=d.reduce((Yr,yr)=>(Yr[yr.id]={kmzId:yr.id,color:"#4CAF50"},Yr),{});Pt(zr)}f(zi.map(zr=>zr.id))},xi=(mi,_r)=>{dt(zi=>_r?zi.includes(mi)?zi:[...zi,mi]:zi.filter(zr=>zr!==mi))},ti=(mi,_r,zi)=>zr=>{const Yr=zr.target.checked;Yr&&mt(""),console.log(`Layer ${mi} changed to ${Yr}`);const yr={...Yn,[mi]:Yr};if(Zt=!1,mi.startsWith("service_")){console.log(mi);const Hr=mi.replace("service_",""),rn=a==null?void 0:a.find(is=>is.services.some(Ps=>Ps.externalReferenceId===Hr));if(rn){console.log("Matched Customer:",rn),xi(zi,Yr);const is=`customer_${rn.customerId}`;console.log("Matched customerKey:",is),console.log("Matched updatedLayers:",yr);const Ps=rn.services.filter(Po=>yr[`service_${Po.externalReferenceId}`]).map(Po=>Po.externalReferenceId);console.log("Matched selectedServices:",Ps);const vs=rn.services.filter(Po=>yr[`service_${Po.externalReferenceId}`]).map(Po=>Po.id);console.log("Matched selectedServicesId:",vs),yr[is]=Ps;const ra=rn.services.every(Po=>yr[`service_${Po.externalReferenceId}`]);console.log("Matched allSelected:",ra),ra?(console.log("Matched allSelected: else"),yr[is]=rn.services.map(Po=>Po.externalReferenceId),Array.isArray(yr.customer_customerListNetwork)||(yr.customer_customerListNetwork=[]),yr.customer_customerListNetwork.push(rn.customerId)):(console.log("Matched !allSelected:"),yr[is]=Ps,Array.isArray(yr.customer_customerListNetwork)&&(yr.customer_customerListNetwork=yr.customer_customerListNetwork.filter(Po=>Po!==rn.customerId)),yr[`${is}`]=!1),St(Po=>{const Sc=Po.filter(Xl=>{const ps=((a==null?void 0:a.flatMap(la=>la.services))||[]).find(la=>la.id==Xl);return Yn[`service_${ps==null?void 0:ps.externalReferenceId}`]});return Array.from(new Set([...Sc,...vs]))})}if(!Yr){const is=a==null?void 0:a.find(vs=>vs.services.some(ra=>ra.id==_r)),Ps=is==null?void 0:is.services.find(vs=>vs.id==_r);Ps&&kr(vs=>({...vs,[_r]:xt(Ps)})),mt(Hr),console.log("Service ID:",_r),console.log("setSelectedServicesIdVal:",pi),St(vs=>vs.filter(ra=>ra!=_r)),console.log("Updated Selected Services ID:",pi)}Array.isArray(yr.customer_customerListNetwork)&&yr.customer_customerListNetwork.length==n.length?yr.customerListNetwork=!0:yr.customerListNetwork=!1}Vt(Yr?Hr=>({...Hr,[zi]:{"Primary Path":!0,"Secondary Path":!0,"Restoration Path":!0}}):Hr=>({...Hr,[zi]:{"Primary Path":!1,"Secondary Path":!1,"Restoration Path":!1}})),hl(yr)};function ai(mi){gs(mi),nn(!0)}const Yi=()=>{Ls(!1)},Fi=mi=>_r=>{le(_r);const zi=Object.keys(Ht).reduce((zr,Yr)=>(zr[Yr]={id:Yr,color:_r},zr),{});nr(zi),L(mi)},Pr=(mi,_r,zi)=>zr=>{kr(Yr=>({...Yr,[_r]:{...Yr[_r],externalReferenceId:mi,[zi]:zr}})),Ee(_r),Ae(mi)},ln=()=>{pt([]),St([]),nr({}),kr({}),hl({constlNetwork:!1,kmz:!1,customerListNetwork:!1}),Si(""),Ue(null),fi(null),Cr(null),F({}),ke({}),i({}),Jt({target:{checked:!1}}),Vt({}),dt([])};Ar(()=>{n.length>0&&(Ie==="customer"&&He&&ja(),Ie==="employee"&&$o())},[n]),Ar(()=>{if(Ie==="customer"&&He&&Zt&&a&&a.length==1){const mi=Aa();St(mi.map(_r=>_r.id))}},[a]),Ar(()=>{pi.length>0?Dt([...pi]):Dt([])},[pi]),Ar(()=>{if(d.length>0){const mi={};d.forEach(_r=>{var zi;mi[_r.id]={kmzId:_r.id,color:((zi=At[_r.id])==null?void 0:zi.color)||"#4CAF50"}}),Pt(mi)}},[d]),Ar(()=>{S(At)},[At]),Ar(()=>{if(e.length>0){pt([...e]),t(e.map(_r=>_r.id));const mi={};e.forEach(_r=>{var zi;mi[_r.id]={id:_r.id,color:((zi=Ht[_r.id])==null?void 0:zi.color)||Se}}),nr(mi)}},[e]),Ar(()=>{F({...Ht})},[Ht]),Ar(()=>{tr&&Object.keys(tr).length>0&&ke(tr)},[tr]),Ar(()=>{i(Yn)},[Yn]),Ar(()=>{const mi=_r=>{const zi=document.querySelector(".colorPicker-box");zi&&!zi.contains(_r.target)&&(Ue(null),fi(null),Cr(null))};return document.addEventListener("mousedown",mi),()=>{document.removeEventListener("mousedown",mi)}},[]),Ar(()=>{if(Ie==="customer"&&a&&a.length>0){const mi={};a.forEach(_r=>{_r.services.forEach(zi=>{mi[zi.externalReferenceId]={"Primary Path":!0,"Secondary Path":!0,"Restoration Path":!0}})}),Vt(mi)}},[a]),V3(ur,()=>({resetAll:ln}));const Qr=()=>cr(!0),Or=()=>{Nt.trim()===""&&cr(!1)},ii=Nt?e.filter(mi=>mi.projectCode.toLowerCase().includes(Nt.toLowerCase())):e;function xr(mi){return mi==null?void 0:mi.toLowerCase().trim().replace(/\s+/g," ").replace(/[-_]/g,"-")}const Xr=d.filter(mi=>{const _r=`${mi.competitor}-${mi.kmzName}`;return xr(_r).includes(xr(Nt))});a==null||a.forEach(mi=>{mi.originalServices||(mi.originalServices=[...mi.services])});const tn=Nt?n.filter(mi=>{var Hr;const _r=Nt.toLowerCase(),zi=(Hr=mi.customerName)==null?void 0:Hr.toLowerCase().includes(_r),zr=a==null?void 0:a.find(rn=>rn.customerId===mi.customerAccountNo),Yr=zr?zr.originalServices.filter(rn=>{var is,Ps;return((is=rn.externalReferenceId)==null?void 0:is.toLowerCase().includes(_r))||((Ps=rn.serviceName)==null?void 0:Ps.toLowerCase().includes(_r))}):[],yr=Yr.length>0;return zi||yr?(zr&&(zr.services=yr?Yr:[...zr.originalServices]),!0):!1}):n.map(mi=>{const _r=a==null?void 0:a.find(zi=>zi.customerId===mi.customerAccountNo);return _r&&(_r.services=[..._r.originalServices]),mi});tn&&tn.filter(mi=>mi.isActive&&mi.isOnboarded);const Jn=tn?tn.filter(mi=>Yn[`customer_${mi.customerAccountNo}`]===!0).length:0,ds=wo(Jn);return Ar(()=>{ds.current!=Jn&&Je(Jn),ds.current=Jn},[Jn]),Ar(()=>{setTimeout(()=>{const mi=document.querySelectorAll('.custom-tooltip[data-toggle="tooltip"]'),_r=Array.from(mi).map(zi=>new window.bootstrap.Tooltip(zi));return()=>{_r.forEach(zi=>zi.dispose())}},0)},[Xr]),B.createElement("div",null,qn&&B.createElement("div",{className:"modal theme-modal d-block custom-modal",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},B.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:Yi},B.createElement("span",{className:"material-symbols-outlined constl-icon"},""))),B.createElement("div",{className:"modal-body"},B.createElement("div",{className:"ticket-details-success"},B.createElement("div",{className:"icon"},B.createElement("img",{src:Y$,alt:""})),B.createElement("div",{className:"status-message"},"Congratulations!"),B.createElement("div",{className:"details"},ma)))))),B.createElement(q$,{employeeList:fe,setIsSuccessModalOpen:Ls,setKmzSuccessMessage:Ln,setSelectedKmzShare:gs,selectedKmzShare:Tn,setIsShareModalOpen:nn,isShareModalOpen:ji,setIsLoadingModal:bs}),B.createElement("div",{className:`sidebarMap ${Kt?"openMap":""}`},B.createElement("button",{className:"toggleBtnMap",onClick:Sh},Kt?B.createElement("span",{class:"material-symbols-outlined"},"arrow_left"):B.createElement("span",{class:"material-symbols-outlined"},"arrow_right")),B.createElement("div",{className:"scrollBarSideBar"},B.createElement("div",{className:"search-wrapper-parent"},B.createElement("div",{className:"search-wrapper hover",onMouseEnter:Qr,onMouseLeave:Or},B.createElement("div",{className:"search-container"},B.createElement("input",{type:"text",className:"search-input",placeholder:"Search...",value:Nt,onChange:mi=>Si(mi.target.value)})))),Ie==="employee"&&B.createElement(B.Fragment,null,he&&B.createElement("div",{className:"layer-group-parent constl-network-layer-group"},B.createElement("div",{className:"layer-group",style:{marginBottom:"0px"}},B.createElement("p",null,B.createElement("input",{type:"checkbox",checked:Yn.constlNetwork,onChange:Fe("constlNetwork"),disabled:ii.length===0}),B.createElement("span",{className:"layer-label",style:{cursor:"none"}},B.createElement("span",{class:"material-symbols-outlined"},"lan")," ","Constl Network"),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:Se,border:"1px solid #ccc",pointerEvents:ii.length==Lt.length?"auto":"none",cursor:ii.length==Lt.length?"pointer":"default"},onClick:mi=>{const _r=document.querySelector(".scrollBarSideBar").scrollTop,zi=mi.target.offsetTop,Yr=document.querySelector("#dashboard-map").offsetHeight-410,yr={top:Math.min(zi-_r,Yr),left:350};fi({id:"all",offset:yr})}})),ni&&ni.id=="all"&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:ni.offset.top,left:ni.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>fi(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:Se,onChange:mi=>{le(mi),Fi("all")(mi)}}))),te&&B.createElement("div",{className:"sub-layer-group"},ii.map(mi=>{var _r,zi;return B.createElement("div",{key:mi.id,style:{marginBottom:"10px"}},B.createElement("div",{style:{display:"flex",alignItems:"center",gap:"6px"}},B.createElement("input",{type:"checkbox",checked:Lt.some(zr=>zr.id===mi.id),onChange:zr=>Ge(zr,mi)}),B.createElement("span",{className:"layer-label"},mi.projectCode),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((_r=Ht[mi.id])==null?void 0:_r.color)||Se,border:"1px solid #ccc",pointerEvents:Lt.some(zr=>zr.id===mi.id)?"auto":"none",cursor:Lt.some(zr=>zr.id===mi.id)?"pointer":"default"},onClick:zr=>{const Yr=document.querySelector(".scrollBarSideBar").scrollTop,yr=zr.target.offsetTop,rn=document.querySelector("#dashboard-map").offsetHeight-410,is={top:Math.min(yr-Yr,rn),left:350};Lt.some(Ps=>Ps.id===mi.id)&&Ue({id:mi.id,offset:is})}})),pr&&pr.id===mi.id&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:pr.offset.top,left:pr.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Ue(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((zi=Ht[mi.id])==null?void 0:zi.color)||Se,onChange:zr=>{tc(mi.projectCode,mi.id)(zr)}})))}))),Q&&B.createElement("div",{className:"layer-group-parent constl-network-layer-group"},B.createElement("div",{className:"layer-group",style:{marginBottom:"0px"}},B.createElement("p",null,B.createElement("span",{className:`arrow-network ${rr.customerListNetwork?"expanded":"collapsed"}`,onClick:()=>{tn.length!==0&&(console.log("Arrow clicked"),Un("customerListNetwork"))},style:{cursor:tn.length===0?"not-allowed":"pointer",opacity:tn.length===0?.5:1},"aria-disabled":tn.length===0}),B.createElement("input",{type:"checkbox",checked:tn.length>0&&tn.every(mi=>{const _r=Yn[`customer_${mi.customerAccountNo}`];if(_r===!0)return!0;const zi=a==null?void 0:a.find(zr=>zr.customerId===mi.customerAccountNo);return Array.isArray(_r)&&zi&&zi.services.length>0?zi.services.every(zr=>_r.includes(zr.externalReferenceId)):!1}),disabled:tn.length==0,onChange:mi=>{console.log("Checkbox changed"),Fe("customerListNetwork")(mi)}}),B.createElement("span",{className:"layer-label",style:{cursor:"none"}},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"contacts_product")," ","Customer List"))),rr.customerListNetwork&&tn&&tn.map(mi=>{const _r=a==null?void 0:a.find(zi=>zi.customerId===mi.customerAccountNo);return B.createElement("div",{className:"sub-layer-group"},B.createElement("div",{className:"layer-group",key:mi.customerAccountNo},B.createElement("p",null,B.createElement("span",{className:"layer-label"},B.createElement("span",{className:`arrow-network ${rr[mi.customerAccountNo]?"collapsed":"expanded"}`,onClick:()=>Un(mi.customerAccountNo)}),B.createElement("input",{type:"checkbox",checked:(()=>Yn.customerListNetwork?!0:Yn[`customer_${mi.customerAccountNo}`]||!1)(),onChange:ft(mi.customerAccountNo,rr[mi.customerAccountNo]?"customerListNetwork":void 0)}),B.createElement("span",null,mi.customerName))),!rr[mi.customerAccountNo]&&_r&&B.createElement(B.Fragment,null,_r.services.map((zi,zr)=>{var Yr,yr;return B.createElement("div",{className:"sub-layer-group layer-checkbox",key:zr},B.createElement("span",{className:`arrow-service ${qo[zi.id]?"expanded":"collapsed"}`,onClick:()=>za(zi.id),style:{cursor:"pointer",marginRight:"8px"}}),B.createElement("input",{type:"checkbox",checked:Yn[`customer_${mi.customerAccountNo}`]===!0||Yn[`service_${zi.externalReferenceId}`]===!0,onChange:Hr=>{ui(!0),ti(`service_${zi.externalReferenceId}`,`${zi.id}`,`${zi.externalReferenceId}`)(Hr)}}),B.createElement("div",null," ",zi.externalReferenceId),qo[zi.id]&&B.createElement("div",{className:"layer-group",style:{width:"100%"}},B.createElement("div",{className:"sub-layer-group",style:{paddingLeft:"45px"}},zi.externalReferenceId.includes("PLC")&&B.createElement(B.Fragment,null,["Primary Path","Secondary Path","Restoration Path"].map(Hr=>{var rn,is,Ps;return B.createElement("div",{key:Hr,className:"path-type-row",style:{display:"flex",alignItems:"center"}},B.createElement("input",{type:"checkbox",checked:((rn=ei[zi.externalReferenceId])==null?void 0:rn[Hr])||!1,onChange:vs=>{const ra=vs&&vs.target?vs.target.checked:!1;Vt(Po=>({...Po,[zi.externalReferenceId]:{...Po[zi.externalReferenceId],[Hr]:ra}}))},disabled:!Yn[`service_${zi.externalReferenceId}`]&&!Yn.customerListNetwork,style:{marginRight:"8px"}}),B.createElement("p",{className:"layer-label"},Hr==="Restoration Path"?"Tertiary Path":Hr),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((is=tr[zi.id])==null?void 0:is[Hr])||(Hr==="Active Path"?"#00A315":Hr==="Primary Path"?"#36CC36":Hr==="Secondary Path"?"#0023F5":Hr==="Restoration Path"?"#505050":"#36CC36"),border:"1px solid #ccc",marginLeft:"8px",opacity:Hr==="Active Path"?.4:1,pointerEvents:Hr==="Active Path"?"none":pi.includes(zi.id)?"auto":"none",cursor:pi.includes(zi.id)?"pointer":"default"},onClick:vs=>{console.log("Clicked on path type:"),mt("");const ra=document.querySelector(".scrollBarSideBar").scrollTop;console.log("Scroll Top:",ra);const Po=vs.target.offsetTop,Xl=document.querySelector("#dashboard-map").offsetHeight-410,lh={top:Math.min(Po-ra,Xl),left:350};console.log(pi),console.log(zi.id),pi.includes(zi.id)&&Cr({id:`${zi.id}_${Hr}`,serviceId:zi.id,pathType:Hr,offset:lh})}}),Mr&&Mr.id==`${zi.id}_${Hr}`&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:Mr.offset.top,left:Mr.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Cr(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((Ps=tr[zi.id])==null?void 0:Ps[Hr])||rt(Hr),onChange:vs=>{Pr(zi.externalReferenceId,zi.id,Hr)(vs)}})))})),zi.externalReferenceId.includes("DFC")&&B.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"6px"}},B.createElement("p",{className:"layer-label"},"Primary Path"),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((Yr=tr[zi.id])==null?void 0:Yr["Primary Path"])||"#36CC36",border:"1px solid #ccc",marginLeft:"8px",pointerEvents:pi.includes(zi.id)?"auto":"none",cursor:pi.includes(zi.id)?"pointer":"default"},onClick:Hr=>{mt("");const rn=document.querySelector(".scrollBarSideBar").scrollTop,is=Hr.target.offsetTop,vs=document.querySelector("#dashboard-map").offsetHeight-410,ra={top:Math.min(is-rn,vs),left:350};pi.includes(zi.id)&&Cr({id:`${zi.id}_Primary Path`,serviceId:zi.id,pathType:"Primary Path",offset:ra})}}),Mr&&Mr.id===`${zi.id}_Primary Path`&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:Mr.offset.top,left:Mr.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Cr(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((yr=tr[zi.id])==null?void 0:yr["Primary Path"])||"#36CC36",onChange:Hr=>{Pr(zi.externalReferenceId,zi.id,"Primary Path")(Hr)}}))))))}))))})),q&&B.createElement("div",{className:"layer-group-parent constl-network-layer-group"},B.createElement("div",{className:"layer-group",style:{marginBottom:"0px"}},B.createElement("p",null,B.createElement("span",{className:`arrow-network ${rr.kmzNetwork?"expanded":"collapsed"}`,onClick:()=>{Xr.length!==0&&Un("kmzNetwork")},style:{cursor:Xr.length===0?"not-allowed":"pointer",opacity:Xr.length===0?.5:1},"aria-disabled":Xr.length===0}),B.createElement("input",{type:"checkbox",checked:Xr.length>0&&Ot.length===Xr.length,disabled:Xr.length===0,onChange:Jt}),B.createElement("span",{className:"layer-label",style:{cursor:"none"}},B.createElement("span",{class:"material-symbols-outlined"},"draft")," ","Other KMZs"))),B.createElement("div",{className:"sub-layer-group"},rr.kmzNetwork&&Xr.map(mi=>{var _r,zi;return B.createElement("div",{key:mi.id,style:{paddingLeft:"20px",marginBottom:"10px"}},B.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px"}},B.createElement("input",{type:"checkbox",checked:Ot.some(zr=>zr.id===mi.id),onChange:zr=>vi(zr,mi)}),B.createElement("span",{className:"layer-label"},mi.competitor,"-",mi.kmzName),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((_r=At[mi.id])==null?void 0:_r.color)||"#4CAF50",border:"1px solid #ccc",pointerEvents:Ot.some(zr=>zr.id===mi.id)?"auto":"none",cursor:Ot.some(zr=>zr.id===mi.id)?"pointer":"default"},onClick:zr=>{const Yr=document.querySelector(".scrollBarSideBar").scrollTop,yr=zr.target.offsetTop,rn=document.querySelector("#dashboard-map").offsetHeight-410,is={top:Math.min(yr-Yr,rn),left:350};Ot.some(Ps=>Ps.id===mi.id)&&Ye({id:mi.id,offset:is})}}),G&&B.createElement("button",{className:"share-btn custom-tooltip","data-toggle":"tooltip","data-placement":"top",title:"Share KMZ",onClick:()=>ai(mi.id),zIndex:3},B.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B.createElement("path",{d:"M17.5 2.125V15.875C17.5 16.9297 16.6406 17.75 15.625 17.75H1.875C0.820312 17.75 0 16.9297 0 15.875V2.125C0 1.10938 0.820312 0.25 1.875 0.25H15.625C16.6406 0.25 17.5 1.10938 17.5 2.125ZM11.875 10.5625C11.2891 10.5625 10.7812 10.7969 10.3906 11.1484L7.73438 9.54688C7.77344 9.39062 7.77344 9.19531 7.77344 9C7.77344 8.84375 7.77344 8.64844 7.73438 8.49219L10.3906 6.89062C10.7812 7.24219 11.2891 7.4375 11.875 7.4375C13.0469 7.4375 14.0625 6.46094 14.0625 5.25C14.0625 4.07812 13.0469 3.0625 11.875 3.0625C10.6641 3.0625 9.6875 4.07812 9.6875 5.25C9.6875 5.44531 9.6875 5.64062 9.72656 5.79688L7.07031 7.39844C6.67969 7.04688 6.17188 6.8125 5.625 6.8125C4.41406 6.8125 3.4375 7.82812 3.4375 9C3.4375 10.2109 4.41406 11.1875 5.625 11.1875C6.17188 11.1875 6.67969 10.9922 7.07031 10.6406L9.72656 12.2422C9.6875 12.3984 9.6875 12.5938 9.6875 12.75C9.6875 12.7891 9.6875 12.75 9.6875 12.7891C9.6875 13.9609 10.6641 14.9766 11.875 14.9766C13.0469 14.9766 14.0625 13.9609 14.0625 12.7891C14.0625 11.5781 13.0469 10.5625 11.875 10.5625Z",fill:"#237AFF"})))),lt&&lt.id===mi.id&&lt.offset&&lt.offset.left&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:lt.offset.top,left:lt.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Ye(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((zi=At[mi.id])==null?void 0:zi.color)||"#4CAF50",onChange:zr=>{fr(mi.kmzName,mi.id)(zr)}})))})))),Ie==="customer"&&B.createElement(B.Fragment,null,Q&&B.createElement("div",{className:"layer-group-parent customer-layer-group-parent"},tn&&tn.filter(mi=>mi.customerAccountNo===He).length===0&&B.createElement("div",{className:"alert alert-info"},"No services found."),tn&&tn.filter(mi=>mi.customerAccountNo===He).map(mi=>{const _r=a==null?void 0:a.find(zi=>zi.customerId===mi.customerAccountNo);return B.createElement("div",{key:mi.customerAccountNo},B.createElement("p",null,B.createElement("span",{className:"layer-label"},B.createElement("span",{className:`arrow-network ${rr[mi.customerAccountNo]?"collapsed":"expanded"}`,onClick:()=>Un(mi.customerAccountNo)}),B.createElement("input",{type:"checkbox",checked:(()=>Yn.customerListNetwork?!0:Yn[`customer_${mi.customerAccountNo}`]||!1)(),onChange:async zi=>{if(!zi||!zi.target)return;const zr=zi.target.checked;await ft(mi.customerAccountNo,rr[mi.customerAccountNo]?"customerListNetwork":void 0)({target:{checked:zr}});const Yr=a==null?void 0:a.find(yr=>yr.customerId===mi.customerAccountNo);Yr&&dt(yr=>{const Hr=Yr.services.map(rn=>rn.externalReferenceId);return zr?Array.from(new Set([...yr,...Hr])):yr.filter(rn=>!Hr.includes(rn))})}}),B.createElement("span",null,"Select All"))),B.createElement("div",{className:"layer-group mt-2"},!rr[mi.customerAccountNo]&&_r?B.createElement(B.Fragment,null,Array.isArray(_r.services)&&_r.services.length===0?B.createElement("div",{className:"alert alert-info"},"No services available for this customer"):_r.services.map((zi,zr)=>{var Yr,yr;return B.createElement("div",{className:"layer-group layer-checkbox",key:zr},B.createElement("span",{className:`arrow-service ${qo[zi.id]?"expanded":"collapsed"}`,onClick:()=>za(zi.id),style:{cursor:"pointer",marginRight:"8px"}}),B.createElement("input",{type:"checkbox",checked:Yn[`customer_${mi.customerAccountNo}`]===!0||Yn[`service_${zi.externalReferenceId}`]===!0,onChange:ti(`service_${zi.externalReferenceId}`,`${zi.id}`,`${zi.externalReferenceId}`)}),B.createElement("div",null," ",zi.externalReferenceId),qo[zi.id]&&B.createElement("div",{className:"layer-group",style:{width:"100%"}},B.createElement("div",{className:"sub-layer-group",style:{paddingLeft:"45px"}},zi.externalReferenceId.includes("PLC")&&B.createElement(B.Fragment,null,["Primary Path","Secondary Path","Restoration Path"].map(Hr=>{var rn,is,Ps;return B.createElement("div",{key:Hr,className:"path-type-row",style:{display:"flex",alignItems:"center"}},B.createElement("input",{type:"checkbox",checked:((rn=ei[zi.externalReferenceId])==null?void 0:rn[Hr])||!1,onChange:vs=>{const ra=vs&&vs.target?vs.target.checked:!1;Vt(Po=>({...Po,[zi.externalReferenceId]:{...Po[zi.externalReferenceId],[Hr]:ra}}))},disabled:!Yn[`service_${zi.externalReferenceId}`],style:{marginRight:"8px"}}),B.createElement("p",{className:"layer-label"},Hr==="Restoration Path"?"Tertiary Path":Hr),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((is=tr[zi.id])==null?void 0:is[Hr])||(Hr==="Active Path"?"#00A315":Hr==="Primary Path"?"#36CC36":Hr==="Secondary Path"?"#0023F5":Hr==="Restoration Path"?"#505050":"#36CC36"),border:"1px solid #ccc",marginLeft:"8px",opacity:Hr==="Active Path"?.4:1,pointerEvents:Hr==="Active Path"?"none":pi.includes(zi.id)?"auto":"none",cursor:pi.includes(zi.id)?"pointer":"default"},onClick:vs=>{console.log("Clicked on path type:"),mt("");const ra=document.querySelector(".scrollBarSideBar").scrollTop;console.log("Scroll Top:",ra);const Po=vs.target.offsetTop,Xl=document.querySelector("#dashboard-map").offsetHeight-410,lh={top:Math.min(Po-ra,Xl),left:350};console.log(pi),console.log(zi.id),pi.includes(zi.id)&&Cr({id:`${zi.id}_${Hr}`,serviceId:zi.id,pathType:Hr,offset:lh})}}),Mr&&Mr.id==`${zi.id}_${Hr}`&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:Mr.offset.top,left:Mr.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Cr(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((Ps=tr[zi.id])==null?void 0:Ps[Hr])||rt(Hr),onChange:vs=>{Pr(zi.externalReferenceId,zi.id,Hr)(vs)}})))})),zi.externalReferenceId.includes("DFC")&&B.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"6px"}},B.createElement("p",{className:"layer-label"},"Primary Path"),B.createElement("span",{className:"layer-dot ml-auto",style:{backgroundColor:((Yr=tr[zi.id])==null?void 0:Yr["Primary Path"])||"#36CC36",border:"1px solid #ccc",marginLeft:"8px",pointerEvents:pi.includes(zi.id)&&!zi.externalReferenceId.includes("DFC")?"auto":"none",cursor:pi.includes(zi.id)&&!zi.externalReferenceId.includes("DFC")?"pointer":"not-allowed",opacity:(zi.externalReferenceId.includes("DFC"),1)},onClick:Hr=>{mt("");const rn=document.querySelector(".scrollBarSideBar").scrollTop,is=Hr.target.offsetTop,vs=document.querySelector("#dashboard-map").offsetHeight-410,ra={top:Math.min(is-rn,vs),left:350};pi.includes(zi.id)&&Cr({id:`${zi.id}_Primary Path`,serviceId:zi.id,pathType:"Primary Path",offset:ra})}}),Mr&&Mr.id===`${zi.id}_Primary Path`&&B.createElement("div",{className:"colorPicker-box",style:{position:"absolute",top:Mr.offset.top,left:Mr.offset.left,zIndex:999}},B.createElement("button",{onClick:()=>Cr(null),className:"colorPicker-close-btn",title:"Close"},""),B.createElement(Gx,{constlDefaultColor:((yr=tr[zi.id])==null?void 0:yr["Primary Path"])||"#36CC36",onChange:Hr=>{Pr(zi.externalReferenceId,zi.id,"Primary Path")(Hr)}}))))))})):null))}))),Ie=="employee"&&!Q&&!q&&!he&&B.createElement("div",{className:"layer-group"},B.createElement("div",{className:"alert alert-warning mt-3"},"You don't have the required permissions to view Networks.")))))}),dce="/o/krypton-service-details-cx/assets/kmg-download-720cf938.png",pce="/o/krypton-service-details-cx/assets/kmz-upload-2148e3ff.png";function Ny(e){"@babel/helpers - typeof";return Ny=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ny(e)}function fce(e,t){if(Ny(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Ny(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function X$(e){var t=fce(e,"string");return Ny(t)=="symbol"?t:t+""}function Ns(e,t,n){return(t=X$(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function mce(e,t){if(e){if(typeof e=="string")return YN(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?YN(e,t):void 0}}function lc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XN(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,X$(s.key),s)}}function cc(e,t,n){return t&&XN(e.prototype,t),n&&XN(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function NI(e,t){return NI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},NI(e,t)}function bc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NI(e,t)}function g2(e){return g2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g2(e)}function Z$(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Z$=function(){return!!e})()}function qs(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gce(e,t){if(t&&(Ny(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qs(e)}function wc(e){var t=Z$();return function(){var n,s=g2(e);if(t){var a=g2(this).constructor;n=Reflect.construct(s,arguments,a)}else n=s.apply(this,arguments);return gce(this,n)}}const yce=({elementIds:e,selectedElementToggleOption:t,selectedElement:n,callKmzList:s,kmzList:a,handleKmzColorChange:d,employeeList:f,uploadKMZFilePermission:i,viewKMZFilePermission:S,shareKMZFilePermission:E,viewDataCenterButtonPermission:L,setKmzColorPattern:F,setKmzIdVal:G,setActiveColorPickerKmz:q,activeColorPickerKmz:Q,setKmzColors:te,kmzColors:he,setSelectedKMZ:fe,selectedKMZ:le,plotDataCenter:Se,clearAll:ke,fromVal:Ee,setFromVal:Ie,toVal:He,setToVal:Ye,downLoadKMZFile:lt,hasViewMapPermission:Pt,setIsKmzDropdownOpen:At,isKmzDropdownOpen:ht,isClearAllFilterEnabled:Ot,downloadKMZFilePermission:Ae})=>{const mt=wo(null),bt=wo(null),Dt=wo(null),[Je,dt]=It(!0),[ui,Vt]=It(!1),[ei,ur]=It(!1),[Zt,Kt]=It(!1),[Ui,rr]=It(!1),[gi,Oi]=It("");It(null);const[cr,ji]=It(!1),[nn,pr]=It([]),[Ue,ni]=It([]),[fi,Lt]=It(""),[pt,Nt]=It(""),[Si,pi]=It(!1),[St,Ht]=It(null),[nr,tr]=It(null),kr=wo(),Mr=wo(),[Cr,Tn]=It({competitor:"",competitorFileName:"",kmzFile:null}),[gs,wn]=It({}),[bs,qn]=It(""),Ls=wo(null);function ma(Fe){return Fe==null?void 0:Fe.toLowerCase().trim().replace(/\s+/g," ").replace(/[-_]/g,"-")}a.filter(Fe=>{const rt=`${Fe.competitor}-${Fe.kmzName}`;return ma(rt).includes(ma(pt))});const Ln=()=>{const Fe={};return Cr.competitorFileName.trim()?Cr.competitorFileName.length>500&&(Fe.competitorFileName="Name must be less than 500 characters"):Fe.competitorFileName="Name is required",Cr.kmzFile?/\.(kmz)$/i.test(Cr.kmzFile.name)||(Fe.kmzFile="Invalid file type. Only KMZ files are allowed"):Fe.kmzFile="KMZ File is required",(!Cr.competitor||Cr.competitor==="Select Category")&&(Fe.competitor="Category is required"),wn(Fe),Object.keys(Fe).length===0},qo=Fe=>{console.log("From Value Changed:",Fe.target.value),Ie(Fe.target.value)},zn=Fe=>{Ye(Fe.target.value)},za=async(Fe,rt)=>{const xt=rt.kmzFile;if(!xt)return;if(![".kmz",".kml"].some(Jt=>xt.name.toLowerCase().endsWith(Jt))){console.warn("Please upload a valid KML or KMZ file.");return}try{const Jt=new FormData;Jt.append("competitorGeoJSONFile",xt),Jt.append("competitorName",rt.competitor),Jt.append("kmzFileName",rt.competitorFileName),Jt.append("userId",Liferay.ThemeDisplay.getUserId()),console.log("Form Data to be submitted:",Jt),tr(Jt),console.log("GeoJSON conversion successful:",nr)}catch{}},$o=Fe=>{const{name:rt,value:xt,multiple:ft,options:Jt}=Fe.target;let xi,ti;ft?(xi=Array.from(Jt).filter(ai=>ai.selected).map(ai=>ai.value),ti={...Cr,[rt]:xi},Tn({...Cr,[rt]:xi})):(xi=xt,ti={...Cr,[rt]:xi},Tn({...Cr,[rt]:xi})),console.log("Updated Form Data before append:",ti),Cr.kmzFile&&za(Fe,ti),wn(ai=>{const Yi={...ai};return ft?xi&&xi.length>0&&delete Yi[rt]:xi&&delete Yi[rt],Yi})},Aa=()=>{Vt(!1),Tn({competitor:"",competitorFileName:"",kmzFile:null}),wn({}),tr(null),qn("")},ja=async Fe=>{var rt;if(Fe.preventDefault(),ji(!0),Ln()){const xt=await Uoe(nr);xt&&(xt!=null&&xt.data)?(ji(!1),Lt(((rt=xt==null?void 0:xt.data)==null?void 0:rt.message)||"KMZ file uploaded successfully."),Aa(),setTimeout(()=>{pi(!0),s()},1e3)):(ji(!1),qn(xt==null?void 0:xt.error))}else ji(!1)};Ar(()=>{if(a.length>0){const Fe={};a.forEach(rt=>{var xt;Fe[rt.id]={kmzId:rt.id,color:((xt=he[rt.id])==null?void 0:xt.color)||"#4CAF50"}}),te(Fe)}},[a]),Ar(()=>{F(he)},[he]),Ar(()=>{const Fe=rt=>{const xt=document.querySelector(".react-colorful"),ft=document.querySelectorAll('button[title="Pick color"]'),Jt=xt&&xt.contains(rt.target),xi=Array.from(ft).some(ti=>ti.contains(rt.target));!Jt&&!xi&&Ht(null)};return document.addEventListener("mousedown",Fe),()=>document.removeEventListener("mousedown",Fe)},[]),Ar(()=>{qoe().then(Fe=>{pr(Fe.data)}),Xoe().then(Fe=>{ni(Fe.data)})},[]),Ar(()=>{const Fe=rt=>{kr.current&&!kr.current.contains(rt.target)&&Kt(!1)};return document.addEventListener("mousedown",Fe),()=>{document.removeEventListener("mousedown",Fe)}},[]),Ar(()=>{const Fe=document.getElementsByClassName("custom-tooltip"),rt=Array.from(Fe).map(xt=>new window.bootstrap.Tooltip(xt));return()=>{rt.forEach(xt=>xt.dispose())}},[]);const Yn=Fe=>{Tn(xt=>({...xt,kmzFile:null}));const rt=Fe.target.files[0];rt&&rt.name.endsWith(".kmz")?(Tn({...Cr,kmzFile:rt}),wn(xt=>{const ft={...xt};return delete ft.kmzFile,ft})):wn(xt=>({...xt,kmzFile:"Invalid file type. Only KMZ files are allowed"})),Un(Fe)},hl=Fe=>{Fe.preventDefault(),Tn(xt=>({...xt,kmzFile:null}));const rt=Fe.dataTransfer.files[0];rt&&rt.name.endsWith(".kmz")?(Tn({...Cr,kmzFile:rt}),wn(xt=>{const ft={...xt};return delete ft.kmzFile,ft})):wn(xt=>({...xt,kmzFile:"Invalid file type. Only KMZ files are allowed"})),bl({file:rt})},fr=Fe=>{Fe.preventDefault()},tc=()=>{pi(!1)},Sh=()=>{rr(!0)},bl=async Fe=>{var ft;let rt;if((ft=Fe==null?void 0:Fe.target)!=null&&ft.files)rt=Fe.target.files[0];else if(Fe!=null&&Fe.file)rt=Fe.file;else return;if(!rt||![".kml",".kmz"].some(Jt=>rt.name.toLowerCase().endsWith(Jt))){console.warn("Please upload a valid KML or KMZ file.");return}try{const Jt=new FormData;Jt.append("competitorGeoJSONFile",rt),Jt.append("competitorName",Cr.competitor),Jt.append("kmzFileName",Cr.competitorFileName||rt.name),Jt.append("userId",Liferay.ThemeDisplay.getUserId()),tr(Jt)}catch(Jt){console.error("Failed to upload KML/KMZ file:",Jt)}},Un=async Fe=>{const rt=Fe.target.files[0];if(!rt)return;if(![".kmz",".kml"].some(ft=>rt.name.toLowerCase().endsWith(ft))){console.warn("Please upload a valid KML or KMZ file.");return}try{const ft=new FormData;ft.append("competitorGeoJSONFile",rt),ft.append("competitorName",Cr.competitor),ft.append("kmzFileName",Cr.competitorFileName||rt.name),ft.append("userId",Liferay.ThemeDisplay.getUserId()),tr(ft)}catch(ft){console.error("Failed to upload KML/KMZ file:",ft)}},vi=()=>{Dt.current&&Dt.current.classList.contains("element-gis")&&dt(Fe=>!Fe)},Ge=()=>{console.log("Download KMZ called"),lt()};return Ar(()=>{console.log("From Value:",Ee),console.log("To Value:",He),Ee&&He&&(console.log("Plotting Data Center with values:",Ee,He),Se(Ee,He))},[Ee,He]),Ar(()=>{const Fe=e.find(rt=>rt.name&&rt.name.toLowerCase()==="cable");Fe&&!n.includes(Fe.id)&&t(Fe.id)},[e]),Ar(()=>{const Fe=()=>{if(Dt.current){Dt.current.classList.remove("element-gis");const xt=document.querySelector(".right-controls");if(xt)if(console.log("buttonGroupEl.scrollHeight",xt.scrollHeight),console.log("buttonGroupEl.clientHeight",xt.clientHeight),xt.scrollHeight>57){Dt.current.classList.add("element-gis");const ft=document.querySelector(".element-options-gis");ft&&(ft.style.minWidth="385px"),dt(!0)}else{Dt.current.classList.remove("element-gis");const ft=document.querySelector(".element-options-gis");ft&&(ft.style.minWidth=""),dt(!0)}}};window.addEventListener("resize",Fe);let rt;return Dt.current&&(rt=new window.ResizeObserver(Fe),rt.observe(Dt.current)),Fe(),()=>{window.removeEventListener("resize",Fe),rt&&Dt.current&&(rt.unobserve(Dt.current),rt.disconnect())}},[]),Ar(()=>{if(!ht)return;const Fe=rt=>{console.log("Clicked outside KMZ dropdown"),Mr.current&&!Mr.current.contains(rt.target)&&(q(null),At(!1))};return document.addEventListener("mousedown",Fe),()=>{document.removeEventListener("mousedown",Fe)}},[ht]),Ar(()=>{ht&&setTimeout(()=>{const Fe=document.querySelectorAll('.kmz-dropdown .custom-tooltip[data-toggle="tooltip"]'),rt=Array.from(Fe).map(xt=>new window.bootstrap.Tooltip(xt));return()=>{rt.forEach(xt=>xt.dispose())}},0)},[ht]),uu(mt,qo,[Ue]),uu(bt,zn,[Ue]),B.createElement(B.Fragment,null,B.createElement("div",{className:"right-controls"},L&&B.createElement("div",{className:`dropdown ${Zt?"show":""}`,ref:kr},B.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>Kt(Fe=>!Fe)},B.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B.createElement("path",{d:"M9 5H21",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M3 5H5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M9 12H21",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M3 12H5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M9 19H21",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}),B.createElement("path",{d:"M3 19H5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round"}))," ","DC"),B.createElement("div",{className:`dropdown-menu p-3 mt-3 data-centre-dropdown ${Zt?"show":""}`,onClick:Fe=>Fe.stopPropagation()},B.createElement("div",{class:"dropdown-inner"},B.createElement("div",{class:"legend-section-wrap"},B.createElement("div",{class:"legend-section"},"Data Centres"),B.createElement("div",{class:"legend-section-content"},B.createElement("div",{class:"form-group"},B.createElement("label",{for:"announcementType",class:"datacenter-label"},"From:"),B.createElement("select",{className:"custom-select",name:"competitorFrom",id:"competitorFrom",ref:mt,value:Ee,onChange:qo},B.createElement("option",{selected:!0},"Select DC"),Ue&&Ue.length>0?Ue.filter(Fe=>(Fe==null?void 0:Fe.id)!=He).map(Fe=>B.createElement("option",{key:Fe==null?void 0:Fe.id,value:Fe==null?void 0:Fe.id},Fe==null?void 0:Fe.buildingName)):B.createElement("option",{disabled:!0},"No DC Available"))),B.createElement("div",{class:"form-group"},B.createElement("label",{for:"announcementType",class:"datacenter-label"},"To:"),B.createElement("select",{className:"custom-select",name:"competitorTo",id:"competitorTo",ref:bt,value:He,onChange:zn},B.createElement("option",{selected:!0},"Select DC"),Ue&&Ue.length>0?Ue.filter(Fe=>(Fe==null?void 0:Fe.id)!=Ee).map(Fe=>B.createElement("option",{key:Fe==null?void 0:Fe.id,value:Fe==null?void 0:Fe.id},Fe==null?void 0:Fe.buildingName)):B.createElement("option",{disabled:!0},"No DC Available")))))))),B.createElement("div",{className:"form-group-inline loader_wrap"},B.createElement("div",{className:"gis-label",ref:Dt},e.some(Fe=>Fe.hasPermission)&&B.createElement("label",{className:`label-btn${Dt.current&&Dt.current.classList.contains("element-gis")?" clickable":""}`,htmlFor:"elementId",onClick:vi,style:{cursor:Dt.current&&Dt.current.classList.contains("element-gis")?"pointer":"default"}},"Elements",B.createElement("span",null,":")),(Je||!(Dt.current&&Dt.current.classList.contains("element-gis")))&&e.length>0&&B.createElement("div",{className:"button-group element-options-gis",style:Dt.current&&Dt.current.classList.contains("element-gis")?{minWidth:"385px"}:{}},e.filter(Fe=>Fe.hasPermission).map(Fe=>B.createElement("button",{key:Fe.id,className:`option-button ${n.includes(Fe.id)?"selected":""}`,onClick:()=>t(Fe.id)},B.createElement("img",{src:Fe.iconURL,alt:"",style:{width:"32px",height:"39px",marginRight:"4px",verticalAlign:"middle"}}),Fe.name)))),i&&B.createElement("button",{onClick:()=>Vt(!0),className:"btn btn-primary custom-tooltip kmz-button","data-toggle":"tooltip","data-placement":"top",title:"Upload KMZ"},B.createElement("img",{src:pce,alt:"",width:24})),Ae&&B.createElement("button",{onClick:()=>Ge(),className:"btn btn-primary custom-tooltip kmz-button","data-toggle":"tooltip","data-placement":"top",title:"Download KMZ"},B.createElement("img",{src:dce,alt:"",width:24})),B.createElement("button",{onClick:()=>Sh(),className:"btn btn-primary custom-tooltip clear-all-btn",disabled:!Ot,"data-toggle":"tooltip","data-placement":"top",title:"Clear All"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"layers_clear")))),cr&&B.createElement("div",{className:"loader"}),Ui&&B.createElement("div",{className:"modal theme-modal d-block custom-modal",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"}),B.createElement("div",{className:"modal-body"},B.createElement("div",{className:"ticket-details-success"},B.createElement("div",{className:"details"},"Are you sure you want to clear all selections?"))),B.createElement("div",{className:"modal-footer"},B.createElement("button",{className:"button button-outline",onClick:()=>rr(!1)},"No"),B.createElement("button",{className:"button button-primary",onClick:()=>{ke(),rr(!1)}},"Yes"))))),Si&&B.createElement("div",{className:"modal theme-modal d-block custom-modal",id:"confirtmationSuccessModel"},B.createElement("div",{className:"modal-dialog modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},B.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:tc},B.createElement("span",{className:"material-symbols-outlined constl-icon"},""))),B.createElement("div",{className:"modal-body"},B.createElement("div",{className:"ticket-details-success"},B.createElement("div",{className:"icon"},B.createElement("img",{src:Y$,alt:""})),B.createElement("div",{className:"status-message"},"Congratulations!"),B.createElement("div",{className:"details"},fi)))))),B.createElement(q$,{employeeList:f,setIsSuccessModalOpen:pi,setKmzSuccessMessage:Lt,setSelectedKmzShare:Oi,selectedKmzShare:gi,setIsShareModalOpen:ur,isShareModalOpen:ei,setIsLoadingModal:ji}),ui&&B.createElement("div",{className:"modal theme-modal custom-modal",id:"kmzModal",style:{display:"block"}},B.createElement("div",{className:"modal-dialog modal-xl modal-dialog-centered"},B.createElement("div",{className:"modal-content"},B.createElement("div",{className:"modal-header"},B.createElement("h4",{className:"modal-title"},"Upload KMZ File"),B.createElement("button",{type:"button",className:"close",onClick:Aa},B.createElement("span",{className:"material-symbols-outlined constl-icon"},""))),B.createElement("div",{class:"modal-body"},B.createElement("div",{class:"confirmationUserRole mb-25"},bs&&B.createElement("div",{class:""},B.createElement("div",{class:"alert alert-danger mb-3 mt-3",role:"alert"},bs)),B.createElement("div",{class:"description"},B.createElement("div",{className:"row"},B.createElement("div",{className:"col-md-6 mb-25"},B.createElement("div",{className:"form-group"},B.createElement("label",{for:"announcementType"},"Category ",B.createElement("span",null,"*")),B.createElement("select",{className:"custom-select",name:"competitor",id:"competitor",value:Cr==null?void 0:Cr.competitor,onChange:$o},B.createElement("option",{selected:!0},"Select Category"),nn&&nn.length>0?nn.map(Fe=>B.createElement("option",{key:Fe==null?void 0:Fe.id,value:Fe==null?void 0:Fe.category},Fe==null?void 0:Fe.category)):B.createElement("option",{disabled:!0},"No Category Available")),gs.competitor&&B.createElement("small",{className:"text-danger"},gs.competitor))),B.createElement("div",{className:"col-md-6 mb-25"},B.createElement("div",{className:"form-group textarea"},B.createElement("label",{for:"announcementType"},"Name ",B.createElement("span",null,"*")),B.createElement("input",{type:"text",name:"competitorFileName",placeholder:"Enter Name",value:Cr==null?void 0:Cr.competitorFileName,className:"form-control",onChange:$o}),gs.competitorFileName&&B.createElement("small",{className:"text-danger"},gs.competitorFileName)))))),B.createElement("div",{className:"mb-25"},B.createElement("div",{class:"form-group"},B.createElement("label",null,"KMZ File ",B.createElement("span",null,"*")),B.createElement("div",{className:"drop-zone",onDrop:hl,onDragOver:fr,onClick:()=>document.getElementById("hiddenFileInput").click()},B.createElement("p",null,"Drag and drop your KMZ file here",B.createElement("br",null),B.createElement("small",null,"(or click here to select)"))),B.createElement("input",{type:"file",id:"hiddenFileInput",accept:".kmz",ref:Ls,style:{display:"none"},onChange:Yn}),Cr.kmzFile&&B.createElement("small",{className:"text-success"},"Selected: ",Cr.kmzFile.name),gs.kmzFile&&B.createElement("small",{className:"text-danger"},gs.kmzFile)))),B.createElement("div",{className:"modal-footer"},B.createElement("button",{"data-dismiss":"modal",className:"button button-outline",onClick:Aa},"Close"),B.createElement("button",{className:"button button-primary",onClick:ja},"Upload"))))))},_ce=({userType:e="employee",redirectFrom:t="dashboard",mapClass:n,networkDataConfig:s})=>{const a=wo(),d=wo(),[f,i]=It([]),[S,E]=It([]),[L,F]=It(),[G,q]=It([]),[Q,te]=It([]),[he,fe]=It([]),[le,Se]=It([]),[ke,Ee]=It([]),[Ie,He]=It(!1),[Ye,lt]=It(!0),[Pt,At]=It([]),[ht,Ot]=It([]),[Ae,mt]=It(null),[bt,Dt]=It(null),[Je,dt]=It(null),[ui,Vt]=It(!0),[ei,ur]=It(!0),[Zt,Kt]=It({}),[Ui,rr]=It([]),[gi,Oi]=It(null),[cr,ji]=It(!1),[nn,pr]=It(null),[Ue,ni]=It(null),[fi,Lt]=It(null),[pt,Nt]=It(null),[Si,pi]=It({}),[St,Ht]=It(null),[nr,tr]=It(null),[kr,Mr]=It(null),[Cr,Tn]=It(null),[gs,wn]=It(0),[bs,qn]=It([]),[Ls,ma]=It([]),[Ln,qo]=It([]),[zn,za]=It({}),[$o,Aa]=It([]),[ja,Yn]=It([]),[hl,fr]=It(!1),[tc,Sh]=It(!1),[bl,Un]=It(!1),[vi,Ge]=It(!1),[Fe,rt]=It(!1),[xt,ft]=It(!1),[Jt,xi]=It("#A349A4"),[ti,ai]=It(!1),[Yi,Fi]=It(!1),[Pr,ln]=It(!1),[Qr,Or]=It(!1),[ii,xr]=It(!1),[Xr,tn]=It(!1),[Jn,ds]=It({}),[mi,_r]=It({}),[zi,zr]=It(""),[Yr,yr]=It(""),[Hr,rn]=It(""),[is,Ps]=It(""),[vs,ra]=It(null);let Po=Je?Je.includes("PLC")?"privateLine":"darkFiber":null;Ar(()=>{const Ds=()=>{Liferay.on("allPortletsReady",function(){let Ys=document.getElementsByTagName("krypton-employee-map-cx");if(Ys&&Ys.length>0){let Cs=Ys[0].getAttribute("data-networkConfig");if(console.log("networkConfigEnc: ",Cs),Cs!=null&&Cs!=null){let to=atob(Cs);_r(JSON.parse(to))}}})};console.log("networkDataConfig: ",s),s&&typeof s=="object"&&(s!=null&&s.data)?_r(s):Ds()},[s]),Ar(()=>{var Ds,Ys,Cs,to;console.log("networkConfig: ",mi),mi&&(zr((Ys=(Ds=mi==null?void 0:mi.data)==null?void 0:Ds.invalidServiceConfig)==null?void 0:Ys.value),yr((to=(Cs=mi==null?void 0:mi.data)==null?void 0:Cs.networkServiceConfig)==null?void 0:to.value))},[mi]);const Sc=async(Ds,Ys,Cs,to,Xs,Bs,ba)=>{try{Ys=Ys||-1,Ds=Ds||1,to=to||0,Xs=Xs||0;const ca=await Foe(Ds,Ys,Cs,to,Xs,Bs,ba);return ca.data.length,ca}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},Xl=async Ds=>{try{const Ys=await zoe(Ds);return Ys.data.length,Ys}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},lh=()=>{_u().then(Ds=>{Ee(Ds.data)})},ps=async()=>{console.log("Downloading KMZ file..."),d.current&&d.current.downloadAllRoutesAsKmz&&d.current.downloadAllRoutesAsKmz()},la=async(Ds,Ys,Cs,to,Xs,Bs,ba)=>{try{Ys=Ys||-1,Ds=Ds||1,to=to||0,Xs=Xs||0;const ca=await Roe(Ds,Ys,Cs,to,Xs,Bs,ba);return ca.data.length,ca}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},$u=async(Ds,Ys,Cs,to,Xs,Bs,ba)=>{try{Ys=Ys||-1,Ds=Ds||1,to=to||0,Xs=Xs||0;const ca=Number(Liferay.ThemeDisplay.getUserId()),fh=await Noe(ca);return fh.data.length,fh}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},_u=async()=>{try{const Ds=Number(Liferay.ThemeDisplay.getUserId()),Ys=await $oe(Ds);return Ys.data.length,Ys}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},ch=async()=>{try{const Ds=await Voe();return Ds.data.length,Ds}catch{return{data:[],page:1,pageSize:10,lastPage:1,totalCount:0}}},Lc=Ds=>{qo(Ys=>{const Cs=Ys.includes(Ds);return za({option:Ds,isSelected:!Cs}),Cs?Ys.filter(to=>to!==Ds):[...Ys,Ds]})},zc=(Ds,Ys)=>{console.log("Plotting Data Center from",Ds,"to",Ys),lt(!0),At([Ds,Ys])},Kh=()=>{qo([]),za({}),qn([]),rn(""),Ps(""),a.current&&a.current.resetAll(),d.current&&d.current.clearDataCenterServices&&d.current.clearDataCenterServices(),d.current&&d.current.removeAllDataCenterMarkers&&d.current.removeAllDataCenterMarkers(),d.current&&d.current.resetMap&&d.current.resetMap()},ul=Ds=>{qn(Ds)},Uc=Ds=>{ma(Ds)},du=Ds=>Yc(Ds);if(Ar(()=>{const Ds=async()=>{var to;const Cs=await jB(Liferay.ThemeDisplay.getUserId(),Liferay.ThemeDisplay.getSiteGroupId());if((Cs==null?void 0:Cs.status)==200||((to=Cs==null?void 0:Cs.data)==null?void 0:to.statusCode)==200){const Xs=Cs==null?void 0:Cs.data;mt(Xs),e=="customer"&&Xs&&Xl(Xs).then(Bs=>{fe(Bs.data)})}};(async()=>{let Cs,to;const Xs=Number(Liferay.ThemeDisplay.getUserId()),Bs=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","UploadKMZFile"),ba=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewKMZFile"),ca=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ShareKMZFile"),fh=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","DownloadKMZFile");e==="customer"?(to={data:!0},Cs=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.Dashboard","ViewMap")):(to=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewAllCustomerList"),Cs=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewMap"));const Il=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewConstlNetwork"),Dp=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewProjectCode"),Th=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewDataCenterButton"),Vs=await qg(Xs,"CX Krypton Permission","com.constl.krypton.rbac.GIS","ViewFilter");(Bs==null?void 0:Bs.data)===!0&&Sh(!0),(fh==null?void 0:fh.data)===!0&&Un(!0),(ba==null?void 0:ba.data)===!0&&Ge(!0),(Vs==null?void 0:Vs.data)===!0&&rt(!0),(ca==null?void 0:ca.data)===!0&&ft(!0),(to==null?void 0:to.data)===!0&&ai(!0),(Cs==null?void 0:Cs.data)===!0&&Fi(!0),(Il==null?void 0:Il.data)===!0&&ln(!0),(Dp==null?void 0:Dp.data)===!0&&Or(!0),(Th==null?void 0:Th.data)===!0&&xr(!0),tn(!0)})(),Ds(),e=="employee"&&(Sc().then(Cs=>{fe(Cs.data)}),la().then(Cs=>{q(Cs.data)}),$u().then(Cs=>{Se(Cs.data)}),lh(),ch().then(Cs=>{te(Cs.data)})),e=="customer"&&$u().then(Cs=>{Se(Cs.data)})},[]),Ar(()=>{Je?ra(null):S.length>0?ra(S.join(",")):ra(null)},[Je,S]),Ar(()=>{Ln&&Ln.length>0||Hr&&is||bs&&bs.length>0||Ls&&Ls.length>0||ht&&ht.length>0||gs&&gs>0?He(!0):He(!1)},[Ln,Hr,is,bs,Ls,ht,gs]),Ar(()=>{const Ds=()=>{ji(document.querySelector(".mapbox-wrap .loader")!==null)};Ds();const Ys=new MutationObserver(Ds);return Ys.observe(document.body,{childList:!0,subtree:!0}),()=>Ys.disconnect()},[]),Ar(()=>{const Ds=()=>{document.fullscreenElement&&window.$&&window.$('[data-toggle="tooltip"]').tooltip("dispose").tooltip({container:document.fullscreenElement})};return document.addEventListener("fullscreenchange",Ds),()=>{document.removeEventListener("fullscreenchange",Ds)}},[]),!Xr)return B.createElement("div",{className:"container"},B.createElement("div",{className:"row dashboard-widgets mb-15 loader_wrap"},B.createElement("div",{className:"col-md-12 col-sm-12"})));const Yc=async Ds=>{const Ys=await Boe(Ds,zi,Yr);let Cs;if(ni(to=>(to==null?void 0:to.find(Bs=>Bs.customerId===Ds))?(console.log("Existing customer found. Updating services..."),Cs=to.map(Bs=>Bs.customerId===Ds?{...Bs,services:[...Bs.services,...Ys.data.filter(ba=>!Bs.services.some(ca=>ca.id===ba.id))]}:Bs),Cs):(console.log("Adding new customer with services..."),Cs=[...to||[],{customerId:Ds,services:Ys.data}],Cs)),e==="customer"&&Array.isArray(Ys.data)){const to=Ys.data.map(Xs=>Xs.externalReferenceId);Yn(to)}return Cs};return B.createElement(B.Fragment,null,B.createElement("div",{className:`row dashboard-widgets map-container ${n||""}`},B.createElement("div",{className:"col-md-12 col-sm-12"},B.createElement("div",{className:`card loader_wrap ${n||""} ${ui?"map-container-standard":"map-container-fluid"} ${cr?" loader-present":""}`},Yi?B.createElement(B.Fragment,null,t=="dashboard"&&B.createElement("div",{className:"card-header"},B.createElement("div",{className:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"location_on"),"Service Map"),B.createElement(yce,{elementIds:le,selectedElementToggleOption:Lc,selectedElement:Ln,callKmzList:lh,kmzList:ke,handleKmzColorChange:Uc,employeeList:Q,uploadKMZFilePermission:tc,viewKMZFilePermission:vi,shareKMZFilePermission:xt,viewDataCenterButtonPermission:ii,downloadKMZFilePermission:bl,setKmzColorPattern:Lt,setKmzIdVal:Ht,setActiveColorPickerKmz:Oi,activeColorPickerKmz:gi,setKmzColors:Kt,kmzColors:Zt,setSelectedKMZ:rr,selectedKMZ:Ui,clearAll:Kh,plotDataCenter:zc,fromVal:Hr,setFromVal:rn,toVal:is,setToVal:Ps,hasViewMapPermission:Yi,downLoadKMZFile:ps,setIsKmzDropdownOpen:fr,isKmzDropdownOpen:hl,isClearAllFilterEnabled:Ie})),t=="service details"&&B.createElement("div",{className:"card-header"},B.createElement("div",{className:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"location_on"),"Service Map")),B.createElement("div",{className:"card-body",id:"dashboard-map"},B.createElement("div",{className:"map-overbox"},t=="dashboard"&&B.createElement(uce,{ref:a,projectCodes:G,selectedProjectCodes:bs,handleProjectCodeChange:ul,customerIds:he,setSelectedCustomer:pr,handleCallServiceMap:du,customerService:Ue,kmzList:ke,handleKmzColorChange:Uc,selectedKmzValue:Ls,setCustomerSpecificServiceLayer:Aa,setSelectedCustomerId:fe,setKmzColorPattern:Lt,setKmzIdVal:Ht,viewKMZFilePermission:vi,shareKMZFilePermission:xt,setProjectCodeColorPattern:Nt,setProjectCodeIdVal:tr,viewAllCustomerPermission:ti,viewConstlNetworkPermission:Pr,viewProjectCodePermission:Qr,employeeList:Q,setConstlDefaultColor:xi,constlDefaultColor:Jt,setServiceCodeColorPattern:pi,setServiceIdVal:Mr,userType:e,customerAccountNumber:Ae,setActiveColorPickerKmz:Oi,activeColorPickerKmz:gi,setKmzColors:Kt,kmzColors:Zt,setSelectedKMZ:rr,selectedKMZ:Ui,setServiceIdValRef:Tn,setUncheckedServiceIds:F,setIsKmzDropdownOpen:fr,setSelectedServicesIdsVal:Ot,setSelectCustomerCount:wn,setCheckedServiceIdsByCustomer:Yn,setStopApiCallEmp:ur,setServicePathSelection:ds,servicePathSelection:Jn}),B.createElement(dae,{ref:d,key:Je??vs,redirectFrom:t,serviceId:Je??vs,customerAccountNo:Ae,servicesData:f,setServiceTopology:Dt,serviceTopology:bt,productName:Po,hasViewMapPermission:Yi,hasTopologyPermission:!1,customerIds:he,selectedProjectCodes:bs,selectedElement:Ln,selectedKmzValue:Ls,kmzList:ke,projectCodes:G,customerServiceResponse:Ue,customerSpecificServiceLayer:$o,kmzColorPattern:fi,kmzIdVal:St,setResizeConatiner:Vt,elementIds:le,projectCodeColorPattern:pt,projectCodeIdVal:nr,constlDefaultColor:Jt,serviceCodeColorPattern:Si,serviceIdVal:kr,userType:e,selectedElementToggle:zn,setHasMoreDatacenter:lt,hasMoreDatacenter:Ye,selectedDataCenter:Pt,serviceIdValRef:Cr,unCheckedServiceIds:L,resizeConatiner:ui,checkedServiceIdsByCustomer:ja,stopApiCallEmp:ei,servicePathSelection:Jn,viewCablePermission:Fe,invalidId:zi,networkServiceValue:Yr})))):B.createElement("div",{className:"alert alert-warning mt-3"},"You don't have the required permissions to view map.")))))},vce="/o/krypton-service-details-cx/assets/xls-icon-4950a15b.svg",xce="/o/krypton-service-details-cx/assets/pdf-icon-5a0c0cf8.svg",bce=({fileByteArr:e,resetExportType:t,fileName:n,serviceType:s,activeTab:a})=>(Ar(()=>{if(s!=null&&a!=null){if(s===a){if(console.debug("download export",s,a),console.debug("useEffect fileByteArr",e),!e){console.error("No file data available");return}let d;try{d=atob(e)}catch{return}const f=Uint8Array.from(d,L=>L.charCodeAt(0)),i=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),S=URL.createObjectURL(i),E=document.createElement("a");E.href=S,E.download=n,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(S),t&&t(null)}}else{if(!e){console.error("No file data available");return}let d;try{d=atob(e)}catch(L){console.error("Error decoding base64 file data",L);return}const f=Uint8Array.from(d,L=>L.charCodeAt(0)),i=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),S=URL.createObjectURL(i),E=document.createElement("a");E.href=S,E.download=n,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(S),t&&t(null)}},[e]),null),wce=({fileByteArr:e,resetExportType:t,fileName:n,serviceType:s,activeTab:a})=>(Ar(()=>{if(s!=null&&a!=null){if(s===a){if(console.debug("download export",s,a),console.debug("useEffect fileByteArr",e),!e){console.error("No file data available");return}let d;try{d=atob(e)}catch{return}const f=Uint8Array.from(d,L=>L.charCodeAt(0)),i=new Blob([f],{type:"application/pdf"}),S=URL.createObjectURL(i),E=document.createElement("a");E.href=S,E.download=n,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(S),t&&t(null)}}else{if(!e){console.error("No file data available");return}let d;try{d=atob(e)}catch{return}const f=Uint8Array.from(d,L=>L.charCodeAt(0)),i=new Blob([f],{type:"application/pdf"}),S=URL.createObjectURL(i),E=document.createElement("a");E.href=S,E.download=n,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(S),t&&t(null)}},[e]),null),Sce=({resetExportType:e,fileName:t,fileByteArr:n,handleExport:s,pdfTriggerDownload:a,excelTriggerDownload:d,activeTab:f,serviceType:i,exportDisable:S,isDisabled:E=!1})=>{const[L,F]=It(!1);Ar(()=>{console.debug("inside useEffect of setIsDisabled::",S,E),F(S||E)},[S,E]);const G=q=>{i!=null&&f!=null?i==f&&s(q,i):s(q)};return B.createElement(B.Fragment,null,B.createElement("div",{className:"dropdown"},B.createElement("button",{className:"dropdown-toggle",type:"button","data-toggle":"dropdown",style:{cursor:L?"not-allowed":"pointer"},disabled:L},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"download")),B.createElement("ul",{className:"dropdown-menu arrow-top"},B.createElement("li",{onClick:()=>G("pdf")},B.createElement("a",{href:"javascript:void(0)",title:"Export to PDF"},B.createElement("img",{src:xce,alt:"pdf"}),"PDF")),B.createElement("li",{onClick:()=>G("excel")},B.createElement("a",{href:"javascript:void(0)",title:"Export to Excel"},B.createElement("img",{src:vce}),"Excel")))),a&&B.createElement(wce,{fileByteArr:n,resetExportType:e,fileName:t,serviceType:i,activeTab:f}),d&&B.createElement(bce,{fileByteArr:n,resetExportType:e,fileName:t,serviceType:i,activeTab:f}))},Tce=({key:e,filterData:t,onChange:n,selectedValue:s})=>{const a=t.elementID??"",d=t.elementLabel??"",f=t.defaultOptionLabel??"",i=t.staticValues??[];console.debug("krypton-entity-filter-cx  -> StaticDropdown -> staticValues -> ",i);const[S,E]=It([]),[L,F]=It(!0),G=()=>{try{E(i.map(Q=>({key:Q.key,text:Q.text}))||[])}catch(Q){console.debug("krypton-entity-filter-cx  -> StaticDropdown -> Error -> ",Q)}};Ar(()=>{G()},[t]);const q=()=>{F(!L)};return B.createElement(B.Fragment,null,B.createElement("div",{className:"input-group-header mt-2",onClick:()=>q()},B.createElement("div",null,d),L?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),L&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("select",{id:a,name:a,className:"custom-select",onChange:Q=>n(Q.target.value),value:s==""?{defaultOptionLabel:f}:s},B.createElement("option",{value:""},f),S.length>0&&S.map(Q=>B.createElement("option",{value:Q.key},Q.text)))))))},Cce=({tab:e,key:t,filterData:n,onChange:s,selectedValue:a,dropdownReset:d,moduleName:f})=>{const i=n.elementID??"",S=n.elementLabel??"",E=n.defaultOptionLabel??"",L=n.fieldData??{},F=n.restBuilderApiURL??"",G=n.propsData??[],q=n.countryId??0,[Q,te]=It(!0);console.debug("krypton-entity-filter-cx  -> DynamicDropdown -> propsData -> ",G),console.debug("krypton-entity-filter-cx  -> DynamicDropdown -> module -> ",f);const[he,fe]=It([]),le=async ke=>{var Ee,Ie,He,Ye;try{let lt=JSON.stringify(G);lt.includes("$_countryId_$")&&(lt=lt.replaceAll("$_countryId_$",`'${q}'`)),lt.includes("$_groupId_$")&&(lt=lt.replaceAll("$_groupId_$",Number(Liferay.ThemeDisplay.getSiteGroupId())));let Pt=btoa(lt),At=Liferay.ThemeDisplay.getUserId();const ht=Liferay.ThemeDisplay.getSiteGroupId(),Ot=await Go.get(`${F}?propsData=${Pt}&userId=${At}&siteId=${ht}`);if(console.debug("krypton-entity-filter-cx  -> DynamicDropdown -> response -> ",Ot),ke==="AuditLog"&&(L==null?void 0:L.key)=="type"){console.debug("inside module name is auditlog");const Ae=(Ie=(Ee=Ot==null?void 0:Ot.data)==null?void 0:Ee.facets)==null?void 0:Ie.find(bt=>bt.facetCriteria==="type");console.debug("krypton-entity-filter-cx -> DynamicDropdown -> typeFacet -> ",Ae);const mt=((He=Ae==null?void 0:Ae.facetValues)==null?void 0:He.map(bt=>({key:bt.term,text:bt.term})))||[];fe(mt)}else{const Ae=L==null?void 0:L.key,bt=((L==null?void 0:L.text)||"").split(",").map(Je=>Je.trim()).filter(Boolean),Dt=Array.from(new Map((((Ye=Ot==null?void 0:Ot.data)==null?void 0:Ye.items)||[]).map(Je=>[Je[Ae],Je])).values());fe(Dt.map(Je=>({key:Je[Ae],text:bt.map(dt=>Je[dt]).join(" ").trim()}))||[])}console.debug("krypton-entity-filter-cx  -> DynamicDropdown -> options -> ",he)}catch(lt){console.debug("krypton-entity-filter-cx  -> DynamicDropdown -> Error -> ",lt)}};Ar(()=>{le(f)},[n]);const Se=()=>{te(!Q)};return B.createElement(B.Fragment,null,B.createElement("div",{className:"input-group-header mt-2",onClick:()=>Se()},B.createElement("div",null,S),Q?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),Q&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("select",{id:i,name:i,className:"custom-select",onChange:ke=>s(ke.target.value),value:a==""?{defaultOptionLabel:E}:a},B.createElement("option",{value:""},E),he.length>0&&he.map(ke=>B.createElement("option",{value:ke.key},ke.text)))))))},Ece=({key:e,filterData:t,onChange:n,selectedValue:s})=>{const a=t.elementID??"",d=t.elementLabel??"",f=t.defaultOptionLabel??"",i=t.staticValues??[],[S,E]=It(!0);console.debug("krypton-entity-filter-cx  -> Select2Dropdown -> staticValues -> ",i);const[L,F]=It([]),G=he=>{AUI.$(he).select2()},q=()=>{try{F(i.map(he=>({key:he.key,text:he.text}))||[])}catch(he){console.debug("krypton-entity-filter-cx  -> Select2Dropdown -> Error -> ",he)}},Q=()=>{let he=AUI.$("#"+a);G(he)};Ar(()=>{q(),Q()},[t]);const te=()=>{E(!S)};return B.createElement(B.Fragment,null,B.createElement("div",{className:"input-group-header mt-2",onClick:()=>te()},B.createElement("div",null,d),S?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),S&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("select",{id:a,name:a,className:"custom-select",onChange:he=>n(he.target.value),value:s==""?{defaultOptionLabel:f}:s},B.createElement("option",{value:""},f),L.length>0&&L.map(he=>B.createElement("option",{value:he.key},he.text)))))))},kce=({key:e,tab:t,filterData:n,onChange:s,selectedValue:a,resetFilter:d,entityTypeId:f,isDashboardSMFilter:i,customerAccountNo:S})=>{const E=n.elementID??"",L=n.elementLabel??"",F=n.defaultOptionLabel??"",G=n.fieldData??{},q=n.restBuilderApiURL??"",Q=n.propsData??[],te=n.countryId??0,he=n.isDateFilter??!1,[fe,le]=It(!0);console.debug("krypton-entity-filter-cx  -> Select2DynamicDropdown -> propsData -> ",Q);const[Se,ke]=It([]),Ee=wo(null);console.log("isDateFilter>> ",he);const Ie=()=>{const ht=new Date,Ot=new Date(Date.UTC(ht.getUTCFullYear(),ht.getUTCMonth(),ht.getUTCDate(),23,59,59)),Ae=new Date(Date.UTC(ht.getUTCFullYear(),ht.getUTCMonth(),ht.getUTCDate()-90,0,0,0)),mt=bt=>bt.toISOString().split(".")[0]+"Z";return{greaterThanDate:mt(Ae),lessThanDate:mt(Ot)}},{greaterThanDate:He,lessThanDate:Ye}=Ie(),lt=async()=>{var ht,Ot,Ae;try{let mt=Q.filters;console.debug("filtersObj :: ",mt),he&&(Array.isArray(mt.fields)&&mt.fields.forEach(Ui=>{Ui.operator==="ge"&&Ui.key==="createdTime"&&(Ui.value=`${He}`),Ui.operator==="le"&&Ui.key==="createdTime"&&(Ui.value=`${Ye}`)}),Q.filters=mt),console.debug("filtersObj after update :: ",Q.filters);let bt=JSON.stringify(Q);bt.includes("$_productName_$")&&(bt=bt.replaceAll("$_productName_$",`'${t}'`)),bt.includes("$_entityTypeId_$")&&(bt=bt.replaceAll("$_entityTypeId_$",`'${f}'`)),bt.includes("$_countryId_$")&&(bt=bt.replaceAll("$_countryId_$",`'${te}'`)),bt.includes("$_groupId_$")&&(bt=bt.replaceAll("$_groupId_$",Number(Liferay.ThemeDisplay.getSiteGroupId())));let Dt=btoa(bt),Je=Liferay.ThemeDisplay.getUserId();const dt=Liferay.ThemeDisplay.getSiteGroupId(),ui=await Go.get(`${q}?propsData=${Dt}&userId=${Je}&siteId=${dt}`),Vt=G==null?void 0:G.key,ei=G==null?void 0:G.text,ur=G==null?void 0:G.mappingKey,Zt=Array.from(new Map((ht=ui==null?void 0:ui.data)==null?void 0:ht.items.map(Ui=>[Pt(Ui,Vt),Ui])).values()),Kt=((G==null?void 0:G.text)||"").split(",").map(Ui=>Ui.trim());if((Ot=ui==null?void 0:ui.data)!=null&&Ot.items&&ur&&i&&S){const rr=(((Ae=ui==null?void 0:ui.data)==null?void 0:Ae.items)||[]).flatMap(cr=>(cr[ur]||[]).filter(ji=>ji.customerAccountNo===S)),gi=rr==null?void 0:rr.map(cr=>({key:cr[Vt],text:cr[Vt]})),Oi=[...new Map(gi.map(cr=>[cr.key,cr])).values()];ke(Oi)}else{const Ui=Zt.flatMap(rr=>rr.attrValue&&Vt==="attrValue"?rr.attrValue.split(",").map(gi=>{const Oi={...rr,attrValue:gi};return{key:Oi[Vt],text:Kt.map(cr=>Oi[cr]).filter(Boolean).join(" ").trim()}}):[{key:Pt(rr,Vt),text:Kt.map(gi=>Pt(rr,gi)).filter(Boolean).join(" ").trim()}]);ke(Ui||[])}console.debug("krypton-entity-filter-cx  -> Select2DynamicDropdown -> response -> ",ui)}catch(mt){console.debug("krypton-entity-filter-cx  -> Select2DynamicDropdown -> Error -> ",mt)}};function Pt(ht,Ot){if(!(!ht||!Ot))return ht[Ot]!==void 0?ht[Ot]:Ot.split(".").reduce((Ae,mt)=>Ae&&Ae[mt],ht)}Ar(()=>{lt()},[n]),Ar(()=>{Ee.current&&AUI.$(Ee.current).val("").trigger("change")},[d]),Ar(()=>{if(Ee.current&&fe){const ht=AUI.$(Ee.current);return ht.select2(),ht.on("change.select2",function(){s(ht.val())}),()=>{ht.off("change.select2"),ht.select2("destroy")}}},[Se,fe]);const At=()=>{le(!fe)};return B.createElement(B.Fragment,null,B.createElement("div",{className:"input-group-header mt-2",onClick:()=>At()},B.createElement("div",null,L),fe?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),fe&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("select",{ref:Ee,id:E,name:E,className:"custom-select",value:a==""?F:a},B.createElement("option",{value:""},F),Se.length>0&&Se.map(ht=>B.createElement("option",{key:ht.key,value:ht.key},ht.text)))))))},Ace=({key:e,entityTypeId:t,filterData:n,onChange:s,selectedValues:a=[],resetFilter:d})=>{const f=n.elementLabel??"",i=n.fieldData??{},S=n.restBuilderApiURL??"",E=n.isServiceFilter??!1,L=n.pendingStatusValue??"",F=n.propsData??[],G=(n==null?void 0:n.isFilterStaticValues)??!1;It([]);const[q,Q]=It(!0),[te,he]=It([]),fe=async()=>{var ke,Ee,Ie,He,Ye,lt;try{let Pt=JSON.stringify(F);Pt.includes("$_entityTypeId_$")&&(Pt=Pt.replaceAll("$_entityTypeId_$",`'${t}'`)),Pt.includes("$_scheduledEntityTypeId_$")&&(Pt=Pt.replaceAll("$_scheduledEntityTypeId_$",`'${t}'`));let At=btoa(Pt);const ht=Liferay.ThemeDisplay.getUserId(),Ot=Liferay.ThemeDisplay.getSiteGroupId(),Ae=await Go.get(`${S}?propsData=${At}&userId=${ht}&siteId=${Ot}`),mt=i==null?void 0:i.key,bt=i==null?void 0:i.text;if(G){if((ke=Ae==null?void 0:Ae.data)!=null&&ke.facets&&((Ie=(Ee=Ae==null?void 0:Ae.data)==null?void 0:Ee.facets[0])!=null&&Ie.facetValues)){const Dt=Ae.data.facets[0].facetValues.map(Je=>Je.term);(Dt==null?void 0:Dt.length)>0&&he((Dt==null?void 0:Dt.map(Je=>({id:Je,label:Je,checked:!1})))||[])}}else(He=Ae==null?void 0:Ae.data)!=null&&He.items&&he(((lt=(Ye=Ae==null?void 0:Ae.data)==null?void 0:Ye.items)==null?void 0:lt.map(Dt=>{var Je;return{id:Dt[mt],label:E&&((Je=Dt[bt])==null?void 0:Je.toLowerCase())==="pending"?L:Dt[bt],checked:!1}}))||[]);console.debug("fetchCheckboxOptions response",Ae)}catch(Pt){console.error("Error fetching checkbox list:",Pt)}};Ar(()=>{d&&he(ke=>ke.map(Ee=>({...Ee,checked:!1})))},[d]),Ar(()=>{fe()},[]);const le=(ke,Ee)=>{const Ie=te.map(Ye=>Ye.id===Ee?{...Ye,checked:ke.target.checked}:Ye);console.debug("updatedOptions",Ie),he(Ie),i==null||i.key,i==null||i.text;const He=Ie.filter(Ye=>Ye.checked).map(Ye=>({id:Ye.id,value:Ye.label}));s&&s(He)},Se=()=>{Q(!q)};return B.createElement(B.Fragment,null,B.createElement("div",{class:"input-group-header mt-2",onClick:()=>Se()},B.createElement("div",null,f),q?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),q&&B.createElement("div",{className:"row"},te.length>0&&te.map(ke=>B.createElement("div",{className:"col-6 mb-15"},B.createElement("div",{class:"form-group custom-checkbox"},B.createElement("input",{type:"checkbox",class:"custom-control-input",id:`${f}_checkbox_${ke.label}`,name:`${f}_checkbox`,checked:ke.checked,onChange:Ee=>le(Ee,ke.id)}),B.createElement("label",{key:ke.id,className:"custom-control-label",htmlFor:`${f}_checkbox_${ke.label}`},ke.label))))))},Mce=({key:e,entityTypeId:t,filterData:n,onChange:s,selectedValues:a=[],resetFilter:d})=>{const f=n.clubStatuses??"",i=n.elementLabel??"",S=n.fieldData??{},E=n.restBuilderApiURL??"",L=n.propsData??[];It([]);const[F,G]=It(!0),[q,Q]=It([]),[te,he]=It([]),fe=async()=>{var ke,Ee,Ie;try{let He=JSON.stringify(L);He.includes("$_entityTypeId_$")&&(He=He.replaceAll("$_entityTypeId_$",`'${t}'`));let Ye=btoa(He);const lt=await Go.get(`${E}?propsData=${Ye}`);console.debug("fetchCheckboxOptions response",lt),he(((ke=lt==null?void 0:lt.data)==null?void 0:ke.items)||[]);const Pt=S==null?void 0:S.key,At=S==null?void 0:S.text,ht=(Ie=(Ee=lt==null?void 0:lt.data)==null?void 0:Ee.items)==null?void 0:Ie.map(Ae=>({label:Ae[At],id:Ae[Pt],checked:!1}));console.debug("allOptions :: ",ht);const Ot=[];Object.entries(f).forEach(([Ae,mt],bt)=>{ht.some(Je=>mt.includes(Je.label))&&Ot.push({label:Ae,id:bt,checked:!1})}),console.debug("groupedOptions :: ",Ot),Q(Ot)}catch(He){console.error("Error fetching checkbox list:",He)}};Ar(()=>{d&&Q(ke=>ke.map(Ee=>({...Ee,checked:!1})))},[d]),Ar(()=>{fe()},[]);const le=(ke,Ee)=>{const Ie=q.map(At=>At.label===Ee?{...At,checked:ke.target.checked}:At);console.debug("Updated Options:",Ie),Q(Ie);const He=structuredClone(te),Ye=Ie.filter(At=>At.checked).flatMap(At=>{var ht;return((ht=f[At.label])==null?void 0:ht.split(","))||[]});console.debug("Mapped Statuses:",Ye);const lt=He.filter(At=>Ye.includes(At.statusVal));console.debug("Options From Response:",lt);const Pt=lt.map(At=>({id:At.id,value:At.statusVal}));console.debug("Selected Data:",Pt),s(Pt)},Se=()=>{G(!F)};return B.createElement(B.Fragment,null,B.createElement("div",{class:"input-group-header mt-2",onClick:()=>Se()},B.createElement("div",null,i),F?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),F&&B.createElement("div",{className:"row"},q.length>0&&q.map(ke=>B.createElement("div",{className:"col-6 mb-15"},B.createElement("div",{class:"form-group custom-checkbox"},B.createElement("input",{type:"checkbox",class:"custom-control-input",id:`${i}_checkbox_${ke.label}`,name:`${i}_checkbox`,checked:ke.checked,onChange:Ee=>le(Ee,ke.label)}),B.createElement("label",{key:ke.id,className:"custom-control-label",htmlFor:`${i}_checkbox_${ke.label}`},ke.label))))))};function ks(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function kk(e){return ks(1,arguments),e instanceof Date||Ny(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function eo(e){ks(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Ny(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function nT(e){if(ks(1,arguments),!kk(e)&&typeof e!="number")return!1;var t=eo(e);return!isNaN(Number(t))}function Ml(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function MD(e,t){ks(2,arguments);var n=eo(e).getTime(),s=Ml(t);return new Date(n+s)}function K$(e,t){ks(2,arguments);var n=Ml(t);return MD(e,-n)}var Ice=864e5;function Lce(e){ks(1,arguments);var t=eo(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var s=t.getTime(),a=n-s;return Math.floor(a/Ice)+1}function Y1(e){ks(1,arguments);var t=1,n=eo(e),s=n.getUTCDay(),a=(s<t?7:0)+s-t;return n.setUTCDate(n.getUTCDate()-a),n.setUTCHours(0,0,0,0),n}function Q$(e){ks(1,arguments);var t=eo(e),n=t.getUTCFullYear(),s=new Date(0);s.setUTCFullYear(n+1,0,4),s.setUTCHours(0,0,0,0);var a=Y1(s),d=new Date(0);d.setUTCFullYear(n,0,4),d.setUTCHours(0,0,0,0);var f=Y1(d);return t.getTime()>=a.getTime()?n+1:t.getTime()>=f.getTime()?n:n-1}function Dce(e){ks(1,arguments);var t=Q$(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var s=Y1(n);return s}var Pce=6048e5;function J$(e){ks(1,arguments);var t=eo(e),n=Y1(t).getTime()-Dce(t).getTime();return Math.round(n/Pce)+1}var Oce={};function Tb(){return Oce}function gb(e,t){var n,s,a,d,f,i,S,E;ks(1,arguments);var L=Tb(),F=Ml((n=(s=(a=(d=t==null?void 0:t.weekStartsOn)!==null&&d!==void 0?d:t==null||(f=t.locale)===null||f===void 0||(i=f.options)===null||i===void 0?void 0:i.weekStartsOn)!==null&&a!==void 0?a:L.weekStartsOn)!==null&&s!==void 0?s:(S=L.locale)===null||S===void 0||(E=S.options)===null||E===void 0?void 0:E.weekStartsOn)!==null&&n!==void 0?n:0);if(!(F>=0&&F<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var G=eo(e),q=G.getUTCDay(),Q=(q<F?7:0)+q-F;return G.setUTCDate(G.getUTCDate()-Q),G.setUTCHours(0,0,0,0),G}function ID(e,t){var n,s,a,d,f,i,S,E;ks(1,arguments);var L=eo(e),F=L.getUTCFullYear(),G=Tb(),q=Ml((n=(s=(a=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(f=t.locale)===null||f===void 0||(i=f.options)===null||i===void 0?void 0:i.firstWeekContainsDate)!==null&&a!==void 0?a:G.firstWeekContainsDate)!==null&&s!==void 0?s:(S=G.locale)===null||S===void 0||(E=S.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&n!==void 0?n:1);if(!(q>=1&&q<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var Q=new Date(0);Q.setUTCFullYear(F+1,0,q),Q.setUTCHours(0,0,0,0);var te=gb(Q,t),he=new Date(0);he.setUTCFullYear(F,0,q),he.setUTCHours(0,0,0,0);var fe=gb(he,t);return L.getTime()>=te.getTime()?F+1:L.getTime()>=fe.getTime()?F:F-1}function Rce(e,t){var n,s,a,d,f,i,S,E;ks(1,arguments);var L=Tb(),F=Ml((n=(s=(a=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(f=t.locale)===null||f===void 0||(i=f.options)===null||i===void 0?void 0:i.firstWeekContainsDate)!==null&&a!==void 0?a:L.firstWeekContainsDate)!==null&&s!==void 0?s:(S=L.locale)===null||S===void 0||(E=S.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&n!==void 0?n:1),G=ID(e,t),q=new Date(0);q.setUTCFullYear(G,0,F),q.setUTCHours(0,0,0,0);var Q=gb(q,t);return Q}var Nce=6048e5;function e8(e,t){ks(1,arguments);var n=eo(e),s=gb(n,t).getTime()-Rce(n,t).getTime();return Math.round(s/Nce)+1}function oh(e,t){for(var n=e<0?"-":"",s=Math.abs(e).toString();s.length<t;)s="0"+s;return n+s}var Bce={y:function(t,n){var s=t.getUTCFullYear(),a=s>0?s:1-s;return oh(n==="yy"?a%100:a,n.length)},M:function(t,n){var s=t.getUTCMonth();return n==="M"?String(s+1):oh(s+1,2)},d:function(t,n){return oh(t.getUTCDate(),n.length)},a:function(t,n){var s=t.getUTCHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h:function(t,n){return oh(t.getUTCHours()%12||12,n.length)},H:function(t,n){return oh(t.getUTCHours(),n.length)},m:function(t,n){return oh(t.getUTCMinutes(),n.length)},s:function(t,n){return oh(t.getUTCSeconds(),n.length)},S:function(t,n){var s=n.length,a=t.getUTCMilliseconds(),d=Math.floor(a*Math.pow(10,s-3));return oh(d,n.length)}};const Yv=Bce;var _1={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Fce={G:function(t,n,s){var a=t.getUTCFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})}},y:function(t,n,s){if(n==="yo"){var a=t.getUTCFullYear(),d=a>0?a:1-a;return s.ordinalNumber(d,{unit:"year"})}return Yv.y(t,n)},Y:function(t,n,s,a){var d=ID(t,a),f=d>0?d:1-d;if(n==="YY"){var i=f%100;return oh(i,2)}return n==="Yo"?s.ordinalNumber(f,{unit:"year"}):oh(f,n.length)},R:function(t,n){var s=Q$(t);return oh(s,n.length)},u:function(t,n){var s=t.getUTCFullYear();return oh(s,n.length)},Q:function(t,n,s){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"Q":return String(a);case"QQ":return oh(a,2);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,n,s){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"q":return String(a);case"qq":return oh(a,2);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,n,s){var a=t.getUTCMonth();switch(n){case"M":case"MM":return Yv.M(t,n);case"Mo":return s.ordinalNumber(a+1,{unit:"month"});case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})}},L:function(t,n,s){var a=t.getUTCMonth();switch(n){case"L":return String(a+1);case"LL":return oh(a+1,2);case"Lo":return s.ordinalNumber(a+1,{unit:"month"});case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})}},w:function(t,n,s,a){var d=e8(t,a);return n==="wo"?s.ordinalNumber(d,{unit:"week"}):oh(d,n.length)},I:function(t,n,s){var a=J$(t);return n==="Io"?s.ordinalNumber(a,{unit:"week"}):oh(a,n.length)},d:function(t,n,s){return n==="do"?s.ordinalNumber(t.getUTCDate(),{unit:"date"}):Yv.d(t,n)},D:function(t,n,s){var a=Lce(t);return n==="Do"?s.ordinalNumber(a,{unit:"dayOfYear"}):oh(a,n.length)},E:function(t,n,s){var a=t.getUTCDay();switch(n){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})}},e:function(t,n,s,a){var d=t.getUTCDay(),f=(d-a.weekStartsOn+8)%7||7;switch(n){case"e":return String(f);case"ee":return oh(f,2);case"eo":return s.ordinalNumber(f,{unit:"day"});case"eee":return s.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(d,{width:"short",context:"formatting"});case"eeee":default:return s.day(d,{width:"wide",context:"formatting"})}},c:function(t,n,s,a){var d=t.getUTCDay(),f=(d-a.weekStartsOn+8)%7||7;switch(n){case"c":return String(f);case"cc":return oh(f,n.length);case"co":return s.ordinalNumber(f,{unit:"day"});case"ccc":return s.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(d,{width:"narrow",context:"standalone"});case"cccccc":return s.day(d,{width:"short",context:"standalone"});case"cccc":default:return s.day(d,{width:"wide",context:"standalone"})}},i:function(t,n,s){var a=t.getUTCDay(),d=a===0?7:a;switch(n){case"i":return String(d);case"ii":return oh(d,n.length);case"io":return s.ordinalNumber(d,{unit:"day"});case"iii":return s.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(a,{width:"short",context:"formatting"});case"iiii":default:return s.day(a,{width:"wide",context:"formatting"})}},a:function(t,n,s){var a=t.getUTCHours(),d=a/12>=1?"pm":"am";switch(n){case"a":case"aa":return s.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(t,n,s){var a=t.getUTCHours(),d;switch(a===12?d=_1.noon:a===0?d=_1.midnight:d=a/12>=1?"pm":"am",n){case"b":case"bb":return s.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(t,n,s){var a=t.getUTCHours(),d;switch(a>=17?d=_1.evening:a>=12?d=_1.afternoon:a>=4?d=_1.morning:d=_1.night,n){case"B":case"BB":case"BBB":return s.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(t,n,s){if(n==="ho"){var a=t.getUTCHours()%12;return a===0&&(a=12),s.ordinalNumber(a,{unit:"hour"})}return Yv.h(t,n)},H:function(t,n,s){return n==="Ho"?s.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Yv.H(t,n)},K:function(t,n,s){var a=t.getUTCHours()%12;return n==="Ko"?s.ordinalNumber(a,{unit:"hour"}):oh(a,n.length)},k:function(t,n,s){var a=t.getUTCHours();return a===0&&(a=24),n==="ko"?s.ordinalNumber(a,{unit:"hour"}):oh(a,n.length)},m:function(t,n,s){return n==="mo"?s.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Yv.m(t,n)},s:function(t,n,s){return n==="so"?s.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Yv.s(t,n)},S:function(t,n){return Yv.S(t,n)},X:function(t,n,s,a){var d=a._originalDate||t,f=d.getTimezoneOffset();if(f===0)return"Z";switch(n){case"X":return KN(f);case"XXXX":case"XX":return Zx(f);case"XXXXX":case"XXX":default:return Zx(f,":")}},x:function(t,n,s,a){var d=a._originalDate||t,f=d.getTimezoneOffset();switch(n){case"x":return KN(f);case"xxxx":case"xx":return Zx(f);case"xxxxx":case"xxx":default:return Zx(f,":")}},O:function(t,n,s,a){var d=a._originalDate||t,f=d.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+ZN(f,":");case"OOOO":default:return"GMT"+Zx(f,":")}},z:function(t,n,s,a){var d=a._originalDate||t,f=d.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+ZN(f,":");case"zzzz":default:return"GMT"+Zx(f,":")}},t:function(t,n,s,a){var d=a._originalDate||t,f=Math.floor(d.getTime()/1e3);return oh(f,n.length)},T:function(t,n,s,a){var d=a._originalDate||t,f=d.getTime();return oh(f,n.length)}};function ZN(e,t){var n=e>0?"-":"+",s=Math.abs(e),a=Math.floor(s/60),d=s%60;if(d===0)return n+String(a);var f=t||"";return n+String(a)+f+oh(d,2)}function KN(e,t){if(e%60===0){var n=e>0?"-":"+";return n+oh(Math.abs(e)/60,2)}return Zx(e,t)}function Zx(e,t){var n=t||"",s=e>0?"-":"+",a=Math.abs(e),d=oh(Math.floor(a/60),2),f=oh(a%60,2);return s+d+n+f}const zce=Fce;var QN=function(t,n){switch(t){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},t8=function(t,n){switch(t){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},Uce=function(t,n){var s=t.match(/(P+)(p+)?/)||[],a=s[1],d=s[2];if(!d)return QN(t,n);var f;switch(a){case"P":f=n.dateTime({width:"short"});break;case"PP":f=n.dateTime({width:"medium"});break;case"PPP":f=n.dateTime({width:"long"});break;case"PPPP":default:f=n.dateTime({width:"full"});break}return f.replace("{{date}}",QN(a,n)).replace("{{time}}",t8(d,n))},$ce={p:t8,P:Uce};const BI=$ce;function y2(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}var Vce=["D","DD"],Wce=["YY","YYYY"];function i8(e){return Vce.indexOf(e)!==-1}function r8(e){return Wce.indexOf(e)!==-1}function _2(e,t,n){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var jce={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Hce=function(t,n,s){var a,d=jce[t];return typeof d=="string"?a=d:n===1?a=d.one:a=d.other.replace("{{count}}",n.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};const Gce=Hce;function ZA(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,s=e.formats[n]||e.formats[e.defaultWidth];return s}}var qce={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Yce={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Xce={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Zce={date:ZA({formats:qce,defaultWidth:"full"}),time:ZA({formats:Yce,defaultWidth:"full"}),dateTime:ZA({formats:Xce,defaultWidth:"full"})};const Kce=Zce;var Qce={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Jce=function(t,n,s,a){return Qce[t]};const ehe=Jce;function mS(e){return function(t,n){var s=n!=null&&n.context?String(n.context):"standalone",a;if(s==="formatting"&&e.formattingValues){var d=e.defaultFormattingWidth||e.defaultWidth,f=n!=null&&n.width?String(n.width):d;a=e.formattingValues[f]||e.formattingValues[d]}else{var i=e.defaultWidth,S=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[S]||e.values[i]}var E=e.argumentCallback?e.argumentCallback(t):t;return a[E]}}var the={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ihe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},rhe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},nhe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},she={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ohe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ahe=function(t,n){var s=Number(t),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},lhe={ordinalNumber:ahe,era:mS({values:the,defaultWidth:"wide"}),quarter:mS({values:ihe,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:mS({values:rhe,defaultWidth:"wide"}),day:mS({values:nhe,defaultWidth:"wide"}),dayPeriod:mS({values:she,defaultWidth:"wide",formattingValues:ohe,defaultFormattingWidth:"wide"})};const che=lhe;function gS(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.width,a=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],d=t.match(a);if(!d)return null;var f=d[0],i=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],S=Array.isArray(i)?uhe(i,function(F){return F.test(f)}):hhe(i,function(F){return F.test(f)}),E;E=e.valueCallback?e.valueCallback(S):S,E=n.valueCallback?n.valueCallback(E):E;var L=t.slice(f.length);return{value:E,rest:L}}}function hhe(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function uhe(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}function dhe(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.match(e.matchPattern);if(!s)return null;var a=s[0],d=t.match(e.parsePattern);if(!d)return null;var f=e.valueCallback?e.valueCallback(d[0]):d[0];f=n.valueCallback?n.valueCallback(f):f;var i=t.slice(a.length);return{value:f,rest:i}}}var phe=/^(\d+)(th|st|nd|rd)?/i,fhe=/\d+/i,mhe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ghe={any:[/^b/i,/^(a|c)/i]},yhe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_he={any:[/1/i,/2/i,/3/i,/4/i]},vhe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},xhe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},bhe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},whe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},She={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},The={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Che={ordinalNumber:dhe({matchPattern:phe,parsePattern:fhe,valueCallback:function(t){return parseInt(t,10)}}),era:gS({matchPatterns:mhe,defaultMatchWidth:"wide",parsePatterns:ghe,defaultParseWidth:"any"}),quarter:gS({matchPatterns:yhe,defaultMatchWidth:"wide",parsePatterns:_he,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:gS({matchPatterns:vhe,defaultMatchWidth:"wide",parsePatterns:xhe,defaultParseWidth:"any"}),day:gS({matchPatterns:bhe,defaultMatchWidth:"wide",parsePatterns:whe,defaultParseWidth:"any"}),dayPeriod:gS({matchPatterns:She,defaultMatchWidth:"any",parsePatterns:The,defaultParseWidth:"any"})};const Ehe=Che;var khe={code:"en-US",formatDistance:Gce,formatLong:Kce,formatRelative:ehe,localize:che,match:Ehe,options:{weekStartsOn:0,firstWeekContainsDate:1}};const n8=khe;var Ahe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Mhe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ihe=/^'([^]*?)'?$/,Lhe=/''/g,Dhe=/[a-zA-Z]/;function JN(e,t,n){var s,a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke;ks(2,arguments);var Ee=String(t),Ie=Tb(),He=(s=(a=n==null?void 0:n.locale)!==null&&a!==void 0?a:Ie.locale)!==null&&s!==void 0?s:n8,Ye=Ml((d=(f=(i=(S=n==null?void 0:n.firstWeekContainsDate)!==null&&S!==void 0?S:n==null||(E=n.locale)===null||E===void 0||(L=E.options)===null||L===void 0?void 0:L.firstWeekContainsDate)!==null&&i!==void 0?i:Ie.firstWeekContainsDate)!==null&&f!==void 0?f:(F=Ie.locale)===null||F===void 0||(G=F.options)===null||G===void 0?void 0:G.firstWeekContainsDate)!==null&&d!==void 0?d:1);if(!(Ye>=1&&Ye<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var lt=Ml((q=(Q=(te=(he=n==null?void 0:n.weekStartsOn)!==null&&he!==void 0?he:n==null||(fe=n.locale)===null||fe===void 0||(le=fe.options)===null||le===void 0?void 0:le.weekStartsOn)!==null&&te!==void 0?te:Ie.weekStartsOn)!==null&&Q!==void 0?Q:(Se=Ie.locale)===null||Se===void 0||(ke=Se.options)===null||ke===void 0?void 0:ke.weekStartsOn)!==null&&q!==void 0?q:0);if(!(lt>=0&&lt<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!He.localize)throw new RangeError("locale must contain localize property");if(!He.formatLong)throw new RangeError("locale must contain formatLong property");var Pt=eo(e);if(!nT(Pt))throw new RangeError("Invalid time value");var At=y2(Pt),ht=K$(Pt,At),Ot={firstWeekContainsDate:Ye,weekStartsOn:lt,locale:He,_originalDate:Pt},Ae=Ee.match(Mhe).map(function(mt){var bt=mt[0];if(bt==="p"||bt==="P"){var Dt=BI[bt];return Dt(mt,He.formatLong)}return mt}).join("").match(Ahe).map(function(mt){if(mt==="''")return"'";var bt=mt[0];if(bt==="'")return Phe(mt);var Dt=zce[bt];if(Dt)return!(n!=null&&n.useAdditionalWeekYearTokens)&&r8(mt)&&_2(mt,t,String(e)),!(n!=null&&n.useAdditionalDayOfYearTokens)&&i8(mt)&&_2(mt,t,String(e)),Dt(ht,mt,He.localize,Ot);if(bt.match(Dhe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+bt+"`");return mt}).join("");return Ae}function Phe(e){var t=e.match(Ihe);return t?t[1].replace(Lhe,"'"):e}var Ohe=6e4;function FI(e,t){ks(2,arguments);var n=Ml(t);return MD(e,n*Ohe)}var Rhe=36e5;function Nhe(e,t){ks(2,arguments);var n=Ml(t);return MD(e,n*Rhe)}function gw(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);return isNaN(s)?new Date(NaN):(s&&n.setDate(n.getDate()+s),n)}function v2(e,t){ks(2,arguments);var n=Ml(t),s=n*7;return gw(e,s)}function T0(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);if(isNaN(s))return new Date(NaN);if(!s)return n;var a=n.getDate(),d=new Date(n.getTime());d.setMonth(n.getMonth()+s+1,0);var f=d.getDate();return a>=f?d:(n.setFullYear(d.getFullYear(),d.getMonth(),a),n)}function s8(e,t){ks(2,arguments);var n=Ml(t),s=n*3;return T0(e,s)}function X1(e,t){ks(2,arguments);var n=Ml(t);return T0(e,n*12)}function Bhe(e,t){ks(2,arguments);var n=Ml(t);return gw(e,-n)}function e3(e,t){ks(2,arguments);var n=Ml(t);return v2(e,-n)}function Z1(e,t){ks(2,arguments);var n=Ml(t);return T0(e,-n)}function Fhe(e,t){ks(2,arguments);var n=Ml(t);return s8(e,-n)}function sT(e,t){ks(2,arguments);var n=Ml(t);return X1(e,-n)}function t3(e){ks(1,arguments);var t=eo(e),n=t.getSeconds();return n}function p_(e){ks(1,arguments);var t=eo(e),n=t.getMinutes();return n}function f_(e){ks(1,arguments);var t=eo(e),n=t.getHours();return n}function zhe(e){ks(1,arguments);var t=eo(e),n=t.getDay();return n}function i3(e){ks(1,arguments);var t=eo(e),n=t.getDate();return n}function o8(e,t){var n,s,a,d,f,i,S,E;ks(1,arguments);var L=Tb(),F=Ml((n=(s=(a=(d=t==null?void 0:t.weekStartsOn)!==null&&d!==void 0?d:t==null||(f=t.locale)===null||f===void 0||(i=f.options)===null||i===void 0?void 0:i.weekStartsOn)!==null&&a!==void 0?a:L.weekStartsOn)!==null&&s!==void 0?s:(S=L.locale)===null||S===void 0||(E=S.options)===null||E===void 0?void 0:E.weekStartsOn)!==null&&n!==void 0?n:0);if(!(F>=0&&F<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var G=eo(e),q=G.getDay(),Q=(q<F?7:0)+q-F;return G.setDate(G.getDate()-Q),G.setHours(0,0,0,0),G}function x2(e){return ks(1,arguments),o8(e,{weekStartsOn:1})}function Uhe(e){ks(1,arguments);var t=eo(e),n=t.getFullYear(),s=new Date(0);s.setFullYear(n+1,0,4),s.setHours(0,0,0,0);var a=x2(s),d=new Date(0);d.setFullYear(n,0,4),d.setHours(0,0,0,0);var f=x2(d);return t.getTime()>=a.getTime()?n+1:t.getTime()>=f.getTime()?n:n-1}function $he(e){ks(1,arguments);var t=Uhe(e),n=new Date(0);n.setFullYear(t,0,4),n.setHours(0,0,0,0);var s=x2(n);return s}var Vhe=6048e5;function Whe(e){ks(1,arguments);var t=eo(e),n=x2(t).getTime()-$he(t).getTime();return Math.round(n/Vhe)+1}function Nf(e){ks(1,arguments);var t=eo(e),n=t.getMonth();return n}function E1(e){ks(1,arguments);var t=eo(e),n=Math.floor(t.getMonth()/3)+1;return n}function Fl(e){return ks(1,arguments),eo(e).getFullYear()}function zI(e){ks(1,arguments);var t=eo(e),n=t.getTime();return n}function jhe(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);return n.setSeconds(s),n}function fE(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);return n.setMinutes(s),n}function mE(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);return n.setHours(s),n}function Hhe(e){ks(1,arguments);var t=eo(e),n=t.getFullYear(),s=t.getMonth(),a=new Date(0);return a.setFullYear(n,s+1,0),a.setHours(0,0,0,0),a.getDate()}function _m(e,t){ks(2,arguments);var n=eo(e),s=Ml(t),a=n.getFullYear(),d=n.getDate(),f=new Date(0);f.setFullYear(a,s,15),f.setHours(0,0,0,0);var i=Hhe(f);return n.setMonth(s,Math.min(d,i)),n}function v1(e,t){ks(2,arguments);var n=eo(e),s=Ml(t),a=Math.floor(n.getMonth()/3)+1,d=s-a;return _m(n,n.getMonth()+d*3)}function K_(e,t){ks(2,arguments);var n=eo(e),s=Ml(t);return isNaN(n.getTime())?new Date(NaN):(n.setFullYear(s),n)}function r3(e){ks(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(Ny(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var n;return t.forEach(function(s){var a=eo(s);(n===void 0||n>a||isNaN(a.getDate()))&&(n=a)}),n||new Date(NaN)}function n3(e){ks(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(Ny(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var n;return t.forEach(function(s){var a=eo(s);(n===void 0||n<a||isNaN(Number(a)))&&(n=a)}),n||new Date(NaN)}function m_(e){ks(1,arguments);var t=eo(e);return t.setHours(0,0,0,0),t}var Ghe=864e5;function b2(e,t){ks(2,arguments);var n=m_(e),s=m_(t),a=n.getTime()-y2(n),d=s.getTime()-y2(s);return Math.round((a-d)/Ghe)}function w2(e,t){ks(2,arguments);var n=eo(e),s=eo(t),a=n.getFullYear()-s.getFullYear(),d=n.getMonth()-s.getMonth();return a*12+d}function S2(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getFullYear()-s.getFullYear()}function a8(e){ks(1,arguments);var t=eo(e);return t.setDate(1),t.setHours(0,0,0,0),t}function UI(e){ks(1,arguments);var t=eo(e),n=t.getMonth(),s=n-n%3;return t.setMonth(s,1),t.setHours(0,0,0,0),t}function l8(e){ks(1,arguments);var t=eo(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function $I(e){ks(1,arguments);var t=eo(e);return t.setHours(23,59,59,999),t}function qhe(e){ks(1,arguments);var t=eo(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Yhe(e){ks(1,arguments);var t=eo(e),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}function Xhe(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getTime()===s.getTime()}function Zhe(e,t){ks(2,arguments);var n=m_(e),s=m_(t);return n.getTime()===s.getTime()}function Khe(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()}function Qhe(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getFullYear()===s.getFullYear()}function Jhe(e,t){ks(2,arguments);var n=UI(e),s=UI(t);return n.getTime()===s.getTime()}function cx(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getTime()>s.getTime()}function Jv(e,t){ks(2,arguments);var n=eo(e),s=eo(t);return n.getTime()<s.getTime()}function oT(e,t){ks(2,arguments);var n=eo(e).getTime(),s=eo(t.start).getTime(),a=eo(t.end).getTime();if(!(s<=a))throw new RangeError("Invalid interval");return n>=s&&n<=a}function s3(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=mce(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d,f=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var E=n.next();return f=E.done,E},e:function(E){i=!0,d=E},f:function(){try{f||n.return==null||n.return()}finally{if(i)throw d}}}}function eue(e,t){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}var tue=10,c8=function(){function e(){lc(this,e),Ns(this,"priority",void 0),Ns(this,"subPriority",0)}return cc(e,[{key:"validate",value:function(n,s){return!0}}]),e}(),iue=function(e){bc(n,e);var t=wc(n);function n(s,a,d,f,i){var S;return lc(this,n),S=t.call(this),S.value=s,S.validateValue=a,S.setValue=d,S.priority=f,i&&(S.subPriority=i),S}return cc(n,[{key:"validate",value:function(a,d){return this.validateValue(a,this.value,d)}},{key:"set",value:function(a,d,f){return this.setValue(a,d,this.value,f)}}]),n}(c8),rue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",tue),Ns(qs(s),"subPriority",-1),s}return cc(n,[{key:"set",value:function(a,d){if(d.timestampIsSet)return a;var f=new Date(0);return f.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),f.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),f}}]),n}(c8),Fc=function(){function e(){lc(this,e),Ns(this,"incompatibleTokens",void 0),Ns(this,"priority",void 0),Ns(this,"subPriority",void 0)}return cc(e,[{key:"run",value:function(n,s,a,d){var f=this.parse(n,s,a,d);return f?{setter:new iue(f.value,this.validate,this.set,this.priority,this.subPriority),rest:f.rest}:null}},{key:"validate",value:function(n,s,a){return!0}}]),e}(),nue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",140),Ns(qs(s),"incompatibleTokens",["R","u","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"G":case"GG":case"GGG":return f.era(a,{width:"abbreviated"})||f.era(a,{width:"narrow"});case"GGGGG":return f.era(a,{width:"narrow"});case"GGGG":default:return f.era(a,{width:"wide"})||f.era(a,{width:"abbreviated"})||f.era(a,{width:"narrow"})}}},{key:"set",value:function(a,d,f){return d.era=f,a.setUTCFullYear(f,0,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),LD=6e4,DD=36e5,sue=1e3,yd={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},h_={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function _d(e,t){return e&&{value:t(e.value),rest:e.rest}}function yu(e,t){var n=t.match(e);return n?{value:parseInt(n[0],10),rest:t.slice(n[0].length)}:null}function u_(e,t){var n=t.match(e);if(!n)return null;if(n[0]==="Z")return{value:0,rest:t.slice(1)};var s=n[1]==="+"?1:-1,a=n[2]?parseInt(n[2],10):0,d=n[3]?parseInt(n[3],10):0,f=n[5]?parseInt(n[5],10):0;return{value:s*(a*DD+d*LD+f*sue),rest:t.slice(n[0].length)}}function h8(e){return yu(yd.anyDigitsSigned,e)}function Uu(e,t){switch(e){case 1:return yu(yd.singleDigit,t);case 2:return yu(yd.twoDigits,t);case 3:return yu(yd.threeDigits,t);case 4:return yu(yd.fourDigits,t);default:return yu(new RegExp("^\\d{1,"+e+"}"),t)}}function T2(e,t){switch(e){case 1:return yu(yd.singleDigitSigned,t);case 2:return yu(yd.twoDigitsSigned,t);case 3:return yu(yd.threeDigitsSigned,t);case 4:return yu(yd.fourDigitsSigned,t);default:return yu(new RegExp("^-?\\d{1,"+e+"}"),t)}}function PD(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function u8(e,t){var n=t>0,s=n?t:1-t,a;if(s<=50)a=e||100;else{var d=s+50,f=Math.floor(d/100)*100,i=e>=d%100;a=e+f-(i?100:0)}return n?a:1-a}function d8(e){return e%400===0||e%4===0&&e%100!==0}var oue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",130),Ns(qs(s),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){var i=function(E){return{year:E,isTwoDigitYear:d==="yy"}};switch(d){case"y":return _d(Uu(4,a),i);case"yo":return _d(f.ordinalNumber(a,{unit:"year"}),i);default:return _d(Uu(d.length,a),i)}}},{key:"validate",value:function(a,d){return d.isTwoDigitYear||d.year>0}},{key:"set",value:function(a,d,f){var i=a.getUTCFullYear();if(f.isTwoDigitYear){var S=u8(f.year,i);return a.setUTCFullYear(S,0,1),a.setUTCHours(0,0,0,0),a}var E=!("era"in d)||d.era===1?f.year:1-f.year;return a.setUTCFullYear(E,0,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),aue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",130),Ns(qs(s),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){var i=function(E){return{year:E,isTwoDigitYear:d==="YY"}};switch(d){case"Y":return _d(Uu(4,a),i);case"Yo":return _d(f.ordinalNumber(a,{unit:"year"}),i);default:return _d(Uu(d.length,a),i)}}},{key:"validate",value:function(a,d){return d.isTwoDigitYear||d.year>0}},{key:"set",value:function(a,d,f,i){var S=ID(a,i);if(f.isTwoDigitYear){var E=u8(f.year,S);return a.setUTCFullYear(E,0,i.firstWeekContainsDate),a.setUTCHours(0,0,0,0),gb(a,i)}var L=!("era"in d)||d.era===1?f.year:1-f.year;return a.setUTCFullYear(L,0,i.firstWeekContainsDate),a.setUTCHours(0,0,0,0),gb(a,i)}}]),n}(Fc),lue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",130),Ns(qs(s),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d){return T2(d==="R"?4:d.length,a)}},{key:"set",value:function(a,d,f){var i=new Date(0);return i.setUTCFullYear(f,0,4),i.setUTCHours(0,0,0,0),Y1(i)}}]),n}(Fc),cue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",130),Ns(qs(s),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d){return T2(d==="u"?4:d.length,a)}},{key:"set",value:function(a,d,f){return a.setUTCFullYear(f,0,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),hue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",120),Ns(qs(s),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"Q":case"QQ":return Uu(d.length,a);case"Qo":return f.ordinalNumber(a,{unit:"quarter"});case"QQQ":return f.quarter(a,{width:"abbreviated",context:"formatting"})||f.quarter(a,{width:"narrow",context:"formatting"});case"QQQQQ":return f.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return f.quarter(a,{width:"wide",context:"formatting"})||f.quarter(a,{width:"abbreviated",context:"formatting"})||f.quarter(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,d){return d>=1&&d<=4}},{key:"set",value:function(a,d,f){return a.setUTCMonth((f-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),uue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",120),Ns(qs(s),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"q":case"qq":return Uu(d.length,a);case"qo":return f.ordinalNumber(a,{unit:"quarter"});case"qqq":return f.quarter(a,{width:"abbreviated",context:"standalone"})||f.quarter(a,{width:"narrow",context:"standalone"});case"qqqqq":return f.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return f.quarter(a,{width:"wide",context:"standalone"})||f.quarter(a,{width:"abbreviated",context:"standalone"})||f.quarter(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,d){return d>=1&&d<=4}},{key:"set",value:function(a,d,f){return a.setUTCMonth((f-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),due=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),Ns(qs(s),"priority",110),s}return cc(n,[{key:"parse",value:function(a,d,f){var i=function(E){return E-1};switch(d){case"M":return _d(yu(yd.month,a),i);case"MM":return _d(Uu(2,a),i);case"Mo":return _d(f.ordinalNumber(a,{unit:"month"}),i);case"MMM":return f.month(a,{width:"abbreviated",context:"formatting"})||f.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return f.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return f.month(a,{width:"wide",context:"formatting"})||f.month(a,{width:"abbreviated",context:"formatting"})||f.month(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,d){return d>=0&&d<=11}},{key:"set",value:function(a,d,f){return a.setUTCMonth(f,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),pue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",110),Ns(qs(s),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){var i=function(E){return E-1};switch(d){case"L":return _d(yu(yd.month,a),i);case"LL":return _d(Uu(2,a),i);case"Lo":return _d(f.ordinalNumber(a,{unit:"month"}),i);case"LLL":return f.month(a,{width:"abbreviated",context:"standalone"})||f.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return f.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return f.month(a,{width:"wide",context:"standalone"})||f.month(a,{width:"abbreviated",context:"standalone"})||f.month(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,d){return d>=0&&d<=11}},{key:"set",value:function(a,d,f){return a.setUTCMonth(f,1),a.setUTCHours(0,0,0,0),a}}]),n}(Fc);function fue(e,t,n){ks(2,arguments);var s=eo(e),a=Ml(t),d=e8(s,n)-a;return s.setUTCDate(s.getUTCDate()-d*7),s}var mue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",100),Ns(qs(s),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"w":return yu(yd.week,a);case"wo":return f.ordinalNumber(a,{unit:"week"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=1&&d<=53}},{key:"set",value:function(a,d,f,i){return gb(fue(a,f,i),i)}}]),n}(Fc);function gue(e,t){ks(2,arguments);var n=eo(e),s=Ml(t),a=J$(n)-s;return n.setUTCDate(n.getUTCDate()-a*7),n}var yue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",100),Ns(qs(s),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"I":return yu(yd.week,a);case"Io":return f.ordinalNumber(a,{unit:"week"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=1&&d<=53}},{key:"set",value:function(a,d,f){return Y1(gue(a,f))}}]),n}(Fc),_ue=[31,28,31,30,31,30,31,31,30,31,30,31],vue=[31,29,31,30,31,30,31,31,30,31,30,31],xue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"subPriority",1),Ns(qs(s),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"d":return yu(yd.date,a);case"do":return f.ordinalNumber(a,{unit:"date"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){var f=a.getUTCFullYear(),i=d8(f),S=a.getUTCMonth();return i?d>=1&&d<=vue[S]:d>=1&&d<=_ue[S]}},{key:"set",value:function(a,d,f){return a.setUTCDate(f),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),bue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"subpriority",1),Ns(qs(s),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"D":case"DD":return yu(yd.dayOfYear,a);case"Do":return f.ordinalNumber(a,{unit:"date"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){var f=a.getUTCFullYear(),i=d8(f);return i?d>=1&&d<=366:d>=1&&d<=365}},{key:"set",value:function(a,d,f){return a.setUTCMonth(0,f),a.setUTCHours(0,0,0,0),a}}]),n}(Fc);function OD(e,t,n){var s,a,d,f,i,S,E,L;ks(2,arguments);var F=Tb(),G=Ml((s=(a=(d=(f=n==null?void 0:n.weekStartsOn)!==null&&f!==void 0?f:n==null||(i=n.locale)===null||i===void 0||(S=i.options)===null||S===void 0?void 0:S.weekStartsOn)!==null&&d!==void 0?d:F.weekStartsOn)!==null&&a!==void 0?a:(E=F.locale)===null||E===void 0||(L=E.options)===null||L===void 0?void 0:L.weekStartsOn)!==null&&s!==void 0?s:0);if(!(G>=0&&G<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var q=eo(e),Q=Ml(t),te=q.getUTCDay(),he=Q%7,fe=(he+7)%7,le=(fe<G?7:0)+Q-te;return q.setUTCDate(q.getUTCDate()+le),q}var wue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"incompatibleTokens",["D","i","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"E":case"EE":case"EEE":return f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"});case"EEEEE":return f.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"});case"EEEE":default:return f.day(a,{width:"wide",context:"formatting"})||f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,d){return d>=0&&d<=6}},{key:"set",value:function(a,d,f,i){return a=OD(a,f,i),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),Sue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f,i){var S=function(L){var F=Math.floor((L-1)/7)*7;return(L+i.weekStartsOn+6)%7+F};switch(d){case"e":case"ee":return _d(Uu(d.length,a),S);case"eo":return _d(f.ordinalNumber(a,{unit:"day"}),S);case"eee":return f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"});case"eeeee":return f.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return f.day(a,{width:"wide",context:"formatting"})||f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,d){return d>=0&&d<=6}},{key:"set",value:function(a,d,f,i){return a=OD(a,f,i),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),Tue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f,i){var S=function(L){var F=Math.floor((L-1)/7)*7;return(L+i.weekStartsOn+6)%7+F};switch(d){case"c":case"cc":return _d(Uu(d.length,a),S);case"co":return _d(f.ordinalNumber(a,{unit:"day"}),S);case"ccc":return f.day(a,{width:"abbreviated",context:"standalone"})||f.day(a,{width:"short",context:"standalone"})||f.day(a,{width:"narrow",context:"standalone"});case"ccccc":return f.day(a,{width:"narrow",context:"standalone"});case"cccccc":return f.day(a,{width:"short",context:"standalone"})||f.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return f.day(a,{width:"wide",context:"standalone"})||f.day(a,{width:"abbreviated",context:"standalone"})||f.day(a,{width:"short",context:"standalone"})||f.day(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,d){return d>=0&&d<=6}},{key:"set",value:function(a,d,f,i){return a=OD(a,f,i),a.setUTCHours(0,0,0,0),a}}]),n}(Fc);function Cue(e,t){ks(2,arguments);var n=Ml(t);n%7===0&&(n=n-7);var s=1,a=eo(e),d=a.getUTCDay(),f=n%7,i=(f+7)%7,S=(i<s?7:0)+n-d;return a.setUTCDate(a.getUTCDate()+S),a}var Eue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",90),Ns(qs(s),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){var i=function(E){return E===0?7:E};switch(d){case"i":case"ii":return Uu(d.length,a);case"io":return f.ordinalNumber(a,{unit:"day"});case"iii":return _d(f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"}),i);case"iiiii":return _d(f.day(a,{width:"narrow",context:"formatting"}),i);case"iiiiii":return _d(f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"}),i);case"iiii":default:return _d(f.day(a,{width:"wide",context:"formatting"})||f.day(a,{width:"abbreviated",context:"formatting"})||f.day(a,{width:"short",context:"formatting"})||f.day(a,{width:"narrow",context:"formatting"}),i)}}},{key:"validate",value:function(a,d){return d>=1&&d<=7}},{key:"set",value:function(a,d,f){return a=Cue(a,f),a.setUTCHours(0,0,0,0),a}}]),n}(Fc),kue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",80),Ns(qs(s),"incompatibleTokens",["b","B","H","k","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"a":case"aa":case"aaa":return f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaaa":return f.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return f.dayPeriod(a,{width:"wide",context:"formatting"})||f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,d,f){return a.setUTCHours(PD(f),0,0,0),a}}]),n}(Fc),Aue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",80),Ns(qs(s),"incompatibleTokens",["a","B","H","k","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"b":case"bb":case"bbb":return f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbbb":return f.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return f.dayPeriod(a,{width:"wide",context:"formatting"})||f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,d,f){return a.setUTCHours(PD(f),0,0,0),a}}]),n}(Fc),Mue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",80),Ns(qs(s),"incompatibleTokens",["a","b","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"B":case"BB":case"BBB":return f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBBB":return f.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return f.dayPeriod(a,{width:"wide",context:"formatting"})||f.dayPeriod(a,{width:"abbreviated",context:"formatting"})||f.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,d,f){return a.setUTCHours(PD(f),0,0,0),a}}]),n}(Fc),Iue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",70),Ns(qs(s),"incompatibleTokens",["H","K","k","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"h":return yu(yd.hour12h,a);case"ho":return f.ordinalNumber(a,{unit:"hour"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=1&&d<=12}},{key:"set",value:function(a,d,f){var i=a.getUTCHours()>=12;return i&&f<12?a.setUTCHours(f+12,0,0,0):!i&&f===12?a.setUTCHours(0,0,0,0):a.setUTCHours(f,0,0,0),a}}]),n}(Fc),Lue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",70),Ns(qs(s),"incompatibleTokens",["a","b","h","K","k","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"H":return yu(yd.hour23h,a);case"Ho":return f.ordinalNumber(a,{unit:"hour"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=0&&d<=23}},{key:"set",value:function(a,d,f){return a.setUTCHours(f,0,0,0),a}}]),n}(Fc),Due=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",70),Ns(qs(s),"incompatibleTokens",["h","H","k","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"K":return yu(yd.hour11h,a);case"Ko":return f.ordinalNumber(a,{unit:"hour"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=0&&d<=11}},{key:"set",value:function(a,d,f){var i=a.getUTCHours()>=12;return i&&f<12?a.setUTCHours(f+12,0,0,0):a.setUTCHours(f,0,0,0),a}}]),n}(Fc),Pue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",70),Ns(qs(s),"incompatibleTokens",["a","b","h","H","K","t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"k":return yu(yd.hour24h,a);case"ko":return f.ordinalNumber(a,{unit:"hour"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=1&&d<=24}},{key:"set",value:function(a,d,f){var i=f<=24?f%24:f;return a.setUTCHours(i,0,0,0),a}}]),n}(Fc),Oue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",60),Ns(qs(s),"incompatibleTokens",["t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"m":return yu(yd.minute,a);case"mo":return f.ordinalNumber(a,{unit:"minute"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=0&&d<=59}},{key:"set",value:function(a,d,f){return a.setUTCMinutes(f,0,0),a}}]),n}(Fc),Rue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",50),Ns(qs(s),"incompatibleTokens",["t","T"]),s}return cc(n,[{key:"parse",value:function(a,d,f){switch(d){case"s":return yu(yd.second,a);case"so":return f.ordinalNumber(a,{unit:"second"});default:return Uu(d.length,a)}}},{key:"validate",value:function(a,d){return d>=0&&d<=59}},{key:"set",value:function(a,d,f){return a.setUTCSeconds(f,0),a}}]),n}(Fc),Nue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",30),Ns(qs(s),"incompatibleTokens",["t","T"]),s}return cc(n,[{key:"parse",value:function(a,d){var f=function(S){return Math.floor(S*Math.pow(10,-d.length+3))};return _d(Uu(d.length,a),f)}},{key:"set",value:function(a,d,f){return a.setUTCMilliseconds(f),a}}]),n}(Fc),Bue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",10),Ns(qs(s),"incompatibleTokens",["t","T","x"]),s}return cc(n,[{key:"parse",value:function(a,d){switch(d){case"X":return u_(h_.basicOptionalMinutes,a);case"XX":return u_(h_.basic,a);case"XXXX":return u_(h_.basicOptionalSeconds,a);case"XXXXX":return u_(h_.extendedOptionalSeconds,a);case"XXX":default:return u_(h_.extended,a)}}},{key:"set",value:function(a,d,f){return d.timestampIsSet?a:new Date(a.getTime()-f)}}]),n}(Fc),Fue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",10),Ns(qs(s),"incompatibleTokens",["t","T","X"]),s}return cc(n,[{key:"parse",value:function(a,d){switch(d){case"x":return u_(h_.basicOptionalMinutes,a);case"xx":return u_(h_.basic,a);case"xxxx":return u_(h_.basicOptionalSeconds,a);case"xxxxx":return u_(h_.extendedOptionalSeconds,a);case"xxx":default:return u_(h_.extended,a)}}},{key:"set",value:function(a,d,f){return d.timestampIsSet?a:new Date(a.getTime()-f)}}]),n}(Fc),zue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",40),Ns(qs(s),"incompatibleTokens","*"),s}return cc(n,[{key:"parse",value:function(a){return h8(a)}},{key:"set",value:function(a,d,f){return[new Date(f*1e3),{timestampIsSet:!0}]}}]),n}(Fc),Uue=function(e){bc(n,e);var t=wc(n);function n(){var s;lc(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return s=t.call.apply(t,[this].concat(d)),Ns(qs(s),"priority",20),Ns(qs(s),"incompatibleTokens","*"),s}return cc(n,[{key:"parse",value:function(a){return h8(a)}},{key:"set",value:function(a,d,f){return[new Date(f),{timestampIsSet:!0}]}}]),n}(Fc),$ue={G:new nue,y:new oue,Y:new aue,R:new lue,u:new cue,Q:new hue,q:new uue,M:new due,L:new pue,w:new mue,I:new yue,d:new xue,D:new bue,E:new wue,e:new Sue,c:new Tue,i:new Eue,a:new kue,b:new Aue,B:new Mue,h:new Iue,H:new Lue,K:new Due,k:new Pue,m:new Oue,s:new Rue,S:new Nue,X:new Bue,x:new Fue,t:new zue,T:new Uue},Vue=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Wue=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,jue=/^'([^]*?)'?$/,Hue=/''/g,Gue=/\S/,que=/[a-zA-Z]/;function KA(e,t,n,s){var a,d,f,i,S,E,L,F,G,q,Q,te,he,fe,le,Se,ke,Ee;ks(3,arguments);var Ie=String(e),He=String(t),Ye=Tb(),lt=(a=(d=s==null?void 0:s.locale)!==null&&d!==void 0?d:Ye.locale)!==null&&a!==void 0?a:n8;if(!lt.match)throw new RangeError("locale must contain match property");var Pt=Ml((f=(i=(S=(E=s==null?void 0:s.firstWeekContainsDate)!==null&&E!==void 0?E:s==null||(L=s.locale)===null||L===void 0||(F=L.options)===null||F===void 0?void 0:F.firstWeekContainsDate)!==null&&S!==void 0?S:Ye.firstWeekContainsDate)!==null&&i!==void 0?i:(G=Ye.locale)===null||G===void 0||(q=G.options)===null||q===void 0?void 0:q.firstWeekContainsDate)!==null&&f!==void 0?f:1);if(!(Pt>=1&&Pt<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var At=Ml((Q=(te=(he=(fe=s==null?void 0:s.weekStartsOn)!==null&&fe!==void 0?fe:s==null||(le=s.locale)===null||le===void 0||(Se=le.options)===null||Se===void 0?void 0:Se.weekStartsOn)!==null&&he!==void 0?he:Ye.weekStartsOn)!==null&&te!==void 0?te:(ke=Ye.locale)===null||ke===void 0||(Ee=ke.options)===null||Ee===void 0?void 0:Ee.weekStartsOn)!==null&&Q!==void 0?Q:0);if(!(At>=0&&At<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(He==="")return Ie===""?eo(n):new Date(NaN);var ht={firstWeekContainsDate:Pt,weekStartsOn:At,locale:lt},Ot=[new rue],Ae=He.match(Wue).map(function(gi){var Oi=gi[0];if(Oi in BI){var cr=BI[Oi];return cr(gi,lt.formatLong)}return gi}).join("").match(Vue),mt=[],bt=s3(Ae),Dt;try{var Je=function(){var Oi=Dt.value;!(s!=null&&s.useAdditionalWeekYearTokens)&&r8(Oi)&&_2(Oi,He,e),!(s!=null&&s.useAdditionalDayOfYearTokens)&&i8(Oi)&&_2(Oi,He,e);var cr=Oi[0],ji=$ue[cr];if(ji){var nn=ji.incompatibleTokens;if(Array.isArray(nn)){var pr=mt.find(function(ni){return nn.includes(ni.token)||ni.token===cr});if(pr)throw new RangeError("The format string mustn't contain `".concat(pr.fullToken,"` and `").concat(Oi,"` at the same time"))}else if(ji.incompatibleTokens==="*"&&mt.length>0)throw new RangeError("The format string mustn't contain `".concat(Oi,"` and any other token at the same time"));mt.push({token:cr,fullToken:Oi});var Ue=ji.run(Ie,Oi,lt.match,ht);if(!Ue)return{v:new Date(NaN)};Ot.push(Ue.setter),Ie=Ue.rest}else{if(cr.match(que))throw new RangeError("Format string contains an unescaped latin alphabet character `"+cr+"`");if(Oi==="''"?Oi="'":cr==="'"&&(Oi=Yue(Oi)),Ie.indexOf(Oi)===0)Ie=Ie.slice(Oi.length);else return{v:new Date(NaN)}}};for(bt.s();!(Dt=bt.n()).done;){var dt=Je();if(Ny(dt)==="object")return dt.v}}catch(gi){bt.e(gi)}finally{bt.f()}if(Ie.length>0&&Gue.test(Ie))return new Date(NaN);var ui=Ot.map(function(gi){return gi.priority}).sort(function(gi,Oi){return Oi-gi}).filter(function(gi,Oi,cr){return cr.indexOf(gi)===Oi}).map(function(gi){return Ot.filter(function(Oi){return Oi.priority===gi}).sort(function(Oi,cr){return cr.subPriority-Oi.subPriority})}).map(function(gi){return gi[0]}),Vt=eo(n);if(isNaN(Vt.getTime()))return new Date(NaN);var ei=K$(Vt,y2(Vt)),ur={},Zt=s3(ui),Kt;try{for(Zt.s();!(Kt=Zt.n()).done;){var Ui=Kt.value;if(!Ui.validate(ei,ht))return new Date(NaN);var rr=Ui.set(ei,ur,ht);Array.isArray(rr)?(ei=rr[0],eue(ur,rr[1])):ei=rr}}catch(gi){Zt.e(gi)}finally{Zt.f()}return ei}function Yue(e){return e.match(jue)[1].replace(Hue,"'")}function Xue(e,t){var n;ks(1,arguments);var s=Ml((n=t==null?void 0:t.additionalDigits)!==null&&n!==void 0?n:2);if(s!==2&&s!==1&&s!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=Jue(e),d;if(a.date){var f=ede(a.date,s);d=tde(f.restDateString,f.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);var i=d.getTime(),S=0,E;if(a.time&&(S=ide(a.time),isNaN(S)))return new Date(NaN);if(a.timezone){if(E=rde(a.timezone),isNaN(E))return new Date(NaN)}else{var L=new Date(i+S),F=new Date(0);return F.setFullYear(L.getUTCFullYear(),L.getUTCMonth(),L.getUTCDate()),F.setHours(L.getUTCHours(),L.getUTCMinutes(),L.getUTCSeconds(),L.getUTCMilliseconds()),F}return new Date(i+S+E)}var WC={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Zue=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Kue=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Que=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Jue(e){var t={},n=e.split(WC.dateTimeDelimiter),s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],WC.timeZoneDelimiter.test(t.date)&&(t.date=e.split(WC.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){var a=WC.timezone.exec(s);a?(t.time=s.replace(a[1],""),t.timezone=a[1]):t.time=s}return t}function ede(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(n);if(!s)return{year:NaN,restDateString:""};var a=s[1]?parseInt(s[1]):null,d=s[2]?parseInt(s[2]):null;return{year:d===null?a:d*100,restDateString:e.slice((s[1]||s[2]).length)}}function tde(e,t){if(t===null)return new Date(NaN);var n=e.match(Zue);if(!n)return new Date(NaN);var s=!!n[4],a=yS(n[1]),d=yS(n[2])-1,f=yS(n[3]),i=yS(n[4]),S=yS(n[5])-1;if(s)return lde(t,i,S)?nde(t,i,S):new Date(NaN);var E=new Date(0);return!ode(t,d,f)||!ade(t,a)?new Date(NaN):(E.setUTCFullYear(t,d,Math.max(a,f)),E)}function yS(e){return e?parseInt(e):1}function ide(e){var t=e.match(Kue);if(!t)return NaN;var n=QA(t[1]),s=QA(t[2]),a=QA(t[3]);return cde(n,s,a)?n*DD+s*LD+a*1e3:NaN}function QA(e){return e&&parseFloat(e.replace(",","."))||0}function rde(e){if(e==="Z")return 0;var t=e.match(Que);if(!t)return 0;var n=t[1]==="+"?-1:1,s=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return hde(s,a)?n*(s*DD+a*LD):NaN}function nde(e,t,n){var s=new Date(0);s.setUTCFullYear(e,0,4);var a=s.getUTCDay()||7,d=(t-1)*7+n+1-a;return s.setUTCDate(s.getUTCDate()+d),s}var sde=[31,null,31,30,31,30,31,31,30,31,30,31];function p8(e){return e%400===0||e%4===0&&e%100!==0}function ode(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(sde[t]||(p8(e)?29:28))}function ade(e,t){return t>=1&&t<=(p8(e)?366:365)}function lde(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function cde(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function hde(e,t){return t>=0&&t<=59}function ude(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,VI(e,t)}function VI(e,t){return VI=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},VI(e,t)}function dde(e,t){if(e==null)return{};var n={},s=Object.keys(e),a,d;for(d=0;d<s.length;d++)a=s[d],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function o3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pde(e,t,n){return e===t?!0:e.correspondingElement?e.correspondingElement.classList.contains(n):e.classList.contains(n)}function fde(e,t,n){if(e===t)return!0;for(;e.parentNode||e.host;){if(e.parentNode&&pde(e,t,n))return!0;e=e.parentNode||e.host}return e}function mde(e){return document.documentElement.clientWidth<=e.clientX||document.documentElement.clientHeight<=e.clientY}var gde=function(){if(!(typeof window>"u"||typeof window.addEventListener!="function")){var t=!1,n=Object.defineProperty({},"passive",{get:function(){t=!0}}),s=function(){};return window.addEventListener("testPassiveEventSupport",s,n),window.removeEventListener("testPassiveEventSupport",s,n),t}};function yde(e){return e===void 0&&(e=0),function(){return++e}}var _de=yde(),WI,jC={},JA={},vde=["touchstart","touchmove"],xde="ignore-react-onclickoutside";function a3(e,t){var n={},s=vde.indexOf(t)!==-1;return s&&WI&&(n.passive=!e.props.preventDefault),n}function Ak(e,t){var n,s,a=e.displayName||e.name||"Component";return s=n=function(d){ude(f,d);function f(S){var E;return E=d.call(this,S)||this,E.__outsideClickHandler=function(L){if(typeof E.__clickOutsideHandlerProp=="function"){E.__clickOutsideHandlerProp(L);return}var F=E.getInstance();if(typeof F.props.handleClickOutside=="function"){F.props.handleClickOutside(L);return}if(typeof F.handleClickOutside=="function"){F.handleClickOutside(L);return}throw new Error("WrappedComponent: "+a+" lacks a handleClickOutside(event) function for processing outside click events.")},E.__getComponentNode=function(){var L=E.getInstance();return t&&typeof t.setClickOutsideRef=="function"?t.setClickOutsideRef()(L):typeof L.setClickOutsideRef=="function"?L.setClickOutsideRef():uW(L)},E.enableOnClickOutside=function(){if(!(typeof document>"u"||JA[E._uid])){typeof WI>"u"&&(WI=gde()),JA[E._uid]=!0;var L=E.props.eventTypes;L.forEach||(L=[L]),jC[E._uid]=function(F){if(E.componentNode!==null&&!(E.initTimeStamp>F.timeStamp)&&(E.props.preventDefault&&F.preventDefault(),E.props.stopPropagation&&F.stopPropagation(),!(E.props.excludeScrollbar&&mde(F)))){var G=F.composed&&F.composedPath&&F.composedPath().shift()||F.target;fde(G,E.componentNode,E.props.outsideClickIgnoreClass)===document&&E.__outsideClickHandler(F)}},L.forEach(function(F){document.addEventListener(F,jC[E._uid],a3(o3(E),F))})}},E.disableOnClickOutside=function(){delete JA[E._uid];var L=jC[E._uid];if(L&&typeof document<"u"){var F=E.props.eventTypes;F.forEach||(F=[F]),F.forEach(function(G){return document.removeEventListener(G,L,a3(o3(E),G))}),delete jC[E._uid]}},E.getRef=function(L){return E.instanceRef=L},E._uid=_de(),E.initTimeStamp=performance.now(),E}var i=f.prototype;return i.getInstance=function(){if(e.prototype&&!e.prototype.isReactComponent)return this;var E=this.instanceRef;return E.getInstance?E.getInstance():E},i.componentDidMount=function(){if(!(typeof document>"u"||!document.createElement)){var E=this.getInstance();if(t&&typeof t.handleClickOutside=="function"&&(this.__clickOutsideHandlerProp=t.handleClickOutside(E),typeof this.__clickOutsideHandlerProp!="function"))throw new Error("WrappedComponent: "+a+" lacks a function for processing outside click events specified by the handleClickOutside config option.");this.componentNode=this.__getComponentNode(),!this.props.disableOnClickOutside&&this.enableOnClickOutside()}},i.componentDidUpdate=function(){this.componentNode=this.__getComponentNode()},i.componentWillUnmount=function(){this.disableOnClickOutside()},i.render=function(){var E=this.props;E.excludeScrollbar;var L=dde(E,["excludeScrollbar"]);return e.prototype&&e.prototype.isReactComponent?L.ref=this.getRef:L.wrappedRef=this.getRef,L.disableOnClickOutside=this.disableOnClickOutside,L.enableOnClickOutside=this.enableOnClickOutside,oW(e,L)},f}(aW),n.displayName="OnClickOutside("+a+")",n.defaultProps={eventTypes:["mousedown","touchstart"],excludeScrollbar:t&&t.excludeScrollbar||!1,outsideClickIgnoreClass:xde,preventDefault:!1,stopPropagation:!1},n.getClass=function(){return e.getClass?e.getClass():e},s}var f8=Zh.createContext(),m8=Zh.createContext();function bde(e){var t=e.children,n=Zh.useState(null),s=n[0],a=n[1],d=Zh.useRef(!1);Zh.useEffect(function(){return function(){d.current=!0}},[]);var f=Zh.useCallback(function(i){d.current||a(i)},[]);return Zh.createElement(f8.Provider,{value:s},Zh.createElement(m8.Provider,{value:f},t))}var g8=function(t){return Array.isArray(t)?t[0]:t},y8=function(t){if(typeof t=="function"){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return t.apply(void 0,s)}},jI=function(t,n){if(typeof t=="function")return y8(t,n);t!=null&&(t.current=n)},l3=function(t){return t.reduce(function(n,s){var a=s[0],d=s[1];return n[a]=d,n},{})},c3=typeof window<"u"&&window.document&&window.document.createElement?Zh.useLayoutEffect:Zh.useEffect,dg="top",By="bottom",Fy="right",pg="left",RD="auto",RT=[dg,By,Fy,pg],K1="start",aT="end",wde="clippingParents",_8="viewport",_S="popper",Sde="reference",h3=RT.reduce(function(e,t){return e.concat([t+"-"+K1,t+"-"+aT])},[]),v8=[].concat(RT,[RD]).reduce(function(e,t){return e.concat([t,t+"-"+K1,t+"-"+aT])},[]),Tde="beforeRead",Cde="read",Ede="afterRead",kde="beforeMain",Ade="main",Mde="afterMain",Ide="beforeWrite",Lde="write",Dde="afterWrite",Pde=[Tde,Cde,Ede,kde,Ade,Mde,Ide,Lde,Dde];function b_(e){return e?(e.nodeName||"").toLowerCase():null}function Zg(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function yb(e){var t=Zg(e).Element;return e instanceof t||e instanceof Element}function Py(e){var t=Zg(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function ND(e){if(typeof ShadowRoot>"u")return!1;var t=Zg(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function Ode(e){var t=e.state;Object.keys(t.elements).forEach(function(n){var s=t.styles[n]||{},a=t.attributes[n]||{},d=t.elements[n];!Py(d)||!b_(d)||(Object.assign(d.style,s),Object.keys(a).forEach(function(f){var i=a[f];i===!1?d.removeAttribute(f):d.setAttribute(f,i===!0?"":i)}))})}function Rde(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(s){var a=t.elements[s],d=t.attributes[s]||{},f=Object.keys(t.styles.hasOwnProperty(s)?t.styles[s]:n[s]),i=f.reduce(function(S,E){return S[E]="",S},{});!Py(a)||!b_(a)||(Object.assign(a.style,i),Object.keys(d).forEach(function(S){a.removeAttribute(S)}))})}}const Nde={name:"applyStyles",enabled:!0,phase:"write",fn:Ode,effect:Rde,requires:["computeStyles"]};function g_(e){return e.split("-")[0]}var ob=Math.max,C2=Math.min,Q1=Math.round;function HI(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function x8(){return!/^((?!chrome|android).)*safari/i.test(HI())}function J1(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var s=e.getBoundingClientRect(),a=1,d=1;t&&Py(e)&&(a=e.offsetWidth>0&&Q1(s.width)/e.offsetWidth||1,d=e.offsetHeight>0&&Q1(s.height)/e.offsetHeight||1);var f=yb(e)?Zg(e):window,i=f.visualViewport,S=!x8()&&n,E=(s.left+(S&&i?i.offsetLeft:0))/a,L=(s.top+(S&&i?i.offsetTop:0))/d,F=s.width/a,G=s.height/d;return{width:F,height:G,top:L,right:E+F,bottom:L+G,left:E,x:E,y:L}}function BD(e){var t=J1(e),n=e.offsetWidth,s=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:s}}function b8(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&ND(n)){var s=t;do{if(s&&e.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function ov(e){return Zg(e).getComputedStyle(e)}function Bde(e){return["table","td","th"].indexOf(b_(e))>=0}function dx(e){return((yb(e)?e.ownerDocument:e.document)||window.document).documentElement}function Mk(e){return b_(e)==="html"?e:e.assignedSlot||e.parentNode||(ND(e)?e.host:null)||dx(e)}function u3(e){return!Py(e)||ov(e).position==="fixed"?null:e.offsetParent}function Fde(e){var t=/firefox/i.test(HI()),n=/Trident/i.test(HI());if(n&&Py(e)){var s=ov(e);if(s.position==="fixed")return null}var a=Mk(e);for(ND(a)&&(a=a.host);Py(a)&&["html","body"].indexOf(b_(a))<0;){var d=ov(a);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return a;a=a.parentNode}return null}function NT(e){for(var t=Zg(e),n=u3(e);n&&Bde(n)&&ov(n).position==="static";)n=u3(n);return n&&(b_(n)==="html"||b_(n)==="body"&&ov(n).position==="static")?t:n||Fde(e)||t}function FD(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function US(e,t,n){return ob(e,C2(t,n))}function zde(e,t,n){var s=US(e,t,n);return s>n?n:s}function w8(){return{top:0,right:0,bottom:0,left:0}}function S8(e){return Object.assign({},w8(),e)}function T8(e,t){return t.reduce(function(n,s){return n[s]=e,n},{})}var Ude=function(t,n){return t=typeof t=="function"?t(Object.assign({},n.rects,{placement:n.placement})):t,S8(typeof t!="number"?t:T8(t,RT))};function $de(e){var t,n=e.state,s=e.name,a=e.options,d=n.elements.arrow,f=n.modifiersData.popperOffsets,i=g_(n.placement),S=FD(i),E=[pg,Fy].indexOf(i)>=0,L=E?"height":"width";if(!(!d||!f)){var F=Ude(a.padding,n),G=BD(d),q=S==="y"?dg:pg,Q=S==="y"?By:Fy,te=n.rects.reference[L]+n.rects.reference[S]-f[S]-n.rects.popper[L],he=f[S]-n.rects.reference[S],fe=NT(d),le=fe?S==="y"?fe.clientHeight||0:fe.clientWidth||0:0,Se=te/2-he/2,ke=F[q],Ee=le-G[L]-F[Q],Ie=le/2-G[L]/2+Se,He=US(ke,Ie,Ee),Ye=S;n.modifiersData[s]=(t={},t[Ye]=He,t.centerOffset=He-Ie,t)}}function Vde(e){var t=e.state,n=e.options,s=n.element,a=s===void 0?"[data-popper-arrow]":s;a!=null&&(typeof a=="string"&&(a=t.elements.popper.querySelector(a),!a)||b8(t.elements.popper,a)&&(t.elements.arrow=a))}const Wde={name:"arrow",enabled:!0,phase:"main",fn:$de,effect:Vde,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ew(e){return e.split("-")[1]}var jde={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Hde(e,t){var n=e.x,s=e.y,a=t.devicePixelRatio||1;return{x:Q1(n*a)/a||0,y:Q1(s*a)/a||0}}function d3(e){var t,n=e.popper,s=e.popperRect,a=e.placement,d=e.variation,f=e.offsets,i=e.position,S=e.gpuAcceleration,E=e.adaptive,L=e.roundOffsets,F=e.isFixed,G=f.x,q=G===void 0?0:G,Q=f.y,te=Q===void 0?0:Q,he=typeof L=="function"?L({x:q,y:te}):{x:q,y:te};q=he.x,te=he.y;var fe=f.hasOwnProperty("x"),le=f.hasOwnProperty("y"),Se=pg,ke=dg,Ee=window;if(E){var Ie=NT(n),He="clientHeight",Ye="clientWidth";if(Ie===Zg(n)&&(Ie=dx(n),ov(Ie).position!=="static"&&i==="absolute"&&(He="scrollHeight",Ye="scrollWidth")),Ie=Ie,a===dg||(a===pg||a===Fy)&&d===aT){ke=By;var lt=F&&Ie===Ee&&Ee.visualViewport?Ee.visualViewport.height:Ie[He];te-=lt-s.height,te*=S?1:-1}if(a===pg||(a===dg||a===By)&&d===aT){Se=Fy;var Pt=F&&Ie===Ee&&Ee.visualViewport?Ee.visualViewport.width:Ie[Ye];q-=Pt-s.width,q*=S?1:-1}}var At=Object.assign({position:i},E&&jde),ht=L===!0?Hde({x:q,y:te},Zg(n)):{x:q,y:te};if(q=ht.x,te=ht.y,S){var Ot;return Object.assign({},At,(Ot={},Ot[ke]=le?"0":"",Ot[Se]=fe?"0":"",Ot.transform=(Ee.devicePixelRatio||1)<=1?"translate("+q+"px, "+te+"px)":"translate3d("+q+"px, "+te+"px, 0)",Ot))}return Object.assign({},At,(t={},t[ke]=le?te+"px":"",t[Se]=fe?q+"px":"",t.transform="",t))}function Gde(e){var t=e.state,n=e.options,s=n.gpuAcceleration,a=s===void 0?!0:s,d=n.adaptive,f=d===void 0?!0:d,i=n.roundOffsets,S=i===void 0?!0:i,E={placement:g_(t.placement),variation:ew(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:a,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,d3(Object.assign({},E,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:S})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,d3(Object.assign({},E,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:S})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const qde={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Gde,data:{}};var HC={passive:!0};function Yde(e){var t=e.state,n=e.instance,s=e.options,a=s.scroll,d=a===void 0?!0:a,f=s.resize,i=f===void 0?!0:f,S=Zg(t.elements.popper),E=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&E.forEach(function(L){L.addEventListener("scroll",n.update,HC)}),i&&S.addEventListener("resize",n.update,HC),function(){d&&E.forEach(function(L){L.removeEventListener("scroll",n.update,HC)}),i&&S.removeEventListener("resize",n.update,HC)}}const Xde={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Yde,data:{}};var Zde={left:"right",right:"left",bottom:"top",top:"bottom"};function gE(e){return e.replace(/left|right|bottom|top/g,function(t){return Zde[t]})}var Kde={start:"end",end:"start"};function p3(e){return e.replace(/start|end/g,function(t){return Kde[t]})}function zD(e){var t=Zg(e),n=t.pageXOffset,s=t.pageYOffset;return{scrollLeft:n,scrollTop:s}}function UD(e){return J1(dx(e)).left+zD(e).scrollLeft}function Qde(e,t){var n=Zg(e),s=dx(e),a=n.visualViewport,d=s.clientWidth,f=s.clientHeight,i=0,S=0;if(a){d=a.width,f=a.height;var E=x8();(E||!E&&t==="fixed")&&(i=a.offsetLeft,S=a.offsetTop)}return{width:d,height:f,x:i+UD(e),y:S}}function Jde(e){var t,n=dx(e),s=zD(e),a=(t=e.ownerDocument)==null?void 0:t.body,d=ob(n.scrollWidth,n.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),f=ob(n.scrollHeight,n.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),i=-s.scrollLeft+UD(e),S=-s.scrollTop;return ov(a||n).direction==="rtl"&&(i+=ob(n.clientWidth,a?a.clientWidth:0)-d),{width:d,height:f,x:i,y:S}}function $D(e){var t=ov(e),n=t.overflow,s=t.overflowX,a=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+a+s)}function C8(e){return["html","body","#document"].indexOf(b_(e))>=0?e.ownerDocument.body:Py(e)&&$D(e)?e:C8(Mk(e))}function $S(e,t){var n;t===void 0&&(t=[]);var s=C8(e),a=s===((n=e.ownerDocument)==null?void 0:n.body),d=Zg(s),f=a?[d].concat(d.visualViewport||[],$D(s)?s:[]):s,i=t.concat(f);return a?i:i.concat($S(Mk(f)))}function GI(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function epe(e,t){var n=J1(e,!1,t==="fixed");return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function f3(e,t,n){return t===_8?GI(Qde(e,n)):yb(t)?epe(t,n):GI(Jde(dx(e)))}function tpe(e){var t=$S(Mk(e)),n=["absolute","fixed"].indexOf(ov(e).position)>=0,s=n&&Py(e)?NT(e):e;return yb(s)?t.filter(function(a){return yb(a)&&b8(a,s)&&b_(a)!=="body"}):[]}function ipe(e,t,n,s){var a=t==="clippingParents"?tpe(e):[].concat(t),d=[].concat(a,[n]),f=d[0],i=d.reduce(function(S,E){var L=f3(e,E,s);return S.top=ob(L.top,S.top),S.right=C2(L.right,S.right),S.bottom=C2(L.bottom,S.bottom),S.left=ob(L.left,S.left),S},f3(e,f,s));return i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}function E8(e){var t=e.reference,n=e.element,s=e.placement,a=s?g_(s):null,d=s?ew(s):null,f=t.x+t.width/2-n.width/2,i=t.y+t.height/2-n.height/2,S;switch(a){case dg:S={x:f,y:t.y-n.height};break;case By:S={x:f,y:t.y+t.height};break;case Fy:S={x:t.x+t.width,y:i};break;case pg:S={x:t.x-n.width,y:i};break;default:S={x:t.x,y:t.y}}var E=a?FD(a):null;if(E!=null){var L=E==="y"?"height":"width";switch(d){case K1:S[E]=S[E]-(t[L]/2-n[L]/2);break;case aT:S[E]=S[E]+(t[L]/2-n[L]/2);break}}return S}function lT(e,t){t===void 0&&(t={});var n=t,s=n.placement,a=s===void 0?e.placement:s,d=n.strategy,f=d===void 0?e.strategy:d,i=n.boundary,S=i===void 0?wde:i,E=n.rootBoundary,L=E===void 0?_8:E,F=n.elementContext,G=F===void 0?_S:F,q=n.altBoundary,Q=q===void 0?!1:q,te=n.padding,he=te===void 0?0:te,fe=S8(typeof he!="number"?he:T8(he,RT)),le=G===_S?Sde:_S,Se=e.rects.popper,ke=e.elements[Q?le:G],Ee=ipe(yb(ke)?ke:ke.contextElement||dx(e.elements.popper),S,L,f),Ie=J1(e.elements.reference),He=E8({reference:Ie,element:Se,strategy:"absolute",placement:a}),Ye=GI(Object.assign({},Se,He)),lt=G===_S?Ye:Ie,Pt={top:Ee.top-lt.top+fe.top,bottom:lt.bottom-Ee.bottom+fe.bottom,left:Ee.left-lt.left+fe.left,right:lt.right-Ee.right+fe.right},At=e.modifiersData.offset;if(G===_S&&At){var ht=At[a];Object.keys(Pt).forEach(function(Ot){var Ae=[Fy,By].indexOf(Ot)>=0?1:-1,mt=[dg,By].indexOf(Ot)>=0?"y":"x";Pt[Ot]+=ht[mt]*Ae})}return Pt}function rpe(e,t){t===void 0&&(t={});var n=t,s=n.placement,a=n.boundary,d=n.rootBoundary,f=n.padding,i=n.flipVariations,S=n.allowedAutoPlacements,E=S===void 0?v8:S,L=ew(s),F=L?i?h3:h3.filter(function(Q){return ew(Q)===L}):RT,G=F.filter(function(Q){return E.indexOf(Q)>=0});G.length===0&&(G=F);var q=G.reduce(function(Q,te){return Q[te]=lT(e,{placement:te,boundary:a,rootBoundary:d,padding:f})[g_(te)],Q},{});return Object.keys(q).sort(function(Q,te){return q[Q]-q[te]})}function npe(e){if(g_(e)===RD)return[];var t=gE(e);return[p3(e),t,p3(t)]}function spe(e){var t=e.state,n=e.options,s=e.name;if(!t.modifiersData[s]._skip){for(var a=n.mainAxis,d=a===void 0?!0:a,f=n.altAxis,i=f===void 0?!0:f,S=n.fallbackPlacements,E=n.padding,L=n.boundary,F=n.rootBoundary,G=n.altBoundary,q=n.flipVariations,Q=q===void 0?!0:q,te=n.allowedAutoPlacements,he=t.options.placement,fe=g_(he),le=fe===he,Se=S||(le||!Q?[gE(he)]:npe(he)),ke=[he].concat(Se).reduce(function(Zt,Kt){return Zt.concat(g_(Kt)===RD?rpe(t,{placement:Kt,boundary:L,rootBoundary:F,padding:E,flipVariations:Q,allowedAutoPlacements:te}):Kt)},[]),Ee=t.rects.reference,Ie=t.rects.popper,He=new Map,Ye=!0,lt=ke[0],Pt=0;Pt<ke.length;Pt++){var At=ke[Pt],ht=g_(At),Ot=ew(At)===K1,Ae=[dg,By].indexOf(ht)>=0,mt=Ae?"width":"height",bt=lT(t,{placement:At,boundary:L,rootBoundary:F,altBoundary:G,padding:E}),Dt=Ae?Ot?Fy:pg:Ot?By:dg;Ee[mt]>Ie[mt]&&(Dt=gE(Dt));var Je=gE(Dt),dt=[];if(d&&dt.push(bt[ht]<=0),i&&dt.push(bt[Dt]<=0,bt[Je]<=0),dt.every(function(Zt){return Zt})){lt=At,Ye=!1;break}He.set(At,dt)}if(Ye)for(var ui=Q?3:1,Vt=function(Kt){var Ui=ke.find(function(rr){var gi=He.get(rr);if(gi)return gi.slice(0,Kt).every(function(Oi){return Oi})});if(Ui)return lt=Ui,"break"},ei=ui;ei>0;ei--){var ur=Vt(ei);if(ur==="break")break}t.placement!==lt&&(t.modifiersData[s]._skip=!0,t.placement=lt,t.reset=!0)}}const ope={name:"flip",enabled:!0,phase:"main",fn:spe,requiresIfExists:["offset"],data:{_skip:!1}};function m3(e,t,n){return n===void 0&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function g3(e){return[dg,Fy,By,pg].some(function(t){return e[t]>=0})}function ape(e){var t=e.state,n=e.name,s=t.rects.reference,a=t.rects.popper,d=t.modifiersData.preventOverflow,f=lT(t,{elementContext:"reference"}),i=lT(t,{altBoundary:!0}),S=m3(f,s),E=m3(i,a,d),L=g3(S),F=g3(E);t.modifiersData[n]={referenceClippingOffsets:S,popperEscapeOffsets:E,isReferenceHidden:L,hasPopperEscaped:F},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":L,"data-popper-escaped":F})}const lpe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ape};function cpe(e,t,n){var s=g_(e),a=[pg,dg].indexOf(s)>=0?-1:1,d=typeof n=="function"?n(Object.assign({},t,{placement:e})):n,f=d[0],i=d[1];return f=f||0,i=(i||0)*a,[pg,Fy].indexOf(s)>=0?{x:i,y:f}:{x:f,y:i}}function hpe(e){var t=e.state,n=e.options,s=e.name,a=n.offset,d=a===void 0?[0,0]:a,f=v8.reduce(function(L,F){return L[F]=cpe(F,t.rects,d),L},{}),i=f[t.placement],S=i.x,E=i.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=S,t.modifiersData.popperOffsets.y+=E),t.modifiersData[s]=f}const upe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:hpe};function dpe(e){var t=e.state,n=e.name;t.modifiersData[n]=E8({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const ppe={name:"popperOffsets",enabled:!0,phase:"read",fn:dpe,data:{}};function fpe(e){return e==="x"?"y":"x"}function mpe(e){var t=e.state,n=e.options,s=e.name,a=n.mainAxis,d=a===void 0?!0:a,f=n.altAxis,i=f===void 0?!1:f,S=n.boundary,E=n.rootBoundary,L=n.altBoundary,F=n.padding,G=n.tether,q=G===void 0?!0:G,Q=n.tetherOffset,te=Q===void 0?0:Q,he=lT(t,{boundary:S,rootBoundary:E,padding:F,altBoundary:L}),fe=g_(t.placement),le=ew(t.placement),Se=!le,ke=FD(fe),Ee=fpe(ke),Ie=t.modifiersData.popperOffsets,He=t.rects.reference,Ye=t.rects.popper,lt=typeof te=="function"?te(Object.assign({},t.rects,{placement:t.placement})):te,Pt=typeof lt=="number"?{mainAxis:lt,altAxis:lt}:Object.assign({mainAxis:0,altAxis:0},lt),At=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,ht={x:0,y:0};if(Ie){if(d){var Ot,Ae=ke==="y"?dg:pg,mt=ke==="y"?By:Fy,bt=ke==="y"?"height":"width",Dt=Ie[ke],Je=Dt+he[Ae],dt=Dt-he[mt],ui=q?-Ye[bt]/2:0,Vt=le===K1?He[bt]:Ye[bt],ei=le===K1?-Ye[bt]:-He[bt],ur=t.elements.arrow,Zt=q&&ur?BD(ur):{width:0,height:0},Kt=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:w8(),Ui=Kt[Ae],rr=Kt[mt],gi=US(0,He[bt],Zt[bt]),Oi=Se?He[bt]/2-ui-gi-Ui-Pt.mainAxis:Vt-gi-Ui-Pt.mainAxis,cr=Se?-He[bt]/2+ui+gi+rr+Pt.mainAxis:ei+gi+rr+Pt.mainAxis,ji=t.elements.arrow&&NT(t.elements.arrow),nn=ji?ke==="y"?ji.clientTop||0:ji.clientLeft||0:0,pr=(Ot=At==null?void 0:At[ke])!=null?Ot:0,Ue=Dt+Oi-pr-nn,ni=Dt+cr-pr,fi=US(q?C2(Je,Ue):Je,Dt,q?ob(dt,ni):dt);Ie[ke]=fi,ht[ke]=fi-Dt}if(i){var Lt,pt=ke==="x"?dg:pg,Nt=ke==="x"?By:Fy,Si=Ie[Ee],pi=Ee==="y"?"height":"width",St=Si+he[pt],Ht=Si-he[Nt],nr=[dg,pg].indexOf(fe)!==-1,tr=(Lt=At==null?void 0:At[Ee])!=null?Lt:0,kr=nr?St:Si-He[pi]-Ye[pi]-tr+Pt.altAxis,Mr=nr?Si+He[pi]+Ye[pi]-tr-Pt.altAxis:Ht,Cr=q&&nr?zde(kr,Si,Mr):US(q?kr:St,Si,q?Mr:Ht);Ie[Ee]=Cr,ht[Ee]=Cr-Si}t.modifiersData[s]=ht}}const gpe={name:"preventOverflow",enabled:!0,phase:"main",fn:mpe,requiresIfExists:["offset"]};function ype(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function _pe(e){return e===Zg(e)||!Py(e)?zD(e):ype(e)}function vpe(e){var t=e.getBoundingClientRect(),n=Q1(t.width)/e.offsetWidth||1,s=Q1(t.height)/e.offsetHeight||1;return n!==1||s!==1}function xpe(e,t,n){n===void 0&&(n=!1);var s=Py(t),a=Py(t)&&vpe(t),d=dx(t),f=J1(e,a,n),i={scrollLeft:0,scrollTop:0},S={x:0,y:0};return(s||!s&&!n)&&((b_(t)!=="body"||$D(d))&&(i=_pe(t)),Py(t)?(S=J1(t,!0),S.x+=t.clientLeft,S.y+=t.clientTop):d&&(S.x=UD(d))),{x:f.left+i.scrollLeft-S.x,y:f.top+i.scrollTop-S.y,width:f.width,height:f.height}}function bpe(e){var t=new Map,n=new Set,s=[];e.forEach(function(d){t.set(d.name,d)});function a(d){n.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(i){if(!n.has(i)){var S=t.get(i);S&&a(S)}}),s.push(d)}return e.forEach(function(d){n.has(d.name)||a(d)}),s}function wpe(e){var t=bpe(e);return Pde.reduce(function(n,s){return n.concat(t.filter(function(a){return a.phase===s}))},[])}function Spe(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}function Tpe(e){var t=e.reduce(function(n,s){var a=n[s.name];return n[s.name]=a?Object.assign({},a,s,{options:Object.assign({},a.options,s.options),data:Object.assign({},a.data,s.data)}):s,n},{});return Object.keys(t).map(function(n){return t[n]})}var y3={placement:"bottom",modifiers:[],strategy:"absolute"};function _3(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function Cpe(e){e===void 0&&(e={});var t=e,n=t.defaultModifiers,s=n===void 0?[]:n,a=t.defaultOptions,d=a===void 0?y3:a;return function(i,S,E){E===void 0&&(E=d);var L={placement:"bottom",orderedModifiers:[],options:Object.assign({},y3,d),modifiersData:{},elements:{reference:i,popper:S},attributes:{},styles:{}},F=[],G=!1,q={state:L,setOptions:function(fe){var le=typeof fe=="function"?fe(L.options):fe;te(),L.options=Object.assign({},d,L.options,le),L.scrollParents={reference:yb(i)?$S(i):i.contextElement?$S(i.contextElement):[],popper:$S(S)};var Se=wpe(Tpe([].concat(s,L.options.modifiers)));return L.orderedModifiers=Se.filter(function(ke){return ke.enabled}),Q(),q.update()},forceUpdate:function(){if(!G){var fe=L.elements,le=fe.reference,Se=fe.popper;if(_3(le,Se)){L.rects={reference:xpe(le,NT(Se),L.options.strategy==="fixed"),popper:BD(Se)},L.reset=!1,L.placement=L.options.placement,L.orderedModifiers.forEach(function(Pt){return L.modifiersData[Pt.name]=Object.assign({},Pt.data)});for(var ke=0;ke<L.orderedModifiers.length;ke++){if(L.reset===!0){L.reset=!1,ke=-1;continue}var Ee=L.orderedModifiers[ke],Ie=Ee.fn,He=Ee.options,Ye=He===void 0?{}:He,lt=Ee.name;typeof Ie=="function"&&(L=Ie({state:L,options:Ye,name:lt,instance:q})||L)}}}},update:Spe(function(){return new Promise(function(he){q.forceUpdate(),he(L)})}),destroy:function(){te(),G=!0}};if(!_3(i,S))return q;q.setOptions(E).then(function(he){!G&&E.onFirstUpdate&&E.onFirstUpdate(he)});function Q(){L.orderedModifiers.forEach(function(he){var fe=he.name,le=he.options,Se=le===void 0?{}:le,ke=he.effect;if(typeof ke=="function"){var Ee=ke({state:L,name:fe,instance:q,options:Se}),Ie=function(){};F.push(Ee||Ie)}})}function te(){F.forEach(function(he){return he()}),F=[]}return q}}var Epe=[Xde,ppe,qde,Nde,upe,ope,gpe,Wde,lpe],kpe=Cpe({defaultModifiers:Epe}),Ape=typeof Element<"u",Mpe=typeof Map=="function",Ipe=typeof Set=="function",Lpe=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function yE(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,a;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!yE(e[s],t[s]))return!1;return!0}var d;if(Mpe&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(d=e.entries();!(s=d.next()).done;)if(!t.has(s.value[0]))return!1;for(d=e.entries();!(s=d.next()).done;)if(!yE(s.value[1],t.get(s.value[0])))return!1;return!0}if(Ipe&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(d=e.entries();!(s=d.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(Lpe&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[s]))return!1;if(Ape&&e instanceof Element)return!1;for(s=n;s--!==0;)if(!((a[s]==="_owner"||a[s]==="__v"||a[s]==="__o")&&e.$$typeof)&&!yE(e[a[s]],t[a[s]]))return!1;return!0}return e!==e&&t!==t}var Dpe=function(t,n){try{return yE(t,n)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}};const Ppe=w_(Dpe);var Ope=[],Rpe=function(t,n,s){s===void 0&&(s={});var a=Zh.useRef(null),d={onFirstUpdate:s.onFirstUpdate,placement:s.placement||"bottom",strategy:s.strategy||"absolute",modifiers:s.modifiers||Ope},f=Zh.useState({styles:{popper:{position:d.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),i=f[0],S=f[1],E=Zh.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(q){var Q=q.state,te=Object.keys(Q.elements);hW.flushSync(function(){S({styles:l3(te.map(function(he){return[he,Q.styles[he]||{}]})),attributes:l3(te.map(function(he){return[he,Q.attributes[he]]}))})})},requires:["computeStyles"]}},[]),L=Zh.useMemo(function(){var G={onFirstUpdate:d.onFirstUpdate,placement:d.placement,strategy:d.strategy,modifiers:[].concat(d.modifiers,[E,{name:"applyStyles",enabled:!1}])};return Ppe(a.current,G)?a.current||G:(a.current=G,G)},[d.onFirstUpdate,d.placement,d.strategy,d.modifiers,E]),F=Zh.useRef();return c3(function(){F.current&&F.current.setOptions(L)},[L]),c3(function(){if(!(t==null||n==null)){var G=s.createPopper||kpe,q=G(t,n,L);return F.current=q,function(){q.destroy(),F.current=null}}},[t,n,s.createPopper]),{state:F.current?F.current.state:null,styles:i.styles,attributes:i.attributes,update:F.current?F.current.update:null,forceUpdate:F.current?F.current.forceUpdate:null}},Npe=function(){},Bpe=function(){return Promise.resolve(null)},Fpe=[];function zpe(e){var t=e.placement,n=t===void 0?"bottom":t,s=e.strategy,a=s===void 0?"absolute":s,d=e.modifiers,f=d===void 0?Fpe:d,i=e.referenceElement,S=e.onFirstUpdate,E=e.innerRef,L=e.children,F=Zh.useContext(f8),G=Zh.useState(null),q=G[0],Q=G[1],te=Zh.useState(null),he=te[0],fe=te[1];Zh.useEffect(function(){jI(E,q)},[E,q]);var le=Zh.useMemo(function(){return{placement:n,strategy:a,onFirstUpdate:S,modifiers:[].concat(f,[{name:"arrow",enabled:he!=null,options:{element:he}}])}},[n,a,S,f,he]),Se=Rpe(i||F,q,le),ke=Se.state,Ee=Se.styles,Ie=Se.forceUpdate,He=Se.update,Ye=Zh.useMemo(function(){return{ref:Q,style:Ee.popper,placement:ke?ke.placement:n,hasPopperEscaped:ke&&ke.modifiersData.hide?ke.modifiersData.hide.hasPopperEscaped:null,isReferenceHidden:ke&&ke.modifiersData.hide?ke.modifiersData.hide.isReferenceHidden:null,arrowProps:{style:Ee.arrow,ref:fe},forceUpdate:Ie||Npe,update:He||Bpe}},[Q,fe,n,ke,Ee,He,Ie]);return g8(L)(Ye)}var Upe=function(){},$pe=Upe;const Vpe=w_($pe);function Wpe(e){var t=e.children,n=e.innerRef,s=Zh.useContext(m8),a=Zh.useCallback(function(d){jI(n,d),y8(s,d)},[n,s]);return Zh.useEffect(function(){return function(){return jI(n,null)}},[]),Zh.useEffect(function(){Vpe(!!s,"`Reference` should not be used outside of a `Manager` component.")},[s]),g8(t)({ref:a})}function jpe(e,t){if(ks(2,arguments),Ny(t)!=="object"||t===null)throw new RangeError("values parameter must be an object");var n=eo(e);return isNaN(n.getTime())?new Date(NaN):(t.year!=null&&n.setFullYear(t.year),t.month!=null&&(n=_m(n,t.month)),t.date!=null&&n.setDate(Ml(t.date)),t.hours!=null&&n.setHours(Ml(t.hours)),t.minutes!=null&&n.setMinutes(Ml(t.minutes)),t.seconds!=null&&n.setSeconds(Ml(t.seconds)),t.milliseconds!=null&&n.setMilliseconds(Ml(t.milliseconds)),n)}function v3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function E2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(n),!0).forEach(function(s){_i(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function qI(e){return qI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qI(e)}function Ap(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x3(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,k8(s.key),s)}}function Mp(e,t,n){return t&&x3(e.prototype,t),n&&x3(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _i(e,t,n){return(t=k8(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tw(){return tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},tw.apply(this,arguments)}function Ip(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YI(e,t)}function k2(e){return k2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k2(e)}function YI(e,t){return YI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},YI(e,t)}function Pi(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lp(e){var t=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,s=k2(e);if(t){var a=k2(this).constructor;n=Reflect.construct(s,arguments,a)}else n=s.apply(this,arguments);return function(d,f){if(f&&(typeof f=="object"||typeof f=="function"))return f;if(f!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pi(d)}(this,n)}}function cT(e){return function(t){if(Array.isArray(t))return eM(t)}(e)||function(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}(e)||function(t,n){if(t){if(typeof t=="string")return eM(t,n);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return eM(t,n)}}(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function eM(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function k8(e){var t=function(n,s){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var d=a.call(n,s||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}(e,"string");return typeof t=="symbol"?t:String(t)}var b3=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},w3=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Hpe={p:w3,P:function(e,t){var n,s=e.match(/(P+)(p+)?/)||[],a=s[1],d=s[2];if(!d)return b3(e,t);switch(a){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",b3(a,t)).replace("{{time}}",w3(d,t))}},VS=12,Gpe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;function wh(e){var t=e?typeof e=="string"||e instanceof String?Xue(e):eo(e):new Date;return Kv(t)?t:null}function Kv(e,t){return t=t||new Date("1/1/1000"),nT(e)&&!Jv(e,t)}function hu(e,t,n){if(n==="en")return JN(e,t,{awareOfUnicodeTokens:!0});var s=nx(n);return n&&!s&&console.warn('A locale object was not found for the provided string ["'.concat(n,'"].')),!s&&ab()&&nx(ab())&&(s=nx(ab())),JN(e,t,{locale:s||null,awareOfUnicodeTokens:!0})}function n_(e,t){var n=t.dateFormat,s=t.locale;return e&&hu(e,Array.isArray(n)?n[0]:n,s)||""}function S3(e,t){var n=t.hour,s=n===void 0?0:n,a=t.minute,d=a===void 0?0:a,f=t.second;return mE(fE(jhe(e,f===void 0?0:f),d),s)}function y_(e,t,n){var s=nx(t||ab());return o8(e,{locale:s,weekStartsOn:n})}function rx(e){return a8(e)}function ES(e){return l8(e)}function T3(e){return UI(e)}function C3(){return m_(wh())}function ex(e,t){return e&&t?Qhe(e,t):!e&&!t}function g0(e,t){return e&&t?Khe(e,t):!e&&!t}function A2(e,t){return e&&t?Jhe(e,t):!e&&!t}function Rh(e,t){return e&&t?Zhe(e,t):!e&&!t}function rb(e,t){return e&&t?Xhe(e,t):!e&&!t}function _E(e,t,n){var s,a=m_(t),d=$I(n);try{s=oT(e,{start:a,end:d})}catch{s=!1}return s}function ab(){return(typeof window<"u"?window:globalThis).__localeId__}function nx(e){if(typeof e=="string"){var t=typeof window<"u"?window:globalThis;return t.__localeData__?t.__localeData__[e]:null}return e}function VD(e,t){return hu(_m(wh(),e),"LLLL",t)}function A8(e,t){return hu(_m(wh(),e),"LLL",t)}function Ik(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.maxDate,a=t.excludeDates,d=t.excludeDateIntervals,f=t.includeDates,i=t.includeDateIntervals,S=t.filterDate;return Lk(e,{minDate:n,maxDate:s})||a&&a.some(function(E){return Rh(e,E)})||d&&d.some(function(E){var L=E.start,F=E.end;return oT(e,{start:L,end:F})})||f&&!f.some(function(E){return Rh(e,E)})||i&&!i.some(function(E){var L=E.start,F=E.end;return oT(e,{start:L,end:F})})||S&&!S(wh(e))||!1}function WD(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.excludeDates,s=t.excludeDateIntervals;return s&&s.length>0?s.some(function(a){var d=a.start,f=a.end;return oT(e,{start:d,end:f})}):n&&n.some(function(a){return Rh(e,a)})||!1}function M8(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.maxDate,a=t.excludeDates,d=t.includeDates,f=t.filterDate;return Lk(e,{minDate:a8(n),maxDate:qhe(s)})||a&&a.some(function(i){return g0(e,i)})||d&&!d.some(function(i){return g0(e,i)})||f&&!f(wh(e))||!1}function tM(e,t,n,s){var a=Fl(e),d=Nf(e),f=Fl(t),i=Nf(t),S=Fl(s);return a===f&&a===S?d<=n&&n<=i:a<f?S===a&&d<=n||S===f&&i>=n||S<f&&S>a:void 0}function qpe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.maxDate,a=t.excludeDates,d=t.includeDates,f=t.filterDate;return Lk(e,{minDate:n,maxDate:s})||a&&a.some(function(i){return A2(e,i)})||d&&!d.some(function(i){return A2(e,i)})||f&&!f(wh(e))||!1}function iM(e,t,n){if(!nT(t)||!nT(n))return!1;var s=Fl(t),a=Fl(n);return s<=e&&a>=e}function I8(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.maxDate,a=t.excludeDates,d=t.includeDates,f=t.filterDate,i=new Date(e,0,1);return Lk(i,{minDate:l8(n),maxDate:Yhe(s)})||a&&a.some(function(S){return ex(i,S)})||d&&!d.some(function(S){return ex(i,S)})||f&&!f(wh(i))||!1}function rM(e,t,n,s){var a=Fl(e),d=E1(e),f=Fl(t),i=E1(t),S=Fl(s);return a===f&&a===S?d<=n&&n<=i:a<f?S===a&&d<=n||S===f&&i>=n||S<f&&S>a:void 0}function Lk(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.maxDate;return n&&b2(e,n)<0||s&&b2(e,s)>0}function E3(e,t){return t.some(function(n){return f_(n)===f_(e)&&p_(n)===p_(e)})}function k3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.excludeTimes,s=t.includeTimes,a=t.filterTime;return n&&E3(e,n)||s&&!E3(e,s)||a&&!a(e)||!1}function A3(e,t){var n=t.minTime,s=t.maxTime;if(!n||!s)throw new Error("Both minTime and maxTime props required");var a,d=wh(),f=mE(fE(d,p_(e)),f_(e)),i=mE(fE(d,p_(n)),f_(n)),S=mE(fE(d,p_(s)),f_(s));try{a=!oT(f,{start:i,end:S})}catch{a=!1}return a}function M3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.includeDates,a=Z1(e,1);return n&&w2(n,a)>0||s&&s.every(function(d){return w2(d,a)>0})||!1}function I3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.maxDate,s=t.includeDates,a=T0(e,1);return n&&w2(a,n)>0||s&&s.every(function(d){return w2(a,d)>0})||!1}function L3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minDate,s=t.includeDates,a=sT(e,1);return n&&S2(n,a)>0||s&&s.every(function(d){return S2(d,a)>0})||!1}function D3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.maxDate,s=t.includeDates,a=X1(e,1);return n&&S2(a,n)>0||s&&s.every(function(d){return S2(a,d)>0})||!1}function L8(e){var t=e.minDate,n=e.includeDates;if(n&&t){var s=n.filter(function(a){return b2(a,t)>=0});return r3(s)}return n?r3(n):t}function D8(e){var t=e.maxDate,n=e.includeDates;if(n&&t){var s=n.filter(function(a){return b2(a,t)<=0});return n3(s)}return n?n3(n):t}function P3(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"react-datepicker__day--highlighted",n=new Map,s=0,a=e.length;s<a;s++){var d=e[s];if(kk(d)){var f=hu(d,"MM.dd.yyyy"),i=n.get(f)||[];i.includes(t)||(i.push(t),n.set(f,i))}else if(qI(d)==="object"){var S=Object.keys(d),E=S[0],L=d[S[0]];if(typeof E=="string"&&L.constructor===Array)for(var F=0,G=L.length;F<G;F++){var q=hu(L[F],"MM.dd.yyyy"),Q=n.get(q)||[];Q.includes(E)||(Q.push(E),n.set(q,Q))}}}return n}function Ype(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"react-datepicker__day--holidays",n=new Map;return e.forEach(function(s){var a=s.date,d=s.holidayName;if(kk(a)){var f=hu(a,"MM.dd.yyyy"),i=n.get(f)||{};if(!("className"in i)||i.className!==t||(S=i.holidayNames,E=[d],S.length!==E.length||!S.every(function(F,G){return F===E[G]}))){var S,E;i.className=t;var L=i.holidayNames;i.holidayNames=L?[].concat(cT(L),[d]):[d],n.set(f,i)}}}),n}function Xpe(e,t,n,s,a){for(var d=a.length,f=[],i=0;i<d;i++){var S=FI(Nhe(e,f_(a[i])),p_(a[i])),E=FI(e,(n+1)*s);cx(S,t)&&Jv(S,E)&&f.push(a[i])}return f}function O3(e){return e<10?"0".concat(e):"".concat(e)}function k1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:VS,n=Math.ceil(Fl(e)/t)*t;return{startPeriod:n-(t-1),endPeriod:n}}function R3(e){var t=e.getSeconds(),n=e.getMilliseconds();return eo(e.getTime()-1e3*t-n)}function Zpe(e,t,n,s){for(var a=[],d=0;d<2*t+1;d++){var f=e+t-d,i=!0;n&&(i=Fl(n)<=f),s&&i&&(i=Fl(s)>=f),i&&a.push(f)}return a}var Kpe=Ak(function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;Ap(this,n),_i(Pi(a=t.call(this,s)),"renderOptions",function(){var S=a.props.year,E=a.state.yearsList.map(function(G){return B.createElement("div",{className:S===G?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:G,onClick:a.onChange.bind(Pi(a),G),"aria-selected":S===G?"true":void 0},S===G?B.createElement("span",{className:"react-datepicker__year-option--selected"},""):"",G)}),L=a.props.minDate?Fl(a.props.minDate):null,F=a.props.maxDate?Fl(a.props.maxDate):null;return F&&a.state.yearsList.find(function(G){return G===F})||E.unshift(B.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:a.incrementYears},B.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),L&&a.state.yearsList.find(function(G){return G===L})||E.push(B.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:a.decrementYears},B.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),E}),_i(Pi(a),"onChange",function(S){a.props.onChange(S)}),_i(Pi(a),"handleClickOutside",function(){a.props.onCancel()}),_i(Pi(a),"shiftYears",function(S){var E=a.state.yearsList.map(function(L){return L+S});a.setState({yearsList:E})}),_i(Pi(a),"incrementYears",function(){return a.shiftYears(1)}),_i(Pi(a),"decrementYears",function(){return a.shiftYears(-1)});var d=s.yearDropdownItemNumber,f=s.scrollableYearDropdown,i=d||(f?10:5);return a.state={yearsList:Zpe(a.props.year,i,a.props.minDate,a.props.maxDate)},a.dropdownRef=lW(),a}return Mp(n,[{key:"componentDidMount",value:function(){var s=this.dropdownRef.current;if(s){var a=s.children?Array.from(s.children):null,d=a?a.find(function(f){return f.ariaSelected}):null;s.scrollTop=d?d.offsetTop+(d.clientHeight-s.clientHeight)/2:(s.scrollHeight-s.clientHeight)/2}}},{key:"render",value:function(){var s=of({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return B.createElement("div",{className:s,ref:this.dropdownRef},this.renderOptions())}}]),n}()),Qpe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"state",{dropdownVisible:!1}),_i(Pi(s),"renderSelectOptions",function(){for(var i=s.props.minDate?Fl(s.props.minDate):1900,S=s.props.maxDate?Fl(s.props.maxDate):2100,E=[],L=i;L<=S;L++)E.push(B.createElement("option",{key:L,value:L},L));return E}),_i(Pi(s),"onSelectChange",function(i){s.onChange(i.target.value)}),_i(Pi(s),"renderSelectMode",function(){return B.createElement("select",{value:s.props.year,className:"react-datepicker__year-select",onChange:s.onSelectChange},s.renderSelectOptions())}),_i(Pi(s),"renderReadView",function(i){return B.createElement("div",{key:"read",style:{visibility:i?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(S){return s.toggleDropdown(S)}},B.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),B.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},s.props.year))}),_i(Pi(s),"renderDropdown",function(){return B.createElement(Kpe,{key:"dropdown",year:s.props.year,onChange:s.onChange,onCancel:s.toggleDropdown,minDate:s.props.minDate,maxDate:s.props.maxDate,scrollableYearDropdown:s.props.scrollableYearDropdown,yearDropdownItemNumber:s.props.yearDropdownItemNumber})}),_i(Pi(s),"renderScrollMode",function(){var i=s.state.dropdownVisible,S=[s.renderReadView(!i)];return i&&S.unshift(s.renderDropdown()),S}),_i(Pi(s),"onChange",function(i){s.toggleDropdown(),i!==s.props.year&&s.props.onChange(i)}),_i(Pi(s),"toggleDropdown",function(i){s.setState({dropdownVisible:!s.state.dropdownVisible},function(){s.props.adjustDateOnChange&&s.handleYearChange(s.props.date,i)})}),_i(Pi(s),"handleYearChange",function(i,S){s.onSelect(i,S),s.setOpen()}),_i(Pi(s),"onSelect",function(i,S){s.props.onSelect&&s.props.onSelect(i,S)}),_i(Pi(s),"setOpen",function(){s.props.setOpen&&s.props.setOpen(!0)}),s}return Mp(n,[{key:"render",value:function(){var s;switch(this.props.dropdownMode){case"scroll":s=this.renderScrollMode();break;case"select":s=this.renderSelectMode()}return B.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},s)}}]),n}(),Jpe=Ak(function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"isSelectedMonth",function(i){return s.props.month===i}),_i(Pi(s),"renderOptions",function(){return s.props.monthNames.map(function(i,S){return B.createElement("div",{className:s.isSelectedMonth(S)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:i,onClick:s.onChange.bind(Pi(s),S),"aria-selected":s.isSelectedMonth(S)?"true":void 0},s.isSelectedMonth(S)?B.createElement("span",{className:"react-datepicker__month-option--selected"},""):"",i)})}),_i(Pi(s),"onChange",function(i){return s.props.onChange(i)}),_i(Pi(s),"handleClickOutside",function(){return s.props.onCancel()}),s}return Mp(n,[{key:"render",value:function(){return B.createElement("div",{className:"react-datepicker__month-dropdown"},this.renderOptions())}}]),n}()),efe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"state",{dropdownVisible:!1}),_i(Pi(s),"renderSelectOptions",function(i){return i.map(function(S,E){return B.createElement("option",{key:E,value:E},S)})}),_i(Pi(s),"renderSelectMode",function(i){return B.createElement("select",{value:s.props.month,className:"react-datepicker__month-select",onChange:function(S){return s.onChange(S.target.value)}},s.renderSelectOptions(i))}),_i(Pi(s),"renderReadView",function(i,S){return B.createElement("div",{key:"read",style:{visibility:i?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:s.toggleDropdown},B.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),B.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},S[s.props.month]))}),_i(Pi(s),"renderDropdown",function(i){return B.createElement(Jpe,{key:"dropdown",month:s.props.month,monthNames:i,onChange:s.onChange,onCancel:s.toggleDropdown})}),_i(Pi(s),"renderScrollMode",function(i){var S=s.state.dropdownVisible,E=[s.renderReadView(!S,i)];return S&&E.unshift(s.renderDropdown(i)),E}),_i(Pi(s),"onChange",function(i){s.toggleDropdown(),i!==s.props.month&&s.props.onChange(i)}),_i(Pi(s),"toggleDropdown",function(){return s.setState({dropdownVisible:!s.state.dropdownVisible})}),s}return Mp(n,[{key:"render",value:function(){var s,a=this,d=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(f){return A8(f,a.props.locale)}:function(f){return VD(f,a.props.locale)});switch(this.props.dropdownMode){case"scroll":s=this.renderScrollMode(d);break;case"select":s=this.renderSelectMode(d)}return B.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},s)}}]),n}();function tfe(e,t){for(var n=[],s=rx(e),a=rx(t);!cx(s,a);)n.push(wh(s)),s=T0(s,1);return n}var ife=Ak(function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"renderOptions",function(){return a.state.monthYearsList.map(function(d){var f=zI(d),i=ex(a.props.date,d)&&g0(a.props.date,d);return B.createElement("div",{className:i?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:f,onClick:a.onChange.bind(Pi(a),f),"aria-selected":i?"true":void 0},i?B.createElement("span",{className:"react-datepicker__month-year-option--selected"},""):"",hu(d,a.props.dateFormat,a.props.locale))})}),_i(Pi(a),"onChange",function(d){return a.props.onChange(d)}),_i(Pi(a),"handleClickOutside",function(){a.props.onCancel()}),a.state={monthYearsList:tfe(a.props.minDate,a.props.maxDate)},a}return Mp(n,[{key:"render",value:function(){var s=of({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return B.createElement("div",{className:s},this.renderOptions())}}]),n}()),rfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"state",{dropdownVisible:!1}),_i(Pi(s),"renderSelectOptions",function(){for(var i=rx(s.props.minDate),S=rx(s.props.maxDate),E=[];!cx(i,S);){var L=zI(i);E.push(B.createElement("option",{key:L,value:L},hu(i,s.props.dateFormat,s.props.locale))),i=T0(i,1)}return E}),_i(Pi(s),"onSelectChange",function(i){s.onChange(i.target.value)}),_i(Pi(s),"renderSelectMode",function(){return B.createElement("select",{value:zI(rx(s.props.date)),className:"react-datepicker__month-year-select",onChange:s.onSelectChange},s.renderSelectOptions())}),_i(Pi(s),"renderReadView",function(i){var S=hu(s.props.date,s.props.dateFormat,s.props.locale);return B.createElement("div",{key:"read",style:{visibility:i?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:function(E){return s.toggleDropdown(E)}},B.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),B.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},S))}),_i(Pi(s),"renderDropdown",function(){return B.createElement(ife,{key:"dropdown",date:s.props.date,dateFormat:s.props.dateFormat,onChange:s.onChange,onCancel:s.toggleDropdown,minDate:s.props.minDate,maxDate:s.props.maxDate,scrollableMonthYearDropdown:s.props.scrollableMonthYearDropdown,locale:s.props.locale})}),_i(Pi(s),"renderScrollMode",function(){var i=s.state.dropdownVisible,S=[s.renderReadView(!i)];return i&&S.unshift(s.renderDropdown()),S}),_i(Pi(s),"onChange",function(i){s.toggleDropdown();var S=wh(parseInt(i));ex(s.props.date,S)&&g0(s.props.date,S)||s.props.onChange(S)}),_i(Pi(s),"toggleDropdown",function(){return s.setState({dropdownVisible:!s.state.dropdownVisible})}),s}return Mp(n,[{key:"render",value:function(){var s;switch(this.props.dropdownMode){case"scroll":s=this.renderScrollMode();break;case"select":s=this.renderSelectMode()}return B.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},s)}}]),n}(),nfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"dayEl",B.createRef()),_i(Pi(s),"handleClick",function(i){!s.isDisabled()&&s.props.onClick&&s.props.onClick(i)}),_i(Pi(s),"handleMouseEnter",function(i){!s.isDisabled()&&s.props.onMouseEnter&&s.props.onMouseEnter(i)}),_i(Pi(s),"handleOnKeyDown",function(i){i.key===" "&&(i.preventDefault(),i.key="Enter"),s.props.handleOnKeyDown(i)}),_i(Pi(s),"isSameDay",function(i){return Rh(s.props.day,i)}),_i(Pi(s),"isKeyboardSelected",function(){return!s.props.disabledKeyboardNavigation&&!(s.isSameDay(s.props.selected)||s.isSameWeek(s.props.selected))&&(s.isSameDay(s.props.preSelection)||s.isSameWeek(s.props.preSelection))}),_i(Pi(s),"isDisabled",function(){return Ik(s.props.day,s.props)}),_i(Pi(s),"isExcluded",function(){return WD(s.props.day,s.props)}),_i(Pi(s),"isStartOfWeek",function(){return Rh(s.props.day,y_(s.props.day,s.props.locale,s.props.calendarStartDay))}),_i(Pi(s),"isSameWeek",function(i){return s.props.showWeekPicker&&Rh(i,y_(s.props.day,s.props.locale,s.props.calendarStartDay))}),_i(Pi(s),"getHighLightedClass",function(){var i=s.props,S=i.day,E=i.highlightDates;if(!E)return!1;var L=hu(S,"MM.dd.yyyy");return E.get(L)}),_i(Pi(s),"getHolidaysClass",function(){var i=s.props,S=i.day,E=i.holidays;if(!E)return!1;var L=hu(S,"MM.dd.yyyy");return E.has(L)?[E.get(L).className]:void 0}),_i(Pi(s),"isInRange",function(){var i=s.props,S=i.day,E=i.startDate,L=i.endDate;return!(!E||!L)&&_E(S,E,L)}),_i(Pi(s),"isInSelectingRange",function(){var i,S=s.props,E=S.day,L=S.selectsStart,F=S.selectsEnd,G=S.selectsRange,q=S.selectsDisabledDaysInRange,Q=S.startDate,te=S.endDate,he=(i=s.props.selectingDate)!==null&&i!==void 0?i:s.props.preSelection;return!(!(L||F||G)||!he||!q&&s.isDisabled())&&(L&&te&&(Jv(he,te)||rb(he,te))?_E(E,he,te):(F&&Q&&(cx(he,Q)||rb(he,Q))||!(!G||!Q||te||!cx(he,Q)&&!rb(he,Q)))&&_E(E,Q,he))}),_i(Pi(s),"isSelectingRangeStart",function(){var i;if(!s.isInSelectingRange())return!1;var S=s.props,E=S.day,L=S.startDate,F=S.selectsStart,G=(i=s.props.selectingDate)!==null&&i!==void 0?i:s.props.preSelection;return Rh(E,F?G:L)}),_i(Pi(s),"isSelectingRangeEnd",function(){var i;if(!s.isInSelectingRange())return!1;var S=s.props,E=S.day,L=S.endDate,F=S.selectsEnd,G=S.selectsRange,q=(i=s.props.selectingDate)!==null&&i!==void 0?i:s.props.preSelection;return Rh(E,F||G?q:L)}),_i(Pi(s),"isRangeStart",function(){var i=s.props,S=i.day,E=i.startDate,L=i.endDate;return!(!E||!L)&&Rh(E,S)}),_i(Pi(s),"isRangeEnd",function(){var i=s.props,S=i.day,E=i.startDate,L=i.endDate;return!(!E||!L)&&Rh(L,S)}),_i(Pi(s),"isWeekend",function(){var i=zhe(s.props.day);return i===0||i===6}),_i(Pi(s),"isAfterMonth",function(){return s.props.month!==void 0&&(s.props.month+1)%12===Nf(s.props.day)}),_i(Pi(s),"isBeforeMonth",function(){return s.props.month!==void 0&&(Nf(s.props.day)+1)%12===s.props.month}),_i(Pi(s),"isCurrentDay",function(){return s.isSameDay(wh())}),_i(Pi(s),"isSelected",function(){return s.isSameDay(s.props.selected)||s.isSameWeek(s.props.selected)}),_i(Pi(s),"getClassNames",function(i){var S,E=s.props.dayClassName?s.props.dayClassName(i):void 0;return of("react-datepicker__day",E,"react-datepicker__day--"+hu(s.props.day,"ddd",S),{"react-datepicker__day--disabled":s.isDisabled(),"react-datepicker__day--excluded":s.isExcluded(),"react-datepicker__day--selected":s.isSelected(),"react-datepicker__day--keyboard-selected":s.isKeyboardSelected(),"react-datepicker__day--range-start":s.isRangeStart(),"react-datepicker__day--range-end":s.isRangeEnd(),"react-datepicker__day--in-range":s.isInRange(),"react-datepicker__day--in-selecting-range":s.isInSelectingRange(),"react-datepicker__day--selecting-range-start":s.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":s.isSelectingRangeEnd(),"react-datepicker__day--today":s.isCurrentDay(),"react-datepicker__day--weekend":s.isWeekend(),"react-datepicker__day--outside-month":s.isAfterMonth()||s.isBeforeMonth()},s.getHighLightedClass("react-datepicker__day--highlighted"),s.getHolidaysClass())}),_i(Pi(s),"getAriaLabel",function(){var i=s.props,S=i.day,E=i.ariaLabelPrefixWhenEnabled,L=E===void 0?"Choose":E,F=i.ariaLabelPrefixWhenDisabled,G=F===void 0?"Not available":F,q=s.isDisabled()||s.isExcluded()?G:L;return"".concat(q," ").concat(hu(S,"PPPP",s.props.locale))}),_i(Pi(s),"getTitle",function(){var i=s.props,S=i.day,E=i.holidays,L=E===void 0?new Map:E,F=hu(S,"MM.dd.yyyy");return L.has(F)&&L.get(F).holidayNames.length>0?L.get(F).holidayNames.join(", "):""}),_i(Pi(s),"getTabIndex",function(i,S){var E=i||s.props.selected,L=S||s.props.preSelection;return(!s.props.showWeekPicker||!s.props.showWeekNumber&&s.isStartOfWeek())&&(s.isKeyboardSelected()||s.isSameDay(E)&&Rh(L,E))?0:-1}),_i(Pi(s),"handleFocusDay",function(){var i,S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=!1;s.getTabIndex()===0&&!S.isInputFocused&&s.isSameDay(s.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(E=!0),s.props.inline&&!s.props.shouldFocusDayInline&&(E=!1),s.props.containerRef&&s.props.containerRef.current&&s.props.containerRef.current.contains(document.activeElement)&&document.activeElement.classList.contains("react-datepicker__day")&&(E=!0),s.props.monthShowsDuplicateDaysEnd&&s.isAfterMonth()&&(E=!1),s.props.monthShowsDuplicateDaysStart&&s.isBeforeMonth()&&(E=!1)),E&&((i=s.dayEl.current)===null||i===void 0||i.focus({preventScroll:!0}))}),_i(Pi(s),"renderDayContents",function(){return s.props.monthShowsDuplicateDaysEnd&&s.isAfterMonth()||s.props.monthShowsDuplicateDaysStart&&s.isBeforeMonth()?null:s.props.renderDayContents?s.props.renderDayContents(i3(s.props.day),s.props.day):i3(s.props.day)}),_i(Pi(s),"render",function(){return B.createElement("div",{ref:s.dayEl,className:s.getClassNames(s.props.day),onKeyDown:s.handleOnKeyDown,onClick:s.handleClick,onMouseEnter:s.handleMouseEnter,tabIndex:s.getTabIndex(),"aria-label":s.getAriaLabel(),role:"option",title:s.getTitle(),"aria-disabled":s.isDisabled(),"aria-current":s.isCurrentDay()?"date":void 0,"aria-selected":s.isSelected()||s.isInRange()},s.renderDayContents(),s.getTitle()!==""&&B.createElement("span",{className:"holiday-overlay"},s.getTitle()))}),s}return Mp(n,[{key:"componentDidMount",value:function(){this.handleFocusDay()}},{key:"componentDidUpdate",value:function(s){this.handleFocusDay(s)}}]),n}(),sfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"weekNumberEl",B.createRef()),_i(Pi(s),"handleClick",function(i){s.props.onClick&&s.props.onClick(i)}),_i(Pi(s),"handleOnKeyDown",function(i){i.key===" "&&(i.preventDefault(),i.key="Enter"),s.props.handleOnKeyDown(i)}),_i(Pi(s),"isKeyboardSelected",function(){return!s.props.disabledKeyboardNavigation&&!Rh(s.props.date,s.props.selected)&&Rh(s.props.date,s.props.preSelection)}),_i(Pi(s),"getTabIndex",function(){return s.props.showWeekPicker&&s.props.showWeekNumber&&(s.isKeyboardSelected()||Rh(s.props.date,s.props.selected)&&Rh(s.props.preSelection,s.props.selected))?0:-1}),_i(Pi(s),"handleFocusWeekNumber",function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},S=!1;s.getTabIndex()===0&&!i.isInputFocused&&Rh(s.props.date,s.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(S=!0),s.props.inline&&!s.props.shouldFocusDayInline&&(S=!1),s.props.containerRef&&s.props.containerRef.current&&s.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(S=!0)),S&&s.weekNumberEl.current&&s.weekNumberEl.current.focus({preventScroll:!0})}),s}return Mp(n,[{key:"componentDidMount",value:function(){this.handleFocusWeekNumber()}},{key:"componentDidUpdate",value:function(s){this.handleFocusWeekNumber(s)}},{key:"render",value:function(){var s=this.props,a=s.weekNumber,d=s.ariaLabelPrefix,f=d===void 0?"week ":d,i={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!s.onClick,"react-datepicker__week-number--selected":Rh(this.props.date,this.props.selected),"react-datepicker__week-number--keyboard-selected":this.isKeyboardSelected()};return B.createElement("div",{ref:this.weekNumberEl,className:of(i),"aria-label":"".concat(f," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},a)}}],[{key:"defaultProps",get:function(){return{ariaLabelPrefix:"week "}}}]),n}(),ofe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"handleDayClick",function(i,S){s.props.onDayClick&&s.props.onDayClick(i,S)}),_i(Pi(s),"handleDayMouseEnter",function(i){s.props.onDayMouseEnter&&s.props.onDayMouseEnter(i)}),_i(Pi(s),"handleWeekClick",function(i,S,E){if(typeof s.props.onWeekSelect=="function"&&s.props.onWeekSelect(i,S,E),s.props.showWeekPicker){var L=y_(i,s.props.locale,s.props.calendarStartDay);s.handleDayClick(L,E)}s.props.shouldCloseOnSelect&&s.props.setOpen(!1)}),_i(Pi(s),"formatWeekNumber",function(i){return s.props.formatWeekNumber?s.props.formatWeekNumber(i):function(S,E){var L=E&&nx(E)||ab()&&nx(ab());return Whe(S,L?{locale:L}:null)}(i)}),_i(Pi(s),"renderDays",function(){var i=y_(s.props.day,s.props.locale,s.props.calendarStartDay),S=[],E=s.formatWeekNumber(i);if(s.props.showWeekNumber){var L=s.props.onWeekSelect||s.props.showWeekPicker?s.handleWeekClick.bind(Pi(s),i,E):void 0;S.push(B.createElement(sfe,{key:"W",weekNumber:E,date:i,onClick:L,selected:s.props.selected,preSelection:s.props.preSelection,ariaLabelPrefix:s.props.ariaLabelPrefix,showWeekPicker:s.props.showWeekPicker,showWeekNumber:s.props.showWeekNumber,disabledKeyboardNavigation:s.props.disabledKeyboardNavigation,handleOnKeyDown:s.props.handleOnKeyDown,isInputFocused:s.props.isInputFocused,containerRef:s.props.containerRef}))}return S.concat([0,1,2,3,4,5,6].map(function(F){var G=gw(i,F);return B.createElement(nfe,{ariaLabelPrefixWhenEnabled:s.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:s.props.disabledDayAriaLabelPrefix,key:G.valueOf(),day:G,month:s.props.month,onClick:s.handleDayClick.bind(Pi(s),G),onMouseEnter:s.handleDayMouseEnter.bind(Pi(s),G),minDate:s.props.minDate,maxDate:s.props.maxDate,excludeDates:s.props.excludeDates,excludeDateIntervals:s.props.excludeDateIntervals,includeDates:s.props.includeDates,includeDateIntervals:s.props.includeDateIntervals,highlightDates:s.props.highlightDates,holidays:s.props.holidays,selectingDate:s.props.selectingDate,filterDate:s.props.filterDate,preSelection:s.props.preSelection,selected:s.props.selected,selectsStart:s.props.selectsStart,selectsEnd:s.props.selectsEnd,selectsRange:s.props.selectsRange,showWeekPicker:s.props.showWeekPicker,showWeekNumber:s.props.showWeekNumber,selectsDisabledDaysInRange:s.props.selectsDisabledDaysInRange,startDate:s.props.startDate,endDate:s.props.endDate,dayClassName:s.props.dayClassName,renderDayContents:s.props.renderDayContents,disabledKeyboardNavigation:s.props.disabledKeyboardNavigation,handleOnKeyDown:s.props.handleOnKeyDown,isInputFocused:s.props.isInputFocused,containerRef:s.props.containerRef,inline:s.props.inline,shouldFocusDayInline:s.props.shouldFocusDayInline,monthShowsDuplicateDaysEnd:s.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:s.props.monthShowsDuplicateDaysStart,locale:s.props.locale})}))}),_i(Pi(s),"startOfWeek",function(){return y_(s.props.day,s.props.locale,s.props.calendarStartDay)}),_i(Pi(s),"isKeyboardSelected",function(){return!s.props.disabledKeyboardNavigation&&!Rh(s.startOfWeek(),s.props.selected)&&Rh(s.startOfWeek(),s.props.preSelection)}),s}return Mp(n,[{key:"render",value:function(){var s={"react-datepicker__week":!0,"react-datepicker__week--selected":Rh(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return B.createElement("div",{className:of(s)},this.renderDays())}}],[{key:"defaultProps",get:function(){return{shouldCloseOnSelect:!0}}}]),n}(),P8="two_columns",O8="three_columns",R8="four_columns",nM=_i(_i(_i({},P8,{grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2}),O8,{grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3}),R8,{grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4});function N3(e,t){return e?R8:t?P8:O8}var afe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"MONTH_REFS",cT(Array(12)).map(function(){return B.createRef()})),_i(Pi(s),"QUARTER_REFS",cT(Array(4)).map(function(){return B.createRef()})),_i(Pi(s),"isDisabled",function(i){return Ik(i,s.props)}),_i(Pi(s),"isExcluded",function(i){return WD(i,s.props)}),_i(Pi(s),"handleDayClick",function(i,S){s.props.onDayClick&&s.props.onDayClick(i,S,s.props.orderInDisplay)}),_i(Pi(s),"handleDayMouseEnter",function(i){s.props.onDayMouseEnter&&s.props.onDayMouseEnter(i)}),_i(Pi(s),"handleMouseLeave",function(){s.props.onMouseLeave&&s.props.onMouseLeave()}),_i(Pi(s),"isRangeStartMonth",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate;return!(!L||!F)&&g0(_m(E,i),L)}),_i(Pi(s),"isRangeStartQuarter",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate;return!(!L||!F)&&A2(v1(E,i),L)}),_i(Pi(s),"isRangeEndMonth",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate;return!(!L||!F)&&g0(_m(E,i),F)}),_i(Pi(s),"isRangeEndQuarter",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate;return!(!L||!F)&&A2(v1(E,i),F)}),_i(Pi(s),"isInSelectingRangeMonth",function(i){var S,E=s.props,L=E.day,F=E.selectsStart,G=E.selectsEnd,q=E.selectsRange,Q=E.startDate,te=E.endDate,he=(S=s.props.selectingDate)!==null&&S!==void 0?S:s.props.preSelection;return!(!(F||G||q)||!he)&&(F&&te?tM(he,te,i,L):(G&&Q||!(!q||!Q||te))&&tM(Q,he,i,L))}),_i(Pi(s),"isSelectingMonthRangeStart",function(i){var S;if(!s.isInSelectingRangeMonth(i))return!1;var E=s.props,L=E.day,F=E.startDate,G=E.selectsStart,q=_m(L,i),Q=(S=s.props.selectingDate)!==null&&S!==void 0?S:s.props.preSelection;return g0(q,G?Q:F)}),_i(Pi(s),"isSelectingMonthRangeEnd",function(i){var S;if(!s.isInSelectingRangeMonth(i))return!1;var E=s.props,L=E.day,F=E.endDate,G=E.selectsEnd,q=E.selectsRange,Q=_m(L,i),te=(S=s.props.selectingDate)!==null&&S!==void 0?S:s.props.preSelection;return g0(Q,G||q?te:F)}),_i(Pi(s),"isInSelectingRangeQuarter",function(i){var S,E=s.props,L=E.day,F=E.selectsStart,G=E.selectsEnd,q=E.selectsRange,Q=E.startDate,te=E.endDate,he=(S=s.props.selectingDate)!==null&&S!==void 0?S:s.props.preSelection;return!(!(F||G||q)||!he)&&(F&&te?rM(he,te,i,L):(G&&Q||!(!q||!Q||te))&&rM(Q,he,i,L))}),_i(Pi(s),"isWeekInMonth",function(i){var S=s.props.day,E=gw(i,6);return g0(i,S)||g0(E,S)}),_i(Pi(s),"isCurrentMonth",function(i,S){return Fl(i)===Fl(wh())&&S===Nf(wh())}),_i(Pi(s),"isCurrentQuarter",function(i,S){return Fl(i)===Fl(wh())&&S===E1(wh())}),_i(Pi(s),"isSelectedMonth",function(i,S,E){return Nf(E)===S&&Fl(i)===Fl(E)}),_i(Pi(s),"isSelectedQuarter",function(i,S,E){return E1(i)===S&&Fl(i)===Fl(E)}),_i(Pi(s),"renderWeeks",function(){for(var i=[],S=s.props.fixedHeight,E=0,L=!1,F=y_(rx(s.props.day),s.props.locale,s.props.calendarStartDay);i.push(B.createElement(ofe,{ariaLabelPrefix:s.props.weekAriaLabelPrefix,chooseDayAriaLabelPrefix:s.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:s.props.disabledDayAriaLabelPrefix,key:E,day:F,month:Nf(s.props.day),onDayClick:s.handleDayClick,onDayMouseEnter:s.handleDayMouseEnter,onWeekSelect:s.props.onWeekSelect,formatWeekNumber:s.props.formatWeekNumber,locale:s.props.locale,minDate:s.props.minDate,maxDate:s.props.maxDate,excludeDates:s.props.excludeDates,excludeDateIntervals:s.props.excludeDateIntervals,includeDates:s.props.includeDates,includeDateIntervals:s.props.includeDateIntervals,inline:s.props.inline,shouldFocusDayInline:s.props.shouldFocusDayInline,highlightDates:s.props.highlightDates,holidays:s.props.holidays,selectingDate:s.props.selectingDate,filterDate:s.props.filterDate,preSelection:s.props.preSelection,selected:s.props.selected,selectsStart:s.props.selectsStart,selectsEnd:s.props.selectsEnd,selectsRange:s.props.selectsRange,selectsDisabledDaysInRange:s.props.selectsDisabledDaysInRange,showWeekNumber:s.props.showWeekNumbers,showWeekPicker:s.props.showWeekPicker,startDate:s.props.startDate,endDate:s.props.endDate,dayClassName:s.props.dayClassName,setOpen:s.props.setOpen,shouldCloseOnSelect:s.props.shouldCloseOnSelect,disabledKeyboardNavigation:s.props.disabledKeyboardNavigation,renderDayContents:s.props.renderDayContents,handleOnKeyDown:s.props.handleOnKeyDown,isInputFocused:s.props.isInputFocused,containerRef:s.props.containerRef,calendarStartDay:s.props.calendarStartDay,monthShowsDuplicateDaysEnd:s.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:s.props.monthShowsDuplicateDaysStart})),!L;){E++,F=v2(F,1);var G=S&&E>=6,q=!S&&!s.isWeekInMonth(F);if(G||q){if(!s.props.peekNextMonth)break;L=!0}}return i}),_i(Pi(s),"onMonthClick",function(i,S){s.handleDayClick(rx(_m(s.props.day,S)),i)}),_i(Pi(s),"onMonthMouseEnter",function(i){s.handleDayMouseEnter(rx(_m(s.props.day,i)))}),_i(Pi(s),"handleMonthNavigation",function(i,S){s.isDisabled(S)||s.isExcluded(S)||(s.props.setPreSelection(S),s.MONTH_REFS[i].current&&s.MONTH_REFS[i].current.focus())}),_i(Pi(s),"onMonthKeyDown",function(i,S){var E=s.props,L=E.selected,F=E.preSelection,G=E.disabledKeyboardNavigation,q=E.showTwoColumnMonthYearPicker,Q=E.showFourColumnMonthYearPicker,te=E.setPreSelection,he=i.key;if(he!=="Tab"&&i.preventDefault(),!G){var fe=N3(Q,q),le=nM[fe].verticalNavigationOffset,Se=nM[fe].grid;switch(he){case"Enter":s.onMonthClick(i,S),te(L);break;case"ArrowRight":s.handleMonthNavigation(S===11?0:S+1,T0(F,1));break;case"ArrowLeft":s.handleMonthNavigation(S===0?11:S-1,Z1(F,1));break;case"ArrowUp":s.handleMonthNavigation(Se[0].includes(S)?S+12-le:S-le,Z1(F,le));break;case"ArrowDown":s.handleMonthNavigation(Se[Se.length-1].includes(S)?S-12+le:S+le,T0(F,le))}}}),_i(Pi(s),"onQuarterClick",function(i,S){s.handleDayClick(T3(v1(s.props.day,S)),i)}),_i(Pi(s),"onQuarterMouseEnter",function(i){s.handleDayMouseEnter(T3(v1(s.props.day,i)))}),_i(Pi(s),"handleQuarterNavigation",function(i,S){s.isDisabled(S)||s.isExcluded(S)||(s.props.setPreSelection(S),s.QUARTER_REFS[i-1].current&&s.QUARTER_REFS[i-1].current.focus())}),_i(Pi(s),"onQuarterKeyDown",function(i,S){var E=i.key;if(!s.props.disabledKeyboardNavigation)switch(E){case"Enter":s.onQuarterClick(i,S),s.props.setPreSelection(s.props.selected);break;case"ArrowRight":s.handleQuarterNavigation(S===4?1:S+1,s8(s.props.preSelection,1));break;case"ArrowLeft":s.handleQuarterNavigation(S===1?4:S-1,Fhe(s.props.preSelection,1))}}),_i(Pi(s),"getMonthClassNames",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate,G=S.selected,q=S.minDate,Q=S.maxDate,te=S.preSelection,he=S.monthClassName,fe=S.excludeDates,le=S.includeDates,Se=he?he(_m(E,i)):void 0,ke=_m(E,i);return of("react-datepicker__month-text","react-datepicker__month-".concat(i),Se,{"react-datepicker__month-text--disabled":(q||Q||fe||le)&&M8(ke,s.props),"react-datepicker__month-text--selected":s.isSelectedMonth(E,i,G),"react-datepicker__month-text--keyboard-selected":!s.props.disabledKeyboardNavigation&&Nf(te)===i,"react-datepicker__month-text--in-selecting-range":s.isInSelectingRangeMonth(i),"react-datepicker__month-text--in-range":tM(L,F,i,E),"react-datepicker__month-text--range-start":s.isRangeStartMonth(i),"react-datepicker__month-text--range-end":s.isRangeEndMonth(i),"react-datepicker__month-text--selecting-range-start":s.isSelectingMonthRangeStart(i),"react-datepicker__month-text--selecting-range-end":s.isSelectingMonthRangeEnd(i),"react-datepicker__month-text--today":s.isCurrentMonth(E,i)})}),_i(Pi(s),"getTabIndex",function(i){var S=Nf(s.props.preSelection);return s.props.disabledKeyboardNavigation||i!==S?"-1":"0"}),_i(Pi(s),"getQuarterTabIndex",function(i){var S=E1(s.props.preSelection);return s.props.disabledKeyboardNavigation||i!==S?"-1":"0"}),_i(Pi(s),"getAriaLabel",function(i){var S=s.props,E=S.chooseDayAriaLabelPrefix,L=E===void 0?"Choose":E,F=S.disabledDayAriaLabelPrefix,G=F===void 0?"Not available":F,q=S.day,Q=_m(q,i),te=s.isDisabled(Q)||s.isExcluded(Q)?G:L;return"".concat(te," ").concat(hu(Q,"MMMM yyyy"))}),_i(Pi(s),"getQuarterClassNames",function(i){var S=s.props,E=S.day,L=S.startDate,F=S.endDate,G=S.selected,q=S.minDate,Q=S.maxDate,te=S.preSelection,he=S.disabledKeyboardNavigation;return of("react-datepicker__quarter-text","react-datepicker__quarter-".concat(i),{"react-datepicker__quarter-text--disabled":(q||Q)&&qpe(v1(E,i),s.props),"react-datepicker__quarter-text--selected":s.isSelectedQuarter(E,i,G),"react-datepicker__quarter-text--keyboard-selected":!he&&E1(te)===i,"react-datepicker__quarter-text--in-selecting-range":s.isInSelectingRangeQuarter(i),"react-datepicker__quarter-text--in-range":rM(L,F,i,E),"react-datepicker__quarter-text--range-start":s.isRangeStartQuarter(i),"react-datepicker__quarter-text--range-end":s.isRangeEndQuarter(i)})}),_i(Pi(s),"getMonthContent",function(i){var S=s.props,E=S.showFullMonthYearPicker,L=S.renderMonthContent,F=S.locale,G=S.day,q=A8(i,F),Q=VD(i,F);return L?L(i,q,Q,G):E?Q:q}),_i(Pi(s),"getQuarterContent",function(i){var S=s.props,E=S.renderQuarterContent,L=function(F,G){return hu(v1(wh(),F),"QQQ",G)}(i,S.locale);return E?E(i,L):L}),_i(Pi(s),"renderMonths",function(){var i=s.props,S=i.showTwoColumnMonthYearPicker,E=i.showFourColumnMonthYearPicker,L=i.day,F=i.selected;return nM[N3(E,S)].grid.map(function(G,q){return B.createElement("div",{className:"react-datepicker__month-wrapper",key:q},G.map(function(Q,te){return B.createElement("div",{ref:s.MONTH_REFS[Q],key:te,onClick:function(he){s.onMonthClick(he,Q)},onKeyDown:function(he){s.onMonthKeyDown(he,Q)},onMouseEnter:function(){return s.onMonthMouseEnter(Q)},tabIndex:s.getTabIndex(Q),className:s.getMonthClassNames(Q),role:"option","aria-label":s.getAriaLabel(Q),"aria-current":s.isCurrentMonth(L,Q)?"date":void 0,"aria-selected":s.isSelectedMonth(L,Q,F)},s.getMonthContent(Q))}))})}),_i(Pi(s),"renderQuarters",function(){var i=s.props,S=i.day,E=i.selected;return B.createElement("div",{className:"react-datepicker__quarter-wrapper"},[1,2,3,4].map(function(L,F){return B.createElement("div",{key:F,ref:s.QUARTER_REFS[F],role:"option",onClick:function(G){s.onQuarterClick(G,L)},onKeyDown:function(G){s.onQuarterKeyDown(G,L)},onMouseEnter:function(){return s.onQuarterMouseEnter(L)},className:s.getQuarterClassNames(L),"aria-selected":s.isSelectedQuarter(S,L,E),tabIndex:s.getQuarterTabIndex(L),"aria-current":s.isCurrentQuarter(S,L)?"date":void 0},s.getQuarterContent(L))}))}),_i(Pi(s),"getClassNames",function(){var i=s.props,S=i.selectingDate,E=i.selectsStart,L=i.selectsEnd,F=i.showMonthYearPicker,G=i.showQuarterYearPicker,q=i.showWeekPicker;return of("react-datepicker__month",{"react-datepicker__month--selecting-range":S&&(E||L)},{"react-datepicker__monthPicker":F},{"react-datepicker__quarterPicker":G},{"react-datepicker__weekPicker":q})}),s}return Mp(n,[{key:"render",value:function(){var s=this.props,a=s.showMonthYearPicker,d=s.showQuarterYearPicker,f=s.day,i=s.ariaLabelPrefix,S=i===void 0?"month ":i;return B.createElement("div",{className:this.getClassNames(),onMouseLeave:this.handleMouseLeave,"aria-label":"".concat(S," ").concat(hu(f,"yyyy-MM")),role:"listbox"},a?this.renderMonths():d?this.renderQuarters():this.renderWeeks())}}]),n}(),N8=function(e){Ip(n,B.Component);var t=Lp(n);function n(){var s;Ap(this,n);for(var a=arguments.length,d=new Array(a),f=0;f<a;f++)d[f]=arguments[f];return _i(Pi(s=t.call.apply(t,[this].concat(d))),"state",{height:null}),_i(Pi(s),"scrollToTheSelectedTime",function(){requestAnimationFrame(function(){s.list&&(s.list.scrollTop=s.centerLi&&n.calcCenterPosition(s.props.monthRef?s.props.monthRef.clientHeight-s.header.clientHeight:s.list.clientHeight,s.centerLi))})}),_i(Pi(s),"handleClick",function(i){(s.props.minTime||s.props.maxTime)&&A3(i,s.props)||(s.props.excludeTimes||s.props.includeTimes||s.props.filterTime)&&k3(i,s.props)||s.props.onChange(i)}),_i(Pi(s),"isSelectedTime",function(i){return s.props.selected&&(S=s.props.selected,E=i,R3(S).getTime()===R3(E).getTime());var S,E}),_i(Pi(s),"isDisabledTime",function(i){return(s.props.minTime||s.props.maxTime)&&A3(i,s.props)||(s.props.excludeTimes||s.props.includeTimes||s.props.filterTime)&&k3(i,s.props)}),_i(Pi(s),"liClasses",function(i){var S=["react-datepicker__time-list-item",s.props.timeClassName?s.props.timeClassName(i):void 0];return s.isSelectedTime(i)&&S.push("react-datepicker__time-list-item--selected"),s.isDisabledTime(i)&&S.push("react-datepicker__time-list-item--disabled"),s.props.injectTimes&&(60*f_(i)+p_(i))%s.props.intervals!=0&&S.push("react-datepicker__time-list-item--injected"),S.join(" ")}),_i(Pi(s),"handleOnKeyDown",function(i,S){i.key===" "&&(i.preventDefault(),i.key="Enter"),i.key!=="ArrowUp"&&i.key!=="ArrowLeft"||!i.target.previousSibling||(i.preventDefault(),i.target.previousSibling.focus()),i.key!=="ArrowDown"&&i.key!=="ArrowRight"||!i.target.nextSibling||(i.preventDefault(),i.target.nextSibling.focus()),i.key==="Enter"&&s.handleClick(S),s.props.handleOnKeyDown(i)}),_i(Pi(s),"renderTimes",function(){for(var i=[],S=s.props.format?s.props.format:"p",E=s.props.intervals,L=s.props.selected||s.props.openToDate||wh(),F=m_(L),G=s.props.injectTimes&&s.props.injectTimes.sort(function(Se,ke){return Se-ke}),q=60*function(Se){var ke=new Date(Se.getFullYear(),Se.getMonth(),Se.getDate()),Ee=new Date(Se.getFullYear(),Se.getMonth(),Se.getDate(),24);return Math.round((+Ee-+ke)/36e5)}(L),Q=q/E,te=0;te<Q;te++){var he=FI(F,te*E);if(i.push(he),G){var fe=Xpe(F,he,te,E,G);i=i.concat(fe)}}var le=i.reduce(function(Se,ke){return ke.getTime()<=L.getTime()?ke:Se},i[0]);return i.map(function(Se,ke){return B.createElement("li",{key:ke,onClick:s.handleClick.bind(Pi(s),Se),className:s.liClasses(Se),ref:function(Ee){Se===le&&(s.centerLi=Ee)},onKeyDown:function(Ee){s.handleOnKeyDown(Ee,Se)},tabIndex:Se===le?0:-1,role:"option","aria-selected":s.isSelectedTime(Se)?"true":void 0,"aria-disabled":s.isDisabledTime(Se)?"true":void 0},hu(Se,S,s.props.locale))})}),s}return Mp(n,[{key:"componentDidMount",value:function(){this.scrollToTheSelectedTime(),this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})}},{key:"render",value:function(){var s=this,a=this.state.height;return B.createElement("div",{className:"react-datepicker__time-container ".concat(this.props.todayButton?"react-datepicker__time-container--with-today-button":"")},B.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(this.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(d){s.header=d}},B.createElement("div",{className:"react-datepicker-time__header"},this.props.timeCaption)),B.createElement("div",{className:"react-datepicker__time"},B.createElement("div",{className:"react-datepicker__time-box"},B.createElement("ul",{className:"react-datepicker__time-list",ref:function(d){s.list=d},style:a?{height:a}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))}}],[{key:"defaultProps",get:function(){return{intervals:30,onTimeChange:function(){},todayButton:null,timeCaption:"Time"}}}]),n}();_i(N8,"calcCenterPosition",function(e,t){return t.offsetTop-(e/2-t.clientHeight/2)});var lfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"YEAR_REFS",cT(Array(a.props.yearItemNumber)).map(function(){return B.createRef()})),_i(Pi(a),"isDisabled",function(d){return Ik(d,a.props)}),_i(Pi(a),"isExcluded",function(d){return WD(d,a.props)}),_i(Pi(a),"selectingDate",function(){var d;return(d=a.props.selectingDate)!==null&&d!==void 0?d:a.props.preSelection}),_i(Pi(a),"updateFocusOnPaginate",function(d){var f=(function(){this.YEAR_REFS[d].current.focus()}).bind(Pi(a));window.requestAnimationFrame(f)}),_i(Pi(a),"handleYearClick",function(d,f){a.props.onDayClick&&a.props.onDayClick(d,f)}),_i(Pi(a),"handleYearNavigation",function(d,f){var i=a.props,S=i.date,E=i.yearItemNumber,L=k1(S,E).startPeriod;a.isDisabled(f)||a.isExcluded(f)||(a.props.setPreSelection(f),d-L==-1?a.updateFocusOnPaginate(E-1):d-L===E?a.updateFocusOnPaginate(0):a.YEAR_REFS[d-L].current.focus())}),_i(Pi(a),"isSameDay",function(d,f){return Rh(d,f)}),_i(Pi(a),"isCurrentYear",function(d){return d===Fl(wh())}),_i(Pi(a),"isRangeStart",function(d){return a.props.startDate&&a.props.endDate&&ex(K_(wh(),d),a.props.startDate)}),_i(Pi(a),"isRangeEnd",function(d){return a.props.startDate&&a.props.endDate&&ex(K_(wh(),d),a.props.endDate)}),_i(Pi(a),"isInRange",function(d){return iM(d,a.props.startDate,a.props.endDate)}),_i(Pi(a),"isInSelectingRange",function(d){var f=a.props,i=f.selectsStart,S=f.selectsEnd,E=f.selectsRange,L=f.startDate,F=f.endDate;return!(!(i||S||E)||!a.selectingDate())&&(i&&F?iM(d,a.selectingDate(),F):(S&&L||!(!E||!L||F))&&iM(d,L,a.selectingDate()))}),_i(Pi(a),"isSelectingRangeStart",function(d){if(!a.isInSelectingRange(d))return!1;var f=a.props,i=f.startDate,S=f.selectsStart,E=K_(wh(),d);return ex(E,S?a.selectingDate():i)}),_i(Pi(a),"isSelectingRangeEnd",function(d){if(!a.isInSelectingRange(d))return!1;var f=a.props,i=f.endDate,S=f.selectsEnd,E=f.selectsRange,L=K_(wh(),d);return ex(L,S||E?a.selectingDate():i)}),_i(Pi(a),"isKeyboardSelected",function(d){var f=ES(K_(a.props.date,d));return!a.props.disabledKeyboardNavigation&&!a.props.inline&&!Rh(f,ES(a.props.selected))&&Rh(f,ES(a.props.preSelection))}),_i(Pi(a),"onYearClick",function(d,f){var i=a.props.date;a.handleYearClick(ES(K_(i,f)),d)}),_i(Pi(a),"onYearKeyDown",function(d,f){var i=d.key;if(!a.props.disabledKeyboardNavigation)switch(i){case"Enter":a.onYearClick(d,f),a.props.setPreSelection(a.props.selected);break;case"ArrowRight":a.handleYearNavigation(f+1,X1(a.props.preSelection,1));break;case"ArrowLeft":a.handleYearNavigation(f-1,sT(a.props.preSelection,1))}}),_i(Pi(a),"getYearClassNames",function(d){var f=a.props,i=f.minDate,S=f.maxDate,E=f.selected,L=f.excludeDates,F=f.includeDates,G=f.filterDate;return of("react-datepicker__year-text",{"react-datepicker__year-text--selected":d===Fl(E),"react-datepicker__year-text--disabled":(i||S||L||F||G)&&I8(d,a.props),"react-datepicker__year-text--keyboard-selected":a.isKeyboardSelected(d),"react-datepicker__year-text--range-start":a.isRangeStart(d),"react-datepicker__year-text--range-end":a.isRangeEnd(d),"react-datepicker__year-text--in-range":a.isInRange(d),"react-datepicker__year-text--in-selecting-range":a.isInSelectingRange(d),"react-datepicker__year-text--selecting-range-start":a.isSelectingRangeStart(d),"react-datepicker__year-text--selecting-range-end":a.isSelectingRangeEnd(d),"react-datepicker__year-text--today":a.isCurrentYear(d)})}),_i(Pi(a),"getYearTabIndex",function(d){return a.props.disabledKeyboardNavigation?"-1":d===Fl(a.props.preSelection)?"0":"-1"}),_i(Pi(a),"getYearContainerClassNames",function(){var d=a.props,f=d.selectingDate,i=d.selectsStart,S=d.selectsEnd,E=d.selectsRange;return of("react-datepicker__year",{"react-datepicker__year--selecting-range":f&&(i||S||E)})}),_i(Pi(a),"getYearContent",function(d){return a.props.renderYearContent?a.props.renderYearContent(d):d}),a}return Mp(n,[{key:"render",value:function(){for(var s=this,a=[],d=this.props,f=d.date,i=d.yearItemNumber,S=d.onYearMouseEnter,E=d.onYearMouseLeave,L=k1(f,i),F=L.startPeriod,G=L.endPeriod,q=function(te){a.push(B.createElement("div",{ref:s.YEAR_REFS[te-F],onClick:function(he){s.onYearClick(he,te)},onKeyDown:function(he){s.onYearKeyDown(he,te)},tabIndex:s.getYearTabIndex(te),className:s.getYearClassNames(te),onMouseEnter:function(he){return S(he,te)},onMouseLeave:function(he){return E(he,te)},key:te,"aria-current":s.isCurrentYear(te)?"date":void 0},s.getYearContent(te)))},Q=F;Q<=G;Q++)q(Q);return B.createElement("div",{className:this.getYearContainerClassNames()},B.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.clearSelectingDate},a))}}]),n}(),cfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"onTimeChange",function(d){a.setState({time:d});var f=a.props.date,i=f instanceof Date&&!isNaN(f)?f:new Date;i.setHours(d.split(":")[0]),i.setMinutes(d.split(":")[1]),a.props.onChange(i)}),_i(Pi(a),"renderTimeInput",function(){var d=a.state.time,f=a.props,i=f.date,S=f.timeString,E=f.customTimeInput;return E?B.cloneElement(E,{date:i,value:d,onChange:a.onTimeChange}):B.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",required:!0,value:d,onChange:function(L){a.onTimeChange(L.target.value||S)}})}),a.state={time:a.props.timeString},a}return Mp(n,[{key:"render",value:function(){return B.createElement("div",{className:"react-datepicker__input-time-container"},B.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),B.createElement("div",{className:"react-datepicker-time__input-container"},B.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))}}],[{key:"getDerivedStateFromProps",value:function(s,a){return s.timeString!==a.time?{time:s.timeString}:null}}]),n}();function hfe(e){var t=e.className,n=e.children,s=e.showPopperArrow,a=e.arrowProps,d=a===void 0?{}:a;return B.createElement("div",{className:t},s&&B.createElement("div",tw({className:"react-datepicker__triangle"},d)),n)}var ufe=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],dfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"handleClickOutside",function(d){a.props.onClickOutside(d)}),_i(Pi(a),"setClickOutsideRef",function(){return a.containerRef.current}),_i(Pi(a),"handleDropdownFocus",function(d){(function(){var f=((arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).className||"").split(/\s+/);return ufe.some(function(i){return f.indexOf(i)>=0})})(d.target)&&a.props.onDropdownFocus()}),_i(Pi(a),"getDateInView",function(){var d=a.props,f=d.preSelection,i=d.selected,S=d.openToDate,E=L8(a.props),L=D8(a.props),F=wh(),G=S||i||f;return G||(E&&Jv(F,E)?E:L&&cx(F,L)?L:F)}),_i(Pi(a),"increaseMonth",function(){a.setState(function(d){var f=d.date;return{date:T0(f,1)}},function(){return a.handleMonthChange(a.state.date)})}),_i(Pi(a),"decreaseMonth",function(){a.setState(function(d){var f=d.date;return{date:Z1(f,1)}},function(){return a.handleMonthChange(a.state.date)})}),_i(Pi(a),"handleDayClick",function(d,f,i){a.props.onSelect(d,f,i),a.props.setPreSelection&&a.props.setPreSelection(d)}),_i(Pi(a),"handleDayMouseEnter",function(d){a.setState({selectingDate:d}),a.props.onDayMouseEnter&&a.props.onDayMouseEnter(d)}),_i(Pi(a),"handleMonthMouseLeave",function(){a.setState({selectingDate:null}),a.props.onMonthMouseLeave&&a.props.onMonthMouseLeave()}),_i(Pi(a),"handleYearMouseEnter",function(d,f){a.setState({selectingDate:K_(wh(),f)}),a.props.onYearMouseEnter&&a.props.onYearMouseEnter(d,f)}),_i(Pi(a),"handleYearMouseLeave",function(d,f){a.props.onYearMouseLeave&&a.props.onYearMouseLeave(d,f)}),_i(Pi(a),"handleYearChange",function(d){a.props.onYearChange&&(a.props.onYearChange(d),a.setState({isRenderAriaLiveMessage:!0})),a.props.adjustDateOnChange&&(a.props.onSelect&&a.props.onSelect(d),a.props.setOpen&&a.props.setOpen(!0)),a.props.setPreSelection&&a.props.setPreSelection(d)}),_i(Pi(a),"handleMonthChange",function(d){a.handleCustomMonthChange(d),a.props.adjustDateOnChange&&(a.props.onSelect&&a.props.onSelect(d),a.props.setOpen&&a.props.setOpen(!0)),a.props.setPreSelection&&a.props.setPreSelection(d)}),_i(Pi(a),"handleCustomMonthChange",function(d){a.props.onMonthChange&&(a.props.onMonthChange(d),a.setState({isRenderAriaLiveMessage:!0}))}),_i(Pi(a),"handleMonthYearChange",function(d){a.handleYearChange(d),a.handleMonthChange(d)}),_i(Pi(a),"changeYear",function(d){a.setState(function(f){var i=f.date;return{date:K_(i,d)}},function(){return a.handleYearChange(a.state.date)})}),_i(Pi(a),"changeMonth",function(d){a.setState(function(f){var i=f.date;return{date:_m(i,d)}},function(){return a.handleMonthChange(a.state.date)})}),_i(Pi(a),"changeMonthYear",function(d){a.setState(function(f){var i=f.date;return{date:K_(_m(i,Nf(d)),Fl(d))}},function(){return a.handleMonthYearChange(a.state.date)})}),_i(Pi(a),"header",function(){var d=y_(arguments.length>0&&arguments[0]!==void 0?arguments[0]:a.state.date,a.props.locale,a.props.calendarStartDay),f=[];return a.props.showWeekNumbers&&f.push(B.createElement("div",{key:"W",className:"react-datepicker__day-name"},a.props.weekLabel||"#")),f.concat([0,1,2,3,4,5,6].map(function(i){var S=gw(d,i),E=a.formatWeekday(S,a.props.locale),L=a.props.weekDayClassName?a.props.weekDayClassName(S):void 0;return B.createElement("div",{key:i,className:of("react-datepicker__day-name",L)},E)}))}),_i(Pi(a),"formatWeekday",function(d,f){return a.props.formatWeekDay?function(i,S,E){return S(hu(i,"EEEE",E))}(d,a.props.formatWeekDay,f):a.props.useWeekdaysShort?function(i,S){return hu(i,"EEE",S)}(d,f):function(i,S){return hu(i,"EEEEEE",S)}(d,f)}),_i(Pi(a),"decreaseYear",function(){a.setState(function(d){var f=d.date;return{date:sT(f,a.props.showYearPicker?a.props.yearItemNumber:1)}},function(){return a.handleYearChange(a.state.date)})}),_i(Pi(a),"clearSelectingDate",function(){a.setState({selectingDate:null})}),_i(Pi(a),"renderPreviousButton",function(){if(!a.props.renderCustomHeader){var d;switch(!0){case a.props.showMonthYearPicker:d=L3(a.state.date,a.props);break;case a.props.showYearPicker:d=function(fe){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Se=le.minDate,ke=le.yearItemNumber,Ee=ke===void 0?VS:ke,Ie=k1(ES(sT(fe,Ee)),Ee).endPeriod,He=Se&&Fl(Se);return He&&He>Ie||!1}(a.state.date,a.props);break;default:d=M3(a.state.date,a.props)}if((a.props.forceShowMonthNavigation||a.props.showDisabledMonthNavigation||!d)&&!a.props.showTimeSelectOnly){var f=["react-datepicker__navigation","react-datepicker__navigation--previous"],i=a.decreaseMonth;(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker)&&(i=a.decreaseYear),d&&a.props.showDisabledMonthNavigation&&(f.push("react-datepicker__navigation--previous--disabled"),i=null);var S=a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker,E=a.props,L=E.previousMonthButtonLabel,F=E.previousYearButtonLabel,G=a.props,q=G.previousMonthAriaLabel,Q=q===void 0?typeof L=="string"?L:"Previous Month":q,te=G.previousYearAriaLabel,he=te===void 0?typeof F=="string"?F:"Previous Year":te;return B.createElement("button",{type:"button",className:f.join(" "),onClick:i,onKeyDown:a.props.handleOnKeyDown,"aria-label":S?he:Q},B.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"].join(" ")},S?a.props.previousYearButtonLabel:a.props.previousMonthButtonLabel))}}}),_i(Pi(a),"increaseYear",function(){a.setState(function(d){var f=d.date;return{date:X1(f,a.props.showYearPicker?a.props.yearItemNumber:1)}},function(){return a.handleYearChange(a.state.date)})}),_i(Pi(a),"renderNextButton",function(){if(!a.props.renderCustomHeader){var d;switch(!0){case a.props.showMonthYearPicker:d=D3(a.state.date,a.props);break;case a.props.showYearPicker:d=function(fe){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Se=le.maxDate,ke=le.yearItemNumber,Ee=ke===void 0?VS:ke,Ie=k1(X1(fe,Ee),Ee).startPeriod,He=Se&&Fl(Se);return He&&He<Ie||!1}(a.state.date,a.props);break;default:d=I3(a.state.date,a.props)}if((a.props.forceShowMonthNavigation||a.props.showDisabledMonthNavigation||!d)&&!a.props.showTimeSelectOnly){var f=["react-datepicker__navigation","react-datepicker__navigation--next"];a.props.showTimeSelect&&f.push("react-datepicker__navigation--next--with-time"),a.props.todayButton&&f.push("react-datepicker__navigation--next--with-today-button");var i=a.increaseMonth;(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker)&&(i=a.increaseYear),d&&a.props.showDisabledMonthNavigation&&(f.push("react-datepicker__navigation--next--disabled"),i=null);var S=a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker,E=a.props,L=E.nextMonthButtonLabel,F=E.nextYearButtonLabel,G=a.props,q=G.nextMonthAriaLabel,Q=q===void 0?typeof L=="string"?L:"Next Month":q,te=G.nextYearAriaLabel,he=te===void 0?typeof F=="string"?F:"Next Year":te;return B.createElement("button",{type:"button",className:f.join(" "),onClick:i,onKeyDown:a.props.handleOnKeyDown,"aria-label":S?he:Q},B.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"].join(" ")},S?a.props.nextYearButtonLabel:a.props.nextMonthButtonLabel))}}}),_i(Pi(a),"renderCurrentMonth",function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a.state.date,f=["react-datepicker__current-month"];return a.props.showYearDropdown&&f.push("react-datepicker__current-month--hasYearDropdown"),a.props.showMonthDropdown&&f.push("react-datepicker__current-month--hasMonthDropdown"),a.props.showMonthYearDropdown&&f.push("react-datepicker__current-month--hasMonthYearDropdown"),B.createElement("div",{className:f.join(" ")},hu(d,a.props.dateFormat,a.props.locale))}),_i(Pi(a),"renderYearDropdown",function(){var d=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(a.props.showYearDropdown&&!d)return B.createElement(Qpe,{adjustDateOnChange:a.props.adjustDateOnChange,date:a.state.date,onSelect:a.props.onSelect,setOpen:a.props.setOpen,dropdownMode:a.props.dropdownMode,onChange:a.changeYear,minDate:a.props.minDate,maxDate:a.props.maxDate,year:Fl(a.state.date),scrollableYearDropdown:a.props.scrollableYearDropdown,yearDropdownItemNumber:a.props.yearDropdownItemNumber})}),_i(Pi(a),"renderMonthDropdown",function(){var d=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(a.props.showMonthDropdown&&!d)return B.createElement(efe,{dropdownMode:a.props.dropdownMode,locale:a.props.locale,onChange:a.changeMonth,month:Nf(a.state.date),useShortMonthInDropdown:a.props.useShortMonthInDropdown})}),_i(Pi(a),"renderMonthYearDropdown",function(){var d=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(a.props.showMonthYearDropdown&&!d)return B.createElement(rfe,{dropdownMode:a.props.dropdownMode,locale:a.props.locale,dateFormat:a.props.dateFormat,onChange:a.changeMonthYear,minDate:a.props.minDate,maxDate:a.props.maxDate,date:a.state.date,scrollableMonthYearDropdown:a.props.scrollableMonthYearDropdown})}),_i(Pi(a),"handleTodayButtonClick",function(d){a.props.onSelect(C3(),d),a.props.setPreSelection&&a.props.setPreSelection(C3())}),_i(Pi(a),"renderTodayButton",function(){if(a.props.todayButton&&!a.props.showTimeSelectOnly)return B.createElement("div",{className:"react-datepicker__today-button",onClick:function(d){return a.handleTodayButtonClick(d)}},a.props.todayButton)}),_i(Pi(a),"renderDefaultHeader",function(d){var f=d.monthDate,i=d.i;return B.createElement("div",{className:"react-datepicker__header ".concat(a.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},a.renderCurrentMonth(f),B.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(a.props.dropdownMode),onFocus:a.handleDropdownFocus},a.renderMonthDropdown(i!==0),a.renderMonthYearDropdown(i!==0),a.renderYearDropdown(i!==0)),B.createElement("div",{className:"react-datepicker__day-names"},a.header(f)))}),_i(Pi(a),"renderCustomHeader",function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=d.monthDate,i=d.i;if(a.props.showTimeSelect&&!a.state.monthContainer||a.props.showTimeSelectOnly)return null;var S=M3(a.state.date,a.props),E=I3(a.state.date,a.props),L=L3(a.state.date,a.props),F=D3(a.state.date,a.props),G=!a.props.showMonthYearPicker&&!a.props.showQuarterYearPicker&&!a.props.showYearPicker;return B.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:a.props.onDropdownFocus},a.props.renderCustomHeader(E2(E2({},a.state),{},{customHeaderCount:i,monthDate:f,changeMonth:a.changeMonth,changeYear:a.changeYear,decreaseMonth:a.decreaseMonth,increaseMonth:a.increaseMonth,decreaseYear:a.decreaseYear,increaseYear:a.increaseYear,prevMonthButtonDisabled:S,nextMonthButtonDisabled:E,prevYearButtonDisabled:L,nextYearButtonDisabled:F})),G&&B.createElement("div",{className:"react-datepicker__day-names"},a.header(f)))}),_i(Pi(a),"renderYearHeader",function(){var d=a.state.date,f=a.props,i=f.showYearPicker,S=k1(d,f.yearItemNumber),E=S.startPeriod,L=S.endPeriod;return B.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},i?"".concat(E," - ").concat(L):Fl(d))}),_i(Pi(a),"renderHeader",function(d){switch(!0){case a.props.renderCustomHeader!==void 0:return a.renderCustomHeader(d);case(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker):return a.renderYearHeader(d);default:return a.renderDefaultHeader(d)}}),_i(Pi(a),"renderMonths",function(){var d;if(!a.props.showTimeSelectOnly&&!a.props.showYearPicker){for(var f=[],i=a.props.showPreviousMonths?a.props.monthsShown-1:0,S=Z1(a.state.date,i),E=(d=a.props.monthSelectedIn)!==null&&d!==void 0?d:i,L=0;L<a.props.monthsShown;++L){var F=T0(S,L-E+i),G="month-".concat(L),q=L<a.props.monthsShown-1,Q=L>0;f.push(B.createElement("div",{key:G,ref:function(te){a.monthContainer=te},className:"react-datepicker__month-container"},a.renderHeader({monthDate:F,i:L}),B.createElement(afe,{chooseDayAriaLabelPrefix:a.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:a.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:a.props.weekAriaLabelPrefix,ariaLabelPrefix:a.props.monthAriaLabelPrefix,onChange:a.changeMonthYear,day:F,dayClassName:a.props.dayClassName,calendarStartDay:a.props.calendarStartDay,monthClassName:a.props.monthClassName,onDayClick:a.handleDayClick,handleOnKeyDown:a.props.handleOnDayKeyDown,onDayMouseEnter:a.handleDayMouseEnter,onMouseLeave:a.handleMonthMouseLeave,onWeekSelect:a.props.onWeekSelect,orderInDisplay:L,formatWeekNumber:a.props.formatWeekNumber,locale:a.props.locale,minDate:a.props.minDate,maxDate:a.props.maxDate,excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals,highlightDates:a.props.highlightDates,holidays:a.props.holidays,selectingDate:a.state.selectingDate,includeDates:a.props.includeDates,includeDateIntervals:a.props.includeDateIntervals,inline:a.props.inline,shouldFocusDayInline:a.props.shouldFocusDayInline,fixedHeight:a.props.fixedHeight,filterDate:a.props.filterDate,preSelection:a.props.preSelection,setPreSelection:a.props.setPreSelection,selected:a.props.selected,selectsStart:a.props.selectsStart,selectsEnd:a.props.selectsEnd,selectsRange:a.props.selectsRange,selectsDisabledDaysInRange:a.props.selectsDisabledDaysInRange,showWeekNumbers:a.props.showWeekNumbers,startDate:a.props.startDate,endDate:a.props.endDate,peekNextMonth:a.props.peekNextMonth,setOpen:a.props.setOpen,shouldCloseOnSelect:a.props.shouldCloseOnSelect,renderDayContents:a.props.renderDayContents,renderMonthContent:a.props.renderMonthContent,renderQuarterContent:a.props.renderQuarterContent,renderYearContent:a.props.renderYearContent,disabledKeyboardNavigation:a.props.disabledKeyboardNavigation,showMonthYearPicker:a.props.showMonthYearPicker,showFullMonthYearPicker:a.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:a.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:a.props.showFourColumnMonthYearPicker,showYearPicker:a.props.showYearPicker,showQuarterYearPicker:a.props.showQuarterYearPicker,showWeekPicker:a.props.showWeekPicker,isInputFocused:a.props.isInputFocused,containerRef:a.containerRef,monthShowsDuplicateDaysEnd:q,monthShowsDuplicateDaysStart:Q})))}return f}}),_i(Pi(a),"renderYears",function(){if(!a.props.showTimeSelectOnly)return a.props.showYearPicker?B.createElement("div",{className:"react-datepicker__year--container"},a.renderHeader(),B.createElement(lfe,tw({onDayClick:a.handleDayClick,selectingDate:a.state.selectingDate,clearSelectingDate:a.clearSelectingDate,date:a.state.date},a.props,{onYearMouseEnter:a.handleYearMouseEnter,onYearMouseLeave:a.handleYearMouseLeave}))):void 0}),_i(Pi(a),"renderTimeSection",function(){if(a.props.showTimeSelect&&(a.state.monthContainer||a.props.showTimeSelectOnly))return B.createElement(N8,{selected:a.props.selected,openToDate:a.props.openToDate,onChange:a.props.onTimeChange,timeClassName:a.props.timeClassName,format:a.props.timeFormat,includeTimes:a.props.includeTimes,intervals:a.props.timeIntervals,minTime:a.props.minTime,maxTime:a.props.maxTime,excludeTimes:a.props.excludeTimes,filterTime:a.props.filterTime,timeCaption:a.props.timeCaption,todayButton:a.props.todayButton,showMonthDropdown:a.props.showMonthDropdown,showMonthYearDropdown:a.props.showMonthYearDropdown,showYearDropdown:a.props.showYearDropdown,withPortal:a.props.withPortal,monthRef:a.state.monthContainer,injectTimes:a.props.injectTimes,locale:a.props.locale,handleOnKeyDown:a.props.handleOnKeyDown,showTimeSelectOnly:a.props.showTimeSelectOnly})}),_i(Pi(a),"renderInputTimeSection",function(){var d=new Date(a.props.selected),f=Kv(d)&&a.props.selected?"".concat(O3(d.getHours()),":").concat(O3(d.getMinutes())):"";if(a.props.showTimeInput)return B.createElement(cfe,{date:d,timeString:f,timeInputLabel:a.props.timeInputLabel,onChange:a.props.onTimeChange,customTimeInput:a.props.customTimeInput})}),_i(Pi(a),"renderAriaLiveRegion",function(){var d,f=k1(a.state.date,a.props.yearItemNumber),i=f.startPeriod,S=f.endPeriod;return d=a.props.showYearPicker?"".concat(i," - ").concat(S):a.props.showMonthYearPicker||a.props.showQuarterYearPicker?Fl(a.state.date):"".concat(VD(Nf(a.state.date),a.props.locale)," ").concat(Fl(a.state.date)),B.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},a.state.isRenderAriaLiveMessage&&d)}),_i(Pi(a),"renderChildren",function(){if(a.props.children)return B.createElement("div",{className:"react-datepicker__children-container"},a.props.children)}),a.containerRef=B.createRef(),a.state={date:a.getDateInView(),selectingDate:null,monthContainer:null,isRenderAriaLiveMessage:!1},a}return Mp(n,[{key:"componentDidMount",value:function(){var s=this;this.props.showTimeSelect&&(this.assignMonthContainer=void s.setState({monthContainer:s.monthContainer}))}},{key:"componentDidUpdate",value:function(s){var a=this;if(!this.props.preSelection||Rh(this.props.preSelection,s.preSelection)&&this.props.monthSelectedIn===s.monthSelectedIn)this.props.openToDate&&!Rh(this.props.openToDate,s.openToDate)&&this.setState({date:this.props.openToDate});else{var d=!g0(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return d&&a.handleCustomMonthChange(a.state.date)})}}},{key:"render",value:function(){var s=this.props.container||hfe;return B.createElement("div",{style:{display:"contents"},ref:this.containerRef},B.createElement(s,{className:of("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showPopperArrow:this.props.showPopperArrow,arrowProps:this.props.arrowProps},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren()))}}],[{key:"defaultProps",get:function(){return{onDropdownFocus:function(){},monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",customTimeInput:null,yearItemNumber:VS}}}]),n}(),pfe=function(e){var t=e.icon,n=e.className,s=n===void 0?"":n,a=e.onClick,d="react-datepicker__calendar-icon";return B.isValidElement(t)?B.cloneElement(t,{className:"".concat(t.props.className||""," ").concat(d," ").concat(s),onClick:function(f){typeof t.props.onClick=="function"&&t.props.onClick(f),typeof a=="function"&&a(f)}}):typeof t=="string"?B.createElement("i",{className:"".concat(d," ").concat(t," ").concat(s),"aria-hidden":"true",onClick:a}):B.createElement("svg",{className:"".concat(d," ").concat(s),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:a},B.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},B8=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),(a=t.call(this,s)).el=document.createElement("div"),a}return Mp(n,[{key:"componentDidMount",value:function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.portalRoot.removeChild(this.el)}},{key:"render",value:function(){return M2.createPortal(this.props.children,this.el)}}]),n}(),ffe=function(e){return!e.disabled&&e.tabIndex!==-1},F8=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"getTabChildren",function(){return Array.prototype.slice.call(a.tabLoopRef.current.querySelectorAll("[tabindex], a, button, input, select, textarea"),1,-1).filter(ffe)}),_i(Pi(a),"handleFocusStart",function(){var d=a.getTabChildren();d&&d.length>1&&d[d.length-1].focus()}),_i(Pi(a),"handleFocusEnd",function(){var d=a.getTabChildren();d&&d.length>1&&d[0].focus()}),a.tabLoopRef=B.createRef(),a}return Mp(n,[{key:"render",value:function(){return this.props.enableTabLoop?B.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},B.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:"0",onFocus:this.handleFocusStart}),this.props.children,B.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:"0",onFocus:this.handleFocusEnd})):this.props.children}}],[{key:"defaultProps",get:function(){return{enableTabLoop:!0}}}]),n}(),mfe=function(e){Ip(n,B.Component);var t=Lp(n);function n(){return Ap(this,n),t.apply(this,arguments)}return Mp(n,[{key:"render",value:function(){var s,a=this.props,d=a.className,f=a.wrapperClassName,i=a.hidePopper,S=a.popperComponent,E=a.popperModifiers,L=a.popperPlacement,F=a.popperProps,G=a.targetComponent,q=a.enableTabLoop,Q=a.popperOnKeyDown,te=a.portalId,he=a.portalHost;if(!i){var fe=of("react-datepicker-popper",d);s=B.createElement(zpe,tw({modifiers:E,placement:L},F),function(Se){var ke=Se.ref,Ee=Se.style,Ie=Se.placement,He=Se.arrowProps;return B.createElement(F8,{enableTabLoop:q},B.createElement("div",{ref:ke,style:Ee,className:fe,"data-placement":Ie,onKeyDown:Q},B.cloneElement(S,{arrowProps:He})))})}this.props.popperContainer&&(s=B.createElement(this.props.popperContainer,{},s)),te&&!i&&(s=B.createElement(B8,{portalId:te,portalHost:he},s));var le=of("react-datepicker-wrapper",f);return B.createElement(bde,{className:"react-datepicker-manager"},B.createElement(Wpe,null,function(Se){var ke=Se.ref;return B.createElement("div",{ref:ke,className:le},G)}),s)}}],[{key:"defaultProps",get:function(){return{hidePopper:!0,popperModifiers:[],popperProps:{},popperPlacement:"bottom-start"}}}]),n}(),B3="react-datepicker-ignore-onclickoutside",gfe=Ak(dfe),sM="Date input not valid.",F3=function(e){Ip(n,B.Component);var t=Lp(n);function n(s){var a;return Ap(this,n),_i(Pi(a=t.call(this,s)),"getPreSelection",function(){return a.props.openToDate?a.props.openToDate:a.props.selectsEnd&&a.props.startDate?a.props.startDate:a.props.selectsStart&&a.props.endDate?a.props.endDate:wh()}),_i(Pi(a),"modifyHolidays",function(){var d;return(d=a.props.holidays)===null||d===void 0?void 0:d.reduce(function(f,i){var S=new Date(i.date);return nT(S)?[].concat(cT(f),[E2(E2({},i),{},{date:S})]):f},[])}),_i(Pi(a),"calcInitialState",function(){var d,f=a.getPreSelection(),i=L8(a.props),S=D8(a.props),E=i&&Jv(f,m_(i))?i:S&&cx(f,$I(S))?S:f;return{open:a.props.startOpen||!1,preventFocus:!1,preSelection:(d=a.props.selectsRange?a.props.startDate:a.props.selected)!==null&&d!==void 0?d:E,highlightDates:P3(a.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1}}),_i(Pi(a),"clearPreventFocusTimeout",function(){a.preventFocusTimeout&&clearTimeout(a.preventFocusTimeout)}),_i(Pi(a),"setFocus",function(){a.input&&a.input.focus&&a.input.focus({preventScroll:!0})}),_i(Pi(a),"setBlur",function(){a.input&&a.input.blur&&a.input.blur(),a.cancelFocusInput()}),_i(Pi(a),"setOpen",function(d){var f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];a.setState({open:d,preSelection:d&&a.state.open?a.state.preSelection:a.calcInitialState().preSelection,lastPreSelectChange:oM},function(){d||a.setState(function(i){return{focused:!!f&&i.focused}},function(){!f&&a.setBlur(),a.setState({inputValue:null})})})}),_i(Pi(a),"inputOk",function(){return kk(a.state.preSelection)}),_i(Pi(a),"isCalendarOpen",function(){return a.props.open===void 0?a.state.open&&!a.props.disabled&&!a.props.readOnly:a.props.open}),_i(Pi(a),"handleFocus",function(d){a.state.preventFocus||(a.props.onFocus(d),a.props.preventOpenOnFocus||a.props.readOnly||a.setOpen(!0)),a.setState({focused:!0})}),_i(Pi(a),"sendFocusBackToInput",function(){a.preventFocusTimeout&&a.clearPreventFocusTimeout(),a.setState({preventFocus:!0},function(){a.preventFocusTimeout=setTimeout(function(){a.setFocus(),a.setState({preventFocus:!1})})})}),_i(Pi(a),"cancelFocusInput",function(){clearTimeout(a.inputFocusTimeout),a.inputFocusTimeout=null}),_i(Pi(a),"deferFocusInput",function(){a.cancelFocusInput(),a.inputFocusTimeout=setTimeout(function(){return a.setFocus()},1)}),_i(Pi(a),"handleDropdownFocus",function(){a.cancelFocusInput()}),_i(Pi(a),"handleBlur",function(d){(!a.state.open||a.props.withPortal||a.props.showTimeInput)&&a.props.onBlur(d),a.setState({focused:!1})}),_i(Pi(a),"handleCalendarClickOutside",function(d){a.props.inline||a.setOpen(!1),a.props.onClickOutside(d),a.props.withPortal&&d.preventDefault()}),_i(Pi(a),"handleChange",function(){for(var d=arguments.length,f=new Array(d),i=0;i<d;i++)f[i]=arguments[i];var S=f[0];if(!a.props.onChangeRaw||(a.props.onChangeRaw.apply(Pi(a),f),typeof S.isDefaultPrevented=="function"&&!S.isDefaultPrevented())){a.setState({inputValue:S.target.value,lastPreSelectChange:yfe});var E,L,F,G,q,Q,te,he,fe=(E=S.target.value,L=a.props.dateFormat,F=a.props.locale,G=a.props.strictParsing,q=a.props.minDate,Q=null,te=nx(F)||nx(ab()),he=!0,Array.isArray(L)?(L.forEach(function(le){var Se=KA(E,le,new Date,{locale:te});G&&(he=Kv(Se,q)&&E===hu(Se,le,F)),Kv(Se,q)&&he&&(Q=Se)}),Q):(Q=KA(E,L,new Date,{locale:te}),G?he=Kv(Q)&&E===hu(Q,L,F):Kv(Q)||(L=L.match(Gpe).map(function(le){var Se=le[0];return Se==="p"||Se==="P"?te?(0,Hpe[Se])(le,te.formatLong):Se:le}).join(""),E.length>0&&(Q=KA(E,L.slice(0,E.length),new Date)),Kv(Q)||(Q=new Date(E))),Kv(Q)&&he?Q:null));a.props.showTimeSelectOnly&&a.props.selected&&fe&&!Rh(fe,a.props.selected)&&(fe=jpe(a.props.selected,{hours:f_(fe),minutes:p_(fe),seconds:t3(fe)})),!fe&&S.target.value||(a.props.showWeekPicker&&(fe=y_(fe,a.props.locale,a.props.calendarStartDay)),a.setSelected(fe,S,!0))}}),_i(Pi(a),"handleSelect",function(d,f,i){if(a.props.shouldCloseOnSelect&&!a.props.showTimeSelect&&a.sendFocusBackToInput(),a.props.onChangeRaw&&a.props.onChangeRaw(f),a.props.showWeekPicker&&(d=y_(d,a.props.locale,a.props.calendarStartDay)),a.setSelected(d,f,!1,i),a.props.showDateSelect&&a.setState({isRenderAriaLiveMessage:!0}),!a.props.shouldCloseOnSelect||a.props.showTimeSelect)a.setPreSelection(d);else if(!a.props.inline){a.props.selectsRange||a.setOpen(!1);var S=a.props,E=S.startDate,L=S.endDate;!E||L||Jv(d,E)||a.setOpen(!1)}}),_i(Pi(a),"setSelected",function(d,f,i,S){var E=d;if(a.props.showYearPicker){if(E!==null&&I8(Fl(E),a.props))return}else if(a.props.showMonthYearPicker){if(E!==null&&M8(E,a.props))return}else if(E!==null&&Ik(E,a.props))return;var L=a.props,F=L.onChange,G=L.selectsRange,q=L.startDate,Q=L.endDate;if(!rb(a.props.selected,E)||a.props.allowSameDay||G)if(E!==null&&(!a.props.selected||i&&(a.props.showTimeSelect||a.props.showTimeSelectOnly||a.props.showTimeInput)||(E=S3(E,{hour:f_(a.props.selected),minute:p_(a.props.selected),second:t3(a.props.selected)})),a.props.inline||a.setState({preSelection:E}),a.props.focusSelectedMonth||a.setState({monthSelectedIn:S})),G){var te=q&&!Q,he=q&&Q;!q&&!Q?F([E,null],f):te&&(Jv(E,q)?F([E,null],f):F([q,E],f)),he&&F([E,null],f)}else F(E,f);i||(a.props.onSelect(E,f),a.setState({inputValue:null}))}),_i(Pi(a),"setPreSelection",function(d){var f=a.props.minDate!==void 0,i=a.props.maxDate!==void 0,S=!0;if(d){a.props.showWeekPicker&&(d=y_(d,a.props.locale,a.props.calendarStartDay));var E=m_(d);if(f&&i)S=_E(d,a.props.minDate,a.props.maxDate);else if(f){var L=m_(a.props.minDate);S=cx(d,L)||rb(E,L)}else if(i){var F=$I(a.props.maxDate);S=Jv(d,F)||rb(E,F)}}S&&a.setState({preSelection:d})}),_i(Pi(a),"toggleCalendar",function(){a.setOpen(!a.state.open)}),_i(Pi(a),"handleTimeChange",function(d){var f=a.props.selected?a.props.selected:a.getPreSelection(),i=a.props.selected?d:S3(f,{hour:f_(d),minute:p_(d)});a.setState({preSelection:i}),a.props.onChange(i),a.props.shouldCloseOnSelect&&(a.sendFocusBackToInput(),a.setOpen(!1)),a.props.showTimeInput&&a.setOpen(!0),(a.props.showTimeSelectOnly||a.props.showTimeSelect)&&a.setState({isRenderAriaLiveMessage:!0}),a.setState({inputValue:null})}),_i(Pi(a),"onInputClick",function(){a.props.disabled||a.props.readOnly||a.setOpen(!0),a.props.onInputClick()}),_i(Pi(a),"onInputKeyDown",function(d){a.props.onKeyDown(d);var f=d.key;if(a.state.open||a.props.inline||a.props.preventOpenOnFocus){if(a.state.open){if(f==="ArrowDown"||f==="ArrowUp"){d.preventDefault();var i=a.props.showWeekPicker&&a.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',S=a.calendar.componentNode&&a.calendar.componentNode.querySelector(i);return void(S&&S.focus({preventScroll:!0}))}var E=wh(a.state.preSelection);f==="Enter"?(d.preventDefault(),a.inputOk()&&a.state.lastPreSelectChange===oM?(a.handleSelect(E,d),!a.props.shouldCloseOnSelect&&a.setPreSelection(E)):a.setOpen(!1)):f==="Escape"?(d.preventDefault(),a.sendFocusBackToInput(),a.setOpen(!1)):f==="Tab"&&a.setOpen(!1),a.inputOk()||a.props.onInputError({code:1,msg:sM})}}else f!=="ArrowDown"&&f!=="ArrowUp"&&f!=="Enter"||a.onInputClick()}),_i(Pi(a),"onPortalKeyDown",function(d){d.key==="Escape"&&(d.preventDefault(),a.setState({preventFocus:!0},function(){a.setOpen(!1),setTimeout(function(){a.setFocus(),a.setState({preventFocus:!1})})}))}),_i(Pi(a),"onDayKeyDown",function(d){a.props.onKeyDown(d);var f=d.key,i=wh(a.state.preSelection);if(f==="Enter")d.preventDefault(),a.handleSelect(i,d),!a.props.shouldCloseOnSelect&&a.setPreSelection(i);else if(f==="Escape")d.preventDefault(),a.setOpen(!1),a.inputOk()||a.props.onInputError({code:1,msg:sM});else if(!a.props.disabledKeyboardNavigation){var S;switch(f){case"ArrowLeft":S=a.props.showWeekPicker?e3(i,1):Bhe(i,1);break;case"ArrowRight":S=a.props.showWeekPicker?v2(i,1):gw(i,1);break;case"ArrowUp":S=e3(i,1);break;case"ArrowDown":S=v2(i,1);break;case"PageUp":S=Z1(i,1);break;case"PageDown":S=T0(i,1);break;case"Home":S=sT(i,1);break;case"End":S=X1(i,1);break;default:S=null}if(!S)return void(a.props.onInputError&&a.props.onInputError({code:1,msg:sM}));if(d.preventDefault(),a.setState({lastPreSelectChange:oM}),a.props.adjustDateOnChange&&a.setSelected(S),a.setPreSelection(S),a.props.inline){var E=Nf(i),L=Nf(S),F=Fl(i),G=Fl(S);E!==L||F!==G?a.setState({shouldFocusDayInline:!0}):a.setState({shouldFocusDayInline:!1})}}}),_i(Pi(a),"onPopperKeyDown",function(d){d.key==="Escape"&&(d.preventDefault(),a.sendFocusBackToInput())}),_i(Pi(a),"onClearClick",function(d){d&&d.preventDefault&&d.preventDefault(),a.sendFocusBackToInput(),a.props.selectsRange?a.props.onChange([null,null],d):a.props.onChange(null,d),a.setState({inputValue:null})}),_i(Pi(a),"clear",function(){a.onClearClick()}),_i(Pi(a),"onScroll",function(d){typeof a.props.closeOnScroll=="boolean"&&a.props.closeOnScroll?d.target!==document&&d.target!==document.documentElement&&d.target!==document.body||a.setOpen(!1):typeof a.props.closeOnScroll=="function"&&a.props.closeOnScroll(d)&&a.setOpen(!1)}),_i(Pi(a),"renderCalendar",function(){return a.props.inline||a.isCalendarOpen()?B.createElement(gfe,{ref:function(d){a.calendar=d},locale:a.props.locale,calendarStartDay:a.props.calendarStartDay,chooseDayAriaLabelPrefix:a.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:a.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:a.props.weekAriaLabelPrefix,monthAriaLabelPrefix:a.props.monthAriaLabelPrefix,adjustDateOnChange:a.props.adjustDateOnChange,setOpen:a.setOpen,shouldCloseOnSelect:a.props.shouldCloseOnSelect,dateFormat:a.props.dateFormatCalendar,useWeekdaysShort:a.props.useWeekdaysShort,formatWeekDay:a.props.formatWeekDay,dropdownMode:a.props.dropdownMode,selected:a.props.selected,preSelection:a.state.preSelection,onSelect:a.handleSelect,onWeekSelect:a.props.onWeekSelect,openToDate:a.props.openToDate,minDate:a.props.minDate,maxDate:a.props.maxDate,selectsStart:a.props.selectsStart,selectsEnd:a.props.selectsEnd,selectsRange:a.props.selectsRange,startDate:a.props.startDate,endDate:a.props.endDate,excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals,filterDate:a.props.filterDate,onClickOutside:a.handleCalendarClickOutside,formatWeekNumber:a.props.formatWeekNumber,highlightDates:a.state.highlightDates,holidays:Ype(a.modifyHolidays()),includeDates:a.props.includeDates,includeDateIntervals:a.props.includeDateIntervals,includeTimes:a.props.includeTimes,injectTimes:a.props.injectTimes,inline:a.props.inline,shouldFocusDayInline:a.state.shouldFocusDayInline,peekNextMonth:a.props.peekNextMonth,showMonthDropdown:a.props.showMonthDropdown,showPreviousMonths:a.props.showPreviousMonths,useShortMonthInDropdown:a.props.useShortMonthInDropdown,showMonthYearDropdown:a.props.showMonthYearDropdown,showWeekNumbers:a.props.showWeekNumbers,showYearDropdown:a.props.showYearDropdown,withPortal:a.props.withPortal,forceShowMonthNavigation:a.props.forceShowMonthNavigation,showDisabledMonthNavigation:a.props.showDisabledMonthNavigation,scrollableYearDropdown:a.props.scrollableYearDropdown,scrollableMonthYearDropdown:a.props.scrollableMonthYearDropdown,todayButton:a.props.todayButton,weekLabel:a.props.weekLabel,outsideClickIgnoreClass:B3,fixedHeight:a.props.fixedHeight,monthsShown:a.props.monthsShown,monthSelectedIn:a.state.monthSelectedIn,onDropdownFocus:a.handleDropdownFocus,onMonthChange:a.props.onMonthChange,onYearChange:a.props.onYearChange,dayClassName:a.props.dayClassName,weekDayClassName:a.props.weekDayClassName,monthClassName:a.props.monthClassName,timeClassName:a.props.timeClassName,showDateSelect:a.props.showDateSelect,showTimeSelect:a.props.showTimeSelect,showTimeSelectOnly:a.props.showTimeSelectOnly,onTimeChange:a.handleTimeChange,timeFormat:a.props.timeFormat,timeIntervals:a.props.timeIntervals,minTime:a.props.minTime,maxTime:a.props.maxTime,excludeTimes:a.props.excludeTimes,filterTime:a.props.filterTime,timeCaption:a.props.timeCaption,className:a.props.calendarClassName,container:a.props.calendarContainer,yearItemNumber:a.props.yearItemNumber,yearDropdownItemNumber:a.props.yearDropdownItemNumber,previousMonthAriaLabel:a.props.previousMonthAriaLabel,previousMonthButtonLabel:a.props.previousMonthButtonLabel,nextMonthAriaLabel:a.props.nextMonthAriaLabel,nextMonthButtonLabel:a.props.nextMonthButtonLabel,previousYearAriaLabel:a.props.previousYearAriaLabel,previousYearButtonLabel:a.props.previousYearButtonLabel,nextYearAriaLabel:a.props.nextYearAriaLabel,nextYearButtonLabel:a.props.nextYearButtonLabel,timeInputLabel:a.props.timeInputLabel,disabledKeyboardNavigation:a.props.disabledKeyboardNavigation,renderCustomHeader:a.props.renderCustomHeader,popperProps:a.props.popperProps,renderDayContents:a.props.renderDayContents,renderMonthContent:a.props.renderMonthContent,renderQuarterContent:a.props.renderQuarterContent,renderYearContent:a.props.renderYearContent,onDayMouseEnter:a.props.onDayMouseEnter,onMonthMouseLeave:a.props.onMonthMouseLeave,onYearMouseEnter:a.props.onYearMouseEnter,onYearMouseLeave:a.props.onYearMouseLeave,selectsDisabledDaysInRange:a.props.selectsDisabledDaysInRange,showTimeInput:a.props.showTimeInput,showMonthYearPicker:a.props.showMonthYearPicker,showFullMonthYearPicker:a.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:a.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:a.props.showFourColumnMonthYearPicker,showYearPicker:a.props.showYearPicker,showQuarterYearPicker:a.props.showQuarterYearPicker,showWeekPicker:a.props.showWeekPicker,showPopperArrow:a.props.showPopperArrow,excludeScrollbar:a.props.excludeScrollbar,handleOnKeyDown:a.props.onKeyDown,handleOnDayKeyDown:a.onDayKeyDown,isInputFocused:a.state.focused,customTimeInput:a.props.customTimeInput,setPreSelection:a.setPreSelection},a.props.children):null}),_i(Pi(a),"renderAriaLiveRegion",function(){var d,f=a.props,i=f.dateFormat,S=f.locale,E=a.props.showTimeInput||a.props.showTimeSelect?"PPPPp":"PPPP";return d=a.props.selectsRange?"Selected start date: ".concat(n_(a.props.startDate,{dateFormat:E,locale:S}),". ").concat(a.props.endDate?"End date: "+n_(a.props.endDate,{dateFormat:E,locale:S}):""):a.props.showTimeSelectOnly?"Selected time: ".concat(n_(a.props.selected,{dateFormat:i,locale:S})):a.props.showYearPicker?"Selected year: ".concat(n_(a.props.selected,{dateFormat:"yyyy",locale:S})):a.props.showMonthYearPicker?"Selected month: ".concat(n_(a.props.selected,{dateFormat:"MMMM yyyy",locale:S})):a.props.showQuarterYearPicker?"Selected quarter: ".concat(n_(a.props.selected,{dateFormat:"yyyy, QQQ",locale:S})):"Selected date: ".concat(n_(a.props.selected,{dateFormat:E,locale:S})),B.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},d)}),_i(Pi(a),"renderDateInput",function(){var d,f=of(a.props.className,_i({},B3,a.state.open)),i=a.props.customInput||B.createElement("input",{type:"text"}),S=a.props.customInputRef||"ref",E=typeof a.props.value=="string"?a.props.value:typeof a.state.inputValue=="string"?a.state.inputValue:a.props.selectsRange?function(L,F,G){if(!L)return"";var q=n_(L,G),Q=F?n_(F,G):"";return"".concat(q," - ").concat(Q)}(a.props.startDate,a.props.endDate,a.props):n_(a.props.selected,a.props);return B.cloneElement(i,(_i(_i(_i(_i(_i(_i(_i(_i(_i(_i(d={},S,function(L){a.input=L}),"value",E),"onBlur",a.handleBlur),"onChange",a.handleChange),"onClick",a.onInputClick),"onFocus",a.handleFocus),"onKeyDown",a.onInputKeyDown),"id",a.props.id),"name",a.props.name),"form",a.props.form),_i(_i(_i(_i(_i(_i(_i(_i(_i(_i(d,"autoFocus",a.props.autoFocus),"placeholder",a.props.placeholderText),"disabled",a.props.disabled),"autoComplete",a.props.autoComplete),"className",of(i.props.className,f)),"title",a.props.title),"readOnly",a.props.readOnly),"required",a.props.required),"tabIndex",a.props.tabIndex),"aria-describedby",a.props.ariaDescribedBy),_i(_i(_i(d,"aria-invalid",a.props.ariaInvalid),"aria-labelledby",a.props.ariaLabelledBy),"aria-required",a.props.ariaRequired)))}),_i(Pi(a),"renderClearButton",function(){var d=a.props,f=d.isClearable,i=d.disabled,S=d.selected,E=d.startDate,L=d.endDate,F=d.clearButtonTitle,G=d.clearButtonClassName,q=G===void 0?"":G,Q=d.ariaLabelClose,te=Q===void 0?"Close":Q;return!f||S==null&&E==null&&L==null?null:B.createElement("button",{type:"button",className:of("react-datepicker__close-icon",q,{"react-datepicker__close-icon--disabled":i}),disabled:i,"aria-label":te,onClick:a.onClearClick,title:F,tabIndex:-1})}),a.state=a.calcInitialState(),a.preventFocusTimeout=null,a}return Mp(n,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.onScroll,!0)}},{key:"componentDidUpdate",value:function(s,a){var d,f;s.inline&&(d=s.selected,f=this.props.selected,d&&f?Nf(d)!==Nf(f)||Fl(d)!==Fl(f):d!==f)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&s.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),s.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:P3(this.props.highlightDates)}),a.focused||rb(s.selected,this.props.selected)||this.setState({inputValue:null}),a.open!==this.state.open&&(a.open===!1&&this.state.open===!0&&this.props.onCalendarOpen(),a.open===!0&&this.state.open===!1&&this.props.onCalendarClose())}},{key:"componentWillUnmount",value:function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0)}},{key:"renderInputContainer",value:function(){var s=this.props,a=s.showIcon,d=s.icon,f=s.calendarIconClassname,i=s.toggleCalendarOnIconClick,S=this.state.open;return B.createElement("div",{className:"react-datepicker__input-container".concat(a?" react-datepicker__view-calendar-icon":"")},a&&B.createElement(pfe,tw({icon:d,className:"".concat(f," ").concat(S&&"react-datepicker-ignore-onclickoutside")},i?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())}},{key:"render",value:function(){var s=this.renderCalendar();if(this.props.inline)return s;if(this.props.withPortal){var a=this.state.open?B.createElement(F8,{enableTabLoop:this.props.enableTabLoop},B.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},s)):null;return this.state.open&&this.props.portalId&&(a=B.createElement(B8,{portalId:this.props.portalId,portalHost:this.props.portalHost},a)),B.createElement("div",null,this.renderInputContainer(),a)}return B.createElement(mfe,{className:this.props.popperClassName,wrapperClassName:this.props.wrapperClassName,hidePopper:!this.isCalendarOpen(),portalId:this.props.portalId,portalHost:this.props.portalHost,popperModifiers:this.props.popperModifiers,targetComponent:this.renderInputContainer(),popperContainer:this.props.popperContainer,popperComponent:s,popperPlacement:this.props.popperPlacement,popperProps:this.props.popperProps,popperOnKeyDown:this.onPopperKeyDown,enableTabLoop:this.props.enableTabLoop})}}],[{key:"defaultProps",get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",onChange:function(){},disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",onFocus:function(){},onBlur:function(){},onKeyDown:function(){},onInputClick:function(){},onSelect:function(){},onClickOutside:function(){},onMonthChange:function(){},onCalendarOpen:function(){},onCalendarClose:function(){},preventOpenOnFocus:!1,onYearChange:function(){},onInputError:function(){},monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:VS,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1}}}]),n}(),yfe="input",oM="navigate";const _fe=({filterData:e,onChange:t,selectedValues:n={},resetFilter:s,disableFutureDates:a=!1})=>{const d=new Date,f=(e==null?void 0:e.elementLabel)??"Start-End Date",i="From Date",S="To Date",E=(e==null?void 0:e.fieldData)??{};e==null||e.isSetMinDate;const L=(E==null?void 0:E.from_date_key)||"from_date",F=(E==null?void 0:E.to_date_key)||"to_date",[G,q]=It(!0),[Q,te]=It({fromDate:n[L]?new Date(n[L]):null,toDate:n[F]?new Date(n[F]):null});Ar(()=>{s&&te({fromDate:null,toDate:null})},[s]);const he=Se=>{const ke={fromDate:Se,toDate:Q.toDate};te(ke),t({[L]:Se,[F]:ke.toDate})},fe=Se=>{const ke={...Q,toDate:Se};te(ke),t({[L]:ke.fromDate,[F]:Se})},le=()=>{q(!G)};return B.createElement(B.Fragment,null,B.createElement("div",{class:"input-group-header mt-2",onClick:()=>le()},B.createElement("div",null,f),G?B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_right"):B.createElement("span",{className:"material-symbols-outlined constl-icon"},"keyboard_arrow_up")),G&&B.createElement("div",{className:"row"},B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("label",null,i),B.createElement(F3,{selected:Q.fromDate,onChange:he,placeholderText:"Select From Date",dateFormat:"yyyy-MM-dd",className:"custom-datepicker",maxDate:a?d:null}))),B.createElement("div",{className:"col-12 mb-15"},B.createElement("div",{className:"form-group"},B.createElement("label",null,S),B.createElement(F3,{selected:Q.toDate,onChange:fe,placeholderText:"Select To Date",dateFormat:"yyyy-MM-dd",className:"custom-datepicker",minDate:Q.fromDate,disabled:!Q.fromDate,maxDate:a?d:null})))))},vfe=({tab:e,isOpen:t,toggleSidebar:n,onFilterApply:s,filtersData:a,entityTypeId:d,disableFutureDates:f=!1,moduleName:i,isDashboardSMFilter:S,customerAccountNo:E})=>{console.debug("krypton-entity-filter-cx -> Filter -> filtersData : ",a);const[L,F]=It([]),[G,q]=It(""),[Q,te]=It(!1),he=(Se,ke)=>{te(!1),console.debug("krypton-entity-filter-cx -> Filter -> handleChange -> filterId -> ",Se.filterId),console.debug("krypton-entity-filter-cx -> Filter -> handleChange -> elementType -> ",Se.elementType),console.debug("krypton-entity-filter-cx -> Filter -> handleChange -> lfrData -> ",Se.lfrData),console.debug("krypton-entity-filter-cx -> Filter -> handleChange -> logicalOperator -> ",Se.lfrData.logicalOperator),console.debug("krypton-entity-filter-cx -> Filter -> handleChange -> values -> ",ke),console.debug("filterParams:",L),F(Ee=>{let Ie=[...Ee];return Ie=Ie.filter(Ye=>Ye.fId!==Se.filterId),ke==null||ke===""||_.isArray(ke)&&ke.length===0||typeof ke=="object"&&Se.elementType==="dateRangePicker"&&(!ke.from_date||!ke.to_date)?(console.debug("updated filterParams -> ",Ie),Ie):(Se.elementType==="dateRangePicker"&&ke.from_date&&ke.to_date&&(ke={...ke,formatted_from_date:S1(ke.from_date,"yyyy-mm-dd")+"T00:00:00Z",formatted_to_date:S1(ke.to_date,"yyyy-mm-dd")+"T23:59:59Z"}),Ie.push({fId:Se.filterId,elType:Se.elementType,lfrData:Se.lfrData,values:ke}),console.debug("updated filterParams -> ",Ie),Ie)})};Ar(()=>{const Se=setTimeout(()=>{s(G!=""?G:"")},500);return()=>{clearTimeout(Se)}},[G]);const fe=Se=>{if(L.length>0){let ke=JSON.stringify(L),Ee=btoa(ke);q(Ee)}else q("");n()},le=()=>{te(!0),q(""),console.debug("inside handleReset"),F([]),n(),document.querySelectorAll(".sidebar .custom-select").forEach(ke=>{ke.value=""}),console.debug("setFilterParams:",L)};return Ar(()=>{console.debug("tab changed in filter component",e),e?(q(""),F([]),document.querySelectorAll(".sidebar .custom-select").forEach(ke=>{ke.value=""}),te(!0)):te(!1)},[e]),B.createElement(B.Fragment,null,B.createElement("div",{className:`sidebar ${t?"show":""}`},B.createElement("a",{href:"javascript:void(0)",className:"closebtn",onClick:n},B.createElement("span",{className:"material-symbols-outlined constl-icon"},"close")),B.createElement("div",{className:"sidebar-wrapper"},B.createElement("div",{className:"sidebar-header"},B.createElement("h5",null,"Filter Options")),B.createElement("div",{className:"sidebar-content"},B.createElement("div",{className:"sidebar-filter-reset"},B.createElement("div",{className:"title"},"Filters"),B.createElement("a",{href:"javascript:void(0)",onClick:le},"Clear all")),a.length>0&&a.map((Se,ke)=>Se.elementType==="staticDropdown"?B.createElement(Tce,{key:ke,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),moduleName:i}):Se.elementType==="dynamicDropdown"?(console.debug("moduleName in Filter module --------  ",i),B.createElement(Cce,{tab:e,key:ke,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),dropdownReset:"0",moduleName:i})):Se.elementType==="select2Dropdown"?B.createElement(Ece,{key:ke,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),dropdownReset:"0",moduleName:i}):Se.elementType==="select2DynamicDropdown"?B.createElement(kce,{key:E?`${Se.filterId}-${E}`:ke,tab:e,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),dropdownReset:"0",resetFilter:Q,entityTypeId:d,moduleName:i,isDashboardSMFilter:S,customerAccountNo:E}):Se.elementType==="dynamicCheckbox"?B.createElement(Ace,{key:ke,entityTypeId:d,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),dropdownReset:"0",resetFilter:Q}):Se.elementType==="clubbeddynamicCheckbox"?B.createElement(Mce,{key:ke,entityTypeId:d,filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),dropdownReset:"0",resetFilter:Q}):Se.elementType==="dateRangePicker"?B.createElement(_fe,{filterData:Se,selectedValue:L[Se.lfrData.key],onChange:Ee=>he(Se,Ee),resetFilter:Q,disableFutureDates:f}):null)),B.createElement("div",{className:"sidebar-footer"},B.createElement("div",{className:"text-right"},B.createElement("button",{className:"button button-icon-text",onClick:Se=>fe()},"Apply"))))))},xfe=()=>{const[e,t]=It(null),[n,s]=It(!1),[a,d]=It([]),[f,i]=It(!1),[S,E]=It("uptime");It(!1);const[L,F]=It([]),[G,q]=It("Yearly"),[Q,te]=It(Dr().months[new Date().getMonth()]),[he,fe]=It("Q1"),[le,Se]=It(Dr().currentYear.toString()),[ke,Ee]=It(0),[Ie,He]=It([]),[Ye,lt]=It(Dr().currentYear.toString()),[Pt,At]=It([]),[ht,Ot]=It("Yearly"),[Ae,mt]=It(Dr().months[new Date().getMonth()]),[bt,Dt]=It("Q1"),[Je,dt]=It(Dr().currentYear.toString()),[ui,Vt]=It("0 Hours"),[ei,ur]=It("0"),[Zt,Kt]=It([]),[Ui,rr]=It(Dr().currentYear.toString()),[gi,Oi]=It([]),[cr,ji]=It("Yearly"),[nn,pr]=It(Dr().months[new Date().getMonth()]),[Ue,ni]=It("Q1"),[fi,Lt]=It(Dr().currentYear.toString()),[pt,Nt]=It("0 Hours"),[Si,pi]=It("0"),[St,Ht]=It([]),[nr,tr]=It(Dr().currentYear.toString()),[kr,Mr]=It([]),[Cr,Tn]=It("Yearly"),[gs,wn]=It(Dr().months[new Date().getMonth()]),[bs,qn]=It("Q1"),[Ls,ma]=It(Dr().currentYear.toString()),[Ln,qo]=It(0),[zn,za]=It([]),[$o,Aa]=It(Dr().currentYear.toString()),[ja,Yn]=It([]),[hl,fr]=It("Yearly"),[tc,Sh]=It(Dr().months[new Date().getMonth()]),[bl,Un]=It("Q1"),[vi,Ge]=It(Dr().currentYear.toString()),[Fe,rt]=It(0),[xt,ft]=It([]),[Jt,xi]=It([]),[ti,ai]=It(0),[Yi,Fi]=It(Dr().currentYear.toString()),[Pr,ln]=It(null),[Qr,Or]=It(!0),[ii,xr]=It(null),[Xr,tn]=It([]),[Jn,ds]=It({}),[mi,_r]=It({}),[zi,zr]=It({}),[Yr,yr]=It({}),[Hr,rn]=It({}),[is,Ps]=It({}),[vs,ra]=It({}),[Po,Sc]=It({}),[Xl,lh]=It({}),[ps,la]=It({}),[$u,_u]=It({}),[ch,Lc]=It({}),[zc,Kh]=It({}),[ul,Uc]=It({}),[du,Yc]=It({}),[Ds,Ys]=It({}),[Cs,to]=It(1),[Xs,Bs]=It(10),[ba,ca]=It(!0),[fh,Il]=It(null),[Dp,Th]=It(!0),[Vs,pu]=It(1),[vu,Qh]=It(0),[Vf,Tc]=It(0),[hp,mh]=It(null),[qa,Ka]=It(!1),[zd,Vu]=It(!1),[Nh,Ud]=It(null),[up,hc]=It(!1),[fu,Ha]=It(!1),[Ll,vd]=It([]),[Bh,Wu]=It(!1),[Xc,Ma]=It(!1),[Cc,Fh]=It(!1),[ao,Dl]=It(!1),[xu,af]=It(!1),[kn,lf]=It(null),[ic,wl]=It([]),[Qa,Zl]=It(""),[$c,vn]=It(""),[os,Zs]=It([]),[zl,bu]=It(null),[Ks,xd]=It({}),[ju,Hu]=It(""),[Sl,Ja]=It({fileByteArr:"",pdfTriggerDownload:!1,excelTriggerDownload:!1,exportMessage:"",exportDisable:!1}),[Gu,zh]=It(""),[Ch,hh]=It(""),[vt,Yt]=It([]),[Di,yi]=It(!1),[bi,Li]=It(!1),[Tr,Bi]=It(!1),[Gt,qr]=It(""),[sr,Qi]=It(""),[sn,hi]=It(""),[Pn,as]=It(""),[Yo,Qn]=It(),[ro,Ao]=It(!1),[el,Mo]=It({}),[Fs,Jo]=It({viewServiceDetail:{key:"ViewServiceDetail",hasPermission:!0},viewServiceDetailOverviewWidget:{key:"ViewServiceDetailOverviewWidget",hasPermission:!0},viewMap:{key:"ViewMap",hasPermission:!0},viewContact:{key:"ViewKamCsmDetails",hasPermission:!0},viewServiceDetailScheduledMaintenance:{key:"ViewServiceDetailScheduledMaintenance",hasPermission:!0},viewServiceDetailDocuments:{key:"ViewServiceDetailDocuments",hasPermission:!0},addCreateTicket:{key:"AddCreateTicket",hasPermission:!0},viewSlaUptime:{key:"ViewSlaUptime",hasPermission:!0},viewSlaTtr:{key:"ViewSlaTtr",hasPermission:!0},viewSlaMttr:{key:"ViewSlaMttr",hasPermission:!0},viewServiceDetailToplogy:{key:"ViewServiceDetailToplogy",hasPermission:!0},viewServiceRelatedTickets:{key:"ViewServiceRelatedTickets",hasPermission:!0},viewServiceDetailTestReport:{key:"ViewServiceDetailTestReport",hasPermission:!0},viewServiceDetailSlaWidget:{key:"ViewServiceDetailSlaWidget",hasPermission:!0},viewSlaFiberCut:{key:"ViewSlaFiberCut",hasPermission:!0},viewServiceEscalationMatrix:{key:"ViewServiceEscalationMatrix",hasPermission:!0},viewSlaLatency:{key:"ViewSlaLatency",hasPermission:!0},downloadServiceDetailDocuments:{key:"DownloadServiceDetailDocuments",hasPermission:!0},downloadServiceDetailTestReport:{key:"DownloadServiceDetailTestReport",hasPermission:!0},downloadScheduledMaintenance:{key:"DownloadScheduledMaintenance",hasPermission:!0},exportScheduledMaintenance:{key:"DownloadScheduledMaintenance",hasPermission:!0},viewScheduledMaintenanceList:{key:"ViewScheduledMaintenance",hasPermission:!0}});Ar(()=>{var Fn,fs;console.debug("Window: ",window),yi((Fn=window.validateEditRquestAccessObj)==null?void 0:Fn.hasImpersonated),Li((fs=window.validateEditRquestAccessObj)==null?void 0:fs.hasImpersonationEditAccess)},[window.validateEditRquestAccessObj]);const ea=Fn=>new URLSearchParams(window.location.search).get(Fn),So=ea("id")||ea("entityDetailId")||null;let Ua=ea("productName");Ua=="Dark Fiber"?Ua="darkFiber":Ua=="Private Line"&&(Ua="privateLine");const[Ul,$l]=It(()=>Ua==="darkFiber"||Ua==="privateLine"?"relatedTicket":""),$a=Fn=>{console.debug("Export type",Fn),zh(Fn)},Vl=Fn=>{Hu(Fn)};Ar(()=>{(Sl.pdfTriggerDownload||Sl.excelTriggerDownload)&&(Ja({fileByteArr:"",excelTriggerDownload:!1,pdfTriggerDownload:!1,exportMessage:""}),zh(""),hh(""))},[Sl.pdfTriggerDownload,Sl.excelTriggerDownload]);const dl=Fn=>{wl(Fn)};Ar(()=>{console.log("maintenanceList::",vt)},[vt]),Ar(()=>{(mi!==""||mi!==null)&&Qn((mi==null?void 0:mi.filtersData)??[])},[mi]),Ar(()=>{So&&vs&&(ca(!0),(async()=>{var fs;if(vs!==""||vs!==null){let In=vs.entityData;const Ms=vs.entityData.clubStatuses;if(Tc(Ms),In!=null){let ho=In.restBuilderApiURL,na=In.propsData,ta=na.filters;ta&&ta.fields&&(_.each(ta.fields,mr=>{mr.key=="externalRefEntityId"&&(mr.value=`'${So}'`)}),na.filters=ta),Cs>0&&(na.page=Cs),Xs>0&&(na.pageSize=Xs);let Io=JSON.stringify(na),To=btoa(Io);const fl=Liferay.ThemeDisplay.getSiteGroupId(),rl=`${ho}?propsData=${To}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${fl}`;try{const mr=await Go.get(rl);if(console.debug("related ticket response ------ ",mr),mr&&((fs=mr==null?void 0:mr.data)!=null&&fs.items)){const Tl=mr==null?void 0:mr.data;Il(mr),to((Tl==null?void 0:Tl.page)||1),Bs((Tl==null?void 0:Tl.pageSize)||10),pu((Tl==null?void 0:Tl.lastPage)||1),Qh(Tl==null?void 0:Tl.totalCount)}else Il([]),to(1),Bs(10),pu(1),Qh(0)}catch(mr){Th("Unable to fetch open tickets."),console.error("Error fetching all tickets:",mr)}finally{ca(!1)}}}})())},[So,vs,Cs,Xs]);const uh=Fn=>{Zs(Fn)},rc=()=>{Liferay.on("allPortletsReady",function(){let Fn=document.getElementsByTagName("krypton-service-details-cx");if(Fn&&Fn.length>0){let fs=Fn[0].getAttribute("data-networkConfig");if(fs!=null&&fs!=null){let ga=atob(fs);Mo(JSON.parse(ga))}let In=Fn[0].getAttribute("data-scheduledMaintenanceConfig");if(In!=null&&In!=null){let ga=atob(In);_r(JSON.parse(ga))}let Ms=Fn[0].getAttribute("data-serviceImpactedTicketConfig");if(Ms!=null&&Ms!=null){let ga=atob(Ms);la(JSON.parse(ga))}let ho=Fn[0].getAttribute("data-constlteamconfig");if(ho!=null&&ho!=null){let ga=atob(ho);zr(JSON.parse(ga))}let na=Fn[0].getAttribute("data-escmatrixconfig");if(na!=null&&na!=null){let ga=atob(na);yr(JSON.parse(ga))}let ta=Fn[0].getAttribute("data-escmatrixSegmentconfig");if(ta!=null&&ta!=null){let ga=atob(ta);rn(JSON.parse(ga))}let Oo=Fn[0].getAttribute("data-escmatrixLevelconfig");if(Oo!=null&&Oo!=null){let ga=atob(Oo);Ps(JSON.parse(ga))}let Io=Fn[0].getAttribute("data-ticketsByServiceIdConfig");if(Io!=null&&Io!=null){let ga=atob(Io);ra(JSON.parse(ga))}let To=Fn[0].getAttribute("data-servicesDataConfig");if(To!=null&&To!=null){let ga=atob(To);lh(JSON.parse(ga))}let fl=Fn[0].getAttribute("data-associatedTicketConfig");if(fl!=null&&fl!=null){let ga=atob(fl);Sc(JSON.parse(ga))}let rl=Fn[0].getAttribute("data-orderDetailConfig");if(rl!=null&&rl!=null){let ga=atob(rl);ds(JSON.parse(ga))}let mr=Fn[0].getAttribute("data-ticketDetailEscalationConfig");if(mr!=null&&mr!=null){let ga=atob(mr);_u(JSON.parse(ga))}let Tl=Fn[0].getAttribute("data-ticketDetailSupportTeamConfig");if(Tl!=null&&Tl!=null){let ga=atob(Tl);Lc(JSON.parse(ga))}let Vo=Fn[0].getAttribute("data-ticketDetailObjKeysWidgetsConfig");if(Vo!=null&&Vo!=null){let ga=atob(Vo);Kh(JSON.parse(ga))}let Kc=Fn[0].getAttribute("data-ticketDetailRelatedTicketWidgetConfig");if(Kc!=null&&Kc!=null){let ga=atob(Kc);Uc(JSON.parse(ga))}let uc=Fn[0].getAttribute("data-mttrTicketsWidgetConfig");if(uc){let ga=atob(uc);Yc(JSON.parse(ga))}let dc=Fn[0].getAttribute("data-fetchContacts");if(dc){let ga=atob(dc);Ys(JSON.parse(ga))}let Qc=Fn[0].getAttribute("data-fetchCustomer");if(Qc){let ga=atob(Qc);xd(JSON.parse(ga))}let bd=Fn[0].getAttribute("data-fetchLastSyncTime");if(bd){let ga=atob(bd);hi(JSON.parse(ga)),console.log("lastSyncReferenceEncStr",sn)}let Jc=Liferay.ThemeDisplay.getUserId();const ws=Fn[0].getAttribute("data-createticketurl");let qu=Liferay.ThemeDisplay.getLayoutRelativeURL(),Pp=new URLSearchParams(qu.split("?")[1]||"").get("doAsUserId")||"";ln(Pp?`${ws}?redirectModule=serviceDetail&serviceId=${So}&productName=${Ua}&doAsUserId=${Jc}`:`${ws}?redirectModule=serviceDetail&serviceId=${So}&productName=${Ua}`)}})};Ar(()=>{console.debug("inside useEffect"),So&&Jn&&Jn!=null&&Jn!=null&&(console.debug("inside if"),(async()=>{var fs,In,Ms,ho;if(Jn!==""||Jn!==null){let na=Jn.entityData;if(na!=null){let ta=na.restBuilderApiURL,Oo=na.propsData,Io=Oo.filters;So&&Io&&Io.fields&&(_.each(Io.fields,Vo=>{Vo.key=="serviceId"&&(Vo.value=`'${So}'`)}),Oo.filters=Io),console.debug("propsDataObj ---------- ",Oo);let fl=JSON.stringify(Oo),rl=btoa(fl);const mr=Liferay.ThemeDisplay.getSiteGroupId(),Tl=`${ta}?propsData=${rl}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${mr}`;try{const Vo=await Go.get(Tl);Vo&&(Vo!=null&&Vo.data)&&((In=(fs=Vo==null?void 0:Vo.data)==null?void 0:fs.items)==null?void 0:In.length)>0&&(console.debug("orderDetail --------- ",(Ms=Vo==null?void 0:Vo.data)==null?void 0:Ms.items),vd((ho=Vo.data)==null?void 0:ho.items[0]))}catch(Vo){console.error("Error fetching all order:",Vo)}}}})())},[So,Jn]),Ar(()=>{(async()=>{var Ms;const In=await jB(Liferay.ThemeDisplay.getUserId(),Liferay.ThemeDisplay.getSiteGroupId());if((In==null?void 0:In.status)==200||((Ms=In==null?void 0:In.data)==null?void 0:Ms.statusCode)==200){const ho=In==null?void 0:In.data;xr(ho)}})(),(async()=>{const In=Object.values(Fs).map(ho=>ho.key),Ms=await VB("CX Krypton Permission","com.constl.krypton.rbac.Service",In);if(Ms!=null&&Ms.data){const ho=Object.fromEntries(Object.entries(Fs).map(([na,ta])=>{const Oo=ta.key in Ms.data.data?Ms.data.data[ta.key]:ta.hasPermission;return[na,{...ta,hasPermission:Oo}]}));Jo(ho),Ma(!0)}})()},[]),Ar(()=>{Fs.viewServiceDetail.hasPermission&&rc()},[Fs.viewServiceDetail,Fs.viewMap,Fs.viewServiceDetailToplogy]),Ar(()=>{Fs.viewServiceDetailTestReport.hasPermission&&ii&&(Ha(!0),(async()=>{var In,Ms,ho,na,ta,Oo,Io;const fs=await MO(So,Ua,ii);fs&&((In=fs==null?void 0:fs.data)==null?void 0:In.statusCode)==200&&((ho=(Ms=fs==null?void 0:fs.data)==null?void 0:Ms.items)!=null&&ho.testReports)?(Ud((ta=(na=fs==null?void 0:fs.data)==null?void 0:na.items)==null?void 0:ta.testReports),Ha(!1)):(hc(((Io=(Oo=fs==null?void 0:fs.data)==null?void 0:Oo.items)==null?void 0:Io.error)||"No test reports are currently available for this service."),Ha(!1))})())},[Fs.viewServiceDetailTestReport,Fs.downloadServiceDetailTestReport,ii]),Ar(()=>{Fs.viewServiceDetailDocuments.hasPermission&&ii&&(console.log("customerAccountNo -> ",ii),Vu(!0),(async()=>{var In,Ms,ho,na,ta,Oo,Io;const fs=await MO(So,Ua,ii);console.log("serviceDocumentResp -> ",fs),fs&&((In=fs==null?void 0:fs.data)==null?void 0:In.statusCode)==200&&((ho=(Ms=fs==null?void 0:fs.data)==null?void 0:Ms.items)!=null&&ho.documents)?(mh((ta=(na=fs==null?void 0:fs.data)==null?void 0:na.items)==null?void 0:ta.documents),Vu(!1)):(Ka(((Io=(Oo=fs==null?void 0:fs.data)==null?void 0:Oo.items)==null?void 0:Io.error)||"No service documents are currently available for this service."),Vu(!1))})())},[Fs.viewServiceDetailDocuments,Fs.downloadServiceDetailDocuments,ii]),Ar(()=>{Xl&&(async()=>{var fs,In,Ms;if(Xl!==""||Xl!==null){let ho=Xl.entityData;if(ho!=null){let na=ho.restBuilderApiURL,ta=ho.propsData,Io=JSON.stringify(ta),To=btoa(Io);const fl=Liferay.ThemeDisplay.getSiteGroupId(),rl=`${na}?propsData=${To}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${fl}`;try{const mr=await Go.get(rl);console.debug("Service detail Response:",mr),mr&&(mr!=null&&mr.data)&&((In=(fs=mr==null?void 0:mr.data)==null?void 0:fs.items)==null?void 0:In.length)>0&&d((Ms=mr.data)==null?void 0:Ms.items)}catch(mr){console.error("Error fetching all services:",mr)}finally{Dl(!0)}}}})()},[Xl]),Ar(()=>{var Fn;if(a&&a.length>0){const fs=a.some(Ms=>(Ms==null?void 0:Ms.externalReferenceId)===So),In=a.find(Ms=>(Ms==null?void 0:Ms.externalReferenceId)===So);console.debug("selectedService ---------- ",In),Zl(In==null?void 0:In.id),Wu(fs),Fh(!0),i(((Fn=In==null?void 0:In.r_serviceCategoryId_c_cstlentitycategorymaster)==null?void 0:Fn.category)==="Network"),Qi(In==null?void 0:In.slaFrequency),qr(In==null?void 0:In.slaFrequency),(In!=null&&In.activationDate||(In==null?void 0:In.activationDate)!==""||(In==null?void 0:In.activationDate)!=="N/A")&&bu(fa().formatDateTime(In==null?void 0:In.activationDate))}},[a]),Ar(()=>{Qa&&ps&&(async()=>{var fs,In,Ms;try{if(Qa&&ps){let ho=ps.entityData,na=ps.serviceIdMappingFieldName;if(ho){let ta=ho.restBuilderApiURL,Oo=ho.propsData,Io=Oo.filters;Array.isArray(Io)&&(Io.forEach(Kc=>{Array.isArray(Kc.fields)&&Kc.fields.forEach(uc=>{uc.key===na&&(uc.value=`'${Qa}'`)})}),Oo.filters=Io);let fl=JSON.stringify(Oo),rl=btoa(fl);const mr=Liferay.ThemeDisplay.getSiteGroupId(),Tl=`${ta}?propsData=${rl}&userId=${Number(Liferay.ThemeDisplay.getUserId()).toString()}&siteId=${mr}`,Vo=await Go.get(Tl);Vo&&((fs=Vo==null?void 0:Vo.data)!=null&&fs.items)&&((In=Vo==null?void 0:Vo.data)==null?void 0:In.items.length)>0&&vn("Down"),Vo&&((Ms=Vo==null?void 0:Vo.data)!=null&&Ms.errMessage)&&vn("Up")}}}catch(ho){console.error("Error while fetch service related ticket service impacted: ",ho)}})()},[Qa]),Ar(()=>{Bh&&So&&ii&&(async()=>{var fs;try{const In=await WB(So,Ua,ii);console.debug("serviceDetailResp :: ",In),(In==null?void 0:In.statusCode)=="500"?s((In==null?void 0:In.error)||"Failed to retrieve service detail data"):(t((fs=In==null?void 0:In.data)==null?void 0:fs.items),Or(!1))}catch{s("An error occurred while fetching data.")}})()},[Bh,So]);const Dc=Fn=>{$l(Fn)},Pc=Fn=>{E(Fn)},or=Liferay.ThemeDisplay.getLayoutRelativeURL().replace(/\/[^/]+$/,"/services"),Kr=new URLSearchParams(window.location.search),Ur=Kr.get("doAsUserId")||"",Kn=Kr.get("tab")||"",As=new URLSearchParams({doAsUserId:Ur,tab:Kn}),Xo=`${or}?${As.toString()}`;Ar(()=>{kn!=null&&console.debug("serviceTopology updated in parent:",kn)},[kn]),Ar(()=>{(()=>{var Ms,ho;const fs=e&&(e==null?void 0:e.status)!==500&&((Ms=e==null?void 0:e.status)==null?void 0:Ms.toLowerCase())==="active";af(fs);const In=!fs||((ho=e==null?void 0:e.status)==null?void 0:ho.toLowerCase())==="pending"||Di&&!bi;Bi(In)})()},[Di,bi,e]),Ar(()=>{if(!sn)return;(async fs=>{var fl;const In=fs==null?void 0:fs.entityData;if(!In)return;const{restBuilderApiURL:Ms,propsData:ho}=In,na=ho==null?void 0:ho.filters;na!=null&&na.fields&&na.fields.forEach(rl=>{rl.key==="syncType"&&(rl.value="'Service'")});const ta=btoa(JSON.stringify({...ho,filters:na})),Oo=Liferay.ThemeDisplay.getSiteGroupId(),Io=Number(Liferay.ThemeDisplay.getUserId()).toString(),To=`${Ms}?propsData=${ta}&userId=${Io}&siteId=${Oo}`;try{const rl=await Go.get(To),mr=((fl=rl==null?void 0:rl.data)==null?void 0:fl.items)||[];if(console.log("[LastSyncTime] API Response:",mr),mr.length>0){const Vo=mr[0].syncReference||null,Kc=fa().formatDateTime(Vo);console.log("[LastSyncTime] Latest Sync Reference:",Kc),as(Kc)}else as(null)}catch(rl){console.error("[LastSyncTime] API Error:",rl)}})(sn)},[sn]);const pl=()=>{console.debug("isOpen",ro),Ao(!ro),document.body.classList.toggle("open-sidebar",!ro)};return B.createElement(B.Fragment,null,B.createElement("div",{class:"page-title-wrap"},B.createElement("h2",{class:"page-title"},"Service Overview"),B.createElement("div",{class:"breadcrumb"},B.createElement("ul",null,B.createElement("li",null,B.createElement("a",{href:Xo,title:"Services"},"Services")),B.createElement("li",null,"Services details")))),B.createElement("div",{class:"row service-detail-page"},!Xc||!ao||!Cc?B.createElement("div",null," "):Bh?B.createElement(B.Fragment,null,B.createElement("div",{class:"col-md-12 mb-25"},B.createElement("div",{class:"card service-detail-card "},n&&B.createElement("div",{className:"alert alert-info mb-3 mt-3",role:"alert"},n),!n&&B.createElement(B.Fragment,null,B.createElement("div",{class:"card-header"},B.createElement("div",{class:"orderNumber"},"Service -",B.createElement("span",null,e==null?void 0:e.id," "),$c&&($c==="Up"?B.createElement("span",{className:"service-up"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"trending_up")," ",$c):B.createElement("span",{className:"service-down"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"trending_down")," ",$c))),Fs.addCreateTicket.hasPermission&&B.createElement("button",{className:`button button-icon-text ${f?Tr:"disabled"}`,onClick:()=>window.location.href=Pr,disabled:f?Tr:!0,title:xu?"":"Ticket creation is unavailable for this service."},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"confirmation_number"),"Create Ticket")),B.createElement("div",{class:"card-body loader_wrap"},B.createElement("div",{class:"row"},B.createElement("div",{class:"col-md-8 tab-view-100"},B.createElement("div",{class:"row"},Fs.viewServiceDetailOverviewWidget.hasPermission?B.createElement(B.Fragment,null,Qr?B.createElement("div",{class:"loader"}," "):B.createElement(B.Fragment,null,B.createElement(fW,{serviceDetail:e}),B.createElement(bW,{serviceDetail:e,productName:Ua}),B.createElement(wW,{serviceDetail:e}),B.createElement("div",{class:"col-md-12"},ii?B.createElement(u$,{constlSupportTeamWidgetsConfig:zi,hasPermission:Fs.viewContact.hasPermission,externalReferenceId:ii}):B.createElement("div",{className:"constl-team-card"},B.createElement("div",{className:"title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"groups_3"),"Constl Team"),B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service detail KAM and CSM."))))):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service detail overview."))),B.createElement("div",{class:"col-md-4 tab-view-100 service-map-card-col"},Fs.viewMap.hasPermission?B.createElement(B.Fragment,null,B.createElement(_ce,{userType:"customer",redirectFrom:"service details",networkDataConfig:el})):B.createElement("div",{class:"service-map-card"},B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service map.")))))))),B.createElement("div",{class:"col-md-6 mb-25 tab-view-100"},B.createElement("div",{class:"card service-detail-card"},B.createElement("div",{class:"card-title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"bid_landscape")," ","SLA Performance"),B.createElement("div",{class:"card-body"},Fs.viewServiceDetailSlaWidget.hasPermission?B.createElement(B.Fragment,null,B.createElement(foe,{onChartTabChange:Pc,activeChartTab:S,productName:Ua,isNetworkService:f}),B.createElement("div",{className:`capsule-content ${f?"":"disabled"}`},S==="uptime"&&(Fs.viewSlaUptime.hasPermission?B.createElement(_oe,{serviceId:So,customerAccountNo:ii,redirectFrom:"serviceDetails",onAssociatedTicket:dl,uptimeData:L,setUptimeData:F,serviceStartDate:zl,uptimeSelectedPeriod:G,setUptimeSelectedPeriod:q,uptimeSelectedMonth:Q,setUptimeSelectedMonth:te,uptimeSelectedQuarter:he,setUptimeSelectedQuarter:fe,uptimeSelectedYear:le,setUptimeSelectedYear:Se,committedUptime:ke,setCommittedUptime:Ee,uptimeChartOptions:Ie,setUptimeChartOptions:He,uptimeSelectedQuarterMonthYear:Ye,setUptimeSelectedQuarterMonthYear:lt,uptimeCommittedFrequencyPeriod:Gt,setUptimeCommittedFrequencyPeriod:qr,isNetworkService:f}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service uptime chart.")),S==="ttr"&&(Fs.viewSlaTtr.hasPermission?B.createElement(voe,{serviceId:So,customerAccountNo:ii,redirectFrom:"serviceDetails",associatedTicketConfig:Po,portalServiceId:Qa,onAssociatedTickets:uh,ttrData:gi,serviceStartDate:zl,setTTRData:Oi,ttrSelectedPeriod:cr,setTTRSelectedPeriod:ji,ttrSelectedMonth:nn,setTTRSelectedMonth:pr,actualCommittedTTR:pt,setActualCommittedTTR:Nt,committedTTR:Si,setCommittedTTR:pi,ttrSelectedQuarter:Ue,setTTRSelectedQuarter:ni,ttrSelectedYear:fi,setTTRSelectedYear:Lt,ttrChartOptions:St,setTTRChartOptions:Ht,ttrSelectedQuarterMonthYear:nr,setTTRSelectedQuarterMonthYear:tr,isNetworkService:f}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service TTR chart.")),S==="mttr"&&(Fs.viewSlaMttr.hasPermission?B.createElement(xoe,{serviceId:So,customerAccountNo:ii,redirectFrom:"serviceDetails",onAssociatedTicket:dl,mttrData:Pt,serviceStartDate:zl,setMTTRData:At,mttrSelectedMonth:Ae,setMttrSelectedMonth:mt,mttrSelectedPeriod:ht,setMttrSelectedPeriod:Ot,mttrSelectedQuarter:bt,setMttrSelectedQuarter:Dt,mttrSelectedYear:Je,setMttrSelectedYear:dt,actualCommittedMTTR:ui,setActualCommittedMTTR:Vt,committedMTTR:ei,setCommittedMTTR:ur,mttrChartOptions:Zt,setMTTRChartOptions:Kt,mttrSelectedQuarterMonthYear:Ui,setMTTRSelectedQuarterMonthYear:rr,associatedTicketConfig:Po,portalServiceId:Qa,mttrCommittedFrequencyPeriod:sr,setMttrCommittedFrequencyPeriod:Qi,isNetworkService:f}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service MTTR chart.")),S==="fiberCuts"&&(Fs.viewSlaFiberCut.hasPermission?B.createElement(boe,{serviceId:So,customerAccountNo:ii,redirectFrom:"serviceDetails",fiberCutData:kr,serviceStartDate:zl,setFiberCutData:Mr,fiberCutSelectedPeriod:Cr,setFiberCutSelectedPeriod:Tn,fiberCutSelectedMonth:gs,setFiberCutSelectedMonth:wn,fiberCutSelectedQuarter:bs,setFiberCutSelectedQuarter:qn,fiberCutSelectedYear:Ls,setFiberCutSelectedYear:ma,committedFiberCuts:Ln,setCommittedFiberCuts:qo,fiberCutsChartOptions:zn,setFiberCutsChartOptions:za,fiberCutsSelectedQuarterMonthYear:$o,setFiberCutsSelectedQuarterMonthYear:Aa,isNetworkService:f}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service fiber cut chart.")),S==="latency"&&(Fs.viewSlaLatency.hasPermission?B.createElement(Coe,{serviceId:So,serviceStartDate:zl,customerAccountNo:ii,redirectFrom:"serviceDetails",onAssociatedTicket:dl,latencyData:ja,setLatencyData:Yn,latencySelectedPeriod:hl,setLatencySelectedPeriod:fr,latencySelectedMonth:tc,setLatencySelectedMonth:Sh,latencySelectedQuarter:bl,setLatencySelectedQuarter:Un,latencySelectedYear:vi,setLatencySelectedYear:Ge,committedLatency:Fe,setCommittedLatency:rt,latencyChartOptions:xt,setLatencyChartOptions:ft,last24HrsLatencyData:Jt,setLast24HrsLatencyData:xi,last24HrsCommittedLatency:ti,setLast24HrsCommittedLatency:ai,latencySelectedQuarterMonthYear:Yi,setLatencySelectedQuarterMonthYear:Fi,isNetworkService:f}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service latency chart.")))):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service SLA.")))),B.createElement("div",{class:"col-md-6 mb-25 tab-view-100"},B.createElement("div",{className:"card service-detail-card"},B.createElement("div",{className:"card-title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"book_5"),"More Information",Pn&&B.createElement("div",{style:{fontSize:"10px"}},"(Last Sync: ",Pn,")")),B.createElement("div",{className:"card-body"},B.createElement("div",{className:"tabular-tab"},B.createElement(aG,{onTabChange:Dc,activeTab:Ul,productName:Ua,relatedTicketDetails:fh})),B.createElement("div",{className:"tabular-content"},console.debug("serviceTopology before topology --------------- ",kn),Ul==="relatedTicket"&&(Fs.viewServiceRelatedTickets.hasPermission?B.createElement(coe,{ticketDetails:fh,loadingTickets:ba,page:Cs,setPage:to,pageSize:Xs,setPageSize:Bs,totalRecords:vu,ticketDetailEscalationConfig:$u,ticketDetailSupportTeamConfig:ch,ticketDetailObjKeysWidgetsConfig:zc,ticketDetailRelatedTicketWidgetConfig:ul,clubStatuses:Vf}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service related tickets.")),Ul==="testReports"&&(Fs.viewServiceDetailTestReport.hasPermission?B.createElement(doe,{orderDetail:Ll,hasDownloadPermission:Fs.viewServiceDetailTestReport.hasPermission,serviceTestReports:Nh,isLoading:fu,setIsLoading:Ha,showApiError:up}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service test reports.")),Ul==="escalationMatrix"&&B.createElement(d$,{customerAccountNo:ii,escalationMatrixConfig:Yr,escalationMatrixLevelConfig:is,escalationMatrixSegmentConfig:Hr,serviceId:So,hasPermission:Fs.viewServiceEscalationMatrix.hasPermission,extraClass:"service-detail-escalation",contactsConfig:Ds,customerConfig:Ks}))))),B.createElement("div",{class:"col-md-12 mb-25 tab-view-100"},B.createElement("div",{className:"card service-detail-card"},B.createElement("div",{className:"card-header mb-30"},B.createElement("div",{className:"left-controls"},B.createElement("div",{class:"card-title"},B.createElement("span",{class:"material-symbols-outlined constl-icon"},"settings_alert"),"Scheduled Maintenance")),B.createElement("div",{class:"right-controls"},Fs.viewScheduledMaintenanceList.hasPermission&&B.createElement(B.Fragment,null,(Fs.downloadScheduledMaintenance.hasPermission||Fs.exportScheduledMaintenance.hasPermission)&&B.createElement("div",{className:"action-controls"},Fs.downloadScheduledMaintenance.hasPermission&&B.createElement("div",{className:"filterIcon",onClick:Fs.downloadScheduledMaintenance.hasPermission?pl:null},B.createElement("span",{style:{cursor:Fs.downloadScheduledMaintenance.hasPermission?"pointer":"not-allowed"},className:"material-symbols-outlined constl-icon"},"filter_alt")),Fs.exportScheduledMaintenance.hasPermission&&B.createElement(Sce,{handleExport:$a,fileName:Ch,fileByteArr:Sl.fileByteArr,pdfTriggerDownload:Sl.pdfTriggerDownload,excelTriggerDownload:Sl.excelTriggerDownload,resetExportType:zh,exportDisable:Sl.exportDisable,isDisabled:!vt||vt.length===0}))))),B.createElement("div",{className:"card-body"},Fs.viewServiceDetailScheduledMaintenance.hasPermission?B.createElement(Soe,{scheduledMaintenanceConfig:mi,onDataFetched:Fn=>tn(Fn),serviceId:So,setScheduleMaintenance:Ja,scheduleMaintenanceExportType:Gu,scheduleMaintenance:Sl,setScheduleMaintenanceExportFileName:hh,onDataLoaded:Fn=>Yt(Fn),scheduleMaintenanceFilterParams:ju,parentModule:"service-detail"}):B.createElement("div",{className:"alert alert-warning"},"You do not have the required permission to view service scheduled maintenance.")),M2.createPortal(B.createElement(vfe,{isOpen:ro,toggleSidebar:pl,onFilterApply:Vl,filtersData:Yo,entityTypeId:(mi==null?void 0:mi.entityTypeId)??0,isDateFilter:mi.entityData.propsData.isDateFilter}),document.body)))):B.createElement("div",{class:"col-md-12 mb-25"},B.createElement("div",{class:"card service-detail-card"},B.createElement("div",{className:"alert alert-info"},`Service Id ${So} doesn't belong to customer account no ${ii}`)))))},bfe=()=>{const[e,t]=It(!1),[n,s]=It(!1);return Ar(()=>{(async()=>{const d=Number(Liferay.ThemeDisplay.getUserId()),f=await qg(d,"CX Krypton Permission","com.constl.krypton.rbac.Service","ViewServiceDetail");(f==null?void 0:f.data)===!0&&t(!0),s(!0)})()},[]),n?e?B.createElement(xfe,null):B.createElement("div",{className:"col-md-12 mb-25"},B.createElement("div",{className:"alert alert-warning mb-3 mt-3",role:"alert"},"You do not have the required permission to view service details.")):B.createElement("div",null)},wfe=()=>B.createElement(B.Fragment,null,B.createElement(bfe,null));class Sfe extends HTMLElement{connectedCallback(){dW(B.createElement(cW,null,B.createElement(wfe,null)),this)}disconnectedCallback(){pW(this)}}const z3="krypton-service-details-cx";customElements.get(z3)||customElements.define(z3,Sfe);export{Ho as $,AS as A,s9 as B,aF as C,eD as D,ug as E,HJ as F,Z9 as G,Tie as H,KR as I,nY as J,p9 as K,U1 as L,Afe as M,gF as N,vL as O,sk as P,WO as Q,OZ as R,aE as S,jJ as T,TT as U,_F as V,F9 as W,ST as X,oo as Y,NJ as Z,Ze as _,nf as a,ko as a$,IZ as a0,dR as a1,uR as a2,zfe as a3,Ofe as a4,Bfe as a5,Nfe as a6,Dfe as a7,UL as a8,Ffe as a9,LJ as aA,_Q as aB,wJ as aC,HL as aD,sN as aE,ste as aF,LZ as aG,og as aH,w_ as aI,ite as aJ,rte as aK,LT as aL,NL as aM,Zv as aN,KS as aO,sR as aP,hX as aQ,_b as aR,DJ as aS,c4 as aT,ek as aU,nk as aV,ZE as aW,u4 as aX,l4 as aY,oJ as aZ,t5 as a_,Pfe as aa,u1 as ab,$fe as ac,Ufe as ad,Rfe as ae,Ite as af,mU as ag,eme as ah,y4 as ai,cp as aj,ux as ak,LL as al,oY as am,j4 as an,bb as ao,Ra as ap,__ as aq,bie as ar,Jfe as as,tme as at,Kfe as au,Eo as av,Qfe as aw,rie as ax,Jte as ay,Qte as az,G9 as b,RL as b0,g5 as b1,cg as b2,kT as b3,rX as b4,v5 as b5,Lfe as b6,uG as b7,IJ as b8,bJ as b9,n4 as bA,dI as bB,PJ as bC,rk as bD,ah as bE,T_ as ba,eQ as bb,GL as bc,eJ as bd,RJ as be,MT as bf,aw as bg,qE as bh,pJ as bi,Gie as bj,AT as bk,XE as bl,aJ as bm,i4 as bn,nQ as bo,sQ as bp,rre as bq,kR as br,oQ as bs,qL as bt,iQ as bu,uQ as bv,lw as bw,hx as bx,wR as by,YL as bz,H9 as c,Bc as d,sw as e,v4 as f,j9 as g,sv as h,hb as i,mc as j,yF as k,On as l,i5 as m,q9 as n,Y9 as o,sY as p,Xte as q,Vfe as r,W9 as s,V9 as t,c_ as u,Ife as v,YJ as w,Mfe as x,rme as y,ime as z};
